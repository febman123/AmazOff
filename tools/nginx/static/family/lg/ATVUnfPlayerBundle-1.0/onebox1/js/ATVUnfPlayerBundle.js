var freeOnUnref=function(e){return e.prototype.constructor=null,e},ATVUnfPlayerBundle=freeOnUnref(function(){"use strict";var ce="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}var f=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function i(e,t,n,r){(((this.is=this).a=this).an=this).baseName=e,this.target=t,this.targetName=n,(this.negated=r)||(this.not=new i(e,t,n,!0))}return i.of=freeOnUnref(function(n){return freeOnUnref(function(e,t){return new i(n,e,t)})}),i.check=freeOnUnref(function(e,t){return new i(null,e,t)}),i.prototype.function=freeOnUnref(function(){return this.checkType("Function")}),i.prototype.object=freeOnUnref(function(){return this.checkType("Object")}),i.prototype.number=freeOnUnref(function(){return this.checkType("Number")}),i.prototype.string=freeOnUnref(function(){return this.checkType("String")}),i.prototype.array=freeOnUnref(function(){return this.checkType("Array")}),i.prototype.null=freeOnUnref(function(){return this.verify(null===this.target,"null")}),i.prototype.undefined=freeOnUnref(function(){return this.verify(void 0===this.target,"undefined")}),i.prototype.empty=freeOnUnref(function(){return this.verify(null===this.target||void 0===this.target||""===this.target||this.isType("Array")&&0===this.target.length||this.isType("Object")&&!this.hasProperties(),"empty")}),i.prototype.exists=freeOnUnref(function(){return this.verify(void 0!==this.target&&null!==this.target,"defined and non-null")}),i.prototype.true=freeOnUnref(function(){return this.verify(!0===this.target,"true")}),i.prototype.false=freeOnUnref(function(){return this.verify(!1===this.target,"false")}),i.prototype.checkType=freeOnUnref(function(e){return this.verify(this.isType(e),"a "+e)}),i.prototype.isType=freeOnUnref(function(e){return Object.prototype.toString.call(this.target)==="[object "+e+"]"}),i.prototype.hasProperties=freeOnUnref(function(){for(var e in this.target)if(this.target.hasOwnProperty(e))return!0;return!1}),i.prototype.verify=freeOnUnref(function(e,t){if(this.negated?e:!e){var n=this.baseName?"["+this.baseName+"] ":"",r=this.targetName?this.targetName+" ("+this.target+")":""+this.target;throw new Error(n+"Check failed: "+r+" was "+(this.negated?"":"not ")+t)}return this.target}),i})(),r=n.of,i=n.check;t.of=r,t.check=i}));e(f);f.of,f.check;var l=t(freeOnUnref(function(V,j){freeOnUnref(function(){var ta,na="Expected a function",ra="__lodash_hash_undefined__",ia="__lodash_placeholder__",oa=9007199254740991,aa=NaN,sa=4294967295,la=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],fa="[object Arguments]",ua="[object Array]",ca="[object Boolean]",da="[object Date]",pa="[object Error]",ha="[object Function]",ma="[object GeneratorFunction]",ya="[object Map]",ga="[object Number]",va="[object Object]",Oa="[object Promise]",Sa="[object RegExp]",Ua="[object Set]",ba="[object String]",Pa="[object Symbol]",Ma="[object WeakMap]",Ca="[object ArrayBuffer]",Ea="[object DataView]",Ta="[object Float32Array]",wa="[object Float64Array]",Ia="[object Int8Array]",ka="[object Int16Array]",_a="[object Int32Array]",Ra="[object Uint8Array]",Aa="[object Uint8ClampedArray]",Da="[object Uint16Array]",xa="[object Uint32Array]",Fa=/\b__p \+= '';/g,Ba=/\b(__p \+=) '' \+/g,La=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Na=/&(?:amp|lt|gt|quot|#39);/g,Va=/[&<>"']/g,ja=RegExp(Na.source),qa=RegExp(Va.source),Ha=/<%-([\s\S]+?)%>/g,za=/<%([\s\S]+?)%>/g,Wa=/<%=([\s\S]+?)%>/g,Ka=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ga=/^\w*$/,Qa=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Xa=/[\\^$.*+?()[\]{}|]/g,Ya=RegExp(Xa.source),Ja=/^\s+/,n=/\s/,Za=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,$a=/\{\n\/\* \[wrapped with (.+)\] \*/,es=/,? & /,ts=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ns=/[()=,{}\[\]\/\s]/,rs=/\\(\\)?/g,is=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,os=/\w*$/,as=/^[-+]0x[0-9a-f]+$/i,ss=/^0b[01]+$/i,ls=/^\[object .+?Constructor\]$/,fs=/^0o[0-7]+$/i,us=/^(?:0|[1-9]\d*)$/,cs=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ds=/($^)/,ps=/['\n\r\u2028\u2029\\]/g,e="\\ud800-\\udfff",t="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",r="\\u2700-\\u27bf",i="a-z\\xdf-\\xf6\\xf8-\\xff",o="A-Z\\xc0-\\xd6\\xd8-\\xde",a="\\ufe0e\\ufe0f",s="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",l="["+e+"]",f="["+s+"]",u="["+t+"]",c="\\d+",d="["+r+"]",p="["+i+"]",h="[^"+e+s+c+r+i+o+"]",m="\\ud83c[\\udffb-\\udfff]",y="[^"+e+"]",g="(?:\\ud83c[\\udde6-\\uddff]){2}",v="[\\ud800-\\udbff][\\udc00-\\udfff]",O="["+o+"]",S="(?:"+p+"|"+h+")",U="(?:"+O+"|"+h+")",b="(?:['’](?:d|ll|m|re|s|t|ve))?",P="(?:['’](?:D|LL|M|RE|S|T|VE))?",M="(?:"+u+"|"+m+")"+"?",C="["+a+"]?",E=C+M+("(?:\\u200d(?:"+[y,g,v].join("|")+")"+C+M+")*"),T="(?:"+[d,g,v].join("|")+")"+E,w="(?:"+[y+u+"?",u,g,v,l].join("|")+")",hs=RegExp("['’]","g"),ms=RegExp(u,"g"),I=RegExp(m+"(?="+m+")|"+w+E,"g"),ys=RegExp([O+"?"+p+"+"+b+"(?="+[f,O,"$"].join("|")+")",U+"+"+P+"(?="+[f,O+S,"$"].join("|")+")",O+"?"+S+"+"+b,O+"+"+P,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",c,T].join("|"),"g"),k=RegExp("[\\u200d"+e+t+a+"]"),gs=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,vs=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Os=-1,Ss={};Ss[Ta]=Ss[wa]=Ss[Ia]=Ss[ka]=Ss[_a]=Ss[Ra]=Ss[Aa]=Ss[Da]=Ss[xa]=!0,Ss[fa]=Ss[ua]=Ss[Ca]=Ss[ca]=Ss[Ea]=Ss[da]=Ss[pa]=Ss[ha]=Ss[ya]=Ss[ga]=Ss[va]=Ss[Sa]=Ss[Ua]=Ss[ba]=Ss[Ma]=!1;var Us={};Us[fa]=Us[ua]=Us[Ca]=Us[Ea]=Us[ca]=Us[da]=Us[Ta]=Us[wa]=Us[Ia]=Us[ka]=Us[_a]=Us[ya]=Us[ga]=Us[va]=Us[Sa]=Us[Ua]=Us[ba]=Us[Pa]=Us[Ra]=Us[Aa]=Us[Da]=Us[xa]=!0,Us[pa]=Us[ha]=Us[Ma]=!1;var _={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},bs=parseFloat,Ps=parseInt,R="object"==typeof ce&&ce&&ce.Object===Object&&ce,A="object"==typeof self&&self&&self.Object===Object&&self,Ms=R||A||Function("return this")(),D=j&&!j.nodeType&&j,x=D&&V&&!V.nodeType&&V,Cs=x&&x.exports===D,F=Cs&&R.process,B=freeOnUnref(function(){try{var e=x&&x.require&&x.require("util").types;return e||F&&F.binding&&F.binding("util")}catch(e){}})(),Es=B&&B.isArrayBuffer,Ts=B&&B.isDate,ws=B&&B.isMap,Is=B&&B.isRegExp,ks=B&&B.isSet,_s=B&&B.isTypedArray;function Rs(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function As(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(r,a,n(a),e)}return r}function Ds(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function xs(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function Fs(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function Bs(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}function Ls(e,t){return!!(null==e?0:e.length)&&-1<Gs(e,t,0)}function Ns(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function Vs(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function js(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function qs(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function Hs(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function zs(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var L=Js("length");function Ws(e,r,t){var i;return t(e,freeOnUnref(function(e,t,n){if(r(e,t,n))return i=t,!1})),i}function Ks(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function Gs(e,t,n){return t==t?function(e,t,n){var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):Ks(e,Xs,n)}function Qs(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}function Xs(e){return e!=e}function Ys(e,t){var n=null==e?0:e.length;return n?$s(e,t)/n:aa}function Js(t){return freeOnUnref(function(e){return null==e?ta:e[t]})}function N(t){return freeOnUnref(function(e){return null==t?ta:t[e]})}function Zs(e,r,i,o,t){return t(e,freeOnUnref(function(e,t,n){i=o?(o=!1,e):r(i,e,t,n)})),i}function $s(e,t){for(var n,r=-1,i=e.length;++r<i;){var o=t(e[r]);o!==ta&&(n=n===ta?o:n+o)}return n}function el(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function tl(e){return e?e.slice(0,gl(e)+1).replace(Ja,""):e}function nl(t){return freeOnUnref(function(e){return t(e)})}function rl(t,e){return Vs(e,freeOnUnref(function(e){return t[e]}))}function il(e,t){return e.has(t)}function ol(e,t){for(var n=-1,r=e.length;++n<r&&-1<Gs(t,e[n],0););return n}function al(e,t){for(var n=e.length;n--&&-1<Gs(t,e[n],0););return n}var sl=N({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),ll=N({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function fl(e){return"\\"+_[e]}function ul(e){return k.test(e)}function cl(e){var n=-1,r=Array(e.size);return e.forEach(freeOnUnref(function(e,t){r[++n]=[t,e]})),r}function dl(t,n){return freeOnUnref(function(e){return t(n(e))})}function pl(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n];a!==t&&a!==ia||(e[n]=ia,o[i++]=n)}return o}function hl(e){var t=-1,n=Array(e.size);return e.forEach(freeOnUnref(function(e){n[++t]=e})),n}function ml(e){return ul(e)?function(e){var t=I.lastIndex=0;for(;I.test(e);)++t;return t}(e):L(e)}function yl(e){return ul(e)?e.match(I)||[]:e.split("")}function gl(e){for(var t=e.length;t--&&n.test(e.charAt(t)););return t}var vl=N({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Ol=function e(t){var w=(t=null==t?Ms:Ol.defaults(Ms.Object(),t,Ol.pick(Ms,vs))).Array,n=t.Date,y=t.Error,g=t.Function,i=t.Math,M=t.Object,v=t.RegExp,u=t.String,I=t.TypeError,o=w.prototype,r=g.prototype,c=M.prototype,a=t["__core-js_shared__"],s=r.toString,C=c.hasOwnProperty,l=0,f=freeOnUnref(function(){var e=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""})(),d=c.toString,p=s.call(M),h=Ms._,m=v("^"+s.call(C).replace(Xa,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),O=Cs?t.Buffer:ta,S=t.Symbol,U=t.Uint8Array,b=O?O.allocUnsafe:ta,P=dl(M.getPrototypeOf,M),E=M.create,T=c.propertyIsEnumerable,k=o.splice,_=S?S.isConcatSpreadable:ta,R=S?S.iterator:ta,A=S?S.toStringTag:ta,D=freeOnUnref(function(){try{var e=Nn(M,"defineProperty");return e({},"",{}),e}catch(e){}})(),x=t.clearTimeout!==Ms.clearTimeout&&t.clearTimeout,F=n&&n.now!==Ms.Date.now&&n.now,B=t.setTimeout!==Ms.setTimeout&&t.setTimeout,L=i.ceil,N=i.floor,V=M.getOwnPropertySymbols,j=O?O.isBuffer:ta,q=t.isFinite,H=o.join,z=dl(M.keys,M),W=i.max,K=i.min,G=n.now,Q=t.parseInt,X=i.random,Y=o.reverse,J=Nn(t,"DataView"),Z=Nn(t,"Map"),$=Nn(t,"Promise"),ee=Nn(t,"Set"),te=Nn(t,"WeakMap"),ne=Nn(M,"create"),re=te&&new te,ie={},oe=hr(J),ae=hr(Z),se=hr($),le=hr(ee),fe=hr(te),ue=S?S.prototype:ta,ce=ue?ue.valueOf:ta,de=ue?ue.toString:ta;function pe(e){if(_i(e)&&!Si(e)&&!(e instanceof ge)){if(e instanceof ye)return e;if(C.call(e,"__wrapped__"))return mr(e)}return new ye(e)}var he=freeOnUnref(function(){function n(){}return freeOnUnref(function(e){if(!ki(e))return{};if(E)return E(e);n.prototype=e;var t=new n;return n.prototype=ta,t})})();function me(){}function ye(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=ta}function ge(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=sa,this.__views__=[]}function ve(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Oe(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Se(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ue(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Se;++t<n;)this.add(e[t])}function be(e){var t=this.__data__=new Oe(e);this.size=t.size}function Pe(e,t){var n=Si(e),r=!n&&Oi(e),i=!n&&!r&&Mi(e),o=!n&&!r&&!i&&Ni(e),a=n||r||i||o,s=a?el(e.length,u):[],l=s.length;for(var f in e)!t&&!C.call(e,f)||a&&("length"==f||i&&("offset"==f||"parent"==f)||o&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||Kn(f,l))||s.push(f);return s}function Me(e){var t=e.length;return t?e[Ut(0,t-1)]:ta}function Ce(e,t){return lr(nn(e),De(t,0,e.length))}function Ee(e){return lr(nn(e))}function Te(e,t,n){(n===ta||yi(e[t],n))&&(n!==ta||t in e)||Re(e,t,n)}function we(e,t,n){var r=e[t];C.call(e,t)&&yi(r,n)&&(n!==ta||t in e)||Re(e,t,n)}function Ie(e,t){for(var n=e.length;n--;)if(yi(e[n][0],t))return n;return-1}function ke(e,r,i,o){return Ne(e,freeOnUnref(function(e,t,n){r(o,e,i(e),n)})),o}function _e(e,t){return e&&rn(t,so(t),e)}function Re(e,t,n){"__proto__"==t&&D?D(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Ae(e,t){for(var n=-1,r=t.length,i=w(r),o=null==e;++n<r;)i[n]=o?ta:no(e,t[n]);return i}function De(e,t,n){return e==e&&(n!==ta&&(e=e<=n?e:n),t!==ta&&(e=t<=e?e:t)),e}function xe(n,r,i,e,t,o){var a,s=1&r,l=2&r,f=4&r;if(i&&(a=t?i(n,e,t,o):i(n)),a!==ta)return a;if(!ki(n))return n;var u,c,d,p,h,m,y,g,v,O=Si(n);if(O){if(g=(y=n).length,v=new y.constructor(g),g&&"string"==typeof y[0]&&C.call(y,"index")&&(v.index=y.index,v.input=y.input),a=v,!s)return nn(n,a)}else{var S=qn(n),U=S==ha||S==ma;if(Mi(n))return Yt(n,s);if(S==va||S==fa||U&&!t){if(a=l||U?{}:zn(n),!s)return l?(m=d=n,p=(h=a)&&rn(m,lo(m),h),rn(d,jn(d),p)):(c=_e(a,u=n),rn(u,Vn(u),c))}else{if(!Us[S])return t?n:{};a=function(e,t,n){var r,i,o,a,s,l=e.constructor;switch(t){case Ca:return Jt(e);case ca:case da:return new l(+e);case Ea:return a=e,s=n?Jt(a.buffer):a.buffer,new a.constructor(s,a.byteOffset,a.byteLength);case Ta:case wa:case Ia:case ka:case _a:case Ra:case Aa:case Da:case xa:return Zt(e,n);case ya:return new l;case ga:case ba:return new l(e);case Sa:return(o=new(i=e).constructor(i.source,os.exec(i))).lastIndex=i.lastIndex,o;case Ua:return new l;case Pa:return r=e,ce?M(ce.call(r)):{}}}(n,S,s)}}o||(o=new be);var b=o.get(n);if(b)return b;o.set(n,a),Fi(n)?n.forEach(freeOnUnref(function(e){a.add(xe(e,r,i,e,n,o))})):Ri(n)&&n.forEach(freeOnUnref(function(e,t){a.set(t,xe(e,r,i,t,n,o))}));var P=O?ta:(f?l?Rn:_n:l?lo:so)(n);return Ds(P||n,freeOnUnref(function(e,t){P&&(e=n[t=e]),we(a,t,xe(e,r,i,t,n,o))})),a}function Fe(e,t,n){var r=n.length;if(null==e)return!r;for(e=M(e);r--;){var i=n[r],o=t[i],a=e[i];if(a===ta&&!(i in e)||!o(a))return!1}return!0}function Be(e,t,n){if("function"!=typeof e)throw new I(na);return ir(freeOnUnref(function(){e.apply(ta,n)}),t)}function Le(e,t,n,r){var i=-1,o=Ls,a=!0,s=e.length,l=[],f=t.length;if(!s)return l;n&&(t=Vs(t,nl(n))),r?(o=Ns,a=!1):200<=t.length&&(o=il,a=!1,t=new Ue(t));e:for(;++i<s;){var u=e[i],c=null==n?u:n(u);if(u=r||0!==u?u:0,a&&c==c){for(var d=f;d--;)if(t[d]===c)continue e;l.push(u)}else o(t,c,r)||l.push(u)}return l}pe.templateSettings={escape:Ha,evaluate:za,interpolate:Wa,variable:"",imports:{_:pe}},(pe.prototype=me.prototype).constructor=pe,(ye.prototype=he(me.prototype)).constructor=ye,(ge.prototype=he(me.prototype)).constructor=ge,ve.prototype.clear=function(){this.__data__=ne?ne(null):{},this.size=0},ve.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ve.prototype.get=function(e){var t=this.__data__;if(ne){var n=t[e];return n===ra?ta:n}return C.call(t,e)?t[e]:ta},ve.prototype.has=function(e){var t=this.__data__;return ne?t[e]!==ta:C.call(t,e)},ve.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ne&&t===ta?ra:t,this},Oe.prototype.clear=function(){this.__data__=[],this.size=0},Oe.prototype.delete=function(e){var t=this.__data__,n=Ie(t,e);return!(n<0||(n==t.length-1?t.pop():k.call(t,n,1),--this.size,0))},Oe.prototype.get=function(e){var t=this.__data__,n=Ie(t,e);return n<0?ta:t[n][1]},Oe.prototype.has=function(e){return-1<Ie(this.__data__,e)},Oe.prototype.set=function(e,t){var n=this.__data__,r=Ie(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Se.prototype.clear=function(){this.size=0,this.__data__={hash:new ve,map:new(Z||Oe),string:new ve}},Se.prototype.delete=function(e){var t=Bn(this,e).delete(e);return this.size-=t?1:0,t},Se.prototype.get=function(e){return Bn(this,e).get(e)},Se.prototype.has=function(e){return Bn(this,e).has(e)},Se.prototype.set=function(e,t){var n=Bn(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Ue.prototype.add=Ue.prototype.push=function(e){return this.__data__.set(e,ra),this},Ue.prototype.has=function(e){return this.__data__.has(e)},be.prototype.clear=function(){this.__data__=new Oe,this.size=0},be.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},be.prototype.get=function(e){return this.__data__.get(e)},be.prototype.has=function(e){return this.__data__.has(e)},be.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Oe){var r=n.__data__;if(!Z||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Se(r)}return n.set(e,t),this.size=n.size,this};var Ne=sn(Ge),Ve=sn(Qe,!0);function je(e,r){var i=!0;return Ne(e,freeOnUnref(function(e,t,n){return i=!!r(e,t,n)})),i}function qe(e,t,n){for(var r=-1,i=e.length;++r<i;){var o=e[r],a=t(o);if(null!=a&&(s===ta?a==a&&!Li(a):n(a,s)))var s=a,l=o}return l}function He(e,r){var i=[];return Ne(e,freeOnUnref(function(e,t,n){r(e,t,n)&&i.push(e)})),i}function ze(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=Wn),i||(i=[]);++o<a;){var s=e[o];0<t&&n(s)?1<t?ze(s,t-1,n,r,i):js(i,s):r||(i[i.length]=s)}return i}var We=ln(),Ke=ln(!0);function Ge(e,t){return e&&We(e,t,so)}function Qe(e,t){return e&&Ke(e,t,so)}function Xe(t,e){return Bs(e,freeOnUnref(function(e){return Ti(t[e])}))}function Ye(e,t){for(var n=0,r=(t=Kt(t,e)).length;null!=e&&n<r;)e=e[pr(t[n++])];return n&&n==r?e:ta}function Je(e,t,n){var r=t(e);return Si(e)?r:js(r,n(e))}function Ze(e){return null==e?e===ta?"[object Undefined]":"[object Null]":A&&A in M(e)?function(e){var t=C.call(e,A),n=e[A];try{e[A]=ta;var r=!0}catch(e){}var i=d.call(e);return r&&(t?e[A]=n:delete e[A]),i}(e):(t=e,d.call(t));var t}function $e(e,t){return t<e}function et(e,t){return null!=e&&C.call(e,t)}function tt(e,t){return null!=e&&t in M(e)}function nt(e,t,n){for(var r=n?Ns:Ls,i=e[0].length,o=e.length,a=o,s=w(o),l=1/0,f=[];a--;){var u=e[a];a&&t&&(u=Vs(u,nl(t))),l=K(u.length,l),s[a]=!n&&(t||120<=i&&120<=u.length)?new Ue(a&&u):ta}u=e[0];var c=-1,d=s[0];e:for(;++c<i&&f.length<l;){var p=u[c],h=t?t(p):p;if(p=n||0!==p?p:0,!(d?il(d,h):r(f,h,n))){for(a=o;--a;){var m=s[a];if(!(m?il(m,h):r(e[a],h,n)))continue e}d&&d.push(h),f.push(p)}}return f}function rt(e,t,n){var r=null==(e=tr(e,t=Kt(t,e)))?e:e[pr(Er(t))];return null==r?ta:Rs(r,e,n)}function it(e){return _i(e)&&Ze(e)==fa}function ot(e,t,n,r,i){return e===t||(null==e||null==t||!_i(e)&&!_i(t)?e!=e&&t!=t:function(e,t,n,r,i,o){var a=Si(e),s=Si(t),l=a?ua:qn(e),f=s?ua:qn(t),u=(l=l==fa?va:l)==va,c=(f=f==fa?va:f)==va,d=l==f;if(d&&Mi(e)){if(!Mi(t))return!1;u=!(a=!0)}if(d&&!u)return o||(o=new be),a||Ni(e)?In(e,t,n,r,i,o):function(e,t,n,r,i,o,a){switch(n){case Ea:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ca:return!(e.byteLength!=t.byteLength||!o(new U(e),new U(t)));case ca:case da:case ga:return yi(+e,+t);case pa:return e.name==t.name&&e.message==t.message;case Sa:case ba:return e==t+"";case ya:var s=cl;case Ua:var l=1&r;if(s||(s=hl),e.size!=t.size&&!l)return!1;var f=a.get(e);if(f)return f==t;r|=2,a.set(e,t);var u=In(s(e),s(t),r,i,o,a);return a.delete(e),u;case Pa:if(ce)return ce.call(e)==ce.call(t)}return!1}(e,t,l,n,r,i,o);if(!(1&n)){var p=u&&C.call(e,"__wrapped__"),h=c&&C.call(t,"__wrapped__");if(p||h){var m=p?e.value():e,y=h?t.value():t;return o||(o=new be),i(m,y,n,r,o)}}return!!d&&(o||(o=new be),function(e,t,n,r,i,o){var a=1&n,s=_n(e),l=s.length,f=_n(t).length;if(l!=f&&!a)return!1;for(var u=l;u--;){var c=s[u];if(!(a?c in t:C.call(t,c)))return!1}var d=o.get(e),p=o.get(t);if(d&&p)return d==t&&p==e;var h=!0;o.set(e,t),o.set(t,e);for(var m=a;++u<l;){c=s[u];var y=e[c],g=t[c];if(r)var v=a?r(g,y,c,t,e,o):r(y,g,c,e,t,o);if(!(v===ta?y===g||i(y,g,n,r,o):v)){h=!1;break}m||(m="constructor"==c)}if(h&&!m){var O=e.constructor,S=t.constructor;O!=S&&"constructor"in e&&"constructor"in t&&!("function"==typeof O&&O instanceof O&&"function"==typeof S&&S instanceof S)&&(h=!1)}return o.delete(e),o.delete(t),h}(e,t,n,r,i,o))}(e,t,n,r,ot,i))}function at(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=M(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var l=(s=n[i])[0],f=e[l],u=s[1];if(a&&s[2]){if(f===ta&&!(l in e))return!1}else{var c=new be;if(r)var d=r(f,u,l,e,t,c);if(!(d===ta?ot(u,f,3,r,c):d))return!1}}return!0}function st(e){return!(!ki(e)||(t=e,f&&f in t))&&(Ti(e)?m:ls).test(hr(e));var t}function lt(e){return"function"==typeof e?e:null==e?Do:"object"==typeof e?Si(e)?ht(e[0],e[1]):pt(e):Ho(e)}function ft(e){if(!Jn(e))return z(e);var t=[];for(var n in M(e))C.call(e,n)&&"constructor"!=n&&t.push(n);return t}function ut(e){if(!ki(e))return function(e){var t=[];if(null!=e)for(var n in M(e))t.push(n);return t}(e);var t=Jn(e),n=[];for(var r in e)("constructor"!=r||!t&&C.call(e,r))&&n.push(r);return n}function ct(e,t){return e<t}function dt(e,r){var i=-1,o=bi(e)?w(e.length):[];return Ne(e,freeOnUnref(function(e,t,n){o[++i]=r(e,t,n)})),o}function pt(t){var n=Ln(t);return 1==n.length&&n[0][2]?$n(n[0][0],n[0][1]):freeOnUnref(function(e){return e===t||at(e,t,n)})}function ht(n,r){return Qn(n)&&Zn(r)?$n(pr(n),r):freeOnUnref(function(e){var t=no(e,n);return t===ta&&t===r?ro(e,n):ot(r,t,3)})}function mt(r,i,o,a,s){r!==i&&We(i,freeOnUnref(function(e,t){if(s||(s=new be),ki(e))!function(e,t,n,r,i,o,a){var s=nr(e,n),l=nr(t,n),f=a.get(l);if(f)return Te(e,n,f);var u=o?o(s,l,n+"",e,t,a):ta,c=u===ta;if(c){var d=Si(l),p=!d&&Mi(l),h=!d&&!p&&Ni(l);u=l,d||p||h?u=Si(s)?s:Pi(s)?nn(s):p?Yt(l,!(c=!1)):h?Zt(l,!(c=!1)):[]:Di(l)||Oi(l)?Oi(u=s)?u=Gi(s):ki(s)&&!Ti(s)||(u=zn(l)):c=!1}c&&(a.set(l,u),i(u,l,r,o,a),a.delete(l)),Te(e,n,u)}(r,i,t,o,mt,a,s);else{var n=a?a(nr(r,t),e,t+"",r,i,s):ta;n===ta&&(n=e),Te(r,t,n)}}),lo)}function yt(e,t){var n=e.length;if(n)return Kn(t+=t<0?n:0,n)?e[t]:ta}function gt(e,r,n){r=r.length?Vs(r,freeOnUnref(function(t){return Si(t)?freeOnUnref(function(e){return Ye(e,1===t.length?t[0]:t)}):t})):[Do];var i=-1;return r=Vs(r,nl(Fn())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(dt(e,freeOnUnref(function(t,e,n){return{criteria:Vs(r,freeOnUnref(function(e){return e(t)})),index:++i,value:t}})),freeOnUnref(function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;++r<a;){var l=$t(i[r],o[r]);if(l){if(s<=r)return l;var f=n[r];return l*("desc"==f?-1:1)}}return e.index-t.index}(e,t,n)}))}function vt(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var a=t[r],s=Ye(e,a);n(s,a)&&Et(o,Kt(a,e),s)}return o}function Ot(e,t,n,r){var i=r?Qs:Gs,o=-1,a=t.length,s=e;for(e===t&&(t=nn(t)),n&&(s=Vs(e,nl(n)));++o<a;)for(var l=0,f=t[o],u=n?n(f):f;-1<(l=i(s,u,l,r));)s!==e&&k.call(s,l,1),k.call(e,l,1);return e}function St(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==o){var o=i;Kn(i)?k.call(e,i,1):Lt(e,i)}}return e}function Ut(e,t){return e+N(X()*(t-e+1))}function bt(e,t){var n="";if(!e||t<1||oa<t)return n;for(;t%2&&(n+=e),(t=N(t/2))&&(e+=e),t;);return n}function Pt(e,t){return or(er(e,t,Do),e+"")}function Mt(e){return Me(go(e))}function Ct(e,t){var n=go(e);return lr(n,De(t,0,n.length))}function Et(e,t,n,r){if(!ki(e))return e;for(var i=-1,o=(t=Kt(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var l=pr(t[i]),f=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(i!=a){var u=s[l];(f=r?r(u,l,s):ta)===ta&&(f=ki(u)?u:Kn(t[i+1])?[]:{})}we(s,l,f),s=s[l]}return e}var Tt=re?freeOnUnref(function(e,t){return re.set(e,t),e}):Do,wt=D?freeOnUnref(function(e,t){return D(e,"toString",{configurable:!0,enumerable:!1,value:_o(t),writable:!0})}):Do;function It(e){return lr(go(e))}function kt(e,t,n){var r=-1,i=e.length;t<0&&(t=i<-t?0:i+t),(n=i<n?i:n)<0&&(n+=i),i=n<t?0:n-t>>>0,t>>>=0;for(var o=w(i);++r<i;)o[r]=e[r+t];return o}function _t(e,r){var i;return Ne(e,freeOnUnref(function(e,t,n){return!(i=r(e,t,n))})),!!i}function Rt(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=e[o];null!==a&&!Li(a)&&(n?a<=t:a<t)?r=o+1:i=o}return i}return At(e,t,Do,n)}function At(e,t,n,r){var i=0,o=null==e?0:e.length;if(0===o)return 0;for(var a=(t=n(t))!=t,s=null===t,l=Li(t),f=t===ta;i<o;){var u=N((i+o)/2),c=n(e[u]),d=c!==ta,p=null===c,h=c==c,m=Li(c);if(a)var y=r||h;else y=f?h&&(r||d):s?h&&d&&(r||!p):l?h&&d&&!p&&(r||!m):!p&&!m&&(r?c<=t:c<t);y?i=u+1:o=u}return K(o,4294967294)}function Dt(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n],s=t?t(a):a;if(!n||!yi(s,l)){var l=s;o[i++]=0===a?0:a}}return o}function xt(e){return"number"==typeof e?e:Li(e)?aa:+e}function Ft(e){if("string"==typeof e)return e;if(Si(e))return Vs(e,Ft)+"";if(Li(e))return de?de.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Bt(e,t,n){var r=-1,i=Ls,o=e.length,a=!0,s=[],l=s;if(n)a=!1,i=Ns;else if(200<=o){var f=t?null:Pn(e);if(f)return hl(f);a=!1,i=il,l=new Ue}else l=t?[]:s;e:for(;++r<o;){var u=e[r],c=t?t(u):u;if(u=n||0!==u?u:0,a&&c==c){for(var d=l.length;d--;)if(l[d]===c)continue e;t&&l.push(c),s.push(u)}else i(l,c,n)||(l!==s&&l.push(c),s.push(u))}return s}function Lt(e,t){return null==(e=tr(e,t=Kt(t,e)))||delete e[pr(Er(t))]}function Nt(e,t,n,r){return Et(e,t,n(Ye(e,t)),r)}function Vt(e,t,n,r){for(var i=e.length,o=r?i:-1;(r?o--:++o<i)&&t(e[o],o,e););return n?kt(e,r?0:o,r?o+1:i):kt(e,r?o+1:0,r?i:o)}function jt(e,t){var n=e;return n instanceof ge&&(n=n.value()),qs(t,freeOnUnref(function(e,t){return t.func.apply(t.thisArg,js([e],t.args))}),n)}function qt(e,t,n){var r=e.length;if(r<2)return r?Bt(e[0]):[];for(var i=-1,o=w(r);++i<r;)for(var a=e[i],s=-1;++s<r;)s!=i&&(o[i]=Le(o[i]||a,e[s],t,n));return Bt(ze(o,1),t,n)}function Ht(e,t,n){for(var r=-1,i=e.length,o=t.length,a={};++r<i;){var s=r<o?t[r]:ta;n(a,e[r],s)}return a}function zt(e){return Pi(e)?e:[]}function Wt(e){return"function"==typeof e?e:Do}function Kt(e,t){return Si(e)?e:Qn(e,t)?[e]:dr(Qi(e))}var Gt=Pt;function Qt(e,t,n){var r=e.length;return n=n===ta?r:n,!t&&r<=n?e:kt(e,t,n)}var Xt=x||freeOnUnref(function(e){return Ms.clearTimeout(e)});function Yt(e,t){if(t)return e.slice();var n=e.length,r=b?b(n):new e.constructor(n);return e.copy(r),r}function Jt(e){var t=new e.constructor(e.byteLength);return new U(t).set(new U(e)),t}function Zt(e,t){var n=t?Jt(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function $t(e,t){if(e!==t){var n=e!==ta,r=null===e,i=e==e,o=Li(e),a=t!==ta,s=null===t,l=t==t,f=Li(t);if(!s&&!f&&!o&&t<e||o&&a&&l&&!s&&!f||r&&a&&l||!n&&l||!i)return 1;if(!r&&!o&&!f&&e<t||f&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!l)return-1}return 0}function en(e,t,n,r){for(var i=-1,o=e.length,a=n.length,s=-1,l=t.length,f=W(o-a,0),u=w(l+f),c=!r;++s<l;)u[s]=t[s];for(;++i<a;)(c||i<o)&&(u[n[i]]=e[i]);for(;f--;)u[s++]=e[i++];return u}function tn(e,t,n,r){for(var i=-1,o=e.length,a=-1,s=n.length,l=-1,f=t.length,u=W(o-s,0),c=w(u+f),d=!r;++i<u;)c[i]=e[i];for(var p=i;++l<f;)c[p+l]=t[l];for(;++a<s;)(d||i<o)&&(c[p+n[a]]=e[i++]);return c}function nn(e,t){var n=-1,r=e.length;for(t||(t=w(r));++n<r;)t[n]=e[n];return t}function rn(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=r?r(n[s],e[s],s,n,e):ta;l===ta&&(l=e[s]),i?Re(n,s,l):we(n,s,l)}return n}function on(i,o){return freeOnUnref(function(e,t){var n=Si(e)?As:ke,r=o?o():{};return n(e,i,Fn(t,2),r)})}function an(s){return Pt(freeOnUnref(function(e,t){var n=-1,r=t.length,i=1<r?t[r-1]:ta,o=2<r?t[2]:ta;for(i=3<s.length&&"function"==typeof i?(r--,i):ta,o&&Gn(t[0],t[1],o)&&(i=r<3?ta:i,r=1),e=M(e);++n<r;){var a=t[n];a&&s(e,a,n,i)}return e}))}function sn(o,a){return freeOnUnref(function(e,t){if(null==e)return e;if(!bi(e))return o(e,t);for(var n=e.length,r=a?n:-1,i=M(e);(a?r--:++r<n)&&!1!==t(i[r],r,i););return e})}function ln(l){return freeOnUnref(function(e,t,n){for(var r=-1,i=M(e),o=n(e),a=o.length;a--;){var s=o[l?a:++r];if(!1===t(i[s],s,i))break}return e})}function fn(i){return freeOnUnref(function(e){var t=ul(e=Qi(e))?yl(e):ta,n=t?t[0]:e.charAt(0),r=t?Qt(t,1).join(""):e.slice(1);return n[i]()+r})}function un(t){return freeOnUnref(function(e){return qs(wo(So(e).replace(hs,"")),t,"")})}function cn(r){return freeOnUnref(function(){var e=arguments;switch(e.length){case 0:return new r;case 1:return new r(e[0]);case 2:return new r(e[0],e[1]);case 3:return new r(e[0],e[1],e[2]);case 4:return new r(e[0],e[1],e[2],e[3]);case 5:return new r(e[0],e[1],e[2],e[3],e[4]);case 6:return new r(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new r(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var t=he(r.prototype),n=r.apply(t,e);return ki(n)?n:t})}function dn(a){return freeOnUnref(function(e,t,n){var r=M(e);if(!bi(e)){var i=Fn(t,3);e=so(e),t=function(e){return i(r[e],e,r)}}var o=a(e,t,n);return-1<o?r[i?e[o]:o]:ta})}function pn(l){return kn(freeOnUnref(function(i){var o=i.length,e=o,t=ye.prototype.thru;for(l&&i.reverse();e--;){var n=i[e];if("function"!=typeof n)throw new I(na);if(t&&!a&&"wrapper"==Dn(n))var a=new ye([],!0)}for(e=a?e:o;++e<o;){var r=Dn(n=i[e]),s="wrapper"==r?An(n):ta;a=s&&Xn(s[0])&&424==s[1]&&!s[4].length&&1==s[9]?a[Dn(s[0])].apply(a,s[3]):1==n.length&&Xn(n)?a[r]():a.thru(n)}return freeOnUnref(function(){var e=arguments,t=e[0];if(a&&1==e.length&&Si(t))return a.plant(t).value();for(var n=0,r=o?i[n].apply(this,e):t;++n<o;)r=i[n].call(this,r);return r})}))}function hn(f,u,c,d,p,h,m,y,g,v){var O=128&u,S=1&u,U=2&u,b=24&u,P=512&u,M=U?ta:cn(f);return function e(){for(var t=arguments.length,n=w(t),r=t;r--;)n[r]=arguments[r];if(b)var i=xn(e),o=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(n,i);if(d&&(n=en(n,d,p,b)),h&&(n=tn(n,h,m,b)),t-=o,b&&t<v){var a=pl(n,i);return Un(f,u,hn,e.placeholder,c,n,a,y,g,v-t)}var s=S?c:this,l=U?s[f]:f;return t=n.length,y?n=function(e,t){for(var n=e.length,r=K(t.length,n),i=nn(e);r--;){var o=t[r];e[r]=Kn(o,n)?i[o]:ta}return e}(n,y):P&&1<t&&n.reverse(),O&&g<t&&(n.length=g),this&&this!==Ms&&this instanceof e&&(l=M||cn(l)),l.apply(s,n)}}function mn(a,s){return freeOnUnref(function(e,t){return n=e,r=a,i=s(t),o={},Ge(n,freeOnUnref(function(e,t,n){r(o,i(e),t,n)})),o;var n,r,i,o})}function yn(r,i){return freeOnUnref(function(e,t){var n;if(e===ta&&t===ta)return i;if(e!==ta&&(n=e),t!==ta){if(n===ta)return t;"string"==typeof e||"string"==typeof t?(e=Ft(e),t=Ft(t)):(e=xt(e),t=xt(t)),n=r(e,t)}return n})}function gn(r){return kn(freeOnUnref(function(e){return e=Vs(e,nl(Fn())),Pt(freeOnUnref(function(t){var n=this;return r(e,freeOnUnref(function(e){return Rs(e,n,t)}))}))}))}function vn(e,t){var n=(t=t===ta?" ":Ft(t)).length;if(n<2)return n?bt(t,e):t;var r=bt(t,L(e/ml(t)));return ul(t)?Qt(yl(r),0,e).join(""):r.slice(0,e)}function On(r){return freeOnUnref(function(e,t,n){return n&&"number"!=typeof n&&Gn(e,t,n)&&(t=n=ta),e=Hi(e),t===ta?(t=e,e=0):t=Hi(t),function(e,t,n,r){for(var i=-1,o=W(L((t-e)/(n||1)),0),a=w(o);o--;)a[r?o:++i]=e,e+=n;return a}(e,t,n=n===ta?e<t?1:-1:Hi(n),r)})}function Sn(n){return freeOnUnref(function(e,t){return"string"==typeof e&&"string"==typeof t||(e=Ki(e),t=Ki(t)),n(e,t)})}function Un(e,t,n,r,i,o,a,s,l,f){var u=8&t;t|=u?32:64,4&(t&=~(u?64:32))||(t&=-4);var c=[e,t,i,u?o:ta,u?a:ta,u?ta:o,u?ta:a,s,l,f],d=n.apply(ta,c);return Xn(e)&&rr(d,c),d.placeholder=r,ar(d,e,t)}function bn(e){var r=i[e];return freeOnUnref(function(e,t){if(e=Ki(e),(t=null==t?0:K(zi(t),292))&&q(e)){var n=(Qi(e)+"e").split("e");return+((n=(Qi(r(n[0]+"e"+(+n[1]+t)))+"e").split("e"))[0]+"e"+(+n[1]-t))}return r(e)})}var Pn=ee&&1/hl(new ee([,-0]))[1]==1/0?freeOnUnref(function(e){return new ee(e)}):No;function Mn(a){return freeOnUnref(function(e){var t,n,r,i,o=qn(e);return o==ya?cl(e):o==Ua?(t=e,n=-1,r=Array(t.size),t.forEach(freeOnUnref(function(e){r[++n]=[e,e]})),r):Vs(a(i=e),freeOnUnref(function(e){return[e,i[e]]}))})}function Cn(e,t,n,r,i,o,a,s){var l=2&t;if(!l&&"function"!=typeof e)throw new I(na);var f=r?r.length:0;if(f||(t&=-97,r=i=ta),a=a===ta?a:W(zi(a),0),s=s===ta?s:zi(s),f-=i?i.length:0,64&t){var u=r,c=i;r=i=ta}var d,p,h,m,y,g,v,O,S,U,b,P,M,C=l?ta:An(e),E=[e,t,n,r,i,u,c,o,a,s];if(C&&function(e,t){var n=e[1],r=t[1],i=n|r,o=i<131,a=128==r&&8==n||128==r&&256==n&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(o||a){1&r&&(e[2]=t[2],i|=1&n?0:4);var s=t[3];if(s){var l=e[3];e[3]=l?en(l,s,t[4]):s,e[4]=l?pl(e[3],ia):t[4]}(s=t[5])&&(l=e[5],e[5]=l?tn(l,s,t[6]):s,e[6]=l?pl(e[5],ia):t[6]),(s=t[7])&&(e[7]=s),128&r&&(e[8]=null==e[8]?t[8]:K(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}}(E,C),e=E[0],t=E[1],n=E[2],r=E[3],i=E[4],!(s=E[9]=E[9]===ta?l?0:e.length:W(E[9]-f,0))&&24&t&&(t&=-25),t&&1!=t)8==t||16==t?(v=t,O=s,S=cn(g=e),T=function e(){for(var t=arguments.length,n=w(t),r=t,i=xn(e);r--;)n[r]=arguments[r];var o=t<3&&n[0]!==i&&n[t-1]!==i?[]:pl(n,i);return(t-=o.length)<O?Un(g,v,hn,e.placeholder,ta,n,o,ta,ta,O-t):Rs(this&&this!==Ms&&this instanceof e?S:g,this,n)}):32!=t&&33!=t||i.length?T=hn.apply(ta,E):(p=n,h=r,m=1&t,y=cn(d=e),T=function e(){for(var t=-1,n=arguments.length,r=-1,i=h.length,o=w(i+n),a=this&&this!==Ms&&this instanceof e?y:d;++r<i;)o[r]=h[r];for(;n--;)o[r++]=arguments[++t];return Rs(a,m?p:this,o)});else var T=(b=n,P=1&t,M=cn(U=e),function e(){return(this&&this!==Ms&&this instanceof e?M:U).apply(P?b:this,arguments)});return ar((C?Tt:rr)(T,E),e,t)}function En(e,t,n,r){return e===ta||yi(e,c[n])&&!C.call(r,n)?t:e}function Tn(e,t,n,r,i,o){return ki(e)&&ki(t)&&(o.set(t,e),mt(e,t,ta,Tn,o),o.delete(t)),e}function wn(e){return Di(e)?ta:e}function In(e,t,n,r,i,o){var a=1&n,s=e.length,l=t.length;if(s!=l&&!(a&&s<l))return!1;var f=o.get(e),u=o.get(t);if(f&&u)return f==t&&u==e;var c=-1,d=!0,p=2&n?new Ue:ta;for(o.set(e,t),o.set(t,e);++c<s;){var h=e[c],m=t[c];if(r)var y=a?r(m,h,c,t,e,o):r(h,m,c,e,t,o);if(y!==ta){if(y)continue;d=!1;break}if(p){if(!zs(t,freeOnUnref(function(e,t){if(!il(p,t)&&(h===e||i(h,e,n,r,o)))return p.push(t)}))){d=!1;break}}else if(h!==m&&!i(h,m,n,r,o)){d=!1;break}}return o.delete(e),o.delete(t),d}function kn(e){return or(er(e,ta,Ur),e+"")}function _n(e){return Je(e,so,Vn)}function Rn(e){return Je(e,lo,jn)}var An=re?freeOnUnref(function(e){return re.get(e)}):No;function Dn(e){for(var t=e.name+"",n=ie[t],r=C.call(ie,t)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function xn(e){return(C.call(pe,"placeholder")?pe:e).placeholder}function Fn(){var e=pe.iteratee||xo;return e=e===xo?lt:e,arguments.length?e(arguments[0],arguments[1]):e}function Bn(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function Ln(e){for(var t=so(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Zn(i)]}return t}function Nn(e,t){var n,r,i=(r=t,null==(n=e)?ta:n[r]);return st(i)?i:ta}var Vn=V?freeOnUnref(function(t){return null==t?[]:(t=M(t),Bs(V(t),freeOnUnref(function(e){return T.call(t,e)})))}):Ko,jn=V?freeOnUnref(function(e){for(var t=[];e;)js(t,Vn(e)),e=P(e);return t}):Ko,qn=Ze;function Hn(e,t,n){for(var r=-1,i=(t=Kt(t,e)).length,o=!1;++r<i;){var a=pr(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&Ii(i)&&Kn(a,i)&&(Si(e)||Oi(e))}function zn(e){return"function"!=typeof e.constructor||Jn(e)?{}:he(P(e))}function Wn(e){return Si(e)||Oi(e)||!!(_&&e&&e[_])}function Kn(e,t){var n=typeof e;return!!(t=null==t?oa:t)&&("number"==n||"symbol"!=n&&us.test(e))&&-1<e&&e%1==0&&e<t}function Gn(e,t,n){if(!ki(n))return!1;var r=typeof t;return!!("number"==r?bi(n)&&Kn(t,n.length):"string"==r&&t in n)&&yi(n[t],e)}function Qn(e,t){if(Si(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Li(e))||Ga.test(e)||!Ka.test(e)||null!=t&&e in M(t)}function Xn(e){var t=Dn(e),n=pe[t];if("function"!=typeof n||!(t in ge.prototype))return!1;if(e===n)return!0;var r=An(n);return!!r&&e===r[0]}(J&&qn(new J(new ArrayBuffer(1)))!=Ea||Z&&qn(new Z)!=ya||$&&qn($.resolve())!=Oa||ee&&qn(new ee)!=Ua||te&&qn(new te)!=Ma)&&(qn=freeOnUnref(function(e){var t=Ze(e),n=t==va?e.constructor:ta,r=n?hr(n):"";if(r)switch(r){case oe:return Ea;case ae:return ya;case se:return Oa;case le:return Ua;case fe:return Ma}return t}));var Yn=a?Ti:Go;function Jn(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||c)}function Zn(e){return e==e&&!ki(e)}function $n(t,n){return freeOnUnref(function(e){return null!=e&&e[t]===n&&(n!==ta||t in M(e))})}function er(o,a,s){return a=W(a===ta?o.length-1:a,0),freeOnUnref(function(){for(var e=arguments,t=-1,n=W(e.length-a,0),r=w(n);++t<n;)r[t]=e[a+t];t=-1;for(var i=w(a+1);++t<a;)i[t]=e[t];return i[a]=s(r),Rs(o,this,i)})}function tr(e,t){return t.length<2?e:Ye(e,kt(t,0,-1))}function nr(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var rr=sr(Tt),ir=B||freeOnUnref(function(e,t){return Ms.setTimeout(e,t)}),or=sr(wt);function ar(e,t,n){var r,i,o,a=t+"";return or(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(1<n?"& ":"")+t[r],t=t.join(2<n?", ":" "),e.replace(Za,"{\n/* [wrapped with "+t+"] */\n")}(a,(o=a.match($a),r=o?o[1].split(es):[],i=n,Ds(la,freeOnUnref(function(e){var t="_."+e[0];i&e[1]&&!Ls(r,t)&&r.push(t)})),r.sort())))}function sr(n){var r=0,i=0;return freeOnUnref(function(){var e=G(),t=16-(e-i);if(i=e,0<t){if(800<=++r)return arguments[0]}else r=0;return n.apply(ta,arguments)})}function lr(e,t){var n=-1,r=e.length,i=r-1;for(t=t===ta?r:t;++n<t;){var o=Ut(n,i),a=e[o];e[o]=e[n],e[n]=a}return e.length=t,e}var fr,ur,cr,dr=(fr=freeOnUnref(function(e){var i=[];return 46===e.charCodeAt(0)&&i.push(""),e.replace(Qa,freeOnUnref(function(e,t,n,r){i.push(n?r.replace(rs,"$1"):t||e)})),i}),cr=(ur=ui(fr,freeOnUnref(function(e){return 500===cr.size&&cr.clear(),e}))).cache,ur);function pr(e){if("string"==typeof e||Li(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function hr(e){if(null!=e){try{return s.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function mr(e){if(e instanceof ge)return e.clone();var t=new ye(e.__wrapped__,e.__chain__);return t.__actions__=nn(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var yr=Pt(freeOnUnref(function(e,t){return Pi(e)?Le(e,ze(t,1,Pi,!0)):[]})),gr=Pt(freeOnUnref(function(e,t){var n=Er(t);return Pi(n)&&(n=ta),Pi(e)?Le(e,ze(t,1,Pi,!0),Fn(n,2)):[]})),vr=Pt(freeOnUnref(function(e,t){var n=Er(t);return Pi(n)&&(n=ta),Pi(e)?Le(e,ze(t,1,Pi,!0),ta,n):[]}));function Or(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:zi(n);return i<0&&(i=W(r+i,0)),Ks(e,Fn(t,3),i)}function Sr(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r-1;return n!==ta&&(i=zi(n),i=n<0?W(r+i,0):K(i,r-1)),Ks(e,Fn(t,3),i,!0)}function Ur(e){return null!=e&&e.length?ze(e,1):[]}function br(e){return e&&e.length?e[0]:ta}var Pr=Pt(freeOnUnref(function(e){var t=Vs(e,zt);return t.length&&t[0]===e[0]?nt(t):[]})),Mr=Pt(freeOnUnref(function(e){var t=Er(e),n=Vs(e,zt);return t===Er(n)?t=ta:n.pop(),n.length&&n[0]===e[0]?nt(n,Fn(t,2)):[]})),Cr=Pt(freeOnUnref(function(e){var t=Er(e),n=Vs(e,zt);return(t="function"==typeof t?t:ta)&&n.pop(),n.length&&n[0]===e[0]?nt(n,ta,t):[]}));function Er(e){var t=null==e?0:e.length;return t?e[t-1]:ta}var Tr=Pt(wr);function wr(e,t){return e&&e.length&&t&&t.length?Ot(e,t):e}var Ir=kn(freeOnUnref(function(e,t){var n=null==e?0:e.length,r=Ae(e,t);return St(e,Vs(t,freeOnUnref(function(e){return Kn(e,n)?+e:e})).sort($t)),r}));function kr(e){return null==e?e:Y.call(e)}var _r=Pt(freeOnUnref(function(e){return Bt(ze(e,1,Pi,!0))})),Rr=Pt(freeOnUnref(function(e){var t=Er(e);return Pi(t)&&(t=ta),Bt(ze(e,1,Pi,!0),Fn(t,2))})),Ar=Pt(freeOnUnref(function(e){var t=Er(e);return t="function"==typeof t?t:ta,Bt(ze(e,1,Pi,!0),ta,t)}));function Dr(t){if(!t||!t.length)return[];var n=0;return t=Bs(t,freeOnUnref(function(e){if(Pi(e))return n=W(e.length,n),!0})),el(n,freeOnUnref(function(e){return Vs(t,Js(e))}))}function xr(e,t){if(!e||!e.length)return[];var n=Dr(e);return null==t?n:Vs(n,freeOnUnref(function(e){return Rs(t,ta,e)}))}var Fr=Pt(freeOnUnref(function(e,t){return Pi(e)?Le(e,t):[]})),Br=Pt(freeOnUnref(function(e){return qt(Bs(e,Pi))})),Lr=Pt(freeOnUnref(function(e){var t=Er(e);return Pi(t)&&(t=ta),qt(Bs(e,Pi),Fn(t,2))})),Nr=Pt(freeOnUnref(function(e){var t=Er(e);return t="function"==typeof t?t:ta,qt(Bs(e,Pi),ta,t)})),Vr=Pt(Dr);var jr=Pt(freeOnUnref(function(e){var t=e.length,n=1<t?e[t-1]:ta;return xr(e,n="function"==typeof n?(e.pop(),n):ta)}));function qr(e){var t=pe(e);return t.__chain__=!0,t}function Hr(e,t){return t(e)}var zr=kn(freeOnUnref(function(t){var n=t.length,e=n?t[0]:0,r=this.__wrapped__,i=freeOnUnref(function(e){return Ae(e,t)});return!(1<n||this.__actions__.length)&&r instanceof ge&&Kn(e)?((r=r.slice(e,+e+(n?1:0))).__actions__.push({func:Hr,args:[i],thisArg:ta}),new ye(r,this.__chain__).thru(freeOnUnref(function(e){return n&&!e.length&&e.push(ta),e}))):this.thru(i)}));var Wr=on(freeOnUnref(function(e,t,n){C.call(e,n)?++e[n]:Re(e,n,1)}));var Kr=dn(Or),Gr=dn(Sr);function Qr(e,t){return(Si(e)?Ds:Ne)(e,Fn(t,3))}function Xr(e,t){return(Si(e)?xs:Ve)(e,Fn(t,3))}var Yr=on(freeOnUnref(function(e,t,n){C.call(e,n)?e[n].push(t):Re(e,n,[t])}));var Jr=Pt(freeOnUnref(function(e,t,n){var r=-1,i="function"==typeof t,o=bi(e)?w(e.length):[];return Ne(e,freeOnUnref(function(e){o[++r]=i?Rs(t,e,n):rt(e,t,n)})),o})),Zr=on(freeOnUnref(function(e,t,n){Re(e,n,t)}));function $r(e,t){return(Si(e)?Vs:dt)(e,Fn(t,3))}var ei=on(freeOnUnref(function(e,t,n){e[n?0:1].push(t)}),freeOnUnref(function(){return[[],[]]}));var ti=Pt(freeOnUnref(function(e,t){if(null==e)return[];var n=t.length;return 1<n&&Gn(e,t[0],t[1])?t=[]:2<n&&Gn(t[0],t[1],t[2])&&(t=[t[0]]),gt(e,ze(t,1),[])})),ni=F||freeOnUnref(function(){return Ms.Date.now()});function ri(e,t,n){return t=n?ta:t,t=e&&null==t?e.length:t,Cn(e,128,ta,ta,ta,ta,t)}function ii(e,t){var n;if("function"!=typeof t)throw new I(na);return e=zi(e),freeOnUnref(function(){return 0<--e&&(n=t.apply(this,arguments)),e<=1&&(t=ta),n})}var oi=Pt(freeOnUnref(function(e,t,n){var r=1;if(n.length){var i=pl(n,xn(oi));r|=32}return Cn(e,r,t,n,i)})),ai=Pt(freeOnUnref(function(e,t,n){var r=3;if(n.length){var i=pl(n,xn(ai));r|=32}return Cn(t,r,e,n,i)}));function si(r,i,e){var o,a,s,l,f,u,c=0,d=!1,p=!1,t=!0;if("function"!=typeof r)throw new I(na);function h(e){var t=o,n=a;return o=a=ta,c=e,l=r.apply(n,t)}function m(e){var t=e-u;return u===ta||i<=t||t<0||p&&s<=e-c}function y(){var e,t,n=ni();if(m(n))return g(n);f=ir(y,(t=i-((e=n)-u),p?K(t,s-(e-c)):t))}function g(e){return f=ta,t&&o?h(e):(o=a=ta,l)}function n(){var e,t=ni(),n=m(t);if(o=arguments,a=this,u=t,n){if(f===ta)return c=e=u,f=ir(y,i),d?h(e):l;if(p)return Xt(f),f=ir(y,i),h(u)}return f===ta&&(f=ir(y,i)),l}return i=Ki(i)||0,ki(e)&&(d=!!e.leading,s=(p="maxWait"in e)?W(Ki(e.maxWait)||0,i):s,t="trailing"in e?!!e.trailing:t),n.cancel=function(){f!==ta&&Xt(f),c=0,o=u=a=f=ta},n.flush=function(){return f===ta?l:g(ni())},n}var li=Pt(freeOnUnref(function(e,t){return Be(e,1,t)})),fi=Pt(freeOnUnref(function(e,t,n){return Be(e,Ki(t)||0,n)}));function ui(i,o){if("function"!=typeof i||null!=o&&"function"!=typeof o)throw new I(na);var a=freeOnUnref(function(){var e=arguments,t=o?o.apply(this,e):e[0],n=a.cache;if(n.has(t))return n.get(t);var r=i.apply(this,e);return a.cache=n.set(t,r)||n,r});return a.cache=new(ui.Cache||Se),a}function ci(t){if("function"!=typeof t)throw new I(na);return freeOnUnref(function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)})}ui.Cache=Se;var di=Gt(freeOnUnref(function(r,i){var o=(i=1==i.length&&Si(i[0])?Vs(i[0],nl(Fn())):Vs(ze(i,1),nl(Fn()))).length;return Pt(freeOnUnref(function(e){for(var t=-1,n=K(e.length,o);++t<n;)e[t]=i[t].call(this,e[t]);return Rs(r,this,e)}))})),pi=Pt(freeOnUnref(function(e,t){var n=pl(t,xn(pi));return Cn(e,32,ta,t,n)})),hi=Pt(freeOnUnref(function(e,t){var n=pl(t,xn(hi));return Cn(e,64,ta,t,n)})),mi=kn(freeOnUnref(function(e,t){return Cn(e,256,ta,ta,ta,t)}));function yi(e,t){return e===t||e!=e&&t!=t}var gi=Sn($e),vi=Sn(freeOnUnref(function(e,t){return t<=e})),Oi=it(freeOnUnref(function(){return arguments})())?it:freeOnUnref(function(e){return _i(e)&&C.call(e,"callee")&&!T.call(e,"callee")}),Si=w.isArray,Ui=Es?nl(Es):function(e){return _i(e)&&Ze(e)==Ca};function bi(e){return null!=e&&Ii(e.length)&&!Ti(e)}function Pi(e){return _i(e)&&bi(e)}var Mi=j||Go,Ci=Ts?nl(Ts):function(e){return _i(e)&&Ze(e)==da};function Ei(e){if(!_i(e))return!1;var t=Ze(e);return t==pa||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!Di(e)}function Ti(e){if(!ki(e))return!1;var t=Ze(e);return t==ha||t==ma||"[object AsyncFunction]"==t||"[object Proxy]"==t}function wi(e){return"number"==typeof e&&e==zi(e)}function Ii(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=oa}function ki(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function _i(e){return null!=e&&"object"==typeof e}var Ri=ws?nl(ws):function(e){return _i(e)&&qn(e)==ya};function Ai(e){return"number"==typeof e||_i(e)&&Ze(e)==ga}function Di(e){if(!_i(e)||Ze(e)!=va)return!1;var t=P(e);if(null===t)return!0;var n=C.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&s.call(n)==p}var xi=Is?nl(Is):function(e){return _i(e)&&Ze(e)==Sa};var Fi=ks?nl(ks):function(e){return _i(e)&&qn(e)==Ua};function Bi(e){return"string"==typeof e||!Si(e)&&_i(e)&&Ze(e)==ba}function Li(e){return"symbol"==typeof e||_i(e)&&Ze(e)==Pa}var Ni=_s?nl(_s):function(e){return _i(e)&&Ii(e.length)&&!!Ss[Ze(e)]};var Vi=Sn(ct),ji=Sn(freeOnUnref(function(e,t){return e<=t}));function qi(e){if(!e)return[];if(bi(e))return Bi(e)?yl(e):nn(e);if(R&&e[R])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[R]());var t=qn(e);return(t==ya?cl:t==Ua?hl:go)(e)}function Hi(e){return e?(e=Ki(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function zi(e){var t=Hi(e),n=t%1;return t==t?n?t-n:t:0}function Wi(e){return e?De(zi(e),0,sa):0}function Ki(e){if("number"==typeof e)return e;if(Li(e))return aa;if(ki(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ki(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=tl(e);var n=ss.test(e);return n||fs.test(e)?Ps(e.slice(2),n?2:8):as.test(e)?aa:+e}function Gi(e){return rn(e,lo(e))}function Qi(e){return null==e?"":Ft(e)}var Xi=an(freeOnUnref(function(e,t){if(Jn(t)||bi(t))rn(t,so(t),e);else for(var n in t)C.call(t,n)&&we(e,n,t[n])})),Yi=an(freeOnUnref(function(e,t){rn(t,lo(t),e)})),Ji=an(freeOnUnref(function(e,t,n,r){rn(t,lo(t),e,r)})),Zi=an(freeOnUnref(function(e,t,n,r){rn(t,so(t),e,r)})),$i=kn(Ae);var eo=Pt(freeOnUnref(function(e,t){e=M(e);var n=-1,r=t.length,i=2<r?t[2]:ta;for(i&&Gn(t[0],t[1],i)&&(r=1);++n<r;)for(var o=t[n],a=lo(o),s=-1,l=a.length;++s<l;){var f=a[s],u=e[f];(u===ta||yi(u,c[f])&&!C.call(e,f))&&(e[f]=o[f])}return e})),to=Pt(freeOnUnref(function(e){return e.push(ta,Tn),Rs(uo,ta,e)}));function no(e,t,n){var r=null==e?ta:Ye(e,t);return r===ta?n:r}function ro(e,t){return null!=e&&Hn(e,t,tt)}var io=mn(freeOnUnref(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=d.call(t)),e[t]=n}),_o(Do)),oo=mn(freeOnUnref(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=d.call(t)),C.call(e,t)?e[t].push(n):e[t]=[n]}),Fn),ao=Pt(rt);function so(e){return bi(e)?Pe(e):ft(e)}function lo(e){return bi(e)?Pe(e,!0):ut(e)}var fo=an(freeOnUnref(function(e,t,n){mt(e,t,n)})),uo=an(freeOnUnref(function(e,t,n,r){mt(e,t,n,r)})),co=kn(freeOnUnref(function(t,e){var n={};if(null==t)return n;var r=!1;e=Vs(e,freeOnUnref(function(e){return e=Kt(e,t),r||(r=1<e.length),e})),rn(t,Rn(t),n),r&&(n=xe(n,7,wn));for(var i=e.length;i--;)Lt(n,e[i]);return n}));var po=kn(freeOnUnref(function(e,t){return null==e?{}:vt(n=e,t,freeOnUnref(function(e,t){return ro(n,t)}));var n}));function ho(e,n){if(null==e)return{};var t=Vs(Rn(e),freeOnUnref(function(e){return[e]}));return n=Fn(n),vt(e,t,freeOnUnref(function(e,t){return n(e,t[0])}))}var mo=Mn(so),yo=Mn(lo);function go(e){return null==e?[]:rl(e,so(e))}var vo=un(freeOnUnref(function(e,t,n){return t=t.toLowerCase(),e+(n?Oo(t):t)}));function Oo(e){return To(Qi(e).toLowerCase())}function So(e){return(e=Qi(e))&&e.replace(cs,sl).replace(ms,"")}var Uo=un(freeOnUnref(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),bo=un(freeOnUnref(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),Po=fn("toLowerCase");var Mo=un(freeOnUnref(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}));var Co=un(freeOnUnref(function(e,t,n){return e+(n?" ":"")+To(t)}));var Eo=un(freeOnUnref(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),To=fn("toUpperCase");function wo(e,t,n){return e=Qi(e),(t=n?ta:t)===ta?(r=e,gs.test(r)?e.match(ys)||[]:e.match(ts)||[]):e.match(t)||[];var r}var Io=Pt(freeOnUnref(function(e,t){try{return Rs(e,ta,t)}catch(e){return Ei(e)?e:new y(e)}})),ko=kn(freeOnUnref(function(t,e){return Ds(e,freeOnUnref(function(e){e=pr(e),Re(t,e,oi(t[e],t))})),t}));function _o(e){return freeOnUnref(function(){return e})}var Ro=pn(),Ao=pn(!0);function Do(e){return e}function xo(e){return lt("function"==typeof e?e:xe(e,1))}var Fo=Pt(freeOnUnref(function(t,n){return freeOnUnref(function(e){return rt(e,t,n)})})),Bo=Pt(freeOnUnref(function(t,n){return freeOnUnref(function(e){return rt(t,e,n)})}));function Lo(r,t,e){var n=so(t),i=Xe(t,n);null!=e||ki(t)&&(i.length||!n.length)||(e=t,t=r,r=this,i=Xe(t,so(t)));var o=!(ki(e)&&"chain"in e&&!e.chain),a=Ti(r);return Ds(i,freeOnUnref(function(e){var n=t[e];r[e]=n,a&&(r.prototype[e]=freeOnUnref(function(){var e=this.__chain__;if(o||e){var t=r(this.__wrapped__);return(t.__actions__=nn(this.__actions__)).push({func:n,args:arguments,thisArg:r}),t.__chain__=e,t}return n.apply(r,js([this.value()],arguments))}))})),r}function No(){}var Vo=gn(Vs),jo=gn(Fs),qo=gn(zs);function Ho(e){return Qn(e)?Js(pr(e)):(t=e,freeOnUnref(function(e){return Ye(e,t)}));var t}var zo=On(),Wo=On(!0);function Ko(){return[]}function Go(){return!1}var Qo=yn(freeOnUnref(function(e,t){return e+t}),0),Xo=bn("ceil"),Yo=yn(freeOnUnref(function(e,t){return e/t}),1),Jo=bn("floor");var Zo=yn(freeOnUnref(function(e,t){return e*t}),1),$o=bn("round"),ea=yn(freeOnUnref(function(e,t){return e-t}),0);return pe.after=function(e,t){if("function"!=typeof t)throw new I(na);return e=zi(e),freeOnUnref(function(){if(--e<1)return t.apply(this,arguments)})},pe.ary=ri,pe.assign=Xi,pe.assignIn=Yi,pe.assignInWith=Ji,pe.assignWith=Zi,pe.at=$i,pe.before=ii,pe.bind=oi,pe.bindAll=ko,pe.bindKey=ai,pe.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Si(e)?e:[e]},pe.chain=qr,pe.chunk=function(e,t,n){t=(n?Gn(e,t,n):t===ta)?1:W(zi(t),0);var r=null==e?0:e.length;if(!r||t<1)return[];for(var i=0,o=0,a=w(L(r/t));i<r;)a[o++]=kt(e,i,i+=t);return a},pe.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i},pe.concat=function(){var e=arguments.length;if(!e)return[];for(var t=w(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return js(Si(n)?nn(n):[n],ze(t,1))},pe.cond=function(r){var i=null==r?0:r.length,t=Fn();return r=i?Vs(r,freeOnUnref(function(e){if("function"!=typeof e[1])throw new I(na);return[t(e[0]),e[1]]})):[],Pt(freeOnUnref(function(e){for(var t=-1;++t<i;){var n=r[t];if(Rs(n[0],this,e))return Rs(n[1],this,e)}}))},pe.conforms=function(e){return t=xe(e,1),n=so(t),freeOnUnref(function(e){return Fe(e,t,n)});var t,n},pe.constant=_o,pe.countBy=Wr,pe.create=function(e,t){var n=he(e);return null==t?n:_e(n,t)},pe.curry=function e(t,n,r){var i=Cn(t,8,ta,ta,ta,ta,ta,n=r?ta:n);return i.placeholder=e.placeholder,i},pe.curryRight=function e(t,n,r){var i=Cn(t,16,ta,ta,ta,ta,ta,n=r?ta:n);return i.placeholder=e.placeholder,i},pe.debounce=si,pe.defaults=eo,pe.defaultsDeep=to,pe.defer=li,pe.delay=fi,pe.difference=yr,pe.differenceBy=gr,pe.differenceWith=vr,pe.drop=function(e,t,n){var r=null==e?0:e.length;return r?kt(e,(t=n||t===ta?1:zi(t))<0?0:t,r):[]},pe.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?kt(e,0,(t=r-(t=n||t===ta?1:zi(t)))<0?0:t):[]},pe.dropRightWhile=function(e,t){return e&&e.length?Vt(e,Fn(t,3),!0,!0):[]},pe.dropWhile=function(e,t){return e&&e.length?Vt(e,Fn(t,3),!0):[]},pe.fill=function(e,t,n,r){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&Gn(e,t,n)&&(n=0,r=i),function(e,t,n,r){var i=e.length;for((n=zi(n))<0&&(n=i<-n?0:i+n),(r=r===ta||i<r?i:zi(r))<0&&(r+=i),r=r<n?0:Wi(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},pe.filter=function(e,t){return(Si(e)?Bs:He)(e,Fn(t,3))},pe.flatMap=function(e,t){return ze($r(e,t),1)},pe.flatMapDeep=function(e,t){return ze($r(e,t),1/0)},pe.flatMapDepth=function(e,t,n){return n=n===ta?1:zi(n),ze($r(e,t),n)},pe.flatten=Ur,pe.flattenDeep=function(e){return null!=e&&e.length?ze(e,1/0):[]},pe.flattenDepth=function(e,t){return null!=e&&e.length?ze(e,t=t===ta?1:zi(t)):[]},pe.flip=function(e){return Cn(e,512)},pe.flow=Ro,pe.flowRight=Ao,pe.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},pe.functions=function(e){return null==e?[]:Xe(e,so(e))},pe.functionsIn=function(e){return null==e?[]:Xe(e,lo(e))},pe.groupBy=Yr,pe.initial=function(e){return null!=e&&e.length?kt(e,0,-1):[]},pe.intersection=Pr,pe.intersectionBy=Mr,pe.intersectionWith=Cr,pe.invert=io,pe.invertBy=oo,pe.invokeMap=Jr,pe.iteratee=xo,pe.keyBy=Zr,pe.keys=so,pe.keysIn=lo,pe.map=$r,pe.mapKeys=function(e,r){var i={};return r=Fn(r,3),Ge(e,freeOnUnref(function(e,t,n){Re(i,r(e,t,n),e)})),i},pe.mapValues=function(e,r){var i={};return r=Fn(r,3),Ge(e,freeOnUnref(function(e,t,n){Re(i,t,r(e,t,n))})),i},pe.matches=function(e){return pt(xe(e,1))},pe.matchesProperty=function(e,t){return ht(e,xe(t,1))},pe.memoize=ui,pe.merge=fo,pe.mergeWith=uo,pe.method=Fo,pe.methodOf=Bo,pe.mixin=Lo,pe.negate=ci,pe.nthArg=function(t){return t=zi(t),Pt(freeOnUnref(function(e){return yt(e,t)}))},pe.omit=co,pe.omitBy=function(e,t){return ho(e,ci(Fn(t)))},pe.once=function(e){return ii(2,e)},pe.orderBy=function(e,t,n,r){return null==e?[]:(Si(t)||(t=null==t?[]:[t]),Si(n=r?ta:n)||(n=null==n?[]:[n]),gt(e,t,n))},pe.over=Vo,pe.overArgs=di,pe.overEvery=jo,pe.overSome=qo,pe.partial=pi,pe.partialRight=hi,pe.partition=ei,pe.pick=po,pe.pickBy=ho,pe.property=Ho,pe.propertyOf=function(t){return freeOnUnref(function(e){return null==t?ta:Ye(t,e)})},pe.pull=Tr,pe.pullAll=wr,pe.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?Ot(e,t,Fn(n,2)):e},pe.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?Ot(e,t,ta,n):e},pe.pullAt=Ir,pe.range=zo,pe.rangeRight=Wo,pe.rearg=mi,pe.reject=function(e,t){return(Si(e)?Bs:He)(e,ci(Fn(t,3)))},pe.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],o=e.length;for(t=Fn(t,3);++r<o;){var a=e[r];t(a,r,e)&&(n.push(a),i.push(r))}return St(e,i),n},pe.rest=function(e,t){if("function"!=typeof e)throw new I(na);return Pt(e,t=t===ta?t:zi(t))},pe.reverse=kr,pe.sampleSize=function(e,t,n){return t=(n?Gn(e,t,n):t===ta)?1:zi(t),(Si(e)?Ce:Ct)(e,t)},pe.set=function(e,t,n){return null==e?e:Et(e,t,n)},pe.setWith=function(e,t,n,r){return r="function"==typeof r?r:ta,null==e?e:Et(e,t,n,r)},pe.shuffle=function(e){return(Si(e)?Ee:It)(e)},pe.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&Gn(e,t,n)?(t=0,n=r):(t=null==t?0:zi(t),n=n===ta?r:zi(n)),kt(e,t,n)):[]},pe.sortBy=ti,pe.sortedUniq=function(e){return e&&e.length?Dt(e):[]},pe.sortedUniqBy=function(e,t){return e&&e.length?Dt(e,Fn(t,2)):[]},pe.split=function(e,t,n){return n&&"number"!=typeof n&&Gn(e,t,n)&&(t=n=ta),(n=n===ta?sa:n>>>0)?(e=Qi(e))&&("string"==typeof t||null!=t&&!xi(t))&&!(t=Ft(t))&&ul(e)?Qt(yl(e),0,n):e.split(t,n):[]},pe.spread=function(r,i){if("function"!=typeof r)throw new I(na);return i=null==i?0:W(zi(i),0),Pt(freeOnUnref(function(e){var t=e[i],n=Qt(e,0,i);return t&&js(n,t),Rs(r,this,n)}))},pe.tail=function(e){var t=null==e?0:e.length;return t?kt(e,1,t):[]},pe.take=function(e,t,n){return e&&e.length?kt(e,0,(t=n||t===ta?1:zi(t))<0?0:t):[]},pe.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?kt(e,(t=r-(t=n||t===ta?1:zi(t)))<0?0:t,r):[]},pe.takeRightWhile=function(e,t){return e&&e.length?Vt(e,Fn(t,3),!1,!0):[]},pe.takeWhile=function(e,t){return e&&e.length?Vt(e,Fn(t,3)):[]},pe.tap=function(e,t){return t(e),e},pe.throttle=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new I(na);return ki(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),si(e,t,{leading:r,maxWait:t,trailing:i})},pe.thru=Hr,pe.toArray=qi,pe.toPairs=mo,pe.toPairsIn=yo,pe.toPath=function(e){return Si(e)?Vs(e,pr):Li(e)?[e]:nn(dr(Qi(e)))},pe.toPlainObject=Gi,pe.transform=function(e,r,i){var t=Si(e),n=t||Mi(e)||Ni(e);if(r=Fn(r,4),null==i){var o=e&&e.constructor;i=n?t?new o:[]:ki(e)&&Ti(o)?he(P(e)):{}}return(n?Ds:Ge)(e,freeOnUnref(function(e,t,n){return r(i,e,t,n)})),i},pe.unary=function(e){return ri(e,1)},pe.union=_r,pe.unionBy=Rr,pe.unionWith=Ar,pe.uniq=function(e){return e&&e.length?Bt(e):[]},pe.uniqBy=function(e,t){return e&&e.length?Bt(e,Fn(t,2)):[]},pe.uniqWith=function(e,t){return t="function"==typeof t?t:ta,e&&e.length?Bt(e,ta,t):[]},pe.unset=function(e,t){return null==e||Lt(e,t)},pe.unzip=Dr,pe.unzipWith=xr,pe.update=function(e,t,n){return null==e?e:Nt(e,t,Wt(n))},pe.updateWith=function(e,t,n,r){return r="function"==typeof r?r:ta,null==e?e:Nt(e,t,Wt(n),r)},pe.values=go,pe.valuesIn=function(e){return null==e?[]:rl(e,lo(e))},pe.without=Fr,pe.words=wo,pe.wrap=function(e,t){return pi(Wt(t),e)},pe.xor=Br,pe.xorBy=Lr,pe.xorWith=Nr,pe.zip=Vr,pe.zipObject=function(e,t){return Ht(e||[],t||[],we)},pe.zipObjectDeep=function(e,t){return Ht(e||[],t||[],Et)},pe.zipWith=jr,pe.entries=mo,pe.entriesIn=yo,pe.extend=Yi,pe.extendWith=Ji,Lo(pe,pe),pe.add=Qo,pe.attempt=Io,pe.camelCase=vo,pe.capitalize=Oo,pe.ceil=Xo,pe.clamp=function(e,t,n){return n===ta&&(n=t,t=ta),n!==ta&&(n=(n=Ki(n))==n?n:0),t!==ta&&(t=(t=Ki(t))==t?t:0),De(Ki(e),t,n)},pe.clone=function(e){return xe(e,4)},pe.cloneDeep=function(e){return xe(e,5)},pe.cloneDeepWith=function(e,t){return xe(e,5,t="function"==typeof t?t:ta)},pe.cloneWith=function(e,t){return xe(e,4,t="function"==typeof t?t:ta)},pe.conformsTo=function(e,t){return null==t||Fe(e,t,so(t))},pe.deburr=So,pe.defaultTo=function(e,t){return null==e||e!=e?t:e},pe.divide=Yo,pe.endsWith=function(e,t,n){e=Qi(e),t=Ft(t);var r=e.length,i=n=n===ta?r:De(zi(n),0,r);return 0<=(n-=t.length)&&e.slice(n,i)==t},pe.eq=yi,pe.escape=function(e){return(e=Qi(e))&&qa.test(e)?e.replace(Va,ll):e},pe.escapeRegExp=function(e){return(e=Qi(e))&&Ya.test(e)?e.replace(Xa,"\\$&"):e},pe.every=function(e,t,n){var r=Si(e)?Fs:je;return n&&Gn(e,t,n)&&(t=ta),r(e,Fn(t,3))},pe.find=Kr,pe.findIndex=Or,pe.findKey=function(e,t){return Ws(e,Fn(t,3),Ge)},pe.findLast=Gr,pe.findLastIndex=Sr,pe.findLastKey=function(e,t){return Ws(e,Fn(t,3),Qe)},pe.floor=Jo,pe.forEach=Qr,pe.forEachRight=Xr,pe.forIn=function(e,t){return null==e?e:We(e,Fn(t,3),lo)},pe.forInRight=function(e,t){return null==e?e:Ke(e,Fn(t,3),lo)},pe.forOwn=function(e,t){return e&&Ge(e,Fn(t,3))},pe.forOwnRight=function(e,t){return e&&Qe(e,Fn(t,3))},pe.get=no,pe.gt=gi,pe.gte=vi,pe.has=function(e,t){return null!=e&&Hn(e,t,et)},pe.hasIn=ro,pe.head=br,pe.identity=Do,pe.includes=function(e,t,n,r){e=bi(e)?e:go(e),n=n&&!r?zi(n):0;var i=e.length;return n<0&&(n=W(i+n,0)),Bi(e)?n<=i&&-1<e.indexOf(t,n):!!i&&-1<Gs(e,t,n)},pe.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:zi(n);return i<0&&(i=W(r+i,0)),Gs(e,t,i)},pe.inRange=function(e,t,n){return t=Hi(t),n===ta?(n=t,t=0):n=Hi(n),e=Ki(e),(r=e)>=K(i=t,o=n)&&r<W(i,o);var r,i,o},pe.invoke=ao,pe.isArguments=Oi,pe.isArray=Si,pe.isArrayBuffer=Ui,pe.isArrayLike=bi,pe.isArrayLikeObject=Pi,pe.isBoolean=function(e){return!0===e||!1===e||_i(e)&&Ze(e)==ca},pe.isBuffer=Mi,pe.isDate=Ci,pe.isElement=function(e){return _i(e)&&1===e.nodeType&&!Di(e)},pe.isEmpty=function(e){if(null==e)return!0;if(bi(e)&&(Si(e)||"string"==typeof e||"function"==typeof e.splice||Mi(e)||Ni(e)||Oi(e)))return!e.length;var t=qn(e);if(t==ya||t==Ua)return!e.size;if(Jn(e))return!ft(e).length;for(var n in e)if(C.call(e,n))return!1;return!0},pe.isEqual=function(e,t){return ot(e,t)},pe.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:ta)?n(e,t):ta;return r===ta?ot(e,t,ta,n):!!r},pe.isError=Ei,pe.isFinite=function(e){return"number"==typeof e&&q(e)},pe.isFunction=Ti,pe.isInteger=wi,pe.isLength=Ii,pe.isMap=Ri,pe.isMatch=function(e,t){return e===t||at(e,t,Ln(t))},pe.isMatchWith=function(e,t,n){return n="function"==typeof n?n:ta,at(e,t,Ln(t),n)},pe.isNaN=function(e){return Ai(e)&&e!=+e},pe.isNative=function(e){if(Yn(e))throw new y("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return st(e)},pe.isNil=function(e){return null==e},pe.isNull=function(e){return null===e},pe.isNumber=Ai,pe.isObject=ki,pe.isObjectLike=_i,pe.isPlainObject=Di,pe.isRegExp=xi,pe.isSafeInteger=function(e){return wi(e)&&-oa<=e&&e<=oa},pe.isSet=Fi,pe.isString=Bi,pe.isSymbol=Li,pe.isTypedArray=Ni,pe.isUndefined=function(e){return e===ta},pe.isWeakMap=function(e){return _i(e)&&qn(e)==Ma},pe.isWeakSet=function(e){return _i(e)&&"[object WeakSet]"==Ze(e)},pe.join=function(e,t){return null==e?"":H.call(e,t)},pe.kebabCase=Uo,pe.last=Er,pe.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r;return n!==ta&&(i=(i=zi(n))<0?W(r+i,0):K(i,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,i):Ks(e,Xs,i,!0)},pe.lowerCase=bo,pe.lowerFirst=Po,pe.lt=Vi,pe.lte=ji,pe.max=function(e){return e&&e.length?qe(e,Do,$e):ta},pe.maxBy=function(e,t){return e&&e.length?qe(e,Fn(t,2),$e):ta},pe.mean=function(e){return Ys(e,Do)},pe.meanBy=function(e,t){return Ys(e,Fn(t,2))},pe.min=function(e){return e&&e.length?qe(e,Do,ct):ta},pe.minBy=function(e,t){return e&&e.length?qe(e,Fn(t,2),ct):ta},pe.stubArray=Ko,pe.stubFalse=Go,pe.stubObject=function(){return{}},pe.stubString=function(){return""},pe.stubTrue=function(){return!0},pe.multiply=Zo,pe.nth=function(e,t){return e&&e.length?yt(e,zi(t)):ta},pe.noConflict=function(){return Ms._===this&&(Ms._=h),this},pe.noop=No,pe.now=ni,pe.pad=function(e,t,n){e=Qi(e);var r=(t=zi(t))?ml(e):0;if(!t||t<=r)return e;var i=(t-r)/2;return vn(N(i),n)+e+vn(L(i),n)},pe.padEnd=function(e,t,n){e=Qi(e);var r=(t=zi(t))?ml(e):0;return t&&r<t?e+vn(t-r,n):e},pe.padStart=function(e,t,n){e=Qi(e);var r=(t=zi(t))?ml(e):0;return t&&r<t?vn(t-r,n)+e:e},pe.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),Q(Qi(e).replace(Ja,""),t||0)},pe.random=function(e,t,n){if(n&&"boolean"!=typeof n&&Gn(e,t,n)&&(t=n=ta),n===ta&&("boolean"==typeof t?(n=t,t=ta):"boolean"==typeof e&&(n=e,e=ta)),e===ta&&t===ta?(e=0,t=1):(e=Hi(e),t===ta?(t=e,e=0):t=Hi(t)),t<e){var r=e;e=t,t=r}if(n||e%1||t%1){var i=X();return K(e+i*(t-e+bs("1e-"+((i+"").length-1))),t)}return Ut(e,t)},pe.reduce=function(e,t,n){var r=Si(e)?qs:Zs,i=arguments.length<3;return r(e,Fn(t,4),n,i,Ne)},pe.reduceRight=function(e,t,n){var r=Si(e)?Hs:Zs,i=arguments.length<3;return r(e,Fn(t,4),n,i,Ve)},pe.repeat=function(e,t,n){return t=(n?Gn(e,t,n):t===ta)?1:zi(t),bt(Qi(e),t)},pe.replace=function(){var e=arguments,t=Qi(e[0]);return e.length<3?t:t.replace(e[1],e[2])},pe.result=function(e,t,n){var r=-1,i=(t=Kt(t,e)).length;for(i||(i=1,e=ta);++r<i;){var o=null==e?ta:e[pr(t[r])];o===ta&&(r=i,o=n),e=Ti(o)?o.call(e):o}return e},pe.round=$o,pe.runInContext=e,pe.sample=function(e){return(Si(e)?Me:Mt)(e)},pe.size=function(e){if(null==e)return 0;if(bi(e))return Bi(e)?ml(e):e.length;var t=qn(e);return t==ya||t==Ua?e.size:ft(e).length},pe.snakeCase=Mo,pe.some=function(e,t,n){var r=Si(e)?zs:_t;return n&&Gn(e,t,n)&&(t=ta),r(e,Fn(t,3))},pe.sortedIndex=function(e,t){return Rt(e,t)},pe.sortedIndexBy=function(e,t,n){return At(e,t,Fn(n,2))},pe.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=Rt(e,t);if(r<n&&yi(e[r],t))return r}return-1},pe.sortedLastIndex=function(e,t){return Rt(e,t,!0)},pe.sortedLastIndexBy=function(e,t,n){return At(e,t,Fn(n,2),!0)},pe.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=Rt(e,t,!0)-1;if(yi(e[n],t))return n}return-1},pe.startCase=Co,pe.startsWith=function(e,t,n){return e=Qi(e),n=null==n?0:De(zi(n),0,e.length),t=Ft(t),e.slice(n,n+t.length)==t},pe.subtract=ea,pe.sum=function(e){return e&&e.length?$s(e,Do):0},pe.sumBy=function(e,t){return e&&e.length?$s(e,Fn(t,2)):0},pe.template=function(a,e,t){var n=pe.templateSettings;t&&Gn(a,e,t)&&(e=ta),a=Qi(a),e=Ji({},e,n,En);var s,l,r=Ji({},e.imports,n.imports,En),i=so(r),o=rl(r,i),f=0,u=e.interpolate||ds,c="__p += '",d=v((e.escape||ds).source+"|"+u.source+"|"+(u===Wa?is:ds).source+"|"+(e.evaluate||ds).source+"|$","g"),p="//# sourceURL="+(C.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Os+"]")+"\n";a.replace(d,freeOnUnref(function(e,t,n,r,i,o){return n||(n=r),c+=a.slice(f,o).replace(ps,fl),t&&(s=!0,c+="' +\n__e("+t+") +\n'"),i&&(l=!0,c+="';\n"+i+";\n__p += '"),n&&(c+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),f=o+e.length,e})),c+="';\n";var h=C.call(e,"variable")&&e.variable;if(h){if(ns.test(h))throw new y("Invalid `variable` option passed into `_.template`")}else c="with (obj) {\n"+c+"\n}\n";c=(l?c.replace(Fa,""):c).replace(Ba,"$1").replace(La,"$1;"),c="function("+(h||"obj")+") {\n"+(h?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(l?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+c+"return __p\n}";var m=Io(freeOnUnref(function(){return g(i,p+"return "+c).apply(ta,o)}));if(m.source=c,Ei(m))throw m;return m},pe.times=function(e,t){if((e=zi(e))<1||oa<e)return[];var n=sa,r=K(e,sa);t=Fn(t),e-=sa;for(var i=el(r,t);++n<e;)t(n);return i},pe.toFinite=Hi,pe.toInteger=zi,pe.toLength=Wi,pe.toLower=function(e){return Qi(e).toLowerCase()},pe.toNumber=Ki,pe.toSafeInteger=function(e){return e?De(zi(e),-oa,oa):0===e?e:0},pe.toString=Qi,pe.toUpper=function(e){return Qi(e).toUpperCase()},pe.trim=function(e,t,n){if((e=Qi(e))&&(n||t===ta))return tl(e);if(!e||!(t=Ft(t)))return e;var r=yl(e),i=yl(t);return Qt(r,ol(r,i),al(r,i)+1).join("")},pe.trimEnd=function(e,t,n){if((e=Qi(e))&&(n||t===ta))return e.slice(0,gl(e)+1);if(!e||!(t=Ft(t)))return e;var r=yl(e);return Qt(r,0,al(r,yl(t))+1).join("")},pe.trimStart=function(e,t,n){if((e=Qi(e))&&(n||t===ta))return e.replace(Ja,"");if(!e||!(t=Ft(t)))return e;var r=yl(e);return Qt(r,ol(r,yl(t))).join("")},pe.truncate=function(e,t){var n=30,r="...";if(ki(t)){var i="separator"in t?t.separator:i;n="length"in t?zi(t.length):n,r="omission"in t?Ft(t.omission):r}var o=(e=Qi(e)).length;if(ul(e)){var a=yl(e);o=a.length}if(o<=n)return e;var s=n-ml(r);if(s<1)return r;var l=a?Qt(a,0,s).join(""):e.slice(0,s);if(i===ta)return l+r;if(a&&(s+=l.length-s),xi(i)){if(e.slice(s).search(i)){var f,u=l;for(i.global||(i=v(i.source,Qi(os.exec(i))+"g")),i.lastIndex=0;f=i.exec(u);)var c=f.index;l=l.slice(0,c===ta?s:c)}}else if(e.indexOf(Ft(i),s)!=s){var d=l.lastIndexOf(i);-1<d&&(l=l.slice(0,d))}return l+r},pe.unescape=function(e){return(e=Qi(e))&&ja.test(e)?e.replace(Na,vl):e},pe.uniqueId=function(e){var t=++l;return Qi(e)+t},pe.upperCase=Eo,pe.upperFirst=To,pe.each=Qr,pe.eachRight=Xr,pe.first=br,Lo(pe,freeOnUnref(function(){var n={};return Ge(pe,freeOnUnref(function(e,t){C.call(pe.prototype,t)||(n[t]=e)})),n})(),{chain:!1}),pe.VERSION="4.17.21",Ds(["bind","bindKey","curry","curryRight","partial","partialRight"],freeOnUnref(function(e){pe[e].placeholder=pe})),Ds(["drop","take"],freeOnUnref(function(n,r){ge.prototype[n]=freeOnUnref(function(e){e=e===ta?1:W(zi(e),0);var t=this.__filtered__&&!r?new ge(this):this.clone();return t.__filtered__?t.__takeCount__=K(e,t.__takeCount__):t.__views__.push({size:K(e,sa),type:n+(t.__dir__<0?"Right":"")}),t}),ge.prototype[n+"Right"]=freeOnUnref(function(e){return this.reverse()[n](e).reverse()})})),Ds(["filter","map","takeWhile"],freeOnUnref(function(e,t){var n=t+1,r=1==n||3==n;ge.prototype[e]=freeOnUnref(function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Fn(e,3),type:n}),t.__filtered__=t.__filtered__||r,t})})),Ds(["head","last"],freeOnUnref(function(e,t){var n="take"+(t?"Right":"");ge.prototype[e]=freeOnUnref(function(){return this[n](1).value()[0]})})),Ds(["initial","tail"],freeOnUnref(function(e,t){var n="drop"+(t?"":"Right");ge.prototype[e]=freeOnUnref(function(){return this.__filtered__?new ge(this):this[n](1)})})),ge.prototype.compact=freeOnUnref(function(){return this.filter(Do)}),ge.prototype.find=freeOnUnref(function(e){return this.filter(e).head()}),ge.prototype.findLast=freeOnUnref(function(e){return this.reverse().find(e)}),ge.prototype.invokeMap=Pt(freeOnUnref(function(t,n){return"function"==typeof t?new ge(this):this.map(freeOnUnref(function(e){return rt(e,t,n)}))})),ge.prototype.reject=freeOnUnref(function(e){return this.filter(ci(Fn(e)))}),ge.prototype.slice=freeOnUnref(function(e,t){e=zi(e);var n=this;return n.__filtered__&&(0<e||t<0)?new ge(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==ta&&(n=(t=zi(t))<0?n.dropRight(-t):n.take(t-e)),n)}),ge.prototype.takeRightWhile=freeOnUnref(function(e){return this.reverse().takeWhile(e).reverse()}),ge.prototype.toArray=freeOnUnref(function(){return this.take(sa)}),Ge(ge.prototype,freeOnUnref(function(c,e){var d=/^(?:filter|find|map|reject)|While$/.test(e),p=/^(?:head|last)$/.test(e),h=pe[p?"take"+("last"==e?"Right":""):e],m=p||/^find/.test(e);h&&(pe.prototype[e]=freeOnUnref(function(){var e=this.__wrapped__,n=p?[1]:arguments,t=e instanceof ge,r=n[0],i=t||Si(e),o=freeOnUnref(function(e){var t=h.apply(pe,js([e],n));return p&&a?t[0]:t});i&&d&&"function"==typeof r&&1!=r.length&&(t=i=!1);var a=this.__chain__,s=!!this.__actions__.length,l=m&&!a,f=t&&!s;if(!m&&i){e=f?e:new ge(this);var u=c.apply(e,n);return u.__actions__.push({func:Hr,args:[o],thisArg:ta}),new ye(u,a)}return l&&f?c.apply(this,n):(u=this.thru(o),l?p?u.value()[0]:u.value():u)}))})),Ds(["pop","push","shift","sort","splice","unshift"],freeOnUnref(function(e){var n=o[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);pe.prototype[e]=freeOnUnref(function(){var t=arguments;if(i&&!this.__chain__){var e=this.value();return n.apply(Si(e)?e:[],t)}return this[r](freeOnUnref(function(e){return n.apply(Si(e)?e:[],t)}))})})),Ge(ge.prototype,freeOnUnref(function(e,t){var n=pe[t];if(n){var r=n.name+"";C.call(ie,r)||(ie[r]=[]),ie[r].push({name:t,func:n})}})),ie[hn(ta,2).name]=[{name:"wrapper",func:ta}],ge.prototype.clone=function(){var e=new ge(this.__wrapped__);return e.__actions__=nn(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=nn(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=nn(this.__views__),e},ge.prototype.reverse=function(){if(this.__filtered__){var e=new ge(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},ge.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Si(e),r=t<0,i=n?e.length:0,o=function(e,t,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=K(t,e+a);break;case"takeRight":e=W(e,t-a)}}return{start:e,end:t}}(0,i,this.__views__),a=o.start,s=o.end,l=s-a,f=r?s:a-1,u=this.__iteratees__,c=u.length,d=0,p=K(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return jt(e,this.__actions__);var h=[];e:for(;l--&&d<p;){for(var m=-1,y=e[f+=t];++m<c;){var g=u[m],v=g.iteratee,O=g.type,S=v(y);if(2==O)y=S;else if(!S){if(1==O)continue e;break e}}h[d++]=y}return h},pe.prototype.at=zr,pe.prototype.chain=function(){return qr(this)},pe.prototype.commit=function(){return new ye(this.value(),this.__chain__)},pe.prototype.next=function(){this.__values__===ta&&(this.__values__=qi(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?ta:this.__values__[this.__index__++]}},pe.prototype.plant=function(e){for(var t,n=this;n instanceof me;){var r=mr(n);r.__index__=0,r.__values__=ta,t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t},pe.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof ge){var t=e;return this.__actions__.length&&(t=new ge(this)),(t=t.reverse()).__actions__.push({func:Hr,args:[kr],thisArg:ta}),new ye(t,this.__chain__)}return this.thru(kr)},pe.prototype.toJSON=pe.prototype.valueOf=pe.prototype.value=function(){return jt(this.__wrapped__,this.__actions__)},pe.prototype.first=pe.prototype.head,R&&(pe.prototype[R]=function(){return this}),pe}();x?((x.exports=Ol)._=Ol,D._=Ol):Ms._=Ol}).call(ce)})),u=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.Js="DefaultJs",e.JsNoYield="DefaultJsNoYield",e.Lua="DefaultLua",e.Wasm="DefaultWasm"})(t.VmLanguageType||(t.VmLanguageType={})),freeOnUnref(function(e){e.Duktape="Duktape",e.DuktapeNoYield="DuktapeNoYield",e.QuickJs="QuickJs",e.Hermes="Hermes",e.JsCore="JSCore",e.JerryScript="JerryScript",e.SpiderMonkey="SpiderMonkey",e.Wamr="Wamr",e.Wasm3="Wasm3",e.WasmTime="WasmTime"})(t.VmEngineType||(t.VmEngineType={})),freeOnUnref(function(e){e[e.TMP=0]="TMP",e[e.CACHE=1]="CACHE",e[e.PROGRAM_ASSETS=2]="PROGRAM_ASSETS",e[e.IN_MEMORY=3]="IN_MEMORY"})(t.NativeStorageType||(t.NativeStorageType={})),freeOnUnref(function(e){e[e.OK=0]="OK",e[e.UNKNOWN=1]="UNKNOWN",e[e.ACCESS_DENIED=2]="ACCESS_DENIED",e[e.FILE_DOES_NOT_EXIST=3]="FILE_DOES_NOT_EXIST",e[e.FILE_ALREADY_EXISTS=4]="FILE_ALREADY_EXISTS",e[e.NOT_ENOUGH_SPACE=5]="NOT_ENOUGH_SPACE",e[e.NOT_AVAILABLE=6]="NOT_AVAILABLE",e[e.END_OF_FILE=7]="END_OF_FILE",e[e.FORBIDDEN_CHAR_IN_NAME=8]="FORBIDDEN_CHAR_IN_NAME",e[e.INVALID_STORAGE_TYPE=9]="INVALID_STORAGE_TYPE",e[e.RESOURCE_TEMPORARILY_UNAVAILABLE=10]="RESOURCE_TEMPORARILY_UNAVAILABLE",e[e.FILE_DESCRIPTOR_ERROR=11]="FILE_DESCRIPTOR_ERROR",e[e.DEVICE_OR_RESOURCE_BUSY=12]="DEVICE_OR_RESOURCE_BUSY",e[e.FILE_TOO_LARGE=13]="FILE_TOO_LARGE",e[e.INVALID_ARGUMENT=14]="INVALID_ARGUMENT",e[e.IO_ERROR=15]="IO_ERROR",e[e.IS_A_DIRECTORY=16]="IS_A_DIRECTORY",e[e.TOO_MANY_SYMBOLIC_LINK_LEVELS=17]="TOO_MANY_SYMBOLIC_LINK_LEVELS",e[e.TOO_MANY_FILES_OPEN=18]="TOO_MANY_FILES_OPEN",e[e.TOO_MANY_LINKS=19]="TOO_MANY_LINKS",e[e.FILE_NAME_TOO_LONG=20]="FILE_NAME_TOO_LONG",e[e.NO_BUFFER_SPACE=21]="NO_BUFFER_SPACE",e[e.NO_SUCH_DEVICE=22]="NO_SUCH_DEVICE",e[e.NOT_ENOUGH_MEMORY=23]="NOT_ENOUGH_MEMORY",e[e.NO_SPACE_ON_DEVICE=24]="NO_SPACE_ON_DEVICE",e[e.NOT_A_DIRECTORY=25]="NOT_A_DIRECTORY",e[e.DIRECTORY_NOT_EMPTY=26]="DIRECTORY_NOT_EMPTY",e[e.VALUE_TOO_LARGE=27]="VALUE_TOO_LARGE",e[e.READ_ONLY_FILE_SYSTEM=28]="READ_ONLY_FILE_SYSTEM",e[e.TEXT_FILE_BUSY=29]="TEXT_FILE_BUSY",e[e.BROKEN_PIPE=30]="BROKEN_PIPE",e[e.FILE_COMPRESSION_TYPE_NOT_SUPPORTED=31]="FILE_COMPRESSION_TYPE_NOT_SUPPORTED",e[e.FILE_CLOSED=32]="FILE_CLOSED",e[e.FILE_TYPE_MISMATCH=999]="FILE_TYPE_MISMATCH"})(t.StorageErrorCode||(t.StorageErrorCode={})),freeOnUnref(function(e){e.DuktapeNoYield="DuktapeNoYield",e.Duktape="Duktape"})(t.ScriptEngineType||(t.ScriptEngineType={}))}));e(u);u.VmLanguageType,u.VmEngineType,u.NativeStorageType,u.StorageErrorCode,u.ScriptEngineType;var c=t(freeOnUnref(function(e,t){function n(){return"undefined"==typeof Native?void 0:Native}Object.defineProperty(t,"__esModule",{value:!0}),t.NativeStorageType=u.NativeStorageType,t.StorageErrorCode=u.StorageErrorCode,t.VmLanguageType=u.VmLanguageType,t.tryGetNative=n,t.tryGetVmManager=function(){return"undefined"==typeof VmManager?void 0:VmManager};var r=function(){var e=n();if(void 0===e)return!1;if("function"!=typeof e.GetScriptEngineType)return!0;var t=e.GetScriptEngineType();return t===u.ScriptEngineType.Duktape||t===u.ScriptEngineType.DuktapeNoYield}();t.isRunningOnDuktape=r;var i="undefined"!=typeof Native&&"function"==typeof Native.UNF_Get_Context;t.isUNFSupported=i}));e(c);c.NativeStorageType,c.StorageErrorCode,c.VmLanguageType,c.tryGetNative,c.tryGetVmManager,c.isRunningOnDuktape,c.isUNFSupported;var de=t(freeOnUnref(function(f){freeOnUnref(function(e){var n,s={};s.VERSION="1.4.1";var r={},t=freeOnUnref(function(e,t){return freeOnUnref(function(){return t.apply(e,arguments)})}),i=freeOnUnref(function(){var e,t,n=arguments,r=n[0];for(t=1;t<n.length;t++)for(e in n[t])e in r||!n[t].hasOwnProperty(e)||(r[e]=n[t][e]);return r}),o=freeOnUnref(function(e,t){return{value:e,name:t}});s.DEBUG=o(1,"DEBUG"),s.INFO=o(2,"INFO"),s.TIME=o(3,"TIME"),s.WARN=o(4,"WARN"),s.ERROR=o(8,"ERROR"),s.OFF=o(99,"OFF");var a=freeOnUnref(function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info});a.prototype={setLevel:freeOnUnref(function(e){e&&"value"in e&&(this.context.filterLevel=e)}),getLevel:freeOnUnref(function(){return this.context.filterLevel}),enabledFor:freeOnUnref(function(e){var t=this.context.filterLevel;return e.value>=t.value}),debug:freeOnUnref(function(){this.invoke(s.DEBUG,arguments)}),info:freeOnUnref(function(){this.invoke(s.INFO,arguments)}),warn:freeOnUnref(function(){this.invoke(s.WARN,arguments)}),error:freeOnUnref(function(){this.invoke(s.ERROR,arguments)}),time:freeOnUnref(function(e){"string"==typeof e&&0<e.length&&this.invoke(s.TIME,[e,"start"])}),timeEnd:freeOnUnref(function(e){"string"==typeof e&&0<e.length&&this.invoke(s.TIME,[e,"end"])}),invoke:freeOnUnref(function(e,t){n&&this.enabledFor(e)&&n(t,i({level:e},this.context))})};var l=new a({filterLevel:s.OFF});freeOnUnref(function(){var e=s;e.enabledFor=t(l,l.enabledFor),e.debug=t(l,l.debug),e.time=t(l,l.time),e.timeEnd=t(l,l.timeEnd),e.info=t(l,l.info),e.warn=t(l,l.warn),e.error=t(l,l.error),e.log=e.info})(),s.setHandler=freeOnUnref(function(handler){n=freeOnUnref(function(args,ctx){if(__HOMEBREW_DEBUG_LOGS){var msg="["+ctx.name+"] "+Array.prototype.slice.call(args).join(" ");try{if(typeof Native!=="undefined"&&typeof Native.HTTP_CreateHandler==="function"){var h=Native.HTTP_CreateHandler("POST","http://"+__HOMEBREW_DEBUG_LOGS_ENDPOINT+"/log");Native.HTTP_AddHeader(h,"content-type","text/plain; charset=utf-8");Native.HTTP_SendAsync(h,msg)}}catch(e){}}return handler(args,ctx)})}),s.setLevel=freeOnUnref(function(e){for(var t in l.setLevel(e),r)r.hasOwnProperty(t)&&r[t].setLevel(e)}),s.getLevel=freeOnUnref(function(){return l.getLevel()}),s.get=freeOnUnref(function(e){return r[e]||(r[e]=new a(i({name:e},l.context)))}),s.createDefaultHandler=freeOnUnref(function(i){(i=i||{}).formatter=i.formatter||function(e,t){t.name&&e.unshift("["+t.name+"]")};var o={},a=freeOnUnref(function(e,t){Function.prototype.apply.call(e,console,t)});return"undefined"==typeof console?freeOnUnref(function(){}):freeOnUnref(function(e,t){e=Array.prototype.slice.call(e);var n,r=console.log;t.level===s.TIME?(n=(t.name?"["+t.name+"] ":"")+e[0],"start"===e[1]?console.time?console.time(n):o[n]=(new Date).getTime():console.timeEnd?console.timeEnd(n):a(r,[n+": "+((new Date).getTime()-o[n])+"ms"])):(t.level===s.WARN&&console.warn?r=console.warn:t.level===s.ERROR&&console.error?r=console.error:t.level===s.INFO&&console.info?r=console.info:t.level===s.DEBUG&&console.debug&&(r=console.debug),i.formatter(e,t),a(r,e))})}),s.useDefaults=freeOnUnref(function(e){s.setLevel(e&&e.defaultLevel||s.DEBUG),s.setHandler(s.createDefaultHandler(e))}),f.exports?f.exports=s:(s._prevLogger=e.Logger,s.noConflict=freeOnUnref(function(){return e.Logger=s._prevLogger,s}),e.Logger=s)})(ce)})),p=t(freeOnUnref(function(e,t){var n,r,i,o;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.OK=0]="OK",e[e.INVALID_STATE=50001]="INVALID_STATE",e[e.INVALID_ARGUMENT=50005]="INVALID_ARGUMENT",e[e.NOT_IMPLEMENTED=50007]="NOT_IMPLEMENTED",e[e.NOT_INITIALIZED=50008]="NOT_INITIALIZED",e[e.ALREADY_INIT=50012]="ALREADY_INIT",e[e.IS_DESTROYED=50031]="IS_DESTROYED",e[e.KEY_NOT_FOUND=50040]="KEY_NOT_FOUND",e[e.VALUE_NOT_SUPPORTED=50041]="VALUE_NOT_SUPPORTED",e[e.SAMPLE_REF_COUNT_IS_NOT_ZERO=50045]="SAMPLE_REF_COUNT_IS_NOT_ZERO",e[e.BUFFER_FULL=50802]="BUFFER_FULL",e[e.NOT_READY_TO_RECEIVE_SAMPLES=50803]="NOT_READY_TO_RECEIVE_SAMPLES",e[e.DRM_INSUFFICIENT_PROTECTION=-2013069050]="DRM_INSUFFICIENT_PROTECTION",e[e.DRM_DISPLAY_DISCONNECTED=-2013069049]="DRM_DISPLAY_DISCONNECTED"})(t.MPBErrors||(t.MPBErrors={})),freeOnUnref(function(e){e[e.LICENSE_REQUEST=0]="LICENSE_REQUEST",e[e.LICENSE_RENEWAL=1]="LICENSE_RENEWAL",e[e.LICENSE_RELEASE=2]="LICENSE_RELEASE",e[e.INDIVIDUALIZATION_REQUEST=3]="INDIVIDUALIZATION_REQUEST"})(t.MMLDRMMessageType||(t.MMLDRMMessageType={})),freeOnUnref(function(e){e[e.MPB_END_OF_STREAM=0]="MPB_END_OF_STREAM",e[e.MPB_ERROR=1]="MPB_ERROR",e[e.MPB_BUFFER_UNDERRUN=2]="MPB_BUFFER_UNDERRUN",e[e.MPB_PLAYBACK_STARTED=3]="MPB_PLAYBACK_STARTED",e[e.MPB_READY_TO_PLAY=4]="MPB_READY_TO_PLAY",e[e.DRM_MESSAGE=5]="DRM_MESSAGE",e[e.MPB_PROPERTY_CHANGED=6]="MPB_PROPERTY_CHANGED",e[e.MPB_API_PROPERTY_CHANGED=7]="MPB_API_PROPERTY_CHANGED",e[e.DRM_ERROR=8]="DRM_ERROR"})(o=t.MediaEventTypes||(t.MediaEventTypes={})),t.MEDIA_EVENTS_MAP=((n={})[o.MPB_END_OF_STREAM]="end-of-stream",n[o.MPB_ERROR]="error",n[o.MPB_BUFFER_UNDERRUN]="buffer-underrun",n[o.MPB_PLAYBACK_STARTED]="playback-started",n[o.MPB_READY_TO_PLAY]="ready-to-play",n[o.MPB_PROPERTY_CHANGED]="property-changed",n),t.MEDIA_API_EVENTS_MAP=((r={})[o.MPB_API_PROPERTY_CHANGED]="api-property-changed",r),t.DRM_EVENT_MAP=((i={})[o.DRM_MESSAGE]="drm-message",i[o.DRM_ERROR]="drm-error",i),t.PLAYREADY_SYSTEM_NAME="com.microsoft.playready",t.WIDEVINE_SYSTEM_NAME="com.widevine.alpha",t.keySystemNames=[t.PLAYREADY_SYSTEM_NAME,t.WIDEVINE_SYSTEM_NAME],t.CENC_ENCRYPTION_SCHEME="cenc",t.CBCS_ENCRYPTION_SCHEME="cbcs",t.encryptionSchemes=[t.CENC_ENCRYPTION_SCHEME,t.CBCS_ENCRYPTION_SCHEME],t.SESSION_TYPE_PERSISTENT="persistent",t.SESSION_TYPE_NON_PERSISTENT="non-persistent",t.MML_CLIENT_FEATURE_FLAG="XP_MML_PLAYER",t.EXTERNAL_SURFACE_KEY="externalSurfaceKey",t.PICTURE_MODE_PROPERTY_KEY="pictureMode",freeOnUnref(function(e){e.audioMute="audioMute",e.audioVolume="audioVolume",e.displayAspectRatio="displayAspectRatio"})(t.MPBInstanceProperties||(t.MPBInstanceProperties={})),freeOnUnref(function(e){e.SMPTE_ST_2086="smpteSt2086",e.SMPTE_ST_2094_10="smpteSt2094-10",e.SMPTE_ST_2094_40="smpteSt2094-40"})(t.HdrMetadataType||(t.HdrMetadataType={})),freeOnUnref(function(e){e.SRGB="srgb",e.P_3="p3",e.REC_2020="rec2020"})(t.ColorGamut||(t.ColorGamut={})),freeOnUnref(function(e){e.SRGB="srgb",e.PQ="pq",e.HLG="hlg"})(t.TransferFunction||(t.TransferFunction={}))}));e(p);p.MPBErrors,p.MMLDRMMessageType,p.MediaEventTypes,p.MEDIA_EVENTS_MAP,p.MEDIA_API_EVENTS_MAP,p.DRM_EVENT_MAP,p.PLAYREADY_SYSTEM_NAME,p.WIDEVINE_SYSTEM_NAME,p.keySystemNames,p.CENC_ENCRYPTION_SCHEME,p.CBCS_ENCRYPTION_SCHEME,p.encryptionSchemes,p.SESSION_TYPE_PERSISTENT,p.SESSION_TYPE_NON_PERSISTENT,p.MML_CLIENT_FEATURE_FLAG,p.EXTERNAL_SURFACE_KEY,p.PICTURE_MODE_PROPERTY_KEY,p.MPBInstanceProperties,p.HdrMetadataType,p.ColorGamut,p.TransferFunction;var n=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("EventEmitter"),n=freeOnUnref(function(){function f(){this.timer=oe.timer,this.onCallbacks={},this.onceCallbacks={},this.idempotentEvents={},this.maxListeners=20}return f.onUnhandledEventListener=freeOnUnref(function(e){f.unhandledEventListenerCallback=e}),f.prototype.emitSync=freeOnUnref(function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.onCallbacks[t],i=this.onceCallbacks[t],o=[];r&&(o=o.concat(r)),i&&(o=o.concat(i),delete this.onceCallbacks[t]);for(var a=0,s=o;a<s.length;a++){var l=s[a];try{l.apply(void 0,e)}catch(e){u.error("UnhandledEventListenerError for '"+t+"' event:",e,"Stack:",e.stack),null!=f.unhandledEventListenerCallback&&f.unhandledEventListenerCallback(e,t.toString())}}}),f.prototype.emit=freeOnUnref(function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.timer.setImmediate(freeOnUnref(function(){return t.emitSync.apply(t,[e].concat(n))}))}),f.prototype.emitIdempotent=freeOnUnref(function(e){var t=this;null==this.idempotentEvents[e]&&(this.idempotentEvents[e]=!0,this.timer.setImmediate(freeOnUnref(function(){delete t.idempotentEvents[e],t.emitSync(e)})))}),f.prototype.off=freeOnUnref(function(e,t){var n=this.onCallbacks[e],r=this.onceCallbacks[e],i=!1;if(n){var o=n.length;this.inPlaceFilter(n,t),o!==n.length&&(i=!0),0===n.length&&delete this.onCallbacks[e]}r&&!i&&(this.inPlaceFilter(r,t),0===r.length&&delete this.onceCallbacks[e])}),f.prototype.on=freeOnUnref(function(e,t){var n=this.onCallbacks[e];n?(n.push(t),0<this.maxListeners&&n.length>=this.maxListeners+1&&u.warn('MaxListenersExceededWarning for event "'+e+" with "+n.length+' listeners"',(new Error).stack)):this.onCallbacks[e]=[t]}),f.prototype.once=freeOnUnref(function(e,t){var n=this.onceCallbacks[e];n?n.push(t):this.onceCallbacks[e]=[t]}),f.prototype.removeAllListeners=freeOnUnref(function(e){void 0===e&&(e=null),null===e?(this.onCallbacks={},this.onceCallbacks={}):(delete this.onCallbacks[e],delete this.onceCallbacks[e])}),f.prototype.setMaxListeners=freeOnUnref(function(e){this.maxListeners=e}),f.prototype.listeners=freeOnUnref(function(e){var t=this.onCallbacks[e],n=this.onceCallbacks[e],r=[];return t&&(r=r.concat(t)),n&&(r=r.concat(n)),r}),f.prototype.inPlaceFilter=freeOnUnref(function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t){e.splice(n,1);break}}),f})();t.EventEmitter=n}));e(n);n.EventEmitter;var r=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.events={},this.eventSource=e}return e.prototype.on=freeOnUnref(function(e,t){if(null!=this.events[e])throw new Error('this.events["'+e+'"] already exists');this.events[e]=t,this.eventSource.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){delete this.events[e],this.eventSource.off(e,t)}),e.prototype.removeAllListeners=freeOnUnref(function(){for(var e in this.events)this.events.hasOwnProperty(e)&&this.off(e,this.events[e])}),e})();t.EventTracker=n}));e(r);r.EventTracker;var x=t(freeOnUnref(function(q,H){freeOnUnref(function(){var e=this,t=e._,r=Array.prototype,a=Object.prototype,n=Function.prototype,i=r.push,l=r.slice,c=a.toString,o=a.hasOwnProperty,s=Array.isArray,f=Object.keys,u=n.bind,d=Object.create,p=freeOnUnref(function(){}),h=freeOnUnref(function(e){return e instanceof h?e:this instanceof h?void(this._wrapped=e):new h(e)});q.exports&&(H=q.exports=h),(H._=h).VERSION="1.8.3";var m=freeOnUnref(function(i,o,e){if(void 0===o)return i;switch(null==e?3:e){case 1:return freeOnUnref(function(e){return i.call(o,e)});case 2:return freeOnUnref(function(e,t){return i.call(o,e,t)});case 3:return freeOnUnref(function(e,t,n){return i.call(o,e,t,n)});case 4:return freeOnUnref(function(e,t,n,r){return i.call(o,e,t,n,r)})}return freeOnUnref(function(){return i.apply(o,arguments)})}),y=freeOnUnref(function(e,t,n){return null==e?h.identity:h.isFunction(e)?m(e,t,n):h.isObject(e)?h.matcher(e):h.property(e)});h.iteratee=freeOnUnref(function(e,t){return y(e,t,1/0)});var g=freeOnUnref(function(l,f){return freeOnUnref(function(e){var t=arguments.length;if(t<2||null==e)return e;for(var n=1;n<t;n++)for(var r=arguments[n],i=l(r),o=i.length,a=0;a<o;a++){var s=i[a];f&&void 0!==e[s]||(e[s]=r[s])}return e})}),v=freeOnUnref(function(e){if(!h.isObject(e))return{};if(d)return d(e);p.prototype=e;var t=new p;return p.prototype=null,t}),O=freeOnUnref(function(t){return freeOnUnref(function(e){return null==e?void 0:e[t]})}),S=Math.pow(2,53)-1,U=O("length"),b=freeOnUnref(function(e){var t=U(e);return"number"==typeof t&&0<=t&&t<=S});function P(s){return freeOnUnref(function(e,t,n,r){t=m(t,r,4);var i=!b(e)&&h.keys(e),o=(i||e).length,a=0<s?0:o-1;return arguments.length<3&&(n=e[i?i[a]:a],a+=s),function(e,t,n,r,i,o){for(;0<=i&&i<o;i+=s){var a=r?r[i]:i;n=t(n,e[a],a,e)}return n}(e,t,n,i,a,o)})}h.each=h.forEach=freeOnUnref(function(e,t,n){var r,i;if(t=m(t,n),b(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var o=h.keys(e);for(r=0,i=o.length;r<i;r++)t(e[o[r]],o[r],e)}return e}),h.map=h.collect=freeOnUnref(function(e,t,n){t=y(t,n);for(var r=!b(e)&&h.keys(e),i=(r||e).length,o=Array(i),a=0;a<i;a++){var s=r?r[a]:a;o[a]=t(e[s],s,e)}return o}),h.reduce=h.foldl=h.inject=P(1),h.reduceRight=h.foldr=P(-1),h.find=h.detect=freeOnUnref(function(e,t,n){var r;if(void 0!==(r=b(e)?h.findIndex(e,t,n):h.findKey(e,t,n))&&-1!==r)return e[r]}),h.filter=h.select=freeOnUnref(function(e,r,t){var i=[];return r=y(r,t),h.each(e,freeOnUnref(function(e,t,n){r(e,t,n)&&i.push(e)})),i}),h.reject=freeOnUnref(function(e,t,n){return h.filter(e,h.negate(y(t)),n)}),h.every=h.all=freeOnUnref(function(e,t,n){t=y(t,n);for(var r=!b(e)&&h.keys(e),i=(r||e).length,o=0;o<i;o++){var a=r?r[o]:o;if(!t(e[a],a,e))return!1}return!0}),h.some=h.any=freeOnUnref(function(e,t,n){t=y(t,n);for(var r=!b(e)&&h.keys(e),i=(r||e).length,o=0;o<i;o++){var a=r?r[o]:o;if(t(e[a],a,e))return!0}return!1}),h.contains=h.includes=h.include=freeOnUnref(function(e,t,n,r){return b(e)||(e=h.values(e)),("number"!=typeof n||r)&&(n=0),0<=h.indexOf(e,t,n)}),h.invoke=freeOnUnref(function(e,n){var r=l.call(arguments,2),i=h.isFunction(n);return h.map(e,freeOnUnref(function(e){var t=i?n:e[n];return null==t?t:t.apply(e,r)}))}),h.pluck=freeOnUnref(function(e,t){return h.map(e,h.property(t))}),h.where=freeOnUnref(function(e,t){return h.filter(e,h.matcher(t))}),h.findWhere=freeOnUnref(function(e,t){return h.find(e,h.matcher(t))}),h.max=freeOnUnref(function(e,r,t){var n,i,o=-1/0,a=-1/0;if(null==r&&null!=e)for(var s=0,l=(e=b(e)?e:h.values(e)).length;s<l;s++)n=e[s],o<n&&(o=n);else r=y(r,t),h.each(e,freeOnUnref(function(e,t,n){i=r(e,t,n),(a<i||i===-1/0&&o===-1/0)&&(o=e,a=i)}));return o}),h.min=freeOnUnref(function(e,r,t){var n,i,o=1/0,a=1/0;if(null==r&&null!=e)for(var s=0,l=(e=b(e)?e:h.values(e)).length;s<l;s++)(n=e[s])<o&&(o=n);else r=y(r,t),h.each(e,freeOnUnref(function(e,t,n){((i=r(e,t,n))<a||i===1/0&&o===1/0)&&(o=e,a=i)}));return o}),h.shuffle=freeOnUnref(function(e){for(var t,n=b(e)?e:h.values(e),r=n.length,i=Array(r),o=0;o<r;o++)(t=h.random(0,o))!==o&&(i[o]=i[t]),i[t]=n[o];return i}),h.sample=freeOnUnref(function(e,t,n){return null==t||n?(b(e)||(e=h.values(e)),e[h.random(e.length-1)]):h.shuffle(e).slice(0,Math.max(0,t))}),h.sortBy=freeOnUnref(function(e,r,t){return r=y(r,t),h.pluck(h.map(e,freeOnUnref(function(e,t,n){return{value:e,index:t,criteria:r(e,t,n)}})).sort(freeOnUnref(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(r<n||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index})),"value")});var M=freeOnUnref(function(a){return freeOnUnref(function(r,i,e){var o={};return i=y(i,e),h.each(r,function(e,t){var n=i(e,t,r);a(o,e,n)}),o})});h.groupBy=M(freeOnUnref(function(e,t,n){h.has(e,n)?e[n].push(t):e[n]=[t]})),h.indexBy=M(freeOnUnref(function(e,t,n){e[n]=t})),h.countBy=M(freeOnUnref(function(e,t,n){h.has(e,n)?e[n]++:e[n]=1})),h.toArray=freeOnUnref(function(e){return e?h.isArray(e)?l.call(e):b(e)?h.map(e,h.identity):h.values(e):[]}),h.size=freeOnUnref(function(e){return null==e?0:b(e)?e.length:h.keys(e).length}),h.partition=freeOnUnref(function(e,r,t){r=y(r,t);var i=[],o=[];return h.each(e,freeOnUnref(function(e,t,n){(r(e,t,n)?i:o).push(e)})),[i,o]}),h.first=h.head=h.take=freeOnUnref(function(e,t,n){if(null!=e)return null==t||n?e[0]:h.initial(e,e.length-t)}),h.initial=freeOnUnref(function(e,t,n){return l.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}),h.last=freeOnUnref(function(e,t,n){if(null!=e)return null==t||n?e[e.length-1]:h.rest(e,Math.max(0,e.length-t))}),h.rest=h.tail=h.drop=freeOnUnref(function(e,t,n){return l.call(e,null==t||n?1:t)}),h.compact=freeOnUnref(function(e){return h.filter(e,h.identity)});var C=freeOnUnref(function(e,t,n,r){for(var i=[],o=0,a=r||0,s=U(e);a<s;a++){var l=e[a];if(b(l)&&(h.isArray(l)||h.isArguments(l))){t||(l=C(l,t,n));var f=0,u=l.length;for(i.length+=u;f<u;)i[o++]=l[f++]}else n||(i[o++]=l)}return i});function E(o){return freeOnUnref(function(e,t,n){t=y(t,n);for(var r=U(e),i=0<o?0:r-1;0<=i&&i<r;i+=o)if(t(e[i],i,e))return i;return-1})}function T(o,a,s){return freeOnUnref(function(e,t,n){var r=0,i=U(e);if("number"==typeof n)0<o?r=0<=n?n:Math.max(n+i,r):i=0<=n?Math.min(n+1,i):n+i+1;else if(s&&n&&i)return e[n=s(e,t)]===t?n:-1;if(t!=t)return 0<=(n=a(l.call(e,r,i),h.isNaN))?n+r:-1;for(n=0<o?r:i-1;0<=n&&n<i;n+=o)if(e[n]===t)return n;return-1})}h.flatten=freeOnUnref(function(e,t){return C(e,t,!1)}),h.without=freeOnUnref(function(e){return h.difference(e,l.call(arguments,1))}),h.uniq=h.unique=freeOnUnref(function(e,t,n,r){h.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=y(n,r));for(var i=[],o=[],a=0,s=U(e);a<s;a++){var l=e[a],f=n?n(l,a,e):l;t?(a&&o===f||i.push(l),o=f):n?h.contains(o,f)||(o.push(f),i.push(l)):h.contains(i,l)||i.push(l)}return i}),h.union=freeOnUnref(function(){return h.uniq(C(arguments,!0,!0))}),h.intersection=freeOnUnref(function(e){for(var t=[],n=arguments.length,r=0,i=U(e);r<i;r++){var o=e[r];if(!h.contains(t,o)){for(var a=1;a<n&&h.contains(arguments[a],o);a++);a===n&&t.push(o)}}return t}),h.difference=freeOnUnref(function(e){var t=C(arguments,!0,!0,1);return h.filter(e,freeOnUnref(function(e){return!h.contains(t,e)}))}),h.zip=freeOnUnref(function(){return h.unzip(arguments)}),h.unzip=freeOnUnref(function(e){for(var t=e&&h.max(e,U).length||0,n=Array(t),r=0;r<t;r++)n[r]=h.pluck(e,r);return n}),h.object=freeOnUnref(function(e,t){for(var n={},r=0,i=U(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n}),h.findIndex=E(1),h.findLastIndex=E(-1),h.sortedIndex=freeOnUnref(function(e,t,n,r){for(var i=(n=y(n,r,1))(t),o=0,a=U(e);o<a;){var s=Math.floor((o+a)/2);n(e[s])<i?o=s+1:a=s}return o}),h.indexOf=T(1,h.findIndex,h.sortedIndex),h.lastIndexOf=T(-1,h.findLastIndex),h.range=freeOnUnref(function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),o=0;o<r;o++,e+=n)i[o]=e;return i});var w=freeOnUnref(function(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var o=v(e.prototype),a=e.apply(o,i);return h.isObject(a)?a:o});h.bind=freeOnUnref(function(e,t){if(u&&e.bind===u)return u.apply(e,l.call(arguments,1));if(!h.isFunction(e))throw new TypeError("Bind must be called on a function");var n=l.call(arguments,2),r=freeOnUnref(function(){return w(e,r,t,this,n.concat(l.call(arguments)))});return r}),h.partial=freeOnUnref(function(i){var o=l.call(arguments,1),a=freeOnUnref(function(){for(var e=0,t=o.length,n=Array(t),r=0;r<t;r++)n[r]=o[r]===h?arguments[e++]:o[r];for(;e<arguments.length;)n.push(arguments[e++]);return w(i,a,this,this,n)});return a}),h.bindAll=freeOnUnref(function(e){var t,n,r=arguments.length;if(r<=1)throw new Error("bindAll must be passed function names");for(t=1;t<r;t++)e[n=arguments[t]]=h.bind(e[n],e);return e}),h.memoize=freeOnUnref(function(r,i){var o=freeOnUnref(function(e){var t=o.cache,n=""+(i?i.apply(this,arguments):e);return h.has(t,n)||(t[n]=r.apply(this,arguments)),t[n]});return o.cache={},o}),h.delay=freeOnUnref(function(e,t){var n=l.call(arguments,2);return setTimeout(freeOnUnref(function(){return e.apply(null,n)}),t)}),h.defer=h.partial(h.delay,h,1),h.throttle=freeOnUnref(function(n,r,i){var o,a,s,l=null,f=0;i||(i={});var u=freeOnUnref(function(){f=!1===i.leading?0:h.now(),l=null,s=n.apply(o,a),l||(o=a=null)});return freeOnUnref(function(){var e=h.now();f||!1!==i.leading||(f=e);var t=r-(e-f);return o=this,a=arguments,t<=0||r<t?(l&&(clearTimeout(l),l=null),f=e,s=n.apply(o,a),l||(o=a=null)):l||!1===i.trailing||(l=setTimeout(u,t)),s})}),h.debounce=freeOnUnref(function(t,n,r){var i,o,a,s,l,f=freeOnUnref(function(){var e=h.now()-s;e<n&&0<=e?i=setTimeout(f,n-e):(i=null,r||(l=t.apply(a,o),i||(a=o=null)))});return freeOnUnref(function(){a=this,o=arguments,s=h.now();var e=r&&!i;return i||(i=setTimeout(f,n)),e&&(l=t.apply(a,o),a=o=null),l})}),h.wrap=freeOnUnref(function(e,t){return h.partial(t,e)}),h.negate=freeOnUnref(function(e){return freeOnUnref(function(){return!e.apply(this,arguments)})}),h.compose=freeOnUnref(function(){var n=arguments,r=n.length-1;return freeOnUnref(function(){for(var e=r,t=n[r].apply(this,arguments);e--;)t=n[e].call(this,t);return t})}),h.after=freeOnUnref(function(e,t){return freeOnUnref(function(){if(--e<1)return t.apply(this,arguments)})}),h.before=freeOnUnref(function(e,t){var n;return freeOnUnref(function(){return 0<--e&&(n=t.apply(this,arguments)),e<=1&&(t=null),n})}),h.once=h.partial(h.before,2);var I=!{toString:null}.propertyIsEnumerable("toString"),k=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function _(e,t){var n=k.length,r=e.constructor,i=h.isFunction(r)&&r.prototype||a,o="constructor";for(h.has(e,o)&&!h.contains(t,o)&&t.push(o);n--;)(o=k[n])in e&&e[o]!==i[o]&&!h.contains(t,o)&&t.push(o)}h.keys=freeOnUnref(function(e){if(!h.isObject(e))return[];if(f)return f(e);var t=[];for(var n in e)h.has(e,n)&&t.push(n);return I&&_(e,t),t}),h.allKeys=freeOnUnref(function(e){if(!h.isObject(e))return[];var t=[];for(var n in e)t.push(n);return I&&_(e,t),t}),h.values=freeOnUnref(function(e){for(var t=h.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}),h.mapObject=freeOnUnref(function(e,t,n){t=y(t,n);for(var r,i=h.keys(e),o=i.length,a={},s=0;s<o;s++)a[r=i[s]]=t(e[r],r,e);return a}),h.pairs=freeOnUnref(function(e){for(var t=h.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r}),h.invert=freeOnUnref(function(e){for(var t={},n=h.keys(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t}),h.functions=h.methods=freeOnUnref(function(e){var t=[];for(var n in e)h.isFunction(e[n])&&t.push(n);return t.sort()}),h.extend=g(h.allKeys),h.extendOwn=h.assign=g(h.keys),h.findKey=freeOnUnref(function(e,t,n){t=y(t,n);for(var r,i=h.keys(e),o=0,a=i.length;o<a;o++)if(t(e[r=i[o]],r,e))return r}),h.pick=freeOnUnref(function(e,t,n){var r,i,o={},a=e;if(null==a)return o;h.isFunction(t)?(i=h.allKeys(a),r=m(t,n)):(i=C(arguments,!1,!1,1),r=freeOnUnref(function(e,t,n){return t in n}),a=Object(a));for(var s=0,l=i.length;s<l;s++){var f=i[s],u=a[f];r(u,f,a)&&(o[f]=u)}return o}),h.omit=freeOnUnref(function(e,t,n){if(h.isFunction(t))t=h.negate(t);else{var r=h.map(C(arguments,!1,!1,1),String);t=freeOnUnref(function(e,t){return!h.contains(r,t)})}return h.pick(e,t,n)}),h.defaults=g(h.allKeys,!0),h.create=freeOnUnref(function(e,t){var n=v(e);return t&&h.extendOwn(n,t),n}),h.clone=freeOnUnref(function(e){return h.isObject(e)?h.isArray(e)?e.slice():h.extend({},e):e}),h.tap=freeOnUnref(function(e,t){return t(e),e}),h.isMatch=freeOnUnref(function(e,t){var n=h.keys(t),r=n.length;if(null==e)return!r;for(var i=Object(e),o=0;o<r;o++){var a=n[o];if(t[a]!==i[a]||!(a in i))return!1}return!0});var R=freeOnUnref(function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof h&&(e=e._wrapped),t instanceof h&&(t=t._wrapped);var i=c.call(e);if(i!==c.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t}var o="[object Array]"===i;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,s=t.constructor;if(a!==s&&!(h.isFunction(a)&&a instanceof a&&h.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var l=(n=n||[]).length;l--;)if(n[l]===e)return r[l]===t;if(n.push(e),r.push(t),o){if((l=e.length)!==t.length)return!1;for(;l--;)if(!R(e[l],t[l],n,r))return!1}else{var f,u=h.keys(e);if(l=u.length,h.keys(t).length!==l)return!1;for(;l--;)if(f=u[l],!h.has(t,f)||!R(e[f],t[f],n,r))return!1}return n.pop(),r.pop(),!0});h.isEqual=freeOnUnref(function(e,t){return R(e,t)}),h.isEmpty=freeOnUnref(function(e){return null==e||(b(e)&&(h.isArray(e)||h.isString(e)||h.isArguments(e))?0===e.length:0===h.keys(e).length)}),h.isElement=freeOnUnref(function(e){return!(!e||1!==e.nodeType)}),h.isArray=s||freeOnUnref(function(e){return"[object Array]"===c.call(e)}),h.isObject=freeOnUnref(function(e){var t=typeof e;return"function"===t||"object"===t&&!!e}),h.each(["Arguments","Function","String","Number","Date","RegExp","Error"],freeOnUnref(function(t){h["is"+t]=freeOnUnref(function(e){return c.call(e)==="[object "+t+"]"})})),h.isArguments(arguments)||(h.isArguments=freeOnUnref(function(e){return h.has(e,"callee")})),"function"!=typeof/./&&"object"!=typeof Int8Array&&(h.isFunction=freeOnUnref(function(e){return"function"==typeof e||!1})),h.isFinite=freeOnUnref(function(e){return isFinite(e)&&!isNaN(parseFloat(e))}),h.isNaN=freeOnUnref(function(e){return h.isNumber(e)&&e!==+e}),h.isBoolean=freeOnUnref(function(e){return!0===e||!1===e||"[object Boolean]"===c.call(e)}),h.isNull=freeOnUnref(function(e){return null===e}),h.isUndefined=freeOnUnref(function(e){return void 0===e}),h.has=freeOnUnref(function(e,t){return null!=e&&o.call(e,t)}),h.noConflict=freeOnUnref(function(){return e._=t,this}),h.identity=freeOnUnref(function(e){return e}),h.constant=freeOnUnref(function(e){return freeOnUnref(function(){return e})}),h.noop=freeOnUnref(function(){}),h.property=O,h.propertyOf=freeOnUnref(function(t){return freeOnUnref(null==t?function(){}:function(e){return t[e]})}),h.matcher=h.matches=freeOnUnref(function(t){return t=h.extendOwn({},t),freeOnUnref(function(e){return h.isMatch(e,t)})}),h.times=freeOnUnref(function(e,t,n){var r=Array(Math.max(0,e));t=m(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r}),h.random=freeOnUnref(function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}),h.now=Date.now||freeOnUnref(function(){return(new Date).getTime()});var A={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},D=h.invert(A),x=freeOnUnref(function(t){var n=freeOnUnref(function(e){return t[e]}),e="(?:"+h.keys(t).join("|")+")",r=RegExp(e),i=RegExp(e,"g");return freeOnUnref(function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,n):e})});h.escape=x(A),h.unescape=x(D),h.result=freeOnUnref(function(e,t,n){var r=null==e?void 0:e[t];return void 0===r&&(r=n),h.isFunction(r)?r.call(e):r});var F=0;h.uniqueId=freeOnUnref(function(e){var t=++F+"";return e?e+t:t}),h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,V=freeOnUnref(function(e){return"\\"+L[e]});h.template=freeOnUnref(function(o,e,t){!e&&t&&(e=t),e=h.defaults({},e,h.templateSettings);var n=RegExp([(e.escape||B).source,(e.interpolate||B).source,(e.evaluate||B).source].join("|")+"|$","g"),a=0,s="__p+='";o.replace(n,freeOnUnref(function(e,t,n,r,i){return s+=o.slice(a,i).replace(N,V),a=i+e.length,t?s+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":n?s+="'+\n((__t=("+n+"))==null?'':__t)+\n'":r&&(s+="';\n"+r+"\n__p+='"),e})),s+="';\n",e.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var r=new Function(e.variable||"obj","_",s)}catch(e){throw e.source=s,e}var i=freeOnUnref(function(e){return r.call(this,e,h)}),l=e.variable||"obj";return i.source="function("+l+"){\n"+s+"}",i}),h.chain=freeOnUnref(function(e){var t=h(e);return t._chain=!0,t});var j=freeOnUnref(function(e,t){return e._chain?h(t).chain():t});h.mixin=freeOnUnref(function(n){h.each(h.functions(n),freeOnUnref(function(e){var t=h[e]=n[e];h.prototype[e]=freeOnUnref(function(){var e=[this._wrapped];return i.apply(e,arguments),j(this,t.apply(h,e))})}))}),h.mixin(h),h.each(["pop","push","reverse","shift","sort","splice","unshift"],freeOnUnref(function(t){var n=r[t];h.prototype[t]=freeOnUnref(function(){var e=this._wrapped;return n.apply(e,arguments),"shift"!==t&&"splice"!==t||0!==e.length||delete e[0],j(this,e)})})),h.each(["concat","join","slice"],freeOnUnref(function(e){var t=r[e];h.prototype[e]=freeOnUnref(function(){return j(this,t.apply(this._wrapped,arguments))})})),h.prototype.value=freeOnUnref(function(){return this._wrapped}),h.prototype.valueOf=h.prototype.toJSON=h.prototype.value,h.prototype.toString=freeOnUnref(function(){return""+this._wrapped})}).call(ce)})),i=(x._,t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("MulticastCallback"),n=freeOnUnref(function(){function i(){this.timer=oe.timer,this.callbacks=[]}return i.onUnhandledEventListener=freeOnUnref(function(e){i.unhandledEventListenerCallback=e}),i.prototype.add=freeOnUnref(function(e){this.callbacks.push(e)}),i.prototype.remove=freeOnUnref(function(e){this.callbacks=x.without(this.callbacks,e)}),i.prototype.removeAll=freeOnUnref(function(){this.callbacks=[]}),i.prototype.getAllCallbacks=freeOnUnref(function(){return[].concat(this.callbacks)}),i.prototype.invoke=freeOnUnref(function(e){var t=this;this.timer.setImmediate(freeOnUnref(function(){return t.invokeSync(e)}))}),i.prototype.invokeSync=freeOnUnref(function(e){for(var t=0,n=[].concat(this.callbacks);t<n.length;t++){var r=n[t];try{r(e)}catch(e){o.error("UnhandledEventListenerError: "+e+". Stack: "+e.stack),null!=i.unhandledEventListenerCallback&&i.unhandledEventListenerCallback(e)}}}),i})();t.MulticastCallback=n})));e(i);i.MulticastCallback;var o=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("MultiplexedEventSource");var n=freeOnUnref(function(){function e(e){void 0===e&&(e=!1),this.sources=[],this.allListeners=[],this.active=null,this.bufferedCallbacks=[],this.bufferInactiveEvents=e}return e.prototype.selectSource=freeOnUnref(function(t){var e=x.find(this.sources,freeOnUnref(function(e){return e.id===t}));if(null==e)throw new Error("Entry with id "+t+" doesn't exist");this.active=e.source,this.reEmitEventsForSourceId(t)}),e.prototype.addSource=freeOnUnref(function(t,n){var r=this;if(null!=x.find(this.sources,freeOnUnref(function(e){return e.id===t})))throw new Error("Source with id "+t+" already exist");this.sources.push({id:t,source:n}),x.each(this.allListeners,freeOnUnref(function(e){r.listenDownstream(t,n,e)}))}),e.prototype.removeSource=freeOnUnref(function(t){var n=this,e=x.partition(this.sources,freeOnUnref(function(e){return e.id===t}));if(0===e[0].length)throw new Error("No source with id "+t+" exists");this.sources=e[1];var r=e[0][0];x.each(this.allListeners,freeOnUnref(function(e){n.unlistenDownstream(t,r.source,e)})),this.active===r.source&&(this.active=null)}),e.prototype.on=freeOnUnref(function(e,t){this.internalOn(e,t)}),e.prototype.off=freeOnUnref(function(t,n){var e=x.findIndex(this.allListeners,freeOnUnref(function(e){return e.event===t&&(e.callback===n||e.onceOriginCallback===n)}));if(-1!==e){var r=this.allListeners[e];this.allListeners.splice(e,1),x.each(r.downstreamListeners,freeOnUnref(function(e){e.source.off(r.event,e.callback)}))}}),e.prototype.once=freeOnUnref(function(n,r){var i=this,o=!1,a=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.off(n,a),o||(r.apply(i,e),o=!0)});this.internalOn(n,a,r)}),e.prototype.internalOn=freeOnUnref(function(e,t,n){void 0===n&&(n=null);var r={event:e,callback:t,onceOriginCallback:n,downstreamListeners:[]};this.allListeners.push(r),this.listenAllDownstreams(r)}),e.prototype.listenAllDownstreams=freeOnUnref(function(t){var n=this;x.each(this.sources,freeOnUnref(function(e){n.listenDownstream(e.id,e.source,t)}))}),e.prototype.listenDownstream=freeOnUnref(function(r,i,o){var a=this,e=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=freeOnUnref(function(){return o.callback.apply(a,e)});a.active===i?(o.onceOriginCallback&&a.off(o.event,o.callback),n()):a.bufferInactiveEvents&&a.bufferCallbackForId(r,n)});o.downstreamListeners.push({source:i,callback:e}),i.on(o.event,e)}),e.prototype.unlistenDownstream=freeOnUnref(function(e,t,n){n.downstreamListeners=x.reject(n.downstreamListeners,freeOnUnref(function(e){return e.source===t&&(t.off(n.event,e.callback),!0)}));var r=this.getBufferedCallbacksForId(e);null!=r&&(r.callbacks=[])}),e.prototype.bufferCallbackForId=freeOnUnref(function(e,t){var n=this.getBufferedCallbacksForId(e);null==n&&(n={id:e,callbacks:[]},this.bufferedCallbacks.push(n)),n.callbacks.push(t)}),e.prototype.reEmitEventsForSourceId=freeOnUnref(function(e){if(this.bufferInactiveEvents){var t=this.getBufferedCallbacksForId(e);if(null!=t&&!x.isEmpty(t.callbacks)){for(var n=0,r=t.callbacks;n<r.length;n++){(0,r[n])()}t.callbacks=[]}}}),e.prototype.getBufferedCallbacksForId=freeOnUnref(function(t){return x.find(this.bufferedCallbacks,freeOnUnref(function(e){return e.id===t}))}),e})();t.MultiplexedEventSource=n}));e(o);o.MultiplexedEventSource;var A=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=n.EventEmitter,t.EventTracker=r.EventTracker,t.MulticastCallback=i.MulticastCallback,t.MultiplexedEventSource=o.MultiplexedEventSource}));e(A);A.EventEmitter,A.EventTracker,A.MulticastCallback,A.MultiplexedEventSource;var a=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="undefined"!=typeof Native&&"function"==typeof Native.MML_Get_MPBController;t.isMMLSupported=n,t.tryGetMMLInterface=function(){if(n)return Native;throw new Error("Failed to get NativeMMLInterface, MML is not available from native")}}));e(a);a.isMMLSupported,a.tryGetMMLInterface;var s=t(freeOnUnref(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(a)}));e(s);var d=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("MpbCapabilities"),n=freeOnUnref(function(){function r(e,t){this.errorCode=e,this.capabilities=t}return Object.defineProperty(r.prototype,"error_code",{get:freeOnUnref(function(){return this.errorCode}),enumerable:!0,configurable:!0}),r.create=freeOnUnref(function(e){var t=parseFloat(e.version);if(isNaN(t))throw new Error("MPB_GetCapabilities API returns version: "+t+" is not a number");if(e.error_code!==p.MPBErrors.OK)return new r(e.error_code,{});var n=r.validateCaps(e);return null==n?new r(p.MPBErrors.OK,{}):(i.info("MPB_GetCapabilities : "+e.capabilities),new r(p.MPBErrors.OK,n))}),r.validateCaps=freeOnUnref(function(t){var e;try{e=JSON.parse(t.capabilities)}catch(e){return i.error("Failed to parse capabilities: "+t.capabilities,e),null}var n=e;return null==n?(i.warn("capabilities are null"),null):n}),r})();t.MpbCapabilities=n}));e(d);d.MpbCapabilities;var h=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.obj=e,this.prefix=t,this.metrics=n}return e.prototype.on=freeOnUnref(function(e,t){this.obj.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.obj.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.obj.off(e,t)}),e.prototype.getMPBController=freeOnUnref(function(){return this.obj.getMPBController()}),e.prototype.getCapabilities=freeOnUnref(function(){return this.obj.getCapabilities()}),e.prototype.getProperty=freeOnUnref(function(e){return this.obj.getProperty(e)}),e.prototype.setProperty=freeOnUnref(function(e,t){return this.obj.setProperty(e,t)}),e.prototype.createInstance=freeOnUnref(function(){var e=this.obj.createInstance();return this.metrics.putMetric("MML."+this.prefix+".MPB.CreateInstance.Error",null==e?1:0),e}),e.prototype.getInstanceCount=freeOnUnref(function(){return this.obj.getInstanceCount()}),e.prototype.getInstanceById=freeOnUnref(function(e){return this.obj.getInstanceById(e)}),e.prototype.destroyInstance=freeOnUnref(function(e){var t=this.obj.destroyInstance(e);return this.metrics.putMetric("MML."+this.prefix+".MPB.DestroyInstance.Error",t===p.MPBErrors.OK?0:1),t}),e.prototype.getInstanceId=freeOnUnref(function(e){return this.obj.getInstanceId(e)}),e.prototype.isCanDecodeMediaSupported=freeOnUnref(function(){return this.obj.isCanDecodeMediaSupported()}),e.prototype.getInstanceIds=freeOnUnref(function(){return this.obj.getInstanceIds()}),e.prototype.canDecodeMedia=freeOnUnref(function(e){return this.obj.canDecodeMedia(e)}),e})();t.InstanceManagerWithMetrics=n}));e(h);h.InstanceManagerWithMetrics;var m=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("InstanceManager"),r=!1;t.getMMLInstanceControllerInitState=function(){return r};var i,o=freeOnUnref(function(){function e(){this.mpbCapabilitiesInst=null,this.attachedToEventQueue=!1,this.mpbInstanceIdToInstanceMap={},this.nativeApi=s.tryGetMMLInterface(),this.controller=this.nativeApi.MML_Get_MPBController(),r=!0,this.eventEmitter=new A.EventEmitter,this.attachToEventQueue(re.connector.eventQueueAPI)}return e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.eventEmitter.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.getMPBController=freeOnUnref(function(){return this.controller}),e.prototype.getCapabilities=freeOnUnref(function(){if(null!=this.mpbCapabilitiesInst)return this.mpbCapabilitiesInst;var e=this.nativeApi.MPB_GetCapabilities(this.controller);return this.mpbCapabilitiesInst=d.MpbCapabilities.create(e),this.mpbCapabilitiesInst}),e.prototype.getProperty=freeOnUnref(function(e){return this.nativeApi.MPB_GetProperty(this.controller,e)}),e.prototype.setProperty=freeOnUnref(function(e,t){return this.nativeApi.MPB_SetProperty(this.controller,e,t)}),e.prototype.createInstance=freeOnUnref(function(){var e=this.nativeApi.MPB_CreateInstance(this.controller);if(null==e)return null;var t=this.nativeApi.MPBInstance_GetId(e);return this.mpbInstanceIdToInstanceMap[t]=e,t}),e.prototype.getInstanceCount=freeOnUnref(function(){return this.nativeApi.MPB_GetInstanceCount(this.controller)}),e.prototype.getInstanceById=freeOnUnref(function(e){return this.nativeApi.MPB_GetInstanceById(this.controller,e)}),e.prototype.destroyInstance=freeOnUnref(function(e){var t=this.getInstanceById(e);return null==t?(n.warn("Trying to destory Instance with id "+e+" which does not exist.                 Ignoring the destroy call."),p.MPBErrors.INVALID_ARGUMENT):(delete this.mpbInstanceIdToInstanceMap[e],this.nativeApi.MPB_DestroyInstance(t))}),e.prototype.getInstanceId=freeOnUnref(function(e){return this.nativeApi.MPBInstance_GetId(e)}),e.prototype.isCanDecodeMediaSupported=freeOnUnref(function(){return"function"==typeof this.nativeApi.MPB_CanDecodeMedia}),e.prototype.getInstanceIds=freeOnUnref(function(){return this.nativeApi.MPB_GetInstanceIds(this.controller)}),e.prototype.canDecodeMedia=freeOnUnref(function(e){if(e.mimeAttributeKeys.length!==e.mimeAttributeValues.length){var t="mimeAttributeKeys: "+JSON.stringify(e.mimeAttributeKeys)+" length "+e.mimeAttributeKeys.length+" and \n            mimeAttributeValues: "+JSON.stringify(e.mimeAttributeValues)+" length "+e.mimeAttributeValues.length+" are not aligned";throw n.error(t),new Error(t)}if(!this.isCanDecodeMediaSupported())throw new Error("MPB_CanDecodeMedia is not defined in Native");return this.nativeApi.MPB_CanDecodeMedia(this.controller,e.mimeType,e.mimeSubType,e.mimeAttributeKeys,e.mimeAttributeValues)}),e.prototype.attachToEventQueue=freeOnUnref(function(e){var t=this,n=this.nativeApi.MPB_GetEventWaitable(this.controller),r=freeOnUnref(function(){return t.attachedToEventQueue?t.pollSingleEvent()?1:2:3});this.attachedToEventQueue=!0,e.insertFunction("high",n,r)}),e.prototype.pollSingleEvent=freeOnUnref(function(){var e=this.nativeApi.MPB_TryGetEvent(this.controller);return null!=e&&(n.info("Emitting API event type "+e.event_type+", "+p.MEDIA_API_EVENTS_MAP[e.event_type]),this.emitEvent(e),!0)}),e.prototype.emitEvent=freeOnUnref(function(e){if(e.event_type!==this.nativeApi.MML_MediaEventType_MPB_API_PROPERTY_CHANGED)throw new Error("Unknown event type received from MPB API "+JSON.stringify(e));var t=e;t.key===p.PICTURE_MODE_PROPERTY_KEY?this.emitPictureMode(t):n.warn("Unknown API property changed event received from MPB API: "+JSON.stringify(t))}),e.prototype.emitPictureMode=freeOnUnref(function(e){switch(e.value){case"filmmaker":case"calibratedCinematic":case"calibratedBroadcast":case"none":this.eventEmitter.emit("picture-mode-changed",e.value);break;default:throw new Error("Unknown Picture mode received from MPB: "+JSON.stringify(e))}}),e})();t.InstanceManager=o,t.getInstanceManager=freeOnUnref(function(e,t){return void 0===e&&(e=""),void 0===t&&(t=null),null==i&&(i=new o),""!==e&&null!=t?new h.InstanceManagerWithMetrics(i,e,t):i})}));e(m);m.getMMLInstanceControllerInitState,m.InstanceManager,m.getInstanceManager;var y=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceManager=m.InstanceManager,t.getInstanceManager=m.getInstanceManager,t.getMMLInstanceControllerInitState=m.getMMLInstanceControllerInitState,t.MpbCapabilities=d.MpbCapabilities}));e(y);y.InstanceManager,y.getInstanceManager,y.getMMLInstanceControllerInitState,y.MpbCapabilities;var g=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.parseCapabilities=function(e){f.check(e.capabilities,"caps.capabilities").is.not.null();var t=JSON.parse(e.capabilities);f.check(t.supportedSystems,"caps.supportedSystems").is.an.array();for(var n=0,r=t.supportedSystems;n<r.length;n++){var i=r[n];if(f.check(i,"supported system").is.an.object(),f.check(i.name,"supported system name").is.a.string(),p.keySystemNames.indexOf(i.name)<0)throw new Error("key system name "+i.name+" not an acceptable system name, use one of "+p.keySystemNames);f.check(i.maxSupportedSessions,"maxSupportedSessions").is.a.number(),f.check(i.encryptionSchemes,"encryptionSchemes").is.an.array();for(var o=0,a=i.encryptionSchemes;o<a.length;o++){var s=a[o];if(f.check(s,"encryptionScheme").is.a.string(),p.encryptionSchemes.indexOf(s)<0)throw new Error("encryption scheme "+s+" is not an acceptable encryption scheme, use one of "+p.encryptionSchemes)}}return t}}));e(g);g.parseCapabilities;var v=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("DrmSessionManager"),r=freeOnUnref(function(){function e(e,t){this.attachedToEventQueue=!1,this.drmInterface=e,this.drmSession=t,this.eventEmitter=new A.EventEmitter,this.attachToEventQueue(re.connector.eventQueueAPI)}return e.prototype.destroy=freeOnUnref(function(){return this.detachFromEventQueue(),this.drmInterface.MML_DRM_DestroySession(this.drmSession)}),e.prototype.getSessionId=freeOnUnref(function(){return this.drmInterface.MML_DRM_GetSessionId(this.drmSession)}),e.prototype.releaseKeys=freeOnUnref(function(){return this.drmInterface.MML_DRM_ReleaseKeys(this.drmSession)}),e.prototype.generateRequest=freeOnUnref(function(e){return this.drmInterface.MML_DRM_GenerateRequest(this.drmSession,e)}),e.prototype.processResponse=freeOnUnref(function(e){return this.drmInterface.MML_DRM_ProcessResponse(this.drmSession,e)}),e.prototype.tryGetEvent=freeOnUnref(function(){return this.drmInterface.MML_DRM_TryGetEvent(this.drmSession)}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.eventEmitter.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.attachToEventQueue=freeOnUnref(function(e){var t=this,n=this.drmInterface.MML_DRM_GetEventWaitable(this.drmSession),r=freeOnUnref(function(){return t.attachedToEventQueue?t.pollSingleEvent()?1:2:3});this.attachedToEventQueue=!0,e.insertFunction("high",n,r)}),e.prototype.detachFromEventQueue=freeOnUnref(function(){this.attachedToEventQueue=!1}),e.prototype.pollSingleEvent=freeOnUnref(function(){var e=this.tryGetEvent();if(null==e)return!1;var t=e;return n.info("Emitting DRM event type "+t.event_type+", "+p.DRM_EVENT_MAP[t.event_type]),this.emitEvent(t),!0}),e.prototype.emitEvent=freeOnUnref(function(e){switch(e.event_type){case this.drmInterface.MML_MediaEventType_DRM_CALLBACK:case this.drmInterface.MML_MediaEventType_DRM_MESSAGE:this.eventEmitter.emitSync("drm-message",e);break;case this.drmInterface.MML_MediaEventType_DRM_ERROR:this.eventEmitter.emitSync("drm-error",e);break;default:throw new Error("Unknown event type received from Drm Event Queue "+JSON.stringify(e))}}),e})();t.DrmSessionManager=r}));e(v);v.DrmSessionManager;var O=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getPersistentSessionId=freeOnUnref(function(){return this.drmInterface.MML_DRM_GetPersistentSessionId(this.drmSession)}),t.prototype.getLicenseStatus=freeOnUnref(function(){return this.drmInterface.MML_DRM_GetLicenseStatus(this.drmSession)}),t.prototype.removeKeys=freeOnUnref(function(){return this.drmInterface.MML_DRM_RemoveKeys(this.drmSession)}),t})(v.DrmSessionManager);t.DrmPersistentSessionManager=r}));e(O);O.DrmPersistentSessionManager;var S=t(freeOnUnref(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=de.get("DrmSystemManager");n.ENCRYPTION_SCHEME="cenc";var t=freeOnUnref(function(){function e(e,t,n,r,i){this.drmInterface=e,this.drmSystem=t,this.version=n,this.drmSystemName=r,this.capabilities=i}return e.prototype.getSystemHandle=freeOnUnref(function(){return this.drmSystem}),e.prototype.destroy=freeOnUnref(function(){return this.drmInterface.MML_DRM_DestroySystem(this.drmSystem)}),e.prototype.createSession=freeOnUnref(function(){var e;if(.1<=this.version)e=this.drmInterface.MML_DRM_CreateSession(this.drmSystem,n.ENCRYPTION_SCHEME);else{e=this.drmInterface.MML_DRM_CreateSession(this.drmSystem,"",n.ENCRYPTION_SCHEME)}return null==e?(r.error("Create DRM session failed"),null):new v.DrmSessionManager(this.drmInterface,e)}),e.prototype.createPersistentSession=freeOnUnref(function(){if(!this.checkPersistentLicenseCapability())return r.error("Create DRM persistent session failed: device capabilities does not support persistent licenses"),null;var e=this.drmInterface.MML_DRM_CreatePersistentSession(this.drmSystem,n.ENCRYPTION_SCHEME);return null==e?(r.error("Create persistent DRM session failed"),null):new O.DrmPersistentSessionManager(this.drmInterface,e)}),e.prototype.loadSession=freeOnUnref(function(e){if(!this.checkPersistentLicenseCapability())return r.error("Load DRM session failed for persistent session id: missing capability",e),null;var t=this.drmInterface.MML_DRM_LoadSession(this.drmSystem,n.ENCRYPTION_SCHEME,e);return null==t?(r.error("Load DRM session failed for persistent session id",e),null):new O.DrmPersistentSessionManager(this.drmInterface,t)}),e.prototype.checkPersistentLicenseCapability=freeOnUnref(function(){var t=this;return this.version<.3?(r.warn("checkPersistentLicenseCapability: false, persistence is only available in rev 0.3+",this.version),!1):null==this.drmSystemName?(r.warn("checkPersistentLicenseCapability: false, system name is null",this.version),!1):null==this.capabilities?(r.warn("checkPersistentLicenseCapability: false, capabilities not available",this.version),!1):!!this.capabilities.supportedSystems.some(freeOnUnref(function(e){return e.name===t.drmSystemName&&e.encryptionSchemes.some(freeOnUnref(function(e){return e===n.ENCRYPTION_SCHEME}))&&e.sessionTypes.some(freeOnUnref(function(e){return e===p.SESSION_TYPE_PERSISTENT}))}))||(r.warn("checkPersistentLicenseCapability: false, no persistent capability match found",this.version),!1)}),e})();n.DrmSystemManager=t}));e(S);S.ENCRYPTION_SCHEME,S.DrmSystemManager;var U=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=de.get("DrmManager"),i=!1,o=freeOnUnref(function(){function e(e){if(this.drmCapabilities=void 0,this.drmInterface=e,this.drmController=this.drmInterface.MML_Get_DRMController(),!this.drmController)throw new Error("Get DRM Controller failed, encrypted playback would fail");this.nativeAPIVersion=this.getNativeAPIVersion()}return e.prototype.init=freeOnUnref(function(e){var t;if(this.drmSystemName=e,.1<=this.nativeAPIVersion)t=this.drmInterface.MML_DRM_Init(this.drmController);else{if(null==e)throw new Error("DRM init failed, DRM system name is null");t=this.drmInterface.MML_DRM_Init(this.drmController,e)}return t===p.MPBErrors.OK&&(i=!0),t}),e.prototype.shutdown=freeOnUnref(function(){return this.drmSystemName=void 0,i=!1,this.drmInterface.MML_DRM_Shutdown(this.drmController)}),e.prototype.getCapabilities=freeOnUnref(function(){if(!(this.nativeAPIVersion<.2))return null!=this.drmCapabilities||(i?this.drmCapabilities=this.getNativeDeviceDrmCaps():(this.init(),this.drmCapabilities=this.getNativeDeviceDrmCaps(),this.shutdown())),this.drmCapabilities;r.warn("Native version "+this.nativeAPIVersion+" < 0.2, so DRM capabilities not supported")}),e.prototype.getNativeDeviceDrmCaps=freeOnUnref(function(){var e=this.drmInterface.MML_DRM_GetCapabilities(this.drmController);if(e.error_code!==p.MPBErrors.OK||null==e.capabilities)throw new Error("MML_DRM_GetCapabilities returned error code "+e.error_code+" and capabilities as "+e.capabilities);return g.parseCapabilities(e)}),e.prototype.createSystem=freeOnUnref(function(e){var t,n=null!=e?e:this.drmSystemName;if(this.nativeAPIVersion<.1)t=this.drmInterface.MML_DRM_CreateSystem(this.drmController);else{if(null==n)throw new Error("Create DRM system failed, DRM name is null");t=this.drmInterface.MML_DRM_CreateSystem(this.drmController,n)}return t?new S.DrmSystemManager(this.drmInterface,t,this.nativeAPIVersion,n,this.getCapabilities()):null}),e.prototype.getNativeAPIVersion=freeOnUnref(function(){if("function"!=typeof this.drmInterface.MML_DRM_GetCapabilities)return 0;var e=this.drmInterface.MML_DRM_GetCapabilities(this.drmController);if(e.error_code!==p.MPBErrors.OK&&e.error_code!==p.MPBErrors.NOT_INITIALIZED)throw new Error("Expected error code in to be "+p.MPBErrors.OK+" or "+p.MPBErrors.NOT_INITIALIZED+" but MML_DRM_GetCapabilities returned error code "+e.error_code);if(null==e.version)return 0;var t=parseFloat(e.version);if(isNaN(t))throw new Error("Unable to parse "+e.version+" as a float");return t}),e})();t.DrmManager=o,t.getDrmManager=function(){if(n)return n;var e=s.tryGetMMLInterface();return n=new o(e)}}));e(U);U.DrmManager,U.getDrmManager;var b=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DrmManager=U.DrmManager,t.getDrmManager=U.getDrmManager,t.DrmSystemManager=S.DrmSystemManager,t.DrmSessionManager=v.DrmSessionManager,t.DrmPersistentSessionManager=O.DrmPersistentSessionManager}));e(b);b.DrmManager,b.getDrmManager,b.DrmSystemManager,b.DrmSessionManager,b.DrmPersistentSessionManager;var P=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("MMLMediaControl"),n=freeOnUnref(function(){function e(e,t){this.attachedToEventQueue=!1;var n=t,r=n.getInstanceById(e);if(null==r)throw new Error("error trying to create MediaControl, no handle found under id "+e);this.mediaControlApi=s.tryGetMMLInterface(),this.instanceManager=n,this.eventEmitter=new A.EventEmitter,this.mpbInstanceId=e,this.mpbInstance=r,this.attachToEventQueue(re.connector.eventQueueAPI)}return e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.eventEmitter.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.attachToEventQueue=freeOnUnref(function(e){var t=this,n=this.mediaControlApi.MPBInstance_GetEventWaitable(this.mpbInstance),r=freeOnUnref(function(){return t.attachedToEventQueue?t.pollSingleEvent()?1:2:3});this.attachedToEventQueue=!0,e.insertFunction("high",n,r)}),e.prototype.detachFromEventQueue=freeOnUnref(function(){this.attachedToEventQueue=!1,this.eventEmitter.removeAllListeners()}),e.prototype.pollSingleEvent=freeOnUnref(function(){var e=this.mediaControlApi.MPBInstance_TryGetEvent(this.mpbInstance);return null!=e&&(r.info("Emitting event type "+e.event_type+", "+p.MEDIA_EVENTS_MAP[e.event_type]),this.emitEvent(e),!0)}),e.prototype.init=freeOnUnref(function(e){var t=null==e?"":e;return this.mediaControlApi.MPBInstance_PlaybackInit(this.mpbInstance,t)}),e.prototype.shutdown=freeOnUnref(function(){return this.mediaControlApi.MPBInstance_PlaybackShutdown(this.mpbInstance)}),e.prototype.destroy=freeOnUnref(function(){return this.detachFromEventQueue(),this.instanceManager.destroyInstance(this.mpbInstanceId)}),e.prototype.release=freeOnUnref(function(){this.detachFromEventQueue()}),e.prototype.getProperty=freeOnUnref(function(e){return this.mediaControlApi.MPBInstance_GetProperty(this.mpbInstance,e)}),e.prototype.setProperty=freeOnUnref(function(e,t){return this.mediaControlApi.MPBInstance_SetProperty(this.mpbInstance,e,t)}),e.prototype.play=freeOnUnref(function(){return this.mediaControlApi.MPBInstance_PlaybackPlay(this.mpbInstance)}),e.prototype.pause=freeOnUnref(function(){return this.mediaControlApi.MPBInstance_PlaybackPause(this.mpbInstance)}),e.prototype.stop=freeOnUnref(function(){return this.mediaControlApi.MPBInstance_PlaybackStop(this.mpbInstance)}),e.prototype.seek=freeOnUnref(function(e,t){return this.mediaControlApi.MPBInstance_PlaybackSeek(this.mpbInstance,e,t)}),e.prototype.getPlaybackTime=freeOnUnref(function(){return this.mediaControlApi.MPBInstance_GetPlaybackTime(this.mpbInstance)}),e.prototype.setOutputPosition=freeOnUnref(function(e,t,n,r,i){return void 0===i&&(i=0),this.mediaControlApi.MPBInstance_SetVideoOutputPosition(this.mpbInstance,e,t,n,r,i)}),e.prototype.setDRMSystem=freeOnUnref(function(e){return this.mediaControlApi.MPBInstance_SetDRMSystem(this.mpbInstance,e.getSystemHandle())}),e.prototype.getDiagnostics=freeOnUnref(function(){return this.mediaControlApi.MPBInstance_GetDiagnosticInfo(this.mpbInstance)}),Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){var e=this.getProperty(p.MPBInstanceProperties.audioVolume);return e.error_code!==p.MPBErrors.OK?(r.warn("Unable to get volume, error code is "+e.error_code+", assuming 1.0"),1):Number(e.value)}),set:freeOnUnref(function(e){var t=this.setProperty(p.MPBInstanceProperties.audioVolume,e.toString());t!==p.MPBErrors.OK&&r.warn("Unable to set volume to "+e+", error code is "+t)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mute",{get:freeOnUnref(function(){var e=this.getProperty(p.MPBInstanceProperties.audioMute);return e.error_code!==p.MPBErrors.OK?(r.warn("Unable to get mute, error code is "+e.error_code+", assuming false"),!1):"true"===e.value}),set:freeOnUnref(function(e){var t=this.instanceManager.getCapabilities();if(t.errorCode===p.MPBErrors.OK&&!0===t.capabilities.supportsAudioMuting){var n=this.setProperty(p.MPBInstanceProperties.audioMute,String(e));n!==p.MPBErrors.OK&&r.warn("Unable to set mute to "+e+" with error code "+n)}else r.warn("Unable to set mute to "+e+", as audioMuting is not supported.")}),enumerable:!0,configurable:!0}),e.prototype.emitEvent=freeOnUnref(function(e){switch(e.event_type){case this.mediaControlApi.MML_MediaEventType_MPB_READY_TO_PLAY:this.eventEmitter.emitSync("ready-to-play");break;case this.mediaControlApi.MML_MediaEventType_MPB_PLAYBACK_STARTED:this.eventEmitter.emitSync("playback-started");break;case this.mediaControlApi.MML_MediaEventType_MPB_BUFFER_UNDERRUN:this.eventEmitter.emitSync("buffer-underrun");break;case this.mediaControlApi.MML_MediaEventType_MPB_END_OF_STREAM:this.eventEmitter.emitSync("end-of-stream");break;case this.mediaControlApi.MML_MediaEventType_MPB_ERROR:this.eventEmitter.emitSync("error",e);break;case this.mediaControlApi.MML_MediaEventType_MPB_PROPERTY_CHANGED:this.eventEmitter.emitSync("property-changed",e);break;default:throw new Error("Unknown event type received from MPB instance "+JSON.stringify(e))}}),e})();t.MediaControl=n,t.createMediaControl=freeOnUnref(function(e,t){return void 0===t&&(t=y.getInstanceManager()),new n(e,t)})}));e(P);P.MediaControl,P.createMediaControl;var M=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaControl=P.MediaControl,t.createMediaControl=P.createMediaControl}));e(M);M.MediaControl,M.createMediaControl;var C=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("MediaBuffer"),r=freeOnUnref(function(){function e(e,t){this.mediaBufferApi=s.tryGetMMLInterface(),this.mediaControlApi=s.tryGetMMLInterface(),this.instanceManager=t;var n=this.instanceManager.getInstanceById(e);if(null==n)throw new Error("trying to create MedaiBuffer with invalid instance id "+e);this.mpbInstance=n}return e.prototype.audioEndOfStream=freeOnUnref(function(){return this.mediaBufferApi.MPBInstance_SendAudioEOS(this.mpbInstance)}),e.prototype.videoEndOfStream=freeOnUnref(function(){return this.mediaBufferApi.MPBInstance_SendVideoEOS(this.mpbInstance)}),e.prototype.audioMetadata=freeOnUnref(function(e,t,n){return this.mediaBufferApi.MPBInstance_SendAudioMetadata(this.mpbInstance,e,t,n)}),e.prototype.videoMetadata=freeOnUnref(function(e,t,n,r){return this.mediaBufferApi.MPBInstance_SendVideoMetadata(this.mpbInstance,e,t,n,r)}),e.prototype.audioSample=freeOnUnref(function(e,t,n,r){return this.mediaBufferApi.MPBInstance_SendAudioSample(this.mpbInstance,e,t,n,r)}),e.prototype.encryptedAudioSample=freeOnUnref(function(e,t,n,r,i,o,a,s,l){return this.mediaBufferApi.MPBInstance_SendAudioSampleEncrypted(this.mpbInstance,e,t,n,r,i,o,a,s,l)}),e.prototype.videoSample=freeOnUnref(function(e,t,n,r,i,o,a){return this.mediaBufferApi.MPBInstance_SendVideoSample(this.mpbInstance,e,t,n,r,i,o,a)}),e.prototype.encryptedVideoSample=freeOnUnref(function(e,t,n,r,i,o,a,s,l,f,u,c){return this.mediaBufferApi.MPBInstance_SendVideoSampleEncrypted(this.mpbInstance,e,t,n,r,i,o,a,s,l,f,u,c)}),e.prototype.setDisplayAspectRatio=freeOnUnref(function(e){var t=this.instanceManager.getCapabilities();return t.errorCode!==p.MPBErrors.OK?t.errorCode:!0!==t.capabilities.supportsTrackDARUpdates?p.MPBErrors.KEY_NOT_FOUND:(n.info("Sending display aspect ratio: "+e+" to native MPB"),this.mediaControlApi.MPBInstance_SetProperty(this.mpbInstance,p.MPBInstanceProperties.displayAspectRatio,e.toString()))}),e})();t.MediaBuffer=r,t.createMediaBuffer=freeOnUnref(function(e,t){return void 0===t&&(t=y.getInstanceManager()),new r(e,t)})}));e(C);C.MediaBuffer,C.createMediaBuffer;var E=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaBuffer=C.MediaBuffer,t.createMediaBuffer=C.createMediaBuffer}));e(E);E.MediaBuffer,E.createMediaBuffer;var T=t(freeOnUnref(function(e,n){function t(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),t(y),t(b),t(M),t(E),n.isMMLSupported=s.isMMLSupported}));e(T);T.isMMLSupported;var w=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(){function e(e,t){void 0===e&&(e=ne.connector.unfCallbackAPI),this.callbackManager=e,this.devicePropertiesAPI=t}return e.prototype.getBoolProperty=freeOnUnref(function(e,t,n){var r=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){var t=e.boolean?e.boolean_alt:void 0;n(e.boolean,t)}));"function"==typeof this.devicePropertiesAPI.UNF_GetPropertyBoolEx?this.devicePropertiesAPI.UNF_GetPropertyBoolEx(r,e,t):this.devicePropertiesAPI.UNF_GetPropertyBool(r,e)}),e.prototype.getInt32Property=freeOnUnref(function(e,t,n){var r=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){var t=e.boolean?e.integer_alt:void 0;n(e.boolean,t)}));"function"==typeof this.devicePropertiesAPI.UNF_GetPropertyIntegerEx?this.devicePropertiesAPI.UNF_GetPropertyIntegerEx(r,e,t):this.devicePropertiesAPI.UNF_GetPropertyInteger(r,e)}),e.prototype.getStringProperty=freeOnUnref(function(e,t,n){var r=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){var t=e.boolean?e.string_alt:void 0;n(e.boolean,t)}));"function"==typeof this.devicePropertiesAPI.UNF_GetPropertyStringEx?this.devicePropertiesAPI.UNF_GetPropertyStringEx(r,e,t):this.devicePropertiesAPI.UNF_GetPropertyString(r,e)}),e})();t.DeviceProperties=r;var i=freeOnUnref(function(){function e(e,t){this.devicePropertiesAPI=void 0,this.devicePropertiesAPI=t,this.eventQueue=e}return e.prototype.getBoolProperty=freeOnUnref(function(e,t,n){var r=this,i=this.devicePropertiesAPI.AsyncDPP_GetBool(e,t),o=this.devicePropertiesAPI.AsyncDPPResult_GetWaitable(i);this.eventQueue.insertFunction("normal",o,freeOnUnref(function(){if(r.devicePropertiesAPI.AsyncDPPResult_IsFulfilled(i)){var e=r.devicePropertiesAPI.AsyncDPPResult_PullBool(i);return r.pushResult(e,n),0}return 2}))}),e.prototype.getInt32Property=freeOnUnref(function(e,t,n){var r=this,i=this.devicePropertiesAPI.AsyncDPP_GetInt(e,t),o=this.devicePropertiesAPI.AsyncDPPResult_GetWaitable(i);this.eventQueue.insertFunction("normal",o,freeOnUnref(function(){if(r.devicePropertiesAPI.AsyncDPPResult_IsFulfilled(i)){var e=r.devicePropertiesAPI.AsyncDPPResult_PullInt(i);return r.pushResult(e,n),0}return 2}))}),e.prototype.getStringProperty=freeOnUnref(function(e,t,n){var r=this,i=this.devicePropertiesAPI.AsyncDPP_GetString(e,t),o=this.devicePropertiesAPI.AsyncDPPResult_GetWaitable(i);this.eventQueue.insertFunction("normal",o,freeOnUnref(function(){if(r.devicePropertiesAPI.AsyncDPPResult_IsFulfilled(i)){var e=r.devicePropertiesAPI.AsyncDPPResult_PullString(i);return r.pushResult(e,n),0}return 2}))}),e.prototype.pushResult=freeOnUnref(function(e,t){null!==e?t(!0,e):t(!1)}),e})();t.DevicePropertiesAsync=i;var o=null;t.getDevicePropAPI=function(){if(null!==o)return o;var e=c.tryGetNative();if(null==e){var n="on device properties singleton when Native not available";return{getBoolProperty:freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Accessing getBoolProperty "+n)}),getInt32Property:freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Accessing getInt32Property "+n)}),getStringProperty:freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Accessing getStringProperty "+n)})}}return T.isMMLSupported?(ne.connector.consoleAPI.info("Initializing async DPP API"),o=new i(ne.connector.eventQueueAPI,e)):(ne.connector.consoleAPI.info("Initializing UNF based sync DPP API"),o=new r(ne.connector.unfCallbackAPI,e)),o}}));e(w);w.DeviceProperties,w.DevicePropertiesAsync,w.getDevicePropAPI;var I=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function t(e){void 0===e&&(e=c.tryGetNative()),this.consoleApi=t.load_console_api(e)}return t.prototype.trace=freeOnUnref(function(e){this.consoleApi.LogMessage(this.consoleApi.E_LogLevel_Debug,e)}),t.prototype.info=freeOnUnref(function(e){this.consoleApi.LogMessage(this.consoleApi.E_LogLevel_Info,"[96m"+e+"[0m")}),t.prototype.warn=freeOnUnref(function(e){this.consoleApi.LogMessage(this.consoleApi.E_LogLevel_Warning,"[93m"+e+"[0m")}),t.prototype.error=freeOnUnref(function(e){this.consoleApi.LogMessage(this.consoleApi.E_LogLevel_Error,"[31m"+e+"[0m")}),t.load_console_api=freeOnUnref(function(e){return e||(e={LogMessage:freeOnUnref(function(e,t){}),E_LogLevel_Critical:0,E_LogLevel_Error:1,E_LogLevel_Warning:2,E_LogLevel_Info:3,E_LogLevel_Debug:4}),e}),t})(),r=new(t.Console=n);t.console=r}));e(I);I.Console,I.console;var k=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function t(){}return t.setUncaughtExceptionHandler=freeOnUnref(function(e){t._onUncaughtError=e}),t.onUncaughtError=freeOnUnref(function(e){if(void 0!==t._onUncaughtError)try{t._onUncaughtError(e)}catch(e){I.console.error("Error on handling uncaught error "+e)}else I.console.trace("No error handler was registered, the error is "+e)}),t})();t.UncaughtExceptionHandler=n}));e(k);k.UncaughtExceptionHandler;var _=t(freeOnUnref(function(e,t){function a(e){switch(e){case"high":return 0;case"normal":return 1;case"idle":return 2}}Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=c.tryGetVmManager()),this.functions=[],this.waitables=[],this.quitPending=!1,this.dummyWaitable=e,this.vmManager=t||null}return e.prototype.upperBoundPriority=freeOnUnref(function(e){for(var t=0,n=this.functions.length;t!==n;){var r=Math.floor((t+n)/2);e<this.functions[r].intPriority?n=r:t=r+1}return t}),e.prototype.lowerBoundPriority=freeOnUnref(function(e){for(var t=0,n=this.functions.length;t!==n;){var r=Math.floor((t+n)/2);this.functions[r].intPriority<e?t=r+1:n=r}return t}),e.prototype.insertFunctionRecord=freeOnUnref(function(e){var t=this.upperBoundPriority(e.intPriority);this.functions.splice(t,0,e),this.waitables.splice(t,0,e.waitable)}),e.prototype.insertFunction=freeOnUnref(function(e,t,n){var r,i,o;this.insertFunctionRecord((i=t,o=n,{priority:r=e,intPriority:a(r),waitable:i,tick:o}))}),e.prototype.deferFunction=freeOnUnref(function(e,t){this.insertFunction(e,this.getDummyWaitable(),freeOnUnref(function(){return t(),0}))}),e.prototype.tickAtPriority=freeOnUnref(function(e){for(var t=a(e),n=this.lowerBoundPriority(t);n<this.functions.length;++n){var r=this.functions[n];if(r.intPriority!==t)break;var i=0;try{i=r.tick()}catch(e){k.UncaughtExceptionHandler.onUncaughtError(e)}var o=0===i||1===i;if((0===i||3===i)&&(this.functions.splice(n,1),this.waitables.splice(n,1),n--),o)return!0}return!1}),e.prototype.getDummyWaitable=freeOnUnref(function(){if(!this.dummyWaitable){var e=c.tryGetVmManager();if(e){var t=e.PortCreateNamedPort("getDummyWaitable");this.dummyWaitable={dummyPort:t,dummyWaitable:e.PortGetMessageWaitable(t)}}else this.dummyWaitable={dummyPort:{},dummyWaitable:{}}}return this.dummyWaitable.dummyWaitable}),e.prototype.getWaitables=freeOnUnref(function(){return 0===this.waitables.length?[this.getDummyWaitable()]:this.waitables}),e.prototype.sendQuit=freeOnUnref(function(){this.quitPending=!0}),e.prototype.isQuitPending=freeOnUnref(function(){return this.quitPending||null!==this.vmManager&&this.vmManager.IsVmGroupRunningDown()}),e})();t.EventQueue=n}));e(_);_.EventQueue;var R=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var i=I.console,r=freeOnUnref(function(){return function(){this.next=null,this.prev=null}})();function o(e){if(null==e.next||null==e.prev)throw new Error("ListEntry is in an invalid state");e.prev.next=e.next,e.next.prev=e.prev,e.prev=null,e.next=null}var a={timeMs:-1,isInfinity:!0},s=freeOnUnref(function(o){function e(e,t,n,r){var i=o.call(this)||this;return i.handle=e,i.dueTimeMs=t,i.intervalMs=n,i.callback=r,i}return n(e,o),e})(r),l=freeOnUnref(function(){function n(e){var t;void 0===e&&(e=c.tryGetNative()),this.timerListHead=((t=new r).next=t).prev=t,this.nextTimerHandle=1,this.timerApi=n.load_timer_api(e)}return n.prototype.insertTimer=freeOnUnref(function(e){for(var t=this.timerListHead.next;t!==this.timerListHead;t=t.next){if(t.dueTimeMs.timeMs>e.dueTimeMs.timeMs)break}!function(e,t){if(null==e.next||null==e.prev)throw new Error("ListEntry is in an invalid state");t.next=e,t.prev=e.prev,(e.prev=t).prev.next=t}(t,e)}),n.prototype.createTimer=freeOnUnref(function(e,t,n){i.trace("Creating timer timeOutMs: "+e+" intervalMs: "+t);var r=this.nextTimerHandle;return++this.nextTimerHandle,this.insertTimer(new s(r,{timeMs:this.getCurrentTime().timeMs+e},t,n)),r}),n.prototype.cancelTimer=freeOnUnref(function(e){for(var t=this.timerListHead.next;t!==this.timerListHead;t=t.next){var n=t;if(n.handle===e)return void o(n)}}),n.prototype.getCurrentTime=freeOnUnref(function(){return{timeMs:this.timerApi.GetTime()}}),n.prototype.getTimeUntil=freeOnUnref(function(e,t){if(void 0===t&&(t=1e4),e.isInfinity)return t;var n=this.getCurrentTime();return n.timeMs>=e.timeMs?0:Math.min(t,e.timeMs-n.timeMs)}),n.prototype.runNextTimer=freeOnUnref(function(){if(this.timerListHead.next===this.timerListHead)return a;var e=this.getCurrentTime(),t=this.timerListHead.next;if(t.dueTimeMs.timeMs>e.timeMs)return t.dueTimeMs;o(t),0<t.intervalMs&&(t.dueTimeMs={timeMs:e.timeMs+t.intervalMs},this.insertTimer(t));try{t.callback()}catch(e){k.UncaughtExceptionHandler.onUncaughtError(e)}return null}),n.load_timer_api=freeOnUnref(function(e){return e||(e={GetTime:freeOnUnref(function(){return 0}),Time_GetMonotonicTimestamp:freeOnUnref(function(){return{seconds:0,milliseconds:0}})}),e}),n.Infinity=a,n})();t.TimerQueue=l}));e(R);R.TimerQueue;var D=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});de.get("MPBBuffer");var r=freeOnUnref(function(){return function(e){this.callbackManager=e}})(),i=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e)||this;return n.nativeAudioBuffer=t||c.tryGetNative(),n}return n(e,r),e.prototype.streamStart=freeOnUnref(function(t){var e=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.nativeAudioBuffer.UNF_AudioStreamStart(e),0}),e.prototype.streamFinish=freeOnUnref(function(t){var e=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.nativeAudioBuffer.UNF_AudioStreamFinish(e),0}),e.prototype.onAudioAccessUnit=freeOnUnref(function(e,t,n,r,i,o,a,s,l,f,u){var c=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){u(e.error_code)}));return i?this.nativeAudioBuffer.UNF_SendAudioEncryptedAU(c,r,e,t,n,o,a,s,l,f):this.nativeAudioBuffer.UNF_SendAudioUnencryptedAU(c,r,e,t,n),0}),e})(r);t.MPBAudioBuffer=i;var o=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e)||this;return n.nativeVideoBuffer=t||c.tryGetNative(),n}return n(e,r),e.prototype.streamStart=freeOnUnref(function(t){var e=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.nativeVideoBuffer.UNF_VideoStreamStart(e),0}),e.prototype.streamFinish=freeOnUnref(function(t){var e=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.nativeVideoBuffer.UNF_VideoStreamFinish(e),0}),e.prototype.onVideoAccessUnit=freeOnUnref(function(e,t,n,r,i,o,a,s,l,f,u,c,d,p){var h=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){p(e.error_code)}));return s?this.nativeVideoBuffer.UNF_SendVideoEncryptedAU(h,a,e,t,n,r,i,o,l,f,u,c,d):this.nativeVideoBuffer.UNF_SendVideoUnencryptedAU(h,a,e,t,n,r,i,o),0}),e})(r);t.MPBVideoBuffer=o}));e(D);D.MPBAudioBuffer,D.MPBVideoBuffer;var F=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("MPBControl"),n=freeOnUnref(function(){function e(e,t,n){this.ticks=e,this.timescale=t,this.errorCode=n}return e.prototype.getTicks=freeOnUnref(function(){return this.ticks}),e.prototype.getTimescale=freeOnUnref(function(){return this.timescale}),e.prototype.getErrorCode=freeOnUnref(function(){return this.errorCode}),e})(),r=freeOnUnref(function(){function e(e,t){this.numOfDroppedFrames=e,this.errorCode=t}return e.prototype.getNumDroppedFrames=freeOnUnref(function(){return this.numOfDroppedFrames}),e.prototype.getErrorCode=freeOnUnref(function(){return this.errorCode}),e})();t.MPBDiagnosticInfo=r;var i=freeOnUnref(function(){function e(e,t){this.callbackManager=e,this.mpbControlAPI=t||c.tryGetNative()}return e.prototype.bindListeners=freeOnUnref(function(t,n,r){var i=this;return this.callbackManager.registerEventCallback(this.callbackManager.getNativeUNFEventInterface().UNF_EventType_MPB_END_OF_STREAM,freeOnUnref(function(e){n("EndOfStream")}),"high"),this.callbackManager.registerEventCallback(this.callbackManager.getNativeUNFEventInterface().UNF_EventType_MPB_READY_TO_PLAY,freeOnUnref(function(e){n("ReadyToPlay")}),"high"),this.callbackManager.registerEventCallback(this.callbackManager.getNativeUNFEventInterface().UNF_EventType_MPB_BUFFER_UNDERRUN,freeOnUnref(function(e){n("BufferUnderrun")}),"high"),this.callbackManager.registerEventCallback(this.callbackManager.getNativeUNFEventInterface().UNF_EventType_MPB_PLAYBACK_STARTED,freeOnUnref(function(e){n("PlaybackStarted")}),"high"),this.callbackManager.registerEventCallback(this.callbackManager.getNativeUNFEventInterface().UNF_EventType_MPB_ERROR,freeOnUnref(function(e){t(e.integer,e.string,e.string_alt,e.integer_alt)}),"high"),this.callbackManager.registerEventCallback(this.callbackManager.getNativeUNFEventInterface().UNF_EventType_MPB_PICTURE_MODE_CHANGED,freeOnUnref(function(e){r(i.mapNativePictureModeToConnectorPictureMode(e.integer))}),"high"),0}),e.prototype.init=freeOnUnref(function(e,t){var n=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.mpbControlAPI.UNF_PlaybackInit(n,e),0}),e.prototype.setVideoOutputPosition=freeOnUnref(function(e,t,n,r,i){var o=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){i(e.error_code)}));return this.mpbControlAPI.UNF_SetVideoOutputPosition(o,e,t,n,r),0}),e.prototype.setSyeVideoOutputPosition=freeOnUnref(function(e,t,n,r,i){if(void 0!==this.mpbControlAPI.SYE_Mpb_SetVideoOutputPosition&&void 0!==this.getSyeNativeVersion()&&3<=this.getSyeNativeVersion().syeNative.major){var o=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){i(e.error_code)}));this.mpbControlAPI.SYE_Mpb_SetVideoOutputPosition(o,e,t,n,r)}else a.warn("SYE_Mpb_SetVideoOutputPosition is not implemented in Native"),i(-1);return 0}),e.prototype.getSyeNativeVersion=freeOnUnref(function(){if(void 0!==this.mpbControlAPI.SYE_GetVersion)return this.mpbControlAPI.SYE_GetVersion()}),e.prototype.isResizingSupported=freeOnUnref(function(){return void 0!==this.mpbControlAPI.IsFeatureSupported&&this.mpbControlAPI.IsFeatureSupported("IgnitionX_Can_Position_Player")}),e.prototype.play=freeOnUnref(function(t){var e=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.mpbControlAPI.UNF_PlaybackPlay(e),0}),e.prototype.shutdown=freeOnUnref(function(t){var e=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.mpbControlAPI.UNF_PlaybackShutdown(e),0}),e.prototype.pause=freeOnUnref(function(t){var e=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.mpbControlAPI.UNF_PlaybackPause(e),0}),e.prototype.seek=freeOnUnref(function(e,t,n){var r=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){n(e.error_code)}));return this.mpbControlAPI.UNF_PlaybackSeek(r,e,t),0}),e.prototype.stop=freeOnUnref(function(t){var e=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.mpbControlAPI.UNF_PlaybackStop(e),0}),e.prototype.getPlaybackTime=freeOnUnref(function(){var e=this.mpbControlAPI.UNF_GetPlaybackTime();return new n(e.ticks,e.timescale,e.error_code)}),e.prototype.getDiagnosticInfo=freeOnUnref(function(){var e=this.mpbControlAPI.UNF_GetDiagnosticInfo();return new r(e.num_dropped_frames,e.error_code)}),e.prototype.flush=freeOnUnref(function(t){var e=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.mpbControlAPI.UNF_PlaybackFlush(e),0}),e.prototype.setDrmSystem=freeOnUnref(function(e,t){var n=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){return t(e.error_code)}));return this.mpbControlAPI.UNF_SetDRMSystem(n,e.getDRMSystemID()),0}),e.prototype.setPictureMode=freeOnUnref(function(e,t){var n=this,r=this.mapConnectorPictureModeToNativePictureMode(e);if(void 0!==this.mpbControlAPI.UNF_SetPictureMode&&void 0!==r){var i=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){e.error_code===n.mpbControlAPI.UNF_MEDIA_PICTURE_MODE_NOT_FMM?t(50800):t(e.error_code)}));this.mpbControlAPI.UNF_SetPictureMode(i,r)}else this.mpbControlAPI.UNF_SetPictureMode,t(-1);return 0}),e.prototype.mapBufferEventCode=freeOnUnref(function(e){switch(e){case"EndOfStream":return c.tryGetNative().UNF_EventType_MPB_END_OF_STREAM;case"BufferUnderrun":return c.tryGetNative().UNF_EventType_MPB_BUFFER_UNDERRUN;case"PlaybackStarted":return c.tryGetNative().UNF_EventType_MPB_PLAYBACK_STARTED;case"ReadyToPlay":return c.tryGetNative().UNF_EventType_MPB_READY_TO_PLAY}}),e.prototype.onAudioMetadata=freeOnUnref(function(e,t,n,r){var i=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){r(e.error_code)}));return this.mpbControlAPI.UNF_SendAudioMetadata(i,e,t,n),0}),e.prototype.onVideoMetadata=freeOnUnref(function(e,t,n,r,i){var o=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){i(e.error_code)}));return this.mpbControlAPI.UNF_SendVideoMetadata(o,e,t,n,r),0}),e.prototype.mapConnectorPictureModeToNativePictureMode=freeOnUnref(function(e){switch(e){case 1:return this.mpbControlAPI.UNF_PICTURE_MODE_FILMMAKER;case 0:return this.mpbControlAPI.UNF_PICTURE_MODE_NONE;case 3:return this.mpbControlAPI.UNF_PICTURE_MODE_CM_CINEMATIC;case 2:return this.mpbControlAPI.UNF_PICTURE_MODE_CM_BROADCAST}}),e.prototype.mapNativePictureModeToConnectorPictureMode=freeOnUnref(function(e){switch(e){case this.mpbControlAPI.UNF_PICTURE_MODE_FILMMAKER:return 1;case this.mpbControlAPI.UNF_PICTURE_MODE_NONE:return 0;case this.mpbControlAPI.UNF_PICTURE_MODE_CM_CINEMATIC:return 3;case this.mpbControlAPI.UNF_PICTURE_MODE_CM_BROADCAST:return 2}return-1}),e.prototype.mapEventCodeToBufferEventType=freeOnUnref(function(e){switch(e){case this.callbackManager.getNativeUNFEventInterface().UNF_EventType_MPB_END_OF_STREAM:return"EndOfStream";case this.callbackManager.getNativeUNFEventInterface().UNF_EventType_MPB_BUFFER_UNDERRUN:return"BufferUnderrun";case this.callbackManager.getNativeUNFEventInterface().UNF_EventType_MPB_PLAYBACK_STARTED:return"PlaybackStarted";case this.callbackManager.getNativeUNFEventInterface().UNF_EventType_MPB_READY_TO_PLAY:return"ReadyToPlay"}}),e})(),o=freeOnUnref(function(){function e(e,t){this.callbackManager=e,this.mpbNativeAPI=t||c.tryGetNative()}return e.prototype.getMPBCommandAPI=freeOnUnref(function(){return new i(this.callbackManager,this.mpbNativeAPI.controlInterface||void 0)}),e.prototype.getMPBAudioBufferAPI=freeOnUnref(function(){return new D.MPBAudioBuffer(this.callbackManager,this.mpbNativeAPI.audioBufferInterface||void 0)}),e.prototype.getMPBVideoBufferAPI=freeOnUnref(function(){return new D.MPBVideoBuffer(this.callbackManager,this.mpbNativeAPI.videoBufferInterface||void 0)}),e})();t.MPBFactory=o}));e(F);F.MPBDiagnosticInfo,F.MPBFactory;var B=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=new(freeOnUnref(function(){function e(){this.xpConfiguration=null}return Object.defineProperty(e.prototype,"configuration",{get:freeOnUnref(function(){return this.xpConfiguration}),set:freeOnUnref(function(e){this.xpConfiguration=Object.freeze(e)}),enumerable:!0,configurable:!0}),e})());t.configurationStore=n}));e(B);B.configurationStore;var L=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.configurationStore=B.configurationStore}));e(L);L.configurationStore;var N=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("MetricsTimer");var n=freeOnUnref(function(){function e(e,t,n){this.metrics=e,this.metricName=t,this.marketplaceId=n,this.startTime=Date.now(),this.elapsedTime=null}return e.prototype.end=freeOnUnref(function(){return null===this.elapsedTime&&(this.elapsedTime=Date.now()-this.startTime,this.metrics.putMetric(this.metricName,this.elapsedTime,"ms",this.marketplaceId)),this.elapsedTime}),e})();t.MetricsTimer=n}));e(N);N.MetricsTimer;var V=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("Metrics"),n=freeOnUnref(function(){function e(){this.handler=freeOnUnref(function(){}),this.flusher=freeOnUnref(function(){})}return e.prototype.setHandler=freeOnUnref(function(e){this.handler=e}),e.prototype.setFlusher=freeOnUnref(function(e){this.flush(),this.flusher=e}),e.prototype.putMetric=freeOnUnref(function(t,e,n,r){try{this.handler(t,e,n,r)}catch(e){i.error("An error occurred while publishing metric "+t+": "+e.name+": "+e.message,e)}}),e.prototype.flush=freeOnUnref(function(){try{this.flusher()}catch(e){i.error("An error occurred while flushing metrics",e)}}),e.prototype.startTimer=freeOnUnref(function(e,t){return new N.MetricsTimer(this,e,t)}),e})();t.Metrics=n}));e(V);V.Metrics;var j=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Metrics=V.Metrics,t.MetricsTimer=N.MetricsTimer}));e(j);j.Metrics,j.MetricsTimer;var q=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=new j.Metrics;t.metrics=n}));e(q);q.metrics;var H=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=f.of("Header"),r=freeOnUnref(function(){function n(e,t){this.useFallbackDNS=!1,this.dnsOverrideMechanismExists=!1,this.eventQueue=e,this.nativeApi=n.loadNativeApi(t),"function"==typeof this.nativeApi.HTTP_SetDNSOverrides&&(this.dnsOverrideMechanismExists=!0)}return n.prototype.startRequest=freeOnUnref(function(e,t){var n=this,r={request:e,waitable:this.nativeApi.HTTP_GetWaitable(e),callback:t};this.eventQueue.insertFunction("normal",r.waitable,freeOnUnref(function(){return n.tickSingleRequest(r)}))}),n.prototype.tickSingleRequest=freeOnUnref(function(e){return this.nativeApi.HTTP_IsAsyncFinished(e.request)?(e.callback(this.nativeApi.HTTP_AsyncPullResult(e.request)),0):2}),n.loadNativeApi=freeOnUnref(function(e){if(!e){var t=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Not supported when not running on IgnitionX")});e={HTTP_CreateHandler:t,HTTP_AddHeader:t,HTTP_SendAsync:t,HTTP_IsAsyncFinished:t,HTTP_AsyncPullResult:t,HTTP_GetWaitable:t,HTTP_SetDownloadDestination:t,HTTP_CancelNonOwning:t,HTTP_SetTimeout:t,HTTP_KeepBodyOnFailure:t,HTTP_SetDNSOverrides:t,DiskStorage_OpenFile:t,DiskStorage_CreateFile:t,DiskStorage_CloseFile:t,DiskStorage_ReadFile:t,DiskStorage_WriteFile:t,DiskStorage_ReadFileBinary:t,DiskStorage_WriteFileBinary:t,DiskStorage_FileExists:t,DiskStorage_RemoveFile:t,DiskStorage_GetStorageSize:t,DiskStorage_GetFileInfo:t,DiskStorage_CopyFile:t,DiskStorage_MoveFile:t,DiskStorage_GetListOfFiles:t,DiskStorage_MoveFileBinaryAsExternalBuffer:t,DiskStorage_GetUpdatableAssetsFileName:t,DiskStorage_GetSupportedCompressionTypes:t,DiskStorage_OpenCompressedFileForRead:t,DiskStorage_CreateCompressedFileForWrite:t,GetStorageSizeInfo:t,GetScriptEngineType:t,DetachArrayBuffer:t}}return e}),n})();function s(e){var t=e.indexOf(":");return t?{key:e.substr(0,t).trim().toLowerCase(),value:e.substr(t+1).trim()}:null}var l,n=freeOnUnref(function(){function o(e,t,n,r,i){void 0===i&&(i=!1),this.aborted=!1,this.timedOut=!1,this.errorMessage="",this.headers={},this.fileName="",this.nativeApi=e,this.url=t,this.clientStatus=r.client_code,this.timedOut=this.didRequestTimeout(),this.aborted=i,this.httpStatus=r.http_code,this.loadedBytes=r.loaded_bytes,this.totalBytes=r.total_bytes,this.responseReceived=0<this.loadedBytes,this.redirectMs=r.redirect_time*o.SECONDS_TO_MILLISECONDS,this.connectMs=r.connect_time*o.SECONDS_TO_MILLISECONDS,this.appConnectMs=r.appconnect_time*o.SECONDS_TO_MILLISECONDS,this.pretransferMs=r.pretransfer_time*o.SECONDS_TO_MILLISECONDS,this.nameLookupMs=r.namelookup_time*o.SECONDS_TO_MILLISECONDS,this.totalMs=r.total_time*o.SECONDS_TO_MILLISECONDS,this.latencyMs=r.starttransfer_time*o.SECONDS_TO_MILLISECONDS,this.downloadMs=this.totalMs-this.latencyMs,this.responseType=n,this.aborted?this.responseBody={type:"error",reason:new Error("Attempting to read request body of an aborted request")}:(this.headers=function(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n],o=null;try{o=s(i)}catch(e){I.console.warn('Failed to convert header line with error "'+e.toString()+'". Retrying after re-encoding');try{o=s(new Buffer(i).toString("ISO-8859-1"))}catch(e){I.console.error('Failed to convert re-encoded header line with error "'+e.toString()+'". Header will be discarded.'),k.UncaughtExceptionHandler.onUncaughtError(e)}}null!==o&&(t[o.key]=o.value)}return t}(r.response_headers),a(r.location.storage_type).exists(),a(r.location.storage_type===c.NativeStorageType.IN_MEMORY).is.true(),this.fileName=r.location.file_name,this.responseBody=this.fetchResponseBody())}return o.prototype.getArrayBuffer=freeOnUnref(function(){if("arraybuffer"===this.responseBody.type){if(null==this.responseBody.body)throw new Error("[HttpResponse::getArrayBuffer] ArrayBuffer has been released");return this.responseBody.body}throw"error"===this.responseBody.type?this.responseBody.reason:new Error("[HttpResponse::getArrayBuffer] response type mismatch: "+this.responseType)}),o.prototype.getString=freeOnUnref(function(){if("text"===this.responseBody.type)return this.responseBody.body;if("error"===this.responseBody.type)throw this.responseBody.reason;return I.console.trace("Trying to get string from an HTTP Response, in which the type was set to arrayBuffer"),""}),o.prototype.getDataLocator=freeOnUnref(function(){if("datalocator"===this.responseBody.type)return this.responseBody.dataLocator;throw"error"===this.responseBody.type?this.responseBody.reason:new Error("[HttpResponse::getDataLocator] response type mismatch: "+this.responseType)}),o.prototype.release=freeOnUnref(function(){"arraybuffer"!==this.responseBody.type||null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.device&&!0===L.configurationStore.configuration.device.disableReleasingHttpArrayBuffers||(this.responseBody.body=null)}),o.prototype.fetchResponseBody=freeOnUnref(function(){if("datalocator"===this.responseType)return{type:"datalocator",dataLocator:this.fileName};var e,t=this.nativeApi.DiskStorage_OpenFile(c.NativeStorageType.IN_MEMORY,this.fileName);if(0!==t.error_code)return e="text"===this.responseType&&3===t.error_code&&400<=this.httpStatus?{type:"text",body:""}:{type:"error",reason:new Error("[HttpResponse::fetchResponseBody] open for "+this.responseType+" (with status "+this.httpStatus+") failed with error code: "+t.error_code)};if("text"===this.responseType){var n=this.nativeApi.DiskStorage_ReadFile(t.file_handler);e=0!==n.error_code?{type:"error",reason:new Error("[HttpResponse::fetchResponseBody] read for "+this.responseType+" failed with error code: "+n.error_code)}:{type:"text",body:n.data}}else{var r=this.nativeApi.DiskStorage_MoveFileBinaryAsExternalBuffer(t.file_handler);if(0!==r.error_code)e={type:"error",reason:new Error("[HttpResponse::fetchResponseBody] read for "+this.responseType+" failed with error code: "+r.error_code)};else{var i=r.data.externalBuffer.buffer;if(c.isRunningOnDuktape){var o=r.data;i.ignitionObject=o}e={type:"arraybuffer",body:i}}}this.nativeApi.DiskStorage_CloseFile(t.file_handler);var a=this.nativeApi.DiskStorage_RemoveFile(c.NativeStorageType.IN_MEMORY,this.fileName);return 0!==a&&I.console.trace("[HttpResponse.fetchResponseBody] delete response body failed with error code: "+a),e}),o.prototype.didRequestTimeout=freeOnUnref(function(){return 28===this.clientStatus}),o.SECONDS_TO_MILLISECONDS=1e3,o})();t.HttpResponse=n,freeOnUnref(function(e){e[e.NotStarted=0]="NotStarted",e[e.Started=1]="Started",e[e.Complete=2]="Complete"})(l||(l={}));var i=freeOnUnref(function(){function e(e,t,n,r,i){this.requestManager=e,this.method=t,this.url=n,this.callback=r,this.weblabs=i,this.aborted=!1,this.requestState=l.NotStarted,this.headers={},this.responseType="text",this.request=null,this.timeoutMs=null}return e.prototype.setTimeout=freeOnUnref(function(e){a(this.requestState===l.NotStarted).is.true(),this.timeoutMs=e}),e.prototype.addRequestHeader=freeOnUnref(function(e,t){a(this.requestState===l.NotStarted).is.true(),this.headers[e]=t}),e.prototype.setResponseType=freeOnUnref(function(e){a(this.requestState===l.NotStarted).is.true(),this.responseType=e}),e.prototype.sendResponse=freeOnUnref(function(e){this.requestState=l.Complete,this.callback(new n(this.requestManager.nativeApi,this.url,this.responseType,e,this.aborted))}),e.prototype.sendAbortResponse=freeOnUnref(function(e){this.requestManager.nativeApi.DiskStorage_RemoveFile(c.NativeStorageType.IN_MEMORY,e.location.file_name),this.sendResponse(e)}),e.prototype.sendWithFallbackDNS=freeOnUnref(function(e){var t=this,n=freeOnUnref(function(e){a(t.requestState===l.Started).is.true(),t.aborted?t.sendAbortResponse(e):(6!==e.client_code?q.metrics.putMetric("DNS_FALLBACK.SUCCEEDED"):q.metrics.putMetric("DNS_FALLBACK.FAILED"),t.sendResponse(e))});this.requestState=l.NotStarted,this.requestManager.startRequest(this.sendAsync(e,"8.8.8.8,8.8.4.4,1.1.1.1,2001:4860:4860::8888,2001:4860:4860::8844"),n)}),e.prototype.send=freeOnUnref(function(t){var n=this;if(this.requestManager.useFallbackDNS)this.sendWithFallbackDNS(t);else{var e=freeOnUnref(function(e){a(n.requestState===l.Started).is.true(),n.aborted?n.sendAbortResponse(e):!0===n.requestManager.dnsOverrideMechanismExists&&!1===n.requestManager.useFallbackDNS&&6===e.client_code?(n.requestManager.useFallbackDNS=!0,n.sendWithFallbackDNS(t)):n.sendResponse(e)});this.requestManager.startRequest(this.sendAsync(t),e)}}),e.prototype.abort=freeOnUnref(function(){this.aborted=!0,this.requestState===l.Started&&this.requestManager.nativeApi.HTTP_CancelNonOwning&&this.requestManager.nativeApi.HTTP_CancelNonOwning(this.request)}),e.prototype.sendAsync=freeOnUnref(function(e,t){void 0===t&&(t=""),a(this.requestState===l.NotStarted).is.true(),this.requestState=l.Started;var n=this.requestManager.nativeApi.HTTP_CreateHandler(this.method,this.url);""!==t&&this.requestManager.nativeApi.HTTP_SetDNSOverrides(n,t),null!==this.timeoutMs&&this.requestManager.nativeApi.HTTP_SetTimeout&&this.requestManager.nativeApi.HTTP_SetTimeout(n,this.timeoutMs);for(var r=0,i=Object.keys(this.headers);r<i.length;r++){var o=i[r];this.requestManager.nativeApi.HTTP_AddHeader(n,o+": "+this.headers[o])}return null!=this.requestManager.nativeApi.HTTP_KeepBodyOnFailure&&"function"==typeof this.requestManager.nativeApi.HTTP_KeepBodyOnFailure&&this.requestManager.nativeApi.HTTP_KeepBodyOnFailure(n,!0),this.requestManager.nativeApi.HTTP_SetDownloadDestination(n,c.NativeStorageType.IN_MEMORY),this.requestManager.nativeApi.HTTP_SendAsync(n,e||""),this.request=n}),e.prototype.getState=freeOnUnref(function(){switch(this.requestState){case l.NotStarted:return"UNSENT";case l.Started:return"OPENED";case l.Complete:return"DONE"}}),e.prototype.attachQuery=freeOnUnref(function(e){this.url+="?"+e}),e})();t.HttpRequest=i;var o=freeOnUnref(function(){function e(e,t,n){void 0===n&&(n=c.tryGetNative()),this.weblabsReader=t,this.requestManager=new r(e,n)}return e.prototype.createRequest=freeOnUnref(function(e,t,n){return new i(this.requestManager,e,t,n,this.weblabsReader.configuration)}),e})();t.Http=o}));e(H);H.HttpResponse,H.HttpRequest,H.Http;var z="PLAYBACK_XPPLAYER_PORT",W="PLAYBACK_LRC_PORT",K="IGNITION_X_UNF_STOP_VM",G=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=f.of("MessageBus"),r=freeOnUnref(function(){function e(e,t){void 0===t&&(t=c.tryGetVmManager()),this.callback=null,this.xppPort=null,this.lrcPort=null,this.eventQueue=e,this.vmManager=t||null,null!==this.vmManager&&(this.xppPort=this.vmManager.PortCreateNamedPort(z),n(this.xppPort).exists(),this.lrcPort=this.vmManager.PortCreateNamedPort(W),n(this.lrcPort).exists(),this.registerMessageBusCallback())}return e.prototype.sendMessage=freeOnUnref(function(e){null!==this.vmManager&&this.vmManager.PortPostMessage(this.lrcPort,e)}),e.prototype.registerMessageCallback=freeOnUnref(function(e){this.callback=e}),e.prototype.unregisterMessageCallback=freeOnUnref(function(){this.callback=null}),e.prototype.registerMessageBusCallback=freeOnUnref(function(){var n=this;this.eventQueue.insertFunction("normal",this.vmManager.PortGetMessageWaitable(this.xppPort),freeOnUnref(function(){var e=n.xppPort;if(n.vmManager.PortHasMessages(e)){var t=n.vmManager.PortPopMessage(e);if(t===K)return n.eventQueue.sendQuit(),1;if(null!==n.callback){try{n.callback(t)}catch(e){k.UncaughtExceptionHandler.onUncaughtError(e)}return 1}}return 2}))}),e})();t.MessageBus=r}));e(G);G.MessageBus;var Q=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.randomAPI=c.tryGetNative()||{GetRandomNumber:Math.random,RandomNumber_MinValue:0,RandomNumber_MaxValue:0}}return e.prototype.getRandom=freeOnUnref(function(){var e=this.randomAPI.GetRandomNumber(),t=this.randomAPI.RandomNumber_MinValue;return(e-t)/(this.randomAPI.RandomNumber_MaxValue+1-t)}),e})();t.Random=n}));e(Q);Q.Random;var X=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.nativeDeviceInformationAPI=c.tryGetNative()||{GetNativeCodeVersion:freeOnUnref(function(){return"Unknown"}),TTS_IsEnabled:freeOnUnref(function(){return!1})}}return e.prototype.getNativeCodeVersion=freeOnUnref(function(){return this.nativeDeviceInformationAPI.GetNativeCodeVersion()}),e.prototype.isTTSEnabled=freeOnUnref(function(){return null!=this.nativeDeviceInformationAPI.TTS_IsEnabled&&"function"==typeof this.nativeDeviceInformationAPI.TTS_IsEnabled&&this.nativeDeviceInformationAPI.TTS_IsEnabled()}),e})();t.NativeDeviceInformation=n}));e(X);X.NativeDeviceInformation;var Y=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function r(e,t){var n=this;this.callbackID=0,this.callbacks={},this.eventCallbacks={},this.eventQueue=e,this.eventUNFAPI=r.loadUNFEventAPI(t||c.tryGetNative()),e.insertFunction("high",this.eventUNFAPI.UNF_GetEventsWaitable(),freeOnUnref(function(){return n.eventLoopCallback()}))}return r.prototype.registerCallback=freeOnUnref(function(e,t){var n=this.callbackID++;return this.callbacks[n]={callback:e,priority:t},n}),r.prototype.registerEventCallback=freeOnUnref(function(e,t,n){void 0===n&&(n="normal"),this.eventCallbacks[e]={callback:t,priority:n}}),r.prototype.registerUNFCallback=freeOnUnref(function(e,t){return void 0===t&&(t="normal"),this.registerCallback(e,t)}),r.prototype.getNativeUNFEventInterface=freeOnUnref(function(){return this.eventUNFAPI}),r.prototype.getNextEvent=freeOnUnref(function(){return this.eventUNFAPI.UNF_TryGetEvent()}),r.prototype.getCallbackForEvent=freeOnUnref(function(e){var t;return e.event_type===this.eventUNFAPI.UNF_EventType_IS_CALLBACK?(t=this.callbacks[e.id]||null,delete this.callbacks[e.id]):t=this.eventCallbacks[e.event_type]||null,t}),r.prototype.eventLoopCallback=freeOnUnref(function(){var e=this.getNextEvent();if(null===e)return 2;var t=null;if(null===(t=this.getCallbackForEvent(e)))return 2;if("high"===t.priority){try{t.callback(e)}catch(e){k.UncaughtExceptionHandler.onUncaughtError(e)}return 1}return this.eventQueue.deferFunction(t.priority,freeOnUnref(function(){t.callback(e)})),2}),r.loadUNFEventAPI=freeOnUnref(function(e){return e||(e={UNF_TryGetEvent:freeOnUnref(function(){throw"Mock Native.UNF_TryGetEvent called -- this happened because the event queue started running without Native object, are we running on IgnitionX?"}),UNF_GetEventsWaitable:freeOnUnref(function(){return{}})}),e}),r})();t.CallbackManager=n}));e(Y);Y.CallbackManager;var J=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=freeOnUnref(function(){function e(e,t,n,r){this.systemID=e,this.parent=t,this.callbackManager=n,this.drmAPI=r,this.pseudoCookieIDs={}}return e.prototype.getDRMSystemID=freeOnUnref(function(){return this.systemID}),e.prototype.createSession=freeOnUnref(function(t,e,n){var r=this,i=this.parent.addCallback(e),o=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){0===e.error_code?(r.pseudoCookieIDs[e.string]=i,t(e.error_code,e.string)):t(e.error_code)})),a=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){if(0!==e.error_code){for(var t in r.pseudoCookieIDs)if(r.pseudoCookieIDs[t]===i){delete r.pseudoCookieIDs[t];break}r.parent.removeCallback(i)}n(e.error_code)}));return this.drmAPI.UNF_DRM_CreateSession(o,a,i,this.systemID)}),e.prototype.destroySession=freeOnUnref(function(e,t){void 0!==this.pseudoCookieIDs[e]&&(this.parent.removeCallback(this.pseudoCookieIDs[e]),delete this.pseudoCookieIDs[e]);var n=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.drmAPI.UNF_DRM_DestroySession(n,this.systemID,e)}),e.prototype.releaseSessionKeys=freeOnUnref(function(e,t){var n=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.drmAPI.UNF_DRM_ReleaseKeys(n,this.systemID,e)}),e.prototype.generateRequest=freeOnUnref(function(e,t,n){var r=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){n(e.error_code)}));return this.drmAPI.UNF_DRM_GenerateRequest(r,this.systemID,e,t)}),e.prototype.processResponse=freeOnUnref(function(e,t,n){var r=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){n(e.error_code)}));return this.drmAPI.UNF_DRM_ProcessResponse(r,this.systemID,e,t)}),e.prototype.deregisterSessionMessageCallback=freeOnUnref(function(e,t){void 0!==this.pseudoCookieIDs[e]&&(this.parent.removeCallback(this.pseudoCookieIDs[e]),delete this.pseudoCookieIDs[e]);var n=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.drmAPI.UNF_DRM_DeregisterCallback(n,this.systemID,e)}),e})();t.DRMSystemAPI=i;var n=freeOnUnref(function(){function e(e,t){this.callbackManager=e,this.callbacks={},this.pseudoCookieID=0,this.drmAPI=t||c.tryGetNative(),this.init()}return e.prototype.startDRM=freeOnUnref(function(e,t){var n=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.drmAPI.UNF_DRM_StartAPI(n,e)}),e.prototype.stopDRM=freeOnUnref(function(t){var e=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.drmAPI.UNF_DRM_StopAPI(e)}),e.prototype.createSystem=freeOnUnref(function(n){var r=this,e=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){if(0===e.error_code){var t=new i(e.integer,r,r.callbackManager,r.drmAPI);n(e.error_code,t)}else n(e.error_code)}));return this.drmAPI.UNF_DRM_CreateSystem(e)}),e.prototype.destroySystem=freeOnUnref(function(e,t){var n=this.callbackManager.registerUNFCallback(freeOnUnref(function(e){t(e.error_code)}));return this.drmAPI.UNF_DRM_DestroySystem(n,e.getDRMSystemID())}),e.prototype.addCallback=freeOnUnref(function(e){var t=this.pseudoCookieID++;return this.callbacks[t]=e,t}),e.prototype.removeCallback=freeOnUnref(function(e){delete this.callbacks[e]}),e.prototype.init=freeOnUnref(function(){var t=this;void 0!==this.drmAPI&&this.callbackManager.registerEventCallback(this.drmAPI.UNF_EventType_DRM_CALLBACK,freeOnUnref(function(e){t.drmCallback(e)}))}),e.prototype.drmCallback=freeOnUnref(function(e){var t=this.callbacks[e.id]||null;if(null!==t){var n;switch(e.integer){case this.drmAPI.UNF_DRM_MessageType_LICENSE_REQUEST:n="LICENSE_REQUEST";break;case this.drmAPI.UNF_DRM_MessageType_LICENSE_RENEWAL:n="LICENSE_RENEWAL";break;case this.drmAPI.UNF_DRM_MessageType_LICENSE_RELEASE:n="LICENSE_RELEASE";break;case this.drmAPI.UNF_DRM_MessageType_INDIVIDUALIZATION_REQUEST:n="INDIVIDUALIZATION_REQUEST";break;default:throw"Unknown DRM MessageType"}t({getMessageType:freeOnUnref(function(){return n}),getMessageBuffer:freeOnUnref(function(){return e.buffer})})}}),e})();t.DRMSystemFactoryAPI=n}));e(J);J.DRMSystemAPI,J.DRMSystemFactoryAPI;var Z=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.errorCodeAPI=e||c.tryGetNative()||{}}return e.prototype.MPBCommandFlushed=freeOnUnref(function(){return this.errorCodeAPI.UNF_ErrorCode_COMMAND_FLUSHED}),e.prototype.DRMAlreadyInitialized=freeOnUnref(function(){return this.errorCodeAPI.UNF_DRM_Error_ALREADY_INITIALIZED}),e.prototype.DRMNotInitialized=freeOnUnref(function(){return this.errorCodeAPI.UNF_DRM_Error_NOT_INITIALIZED}),e.prototype.DRMInvalidContextID=freeOnUnref(function(){return this.errorCodeAPI.UNF_DRM_Error_INVALID_CONTEXT_ID}),e.prototype.DRMInvalidSessionID=freeOnUnref(function(){return this.errorCodeAPI.UNF_DRM_Error_INVALID_SESSION_ID}),e.prototype.DRMCreateSessionFailed=freeOnUnref(function(){return this.errorCodeAPI.UNF_DRM_Error_CREATE_SESSION_FAILED}),e})();t.ErrorCodes=n}));e(Z);Z.ErrorCodes;var $=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){void 0===e&&(e=c.tryGetNative()),void 0===t&&(t=c.tryGetNative()),this.metricsAPI=e,this.timerAPI=t,this.processTimes={lastProcessTimes:null,currentProcessTimes:this.getProcessCpuUtilisationTimes(),lastMonotonicTime:void 0,currentMonotonicTime:this.getMonotonicTimestampMs()},this.systemTimes={lastSystemTimes:null,currentSystemTimes:this.getSystemCpuUtilisationTimes()}}return e.prototype.getPlayerHeapMemory=freeOnUnref(function(){if(!this.metricsAPI||!this.metricsAPI.GetCurrentThreadScriptAllocatedMemory)return null;var e=this.metricsAPI.GetCurrentThreadScriptAllocatedMemory();return!e||e<0?null:e/1024}),e.prototype.getPlayerPeakHeapMemory=freeOnUnref(function(){if(!this.metricsAPI||!this.metricsAPI.GetCurrentThreadScriptPeakAllocatedMemory)return null;var e=this.metricsAPI.GetCurrentThreadScriptPeakAllocatedMemory();return!e||e<0?null:e/1024}),e.prototype.getProcessCpuUtilisation=freeOnUnref(function(){return this.processTimes.lastProcessTimes=this.processTimes.currentProcessTimes,this.processTimes.lastMonotonicTime=this.processTimes.currentMonotonicTime,this.processTimes.currentProcessTimes=this.getProcessCpuUtilisationTimes(),this.processTimes.currentMonotonicTime=this.getMonotonicTimestampMs(),this.processTimes.currentMonotonicTime&&this.processTimes.lastMonotonicTime&&this.processTimes.lastProcessTimes&&this.processTimes.currentProcessTimes?this.calculateProcessCpuUtilisation():null}),e.prototype.getProcessRssMemory=freeOnUnref(function(){if(!this.metricsAPI||!this.metricsAPI.GetProcessMem)return null;var e=this.metricsAPI.GetProcessMem();return!e||e<0?null:e}),e.prototype.getSystemCpuUtilisation=freeOnUnref(function(){return this.systemTimes.lastSystemTimes=this.systemTimes.currentSystemTimes,this.systemTimes.currentSystemTimes=this.getSystemCpuUtilisationTimes(),this.systemTimes.currentSystemTimes&&this.systemTimes.lastSystemTimes?this.calculateSystemCpuUtilisation():null}),e.prototype.getProcessCpuUtilisationTimes=freeOnUnref(function(){return this.metricsAPI&&this.metricsAPI.GetProcessCpuUtilisationTimes?this.metricsAPI.GetProcessCpuUtilisationTimes():null}),e.prototype.getSystemCpuUtilisationTimes=freeOnUnref(function(){return this.metricsAPI&&this.metricsAPI.GetSystemCpuUtilisationTimes?this.metricsAPI.GetSystemCpuUtilisationTimes():null}),e.prototype.getMonotonicTimestampMs=freeOnUnref(function(){if(this.timerAPI&&this.timerAPI.Time_GetMonotonicTimestamp){var e=this.timerAPI.Time_GetMonotonicTimestamp();return 1e3*e.seconds+e.milliseconds}}),e.prototype.calculateProcessCpuUtilisation=freeOnUnref(function(){return(this.processTimes.currentProcessTimes.kernel_time+this.processTimes.currentProcessTimes.user_time-(this.processTimes.lastProcessTimes.kernel_time+this.processTimes.lastProcessTimes.user_time))/(this.processTimes.currentMonotonicTime-this.processTimes.lastMonotonicTime)*100}),e.prototype.calculateSystemCpuUtilisation=freeOnUnref(function(){var e=this.systemTimes.currentSystemTimes.kernel_time+this.systemTimes.currentSystemTimes.user_time+this.systemTimes.currentSystemTimes.idle_time,t=this.systemTimes.lastSystemTimes.kernel_time+this.systemTimes.lastSystemTimes.user_time+this.systemTimes.lastSystemTimes.idle_time;return 100*(1-(this.systemTimes.currentSystemTimes.idle_time-this.systemTimes.lastSystemTimes.idle_time)/(e-t))}),e})();t.Metrics=n}));e($);$.Metrics;var ee=t(freeOnUnref(function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function n(e,t){this.nativeApi=e,this.configFilePath=t}return n.getInstance=freeOnUnref(function(e,t){return void 0===e&&(e=c.tryGetNative()),void 0===t&&(t=n.INJECTED_CONFIG_FILE_PATH),r||(r=new n(n.loadNativeApi(e),t))}),Object.defineProperty(n.prototype,"configuration",{get:freeOnUnref(function(){return this.weblabs||(this.weblabs=this.getConfigFromBootstrap(),I.console.info("available weblabs "+JSON.stringify(this.weblabs))),this.weblabs}),enumerable:!0,configurable:!0}),n.prototype.getConfigFromBootstrap=freeOnUnref(function(){var e={},t=c.NativeStorageType.IN_MEMORY;I.console.info('Loading configuration from "'+this.configFilePath+'" (storage type: '+t+")");var n=this.nativeApi.DiskStorage_OpenFile(t,this.configFilePath);if(0!==n.error_code)return I.console.warn('Opening file "'+this.configFilePath+'" failed with error code: '+n.error_code),e;var r=this.nativeApi.DiskStorage_ReadFile(n.file_handler);if(this.nativeApi.DiskStorage_CloseFile(n.file_handler),0!==r.error_code)return I.console.warn('Reading configuration from "'+this.configFilePath+'" failed: '+r.error_code+"."),e;try{var i=JSON.parse(r.data);null!=i.weblabs&&(I.console.info('Configuration loaded successfully from "'+this.configFilePath+'"'),e=i.weblabs)}catch(e){I.console.warn('Parsing configuration from "'+this.configFilePath+'" failed: '+e)}return e}),n.loadNativeApi=freeOnUnref(function(e){if(!e){var t=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Not supported when not running on IgnitionX")});e={DiskStorage_OpenFile:t,DiskStorage_CreateFile:t,DiskStorage_CloseFile:t,DiskStorage_ReadFile:t,DiskStorage_WriteFile:t,DiskStorage_ReadFileBinary:t,DiskStorage_WriteFileBinary:t,DiskStorage_FileExists:t,DiskStorage_RemoveFile:t,DiskStorage_GetStorageSize:t,DiskStorage_GetFileInfo:t,DiskStorage_CopyFile:t,DiskStorage_MoveFile:t,DiskStorage_GetListOfFiles:t,DiskStorage_MoveFileBinaryAsExternalBuffer:t,DiskStorage_GetUpdatableAssetsFileName:t,DiskStorage_GetSupportedCompressionTypes:t,DiskStorage_OpenCompressedFileForRead:t,DiskStorage_CreateCompressedFileForWrite:t,GetStorageSizeInfo:t}}return e}),n.INJECTED_CONFIG_FILE_PATH="hybrid_config.json",n})();t.WeblabsConfigReader=n}));e(ee);ee.WeblabsConfigReader;var te=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("Storage");var n=freeOnUnref(function(){function t(e){void 0===e&&(e=c.tryGetNative()),this.diskStorageApi=t.loadNativeApi(e)}return t.prototype.getText=freeOnUnref(function(e,t){var n=this.diskStorageApi.DiskStorage_OpenFile(e,t);if(n.error_code===c.StorageErrorCode.FILE_DOES_NOT_EXIST)return null;if(n.error_code!==c.StorageErrorCode.OK)throw new Error("File for "+t+" could not be opened");var r=this.diskStorageApi.DiskStorage_ReadFile(n.file_handler);if(this.diskStorageApi.DiskStorage_CloseFile(n.file_handler),r.error_code!==c.StorageErrorCode.OK)throw new Error("File for "+t+" could not be read");if("string"==typeof r.data)return r.data;throw new Error("Not valid data type returned for "+t)}),t.prototype.getBinaryDataFromMemory=freeOnUnref(function(e,t){void 0===t&&(t=c.NativeStorageType.IN_MEMORY);var n=this.diskStorageApi.DiskStorage_OpenFile(t,e);if(n.error_code===c.StorageErrorCode.FILE_DOES_NOT_EXIST)return null;if(n.error_code!==c.StorageErrorCode.OK)throw new Error("File for "+e+" could not be opened");try{var r=this.diskStorageApi.DiskStorage_MoveFileBinaryAsExternalBuffer(n.file_handler);if(r.error_code!==c.StorageErrorCode.OK)throw new Error("File for "+e+" could not be read as external buffer");var i=r.data.externalBuffer.buffer;return new Uint8Array(i)}finally{this.diskStorageApi.DiskStorage_CloseFile(n.file_handler)}}),t.prototype.getBinaryDataFromCache=freeOnUnref(function(e){var t="_TMP_IN_MEMORY_"+e,n=this.diskStorageApi.DiskStorage_CopyFile(c.NativeStorageType.IN_MEMORY,t,c.NativeStorageType.CACHE,e);if(n===c.StorageErrorCode.FILE_DOES_NOT_EXIST)return null;if(n!==c.StorageErrorCode.OK)throw new Error("Failed to copy cached file to memory: "+n);var r=this.getBinaryDataFromMemory(t);return this.diskStorageApi.DiskStorage_RemoveFile(c.NativeStorageType.IN_MEMORY,t),r}),t.prototype.getBinaryData=freeOnUnref(function(e,t){if(e===c.NativeStorageType.IN_MEMORY||e===c.NativeStorageType.TMP)return this.getBinaryDataFromMemory(t,e);if(e===c.NativeStorageType.CACHE)return this.getBinaryDataFromCache(t);throw new Error("StorageType "+e+" not supported.")}),t.prototype.listKeys=freeOnUnref(function(e){return this.diskStorageApi.DiskStorage_GetListOfFiles(e)}),t.prototype.put=freeOnUnref(function(e,t,n){this.remove(e,t);var r,i=this.diskStorageApi.DiskStorage_CreateFile(e,t);if(i.error_code!==c.StorageErrorCode.OK)throw new Error("Failed to create file for key: "+t);if("string"==typeof n)r=this.diskStorageApi.DiskStorage_WriteFile(i.file_handler,n);else{var o=new Uint8Array(n);r=this.diskStorageApi.DiskStorage_WriteFileBinary(i.file_handler,o)}if(this.diskStorageApi.DiskStorage_CloseFile(i.file_handler),r!==c.StorageErrorCode.OK)throw new Error("Failed to write to file for key: "+t)}),t.prototype.remove=freeOnUnref(function(e,t){var n=this.diskStorageApi.DiskStorage_RemoveFile(e,t);if(n!==c.StorageErrorCode.OK&&n!==c.StorageErrorCode.FILE_DOES_NOT_EXIST)throw new Error("Failed to remove file for key: "+t)}),t.prototype.getStorageSize=freeOnUnref(function(e){return this.diskStorageApi.DiskStorage_GetStorageSize(e)}),t.loadNativeApi=freeOnUnref(function(e){if(!e){var t=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Not supported when not running on IgnitionX")});e={DiskStorage_OpenFile:t,DiskStorage_CreateFile:t,DiskStorage_CloseFile:t,DiskStorage_ReadFile:t,DiskStorage_WriteFile:t,DiskStorage_ReadFileBinary:t,DiskStorage_WriteFileBinary:t,DiskStorage_FileExists:t,DiskStorage_RemoveFile:t,DiskStorage_GetStorageSize:t,DiskStorage_GetFileInfo:t,DiskStorage_CopyFile:t,DiskStorage_MoveFile:t,DiskStorage_GetListOfFiles:t,DiskStorage_MoveFileBinaryAsExternalBuffer:t,DiskStorage_GetUpdatableAssetsFileName:t,DiskStorage_GetSupportedCompressionTypes:t,DiskStorage_OpenCompressedFileForRead:t,DiskStorage_CreateCompressedFileForWrite:t,GetStorageSizeInfo:t}}return e}),t})();t.Storage=n}));e(te);te.Storage;var ne=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=c.tryGetNative()),this.nativeAPI=e,this.unfContext=null,this.unfAPIs=null,this._unfInstanceInitialized=!1,I.console.info("Initializing IgnitionXConnector to run as UNF"),this.timerAPI=new R.TimerQueue(e),this.consoleAPI=I.console,this.eventQueueAPI=new _.EventQueue,this.clientWeblabConfig=ee.WeblabsConfigReader.getInstance(e),this.httpAPI=new H.Http(this.eventQueueAPI,this.clientWeblabConfig,e),this.messageBusAPI=new G.MessageBus(this.eventQueueAPI),this.randomAPI=new Q.Random,this.nativeDeviceInformationAPI=new X.NativeDeviceInformation,this.storageAPI=new te.Storage(e),this.metricsAPI=new $.Metrics(e)}return Object.defineProperty(e.prototype,"unfCallbackAPI",{get:freeOnUnref(function(){var e=this.getUNFAPIs();if(null==e)throw new Error("Attempted to access UNF Callback API, but the device does not support UNF");return e.unfCallbackAPI}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"devicePropertiesAPI",{get:freeOnUnref(function(){return w.getDevicePropAPI()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mpbFactoryAPI",{get:freeOnUnref(function(){var e=this.getUNFAPIs();if(null==e)throw new Error("Attempted to access UNF MPB Factory API, but the device does not support UNF");return e.mpbFactoryAPI}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drmSystemFactoryAPI",{get:freeOnUnref(function(){var e=this.getUNFAPIs();if(null==e)throw new Error("Attempted to access DRM System Factory API, but the device does not support UNF");return e.drmSystemFactoryAPI}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorCodeAPI",{get:freeOnUnref(function(){var e=this.getUNFAPIs();if(null==e)throw new Error("Attempted to access UNF Error Code API, but the device does not support UNF");return e.errorCodeAPI}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unfInstanceInitialized",{get:freeOnUnref(function(){return this._unfInstanceInitialized}),enumerable:!0,configurable:!0}),e.prototype.run=freeOnUnref(function(){for(;;)if(!this.eventQueueAPI.tickAtPriority("high")&&!this.eventQueueAPI.tickAtPriority("normal")){var e=this.timerAPI.runNextTimer();if(e){if(this.eventQueueAPI.isQuitPending()){I.console.trace("Event queue is terminating");break}if(!this.eventQueueAPI.tickAtPriority("idle")){var t=this.timerAPI.getTimeUntil(e);0<t&&(I.console.trace("Event loop waiting for "+t+" milliseconds"),c.tryGetVmManager().WaitForOneWithTimeout(this.eventQueueAPI.getWaitables(),1e3*t))}}else I.console.trace("Timer expired")}this.unfAPIs=null,this.unfContext=null}),e.prototype.onUncaughtExceptionHandler=freeOnUnref(function(e){k.UncaughtExceptionHandler.setUncaughtExceptionHandler(e)}),e.prototype.getUNFAPIs=freeOnUnref(function(){if(null!=this.unfAPIs)return this.unfAPIs;if(null==this.unfContext){if("function"!=typeof this.nativeAPI.UNF_Get_Context)return;this.unfContext=this.nativeAPI.UNF_Get_Context(),this._unfInstanceInitialized=!0}var e=new Y.CallbackManager(this.eventQueueAPI,this.nativeAPI);return this.unfAPIs={unfCallbackAPI:e,mpbFactoryAPI:new F.MPBFactory(e,this.nativeAPI),drmSystemFactoryAPI:new J.DRMSystemFactoryAPI(e,this.nativeAPI),errorCodeAPI:new Z.ErrorCodes(this.nativeAPI)},this.unfAPIs}),e})(),r=new(t.Connector=n);t.connector=r}));e(ne);ne.Connector,ne.connector;var re=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.connector=ne.connector,t.tryGetNative=c.tryGetNative,t.tryGetVmManager=c.tryGetVmManager,t.NativeStorageType=c.NativeStorageType,t.isUNFSupported=c.isUNFSupported}));e(re);re.connector,re.tryGetNative,re.tryGetVmManager,re.NativeStorageType,re.isUNFSupported;var ie=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=f.of("TimerAdapter"),n=freeOnUnref(function(){function n(e){void 0===e&&(e=re.connector.timerAPI),this.timerAPI=e}return n.prototype.startTimer=freeOnUnref(function(e,t,n){return this.timerAPI.createTimer(t,n,e)}),n.prototype.stopTimer=freeOnUnref(function(e){r(!l.isNaN(e)).is.true();try{this.timerAPI.cancelTimer(e)}catch(e){if(!(e instanceof TypeError))throw e}}),n.prototype.setTimeout=freeOnUnref(function(e,t){return(n.MAX_TIMEOUT_MS<=(t*=1)||t<0||isNaN(t))&&(t=1),this.startTimer(e,t,0)}),n.prototype.setInterval=freeOnUnref(function(e,t){return(n.MAX_TIMEOUT_MS<=(t*=1)||t<0||isNaN(t))&&(t=1),this.startTimer(e,t,t)}),n.prototype.setImmediate=freeOnUnref(function(e){return this.startTimer(e,0,0)}),n.prototype.clearTimeout=freeOnUnref(function(e){this.stopTimer(e)}),n.prototype.clearInterval=freeOnUnref(function(e){this.stopTimer(e)}),n.prototype.clearImmediate=freeOnUnref(function(e){this.stopTimer(e)}),n.MAX_TIMEOUT_MS=2147483648,n.INVALID_HANDLE=10016,n})();t.TimerAdapter=n}));e(ie);ie.TimerAdapter;var oe=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=ie.TimerAdapter;var n=new ie.TimerAdapter;t.timer=n}));e(oe);oe.Timer,oe.timer;var ae=oe.timer;function se(e,t){return ae.setTimeout(e,t)}function le(e){ae.clearTimeout(e)}function fe(e,t){return ae.setInterval(e,t)}function ue(e){ae.clearInterval(e)}var pe=function(){if("undefined"!=typeof Native){var e=new Function("return this;")();void 0===e.setTimeout&&(Object.defineProperty(e,"setTimeout",{value:se,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(e,"clearTimeout",{value:le,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(e,"setInterval",{value:fe,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(e,"clearInterval",{value:ue,writable:!0,enumerable:!1,configurable:!0}))}},he=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=f.of("MessageBusAdapter"),n=freeOnUnref(function(){function e(e){void 0===e&&(e=re.connector.messageBusAPI);var i=this;this.callErrorHandlers=freeOnUnref(function(e){o(e,"message").exists();for(var t=0,n=i.errorHandlers;t<n.length;t++){(0,n[t])(e)}}),this.callEventHandlers=freeOnUnref(function(e){o(i.initialized).is.true(),o(e,"message").exists();var t=null;try{t=JSON.parse(e)}catch(e){return void i.callErrorHandlers("Message parse failed with error: "+e)}if(null!=t)if(null!=t.messageName)if(null!=t.payload)for(var n=0,r=i.eventHandlers;n<r.length;n++){(0,r[n])(t.messageName,t.payload)}else i.callErrorHandlers("Message does not have payload");else i.callErrorHandlers("Message does not have messageName")}),this.messageBusAPI=e,this.eventHandlers=[],this.initialized=!1,this.errorHandlers=[]}return e.prototype.sendMessage=freeOnUnref(function(e,t){o(this.initialized).is.true(),o(e,"message").exists(),o(t,"payload").exists(),this.messageBusAPI.sendMessage(this.generateNativeMessage(e,t))}),e.prototype.onMessage=freeOnUnref(function(e){o(this.initialized).is.true(),o(e,"handler").exists(),this.eventHandlers.indexOf(e)<0&&(this.eventHandlers.push(e),1===this.eventHandlers.length&&this.messageBusAPI.registerMessageCallback(this.callEventHandlers))}),e.prototype.offMessage=freeOnUnref(function(e){o(this.initialized).is.true(),o(e,"handler").exists();var t=this.eventHandlers.indexOf(e);o(-1<t).is.true(),this.eventHandlers.splice(t,1),0===this.eventHandlers.length&&this.messageBusAPI.unregisterMessageCallback()}),e.prototype.init=freeOnUnref(function(){o(this.initialized).is.false(),this.eventHandlers=[],this.initialized=!0}),Object.defineProperty(e.prototype,"isInitialized",{get:freeOnUnref(function(){return this.initialized}),enumerable:!0,configurable:!0}),e.prototype.shutdown=freeOnUnref(function(){o(this.initialized).is.true(),0<this.eventHandlers.length&&(this.eventHandlers=[],this.messageBusAPI.unregisterMessageCallback()),this.initialized=!1}),e.prototype.generateNativeMessage=freeOnUnref(function(e,t){var n={messageName:e,payload:t};return JSON.stringify(n)}),e.prototype.onError=freeOnUnref(function(e){o(e,"handler").exists(),this.errorHandlers.indexOf(e)<0&&this.errorHandlers.push(e)}),e.prototype.offError=freeOnUnref(function(e){o(e,"handler").exists();var t=this.errorHandlers.indexOf(e);o(-1<t).is.true(),this.errorHandlers.splice(t,1)}),e})();t.MessageBusAdapter=n}));e(he);he.MessageBusAdapter;var me=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageBus=he.MessageBusAdapter;var n=new he.MessageBusAdapter;t.messageBus=n}));e(me);me.MessageBus,me.messageBus;var ye=t(freeOnUnref(function(e,t){function n(e){var t=[];for(var n in e)t.push(n);return t}(e.exports="function"==typeof Object.keys?Object.keys:n).shim=n})),ge=(ye.shim,t(freeOnUnref(function(e,t){var n="[object Arguments]"==freeOnUnref(function(){return Object.prototype.toString.call(arguments)})();function r(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function i(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=n?r:i).supported=r,t.unsupported=i}))),ve=(ge.supported,ge.unsupported,t(freeOnUnref(function(e){var s=Array.prototype.slice,l=e.exports=freeOnUnref(function(e,t,n){return n||(n={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?n.strict?e===t:e==t:function(e,t,n){var r,i;if(f(e)||f(t))return!1;if(e.prototype!==t.prototype)return!1;if(ge(e))return!!ge(t)&&(e=s.call(e),t=s.call(t),l(e,t,n));if(u(e)){if(!u(t))return!1;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}try{var o=ye(e),a=ye(t)}catch(e){return!1}if(o.length!=a.length)return!1;for(o.sort(),a.sort(),r=o.length-1;0<=r;r--)if(o[r]!=a[r])return!1;for(r=o.length-1;0<=r;r--)if(i=o[r],!l(e[i],t[i],n))return!1;return typeof e==typeof t}(e,t,n))});function f(e){return null==e}function u(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(0<e.length&&"number"!=typeof e[0]))}}))),Oe=ce&&ce.__extends||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),Se=Object.prototype.hasOwnProperty;function Ue(e,t){return Se.call(e,t)}function be(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)Ue(e,r)&&t.push(r);return t}function Pe(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Me(e,t){var n;for(var r in e)if(Ue(e,r)){if(e[r]===t)return Pe(r)+"/";if("object"==typeof e[r]&&""!=(n=Me(e[r],t)))return Pe(r)+"/"+n}return""}var Ce={hasOwnProperty:Ue,_objectKeys:be,_deepClone:function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},isInteger:function(e){for(var t,n=0,r=e.length;n<r;){if(!(48<=(t=e.charCodeAt(n))&&t<=57))return!1;n++}return!0},escapePathComponent:Pe,unescapePathComponent:function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},_getPathRecursive:Me,getPath:function(e,t){if(e===t)return"/";var n=Me(e,t);if(""===n)throw new Error("Object not found in root");return"/"+n},hasUndefined:function e(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0}else if("object"==typeof t){var i=be(t),o=i.length;for(n=0;n<o;n++)if(e(t[i[n]]))return!0}return!1},PatchError:freeOnUnref(function(o){function e(e,t,n,r,i){o.call(this,e),this.message=e,this.name=t,this.index=n,this.operation=r,this.tree=i}return Oe(e,o),e})(Error)},Ee=t(freeOnUnref(function(e,d){var n={strict:!0},p=freeOnUnref(function(e,t){return ve(e,t,n)});d.JsonPatchError=Ce.PatchError,d.deepClone=Ce._deepClone;var h={add:freeOnUnref(function(e,t,n){return e[t]=this.value,{newDocument:n}}),remove:freeOnUnref(function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}}),replace:freeOnUnref(function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}}),move:freeOnUnref(function(e,t,n){var r=y(n,this.path);r&&(r=Ce._deepClone(r));var i=s(n,{op:"remove",path:this.from}).removed;return s(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}}),copy:freeOnUnref(function(e,t,n){var r=y(n,this.from);return s(n,{op:"add",path:this.path,value:Ce._deepClone(r)}),{newDocument:n}}),test:freeOnUnref(function(e,t,n){return{newDocument:n,test:p(e[t],this.value)}}),_get:freeOnUnref(function(e,t,n){return this.value=e[t],{newDocument:n}})},m={add:freeOnUnref(function(e,t,n){return Ce.isInteger(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}}),remove:freeOnUnref(function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}}),replace:freeOnUnref(function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}}),move:h.move,copy:h.copy,test:h.test,_get:h._get};function y(e,t){if(""==t)return e;var n={op:"_get",path:t};return s(e,n),n.value}function s(e,t,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=!0),n&&("function"==typeof n?n(t,0,e,t.path):g(t,0)),""===t.path){var i={newDocument:e};if("add"===t.op)return i.newDocument=t.value,i;if("replace"===t.op)return i.newDocument=t.value,i.removed=e,i;if("move"===t.op||"copy"===t.op)return i.newDocument=y(e,t.from),"move"===t.op&&(i.removed=e),i;if("test"===t.op){if(i.test=p(e,t.value),!1===i.test)throw new d.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,t,e);return i.newDocument=e,i}if("remove"===t.op)return i.removed=e,i.newDocument=null,i;if("_get"===t.op)return t.value=e,i;if(n)throw new d.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",0,t,e);return i}r||(e=Ce._deepClone(e));var o=(t.path||"").split("/"),a=e,s=1,l=o.length,f=void 0,u=void 0,c=void 0;for(c="function"==typeof n?n:g;;){if(u=o[s],n&&void 0===f&&(void 0===a[u]?f=o.slice(0,s).join("/"):s==l-1&&(f=t.path),void 0!==f&&c(t,0,e,f)),s++,Array.isArray(a)){if("-"===u)u=a.length;else{if(n&&!Ce.isInteger(u))throw new d.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",0,t.path,t);Ce.isInteger(u)&&(u=~~u)}if(l<=s){if(n&&"add"===t.op&&u>a.length)throw new d.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",0,t.path,t);if(!1===(i=m[t.op].call(t,a,u,e)).test)throw new d.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,t,e);return i}}else if(u&&-1!=u.indexOf("~")&&(u=Ce.unescapePathComponent(u)),l<=s){if(!1===(i=h[t.op].call(t,a,u,e)).test)throw new d.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,t,e);return i}a=a[u]}}function i(e,t,n,r){if(void 0===r&&(r=!0),n&&!Array.isArray(t))throw new d.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Ce._deepClone(e));for(var i=new Array(t.length),o=0,a=t.length;o<a;o++)i[o]=s(e,t[o],n),e=i[o].newDocument;return i.newDocument=e,i}function g(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new d.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!h[e.op])throw new d.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new d.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&0<e.path.length)throw new d.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new d.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new d.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&Ce.hasUndefined(e.value))throw new d.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,o=r.split("/").length;if(i!==o+1&&i!==o)throw new d.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new d.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var a=l([{op:"_get",path:e.from,value:void 0}],n);if(a&&"OPERATION_PATH_UNRESOLVABLE"===a.name)throw new d.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function l(e,t,n){try{if(!Array.isArray(e))throw new d.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)i(Ce._deepClone(t),Ce._deepClone(e),n||!0);else{n=n||g;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof d.JsonPatchError)return e;throw e}}d.getValueByPointer=y,d.applyOperation=s,d.applyPatch=i,d.applyReducer=function(e,t){var n=s(e,t);if(!1===n.test)throw new d.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,t,e);return n.newDocument},d.validator=g,d.validate=l})),Te=(Ee.JsonPatchError,Ee.deepClone,Ee.getValueByPointer,Ee.applyOperation,Ee.applyPatch,Ee.applyReducer,Ee.validator,Ee.validate,Ee),we=Te.applyOperation,Ie=Te.applyPatch,ke=Te.applyReducer,_e=Te.getValueByPointer,Re=Te.validate,Ae=Te.validator,De=Ce,xe=De.PatchError,Fe=De._deepClone,Be=De.escapePathComponent,Le=De.unescapePathComponent,Ne=[],Ve=freeOnUnref(function(){return function(e){this.observers=[],this.obj=e}})(),je=freeOnUnref(function(){return function(e,t){this.callback=e,this.observer=t}})();function qe(e){for(var t,n=0,r=Ne.length;n<r;n++)if(Ne[n].obj===e.object){t=Ne[n];break}He(t.value,e.object,e.patches,""),e.patches.length&&Ee.applyPatch(t.value,e.patches);var i=e.patches;return 0<i.length&&(e.patches=[],e.callback&&e.callback(i)),i}function He(e,t,n,r){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var i=Ce._objectKeys(t),o=Ce._objectKeys(e),a=!1,s=o.length-1;0<=s;s--){var l=e[u=o[s]];if(!Ce.hasOwnProperty(t,u)||void 0===t[u]&&void 0!==l&&!1===Array.isArray(t))n.push({op:"remove",path:r+"/"+Ce.escapePathComponent(u)}),a=!0;else{var f=t[u];"object"==typeof l&&null!=l&&"object"==typeof f&&null!=f?He(l,f,n,r+"/"+Ce.escapePathComponent(u)):l!==f&&n.push({op:"replace",path:r+"/"+Ce.escapePathComponent(u),value:Ce._deepClone(f)})}}if(a||i.length!=o.length)for(s=0;s<i.length;s++){var u=i[s];Ce.hasOwnProperty(e,u)||void 0===t[u]||n.push({op:"add",path:r+"/"+Ce.escapePathComponent(u),value:Ce._deepClone(t[u])})}}}var ze={applyOperation:we,applyPatch:Ie,applyReducer:ke,getValueByPointer:_e,validate:Re,validator:Ae,JsonPatchError:xe,deepClone:Fe,escapePathComponent:Be,unescapePathComponent:Le,unobserve:function(e,t){t.unobserve()},observe:function(e,t){var n,r=function(e){for(var t=0,n=Ne.length;t<n;t++)if(Ne[t].obj===e)return Ne[t]}(e);if(r?n=function(e,t){for(var n=0,r=e.observers.length;n<r;n++)if(e.observers[n].callback===t)return e.observers[n].observer}(r,t):(r=new Ve(e),Ne.push(r)),n)return n;if(n={},r.value=Ce._deepClone(e),t){n.callback=t,n.next=null;var i=freeOnUnref(function(){qe(n)}),o=freeOnUnref(function(){clearTimeout(n.next),n.next=setTimeout(i)});"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o)):(document.documentElement.attachEvent("onmouseup",o),document.documentElement.attachEvent("onkeyup",o),document.documentElement.attachEvent("onmousedown",o),document.documentElement.attachEvent("onkeydown",o),document.documentElement.attachEvent("onchange",o)))}return n.patches=[],n.object=e,n.unobserve=freeOnUnref(function(){qe(n),clearTimeout(n.next),function(e,t){for(var n=0,r=e.observers.length;n<r;n++)if(e.observers[n].observer===t)return e.observers.splice(n,1)}(r,n),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o)):(document.documentElement.detachEvent("onmouseup",o),document.documentElement.detachEvent("onkeyup",o),document.documentElement.detachEvent("onmousedown",o),document.documentElement.detachEvent("onkeydown",o)))}),r.observers.push(new je(t,n)),n},generate:qe,compare:function(e,t){var n=[];return He(e,t,n,""),n}},We=t(freeOnUnref(function(e,t){function o(e,t,n){return void 0===n&&(n=!0),n?e===t:e.toLowerCase()===t.toLowerCase()}Object.defineProperty(t,"__esModule",{value:!0});var n={match:o,startsWith:function(e,t,n){return void 0===n&&(n=!0),o(e.substring(0,t.length),t,n)},endsWith:function(e,t,n){void 0===n&&(n=!0);var r=e.length-t.length,i=e.length;return o(e.substring(r,i),t,n)}};t.Strings=n}));e(We);We.Strings;var Ke=t(freeOnUnref(function(e,t){function f(e,t){return null!=e?e:t}function u(e){return void 0===e}function i(e,t){var n=e;for(var r in n)e.hasOwnProperty(r)&&(t(e,r,n[r]),null!=n[r]&&"object"==typeof n[r]&&i(n[r],t))}function c(e){return x.isObject(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.withDefault=f,t.exists=function(e){return null!=e},t.isNullOrUndefined=function(e){return null==e},t.nestedValue=function(e,t,n){var r;if(void 0===n&&(n=null),0===(r="string"==typeof t?t.split("."):t).length)return n;var i=x.reduce(r,freeOnUnref(function(e,t){return null==e?null:e[t]}),e);return null==i?n:i},t.deepTraverse=i,t.sanitize=function(e,n){void 0===n&&(n=!1),i(e,freeOnUnref(function(e,t){(u(e[t])||n&&null===e[t])&&delete e[t]}))},t.isObject=c,t.deepExtend=function e(t,n){if(null==n)return f(x.clone(t),null);if(null==t)return x.clone(n);for(var r={},i=0,o=x.union(Object.keys(t),Object.keys(n));i<o.length;i++){var a=o[i],s=t[a],l=n[a];u(s)?r[a]=x.clone(l):c(s)&&c(l)&&!x.isArray(s)&&!x.isArray(l)?r[a]=e(s,l):r[a]=f(n[a],t[a])}return r},t.deepClone=function e(t){if("object"!=typeof t||null==t)return t;var n=Array.isArray(t)?[]:{};for(var r in t)n[r]=e(t[r]);return n}}));e(Ke);Ke.withDefault,Ke.exists,Ke.isNullOrUndefined,Ke.nestedValue,Ke.deepTraverse,Ke.sanitize,Ke.isObject,Ke.deepExtend,Ke.deepClone;var Ge=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(e){this.id=e.id,this.value=e,this.previousId=null,this.nextId=null}})();t.LinkedNodeWrapper=n;var r=freeOnUnref(function(){function l(){this.map={},this.first=null,this.last=null}return l.prototype.insertAfter=freeOnUnref(function(e,t){if(null!=e&&null==this.map[e])throw new Error("Attempting to insert an item after id "+e+", but this item does not exist.");var n=t;if(null==(n.previousId=e))n.nextId=this.first,this.first=t.id;else{var r=this.map[e];n.nextId=r.nextId,r.nextId=t.id}null==t.nextId?this.last=t.id:this.map[t.nextId].previousId=t.id,this.map[t.id]=t}),l.prototype.remove=freeOnUnref(function(e){if(null==this.map[e])throw new Error("Attempting to remove item with id "+e+", but this item does not exist.");var t=this.map[e],n=null==t.previousId?null:this.map[t.previousId],r=null==t.nextId?null:this.map[t.nextId];delete this.map[e],null==r?(this.last=t.previousId,null==n?this.first=null:n.nextId=null):(r.previousId=t.previousId,null==n?this.first=t.nextId:n.nextId=t.nextId)}),l.prototype.removeRange=freeOnUnref(function(e,t){var n=this.map[e],r=this.map[t];if(null==n||null==r)throw new Error("Could not resolve range ["+e+"-"+t+"]");var i=new l,o=null==n.previousId?null:this.map[n.previousId],a=null==r.nextId?null:this.map[r.nextId];null==o?this.first=r.nextId:o.nextId=r.nextId,null==a?this.last=n.previousId:a.previousId=n.previousId,r.nextId=null,n.previousId=null,i.first=e,i.last=t;for(var s=n.id;null!=s;s=i.map[s].nextId)i.map[s]=this.map[s],delete this.map[s];return i}),l.prototype.splice=freeOnUnref(function(e,t){if(null!=t.first&&null!=t.last){for(var n=null==e?null:this.map[e],r=null==n?this.first:n.nextId,i=null==r?null:this.map[r],o=t.first;null!=o;o=this.map[o].nextId)this.map[o]=t.map[o],delete t.map[o];if(null==n)this.first=t.first;else n.nextId=t.first,this.map[t.first].previousId=n.id;if(null==i)this.last=t.last;else i.previousId=t.last,this.map[t.last].nextId=i.id;t.first=null,t.last=null}}),l})();t.SimpleLinkedMap=r}));e(Ge);Ge.LinkedNodeWrapper,Ge.SimpleLinkedMap;var Qe=t(freeOnUnref(function(e,n){function t(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),n.Strings=We.Strings,t(Ke),t(Ge)}));e(Qe);Qe.Strings;var Xe=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.newError=freeOnUnref(function(e,t,n){var r=new Error(t);return r.name=e,null!=n&&(r.cause=n),r}),e})();t.Errors=n}));e(Xe);Xe.Errors;var Ye=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(){var e=this.constructor,t=n.call(this,"The operation was cancelled")||this;return t.name="CancelError",Object.setPrototypeOf(t,e.prototype),t}return r(e,n),e})(Error);t.CancelError=n}));e(Ye);Ye.CancelError;var Je=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function t(){}return t.setTaskQueue=freeOnUnref(function(e){t.taskQueue=e}),t.enqueue=freeOnUnref(function(e){t.taskQueue.enqueue(e)}),t})();t.TaskQueueManager=n}));e(Je);Je.TaskQueueManager;var Ze=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"})(n||(n={}));var r=de.get("Promise"),i=freeOnUnref(function(){function l(e){var t=this;if(this.state=n.Pending,this.value=void 0,this.error=void 0,this.handlers=[],this.handled=!1,this.resolve=freeOnUnref(function(n){if(t!==n)try{var r=l.getThen(n);null!=r?t.doResolve(freeOnUnref(function(e,t){return r.call(n,e,t)}),t.resolve,t.reject):t.fulfill(n)}catch(e){t.reject(e)}else t.reject(new TypeError("Resolving promise with itself not allowed"))}),this.fulfill=freeOnUnref(function(e){t.state=n.Fulfilled,t.value=e,t.handlers.forEach(freeOnUnref(function(e){t.handle(e)})),t.handlers=[]}),this.reject=freeOnUnref(function(e){t.state=n.Rejected,t.error=e,0===t.handlers.length?Je.TaskQueueManager.enqueue(freeOnUnref(function(){0!==t.handlers.length||t.handled||r.warn("Unhandled promise rejection",e)})):(t.handlers.forEach(freeOnUnref(function(e){t.handle(e)})),t.handlers=[])}),null==e||"function"!=typeof e)throw new Error("Promise resolved "+e+" is not a function");this.doResolve(e,this.resolve,this.reject)}return l.resolve=freeOnUnref(function(t){return new l(freeOnUnref(function(e){e(t)}))}),l.reject=freeOnUnref(function(n){return new l(freeOnUnref(function(e,t){t(n)}))}),l.all=freeOnUnref(function(s){return Array.isArray(s)?new l(freeOnUnref(function(n,r){var i=[],o=s.length,a=0;if(0!==o)for(var e=freeOnUnref(function(t){var e=s[t];(e instanceof l?e:l.resolve(e)).then(freeOnUnref(function(e){i[t]=e,++a===o&&n(i)}),r)}),t=0;t<o;t++)e(t);else n([])})):l.reject(new TypeError("Not an array of promises"))}),l.race=freeOnUnref(function(o){return Array.isArray(o)?new l(freeOnUnref(function(e,t){for(var n=0,r=o;n<r.length;n++){var i=r[n];(i instanceof l?i:l.resolve(i)).then(e,t)}})):l.reject(new TypeError("Not an array of promises"))}),l.prototype.then=freeOnUnref(function(r,i){var e=this;return new l(freeOnUnref(function(t,n){e.done(freeOnUnref(function(e){try{t("function"==typeof r?r(e):e)}catch(e){n(e)}}),freeOnUnref(function(e){try{"function"==typeof i?t(i(e)):n(e)}catch(e){n(e)}}))}))}),l.prototype.catch=freeOnUnref(function(e){return this.then(null,e)}),l.prototype.done=freeOnUnref(function(e,t){this.handle({onFulfilled:e,onRejected:t})}),l.getThen=freeOnUnref(function(e){var t=typeof e;if(("object"===t||"function"===t)&&null!==e){var n=e.then;if("function"==typeof n)return n}return null}),l.prototype.doResolve=freeOnUnref(function(e,t,n){var r=!1;try{e(freeOnUnref(function(e){r||(r=!0,t(e))}),freeOnUnref(function(e){r||(r=!0,n(e))}))}catch(e){if(r)return;r=!0,n(e)}}),l.prototype.handle=freeOnUnref(function(e){var t=this;this.state===n.Pending?(this.handlers.push(e),20===this.handlers.length&&r.warn("Possible promise leak detected: A promise object has now 20 handlers!",(new Error).stack)):(this.state===n.Fulfilled?Je.TaskQueueManager.enqueue(freeOnUnref(function(){e.onFulfilled(t.value)})):Je.TaskQueueManager.enqueue(freeOnUnref(function(){e.onRejected(t.error)})),this.handled=!0)}),l})();t.Promise=i}));e(Ze);Ze.Promise;var $e=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.PromisePolyfill=n,"undefined"!=typeof Promise?t.PromisePolyfill=n=Promise:t.PromisePolyfill=n=Ze.Promise}));e($e);$e.PromisePolyfill;var et=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function n(e,t){void 0===t&&(t=$e.PromisePolyfill);var n=this;this.wasRequested=!1,this.cancel=freeOnUnref(function(){n.wasRequested||(n.wasRequested=!0,n.resolvePromise(new Ye.CancelError))}),this.backingPromise=new t(freeOnUnref(function(e,t){n.resolvePromise=e})),e(this.cancel)}return n.prototype.throwIfRequested=freeOnUnref(function(){if(this.wasRequested)throw new Ye.CancelError}),Object.defineProperty(n.prototype,"requested",{get:freeOnUnref(function(){return this.wasRequested}),enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"promise",{get:freeOnUnref(function(){return this.backingPromise}),enumerable:!0,configurable:!0}),n.source=freeOnUnref(function(e){var t;return void 0===e&&(e=$e.PromisePolyfill),{token:new n(freeOnUnref(function(e){t=e}),e),cancel:t}}),n})();t.CancelToken=n}));e(et);et.CancelToken;var tt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){var n=this;this.backingPromise=new lt.Promise(freeOnUnref(function(e,t){n.resolvePromise=e,n.rejectPromise=t}))}return e.prototype.resolve=freeOnUnref(function(e){this.resolvePromise(e)}),e.prototype.reject=freeOnUnref(function(e){this.rejectPromise(e)}),Object.defineProperty(e.prototype,"promise",{get:freeOnUnref(function(){return this.backingPromise}),enumerable:!0,configurable:!0}),e})();t.Deferred=n}));e(tt);tt.Deferred;var nt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(n,r){var i=this;this.backingPromise=new $e.PromisePolyfill(freeOnUnref(function(e,t){i.rejectPromise=t,i.timeoutId=oe.timer.setTimeout(e,n),null!=r&&r.promise.then(freeOnUnref(function(e){null!=i.timeoutId&&(oe.timer.clearTimeout(i.timeoutId),i.timeoutId=null),t(e)}))}))}return e.prototype.clear=freeOnUnref(function(){null!=this.timeoutId&&(oe.timer.clearTimeout(this.timeoutId),this.timeoutId=null),this.rejectPromise(new Ye.CancelError)}),Object.defineProperty(e.prototype,"promise",{get:freeOnUnref(function(){return this.backingPromise}),enumerable:!0,configurable:!0}),e})();t.Delay=n}));e(nt);nt.Delay;var rt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.FINALLY=function(t){return[freeOnUnref(function(e){return $e.PromisePolyfill.resolve(t()).then(freeOnUnref(function(){return e}))}),freeOnUnref(function(e){return $e.PromisePolyfill.resolve(t()).then(freeOnUnref(function(){throw e}))})]}}));e(rt);rt.FINALLY;var it=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.makeCancellable=function(e,t){var n=e.promise.then(freeOnUnref(function(e){throw e}));return $e.PromisePolyfill.race([t,n])}}));e(it);it.makeCancellable;var ot=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.backingPromise=new tt.Deferred,this.backingPromise.promise.catch(freeOnUnref(function(e){}))}return e.prototype.resolve=freeOnUnref(function(e){this.backingPromise.resolve(e)}),e.prototype.reject=freeOnUnref(function(e){this.backingPromise.reject(e)}),Object.defineProperty(e.prototype,"promise",{get:freeOnUnref(function(){return this.backingPromise.promise}),enumerable:!0,configurable:!0}),e})();t.SafeDeferred=n}));e(ot);ot.SafeDeferred;var at=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.queue=[]}return e.prototype.enqueue=freeOnUnref(function(e){this.queue.push(e)}),e.prototype.tick=freeOnUnref(function(){0!==this.queue.length&&this.queue.shift()()}),e.prototype.runUntilEmpty=freeOnUnref(function(){for(;0<this.queue.length;)this.tick()}),e.prototype.reset=freeOnUnref(function(){this.queue=[]}),e})();t.SyncTaskQueue=n}));e(at);at.SyncTaskQueue;var st=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("TimeoutTaskQueue"),r=freeOnUnref(function(){function e(e){void 0===e&&(e=oe.timer);var t=this;this.executor=freeOnUnref(function(){for(;0<t.tasks.length;){var e=t.tasks.shift();try{e()}catch(e){n.error("Unhandled exception thrown by a task: ",e,e.stack)}}t.immediate=null}),this.timer=e,this.tasks=[],this.immediate=null}return e.prototype.enqueue=freeOnUnref(function(e){this.tasks.push(e),null===this.immediate&&(this.immediate=this.timer.setImmediate(this.executor))}),e})();t.TimeoutTaskQueue=r}));e(st);st.TimeoutTaskQueue;var lt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CancelError=Ye.CancelError,t.CancelToken=et.CancelToken,t.Deferred=tt.Deferred,t.Delay=nt.Delay,t.FINALLY=rt.FINALLY,t.makeCancellable=it.makeCancellable,t.PromiseImpl=Ze.Promise,t.Promise=$e.PromisePolyfill,t.SafeDeferred=ot.SafeDeferred,t.SyncTaskQueue=at.SyncTaskQueue,t.TaskQueueManager=Je.TaskQueueManager,t.TimeoutTaskQueue=st.TimeoutTaskQueue;var n=Je,r=st;null!=oe.timer&&n.TaskQueueManager.setTaskQueue(new r.TimeoutTaskQueue(oe.timer))}));e(lt);lt.CancelError,lt.CancelToken,lt.Deferred,lt.Delay,lt.FINALLY,lt.makeCancellable,lt.PromiseImpl,lt.Promise,lt.SafeDeferred,lt.SyncTaskQueue,lt.TaskQueueManager,lt.TimeoutTaskQueue;var ft=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function n(e,t,n,r,i){void 0===r&&(r=!1),this.code=e,this.internalName=t,this.message=null!=n?n:e,this.isFatal=r,this.cause=i;var o=new Error;if(o.stack)this.stack=o.stack;else try{throw o}catch(e){e.stack&&(this.stack=e.stack)}}return Object.defineProperty(n.prototype,"name",{get:freeOnUnref(function(){return null!=this.internalName?this.internalName:this.code}),enumerable:!0,configurable:!0}),n.prototype.prependErrorCode=freeOnUnref(function(e){this.code=e+"."+this.code}),n.prototype.toString=freeOnUnref(function(){var e=this.name+": "+this.message;return null!=this.cause&&(e+=" | caused by "+this.cause),e}),n.generatePrefixedError=freeOnUnref(function(e,t){return e instanceof lt.CancelError?e:e instanceof n?(0!==e.code.indexOf(t+".")&&e.prependErrorCode(t),e):new n(t+"."+e.name,void 0,e.message,!0,e)}),n})();t.XpError=n}));e(ft);ft.XpError;var ut=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.prefixPromiseError=function(t,e){return e.catch(freeOnUnref(function(e){throw ft.XpError.generatePrefixedError(e,t)}))}}));e(ut);ut.prefixPromiseError;var ct=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Errors=Xe.Errors,t.XpError=ft.XpError,t.prefixPromiseError=ut.prefixPromiseError}));e(ct);ct.Errors,ct.XpError,ct.prefixPromiseError;var dt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=!1;try{var i=new URL("b","http://a");i.pathname="c%20d",r="http://a/c%20d"===i.href}catch(e){}if(t.URL=n,r)t.URL=n=URL;else{var y=void 0,g=/[a-zA-Z]/,v=/[a-zA-Z0-9\+\-\.]/,O={ftp:21,file:0,gopher:70,http:80,https:443,ws:80,wss:443},S={"%2e":".",".%2e":"..","%2e.":"..","%2e%2e":".."},o=freeOnUnref(function(){function r(e,t){this._isInvalid=!1,this._scheme="",this._isRelative=!1,this._query="",this._fragment="",this._schemeData="",this._host="",this._port="",this._path=[],this._username="",this._password="",this._url="",void 0===t||t instanceof r||(t=new r(String(t))),this._url=e,this.clear();var n=e.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,"");this.parse(n,null,t)}return r.prototype.isRelativeScheme=freeOnUnref(function(e){return void 0!==O[e]}),r.prototype.invalid=freeOnUnref(function(){this.clear(),this._isInvalid=!0}),r.prototype.IDNAToASCII=freeOnUnref(function(e){return""==e&&this.invalid(),e.toLowerCase()}),r.prototype.percentEscape=freeOnUnref(function(e){var t=e.charCodeAt(0);return 32<t&&t<127&&-1==[34,35,60,62,63,96].indexOf(t)?e:encodeURIComponent(e)}),r.prototype.percentEscapeQuery=freeOnUnref(function(e){var t=e.charCodeAt(0);return 32<t&&t<127&&-1==[34,35,60,62,96].indexOf(t)?e:encodeURIComponent(e)}),r.prototype.parse=freeOnUnref(function(e,t,n){var r=t||"scheme start",i=0,o="",a=!1,s=!1;e:for(;(e[i-1]!=y||0==i)&&!this._isInvalid;){var l=e[i];switch(r){case"scheme start":if(!l||!g.test(l)){if(t)break e;o="",r="no scheme";continue}o+=l.toLowerCase(),r="scheme";break;case"scheme":if(l&&v.test(l))o+=l.toLowerCase();else{if(":"!=l){if(t){if(y==l)break e;break e}o="",i=0,r="no scheme";continue}if(this._scheme=o,o="",t)break e;this.isRelativeScheme(this._scheme)&&(this._isRelative=!0),r="file"==this._scheme?"relative":this._isRelative&&n&&n._scheme==this._scheme?"relative or authority":this._isRelative?"authority first slash":"scheme data"}break;case"scheme data":"?"==l?(this._query="?",r="query"):"#"==l?(this._fragment="#",r="fragment"):y!=l&&"\t"!=l&&"\n"!=l&&"\r"!=l&&(this._schemeData+=this.percentEscape(l));break;case"no scheme":if(n&&this.isRelativeScheme(n._scheme)){r="relative";continue}this.invalid();break;case"relative or authority":if("/"!=l||"/"!=e[i+1]){r="relative";continue}r="authority ignore slashes";break;case"relative":if(this._isRelative=!0,"file"!=this._scheme&&(this._scheme=n._scheme),y==l){this._host=n._host,this._port=n._port,this._path=n._path.slice(),this._query=n._query,this._username=n._username,this._password=n._password;break e}if("/"==l||"\\"==l)r="relative slash";else if("?"==l)this._host=n._host,this._port=n._port,this._path=n._path.slice(),this._query="?",this._username=n._username,this._password=n._password,r="query";else{if("#"!=l){var f=e[i+1],u=e[i+2];("file"!=this._scheme||!g.test(l)||":"!=f&&"|"!=f||y!=u&&"/"!=u&&"\\"!=u&&"?"!=u&&"#"!=u)&&(this._host=n._host,this._port=n._port,this._username=n._username,this._password=n._password,this._path=n._path.slice(),this._path.pop()),r="relative path";continue}this._host=n._host,this._port=n._port,this._path=n._path.slice(),this._query=n._query,this._fragment="#",this._username=n._username,this._password=n._password,r="fragment"}break;case"relative slash":if("/"!=l&&"\\"!=l){"file"!=this._scheme&&(this._host=n._host,this._port=n._port,this._username=n._username,this._password=n._password),r="relative path";continue}r="file"==this._scheme?"file host":"authority ignore slashes";break;case"authority first slash":if("/"!=l){r="authority ignore slashes";continue}r="authority second slash";break;case"authority second slash":if(r="authority ignore slashes","/"!=l)continue;break;case"authority ignore slashes":if("/"!=l&&"\\"!=l){r="authority";continue}break;case"authority":if("@"==l){a&&(o+="%40"),a=!0;for(var c=0;c<o.length;c++){var d=o[c];if("\t"!=d&&"\n"!=d&&"\r"!=d)if(":"!=d||null!==this._password){var p=this.percentEscape(d);null!==this._password?this._password+=p:this._username+=p}else this._password=""}o=""}else{if(y==l||"/"==l||"\\"==l||"?"==l||"#"==l){i-=o.length,o="",r="host";continue}o+=l}break;case"file host":if(y==l||"/"==l||"\\"==l||"?"==l||"#"==l){2!=o.length||!g.test(o[0])||":"!=o[1]&&"|"!=o[1]?(0==o.length||(this._host=this.IDNAToASCII(o),o=""),r="relative path start"):r="relative path";continue}"\t"==l||"\n"==l||"\r"==l||(o+=l);break;case"host":case"hostname":if(":"!=l||s){if(y==l||"/"==l||"\\"==l||"?"==l||"#"==l){if(this._host=this.IDNAToASCII(o),o="",r="relative path start",t)break e;continue}"\t"!=l&&"\n"!=l&&"\r"!=l&&("["==l?s=!0:"]"==l&&(s=!1),o+=l)}else if(this._host=this.IDNAToASCII(o),o="",r="port","hostname"==t)break e;break;case"port":if(/[0-9]/.test(l))o+=l;else{if(y==l||"/"==l||"\\"==l||"?"==l||"#"==l||t){if(""!=o){var h=parseInt(o,10);h!=O[this._scheme]&&(this._port=h+""),o=""}if(t)break e;r="relative path start";continue}"\t"==l||"\n"==l||"\r"==l||this.invalid()}break;case"relative path start":if(r="relative path","/"!=l&&"\\"!=l)continue;break;case"relative path":if(y!=l&&"/"!=l&&"\\"!=l&&(t||"?"!=l&&"#"!=l))"\t"!=l&&"\n"!=l&&"\r"!=l&&(o+=this.percentEscape(l));else{var m;(m=S[o.toLowerCase()])&&(o=m),".."==o?(this._path.pop(),"/"!=l&&"\\"!=l&&this._path.push("")):"."==o&&"/"!=l&&"\\"!=l?this._path.push(""):"."!=o&&("file"==this._scheme&&0==this._path.length&&2==o.length&&g.test(o[0])&&"|"==o[1]&&(o=o[0]+":"),this._path.push(o)),o="","?"==l?(this._query="?",r="query"):"#"==l&&(this._fragment="#",r="fragment")}break;case"query":t||"#"!=l?y!=l&&"\t"!=l&&"\n"!=l&&"\r"!=l&&(this._query+=this.percentEscapeQuery(l)):(this._fragment="#",r="fragment");break;case"fragment":y!=l&&"\t"!=l&&"\n"!=l&&"\r"!=l&&(this._fragment+=l)}i++}}),r.prototype.clear=freeOnUnref(function(){this._scheme="",this._schemeData="",this._username="",this._password="",this._host="",this._port="",this._path=[],this._query="",this._fragment="",this._isInvalid=!1,this._isRelative=!1}),r.prototype.toString=freeOnUnref(function(){return this.href}),r.prototype.toJSON=freeOnUnref(function(){return this.href}),Object.defineProperty(r.prototype,"href",{get:freeOnUnref(function(){if(this._isInvalid)return this._url;var e="";return""==this._username&&""==this._password||(e=this._username+(""!=this._password?":"+this._password:"")+"@"),this.protocol+(this._isRelative?"//"+e+this.host:"")+this.pathname+this._query+this._fragment}),set:freeOnUnref(function(e){this.clear(),this.parse(e)}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"protocol",{get:freeOnUnref(function(){return this._scheme+":"}),set:freeOnUnref(function(e){this._isInvalid||this.parse(e+":","scheme start")}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"host",{get:freeOnUnref(function(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host}),set:freeOnUnref(function(e){!this._isInvalid&&this._isRelative&&this.parse(e,"host")}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hostname",{get:freeOnUnref(function(){return this._host}),set:freeOnUnref(function(e){!this._isInvalid&&this._isRelative&&this.parse(e,"hostname")}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"port",{get:freeOnUnref(function(){return this._port}),set:freeOnUnref(function(e){!this._isInvalid&&this._isRelative&&this.parse(e,"port")}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pathname",{get:freeOnUnref(function(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData}),set:freeOnUnref(function(e){!this._isInvalid&&this._isRelative&&(this._path=[],this.parse(e,"relative path start"))}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"search",{get:freeOnUnref(function(){return this._isInvalid||!this._query||"?"==this._query?"":this._query}),set:freeOnUnref(function(e){!this._isInvalid&&this._isRelative&&((this._query="?")==e[0]&&(e=e.slice(1)),this.parse(e,"query"))}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hash",{get:freeOnUnref(function(){return this._isInvalid||!this._fragment||"#"==this._fragment?"":this._fragment}),set:freeOnUnref(function(e){this._isInvalid||((this._fragment="#")==e[0]&&(e=e.slice(1)),this.parse(e,"fragment"))}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"username",{get:freeOnUnref(function(){return this._username}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"password",{get:freeOnUnref(function(){return this._password}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"origin",{get:freeOnUnref(function(){var e;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case"data":case"file":case"javascript":case"mailto":return"null"}return(e=this.host)?this._scheme+"://"+e:""}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"searchParams",{get:freeOnUnref(function(){return null}),enumerable:!0,configurable:!0}),r.createObjectURL=freeOnUnref(function(e){return""}),r.revokeObjectURL=freeOnUnref(function(e){}),r})();if(t.URL=n=o,"undefined"!=typeof URL){var a=URL;a&&(n.createObjectURL=freeOnUnref(function(e){return a.createObjectURL.apply(a,arguments)}),n.revokeObjectURL=freeOnUnref(function(e){a.revokeObjectURL(e)}))}}}));e(dt);dt.URL;var pt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){if(this.params={},e)for(var t=0,n=e.split("&");t<n.length;t++){var r=n[t];if(r){var i=r.split("=").map(decodeURIComponent),o=i[0],a=i[1];o&&a&&(this.params[o]=a)}}}return e.prototype.append=freeOnUnref(function(e,t){this.params[e]=t}),e.prototype.get=freeOnUnref(function(e){return e in this.params?this.params[e]:null}),e.prototype.keys=freeOnUnref(function(){return Object.keys(this.params)}),e.prototype.toString=freeOnUnref(function(){var e=[];for(var t in this.params)this.params.hasOwnProperty(t)&&e.push(encodeURIComponent(t)+"="+encodeURIComponent(this.params[t]));return e.join("&")}),e})();t.URLSearchParams=n}));e(pt);pt.URLSearchParams;var ht=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.wwwFormUrlEncode=freeOnUnref(function(e){var t=freeOnUnref(function(e){return encodeURIComponent(e).replace(/%20/g,"+")});return x.pairs(e).map(freeOnUnref(function(e){return e.map(freeOnUnref(function(e){return t(e)})).join("=")})).join("&")}),e.appendQueryParams=freeOnUnref(function(e,t){var n=e.search,r=x.pairs(t).reduce(freeOnUnref(function(e,t){return e+(""===e?"?":"&")+t[0]+"="+t[1]}),n);e.search=r}),e.removeQueryParams=freeOnUnref(function(e,t){var n=e.search;"?"===n[0]&&(n=n.slice(1));for(var r=n.split("&"),i=0;i<r.length;i++){var o=t[r[i].split("=")[0]];null!=o&&(r.splice(i,1),i--)}e.search=r.join("&")}),e})();t.URLUtils=n}));e(ht);ht.URLUtils;var mt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.URL=dt.URL,t.URLSearchParams=pt.URLSearchParams,t.URLUtils=ht.URLUtils}));e(mt);mt.URL,mt.URLSearchParams,mt.URLUtils;function yt(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function gt(e,t){return e>>>t|e<<32-t}function vt(e,t){return e>>>t}var Ot={hex_sha256:freeOnUnref(function(e){return function(e){for(var t="0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>8*(3-r%4)+4&15)+t.charAt(e[r>>2]>>8*(3-r%4)&15);return n}(function(e,t){var n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v,O,S=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),U=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),b=new Array(64);e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var P=0;P<e.length;P+=16){n=U[0],r=U[1],i=U[2],o=U[3],a=U[4],s=U[5],l=U[6],f=U[7];for(var M=0;M<64;M++)b[M]=M<16?e[M+P]:yt(yt(yt(gt(O=b[M-2],17)^gt(O,19)^vt(O,10),b[M-7]),gt(v=b[M-15],7)^gt(v,18)^vt(v,3)),b[M-16]),u=yt(yt(yt(yt(f,gt(g=a,6)^gt(g,11)^gt(g,25)),(y=a)&s^~y&l),S[M]),b[M]),c=yt(gt(m=n,2)^gt(m,13)^gt(m,22),(d=n)&(p=r)^d&(h=i)^p&h),f=l,l=s,s=a,a=yt(o,u),o=i,i=r,r=n,n=yt(u,c);U[0]=yt(n,U[0]),U[1]=yt(r,U[1]),U[2]=yt(i,U[2]),U[3]=yt(o,U[3]),U[4]=yt(a,U[4]),U[5]=yt(s,U[5]),U[6]=yt(l,U[6]),U[7]=yt(f,U[7])}return U}(function(e){for(var t=Array(),n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}(e),8*e.length))})},St=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.encodePath=freeOnUnref(function(e){var t=e.replace(/%/g,"%25");return t=t.replace(/\//g,"%2F")}),e.prototype.decodePath=freeOnUnref(function(e){var t=e.replace(/%2F/g,"/");return t=t.replace(/%25/g,"%")}),e})();t.StorageTransformer=n}));e(St);St.StorageTransformer;var Ut=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("LocalStorageIgnition"),n=freeOnUnref(function(){function e(e,t,n){void 0===n&&(n=re.connector.storageAPI),this.capabilities={isSupported:!0},this.storageAPI=n,this.storageType=t,this.storagePrefix=e,this.storageTransformer=new St.StorageTransformer}return e.prototype.setStorageType=freeOnUnref(function(e){var t=this.storageType;"Memory"===e?t=u.NativeStorageType.IN_MEMORY:"Disk"===e?t=u.NativeStorageType.CACHE:o.error("setStorageType : unknown storage type",e),t!==this.storageType&&(o.info("Modifying local storage type",t),this.storageType=t)}),e.prototype.getText=freeOnUnref(function(e){o.info(">> getText",e);var t=this.storageTransformer.encodePath(this.storagePrefix+e);try{var n=this.storageAPI.getText(this.storageType,t);return lt.Promise.resolve(n)}catch(e){return o.error(">> error during reading getText from file",e.message),lt.Promise.reject(e)}}),e.prototype.getArrayBuffer=freeOnUnref(function(e,t){o.info(">> getArrayBuffer",e);var n=this.storageTransformer.encodePath(this.storagePrefix+e);try{var r=this.storageAPI.getBinaryData(this.storageType,n);if(null===r)return lt.Promise.resolve(null);if(void 0===t)return lt.Promise.resolve(r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength));var i=r.subarray(t.start,t.end+1);return lt.Promise.resolve(i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength))}catch(e){return o.error(">> error during reading getArrayBuffer from file",e.message),lt.Promise.reject(e)}}),e.prototype.listKeys=freeOnUnref(function(e){var t=this,n=this.storageTransformer.encodePath(this.storagePrefix+e);try{var r=this.storageAPI.listKeys(this.storageType).filter(freeOnUnref(function(e){return 0===e.indexOf(n)})).map(freeOnUnref(function(e){return t.storageTransformer.decodePath(e).substring(t.storagePrefix.length)}));return lt.Promise.resolve(r)}catch(e){return o.error(">> error during storageAPI.listKeys:",e.message),lt.Promise.reject(e)}}),e.prototype.put=freeOnUnref(function(e,t){o.info(">> put",e);var n=this.storageTransformer.encodePath(this.storagePrefix+e);try{var r="string"==typeof t?t:new Uint8Array(t);return this.storageAPI.put(this.storageType,n,r),lt.Promise.resolve()}catch(e){return o.error(">> error during writting into file:, "+JSON.stringify(e)),lt.Promise.reject(e)}}),e.prototype.remove=freeOnUnref(function(e){o.info(">> remove",e);var t=this.storageTransformer.encodePath(this.storagePrefix+e);try{return this.storageAPI.remove(this.storageType,t),lt.Promise.resolve()}catch(e){return o.error(">> error during storageAPI.remove:",e.message),lt.Promise.reject(e)}}),e.prototype.removePrefix=freeOnUnref(function(e){var n=this;return this.listKeys(e).then(freeOnUnref(function(e){e.forEach(freeOnUnref(function(e){var t=n.storageTransformer.encodePath(n.storagePrefix+e);n.storageAPI.remove(n.storageType,t)}))})).catch(freeOnUnref(function(e){return o.error(">> error during storageAPI.removePrefix",e.message),lt.Promise.reject(e)}))}),e})();t.LocalStorageIgnition=n}));e(Ut);Ut.LocalStorageIgnition;var bt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r="deletePrefix",i="FILE_DOES_NOT_EXIST",l=freeOnUnref(function(){function i(e,t,n,r,i,o){void 0===o&&(o=""),this.requestId=e,this.command=t,this.outputFilename=n,this.inputFilename=r,this.filenamePrefix=i,this.errorMessage=o}return i.createRead=freeOnUnref(function(e,t,n,r){return void 0===r&&(r=""),new i(e,"read",t,n,"",r)}),i.createWrite=freeOnUnref(function(e,t,n,r){return void 0===r&&(r=""),new i(e,"write",t,n,"",r)}),i.createDelete=freeOnUnref(function(e,t,n){return void 0===n&&(n=""),new i(e,"delete",t,"","",n)}),i.createDeletePrefix=freeOnUnref(function(e,t,n){return void 0===n&&(n=""),new i(e,r,"","",t,n)}),i.createShutdown=freeOnUnref(function(e,t){return void 0===t&&(t=""),new i(e,"shutdown","","","",t)}),i})();t.VMAction=l;var a=freeOnUnref(function(){return function(e,t){this.action=e,this.response=t}})(),s=de.get("AsyncLocalStorageIgnition"),n=freeOnUnref(function(){function o(e,t,n,r){var i=this;if(this.vm=null,this.nextRequestId=1,this.inprogressRequests={},this.vmExited=new lt.Deferred,this.notAcceptingRequests="",this.onVMExit=freeOnUnref(function(){if(null===i.vm)return 3;if(!i.vmManagerApi.IsBackgroundVmFinished(i.vm))return 2;i.notAcceptingRequests="Async File Background VM has exited",i.vm=null,s.warn("VM has exited for instance "+i.instanceId);for(var e=0,t=Object.keys(i.inprogressRequests);e<t.length;e++){var n=t[e],r=i.inprogressRequests[parseInt(n)];void 0!==r&&("write"===r.action.command&&(s.warn("Deleting inmemory file "+r.action.inputFilename+" for write request "+n+" as VM for instance "+i.instanceId+" has been shutdown"),i.diskStorageApi.DiskStorage_RemoveFile(u.NativeStorageType.IN_MEMORY,r.action.inputFilename)),s.warn("Rejecting request "+n+" as VM for instance "+i.instanceId+" has been shutdown"),r.response.reject(new Error(i.notAcceptingRequests)))}return i.inprogressRequests={},i.vmExited.resolve(),0}),this.canAcceptRequests=freeOnUnref(function(){return 0===i.notAcceptingRequests.length}),this.getRequestId=freeOnUnref(function(){return i.nextRequestId++}),this.getNextRequestId=freeOnUnref(function(){return i.nextRequestId}),this.getCacheFilename=freeOnUnref(function(e){return i.storageTransformer.encodePath(i.storagePrefix+e)}),this.getInprogressCount=freeOnUnref(function(){return Object.keys(i.inprogressRequests).length}),this.getMemoryFilename=freeOnUnref(function(e,t){return""+i.storagePrefix+e+"."+i.instanceId+"."+t}),this.checkVMResponses=freeOnUnref(function(){try{if(0===i.getInprogressCount()||!i.canAcceptRequests())return 3;for(var e=0;e<5&&i.vmManagerApi.PortHasMessages(i.fromVMPort);++e){var t=JSON.parse(i.vmManagerApi.PortPopMessage(i.fromVMPort));s.info("Received response from VM for requestId "+t.requestId+', command "'+t.command+'", outputFilename "'+t.outputFilename+'", ", inputFilename "'+t.inputFilename+'", errorMessage "'+t.errorMessage+'"'),i.processVMResponse(t.requestId,t.errorMessage)}}catch(e){s.error('Error caught in checkVMResponses(): "'+e+'"')}return 0===i.getInprogressCount()?0:1}),this.capabilities={isSupported:!0},this.storagePrefix=e,this.storageTransformer=new St.StorageTransformer,this.eventQueueAPI=t,this.instanceId=++o.instanceCount,this.diskStorageApi=n,this.vmManagerApi=r,this.toVMPortName="xp_async_file_storage_to_vm."+this.instanceId,this.fromVMPortName="xp_async_file_storage_from_vm."+this.instanceId,this.backgroundVMScript=o.getBackgroundVMScript(this.instanceId,this.toVMPortName,this.fromVMPortName),this.toVMPort=this.vmManagerApi.PortCreateNamedPort(this.toVMPortName),this.fromVMPort=this.vmManagerApi.PortCreateNamedPort(this.fromVMPortName),this.fromVMPortWaitable=this.vmManagerApi.PortGetMessageWaitable(this.fromVMPort),this.notAcceptingRequests="Async File Background VM has not been started",this.vm=this.vmManagerApi.CreateNamedBackgroundVmWithString(u.VmLanguageType.JsNoYield,"XP_AsyncStorage_"+this.instanceId+" ",this.backgroundVMScript),null===this.vm)throw new Error("Failed to create Async File Background VM for instance Id "+this.instanceId);this.eventQueueAPI.insertFunction("high",this.vmManagerApi.GetBackgroundVmWaitable(this.vm),this.onVMExit),this.notAcceptingRequests=""}return o.create=freeOnUnref(function(e,t,n,r){if(void 0===n&&(n=re.tryGetNative()),void 0===r&&(r=re.tryGetVmManager()),null!=n&&null!=r&&"function"==typeof r.CreateNamedBackgroundVmWithString)try{return new o(e,t,n,r)}catch(e){return s.error("Creation of AsyncLocalStorageIgnition failed with error "+e),null}return null}),o.prototype.setStorageType=freeOnUnref(function(e){if(e!==Pt.StorageType.Disk)throw new Error("AsyncLocalStorageIgnition only supports Disk storage, rejecting attempt to set storageType to "+e)}),o.prototype.getText=freeOnUnref(function(e){var r=this;if(!this.canAcceptRequests())return lt.Promise.reject(new Error(this.notAcceptingRequests));var t=this.getRequestId(),i=this.getMemoryFilename(e,t),n=this.getCacheFilename(e);return this.sendRequestToVM(l.createRead(t,i,n)).promise.then(freeOnUnref(function(e){if("NotFound"===e)return lt.Promise.resolve(null);var t=r.openInMemoryFile(i),n=r.diskStorageApi.DiskStorage_ReadFile(t.file_handler);if(r.diskStorageApi.DiskStorage_CloseFile(t.file_handler),n.error_code!==u.StorageErrorCode.OK)throw new Error("Error reading in memory text file "+i+", error code: "+n.error_code);return lt.Promise.resolve(n.data)}))}),o.prototype.getArrayBuffer=freeOnUnref(function(e,o){var a=this;if(!this.canAcceptRequests())return lt.Promise.reject(new Error(this.notAcceptingRequests));var t=this.getRequestId(),s=this.getMemoryFilename(e,t),n=this.getCacheFilename(e);return this.sendRequestToVM(l.createRead(t,s,n)).promise.then(freeOnUnref(function(e){if("NotFound"===e)return lt.Promise.resolve(null);var t=a.openInMemoryFile(s),n=a.diskStorageApi.DiskStorage_MoveFileBinaryAsExternalBuffer(t.file_handler);if(a.diskStorageApi.DiskStorage_CloseFile(t.file_handler),n.error_code!==u.StorageErrorCode.OK)throw new Error("Error reading in memory text file "+s+", error code: "+n.error_code);var r=new Uint8Array(n.data.externalBuffer.buffer);if(void 0===o)return lt.Promise.resolve(r);var i=r.subarray(o.start,o.end+1);return lt.Promise.resolve(i)}))}),o.prototype.listKeys=freeOnUnref(function(e){var t=this;if(!this.canAcceptRequests())return lt.Promise.reject(new Error(this.notAcceptingRequests));var n=this.storageTransformer.encodePath(this.storagePrefix+e),r=this.diskStorageApi.DiskStorage_GetListOfFiles(u.NativeStorageType.CACHE).filter(freeOnUnref(function(e){return 0===e.indexOf(n)})).map(freeOnUnref(function(e){return t.storageTransformer.decodePath(e).substring(t.storagePrefix.length)}));return lt.Promise.resolve(r)}),o.prototype.put=freeOnUnref(function(e,t){if(!this.canAcceptRequests())return lt.Promise.reject(new Error(this.notAcceptingRequests));var n=this.getRequestId(),r=this.getMemoryFilename(e,n),i=this.getCacheFilename(e),o=this.diskStorageApi.DiskStorage_RemoveFile(u.NativeStorageType.IN_MEMORY,r);if(o!==u.StorageErrorCode.OK&&o!==u.StorageErrorCode.FILE_DOES_NOT_EXIST)return lt.Promise.reject(new Error('Failed to delete in memory file "'+r+'", errorCode='+o));var a=this.diskStorageApi.DiskStorage_CreateFile(u.NativeStorageType.IN_MEMORY,r);if(a.error_code!==u.StorageErrorCode.OK)return lt.Promise.reject(new Error('Failed to create in memory file "'+r+'", errorCode='+a.error_code));var s=u.StorageErrorCode.OK;return s="string"==typeof t?this.diskStorageApi.DiskStorage_WriteFile(a.file_handler,t):this.diskStorageApi.DiskStorage_WriteFileBinary(a.file_handler,new Uint8Array(t)),this.diskStorageApi.DiskStorage_CloseFile(a.file_handler),s!==u.StorageErrorCode.OK?lt.Promise.reject(new Error("Error writing file "+r+", error code: "+s)):this.sendRequestToVM(l.createWrite(n,i,r)).promise}),o.prototype.remove=freeOnUnref(function(e){if(!this.canAcceptRequests())return lt.Promise.reject(new Error(this.notAcceptingRequests));var t=this.getRequestId(),n=this.getCacheFilename(e);return this.sendRequestToVM(l.createDelete(t,n)).promise}),o.prototype.removePrefix=freeOnUnref(function(e){if(!this.canAcceptRequests())return lt.Promise.reject(new Error(this.notAcceptingRequests));var t=this.getRequestId(),n=this.storageTransformer.encodePath(this.storagePrefix+e);return this.sendRequestToVM(l.createDeletePrefix(t,n)).promise}),o.prototype.shutdown=freeOnUnref(function(){if(!this.canAcceptRequests())return this.vmExited.promise;this.notAcceptingRequests="shutdown has been invoked on Async File Background VM";var e=this.getRequestId();return this.vmManagerApi.PortPostMessage(this.toVMPort,JSON.stringify(l.createShutdown(e))),s.info("Waiting for VM to shutdown for instance "+this.instanceId),this.vmExited.promise}),o.prototype.processVMResponse=freeOnUnref(function(e,t){var n=this.inprogressRequests[e];delete this.inprogressRequests[e],void 0!==n?"read"===n.action.command?t===i?n.response.resolve("NotFound"):""!==t?n.response.reject(new Error(t)):n.response.resolve("Read"):""!==t?n.response.reject(new Error(t)):n.response.resolve():s.warn("Received response for requestId "+e+" which is not in progress, ignoring")}),o.prototype.sendRequestToVM=freeOnUnref(function(e){var t=new lt.Deferred,n=new a(e,t),r=0<this.getInprogressCount();return this.inprogressRequests[e.requestId]=n,this.vmManagerApi.PortPostMessage(this.toVMPort,JSON.stringify(e)),r||(s.info("Queueing checkVMResponses() for instanceId "+this.instanceId),this.eventQueueAPI.insertFunction("idle",this.fromVMPortWaitable,this.checkVMResponses)),t}),o.prototype.openInMemoryFile=freeOnUnref(function(e){var t=this.diskStorageApi.DiskStorage_OpenFile(u.NativeStorageType.IN_MEMORY,e);if(t.error_code!==u.StorageErrorCode.OK)throw new Error("Error opening in memory file "+e+", error code: "+t.error_code);return t}),o.getBackgroundVMScript=freeOnUnref(function(e,t,n){return"(function () {\n                const VMInstanceId = '"+e+"';\n                const COMMAND_READ = 'read';\n                const COMMAND_WRITE = 'write';\n                const COMMAND_DELETE = 'delete';\n                const COMMAND_DELETE_PREFIX = '"+r+"';\n                const COMMAND_SHUTDOWN = 'shutdown';\n                const OK = "+u.StorageErrorCode.OK+";\n                const FILE_DOES_NOT_EXIST = "+u.StorageErrorCode.FILE_DOES_NOT_EXIST+";\n                const ERROR_FILE_DOES_NOT_EXIST = '"+i+"';\n\n                function logInfo(message) {\n                    Native.LogMessage(Native.E_LogLevel_Info, 'AsyncLocalStorageIgnitionVM [' + VMInstanceId + '] ' + message);\n                }\n                function logDebug(message) {\n                    Native.LogMessage(Native.E_LogLevel_Debug, 'AsyncLocalStorageIgnitionVM [' + VMInstanceId + '] ' + message);\n                }\n\n\n                class VMAction {\n                    constructor(requestId, command, outputFilename, inputFilename, filenamePrefix, errorMessage) {\n                        this.requestId = requestId;\n                        this.command = command;\n                        this.outputFilename = outputFilename;                        \n                        this.inputFilename = inputFilename;\n                        this.filenamePrefix = filenamePrefix;\n                        this.errorMessage = errorMessage;\n                    }\n                }\n\n                function createErrorMesg(prefix, filename, errorCode) {\n                    if (errorCode === OK) { return ''; }\n                    return prefix + '\"' + filename + '\" failed with error code ' + errorCode;\n                }\n\n                function sendResponse(action, errorMessage) {\n                    const response = JSON.stringify(new VMAction(action.requestId, action.command, action.outputFilename, action.inputFilename, action.filenamePrefix, errorMessage));\n                    logDebug('sendResponse: ' + response);\n                    VmManager.PortPostMessage(fromVMPort, response);\n                }\n\n                function copyFile(outputStorageType, outputFilename, inputStorageType, inputFilename) {\n                    logDebug('copyFile outputStorageType: ' + outputStorageType + ', outputFilename: ' + outputFilename + ', inputStorageType: ' + inputStorageType + ', inputFilename: ' + inputFilename );\n                    let errorCode = Native.DiskStorage_RemoveFile(outputStorageType, outputFilename);\n                    if( errorCode !== OK && errorCode !== FILE_DOES_NOT_EXIST ) { \n                        return createErrorMesg('Removal of file before writing', filename, errorCode);\n                    }      \n                    errorCode = Native.DiskStorage_CopyFile(outputStorageType, outputFilename, inputStorageType, inputFilename);\n                    if (errorCode !== OK) {\n                        if (errorCode === FILE_DOES_NOT_EXIST) {\n                            return ERROR_FILE_DOES_NOT_EXIST;\n                        }\n                        return createErrorMesg('Copy to file ', outputFilename, errorCode);\n                    }\n                    return '';\n                }    \n\n                function moveFile(outputStorageType, outputFilename, inputStorageType, inputFilename) {\n                    logDebug('moveFile outputStorageType: ' + outputStorageType + ', outputFilename: ' + outputFilename + ', inputStorageType: ' + inputStorageType + ', inputFilename: ' + inputFilename );\n                    let errorCode = Native.DiskStorage_RemoveFile(outputStorageType, outputFilename);\n                    if( errorCode !== OK && errorCode !== FILE_DOES_NOT_EXIST ) { \n                        return createErrorMesg('Removal of file before moving', filename, errorCode);\n                    }      \n                    errorCode = Native.DiskStorage_MoveFile(outputStorageType, outputFilename, inputStorageType, inputFilename);\n                    if (errorCode !== OK) {\n                        return createErrorMesg('Mmove to file ', outputFilename, errorCode);\n                    }\n                    return '';\n                }      \n                    \n                function deleteFile(filename, errorMessages) {\n                    logDebug('deleteFile ' + filename );\n                    const errorCode = Native.DiskStorage_RemoveFile(Native.E_StorageType_Cache, filename);\n                    if (errorCode != OK) {\n                        const errorMessage = createErrorMesg('Removal of file ', filename, errorCode);\n                        errorMessages += errorMessage;\n                        errorMessages += ', ';\n                    }\n                    return errorMessages;\n                }   \n\n                function deleteFilesByPrefix(filenamePrefix) {\n                    logDebug('deleteFilesByPrefix ' + filenamePrefix );\n                    const allFilenames = Native.DiskStorage_GetListOfFiles(Native.E_StorageType_Cache);\n\n                    const filenames = allFilenames\n                        .filter((filename) => filename.indexOf(filenamePrefix) === 0);\n\n                    let errorMessages = '';\n                    filenames.forEach((filename) => { errorMessages = deleteFile(filename, errorMessages) });\n                    return errorMessages;\n                }\n                \n                function processMessage(action) {\n                    if (action.command === COMMAND_SHUTDOWN) {\n                        logInfo('VM is shutting down in response to request');\n                        sendResponse(action, '');\n                        return false;\n                    } \n                    \n                    if (action.command === COMMAND_WRITE) {\n                        // We create a separate in memory file for each action, so we're ok with this being a destructive read of the source in memory file.\n                        const errorMessage = moveFile(Native.E_StorageType_Cache, action.outputFilename, Native.E_StorageType_InMemory, action.inputFilename);\n                        sendResponse(action, errorMessage);\n                    }\n                    else if (action.command === COMMAND_READ) {\n                        const errorMessage = copyFile(Native.E_StorageType_InMemory, action.outputFilename, Native.E_StorageType_Cache, action.inputFilename);\n                        sendResponse(action, errorMessage);\n                    }\n                    else if (action.command === COMMAND_DELETE) {\n                        const errorCode = Native.DiskStorage_RemoveFile(Native.E_StorageType_Cache, action.outputFilename);\n                        const errorMessage = createErrorMesg('Removal of file ', action.outputFilename, errorCode);\n                        sendResponse(action, errorMessage);\n                    }\n                    else if (action.command === COMMAND_DELETE_PREFIX) {\n                        const errorMessage = deleteFilesByPrefix(action.filenamePrefix);\n                        sendResponse(action, errorMessage);\n                    }                        \n                    else {\n                        logInfo('Unknown async file VM command ' + action.command);\n                        sendResponse(action, 'Unknown command, cannot process');\n                    }\n\n                    return true;\n                }\n\n                logInfo('Background VM started');\n                const toVMPort = VmManager.PortOpenNamedPort('"+t+"');\n                const toVMPortWaitable = VmManager.PortGetMessageWaitable(toVMPort);\n                const fromVMPort = VmManager.PortOpenNamedPort('"+n+"');\n\n                for (; ;) {\n                    const signalled = VmManager.WaitForOne([toVMPortWaitable]);\n                    logDebug('signalled ' + signalled);\n                    if (signalled > 0) {\n                        break;\n                    }\n\n                    if (VmManager.PortHasMessages(toVMPort)) {\n                        const message = VmManager.PortPopMessage(toVMPort);\n                        logDebug('Received in VM: \"' + message + '\"' );                        \n                        const action = JSON.parse(message);\n                        if (!processMessage(action)) {\n                            break;\n                        }\n                     }\n                }\n                logInfo('Background VM done');\n            })()"}),o.instanceCount=0,o})();t.AsyncLocalStorageIgnition=n}));e(bt);bt.VMAction,bt.AsyncLocalStorageIgnition;var Pt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorage=Ut.LocalStorageIgnition,t.AsyncLocalStorage=bt.AsyncLocalStorageIgnition;var n=new Ut.LocalStorageIgnition("CACHE_STORAGE_XP_",u.NativeStorageType.IN_MEMORY);t.localStorage=n}));e(Pt);Pt.LocalStorage,Pt.AsyncLocalStorage,Pt.localStorage;var Mt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.PlaybackUrls=freeOnUnref(function(e){return void 0===e&&(e={}),{resourceName:"PlaybackUrls",queryParams:{audioTrackId:e.audioTrackId,languageFeature:e.languageFeature,liveManifestType:null!=e.liveManifestType&&0<e.liveManifestType.length?e.liveManifestType.join(","):void 0,supportedDRMKeyScheme:e.drmKeyScheme,supportsEmbeddedTrickplay:e.supportsEmbeddedTrickplay,daiSupportsEmbeddedTrickplay:e.daiSupportsEmbeddedTrickplay,daiLiveManifestType:null!=e.daiLiveManifestType&&0<e.daiLiveManifestType.length?e.daiLiveManifestType.join(","):void 0,ssaiSegmentInfoSupport:e.ssaiSegmentInfoSupport,ssaiStitchType:e.ssaiStitchType,videoMinBitrate:e.videoMinBitrateBps,videoMaxBitrate:e.videoMaxBitrateBps}}}),e.PlayReadyLicense=freeOnUnref(function(e,t){return{resourceName:"PlayReadyLicense",postParams:{playReadyChallenge:e,playReadyKeyId:t}}}),e.FairPlayLicense=freeOnUnref(function(e,t){return{resourceName:"FairPlayLicense",postParams:{fairPlayChallenge:e,fairPlayKeyId:t}}}),e.FairPlayApplicationCertificate=freeOnUnref(function(){return{resourceName:"FairPlayApplicationCertificate"}}),e.Widevine2License=freeOnUnref(function(e,t){return{resourceName:"Widevine2License",postParams:{widevine2Challenge:e,includeHdcpTestKeyInLicense:t}}}),e.SubtitleUrls=freeOnUnref(function(e){return{resourceName:"SubtitleUrls",queryParams:{subtitleFormat:e}}}),e.ForcedNarratives=freeOnUnref(function(){return{resourceName:"ForcedNarratives"}}),e.WhisperSyncBookmark=freeOnUnref(function(){return{resourceName:"WhisperSyncBookmark"}}),e.CatalogMetadata=freeOnUnref(function(e){return{resourceName:"CatalogMetadata",queryParams:{titleDecorationScheme:e}}}),e.TransitionTimecodes=freeOnUnref(function(){return{resourceName:"TransitionTimecodes"}}),e.CuepointPlaylist=freeOnUnref(function(e,t){return void 0===t&&(t={}),{resourceName:"CuepointPlaylist",queryParams:{siteSectionId:e,advertisingId:t.advertisingId,optOutAdTracking:t.optOutAdTracking,gdprEnabled:null!=t.gdpr?t.gdpr.applicable:void 0,gdprConsentGvl:null!=t.gdpr?t.gdpr.gvlString:void 0,gdprConsentAvl:null!=t.gdpr?t.gdpr.avlString:void 0}}}),e.LiveSchedule=freeOnUnref(function(e){return{resourceName:"LiveSchedule",queryParams:{liveScheduleConfigToken:e}}}),e.SubtitlePresets=freeOnUnref(function(){return{resourceName:"SubtitlePresets"}}),e.XRayMetadata=freeOnUnref(function(e,t,n){return{resourceName:"XRayMetadata",queryParams:{xrayToken:e,xrayPlaybackMode:t,xrayDeviceClass:n}}}),e.TrickplayUrls=freeOnUnref(function(){return{resourceName:"TrickplayUrls"}}),e.PlaybackSettings=freeOnUnref(function(e,t){return{resourceName:"PlaybackSettings",queryParams:{playbackSettingsFormatVersion:e,heuristicProfile:null!=t?JSON.stringify(t.profilePriorities):void 0}}}),e.LinearRestrictions=freeOnUnref(function(e,t){return{resourceName:"LinearRestrictions",queryParams:{linearRestrictionStart:e,linearRestrictionEnd:t}}}),e.SyeUrls=freeOnUnref(function(){return{resourceName:"SyeUrlsV2"}}),e})();t.PlaybackResource=n}));e(Mt);Mt.PlaybackResource;var Ct=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=f.of("KeyValueStoreCache"),o=de.get("KeyValueStoreSink"),n=freeOnUnref(function(){function e(e,t){i(t,"timer").exists(),this.connectionTimeoutMs=e,this.storageCache={},this.readOnlyValuesCache={},this.onRemoteSetEventHandlers=[],this.cacheLoadedFromRemote=!1,this.cacheLoadTimeoutHandle=-1,this.timer=t,this.cacheIsDirty=!1}return e.prototype.callOnRemoteSetEventHandlers=freeOnUnref(function(){for(var e=0,t=this.onRemoteSetEventHandlers;e<t.length;e++){(0,t[e])()}this.onRemoteSetEventHandlers=[]}),e.prototype.get=freeOnUnref(function(e,t){var n=this;i(e,"key").exists(),i(t,"handler").exists(),!this.cacheLoadedFromRemote&&this.cacheLoadTimeoutHandle<0&&(this.cacheLoadTimeoutHandle=this.timer.setTimeout(freeOnUnref(function(){n.cacheLoadedFromRemote||(o.warn("Remote JSON store didn't connect in "+n.connectionTimeoutMs/1e3+" seconds. KeyValueStore.get won't be able to retrieve existing values from the remote store."),n.timer.clearTimeout(n.cacheLoadTimeoutHandle),n.remoteSet({},{}))}),this.connectionTimeoutMs));var r=freeOnUnref(function(){void 0!==n.storageCache[e]?t(n.storageCache[e]):void 0!==n.readOnlyValuesCache[e]?t(n.readOnlyValuesCache[e]):t(null)});this.cacheLoadedFromRemote?this.timer.setImmediate(r):this.onRemoteSetEventHandlers.push(r)}),e.prototype.set=freeOnUnref(function(e,t,n){if(i(e,"key").exists(),i(n,"handler").exists(),this.readOnlyValuesCache[e]){var r=new Error("The key "+e+" is readonly and cannot be overriden");r.code=2,this.timer.setImmediate(freeOnUnref(function(){return n(r)}))}else void 0!==t?this.storageCache[e]=t:delete this.storageCache[e],this.cacheIsDirty=!0,this.timer.setImmediate(n)}),e.prototype.remoteGet=freeOnUnref(function(){return this.cacheIsDirty=!1,this.storageCache}),e.prototype.remoteSet=freeOnUnref(function(e,t){var n=this;this.timer.setImmediate(freeOnUnref(function(){return n.callOnRemoteSetEventHandlers()})),this.storageCache=l.assign(e,this.storageCache),this.readOnlyValuesCache=t,this.cacheLoadedFromRemote=!0}),e.prototype.hasDirtyData=freeOnUnref(function(){return this.cacheIsDirty}),e})();t.KeyValueStoreSink=n}));e(Ct);Ct.KeyValueStoreSink;var Et=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=f.of("KeyValueStore"),n=freeOnUnref(function(){function e(e,t){void 0===e&&(e=5e3),void 0===t&&(t=oe.timer),this.capabilities={isSupported:!0},this.initialized=!1,this.connectionTimeoutMs=e,this.timer=t}return e.prototype.setBridge=freeOnUnref(function(e){r(e,"bridge").exists(),r(this.isInitialized).is.false(),this.bridge=e}),e.prototype.removeBridge=freeOnUnref(function(){r(this.isInitialized).is.false(),this.bridge=void 0}),e.prototype.init=freeOnUnref(function(e){var i=this;if(r(this.isInitialized).is.false(),null==this.bridge){var t=new Error("Could not initialize. No object bridge attached.");t.code=1,this.timer.setImmediate(freeOnUnref(function(){return e(t)}))}else this.sink=new Ct.KeyValueStoreSink(this.connectionTimeoutMs,this.timer),this.bridge.register("KeyValueStoreCache",{getValue:freeOnUnref(function(){return JSON.stringify(i.sink.remoteGet())}),setValue:freeOnUnref(function(e,t){var n={},r={};return null!=e&&(n=JSON.parse(e)),null!=t&&(r=JSON.parse(t)),i.sink.remoteSet(n,r)}),hasNewValue:freeOnUnref(function(){return i.sink.hasDirtyData()})}),this.initialized=!0,this.timer.setImmediate(freeOnUnref(function(){return e()}))}),Object.defineProperty(e.prototype,"isInitialized",{get:freeOnUnref(function(){return this.initialized}),enumerable:!0,configurable:!0}),e.prototype.shutdown=freeOnUnref(function(){r(this.isInitialized).is.true(),this.bridge.deregister("KeyValueStoreSink"),this.initialized=!1}),e.prototype.get=freeOnUnref(function(e,t){r(this.isInitialized).is.true(),r(this.sink).exists(),this.sink.get(e,freeOnUnref(function(e){t(null,e)}))}),e.prototype.set=freeOnUnref(function(e,t,n){r(this.isInitialized).is.true(),r(this.sink).exists(),this.sink.set(e,t,n)}),e})();t.KeyValueStoreAdapter=n}));e(Et);Et.KeyValueStoreAdapter;var Tt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.KeyValueStore=Et.KeyValueStoreAdapter;var n=new Et.KeyValueStoreAdapter;t.keyValueStore=n}));e(Tt);Tt.KeyValueStore,Tt.keyValueStore;var wt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("SurfaceRefAdapterProxy"),n=freeOnUnref(function(){function e(e){var n=this;this.surfaceRefListener=e,this.eventEmitter=new A.EventEmitter,this.isInitialized=!1,this.setViewportSurfaceCommand=freeOnUnref(function(e,t){return n.singletonId!==e?lt.Promise.resolve("NotExecuted"):n.isDynamicResizingSupported()?_t.isViewportValid(t)?null==n.resizeViewport?(i.info("No playback is currently active to dynamically resize"),lt.Promise.resolve("Ok")):(i.info("Dynamically resizing player viewport on MPB with viewport: "+JSON.stringify(t)),n.resizeViewport(t).then(freeOnUnref(function(e){return"surface.resize.success"===e?lt.Promise.resolve("Ok"):(i.error("Failed to dynamically resize the player viewport "+JSON.stringify(t)+" due to an error from MPB: "+JSON.stringify(e)),lt.Promise.resolve("PlatformError"))})).catch(freeOnUnref(function(e){throw i.error("Failed to dynamically resize the player viewport "+JSON.stringify(t)+" due to an error from MPB",e),e}))):lt.Promise.resolve("InvalidArgs"):(i.error("Dynamic resizing is not supported by this device"),lt.Promise.resolve("NotSupported"))}),this.setExternalSurfaceIdCommand=freeOnUnref(function(e,t){return n.singletonId!==e?lt.Promise.resolve("NotExecuted"):(n.eventEmitter.emit("external-surface-id-changed",{externalSurfaceId:t}),lt.Promise.resolve("Ok"))}),this.emitResizedEvent=freeOnUnref(function(e){if(n.singletonId===e){var t=n.surfaceRefListener.getSurfaceRef(n.singletonId);null!=t&&null!=t.viewport?n.eventEmitter.emit("resized",t.viewport):i.warn("unexpected viewport changed event for surfaceRefId "+e+" without a registered singleton surface, ignoring")}else i.info("ignoring viewport changed event for surfaceRefId "+e)})}return e.prototype.cacheSurfaceRef=freeOnUnref(function(e){null==e?this.surfaceRefListener.deregisterSurfaceRef(this.singletonId):this.surfaceRefListener.registerSurfaceRef(e)}),e.prototype.setResizeViewportFunction=freeOnUnref(function(e){null!=(this.resizeViewport=e)?this.surfaceRefListener.registerCommand("set-viewport",this.setViewportSurfaceCommand):this.surfaceRefListener.deregisterCommand("set-viewport",this.setViewportSurfaceCommand)}),e.prototype.setViewport=freeOnUnref(function(e){return this.surfaceRefListener.setViewport(this.singletonId,e).then(freeOnUnref(function(e){switch(i.info("setViewport result is "+e),e){case"Ok":case"NotExecuted":case"NoHandlerRegistered":return lt.Promise.resolve(0);case"NotSupported":return i.warn("setViewport result is NotSupported"),lt.Promise.reject(1);default:return lt.Promise.reject(2)}})).catch(freeOnUnref(function(e){return i.error("setViewport error",e),lt.Promise.reject(3)}))}),e.prototype.setExternalSurfaceId=freeOnUnref(function(e){var t=e.externalSurfaceId;return this.surfaceRefListener.setExternalSurfaceId(this.singletonId,t).then(freeOnUnref(function(e){return i.info("result "+e+" setting external surface id"),0})).catch(freeOnUnref(function(e){return i.error("error setting external surface id",e),0}))}),e.prototype.getSurfaceRef=freeOnUnref(function(){return Qe.withDefault(this.surfaceRefListener.getSurfaceRef(this.singletonId),void 0)}),e.prototype.init=freeOnUnref(function(t,n){var r=this;this.surfaceRefListener.init(t,freeOnUnref(function(e){if(null==e){t.register("SurfaceRefManager",{setViewport:freeOnUnref(function(e){return r.setViewport(e)}),setExternalSurfaceId:freeOnUnref(function(e){return r.setExternalSurfaceId(e)})}),r.surfaceRefListener.registerCommand("set-external-surface-id",r.setExternalSurfaceIdCommand),r.surfaceRefListener.on("viewport-changed",r.emitResizedEvent),r.isInitialized=!0,i.info("Register SurfaceRefManagerProxy init completed"),n()}else n(e)}))}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),Object.defineProperty(e.prototype,"singletonId",{get:freeOnUnref(function(){return this.surfaceRefListener.singletonId}),enumerable:!0,configurable:!0}),e.prototype.isDynamicResizingSupported=freeOnUnref(function(){return void 0!==this.dynamicResizingSupported?this.dynamicResizingSupported:null!=zt.deviceCapabilities&&null!=zt.deviceCapabilities.output&&null!=zt.deviceCapabilities.output.video.display.supportedPlayerResizingMode&&-1!==zt.deviceCapabilities.output.video.display.supportedPlayerResizingMode.indexOf("Immediately")?(i.info("Device supports dynamic viewport resizing"),this.dynamicResizingSupported=!0):(i.info("Device does not support dynamic viewport resizing"),this.dynamicResizingSupported=!1)}),e})();t.SurfaceRefAdapterProxy=n}));e(wt);wt.SurfaceRefAdapterProxy;var It=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("SurfaceRefListenerAdapter"),n=freeOnUnref(function(){function e(){this.initialized=!1,this.surfaceRefs={},this.eventEmitter=new A.EventEmitter,this.commandsRegistry={}}return e.prototype.registerSurfaceRef=freeOnUnref(function(e){var t=Qe.withDefault(e,{}),n=this.getSurfaceRefId(t);return this.registerNewSurfaceRef(n,t),n}),e.prototype.deregisterSurfaceRef=freeOnUnref(function(e){var t=this.getMapKey(e);return null!=this.surfaceRefs[t]&&(i.info(">> deregisterSurfaceRef removed surface under id "+e),delete this.surfaceRefs[t],!0)}),e.prototype.getSurfaceRef=freeOnUnref(function(e){var t=this.getMapKey(e),n=this.surfaceRefs[t];return null==n?null:n}),e.prototype.onViewportChanged=freeOnUnref(function(e,t){var n=this.getMapKey(e),r=this.surfaceRefs[n];return null==r?lt.Promise.reject(new Error("[onViewportChanged] Surface reference not found under id "+JSON.stringify(e))):(l.isEqual(r.viewport,t)?i.info("[onViewportChanged] Ignoring new playerViewport="+t+" for surfaceRefId="+n+", it is equal to existing value"):(r.viewport=Qe.deepClone(t),this.eventEmitter.emit("viewport-changed",e)),lt.Promise.resolve())}),e.prototype.setViewport=freeOnUnref(function(e,t){var n=this,r=this.getSurfaceRef(e);return null==r?this.registerNewSurfaceRef(e,{viewport:t}):r.viewport=Qe.deepClone(t),this.eventEmitter.emit("viewport-changed",e),this.callAll("set-viewport",[e,t]).then(freeOnUnref(function(e){return n.emitSetViewportMetrics(e),e}))}),e.prototype.setExternalSurfaceId=freeOnUnref(function(e,t){var n=this.getSurfaceRef(e);return null==n?this.registerNewSurfaceRef(e,{externalSurfaceId:t}):n.externalSurfaceId=t,this.callAll("set-external-surface-id",[e,t])}),e.prototype.init=freeOnUnref(function(e,t){var n=this;e.register("SurfaceRefListener",{setViewport:freeOnUnref(function(e,t){return n.setViewport(e,t)}),setViewportSingleton:freeOnUnref(function(e){return n.setViewport(n.singletonId,e)}),setExternalSurfaceId:freeOnUnref(function(e,t){return n.setExternalSurfaceId(e,t.externalSurfaceId)}),setExternalSurfaceIdSingleton:freeOnUnref(function(e){return n.setExternalSurfaceId(n.singletonId,e.externalSurfaceId)}),onViewportChanged:freeOnUnref(function(e,t){return n.onViewportChanged(e,t)})}),this.initialized=!0,i.info("Register SurfaceRefListenerAdapter completed"),t()}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.registerCommand=freeOnUnref(function(e,t){var n=this.commandsRegistry[e];null!=n&&0<n.length?n.push(t):this.commandsRegistry[e]=[t]}),e.prototype.deregisterCommand=freeOnUnref(function(e,t){var n=this.commandsRegistry[e];null!=n&&0<n.length&&(this.inPlaceFilter(n,t),0===n.length&&delete this.commandsRegistry[e])}),Object.defineProperty(e.prototype,"isInitialized",{get:freeOnUnref(function(){return this.initialized}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"singletonId",{get:freeOnUnref(function(){return"singleton-id"}),enumerable:!0,configurable:!0}),e.prototype.callAll=freeOnUnref(function(t,n){var e=this.commandsRegistry[t];if(null==e||e.length<1)return lt.Promise.resolve("NoHandlerRegistered");var r=e.map(freeOnUnref(function(e){return e.apply(void 0,n)}));return lt.Promise.all(r).then(freeOnUnref(function(e){for(var t=l.countBy(e),n=0,r=["InvalidArgs","NotSupported","PlatformError"];n<r.length;n++){var i=r[n];if(0<t[i])return i}return 0<t.Ok?"Ok":"NotExecuted"})).catch(freeOnUnref(function(e){throw i.error("error executing command "+t,e),e}))}),e.prototype.registerNewSurfaceRef=freeOnUnref(function(e,t){i.info(">> registerNewSurfaceRef registering surface "+JSON.stringify(t)+" under id "+e);var n=this.getMapKey(e);this.surfaceRefs[n]=Qe.deepClone(t)}),e.prototype.getSurfaceRefId=freeOnUnref(function(e){return Qe.withDefault(e.instanceId,this.singletonId)}),e.prototype.getMapKey=freeOnUnref(function(e){return e===this.singletonId?e:"object"==typeof e?JSON.stringify(e):"string"==typeof e?e:String(e)}),e.prototype.emitSetViewportMetrics=freeOnUnref(function(e){"InvalidArgs"===e?q.metrics.putMetric("Resize.Fail.Invalid"):"NotSupported"===e?q.metrics.putMetric("Resize.Fail.Unsupported"):"NoHandlerRegistered"===e&&q.metrics.putMetric("Resize.Success.None")}),e.prototype.inPlaceFilter=freeOnUnref(function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t){e.splice(n,1);break}}),e})();t.SurfaceRefListenerAdapter=n}));e(It);It.SurfaceRefListenerAdapter;var kt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isViewportValid=function(e){return null!=e&&"object"==typeof e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.width&&"number"==typeof e.height}}));e(kt);kt.isViewportValid;var _t=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SurfaceRefManager=wt.SurfaceRefAdapterProxy,t.SurfaceRefListener=It.SurfaceRefListenerAdapter;var n=new It.SurfaceRefListenerAdapter;t.surfaceRefListener=n;var r=new wt.SurfaceRefAdapterProxy(n);t.surfaceRefManager=r;var i=n;t.surfaceRefRegistry=i;var o=n;t.surfaceRefRegister=o,t.isViewportValid=kt.isViewportValid}));e(_t);_t.SurfaceRefManager,_t.SurfaceRefListener,_t.surfaceRefListener,_t.surfaceRefManager,_t.surfaceRefRegistry,_t.surfaceRefRegister,_t.isViewportValid;var Rt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.DEFAULT_CONFIG={clientConfig:{garbageCollectionIntervalMs:5e3,memoryMetricsPollIntervalMs:-1,middleware:{name:"Ignite",version:"Unknown"}}}}));e(Rt);Rt.DEFAULT_CONFIG;var At=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("JsBundleInformation"),n=freeOnUnref(function(){function r(){this.initialized=!1}return r.prototype.init=freeOnUnref(function(t,e){if(!this.initialized){var n=e.call(r.objectIdentifier,r.setVersionFunc,[t.version]);this.initialized=!0,n.then(freeOnUnref(function(){})).catch(freeOnUnref(function(e){i.error("Failed to set JS Bundle version to "+t.version+" due to "+e.message)}))}}),r.objectIdentifier="PlayerBundleMetadata",r.setVersionFunc="setVersion",r})();t.JsBundleMetadataEmitter=n}));e(At);At.JsBundleMetadataEmitter;var Dt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("PlatformRuntimeAdapter"),r=freeOnUnref(function(){function o(e,t,n,r){void 0===e&&(e=oe.timer),void 0===t&&(t=Rt.DEFAULT_CONFIG),void 0===n&&(n=Tt.keyValueStore),void 0===r&&(r=re.connector),this.timer=e,this.defaultConfig=t,this.gcIntervalHandle=-1,this.memoryIntervalHandle=-1,this.config=null,this.connector=r,this.keyValueStore=n,this.bundleInformation=new At.JsBundleMetadataEmitter,this.gcFunction=o.generateGcFunction()}return o.generateGcFunction=freeOnUnref(function(){return"undefined"==typeof Duktape?freeOnUnref(function(){}):freeOnUnref(function(){Duktape.gc()})}),o.prototype.doConfigure=freeOnUnref(function(){var i=this;if(null!=this.config)if(null!=this.config.objectBridge&&(this.keyValueStore.isInitialized||(this.keyValueStore.setBridge(this.config.objectBridge),this.keyValueStore.init(freeOnUnref(function(e){null!=e&&n.error("KeyValueStore initialization failed with code "+e.code+". "+e.message)}))),this.config.objectBridge.register("IgnitionRuntime",{runGarbageCollection:freeOnUnref(function(){i.gcFunction()})}),_t.surfaceRefManager.isInitialized?n.info("SurfaceRefManager already initialized"):_t.surfaceRefManager.init(this.config.objectBridge,freeOnUnref(function(e){null!=e?n.error("SurfaceRefManager initialization failed with code "+e.code+". "+e.message):n.info("SurfaceRefManager initialization succeeded")})),this.bundleInformation.init(o.jsBundleMetadata,this.config.objectBridge)),null!=this.config.clientConfig){-1!==this.gcIntervalHandle&&this.timer.clearInterval(this.gcIntervalHandle),-1!==this.memoryIntervalHandle&&this.timer.clearInterval(this.memoryIntervalHandle);var e=freeOnUnref(function(){i.gcFunction()});this.gcIntervalHandle=this.timer.setInterval(e,this.config.clientConfig.garbageCollectionIntervalMs);var t=this.config.clientConfig.memoryMetricsPollIntervalMs;0<t&&(this.memoryIntervalHandle=this.timer.setInterval(freeOnUnref(function(){var e={messageName:"IgnitionDiagnostics",payload:"{}"},t={},n=i.getPlayerJsMemoryUsage();n&&(t.jsHeap=n);var r=i.getPlayerPeakJsMemoryUsage();r&&(t.jsPeakHeap=r),e.payload=JSON.stringify(t),i.connector.messageBusAPI.sendMessage(JSON.stringify(e))}),t)),this.config.clientConfig.middleware={name:"Ignite",version:this.connector.nativeDeviceInformationAPI.getNativeCodeVersion()}}else n.warn("Configure called with invalid client config: "+this.config.clientConfig);else n.warn("Configure called with invalid config: "+this.config)}),o.prototype.clear=freeOnUnref(function(){-1!==this.gcIntervalHandle&&this.timer.clearInterval(this.gcIntervalHandle),-1!==this.memoryIntervalHandle&&this.timer.clearInterval(this.memoryIntervalHandle),this.config=null}),o.prototype.configure=freeOnUnref(function(e){var t=l.cloneDeep(this.defaultConfig);this.config=l.merge(t,e),this.doConfigure()}),Object.defineProperty(o.prototype,"playerBundleMetadata",{get:freeOnUnref(function(){return o.jsBundleMetadata}),enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"configuration",{get:freeOnUnref(function(){return this.config}),enumerable:!0,configurable:!0}),o.prototype.evaluate=freeOnUnref(function(e){return Function('"use strict";return '+e)()}),o.prototype.onUncaughtException=freeOnUnref(function(e){this.connector.onUncaughtExceptionHandler(e)}),o.prototype.loadavg=freeOnUnref(function(){return null}),o.prototype.getPlayerCpuUsage=freeOnUnref(function(){return this.connector.metricsAPI.getProcessCpuUtilisation()}),o.prototype.getPlayerJsMemoryUsage=freeOnUnref(function(){return this.connector.metricsAPI.getPlayerHeapMemory()}),o.prototype.getPlayerPeakJsMemoryUsage=freeOnUnref(function(){return this.connector.metricsAPI.getPlayerPeakHeapMemory()}),o.prototype.getProcessMemoryUsage=freeOnUnref(function(){return this.connector.metricsAPI.getProcessRssMemory()}),o.jsBundleMetadata={name:"ATVUnfPlayerBundle",version:"ATVUnfPlayerBundle-1.0.16169.0"},o})();t.PlatformRuntimeAdapter=r}));e(Dt);Dt.PlatformRuntimeAdapter;var xt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformRuntimeAdapter=Dt.PlatformRuntimeAdapter,t.PlatformRuntime=Dt.PlatformRuntimeAdapter;var n=new Dt.PlatformRuntimeAdapter;t.platformRuntime=n}));e(xt);xt.PlatformRuntimeAdapter,xt.PlatformRuntime,xt.platformRuntime;var Ft=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.DISPLAY_TYPE_QUERIERS=((n={}).HDR10={mimeType:"video",mimeSubType:"mp4",mimeAttributeKeys:["codecs","width","height","bitrate","framerate","profile","level","hdrMetadataType","colorGamut","transferFunction"],mimeAttributeValues:["hev1.2.4.L150.90","3840","2160","25000000","30.0","Main10","5.0",p.HdrMetadataType.SMPTE_ST_2086,p.ColorGamut.REC_2020,p.TransferFunction.PQ]},n.HDR10Plus={mimeType:"video",mimeSubType:"mp4",mimeAttributeKeys:["codecs","width","height","bitrate","framerate","profile","level","hdrMetadataType","colorGamut","transferFunction"],mimeAttributeValues:["hev1.2.4.L150.90","3840","2160","25000000","30.0","Main10","5.0",p.HdrMetadataType.SMPTE_ST_2094_40,p.ColorGamut.REC_2020,p.TransferFunction.PQ]},n.DolbyVision={mimeType:"video",mimeSubType:"mp4",mimeAttributeKeys:["codecs","width","height","bitrate","framerate","profile","level"],mimeAttributeValues:["dvhe.05.07","3840","2160","25000000","30.0","dvhe.stn","07"]},n)}));e(Ft);Ft.DISPLAY_TYPE_QUERIERS;var Bt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("MmlSpecificDeviceCaps"),r=freeOnUnref(function(){function e(e,t){void 0===e&&(e=T.getInstanceManager()),void 0===t&&(t=T.getDrmManager()),this.mpbCapabilities=void 0,this.drmCapabilities=void 0,this.isMmlEnabled=!0,this.instanceManager=e,this.drmManager=t}return e.prototype.getDynamicRangeCaps=freeOnUnref(function(e){var n=this,r=new Array;return["HDR10","HDR10Plus","DolbyVision"].forEach(freeOnUnref(function(e){var t=n.getDynamicRangeCapsFor(e);null!=t&&!0===t.is_supported&&!0===t.is_smooth&&r.push(e)})),r}),e.prototype.getDynamicRangeCapsFor=freeOnUnref(function(e){var t=this.instanceManager.canDecodeMedia(Ft.DISPLAY_TYPE_QUERIERS[e]);if(t.error_code===p.MPBErrors.OK)return t;n.error("Failed to retrieve "+e+" dynamic range property: "+JSON.stringify(t))}),e.prototype.populateSupportedPictureModes=freeOnUnref(function(e){var t=this.getMpbCapabilities();if(null==t)return lt.Promise.reject(new Error("populateSupportedPictureModes failed, received MPB capabilities: "+t));var n=t.supportedPictureModes;return null!=n&&0<n.length?lt.Promise.resolve(this.getNativeTranslatedPictureMode(n)):lt.Promise.resolve([])}),e.prototype.populateResizeModes=freeOnUnref(function(e){var t=this.getResizeCapabilities();return null==t?lt.Promise.reject(new Error("populateResizeModes failed, received MPB capabilities: "+t)):lt.Promise.resolve(t)}),e.prototype.getVariableAspectRatioCapability=freeOnUnref(function(e){var t=this.getMpbCapabilities();return null==t?lt.Promise.reject(new Error("getVariableAspectRatioCapability failed, received MPB capabilities: "+t)):lt.Promise.resolve(!0===t.supportsVariableAspectRatio)}),e.prototype.getDynamicRangeDppValue=freeOnUnref(function(e){return n.info("MML uses media codec querier to retrieve the dynamic range support details"),lt.Promise.resolve(!1)}),e.prototype.getResizeCapabilities=freeOnUnref(function(e){var t=this.getMpbCapabilities();if(null!=t)return!0===t.supportsDynamicPlayerResize?"Immediately":"NotSupported";n.error("getResizeCapabilities failed as MPB capabilities returns: "+JSON.stringify(t))}),e.prototype.getIntraChunkSeekCapability=freeOnUnref(function(e){var t=this.getMpbCapabilities();return null==t||null==t.intraChunkSeekSupport?(n.error("getIntraChunkSeekCapability failed, intra chunk seek support returned: "+JSON.stringify(t)),lt.Promise.resolve(void 0)):lt.Promise.resolve(!0===t.intraChunkSeekSupport)}),e.prototype.getMaxSupportedMediaKeySessions=freeOnUnref(function(e){var t=this.getDRMCapabilities();return null==t?lt.Promise.resolve(void 0):lt.Promise.resolve(t.supportedSystems[0].maxSupportedSessions)}),e.prototype.isUhdSupported=freeOnUnref(function(e){var t=this.instanceManager.canDecodeMedia({mimeType:"video",mimeSubType:"mp4",mimeAttributeKeys:["codecs","width","height","bitrate","framerate","profile","level"],mimeAttributeValues:["hev1.2.4.L150.90","3840","2160","25000000","30.0","Main10","5.0"]});return t.error_code!==p.MPBErrors.OK?(n.error("Failed to retrieve UHD support : "+JSON.stringify(t)),lt.Promise.resolve(!1)):lt.Promise.resolve(!0===t.is_supported&&!0===t.is_smooth)}),e.prototype.getMpbCapabilities=freeOnUnref(function(){if(null!=this.mpbCapabilities)return this.mpbCapabilities;var e=this.instanceManager.getCapabilities();if(e.errorCode===p.MPBErrors.OK)return this.mpbCapabilities=e.capabilities;n.error("MPB getCapabilities failed: "+JSON.stringify(e))}),e.prototype.getDRMCapabilities=freeOnUnref(function(){if(null!=this.drmCapabilities)return this.drmCapabilities;if(this.drmCapabilities=this.drmManager.getCapabilities(),null!=this.drmCapabilities){if(!(this.drmCapabilities.supportedSystems.length<=0))return this.drmCapabilities;n.error("DRM get capabilities returned supported system array length as 0: "+JSON.stringify(this.drmCapabilities))}else n.error("DRM get capabilities returned undefined: "+JSON.stringify(this.drmCapabilities))}),e.prototype.getNativeTranslatedPictureMode=freeOnUnref(function(e){var t=[];return e.forEach(freeOnUnref(function(e){switch(e){case"filmmaker":t.push("Filmmaker");break;case"calibratedCinematic":t.push("CalibratedCinematic");break;case"calibratedBroadcast":t.push("CalibratedBroadcast")}})),t}),e})();t.MmlSpecificDeviceCaps=r}));e(Bt);Bt.MmlSpecificDeviceCaps;var Lt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("DpcPropertyGetter");t.createDpcPropertyGetter=function(i,o,a,s){return void 0===s&&(s=!1),freeOnUnref(function(t){return new lt.Promise(function(n,r){function e(e,t){e?n({key:o,value:t}):s?n({key:o,value:null}):r(new Error('Device property key "'+o+'" not found'))}switch(i){case 0:return t.getBoolProperty(o,a,e);case 1:return t.getInt32Property(o,a,e);case 2:return t.getStringProperty(o,a,e)}})})}}));e(Lt);Lt.createDpcPropertyGetter;var Nt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("UnfSpecificDeviceCaps"),n=freeOnUnref(function(){function e(){this.isMmlEnabled=!1,this.wrapNativeErrorMessage=freeOnUnref(function(e,t){return"DPP query error: "+e+" property failed, native error code : "+t.errorCode+", message : "+t.message})}return e.prototype.getDynamicRangeCaps=freeOnUnref(function(t){var n=new Array;return[{hdrFlagBit:1,dynamicRangeProp:"HDR10"},{hdrFlagBit:4,dynamicRangeProp:"HDR10Plus"},{hdrFlagBit:2,dynamicRangeProp:"DolbyVision"}].forEach(freeOnUnref(function(e){t&e.hdrFlagBit&&n.push(e.dynamicRangeProp)})),n}),e.prototype.getResizeCapabilities=freeOnUnref(function(e){return e?"Immediately":re.connector.mpbFactoryAPI.getMPBCommandAPI().isResizingSupported()?"InitialSizeOnly":"NotSupported"}),e.prototype.populateSupportedPictureModes=freeOnUnref(function(e){var t=[],n=this.promisifyPictureMode("supportsFilmmakerMode",e).then(freeOnUnref(function(e){e?t.push("Filmmaker"):i.info("Filmmaker picture mode is unsupported as DPP query for SupportsFilmmakerMode returns: "+e)})),r=this.promisifyPictureMode("supportsCalibratedMode",e).then(freeOnUnref(function(e){e?t.push("CalibratedCinematic","CalibratedBroadcast"):i.info("Calibrated picture mode is unsupported as DPP query for SupportsCalibratedMode returns: "+e)}));return lt.Promise.all([n,r]).then(freeOnUnref(function(){return t}))}),e.prototype.populateResizeModes=freeOnUnref(function(e){var t=this;return this.promisifyBooleanDppProp("supportsDynamicPlayerResizing",e,!0,!0).then(freeOnUnref(function(e){return null!=e.value?t.getResizeCapabilities(e.value):t.getResizeCapabilities(!1)})).catch(freeOnUnref(function(e){return i.error(t.wrapNativeErrorMessage("SupportsDynamicPlayerResizing",e)),i.info("Trying to get static resize properties..."),t.getResizeCapabilities(!1)}))}),e.prototype.getDynamicRangeDppValue=freeOnUnref(function(e){return this.promisifyBooleanDppProp("supportsHDR",e,!0,!1).then(freeOnUnref(function(e){if(null==e.value)throw new Error("Failed to retrieve Dynamic range DPP value: "+JSON.stringify(e));return!0===e.value}))}),e.prototype.getVariableAspectRatioCapability=freeOnUnref(function(e){var t=this;return this.promisifyBooleanDppProp("supportsVariableAspectRatio",e,!0,!0).then(freeOnUnref(function(e){return!0===e.value})).catch(freeOnUnref(function(e){return i.error(t.wrapNativeErrorMessage("SupportsVariableAspectRatio",e)),!1}))}),e.prototype.promisifyPictureMode=freeOnUnref(function(t,e){var n=this;return this.promisifyBooleanDppProp(t,e,!0,!0).then(freeOnUnref(function(e){return!0===e.value})).catch(freeOnUnref(function(e){return i.error(n.wrapNativeErrorMessage(t,e)),!1}))}),e.prototype.getIntraChunkSeekCapability=freeOnUnref(function(e){return this.promisifyBooleanDppProp("supportsIntraChunkSeeking",e,!0,!0).then(freeOnUnref(function(e){return!0===e.value}))}),e.prototype.getMaxSupportedMediaKeySessions=freeOnUnref(function(e){return this.promisifyInt32DppProp("maxSupportedMediaKeySessions",e,!0,!0).then(freeOnUnref(function(e){return e.value}))}),e.prototype.isUhdSupported=freeOnUnref(function(e){return this.promisifyBooleanDppProp("supportsUHD",e,!0,!0).then(freeOnUnref(function(e){return!0===e.value}))}),e.prototype.promisifyInt32DppProp=freeOnUnref(function(e,t,n,r){return Lt.createDpcPropertyGetter(1,e,n,r)(t)}),e.prototype.promisifyBooleanDppProp=freeOnUnref(function(e,t,n,r){return Lt.createDpcPropertyGetter(0,e,n,r)(t)}),e})();t.UnfSpecificDeviceCaps=n}));e(Nt);Nt.UnfSpecificDeviceCaps;var Vt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=de.get("DeviceSpecificCaps");t.getDeviceSpecificCapsInstance=freeOnUnref(function(){return null!=n||(re.isUNFSupported?T.isMMLSupported?null!=re.connector.clientWeblabConfig&&null!=re.connector.clientWeblabConfig.configuration&&!1===re.connector.clientWeblabConfig.configuration[p.MML_CLIENT_FEATURE_FLAG]?(r.info("Using MML DeviceCapabilities API is disabled in DIS config - Initialised UNF specific device capabilities"),n=new Nt.UnfSpecificDeviceCaps):!1===T.getInstanceManager().isCanDecodeMediaSupported()?(r.info("MML DeviceCapabilites API not supported - initialised UNF specific device capabilities"),n=new Nt.UnfSpecificDeviceCaps):(r.info("Initialised MML specific device capabilities"),n=new Bt.MmlSpecificDeviceCaps):(r.info("MML not supported - initialised UNF specific device capabilities"),n=new Nt.UnfSpecificDeviceCaps):(r.info("UNF not supported - initialised MML specific device capabilities"),n=new Bt.MmlSpecificDeviceCaps)),n})}));e(Vt);Vt.getDeviceSpecificCapsInstance;var jt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=f.of("DeviceInformationAdapter"),d=de.get("DeviceInformationAdapter"),o={};t.deviceInformation=o;var a=freeOnUnref(function(){function i(e,t){void 0===e&&(e=re.connector.devicePropertiesAPI),void 0===t&&(t=i.SHUTDOWN_TIMEOUT),this.devicePropertiesApi=e,this.shutdownTimeout=t,this.deviceSpecificCaps=Vt.getDeviceSpecificCapsInstance()}return i.prototype.init=freeOnUnref(function(s,l,f,u){var c=this;n(l,"handler").exists(),n(s,"config").exists(),new lt.Promise(freeOnUnref(function(e){e()})).then(freeOnUnref(function(){var e=c.deviceSpecificCaps.getIntraChunkSeekCapability(c.devicePropertiesApi).then(freeOnUnref(function(e){c.intraChunkSeekingSupported=e})),t=c.deviceSpecificCaps.getMaxSupportedMediaKeySessions(c.devicePropertiesApi).then(freeOnUnref(function(e){c.maxSupportedMediaKeySessions=e})),n=c.deviceSpecificCaps.isUhdSupported(c.devicePropertiesApi).then(freeOnUnref(function(e){c.isUhdSupported=e}));return lt.Promise.all([e,t,n])})).then(freeOnUnref(function(){var e=i.stringProperties.map(freeOnUnref(function(e){var t=e.name,n=e.isOptional;return Lt.createDpcPropertyGetter(2,t,!0,n)(c.devicePropertiesApi)})),t=i.numberProperties.map(freeOnUnref(function(e){var t=e.name,n=e.isOptional;return Lt.createDpcPropertyGetter(1,t,!0,n)(c.devicePropertiesApi)})),n=i.boolProperties.map(freeOnUnref(function(e){var t=e.name,n=e.isOptional;return Lt.createDpcPropertyGetter(0,t,!0,n)(c.devicePropertiesApi)})),r=e.concat(t,n);return lt.Promise.all(r)})).then(freeOnUnref(function(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n],o=i.key,a=i.value;t[o]=a}c.buildHardware(f,t,s.deviceTypeId),c.buildSoftware(f,t,u),c.buildStorage(f,t),c.buildEncryptedMedia(f),c.buildMediaPlayer(f),c.buildMediaSource(f,t),l()})).catch(freeOnUnref(function(e){var t="Error while initializing device information adapter, native error "+e;d.error(t);var n=new Error(t);l(n)}))}),i.prototype.buildMediaSource=freeOnUnref(function(e,t){var n=this;e.mediaSource={get maxVideoBitrate(){return i.getMaxVideoBitrate(n,t)},maxSourceBufferSizeBytes:Number.MAX_VALUE,requestedFrontBufferLengthMs:2e4}}),i.getMaxVideoBitrate=freeOnUnref(function(e,t){if(null!=e.maxVideoBitrate)return e.maxVideoBitrate;var n=null,r=L.configurationStore.configuration;if(null==r)return n;var i=Qe.nestedValue(r,"device.maxVideoBitrateOverrideBitsPerSec"),o=t.modelName;return null!=i&&Qe.isObject(i)&&null!=o?n=Qe.nestedValue(i,o,n):"number"==typeof i&&(n=i),null!=n&&d.info("Max Video Bitrate overridden to "+n),e.maxVideoBitrate=n}),i.prototype.buildMediaPlayer=freeOnUnref(function(e){e.mediaPlayer={supportsIntraChunkSeeking:this.intraChunkSeekingSupported}}),i.prototype.buildHardware=freeOnUnref(function(e,t,n){e.hardware={deviceTypeId:n,manufacturer:t.manufacturer,model:{name:t.modelName},chipset:t.chipset}}),i.prototype.getScriptEngine=freeOnUnref(function(){return"undefined"!=typeof Duktape&&Duktape.hasOwnProperty("version")?{name:"Duktape",version:Duktape.version.toString()}:"function"==typeof Native.GetScriptEngineType&&"function"==typeof Native.GetByteCodeVersionString?{name:Native.GetScriptEngineType(),version:Native.GetByteCodeVersionString()}:void 0}),i.prototype.buildSoftware=freeOnUnref(function(e,t,n){var r="undefined"!=typeof Native;e.software={firmware:{version:t.firmwareVersion},operatingSystem:{name:t.osName,version:t.osVersion},nativeRuntime:r?{name:"IgnitionX",version:Native.GetFirmwareVersion()}:void 0,scriptEngine:this.getScriptEngine(),playerBundle:{name:n.playerBundleMetadata.name,version:n.playerBundleMetadata.version},advertisingId:t.advertisingId,isAdvertisingOptOut:t.isAdvertisingOptOut,deviceFamily:"LivingRoomPlayer"},e.software=l.extend(e.software,{get middleware(){var e=Qe.nestedValue(n,"configuration.clientConfig.middleware");return null!=e?{name:e.name,userAgent:e.userAgent,version:e.version}:void 0},get nativeApplication(){return{name:null!=this.middleware?this.middleware.name:void 0,version:t.platformPackageVersion}}})}),i.prototype.buildStorage=freeOnUnref(function(e,s){var l=this;e.storage={fragmentCache:{get sizeBytes(){if(null!=l.fragmentCacheSizeBytes)return l.fragmentCacheSizeBytes;var e=s.fragmentCacheSize,t=L.configurationStore.configuration;if(null===t)return e;var n=e,r=Qe.nestedValue(t,"device.fragmentCacheSizeBytes"),i=s.modelName;if(null!=r&&Qe.isObject(r)&&null!=i){if(null==(e=Qe.nestedValue(r,i,null))){var o=Qe.nestedValue(r,"UHD",n),a=Qe.nestedValue(r,"NOUHD",n);e=l.isUhdSupported?o:a}}else"number"==typeof r&&(e=r);return e!==n&&d.info("Fragment cache size in bytes overridden to "+e+" from platform provided "+n),l.fragmentCacheSizeBytes=e}}}}),i.prototype.buildEncryptedMedia=freeOnUnref(function(e){e.encryptedMedia={maxSupportedMediaKeySessions:this.maxSupportedMediaKeySessions}}),i.NATIVE_SUCCESS_CODE=0,i.SHUTDOWN_TIMEOUT=1e3,i.stringProperties=[{name:"manufacturer",isOptional:!1},{name:"modelName",isOptional:!1},{name:"chipset",isOptional:!0},{name:"firmwareVersion",isOptional:!1},{name:"platformPackageVersion",isOptional:!0},{name:"osName",isOptional:!1},{name:"osVersion",isOptional:!1},{name:"advertisingId",isOptional:!0}],i.numberProperties=[{name:"fragmentCacheSize",isOptional:!1}],i.boolProperties=[{name:"isAdvertisingOptOut",isOptional:!0}],i})();t.DeviceInformationAdapter=a,t.initDeviceInformation=function(e,t,n,r,i){void 0===n&&(n=o),void 0===r&&(r=new a),void 0===i&&(i=xt.platformRuntime),r.init(e,t,n,i)}}));e(jt);jt.deviceInformation,jt.DeviceInformationAdapter,jt.initDeviceInformation;var qt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=new A.EventEmitter),this.eventEmitter=e}return e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.emit=freeOnUnref(function(e,t){this.eventEmitter.emit(e,t)}),e})(),r=new(t.DeviceCapabilities=n);t.deviceCapabilities=r}));e(qt);qt.DeviceCapabilities,qt.deviceCapabilities;var Ht=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceCapabilities=qt.DeviceCapabilities,t.deviceCapabilities=qt.deviceCapabilities;var r=f.of("DeviceCapabilitiesAdapter"),a=de.get("DeviceCapabilitiesAdapter"),i=freeOnUnref(function(){function i(e,t,n,r){void 0===e&&(e=re.connector.devicePropertiesAPI),void 0===t&&(t=oe.timer),void 0===n&&(n=i.SHUTDOWN_TIMEOUT),void 0===r&&(r=i.POLLING_INTERVAL),this.supportsVariableAspectRatio=!1,this.dynamicRangeFormats=void 0,this.devicePropertiesApi=e,this.timer=t,this.shutdownTimeout=n,this.pollingInterval=r,this.timeoutHandle=null,this.propertyList=null,this.supportedPictureModes=[],this.deviceSpecificCaps=Vt.getDeviceSpecificCapsInstance()}return i.prototype.init=freeOnUnref(function(e,t,n){r(n,"handler").exists(),r(e,"config").exists(),this.deviceCapabilitiesInst=t,this.propertyList=[Lt.createDpcPropertyGetter(0,"WiFiNetworkConnection",!1),Lt.createDpcPropertyGetter(1,"panelWidth",!1),Lt.createDpcPropertyGetter(1,"panelHeight",!1),Lt.createDpcPropertyGetter(0,"hasExternalOutput",!1),Lt.createDpcPropertyGetter(0,"supportsHDCP",!1),Lt.createDpcPropertyGetter(1,"hdcpMajorVersion",!1,!0),Lt.createDpcPropertyGetter(1,"hdcpMinorVersion",!1,!0),Lt.createDpcPropertyGetter(1,"networkConnectionStrength",!1,!0)],this.initializeDppProps(n)}),i.prototype.initializeDppProps=freeOnUnref(function(r){var t=this,e=this.deviceSpecificCaps.populateResizeModes(this.devicePropertiesApi).then(freeOnUnref(function(e){t.supportedPlayerResizingMode=e})),n=this.deviceSpecificCaps.populateSupportedPictureModes(this.devicePropertiesApi).then(freeOnUnref(function(e){t.supportedPictureModes=e})),i=this.deviceSpecificCaps.getVariableAspectRatioCapability(this.devicePropertiesApi).then(freeOnUnref(function(e){t.supportsVariableAspectRatio=e})),o=this.deviceSpecificCaps.getDynamicRangeDppValue(this.devicePropertiesApi).then(freeOnUnref(function(e){e&&!1===t.deviceSpecificCaps.isMmlEnabled&&t.propertyList.push(Lt.createDpcPropertyGetter(1,"hdrFlags",!1))}));lt.Promise.all([e,n,i,o]).then(freeOnUnref(function(){return t.getDeviceCapabilitiesValues()})).then(freeOnUnref(function(e){t.buildDeviceInfo(e),null==t.timeoutHandle&&(t.timeoutHandle=t.timer.setInterval(freeOnUnref(function(){return t.pollDeviceCapabilities()}),t.pollingInterval)),r()})).catch(freeOnUnref(function(e){var t="Error while initializing device capabilities adapter, native error "+e.toString()+"}";a.error(t);var n=new Error(t);r(n)}))}),i.prototype.shutdown=freeOnUnref(function(){null!=this.timeoutHandle&&(this.timer.clearInterval(this.timeoutHandle),this.timeoutHandle=null)}),i.prototype.pollDeviceCapabilities=freeOnUnref(function(){var s=this;this.getDeviceCapabilitiesValues().then(freeOnUnref(function(e){var t=s.checkForChangesInValues(e);s.buildDeviceInfo(e);for(var n=0,r=t;n<r.length;n++){var i=r[n],o=i.key,a=i.event;s.deviceCapabilitiesInst.emit(o,a)}}))}),i.prototype.getDeviceCapabilitiesValues=freeOnUnref(function(){var s=this,e=this.propertyList.map(freeOnUnref(function(e){return e(s.devicePropertiesApi)}));return lt.Promise.all(e).then(freeOnUnref(function(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n],o=i.key,a=i.value;t[o]=a}return s.dynamicRangeFormats=s.deviceSpecificCaps.getDynamicRangeCaps(t.hdrFlags),lt.Promise.resolve(t)}))}),i.prototype.buildNetwork=freeOnUnref(function(e,t){return"wifi"===e?{type:e,signal:{strength:t,units:"unknown"}}:{type:e}}),i.prototype.checkForChangesInValues=freeOnUnref(function(e){var t=new Array,n=this,r={width:e.panelWidth,height:e.panelHeight,dynamicRangeFormatSupport:this.dynamicRangeFormats,hdcpStatus:this.getHdcpStatus(e),supportedPictureModes:this.supportedPictureModes,supportedPlayerResizingMode:this.supportedPlayerResizingMode,supportsVariableAspectRatio:this.supportsVariableAspectRatio,get hfrMediaCapabilityMode(){return n.getDeviceHFRMediaCapabilityMode()}};l.isEqual(r,this.deviceCapabilitiesInst.output.video.display)||t.push({key:"output.video.display",event:r});var i={width:e.panelWidth,height:e.panelHeight};l.isEqual(i,this.deviceCapabilitiesInst.output.video.applicationViewport)||t.push({key:"output.video.applicationViewport",event:i});var o=e.WiFiNetworkConnection?"wifi":"ethernet";if(this.deviceCapabilitiesInst.network.type!==o||"wifi"===o&&this.deviceCapabilitiesInst.network.signal.strength!==e.networkConnectionStrength){var a=this.buildNetwork(o,e.networkConnectionStrength);t.push({key:"network",event:a})}return t}),i.prototype.getHdcpStatus=freeOnUnref(function(e){return e.hasExternalOutput?e.supportsHDCP?2===e.hdcpMajorVersion?2<=e.hdcpMinorVersion?"V2_2":1===e.hdcpMinorVersion?"V2_1":"V2":1===e.hdcpMajorVersion?"V1":"Unknown":"None":"NoDigitalOutput"}),i.prototype.isHDPlaybackAllowed=freeOnUnref(function(e){var t=e.supportsHDCP,n=e.hdcpMajorVersion,r=e.hdcpMinorVersion;return!1===e.hasExternalOutput||!0===t&&(2<=n||1===n&&0<=r)}),i.prototype.buildDeviceInfo=freeOnUnref(function(e){var t=e.WiFiNetworkConnection?"wifi":"ethernet",n=this;this.deviceCapabilitiesInst=l.extend(this.deviceCapabilitiesInst,{output:{video:{display:{width:e.panelWidth,height:e.panelHeight,dynamicRangeFormatSupport:this.dynamicRangeFormats,hdcpStatus:this.getHdcpStatus(e),supportedPictureModes:this.supportedPictureModes,supportedPlayerResizingMode:this.supportedPlayerResizingMode,supportsVariableAspectRatio:this.supportsVariableAspectRatio,get hfrMediaCapabilityMode(){return n.getDeviceHFRMediaCapabilityMode()}},applicationViewport:{width:e.panelWidth,height:e.panelHeight}}},network:this.buildNetwork(t,e.networkConnectionStrength),obeysLicensePoliciesForHDCP:this.isHDPlaybackAllowed(e)})}),i.prototype.getDeviceHFRMediaCapabilityMode=freeOnUnref(function(){return this.deviceSpecificCaps.isMmlEnabled?"Detected":"NotDetected"}),i.SHUTDOWN_TIMEOUT=1e3,i.POLLING_INTERVAL=5e3,i})();t.DeviceCapabilitiesAdapter=i;var o=null;t.initDeviceCapabilities=function(e,t,n,r){void 0===n&&(n=qt.deviceCapabilities),void 0===r&&(r=o),null==r&&(r=o=new i),r.init(e,n,t)},t.shutdownDeviceCapabilities=function(e){void 0===e&&(e=o),e.shutdown()}}));e(Ht);Ht.DeviceCapabilities,Ht.deviceCapabilities,Ht.DeviceCapabilitiesAdapter,Ht.initDeviceCapabilities,Ht.shutdownDeviceCapabilities;var zt=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.deviceInformation=jt.deviceInformation,t.initDeviceInformation=jt.initDeviceInformation,t.deviceCapabilities=Ht.deviceCapabilities,t.initDeviceCapabilities=Ht.initDeviceCapabilities,t.shutdownDeviceCapabilities=Ht.shutdownDeviceCapabilities}));e(zt);zt.deviceInformation,zt.initDeviceInformation,zt.deviceCapabilities,zt.initDeviceCapabilities,zt.shutdownDeviceCapabilities;var Wt=Object.prototype.hasOwnProperty,Kt=Object.prototype.toString,Gt=Object.defineProperty,Qt=Object.getOwnPropertyDescriptor,Xt=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===Kt.call(e)},Yt=function(e){if(!e||"[object Object]"!==Kt.call(e))return!1;var t,n=Wt.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Wt.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;for(t in e);return void 0===t||Wt.call(e,t)},Jt=function(e,t){Gt&&"__proto__"===t.name?Gt(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},Zt=function(e,t){if("__proto__"===t){if(!Wt.call(e,t))return;if(Qt)return Qt(e,t).value}return e[t]},$t=function e(){var t,n,r,i,o,a,s=arguments[0],l=1,f=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[1]||{},l=2),(null==s||"object"!=typeof s&&"function"!=typeof s)&&(s={});l<f;++l)if(null!=(t=arguments[l]))for(n in t)r=Zt(s,n),s!==(i=Zt(t,n))&&(u&&i&&(Yt(i)||(o=Xt(i)))?(o?(o=!1,a=r&&Xt(r)?r:[]):a=r&&Yt(r)?r:{},Jt(s,{name:n,newValue:e(u,a,i)})):void 0!==i&&Jt(s,{name:n,newValue:i}));return s},en=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.componentId=e,this.onEvent=t}return e.prototype.report=freeOnUnref(function(e,t){this.onEvent(this.componentId,e,t)}),e})();t.DiagnosticsReporterImpl=n}));e(en);en.DiagnosticsReporterImpl;var tn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("Diagnostics"),n=freeOnUnref(function(){function a(){}return a.addSink=freeOnUnref(function(e){a.sinks.push(e)}),a.removeSink=freeOnUnref(function(e){for(var t=0;t<a.sinks.length;t++)if(a.sinks[t]===e)return void a.sinks.splice(t,1)}),a.create=freeOnUnref(function(e){return new en.DiagnosticsReporterImpl(e,a.reportEvent)}),a.sinks=[],a.reportEvent=freeOnUnref(function(t,n,e){for(var r=0,i=a.sinks;r<i.length;r++){var o=i[r];try{o.onEvent(t,n,e)}catch(e){s.error("Diagnostics sink threw an error for event "+n+" from component "+t,e)}}}),a})();t.Diagnostics=n}));e(tn);tn.Diagnostics;var nn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Diagnostics=tn.Diagnostics}));e(nn);nn.Diagnostics;var rn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("DataLocator"),r=freeOnUnref(function(){function e(){}return e.create=freeOnUnref(function(){throw new Error("DataLocator::create not implemented")}),e.revoke=freeOnUnref(function(t){try{Native.DiskStorage_RemoveFile(re.NativeStorageType.IN_MEMORY,t)}catch(e){n.error("Failed to remove file "+t,e)}}),e})();t.DataLocator=r}));e(rn);rn.DataLocator;var on=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=f.of("KeyValuePair"),r=freeOnUnref(function(){function e(e,t){this.key=n(e,"key").exists(),this.value=n(t,"value").exists()}return e.toUriEncodedString=freeOnUnref(function(e){return x.map(e,freeOnUnref(function(e){return e.toUriEncodedString()})).join("&")}),e.toWwwFormUrlEncodedString=freeOnUnref(function(e){return x.map(e,freeOnUnref(function(e){return e.toWwwFormUrlEncodedString()})).join("&")}),e.prototype.toUriEncodedString=freeOnUnref(function(){return encodeURIComponent(this.key)+"="+encodeURIComponent(this.value)}),e.prototype.toWwwFormUrlEncodedString=freeOnUnref(function(){return this.encodeWwwFormUrlComponent(this.key)+"="+this.encodeWwwFormUrlComponent(this.value)}),e.prototype.encodeWwwFormUrlComponent=freeOnUnref(function(e){return encodeURIComponent(e).replace(/%20/g,"+")}),e})();t.KeyValuePair=r}));e(on);on.KeyValuePair;var an=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=f.of("HttpResponse"),r=freeOnUnref(function(){function e(e,t){this.response=e,this.responseType=t}return e.prototype.getStatus=freeOnUnref(function(){return this.response.httpStatus}),e.prototype.getHeader=freeOnUnref(function(e){var t=this.getHeaders();return t.hasOwnProperty(e.toLowerCase())?t[e.toLowerCase()]:null}),e.prototype.getHeaders=freeOnUnref(function(){return this.response.headers}),e.prototype.getArrayBuffer=freeOnUnref(function(){return n("arraybuffer"===this.responseType,"[HttpResponse::getArrayBuffer] response type mismatch: "+this.responseType).is.true(),this.response.getArrayBuffer()}),e.prototype.releaseResponse=freeOnUnref(function(){this.response.release()}),e.prototype.getBlob=freeOnUnref(function(){throw Error("[HttpResponse::getBlob] is not supported")}),e.prototype.getDataLocator=freeOnUnref(function(){return this.response.getDataLocator()}),e.prototype.getText=freeOnUnref(function(){return n(x.includes(["text","arraybuffer"],this.responseType),"Cannot get Text from HttpResponse with response type set to "+this.responseType).is.true(),this.response.getString()}),e.prototype.getLatencyMs=freeOnUnref(function(){return this.response.latencyMs}),e.prototype.getDownloadMs=freeOnUnref(function(){return this.response.downloadMs}),e.prototype.getTotalMs=freeOnUnref(function(){return this.response.totalMs}),e.prototype.getRedirectMs=freeOnUnref(function(){return this.response.redirectMs}),e.prototype.getPretransferMs=freeOnUnref(function(){return this.response.pretransferMs}),e.prototype.getAppConnectMs=freeOnUnref(function(){return this.response.appConnectMs}),e.prototype.getConnectMs=freeOnUnref(function(){return this.response.connectMs}),e.prototype.getNameLookupMs=freeOnUnref(function(){return this.response.nameLookupMs}),e.prototype.getResponseUrl=freeOnUnref(function(){return this.response.url}),e.prototype.getMetrics=freeOnUnref(function(){var e=this.response.loadedBytes;return{responseReceived:0<e,loadedBytes:e,totalBytes:this.response.totalBytes,latencyMs:this.getLatencyMs(),downloadMs:this.getDownloadMs(),totalMs:this.getTotalMs(),redirectMs:this.getRedirectMs(),pretransferMs:this.getPretransferMs(),sslConnectMs:this.getAppConnectMs(),tcpConnectMs:this.getConnectMs(),dnsLookupMs:this.getNameLookupMs()}}),e})();t.HttpResponse=r}));e(an);an.HttpResponse;var sn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=f.of("Request"),n=freeOnUnref(function(){function e(e,t){this.httpRequest=null,this.callbackSet=!1,this.responseType="text",this.followRedirects=!1,this.httpApi=e,this.callbackHandler=t}return e.prototype.open=freeOnUnref(function(e,t){var n=this;r(this.httpRequest).is.null(),this.httpRequest=this.httpApi.createRequest(e,t,freeOnUnref(function(e){n.onCallbackComplete(e)}))}),e.prototype.send=freeOnUnref(function(e){r(this.httpRequest).is.not.null(),this.httpRequest.send(e)}),e.prototype.abort=freeOnUnref(function(){this.httpRequest.abort()}),e.prototype.setCallback=freeOnUnref(function(){this.callbackSet=!0}),e.prototype.setEnableHttp2=freeOnUnref(function(e){throw Error("[Request::setEnableHttp2] is not supported")}),e.prototype.setTimeout=freeOnUnref(function(e){this.httpRequest.setTimeout(e)}),e.prototype.addRequestHeader=freeOnUnref(function(e,t){this.httpRequest.addRequestHeader(e,t)}),e.prototype.attachQueryString=freeOnUnref(function(e){this.httpRequest.attachQuery(e)}),e.prototype.setResponseType=freeOnUnref(function(e){this.httpRequest.setResponseType(e),this.responseType=e}),e.prototype.getState=freeOnUnref(function(){return this.httpRequest.getState()}),e.prototype.withFollowRedirects=freeOnUnref(function(e){this.followRedirects=e}),e.prototype.createHttpEvent=freeOnUnref(function(e){var t=e.httpStatus;return{responseReceived:e.responseReceived,loadedBytes:e.loadedBytes,totalBytes:e.totalBytes,latencyMs:e.latencyMs,downloadMs:e.downloadMs,totalMs:e.totalMs,statusCode:0!==t?e.httpStatus:void 0,headers:0!==t?e.headers:void 0}}),e.prototype.onCallbackComplete=freeOnUnref(function(e){if(this.callbackSet){var t=e.clientStatus,n=e.httpStatus,r=0===t||-1===t;if(e.aborted)this.callbackHandler.handleAbortCallbacks(this.createHttpEvent(e));else if(e.timedOut)this.callbackHandler.handleTimeoutCallbacks(this.createHttpEvent(e));else if(r&&this.requiresRedirect(n))this.callbackHandler.handleRedirectCallbacks(new an.HttpResponse(e,this.responseType));else if(r&&200<=n&&n<400)this.callbackHandler.handleLoadCallbacks(new an.HttpResponse(e,this.responseType));else{var i=new Error("[HttpRequest] FAILED [Http Status: "+n+"][Platform Error "+t+"]["+e.errorMessage+"]");this.callbackHandler.handleErrorCallbacks(i,new an.HttpResponse(e,this.responseType))}}}),e.prototype.requiresRedirect=freeOnUnref(function(e){return this.followRedirects&&300<=e&&e<400}),e})();t.Request=n}));e(sn);sn.Request;var ln=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=re.connector.httpAPI),this.httpApi=e}return e.prototype.createRequest=freeOnUnref(function(e){return new sn.Request(this.httpApi,e)}),e.getInstance=freeOnUnref(function(){return e.instance||(e.instance=new e),e.instance}),e})();t.HttpClient=n}));e(ln);ln.HttpClient;var fn=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var o=f.of("HttpRequest"),a=((n={}).GET="GET",n.POST="POST",n.PUT="PUT",n.DELETE="DELETE",n.HEAD="HEAD",de.get("HttpRequestAdapter")),r=freeOnUnref(function(){function t(e,t,n,r){void 0===n&&(n=oe.timer),void 0===r&&(r=ln.HttpClient.getInstance()),this.url=t,this.timer=n,this.httpClient=r,this.delayMs=0,this.queryString="",this.fieldList=[],this.headersMap={},this.followRedirects=!1,this.redirects=[],this.loadCallbacks=[],this.errorCallbacks=[],this.timeoutCallbacks=[],this.abortCallbacks=[],this.progressCallbacks=[],this.completeCallbacks=[],x.includes(["GET","POST","PUT","HEAD"],e)?this.method=e:this.method="GET",this.open(t)}return t.isSupported=freeOnUnref(function(){return!0}),t.get=freeOnUnref(function(e){return o(e,"url").exists(),new t("GET",e)}),t.post=freeOnUnref(function(e){return o(e,"url").exists(),new t("POST",e)}),t.prototype.headers=freeOnUnref(function(e){o(e,"headers").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true();for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];this.headersMap[r]=e[r]}return this}),t.prototype.responseType=freeOnUnref(function(e){return o(e,"type").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true(),this.instanceResponseType=e,this}),t.prototype.delay=freeOnUnref(function(e){return o("Uninitialized"===this.state,"Request has been sent").is.true(),o(x.isFinite(e)&&0<e,"delayMs ("+e+") finite and positive").is.true(),this.delayMs=e,this}),t.prototype.timeout=freeOnUnref(function(e,t){return o("Uninitialized"===this.state,"Request has been sent").is.true(),o(x.isFinite(e)&&0<e,"timeoutMs ("+e+") finite and positive").is.true(),"LATENCY"!==t&&(this.timeoutMs=e),this}),t.prototype.enableHttp2=freeOnUnref(function(){o("Uninitialized"===this.state,"Request has been sent").is.true()}),t.prototype.withCredentials=freeOnUnref(function(){return this}),t.prototype.withFollowRedirects=freeOnUnref(function(e){return this.followRedirects=e,this}),t.prototype.getFollowRedirects=freeOnUnref(function(){return this.followRedirects}),t.prototype.query=freeOnUnref(function(e){o(e,"parameters").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true();for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];t.push(new on.KeyValuePair(i,e[i]))}return this.queryString=on.KeyValuePair.toUriEncodedString(t),this}),t.prototype.body=freeOnUnref(function(e){if(o(e,"data").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true(),0<this.fieldList.length)throw Error("Field is already set");if("POST"!==this.method&&"PUT"!==this.method)throw Error("body data only can be set to POST or PUT method");return this.data=e,this}),t.prototype.fields=freeOnUnref(function(e){if(o(e,"fields").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true(),o(this.data,"this.data").is.empty(),"POST"!==this.method&&"PUT"!==this.method)throw Error("body data only can be set to POST or PUT method");for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];this.fieldList.push(new on.KeyValuePair(r,e[r]))}return this}),t.prototype.onComplete=freeOnUnref(function(e){return o(e,"callback").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true(),this.completeCallbacks=x.union(this.completeCallbacks,[e]),this}),t.prototype.onLoad=freeOnUnref(function(e){return o(e,"callback").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true(),this.loadCallbacks=x.union(this.loadCallbacks,[e]),this}),t.prototype.onChunk=freeOnUnref(function(e){throw o(e,"callback").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true(),Error("HttpRequest::onChunk is not implemented.")}),t.prototype.onProgress=freeOnUnref(function(e){return o(e,"callback").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true(),this.progressCallbacks=x.union(this.progressCallbacks,[e]),this}),t.prototype.onError=freeOnUnref(function(e){return o(e,"callback").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true(),this.errorCallbacks=x.union(this.errorCallbacks,[e]),this}),t.prototype.onTimeout=freeOnUnref(function(e){return o(e,"callback").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true(),this.timeoutCallbacks=x.union(this.timeoutCallbacks,[e]),this}),t.prototype.onAbort=freeOnUnref(function(e){return o(e,"callback").exists(),o("Uninitialized"===this.state,"Request has been sent").is.true(),this.abortCallbacks=x.union(this.abortCallbacks,[e]),this}),t.prototype.abort=freeOnUnref(function(){null!=this.delayTimeoutId&&(this.timer.clearTimeout(this.delayTimeoutId),this.delayTimeoutId=void 0),"Sent"===this.state&&(this.request.abort(),this.state="Aborted")}),t.prototype.send=freeOnUnref(function(){var e=this;return 0<this.delayMs?this.delayTimeoutId=this.timer.setTimeout(freeOnUnref(function(){e.delayTimeoutId=void 0,e.sendRequest()}),this.delayMs):this.sendRequest(),this}),t.prototype.handleLoadCallbacks=freeOnUnref(function(e){if("Aborted"!==this.state){var t=e.getStatus();if(200<=t&&t<400)for(var n=0,r=this.loadCallbacks;n<r.length;n++){(0,r[n])(e)}else for(var i=new Error("Request to "+this.url+" returned HTTP status code "+t),o=0,a=this.errorCallbacks;o<a.length;o++){(0,a[o])(i,e)}}}),t.prototype.handleRedirectCallbacks=freeOnUnref(function(t){var e=t.getStatus(),n=t.getHeader("location");if(null!=n&&""!==n)if(this.redirects.push(n),a.info("Redirect to "+n+" from "+this.url+" (redirects: "+this.redirects.length+")"),3<this.redirects.length){var r=new Error("Request to "+this.url+" had too many redirects");this.errorCallbacks.forEach(freeOnUnref(function(e){return e(r,t)}))}else this.open(n),this.sendRequest();else{var i=new Error("Request to "+this.url+" returned HTTP status code "+e+" without a location header");this.errorCallbacks.forEach(freeOnUnref(function(e){return e(i,t)}))}}),t.prototype.open=freeOnUnref(function(e){this.url=e,this.request=this.httpClient.createRequest(this),this.request.setCallback(),this.state="Uninitialized",0<this.redirects.length?this.request.open("GET",e):this.request.open(this.method,this.url)}),t.prototype.handleAbortCallbacks=freeOnUnref(function(e){for(var t=x.extend({requestStarted:0<e.loadedBytes},e),n=0,r=this.abortCallbacks;n<r.length;n++){(0,r[n])(t)}}),t.prototype.handleErrorCallbacks=freeOnUnref(function(e,t){for(var n=0,r=this.errorCallbacks;n<r.length;n++){(0,r[n])(e,t)}}),t.prototype.handleTimeoutCallbacks=freeOnUnref(function(e){var t=x.extend({timeoutMs:this.timeoutMs,timeoutType:"DEFAULT"},e);if(0<this.timeoutCallbacks.length)for(var n=0,r=this.timeoutCallbacks;n<r.length;n++){(0,r[n])(t)}else for(var i=new Error("Request timed out after "+e.totalMs+"ms"),o=0,a=this.errorCallbacks;o<a.length;o++){(0,a[o])(i)}}),t.prototype.handleCompleteCallbacks=freeOnUnref(function(){this.state="Completed";for(var e=0,t=this.completeCallbacks;e<t.length;e++){(0,t[e])()}}),t.prototype.handleProgressCallbacks=freeOnUnref(function(e){for(var t=x.extend({lengthComputable:0<e.totalBytes},e),n=0,r=this.progressCallbacks;n<r.length;n++){(0,r[n])(t)}}),t.prototype.sendRequest=freeOnUnref(function(){var e=0<this.redirects.length;0<this.queryString.length&&!e&&this.request.attachQueryString(this.queryString),null!=this.instanceResponseType&&this.request.setResponseType(this.instanceResponseType),null!=this.timeoutMs&&this.request.setTimeout(this.timeoutMs);for(var t=0,n=Object.keys(this.headersMap);t<n.length;t++){var r=n[t];this.request.addRequestHeader(r,this.headersMap[r])}this.request.withFollowRedirects(this.followRedirects),null==this.data||e?0<this.fieldList.length&&!e?this.request.send(on.KeyValuePair.toWwwFormUrlEncodedString(this.fieldList)):((null!=this.data||0<this.fieldList.length)&&e&&a.warn("Potential data loss, isRedirect is true but POST fields or data is set. POST body won't be included in the redirected request. Form fields: "+this.fieldList.length+", data present: "+(null!=this.data)),this.request.send()):this.request.send(this.data),this.state="Sent"}),t})();t.HttpRequest=r}));e(fn);fn.HttpRequest;var un=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DataLocator=rn.DataLocator,t.HttpRequest=fn.HttpRequest,t.HttpResponse=an.HttpResponse}));e(un);un.DataLocator,un.HttpRequest,un.HttpResponse;var cn=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("HttpRequest"),f=nn.Diagnostics.create("HttpRequest"),i=!1,r=freeOnUnref(function(){function r(e,t,n){void 0===n&&(n="HttpRequest-"+r.nextId++);var a=this;this.timer=oe.timer,this.requestHeaders={},this.requestFields={},this.parameters={},this.timeouts={},this.httpResponseType=null,this.requestWithCredentials=!1,this.followRedirects=!1,this.bodyData=null,this.loadCallbacks=[],this.errorCallbacks=[],this.timeoutCallbacks=[],this.abortCallbacks=[],this.progressCallbacks=[],this.watchdogTimeoutTriggered=!1,this.watchdogTimeoutId=null,this.httpRequestAdapter=null,this.onLoadCallbackWrapper=freeOnUnref(function(e){if(a.clearWatchdogTimeout(),!a.watchdogTimeoutTriggered){f.report("network.completed",{id:a.id,statusCode:e.getStatus(),metrics:e.getMetrics(),timestamp:Date.now()});for(var t=0,n=a.loadCallbacks;t<n.length;t++){(0,n[t])(e)}}}),this.onErrorCallbackWrapper=freeOnUnref(function(e,t){if(a.clearWatchdogTimeout(),!a.watchdogTimeoutTriggered){var n;n=null!=t?"http."+t.getStatus():"http."+e.name;var r=new ct.XpError(n,void 0,e.message);f.report("network.error",{id:a.id,error:r,timestamp:Date.now()});for(var i=0,o=a.errorCallbacks;i<o.length;i++){(0,o[i])(r,t)}}}),this.onTimeoutCallbackWrapper=freeOnUnref(function(e){if(a.clearWatchdogTimeout(),!a.watchdogTimeoutTriggered)if(f.report("network.timeout",{id:a.id,metrics:e,timestamp:Date.now()}),0<a.timeoutCallbacks.length)for(var t=0,n=a.timeoutCallbacks;t<n.length;t++){(0,n[t])(e)}else for(var r=new ct.XpError("http.request_timeout",void 0,JSON.stringify(e)),i=0,o=a.errorCallbacks;i<o.length;i++){(0,o[i])(r)}}),this.onAbortCallbackWrapper=freeOnUnref(function(e){if(a.clearWatchdogTimeout(),!a.watchdogTimeoutTriggered)if(f.report("network.aborted",{id:a.id,timestamp:Date.now()}),0<a.abortCallbacks.length)for(var t=0,n=a.abortCallbacks;t<n.length;t++){(0,n[t])(e)}else for(var r=new ct.XpError("http.request_abort",void 0,JSON.stringify(e)),i=0,o=a.errorCallbacks;i<o.length;i++){(0,o[i])(r)}}),this.method=e,this.url=t,this.id=n}return r.isSupported=freeOnUnref(function(){return un.HttpRequest.isSupported()}),r.get=freeOnUnref(function(e,t){return new r("GET",e)}),r.post=freeOnUnref(function(e,t){return new r("POST",e)}),r.prototype.header=freeOnUnref(function(e,t){return this.requestHeaders[e]=t,this}),r.prototype.headers=freeOnUnref(function(e){return this.requestHeaders=n({},this.requestHeaders,e),this}),r.prototype.contentType=freeOnUnref(function(e){return this.header("Content-Type",e),this}),r.prototype.accept=freeOnUnref(function(e){return this.header("Accept",e),this}),r.prototype.bearerToken=freeOnUnref(function(e){return this.header("Authorization","Bearer "+e),this}),r.prototype.getHeaders=freeOnUnref(function(){return this.requestHeaders}),r.prototype.responseType=freeOnUnref(function(e){return this.httpResponseType=e,this}),r.prototype.getResponseType=freeOnUnref(function(){return this.httpResponseType}),r.prototype.timeout=freeOnUnref(function(e,t){return void 0===t&&(t="DEFAULT"),0!==(this.timeouts[t]=e)&&isFinite(e)&&!isNaN(e)||i||(i=!0,l.error("Received unexpected timeoutMs ("+e+").",(new Error).stack)),this}),r.prototype.setTimeouts=freeOnUnref(function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=e[r];null!=i&&(this.timeouts[r]=i)}return this}),r.prototype.getTimeout=freeOnUnref(function(e){return this.timeouts[e]}),r.prototype.withCredentials=freeOnUnref(function(){return this.requestWithCredentials=!0,this}),r.prototype.getWithCredentials=freeOnUnref(function(){return this.requestWithCredentials}),r.prototype.withFollowRedirects=freeOnUnref(function(e){return this.followRedirects=e,this}),r.prototype.query=freeOnUnref(function(e){return this.parameters=n({},this.parameters,e),this}),r.prototype.getQuery=freeOnUnref(function(){return this.parameters}),r.prototype.body=freeOnUnref(function(e){return this.bodyData=e,this}),r.prototype.json=freeOnUnref(function(e){return this.bodyData=JSON.stringify(e),this.header("Content-Type","application/json"),this}),r.prototype.getBody=freeOnUnref(function(){return this.bodyData}),r.prototype.field=freeOnUnref(function(e,t){return this.requestFields[e]=t,this.header("Content-Type","application/x-www-form-urlencoded"),this}),r.prototype.fields=freeOnUnref(function(e){return this.requestFields=n({},this.requestFields,e),this.header("Content-Type","application/x-www-form-urlencoded"),this}),r.prototype.getFields=freeOnUnref(function(){return this.requestFields}),r.prototype.onLoad=freeOnUnref(function(e){return this.loadCallbacks.push(e),this}),r.prototype.onProgress=freeOnUnref(function(e){return this.progressCallbacks.push(e),this}),r.prototype.onError=freeOnUnref(function(e){return this.errorCallbacks.push(e),this}),r.prototype.onTimeout=freeOnUnref(function(e){return this.timeoutCallbacks.push(e),this}),r.prototype.onAbort=freeOnUnref(function(e){return this.abortCallbacks.push(e),this}),r.prototype.abort=freeOnUnref(function(){null!==this.httpRequestAdapter&&this.httpRequestAdapter.abort()}),r.prototype.send=freeOnUnref(function(){this.httpRequestAdapter=new un.HttpRequest(this.method,this.url),x.isEmpty(this.parameters)||this.httpRequestAdapter.query(this.parameters),x.isEmpty(this.requestFields)||this.httpRequestAdapter.fields(this.requestFields),x.isEmpty(this.requestHeaders)||this.httpRequestAdapter.headers(this.requestHeaders),null!==this.httpResponseType&&this.httpRequestAdapter.responseType(this.httpResponseType),this.requestWithCredentials&&this.httpRequestAdapter.withCredentials(),this.httpRequestAdapter.withFollowRedirects(this.followRedirects),null!==this.bodyData&&this.httpRequestAdapter.body(this.bodyData);for(var e=0,t=Object.keys(this.timeouts);e<t.length;e++){var n=t[e];this.httpRequestAdapter.timeout(this.timeouts[n],n)}this.httpRequestAdapter.onLoad(this.onLoadCallbackWrapper),this.httpRequestAdapter.onError(this.onErrorCallbackWrapper),this.httpRequestAdapter.onTimeout(this.onTimeoutCallbackWrapper),this.httpRequestAdapter.onAbort(this.onAbortCallbackWrapper);for(var r=0,i=this.progressCallbacks;r<i.length;r++){var o=i[r];this.httpRequestAdapter.onProgress(o)}var a=this.timeouts.DEFAULT,s=2;return null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.httpRequest&&(s=L.configurationStore.configuration.httpRequest.watchdogTimeoutFactor),null!=a&&0<a&&this.setupWatchdogTimeout(this.httpRequestAdapter,s*a),this.httpRequestAdapter.send(),f.report("network.started",{id:this.id,timestamp:Date.now()}),this}),r.prototype.getRequest=freeOnUnref(function(){return{method:this.method,url:this.url,headers:this.requestHeaders,fields:this.requestFields,parameters:this.parameters,timeouts:this.timeouts,data:this.bodyData,withCredentials:this.requestWithCredentials,responseType:this.httpResponseType}}),r.prototype.setupWatchdogTimeout=freeOnUnref(function(i,o){var a=this,s=Date.now();this.watchdogTimeoutId=this.timer.setTimeout(freeOnUnref(function(){a.watchdogTimeoutTriggered=!0,i.abort();var e="Native HttpRequest failed to timeout. Watchdog timeout setup as "+o+"ms, triggered in "+(Date.now()-s)+"ms";l.error(e);var t=new ct.XpError("http.watchdog_timeout",void 0,e);f.report("network.error",{id:a.id,error:t,timestamp:Date.now()});for(var n=0,r=a.errorCallbacks;n<r.length;n++){(0,r[n])(t)}}),o)}),r.prototype.clearWatchdogTimeout=freeOnUnref(function(){null!==this.watchdogTimeoutId&&this.timer.clearTimeout(this.watchdogTimeoutId)}),r.nextId=0,r})();t.HttpRequest=r}));e(cn);cn.HttpRequest;var dn=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(){function r(e,t,n,r){void 0===r&&(r=cn.HttpRequest),this.parameters={},this.requestFields={},this.requestHeaders={},this.timeouts={},this.httpResponseType=null,this.requestWithCredentials=!1,this.bodyData=null,this.method=e,this.url=t,this.id=n,this.httpRequestType=r}return r.prototype.build=freeOnUnref(function(){var e=new this.httpRequestType(this.method,this.url,this.id);return x.isEmpty(this.parameters)||e.query(this.parameters),x.isEmpty(this.requestFields)||e.fields(this.requestFields),x.isEmpty(this.requestHeaders)||e.headers(this.requestHeaders),x.isEmpty(this.timeouts)||e.setTimeouts(this.timeouts),null!==this.httpResponseType&&e.responseType(this.httpResponseType),this.requestWithCredentials&&e.withCredentials(),null!==this.bodyData&&e.body(this.bodyData),e}),r.get=freeOnUnref(function(e,t,n){return void 0===n&&(n=cn.HttpRequest),new r("GET",e,t,n)}),r.post=freeOnUnref(function(e,t,n){return void 0===n&&(n=cn.HttpRequest),new r("POST",e,t,n)}),r.prototype.header=freeOnUnref(function(e,t){return this.requestHeaders[e]=t,this}),r.prototype.headers=freeOnUnref(function(e){return this.requestHeaders=n({},this.requestHeaders,e),this}),r.prototype.contentType=freeOnUnref(function(e){return this.header("Content-Type",e),this}),r.prototype.accept=freeOnUnref(function(e){return this.header("Accept",e),this}),r.prototype.bearerToken=freeOnUnref(function(e){return this.header("Authorization","Bearer "+e),this}),r.prototype.getHeaders=freeOnUnref(function(){return this.requestHeaders}),r.prototype.responseType=freeOnUnref(function(e){return this.httpResponseType=e,this}),r.prototype.getResponseType=freeOnUnref(function(){return this.httpResponseType}),r.prototype.timeout=freeOnUnref(function(e,t){return"LATENCY"===t?this.timeouts.LATENCY=e:this.timeouts.DEFAULT=e,this}),r.prototype.setTimeouts=freeOnUnref(function(e){return this.timeouts=n({},this.timeouts,e),this}),r.prototype.getTimeout=freeOnUnref(function(e){return this.timeouts[e]}),r.prototype.withCredentials=freeOnUnref(function(){return this.requestWithCredentials=!0,this}),r.prototype.getWithCredentials=freeOnUnref(function(){return this.requestWithCredentials}),r.prototype.query=freeOnUnref(function(e){return this.parameters=e,this}),r.prototype.getQuery=freeOnUnref(function(){return this.parameters}),r.prototype.body=freeOnUnref(function(e){return this.bodyData=e,this}),r.prototype.json=freeOnUnref(function(e){return this.bodyData=JSON.stringify(e),this.header("Content-Type","application/json"),this}),r.prototype.getBody=freeOnUnref(function(){return this.bodyData}),r.prototype.field=freeOnUnref(function(e,t){return this.requestFields[e]=t,this}),r.prototype.fields=freeOnUnref(function(e){return this.requestFields=n({},this.requestFields,e),this}),r.prototype.getFields=freeOnUnref(function(){return this.requestFields}),r.prototype.getRequest=freeOnUnref(function(){return{method:this.method,url:this.url,headers:this.requestHeaders,fields:this.requestFields,parameters:this.parameters,timeouts:this.timeouts,data:this.bodyData,responseType:this.httpResponseType,withCredentials:this.requestWithCredentials}}),r})();t.HttpRequestBuilder=r}));e(dn);dn.HttpRequestBuilder;var pn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HttpRequest=cn.HttpRequest,t.HttpRequestBuilder=dn.HttpRequestBuilder}));e(pn);pn.HttpRequest,pn.HttpRequestBuilder;var hn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.clamp=function(e,t,n){return Math.max(t,Math.min(e,n))}}));e(hn);hn.clamp;var mn=t(freeOnUnref(function(e,t){function a(e){for(var t=0,n=0,r=e;n<r.length;n++){t+=r[n]}return t/e.length}function i(e,t,n){return e+(t-e)*Math.min(Math.max(n,0),1)}Object.defineProperty(t,"__esModule",{value:!0}),t.average=a,t.round=function(e,t){void 0===t&&(t=0);var n=Math.pow(10,t);return Math.round(e*n)/n},t.stdDev=function(e){for(var t=a(e),n=0,r=0,i=e;r<i.length;r++){var o=i[r];n+=(o-t)*(o-t)}return Math.sqrt(n/e.length)},t.lerp=i,t.exponentialInterp=function(e,t,n,r){return i(t,n,(Math.exp(e*Math.min(Math.max(r,0),1))-1)/(Math.exp(e)-1))},t.sinInterp=function(e,t,n){return e+(t-e)*Math.sin(Math.PI/2*n)},t.isApprxEqual=function(e,t,n){return Math.abs(t-e)<=n},t.stringToNumber=function(e){if(-1!==e.indexOf(".")&&-1!==e.indexOf("/"))return NaN;if(-1!==e.indexOf("."))return parseFloat(e);if(-1!==e.indexOf("/")){var t=e.split("/");return 2!==t.length?NaN:1*parseInt(t[0],10)/parseInt(t[1],10)}return parseInt(e)}}));e(mn);mn.average,mn.round,mn.stdDev,mn.lerp,mn.exponentialInterp,mn.sinInterp,mn.isApprxEqual,mn.stringToNumber;var yn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var t=x.unzip(e);this.xCoords=t[0],this.yCoords=t[1]}return e.prototype.evaluate=freeOnUnref(function(e){if(e>=this.xCoords[this.xCoords.length-1])return this.yCoords[this.xCoords.length-1];for(var t=this.xCoords.length-2;0<=t;--t)if(e>=this.xCoords[t])return mn.lerp(this.yCoords[t],this.yCoords[t+1],(e-this.xCoords[t])/(this.xCoords[t+1]-this.xCoords[t]));return this.yCoords[0]}),e})();t.PiecewiseLinearFunction=n}));e(yn);yn.PiecewiseLinearFunction;var gn=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype.evaluate=freeOnUnref(function(e){return t.prototype.evaluate.call(this,this.getXCoordWithinFunction(e))}),e.prototype.getXCoordWithinFunction=freeOnUnref(function(e){var t=this.xCoords[this.xCoords.length-1]-this.xCoords[0],n=e-this.xCoords[0];if(0<=n&&n<t)return e;var r=n%t;return r<0&&(r+=t),r+this.xCoords[0]}),e})(yn.PiecewiseLinearFunction);t.CyclicPiecewiseLinearFunction=r}));e(gn);gn.CyclicPiecewiseLinearFunction;var vn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var t=x.unzip(e);this.xCoords=t[0],this.yCoords=t[1]}return e.prototype.evaluate=freeOnUnref(function(e){for(var t=this.xCoords.length-1;0<=t;t--)if(e>=this.xCoords[t])return this.yCoords[t];return this.yCoords[0]}),e})();t.StepFunction=n}));e(vn);vn.StepFunction;var On=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype.evaluate=freeOnUnref(function(e){return t.prototype.evaluate.call(this,this.getXCoordWithinFunction(e))}),e.prototype.getXCoordWithinFunction=freeOnUnref(function(e){var t=this.xCoords[this.xCoords.length-1]-this.xCoords[0],n=e-this.xCoords[0];if(0<=n&&n<t)return e;var r=n%t;return r<0&&(r+=t),r+this.xCoords[0]}),e})(vn.StepFunction);t.CyclicStepFunction=r}));e(On);On.CyclicStepFunction;var Sn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=Math.random),this.initialValue=0,this.exponentialFactor=1,this.randomizationFactor=0,this.maxValue=-1,this.random=e}return e.prototype.withInitialValue=freeOnUnref(function(e){return this.initialValue=e,this}),e.prototype.withExponentialFactor=freeOnUnref(function(e){return this.exponentialFactor=e,this}),e.prototype.withRandomizationFactor=freeOnUnref(function(e){return this.randomizationFactor=e,this}),e.prototype.withMaxValue=freeOnUnref(function(e){return this.maxValue=e,this}),e.prototype.getValue=freeOnUnref(function(e){var t=this.initialValue*Math.pow(this.exponentialFactor,e-1)+Math.floor(this.random()*this.randomizationFactor*e);return-1!==this.maxValue&&t>this.maxValue&&(t=this.maxValue),t}),e})();t.CappedGeometricSequence=n}));e(Sn);Sn.CappedGeometricSequence;var Un=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.maxSamples=Math.max(0,e),this.samples=[],this.reset()}return e.prototype.addSample=freeOnUnref(function(e){this.samples.length>=this.maxSamples&&this.samples.shift(),this.samples.push(e)}),e.prototype.updateMaxSamples=freeOnUnref(function(e){for(this.maxSamples=Math.max(0,e);this.samples.length>this.maxSamples;)this.samples.shift()}),e.prototype.reset=freeOnUnref(function(){this.samples=[]}),e.prototype.getAverage=freeOnUnref(function(e){var t=this.getSamplesInWindow(e);return 0===t.length?null:mn.average(t)}),e.prototype.getStdDev=freeOnUnref(function(e){var t=this.getSamplesInWindow(e);return 0===t.length?null:mn.stdDev(t)}),e.prototype.getSum=freeOnUnref(function(e){var t=this.getSamplesInWindow(e);return 0===t.length?null:t.reduce(freeOnUnref(function(e,t){return e+t}),0)}),e.prototype.getMinimum=freeOnUnref(function(e){var t=this.getSamplesInWindow(e);return 0===t.length?null:x.min(t)}),e.prototype.getSamplesInWindow=freeOnUnref(function(e){return x.last(this.samples,Math.min(this.maxSamples,e))}),e})();t.SampleAggregator=n}));e(Un);Un.SampleAggregator;var bn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.xSampleAggregator=new Un.SampleAggregator(e),this.ySampleAggregator=new Un.SampleAggregator(e)}return e.prototype.addPoint=freeOnUnref(function(e,t){this.xSampleAggregator.addSample(e),this.ySampleAggregator.addSample(t)}),e.prototype.reset=freeOnUnref(function(){this.xSampleAggregator.reset(),this.ySampleAggregator.reset()}),e.prototype.linearRegression=freeOnUnref(function(e){var t=this.xSampleAggregator.getSamplesInWindow(e),n=this.ySampleAggregator.getSamplesInWindow(e),r=t.length;if(r<2)return{slope:0,yIntercept:0,determinationCoefficient:0};for(var i=this.xSampleAggregator.getAverage(r),o=this.ySampleAggregator.getAverage(r),a=this.xSampleAggregator.getStdDev(r),s=this.ySampleAggregator.getStdDev(r),l=0,f=0,u=0;u<r;++u){var c=t[u]-i;l+=c*(n[u]-o),f+=c*c}if(0===f)return{slope:0,yIntercept:0,determinationCoefficient:0};var d,p=l/f;return{slope:p,yIntercept:o-p*i,determinationCoefficient:(d=Math.abs(s)<1e-6?0:p/(s/a))*d}}),e})();t.LinearRegressionCalculator=n}));e(bn);bn.LinearRegressionCalculator;var Pn=t(freeOnUnref(function(e,t){function r(e,t){for(var n=0,r=e[0],i=1;i<e.length;++i)t(e[i],r)<0&&(r=e[i],n=i);return n}function n(e,t,n){for(var r,i,o=0,a=e.length-1;o<=a;){if(0===(i=t(e[r=a+o>>1])))return r;i<0?a=r-1:o=r+1}return n?Math.max(a,0):-1}Object.defineProperty(t,"__esModule",{value:!0}),t.binarySearchIndexOf=function(e,t){return n(e,t,!1)},t.binarySearchIndexOfClosestBelow=function(e,t){return n(e,t,!0)},t.binarySearchIndexOfEarliestDuplicateClosestBelow=function(e,t,n){if(0===e.length)return-1;for(var r=0,i=e.length-1;r<=i;){var o=i+r>>1,a=t(e[o]);if(0<a)r=o+1;else if(a<0)i=o-1;else{if(0===o)return 0;if(0!==t(e[o-1]))return o;i=o-1}}return n?Math.max(i,0):-1},t.indexOfMinimum=r,t.indexOfMaximum=function(e,n){return r(e,freeOnUnref(function(e,t){return-1*n(e,t)}))}}));e(Pn);Pn.binarySearchIndexOf,Pn.binarySearchIndexOfClosestBelow,Pn.binarySearchIndexOfEarliestDuplicateClosestBelow,Pn.indexOfMinimum,Pn.indexOfMaximum;var Mn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("NumberLine"),n=freeOnUnref(function(){function a(e,t){void 0===e&&(e=Number.MIN_VALUE),void 0===t&&(t=e),this.intervals=[],this.epsilon=e,this.maxCollapsedGapSize=t}return a.prototype.clone=freeOnUnref(function(){var e=this.intervals.map(freeOnUnref(function(e){return{start:e.start,end:e.end}})),t=new a(this.epsilon,this.maxCollapsedGapSize);return t.intervals=e,t}),a.prototype.add=freeOnUnref(function(t){var n=this;if(t.start>=t.end)o.warn("Ignoring attempt to add invalid interval ["+t.start+", "+t.end+"]. Stack: ",new Error("Invalid interval").stack);else{var e=Pn.binarySearchIndexOfClosestBelow(this.intervals,freeOnUnref(function(e){return n.compare(t.start,e.start,n.maxCollapsedGapSize)}));for(e<this.intervals.length&&0<this.compare(t.start,this.intervals[e].start,this.maxCollapsedGapSize)&&e++,this.intervals.splice(e,0,{start:t.start,end:t.end}),0<e&&0<=this.compare(this.intervals[e-1].end,this.intervals[e].start,this.maxCollapsedGapSize)&&e--;e+1<this.intervals.length&&this.compare(this.intervals[e+1].start,this.intervals[e].end,this.maxCollapsedGapSize)<=0;)this.intervals[e].end=Math.max(this.intervals[e].end,this.intervals[e+1].end),this.intervals.splice(e+1,1)}}),a.prototype.extendTo=freeOnUnref(function(e){var t=this.intervals[this.intervals.length-1];t.end<e&&(t.end=e)}),a.prototype.remove=freeOnUnref(function(t){var e,n=this;if(t.start>=t.end)o.warn("Ignoring attempt to remove invalid interval ["+t.start+", "+t.end+"]. Stack: ",new Error("Invalid interval").stack);else for(var r=Pn.binarySearchIndexOfClosestBelow(this.intervals,freeOnUnref(function(e){return n.compare(t.start,e.start,n.epsilon)}));r<this.intervals.length&&this.compare(this.intervals[r].start,t.end,this.epsilon)<=0;){var i=this.intervalDifference(this.intervals[r],t);(e=this.intervals).splice.apply(e,[r,1].concat(i)),r+=i.length}}),a.prototype.find=freeOnUnref(function(t,n){var r=this;void 0===n&&(n=this.epsilon);var e=Pn.binarySearchIndexOf(this.intervals,freeOnUnref(function(e){return r.compare(t,e.start,n)<0?-1:0<r.compare(t,e.end,n)?1:0}));return-1===e?null:this.intervals[e]}),a.prototype.union=freeOnUnref(function(e){for(var t=new a(this.epsilon,this.maxCollapsedGapSize),n=0,r=0,i=-1;n<e.intervals.length||r<this.intervals.length;){var o=void 0;o=r>=this.intervals.length||n<e.intervals.length&&e.intervals[n].start<this.intervals[r].start?e.intervals[n++]:this.intervals[r++],-1===i||this.compare(t.intervals[i].end,o.start,this.maxCollapsedGapSize)<0?(t.intervals.push({start:o.start,end:o.end}),i++):t.intervals[i].end=Math.max(t.intervals[i].end,o.end)}return t}),a.prototype.intersection=freeOnUnref(function(e){for(var t=new a(this.epsilon,this.maxCollapsedGapSize),n=0,r=0;n<this.intervals.length&&r<e.intervals.length;){var i=this.intervalIntersection(this.intervals[n],e.intervals[r]);null!==i&&t.intervals.push(i),0<this.compare(this.intervals[n].end,e.intervals[r].end,this.epsilon)?r++:n++}return t}),a.prototype.shift=freeOnUnref(function(e){for(var t=new a(this.epsilon,this.maxCollapsedGapSize),n=0,r=this.intervals;n<r.length;n++){var i=r[n];t.add({start:i.start+e,end:i.end+e})}return t}),a.prototype.bounds=freeOnUnref(function(){return 0===this.intervals.length?null:{start:this.intervals[0].start,end:this.intervals[this.intervals.length-1].end}}),a.prototype.getIntervals=freeOnUnref(function(){return this.intervals}),a.prototype.intervalIntersection=freeOnUnref(function(e,t){return this.compare(e.end,t.start,this.epsilon)<=0?null:0<=this.compare(e.start,t.end,this.epsilon)?null:{start:Math.max(e.start,t.start),end:Math.min(e.end,t.end)}}),a.prototype.intervalDifference=freeOnUnref(function(e,t){return 0<this.compare(e.start,t.end,this.epsilon)||this.compare(e.end,t.start,this.epsilon)<0?[e]:0<=this.compare(e.start,t.start,this.epsilon)&&this.compare(e.end,t.end,this.epsilon)<=0?[]:this.compare(e.start,t.start,this.epsilon)<0&&0<this.compare(e.end,t.end,this.epsilon)?t.end-t.start>this.maxCollapsedGapSize?[{start:e.start,end:t.start},{start:t.end,end:e.end}]:[e]:this.compare(e.start,t.start,this.epsilon)<0?[{start:e.start,end:t.start}]:[{start:t.end,end:e.end}]}),a.prototype.compare=freeOnUnref(function(e,t,n){var r=e-t;return r<-n?-1:n<r?1:0}),a})();t.NumberLine=n}));e(Mn);Mn.NumberLine;var Cn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function s(e){this.itemHeap=[],this.comparator=e}return s.prototype.getItems=freeOnUnref(function(){return this.itemHeap.slice()}),s.prototype.push=freeOnUnref(function(e){this.itemHeap.push(e),this.float(this.itemHeap.length-1)}),s.prototype.remove=freeOnUnref(function(e){var t=this.itemHeap.indexOf(e);return-1!==t&&(t===this.itemHeap.length-1?this.itemHeap.pop():(this.itemHeap[t]=this.itemHeap.pop(),this.comparator(this.itemHeap[t],e)?this.float(t):this.sink(t)),!0)}),s.prototype.pop=freeOnUnref(function(){if(0===this.itemHeap.length)return null;if(1===this.itemHeap.length)return this.itemHeap.pop();var e=this.itemHeap[0];return this.itemHeap[0]=this.itemHeap.pop(),this.sink(0),e}),s.prototype.size=freeOnUnref(function(){return this.itemHeap.length}),s.prototype.float=freeOnUnref(function(e){if(0!==e){var t=s.parent(e),n=this.itemHeap[t];this.comparator(this.itemHeap[e],n)&&(this.itemHeap[t]=this.itemHeap[e],this.itemHeap[e]=n,this.float(t))}}),s.prototype.sink=freeOnUnref(function(e){if(e!==this.itemHeap.length-1){var t=s.leftChild(e),n=s.rightChild(e);if(!(t>=this.itemHeap.length)){var r=this.itemHeap[t],i=this.itemHeap[n],o=t,a=r;n<this.itemHeap.length&&this.comparator(i,r)&&(a=i,o=n),this.comparator(a,this.itemHeap[e])&&(this.itemHeap[o]=this.itemHeap[e],this.itemHeap[e]=a,this.sink(o))}}}),s.leftChild=freeOnUnref(function(e){return 2*e+1}),s.rightChild=freeOnUnref(function(e){return 2*e+2}),s.parent=freeOnUnref(function(e){return e%2==1?(e-1)/2:(e-2)/2}),s})();t.PriorityQueue=n}));e(Cn);Cn.PriorityQueue;var En=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.sampleCount=0,this.mean=null,this.M2=0}return e.prototype.addSample=freeOnUnref(function(e){if(this.sampleCount++,null===this.mean)this.mean=e,this.M2=0;else{var t=this.mean;this.mean+=(e-this.mean)/this.sampleCount,this.M2+=(e-t)*(e-this.mean)}}),e.prototype.average=freeOnUnref(function(){return this.mean}),e.prototype.stdDev=freeOnUnref(function(){return null===this.mean||0===this.sampleCount?null:Math.sqrt(this.M2/this.sampleCount)}),e})();t.RunningSampleTracker=n}));e(En);En.RunningSampleTracker;var Tn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){void 0===t&&(t=x.now),this.eventTimestamps=[],this.windowLengthMs=e,this.now=t}return e.prototype.recordEvent=freeOnUnref(function(e){null==e&&(e=this.now()),this.eventTimestamps.push(e)}),e.prototype.getEventCountInWindow=freeOnUnref(function(){return this.purgeRecordsOutsideWindow(),this.eventTimestamps.length}),e.prototype.purgeRecordsOutsideWindow=freeOnUnref(function(){var t=this,n=this.now();this.eventTimestamps=x.filter(this.eventTimestamps,freeOnUnref(function(e){return n-e<=t.windowLengthMs}))}),e})();t.SlidingWindowEventTracker=n}));e(Tn);Tn.SlidingWindowEventTracker;var wn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.samples=[],this.maxSamples=e}return e.prototype.addSample=freeOnUnref(function(e){this.samples.push(e),this.samples.length>this.maxSamples&&this.samples.shift()}),e.prototype.getSamples=freeOnUnref(function(){return this.samples}),e.prototype.reset=freeOnUnref(function(){this.samples=[]}),e.prototype.average=freeOnUnref(function(){return 0===this.samples.length?null:mn.average(this.samples)}),e.prototype.stdDev=freeOnUnref(function(){return 0===this.samples.length?null:mn.stdDev(this.samples)}),e.prototype.sum=freeOnUnref(function(){if(0===this.samples.length)return null;for(var e=0,t=0,n=this.samples;t<n.length;t++){e+=n[t]}return e}),e.prototype.size=freeOnUnref(function(){return this.samples.length}),e})();t.WindowSampleTracker=n}));e(wn);wn.WindowSampleTracker;var In=t(freeOnUnref(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.clamp=hn.clamp,n.CyclicPiecewiseLinearFunction=gn.CyclicPiecewiseLinearFunction,n.CyclicStepFunction=On.CyclicStepFunction,n.CappedGeometricSequence=Sn.CappedGeometricSequence,n.LinearRegressionCalculator=bn.LinearRegressionCalculator,n.NumberLine=Mn.NumberLine,n.PiecewiseLinearFunction=yn.PiecewiseLinearFunction,n.PriorityQueue=Cn.PriorityQueue,n.RunningSampleTracker=En.RunningSampleTracker,n.SampleAggregator=Un.SampleAggregator,n.SlidingWindowEventTracker=Tn.SlidingWindowEventTracker,n.StepFunction=vn.StepFunction,n.WindowSampleTracker=wn.WindowSampleTracker,function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(mn)}));e(In);In.clamp,In.CyclicPiecewiseLinearFunction,In.CyclicStepFunction,In.CappedGeometricSequence,In.LinearRegressionCalculator,In.NumberLine,In.PiecewiseLinearFunction,In.PriorityQueue,In.RunningSampleTracker,In.SampleAggregator,In.SlidingWindowEventTracker,In.StepFunction,In.WindowSampleTracker;var kn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("ExponentialBackoffRetry"),n=freeOnUnref(function(){function e(e){void 0===e&&(e=new In.CappedGeometricSequence);var i=this;this.executeCode=freeOnUnref(function(){try{i.callable(i.currentAttempt,i.handleRetry,i.handleSuccess,i.handleFail)}catch(e){i.handleFail(e)}}),this.handleRetry=freeOnUnref(function(e,t){if(i.isAborted)o.error("Attempted to retry after aborted");else if(i.currentAttempt++,i.canStillRetry()){var n=i.delaySequence.getValue(i.currentAttempt);0!==n?i.retryTimeoutId=oe.timer.setTimeout(i.executeCode,n):i.executeCode()}else null==e&&(e=new ct.XpError("retry_limit")),i.handleFail(e,t)}),this.handleSuccess=freeOnUnref(function(e){if(i.isAborted)o.error("Attempted to succeed after aborted");else for(var t=0,n=i.successCallbacks;t<n.length;t++){(0,n[t])(e)}}),this.handleFail=freeOnUnref(function(e,t){if(i.isAborted)o.error("Attempted to fail after aborted");else for(var n=0,r=i.errorCallbacks;n<r.length;n++){(0,r[n])(e,t)}}),this.maxAttempts=-1,this.maxElapsedTimeMs=-1,this.delaySequence=e,this.started=!1,this.isAborted=!1,this.currentAttempt=0,this.successCallbacks=[],this.errorCallbacks=[]}return e.prototype.withMaxAttempts=freeOnUnref(function(e){if(e<1)throw new Error("Expected maxAttempts ("+e+") >= 1");return this.maxAttempts=e,this}),e.prototype.withMaxElapsedTimeMs=freeOnUnref(function(e){if(e<=0)throw new Error("Expected maxElapsedTimeMs ("+e+") > 0");return this.maxElapsedTimeMs=e,this}),e.prototype.withInitialIntervalMs=freeOnUnref(function(e){if(e<0)throw new Error("Expected initialIntervalMs ("+e+") >= 0");return this.delaySequence.withInitialValue(e),this}),e.prototype.withExponentialFactor=freeOnUnref(function(e){if(e<=0)throw new Error("Expected exponentialFactor ("+e+") > 0");return this.delaySequence.withExponentialFactor(e),this}),e.prototype.withRandomizationFactor=freeOnUnref(function(e){if(e<0)throw new Error("Expected randomizationFactor ("+e+") >= 0");return this.delaySequence.withRandomizationFactor(e),this}),e.prototype.withMaxDelayMs=freeOnUnref(function(e){if(e<=0)throw new Error("Expected maxDelayMs ("+e+") > 0");return this.delaySequence.withMaxValue(e),this}),e.prototype.onSuccess=freeOnUnref(function(e){return this.successCallbacks.push(e),this}),e.prototype.onError=freeOnUnref(function(e){return this.errorCallbacks.push(e),this}),e.prototype.onAttempt=freeOnUnref(function(e){return this.callable=e,this}),e.prototype.execute=freeOnUnref(function(){if(this.started)throw new Error("Already started");if(null==this.callable)throw new Error("onAttempt not called");return this.started=!0,this.startTime=Date.now(),this.executeCode(),this}),e.prototype.abort=freeOnUnref(function(){this.isAborted=!0,null!=this.retryTimeoutId&&oe.timer.clearTimeout(this.retryTimeoutId)}),e.prototype.canStillRetry=freeOnUnref(function(){return!(-1!==this.maxAttempts&&this.currentAttempt>=this.maxAttempts)&&!(-1!==this.maxElapsedTimeMs&&Date.now()-this.startTime>=this.maxElapsedTimeMs)}),e})();t.ExponentialBackoffRetry=n}));e(kn);kn.ExponentialBackoffRetry;var _n=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ExponentialBackoffRetry=kn.ExponentialBackoffRetry}));e(_n);_n.ExponentialBackoffRetry;var Rn=t(freeOnUnref(function(a){freeOnUnref(function(){var e,t,n,r,i,o;"undefined"!=typeof performance&&null!==performance&&performance.now?a.exports=freeOnUnref(function(){return performance.now()}):"undefined"!=typeof process&&null!==process&&process.hrtime?(a.exports=freeOnUnref(function(){return(e()-i)/1e6}),t=process.hrtime,r=(e=freeOnUnref(function(){var e;return 1e9*(e=t())[0]+e[1]}))(),o=1e9*process.uptime(),i=r-o):Date.now?(a.exports=freeOnUnref(function(){return Date.now()-n}),n=Date.now()):(a.exports=freeOnUnref(function(){return(new Date).getTime()-n}),n=(new Date).getTime())}).call(ce)})),An=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MetricRegistry=void 0;t.MetricRegistry={OverallRequestAvailability:{groupId:"jajxplsc",schemaId:"g33a/2/02330470"},OverallRequestTime:{groupId:"jajxplsc",schemaId:"g33a/2/02330470"},OverallBytesSent:{groupId:"jajxplsc",schemaId:"g33a/2/02330470"},OverallBytesReceived:{groupId:"jajxplsc",schemaId:"g33a/2/02330470"},RequestAvailability:{groupId:"zkcghet6",schemaId:"gy6k/2/02330470"},RequestTimeToLastByte:{groupId:"zkcghet6",schemaId:"gy6k/2/02330470"},LastMileTimeToLastByte:{groupId:"zkcghet6",schemaId:"gy6k/2/02330470"},RequestTimeToFirstByte:{groupId:"zkcghet6",schemaId:"gy6k/2/02330470"},RequestSize:{groupId:"zkcghet6",schemaId:"gy6k/2/02330470"},ResponseSize:{groupId:"zkcghet6",schemaId:"gy6k/2/02330470"},CdnUpstreamDNS:{groupId:"zkcghet6",schemaId:"gy6k/2/02330470"},CdnUpstreamConnect:{groupId:"zkcghet6",schemaId:"gy6k/2/02330470"},CdnUpstreamFbl:{groupId:"zkcghet6",schemaId:"gy6k/2/02330470"}}}));e(An);An.MetricRegistry;var Dn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MetricRegistry=void 0,Object.defineProperty(t,"MetricRegistry",{enumerable:!0,get:freeOnUnref(function(){return An.MetricRegistry})})}));e(Dn);Dn.MetricRegistry;var xn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MinervaValueDataType=t.PredefinedKey=void 0,freeOnUnref(function(e){e._softwareVersion="_softwareVersion",e._softwareVersionFingerprint="_softwareVersionFingerprint",e._osFileTag="_osFileTag",e._buildType="_buildType",e._platform="_platform",e._model="_model",e._hardware="_hardware",e._deviceType="_deviceType",e._deviceId="_deviceId",e._customerId="_customerId",e._marketPlaceId="_marketPlaceId",e._countryOfResidence="_countryOfResidence",e._deviceLanguage="_deviceLanguage",e._otaGroupName="_otaGroupName",e._timeZone="_timeZone"})(t.PredefinedKey||(t.PredefinedKey={})),freeOnUnref(function(e){e.BOOLEAN="BOOLEAN",e.STRING="STRING",e.INTEGER="INTEGER",e.DOUBLE="DOUBLE",e.TIMESTAMP="TIMESTAMP",e.PREDEFINED="PREDEFINED"})(t.MinervaValueDataType||(t.MinervaValueDataType={}))}));e(xn);xn.MinervaValueDataType,xn.PredefinedKey;var Fn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updateLogger=t.Logger=void 0;var n={debug:freeOnUnref(function(){}),warn:freeOnUnref(function(){}),info:freeOnUnref(function(){}),error:freeOnUnref(function(){}),trace:freeOnUnref(function(){}),fatal:freeOnUnref(function(){})};t.Logger=n,t.updateLogger=function(e){t.Logger=e}}));e(Fn);Fn.updateLogger,Fn.Logger;var Bn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getUuid=void 0;var n=freeOnUnref(function(){var e=freeOnUnref(function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)});return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()});t.getUuid=n}));e(Bn);Bn.getUuid;var Ln=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.useDeviceRecordedTimestamp=t.getMetricValueByteSize=t.getMetricEventSize=t.isPredefinedKey=t.convertHexStringToDecimal=t.isBitSet=void 0,t.isBitSet=function(e,t){return(e>>t)%2!=0},t.convertHexStringToDecimal=function(e){return Number("0x"+e)};for(var n={},r=0,i=Object.keys(xn.PredefinedKey);r<i.length;r++){var o=i[r],a=o;n[o]=xn.PredefinedKey[a]}t.isPredefinedKey=function(e){return void 0!==n[e]};function s(e){switch(e.dataType){case xn.MinervaValueDataType.TIMESTAMP:return e.val.length;case xn.MinervaValueDataType.DOUBLE:case xn.MinervaValueDataType.INTEGER:return 8;case xn.MinervaValueDataType.BOOLEAN:return 1;case xn.MinervaValueDataType.STRING:case xn.MinervaValueDataType.PREDEFINED:return e.val.length;default:return 0}}t.getMetricEventSize=function(e){for(var t=0,n=0,r=Object.keys(e.keyValuePairs);n<r.length;n++){var i=r[n],o=e.keyValuePairs[i];t+=i.length+s(o)}return 128+t},t.getMetricValueByteSize=s,t.useDeviceRecordedTimestamp=function(e,t){return null!=t&&t===e}}));e(Ln);Ln.useDeviceRecordedTimestamp,Ln.getMetricValueByteSize,Ln.getMetricEventSize,Ln.isPredefinedKey,Ln.convertHexStringToDecimal,Ln.isBitSet;var Nn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertMetricEventsToIonText=void 0,t.convertMetricEventsToIonText=function(e,t){for(var n=[],r=(new Date).toISOString(),i=0,o=e;i<o.length;i++){for(var a=o[i],s=Bn.getUuid(),l=a.minervaMetricIdentifier.groupId,f=a.minervaMetricIdentifier.schemaId,u="",c=0,d=Object.keys(a.keyValuePairs);c<d.length;c++){var p=d[c],h=a.keyValuePairs[p],m=h.val;"DOUBLE"===h.dataType?u+="'"+p+"':"+(m=h.val.toExponential())+",":"INTEGER"===h.dataType||"BOOLEAN"===h.dataType?u+="'"+p+"':"+m+",":"TIMESTAMP"===h.dataType?(Ln.useDeviceRecordedTimestamp(p,t)&&(r=new Date(String(h.val)).toISOString()),u+=p+":"+m+","):u+="'"+p+"':'"+m+"',"}u=u.slice(0,-1),n.push("{metricEventId:'"+s+"',metricGroupId:'"+l+"',metricSchemaId:'"+f+"',clientTimestamp:"+r+",keyValuePairs:{"+u+"}}")}return"["+n.toString()+"]"}}));e(Nn);Nn.convertMetricEventsToIonText;var Vn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BATCH_COUNT_METRIC=void 0,t.BATCH_COUNT_METRIC="BatchCount"}));e(Vn);Vn.BATCH_COUNT_METRIC;var jn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MinervaKPIConstants=t.schemaAttributesBitIndices=void 0,freeOnUnref(function(e){e[e.canCollectWhenUsageCollectionDisabled=5]="canCollectWhenUsageCollectionDisabled",e[e.canCollectWhenChildUsingDevice=4]="canCollectWhenChildUsingDevice",e[e.mustIncludeRealCustomerId=1]="mustIncludeRealCustomerId",e[e.mustIncludeRealDeviceId=0]="mustIncludeRealDeviceId"})(t.schemaAttributesBitIndices||(t.schemaAttributesBitIndices={})),freeOnUnref(function(e){e.KPI_METRIC_GROUP_ID="aminerva",e.KPI_METRIC_SCHEMA_ID="ckpi/2/00f30233",e.CUSTOMER_METRIC_GROUP_ID="customerMetricGroupId",e.UNKNOWN_DEVICE_TYPE_ID="UNKNOWN"})(t.MinervaKPIConstants||(t.MinervaKPIConstants={}))}));e(jn);jn.MinervaKPIConstants,jn.schemaAttributesBitIndices;var qn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validMinervaSchemaIdRegex=t.validMinervaGroupIdRegex=t.validMinervaMetricKeyRegex=void 0,t.validMinervaMetricKeyRegex=new RegExp("^[a-zA-Z]$|^[a-zA-Z][a-zA-Z0-9_.]*[a-zA-Z0-9]$"),t.validMinervaGroupIdRegex=new RegExp("[0-9a-z]{8}"),t.validMinervaSchemaIdRegex=new RegExp("[0-9a-z]{4}/\\d+/[0-9a-f]{8}")}));e(qn);qn.validMinervaSchemaIdRegex,qn.validMinervaGroupIdRegex,qn.validMinervaMetricKeyRegex;var Hn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.initMinervaKPICollector=t.getMinervaKPIMetricEventsBatch=t.reportCoreMinervaClientKPI=t.reportMinervaPerGroupIdKPI=void 0;var s={getDeviceInfo:freeOnUnref(function(){})},l=i(jn.MinervaKPIConstants.KPI_METRIC_GROUP_ID),f={};function i(e){var t;return{minervaMetricIdentifier:{schemaId:jn.MinervaKPIConstants.KPI_METRIC_SCHEMA_ID,groupId:jn.MinervaKPIConstants.KPI_METRIC_GROUP_ID},keyValuePairs:(t={},t[jn.MinervaKPIConstants.CUSTOMER_METRIC_GROUP_ID]={dataType:xn.MinervaValueDataType.STRING,val:e},t[xn.PredefinedKey._deviceType]={dataType:xn.MinervaValueDataType.STRING,val:jn.MinervaKPIConstants.UNKNOWN_DEVICE_TYPE_ID},t)}}function u(){l=i(jn.MinervaKPIConstants.KPI_METRIC_GROUP_ID),f={}}t.reportMinervaPerGroupIdKPI=function(e,t,n){void 0===f[n]&&(f[n]=i(n));var r=f[n].keyValuePairs[e];void 0!==r?r.val+=t:f[n].keyValuePairs[e]={dataType:xn.MinervaValueDataType.INTEGER,val:t}},t.reportCoreMinervaClientKPI=function(e,t){var n=l.keyValuePairs[e];void 0!==n?n.val+=t:l.keyValuePairs[e]={dataType:xn.MinervaValueDataType.INTEGER,val:t}},t.getMinervaKPIMetricEventsBatch=function(){var e=Object.keys(l.keyValuePairs).length<=2?[]:[l],t=Object.keys(f).map(freeOnUnref(function(e){return f[e]}));u();var n=e.concat(t),r=s.getDeviceInfo();if(void 0!==r)for(var i=r.deviceTypeId,o=0,a=n;o<a.length;o++)a[o].keyValuePairs[xn.PredefinedKey._deviceType].val=i;return n},t.initMinervaKPICollector=function(e){s=e,u()}}));e(Hn);Hn.initMinervaKPICollector,Hn.getMinervaKPIMetricEventsBatch,Hn.reportCoreMinervaClientKPI,Hn.reportMinervaPerGroupIdKPI;var zn=t(freeOnUnref(function(e,t){function m(e,t){if(t.dataType===xn.MinervaValueDataType.PREDEFINED){if(!Ln.isPredefinedKey(e))return!1}else if(!qn.validMinervaMetricKeyRegex.test(e))return!1;return!0}function y(e){switch(e.dataType){case xn.MinervaValueDataType.DOUBLE:case xn.MinervaValueDataType.INTEGER:return"number"==typeof e.val;case xn.MinervaValueDataType.BOOLEAN:return"boolean"==typeof e.val;case xn.MinervaValueDataType.STRING:return"string"==typeof e.val;case xn.MinervaValueDataType.TIMESTAMP:if("string"==typeof e.val){var t=e.val,n=new Date(Date.parse(t));return n.toISOString()===t||n.toUTCString()===t}return!1;case xn.MinervaValueDataType.PREDEFINED:return"string"==typeof e.val}}function c(e){return!(!qn.validMinervaGroupIdRegex.test(e.groupId)||!qn.validMinervaSchemaIdRegex.test(e.schemaId))||(Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.API.KeyValuePairFailedValidation",1,e.groupId),!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.validateMetricIdentifier=t.validate=void 0,t.validate=function(e,t,n,r){return c(e.minervaMetricIdentifier)&&function(e,t,n){for(var r=0,i=0,o=0,a=Object.keys(e);o<a.length;o++){var s=a[o],l=e[s],f=s.length,u=Ln.getMetricValueByteSize(l);if(!m(s,l)||!y(l))return Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.API.KeyValuePairFailedValidation",1,n),!1;if(p=f,h=t.maxKeySizeBytes,!(p<=h))return Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.API.KeySizeExceededMax",1,n),!1;if(c=u,d=t.maxValueSizeBytes,!(c<=d))return Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.API.ValueSizeExceededMax",1,n),!1;r+=1,i+=f+u}var c,d,p,h;return r>t.maxKeyValuePairCount?(Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.API.KeyValuePairCountExceededMax",1,n),!1):0===r?(Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.API.MetricEventHasNoKeyValuePair",1,n),!1):!(i>t.maxMetricEventSizeBytes)||(Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.API.MetricEventSizeExceededMax",1,n),!1)}(e.keyValuePairs,t,e.minervaMetricIdentifier.groupId)?(i=e.minervaMetricIdentifier,o=n,a=r,s=i.schemaId.substring(i.schemaId.length-2),l=Ln.convertHexStringToDecimal(s),f=Ln.isBitSet(l,jn.schemaAttributesBitIndices.canCollectWhenUsageCollectionDisabled),u=Ln.isBitSet(l,jn.schemaAttributesBitIndices.canCollectWhenChildUsingDevice),o.isChildProfile()&&!u?(Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.Service.ChildProfile",1,i.groupId),!1):!(!a.isUsageCollectionEnabled()&&!f&&(Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.Service.UserControl",1,i.groupId),1))):(Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.API.Validation",1,e.minervaMetricIdentifier.groupId),!1);var i,o,a,s,l,f,u},t.validateMetricIdentifier=c}));e(zn);zn.validateMetricIdentifier,zn.validate;var Wn=t(freeOnUnref(function(e,t){var h=ce&&ce.__assign||freeOnUnref(function(){return(h=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0}),t.UserKPIReporter=void 0;var m=["MinervaTSClient","UserKPIReporter"],n=freeOnUnref(function(){function p(e,t){if(this.perGroupIdMap={},this.canReportUserKPIs=!1,this.clearCounters(),!zn.validateMetricIdentifier(e))return Fn.Logger.warn("User KPI Metric identifier:"+JSON.stringify(e)+" failed validation. No user KPIs will be reported.",{tags:m}),void(this.canReportUserKPIs=!1);this.canReportUserKPIs=!0,this.kpiMetricsSchemaIdentifier=e,this.deviceInfoProvider=t}return p.prototype.getKPIsMetricsBatch=freeOnUnref(function(){var e,t,n;if(!this.canReportUserKPIs)return[];var r=[],i=null===(n=this.deviceInfoProvider.getDeviceInfo())||void 0===n?void 0:n.deviceTypeId;if(void 0===i)return Fn.Logger.warn("Device info not provided. Not collecting the User KPI metrics.",{tags:m}),[];for(var o=0,a=Object.keys(this.perGroupIdMap);o<a.length;o++){var s=a[o],l=this.perGroupIdMap[s],f=h(((e={})[xn.PredefinedKey._deviceType]={val:i,dataType:xn.MinervaValueDataType.PREDEFINED},e.metricGroupId={val:s,dataType:xn.MinervaValueDataType.STRING},e),l),u={minervaMetricIdentifier:this.kpiMetricsSchemaIdentifier,keyValuePairs:f};r.push(u)}if(!p.groupAgnosticUserKpis.UploadFailedMetricCount)return this.clearCounters(),r;var c=h(((t={})[xn.PredefinedKey._deviceType]={val:i,dataType:xn.MinervaValueDataType.PREDEFINED},t),p.groupAgnosticUserKpis),d={minervaMetricIdentifier:this.kpiMetricsSchemaIdentifier,keyValuePairs:c};return r.push(d),this.clearCounters(),r}),p.prototype.clearCounters=freeOnUnref(function(){p.groupAgnosticUserKpis={},this.perGroupIdMap={}}),p.prototype.recordPerGroupKPI=freeOnUnref(function(e,t){var n;void 0===this.perGroupIdMap[e]?this.perGroupIdMap[e]=((n={})[t]={val:1,dataType:xn.MinervaValueDataType.INTEGER},n):void 0===this.perGroupIdMap[e][t]?this.perGroupIdMap[e][t]={val:1,dataType:xn.MinervaValueDataType.INTEGER}:this.perGroupIdMap[e][t].val+=1}),p.recordGroupAgnosticKPI=freeOnUnref(function(e,t){void 0===p.groupAgnosticUserKpis[e]?p.groupAgnosticUserKpis[e]={dataType:xn.MinervaValueDataType.INTEGER,val:t}:p.groupAgnosticUserKpis[e].val+=t}),p.prototype.getMetricBatchUploadMetric=freeOnUnref(function(e){var t,n;if(this.canReportUserKPIs){var r=null===(n=this.deviceInfoProvider.getDeviceInfo())||void 0===n?void 0:n.deviceTypeId;if(void 0!==r){var i=((t={})[Vn.BATCH_COUNT_METRIC]={val:e,dataType:xn.MinervaValueDataType.INTEGER},t[xn.PredefinedKey._deviceType]={val:r,dataType:xn.MinervaValueDataType.PREDEFINED},t);return{minervaMetricIdentifier:this.kpiMetricsSchemaIdentifier,keyValuePairs:i}}Fn.Logger.warn("Device info not provided. Not collecting the user batch upload metric.",{tags:m})}}),p})();t.UserKPIReporter=n}));e(Wn);Wn.UserKPIReporter;var Kn=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.setFetch=t.fetch=void 0;var r=freeOnUnref(function(e,t){return n?n(e,t):globalThis.fetch(e,t)});t.fetch=r;var i=freeOnUnref(function(e){n=e});t.setFetch=i}));e(Kn);Kn.setFetch,Kn.fetch;var Gn=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getPromiseImpl=t.setPromiseImpl=void 0;var r=freeOnUnref(function(e){n=e});t.setPromiseImpl=r;var i=freeOnUnref(function(){return null!=n?n:Promise});t.getPromiseImpl=i}));e(Gn);Gn.getPromiseImpl,Gn.setPromiseImpl;var Qn=t(freeOnUnref(function(e,t){var i,o=ce&&ce.__spreadArray||freeOnUnref(function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e});Object.defineProperty(t,"__esModule",{value:!0}),t.clearIntervalImpl=t.clearTimeoutImpl=t.setIntervalImpl=t.setTimeoutImpl=t.setTimerFunctions=void 0;var n=freeOnUnref(function(e){i=e});t.setTimerFunctions=n;var r=freeOnUnref(function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return i?i.setTimeout.apply(i,o([e,t],n)):globalThis.setTimeout.apply(globalThis,o([e,t],n))});t.setTimeoutImpl=r;var a=freeOnUnref(function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return i?i.setInterval.apply(i,o([e,t],n)):globalThis.setInterval.apply(globalThis,o([e,t],n))});t.setIntervalImpl=a;var s=freeOnUnref(function(e){return i?i.clearTimeout(e):globalThis.clearTimeout(e)});t.clearTimeoutImpl=s;var l=freeOnUnref(function(e){return i?i.clearInterval(e):globalThis.clearInterval(e)});t.clearIntervalImpl=l}));e(Qn);Qn.clearIntervalImpl,Qn.clearTimeoutImpl,Qn.setIntervalImpl,Qn.setTimeoutImpl,Qn.setTimerFunctions;var Xn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.makeHttpRequest=void 0;var n=freeOnUnref(function(e,i){if(!Kn.fetch)return Gn.getPromiseImpl().reject({errorMessage:"Could not find a global fetch nor one was injected",type:"FetchUndefinedError"});var o=!1;return new(Gn.getPromiseImpl())(freeOnUnref(function(t,n){var r=Qn.setTimeoutImpl(freeOnUnref(function(){o=!0,n({type:"TimeoutError"})}),6e4);Kn.fetch(e,i).then(freeOnUnref(function(e){Qn.clearTimeoutImpl(r),o||(e.ok?t(e):n({response:e,type:"HttpError"}))})).catch(freeOnUnref(function(e){o||n({errorMessage:a(e),type:"ClientError"})}))}))});t.makeHttpRequest=n;var a=freeOnUnref(function(e){return e instanceof Error||"string"==typeof e?""+e:JSON.stringify(e)})}));e(Xn);Xn.makeHttpRequest;var Yn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isRetriableError=void 0;t.isRetriableError=function(e,t){var n="NETWORK_ERROR"===e.status&&"Network request timed out"!==e.message||"SERVER_ERROR"===e.status;return void 0!==t?t<3&&n:n}}));e(Yn);Yn.isRetriableError;var Jn=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.upload=void 0;var d=["MinervaTSClient","uploader"],p={SERVER_ERROR:"Diagnostic.Service.UploadServerError",CLIENT_ERROR:"DroppedMetricEvent.Service.UploadClientError",NETWORK_ERROR:"Diagnostic.Service.UploadConnectionError",CONFIGURATION_ERROR:"Diagnostic.Service.UploadUnexpectedError"};t.upload=function(e,t,n,r,i,o,a){if(__HOMEBREW_NOMETRICS){var url="http://"+__HOMEBREW_DEBUG_LOGS_ENDPOINT+"/metrics/"+encodeURIComponent(Nn.convertMetricEventsToIonText(e,a));try{if(typeof Native!=="undefined"&&typeof Native.HTTP_CreateHandler==="function"){var h=Native.HTTP_CreateHandler("GET",url);Native.HTTP_SendAsync(h,"")}}catch(e){}var PromiseImpl=Gn.getPromiseImpl();return new PromiseImpl(freeOnUnref(function(resolve){resolve({status:"SUCCESS",message:""})}))}var s=e.length,l=t.urlSchema.replace("{deviceType}",r).replace("{region}",t.minervaServiceRegion),f=Nn.convertMetricEventsToIonText(e,a),u={accept:"text/*","x-amz-device-type":n.deviceTypeId,"content-type":"application/x-amzn-ion"};o&&(u["x-amz-access-token"]=o);var c={method:"POST",body:f,headers:u};return y("MetricBatch.Service.Uploaded",s,i),function n(r,i,o,a,s){return Xn.makeHttpRequest(r,i).then(freeOnUnref(function(e){return e.text()})).then(freeOnUnref(function(e){return{status:"SUCCESS",message:e}})).catch(freeOnUnref(function(e){var t=function(e){switch(e.type){case"TimeoutError":return{status:"NETWORK_ERROR",message:"Network request timed out"};case"ClientError":return{status:"NETWORK_ERROR",message:e.errorMessage};case"FetchUndefinedError":return{status:"CONFIGURATION_ERROR",message:e.errorMessage};case"HttpError":var t=e.response.status;if(400<=t&&t<=499)return{status:"CLIENT_ERROR",message:"Failed with http status "+t};if(500<=t&&t<=599)return{status:"SERVER_ERROR",message:"Failed with http status "+t};default:return{status:"NETWORK_ERROR",message:"Error unknown"}}}(e);return Yn.isRetriableError(t,o)?(y("MetricBatch.Service.UploadRetriable",a,s),m(h*Math.pow(2,o)).then(freeOnUnref(function(){return n(r,i,o+1,a,s)}))):(y("MetricBatch.Service.UploadNonRetriable",a,s),t)}))}(l,c,0,s,i).then(freeOnUnref(function(e){var t,n;return"SUCCESS"!==e.status?(y(p[e.status],s,i),t="UploadFailedMetricCount",n=s,i||Wn.UserKPIReporter.recordGroupAgnosticKPI(t,n),Fn.Logger.warn("Failed to upload "+s+" "+(i?"KPI ":"")+"metric events with status: "+e.status+" & message: "+e.message+". Payload size was "+f.length,{tags:d})):(i?Fn.Logger.debug("Succesfully uploaded "+s+" KPI metric events.",{tags:d}):Fn.Logger.info("Succesfully uploaded "+s+" metric events.",{tags:d}),y("MetricBatch.Service.UploadSuccessful",s,i)),e}))};var h=5e3;var m=freeOnUnref(function(t){return new(Gn.getPromiseImpl())(freeOnUnref(function(e){return Qn.setTimeoutImpl(e,t)}))});function y(e,t,n){n||Hn.reportCoreMinervaClientKPI(e,t)}}));e(Jn);Jn.upload;var Zn=t(freeOnUnref(function(e,t){var r=ce&&ce.__createBinding||(Object.create?freeOnUnref(function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:freeOnUnref(function(){return t[n]})})}):freeOnUnref(function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]})),i=ce&&ce.__setModuleDefault||(Object.create?freeOnUnref(function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}):freeOnUnref(function(e,t){e.default=t})),n=ce&&ce.__importStar||freeOnUnref(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.getEncryptedDeviceTypeId=void 0;var o=n(Ot),a=freeOnUnref(function(e){var t=o.hex_sha256(e);return 63<(t=t.replace(/^0+/,"")).length&&(t=t.substring(1)),t});t.getEncryptedDeviceTypeId=a}));e(Zn);Zn.getEncryptedDeviceTypeId;var $n=t(freeOnUnref(function(e,t){var f=ce&&ce.__spreadArray||freeOnUnref(function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e});Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsBatcher=t.MINERVA_KPI_UPLOAD_INTERVAL_IN_MS=void 0;var u=["MinervaTSClient","MetricsBatcher"];t.MINERVA_KPI_UPLOAD_INTERVAL_IN_MS=9e5;var r="metricBatch",o="failedMetricBatches",n=freeOnUnref(function(){function e(e,t,n,r,i,o,a){this.deviceInfoProvider=e,this.minervaClientConfigProvider=t,this.oAuthProvider=n,this.userKpiReporter=r,this.localStorage=i,this.deviceRecordedTimestampKey=o,this.persistFailedBatches=a,this.batch=[],this.timer=null,this.batchSizeInBytes=0,this.timeAtLastUpload=0,this.minervaKPIMetricsUploadStartTimer(),this.maxBatchSizeBytes=this.minervaClientConfigProvider.getConfig().uploadConfiguration.maxBatchSizeBytes,this.maxBatchEntries=this.minervaClientConfigProvider.getConfig().uploadConfiguration.maxBatchEntries}return e.prototype.addMetricEvent=freeOnUnref(function(e,t){void 0===t&&(t=!0);var n=Ln.getMetricEventSize(e);(this.willExceedMaxBatchEntries()||this.willExceedMaxBatchbatchSize(n))&&this.forceUpload(),this.batch.push(e),this.batchSizeInBytes+=n,t&&this.persistMetricBatch(),this.startTimer()}),e.prototype.forceUpload=freeOnUnref(function(){var t=this,e=this.deviceInfoProvider.getDeviceInfo(),n=this.batch.length,r=this.oAuthProvider.getAccessToken(),i=this.minervaClientConfigProvider.getConfig().uploadConfiguration;if(this.timeAtLastUpload=Date.now(),this.resetTimer(),void 0===e)return 0<n&&Fn.Logger.error("Device Info not provided. "+n+" metric events dropped.",{tags:u}),this.batch=[],this.batchSizeInBytes=0,Gn.getPromiseImpl().resolve({status:"CONFIGURATION_ERROR",message:"Device info not available."});void 0===this.deviceTypeHash&&(this.deviceTypeHash=Zn.getEncryptedDeviceTypeId(e.deviceTypeId));var o=this.userKpiReporter.getKPIsMetricsBatch();if(0<o.length&&Jn.upload(o,i,e,this.deviceTypeHash,!0,r),0<n){var a=this.userKpiReporter.getMetricBatchUploadMetric(n);a&&this.batch.push(a);var s=f([],this.batch),l=Jn.upload(s,i,e,this.deviceTypeHash,!1,r,this.deviceRecordedTimestampKey);return this.batch=[],this.batchSizeInBytes=0,l.then(freeOnUnref(function(e){return 0===t.batch.length&&t.clearPersistedMetricBatch(),"SUCCESS"!==e.status&&Yn.isRetriableError(e)&&t.persistFailedBatch(s),Gn.getPromiseImpl().resolve(e)})).catch(freeOnUnref(function(e){return 0===t.batch.length&&t.clearPersistedMetricBatch(),Gn.getPromiseImpl().reject(e)}))}return Fn.Logger.debug("No metrics to upload.",{tags:u}),Gn.getPromiseImpl().resolve({status:"SUCCESS",message:"Nothing to upload"})}),e.prototype.uploadMinervaKpiMetrics=freeOnUnref(function(){var e=Hn.getMinervaKPIMetricEventsBatch(),t=this.deviceInfoProvider.getDeviceInfo();void 0!==(null==t?void 0:t.deviceTypeId)?(void 0===this.deviceTypeHash&&(this.deviceTypeHash=Zn.getEncryptedDeviceTypeId(t.deviceTypeId)),0<e.length?Jn.upload(e,this.minervaClientConfigProvider.getConfig().uploadConfiguration,t,this.deviceTypeHash,!0,this.oAuthProvider.getAccessToken()):Fn.Logger.debug("No Minerva KPI metrics to upload.",{tags:u})):Fn.Logger.warn("Failed to upload "+e.length+" Minerva KPI metrics as device info wasn't available.",{tags:u})}),e.prototype.minervaKPIMetricsUploadStartTimer=freeOnUnref(function(){var e=this;Qn.setIntervalImpl(freeOnUnref(function(){e.uploadMinervaKpiMetrics()}),t.MINERVA_KPI_UPLOAD_INTERVAL_IN_MS)}),e.prototype.startTimer=freeOnUnref(function(){var e=this;if(null==this.timer){var t=this.minervaClientConfigProvider.getConfig().uploadConfiguration.uploadPeriodMs,n=t-(0===this.timeAtLastUpload?0:Date.now()-this.timeAtLastUpload)%t;this.timer=Qn.setTimeoutImpl(freeOnUnref(function(){e.forceUpload()}),n)}}),e.prototype.resetTimer=freeOnUnref(function(){null!=this.timer&&Qn.clearTimeoutImpl(this.timer),this.timer=null}),e.prototype.willExceedMaxBatchbatchSize=freeOnUnref(function(e){return this.batchSizeInBytes+e+177>this.maxBatchSizeBytes}),e.prototype.willExceedMaxBatchEntries=freeOnUnref(function(){return this.batch.length+1+1>this.maxBatchEntries}),e.prototype.persistMetricBatch=freeOnUnref(function(){var t=this;return new(Gn.getPromiseImpl())(freeOnUnref(function(e){t.localStorage&&e(t.localStorage.setItem(r,JSON.stringify(t.batch))),e()}))}),e.prototype.clearPersistedMetricBatch=freeOnUnref(function(){var t=this;return new(Gn.getPromiseImpl())(freeOnUnref(function(e){t.localStorage&&e(t.localStorage.removeItem(r)),e()}))}),e.prototype.uploadPersistedMetricBatch=freeOnUnref(function(){var n=this;return new(Gn.getPromiseImpl())(freeOnUnref(function(e){n.localStorage&&e(n.localStorage.getItem(r).then(freeOnUnref(function(e){if(e){var t=JSON.parse(e);if(0<t.length)return t.forEach(freeOnUnref(function(e){n.addMetricEvent(e,!1)})),n.forceUpload()}}))),e()}))}),e.prototype.persistFailedBatch=freeOnUnref(function(i){var e=this;return new(Gn.getPromiseImpl())(freeOnUnref(function(n){if(e.localStorage&&e.persistFailedBatches&&e.persistFailedBatches()&&0<i.length){var r=e.localStorage;r.getItem(o).then(freeOnUnref(function(e){var t=e?JSON.parse(e):[];t.push(i),n(r.setItem(o,JSON.stringify(t)))}))}else n()}))}),e.prototype.clearFailedBatches=freeOnUnref(function(){var t=this;return new(Gn.getPromiseImpl())(freeOnUnref(function(e){t.localStorage&&e(t.localStorage.removeItem(o)),e()}))}),e.prototype.uploadFailedBatches=freeOnUnref(function(){var n=this;return new(Gn.getPromiseImpl())(freeOnUnref(function(e){n.localStorage&&e(n.localStorage.getItem(o).then(freeOnUnref(function(e){if(e){var t=JSON.parse(e);if(0<t.length)return n.clearFailedBatches(),t.forEach(freeOnUnref(function(e){e.forEach(freeOnUnref(function(e){n.addMetricEvent(e,!1)}))})),n.forceUpload()}}))),e()}))}),e})();t.MetricsBatcher=n}));e($n);$n.MetricsBatcher,$n.MINERVA_KPI_UPLOAD_INTERVAL_IN_MS;var er=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MetricEventThrottler=void 0;var n=freeOnUnref(function(){function e(){}return e.shouldThrottleMetricEvent=freeOnUnref(function(e,t){var n=Date.now(),r=e.minervaMetricIdentifier.groupId,i=this.creditInfoMapByGroupId[r],o=t.defaultThrottleCreditHour;if(void 0===i){var a={lastUsageTime:n,credit:o-1};this.creditInfoMapByGroupId[r]=a}else{var s=i.lastUsageTime,l=i.credit,f=(n-s)/36e5*t.defaultThrottleCreditHour,u=Math.min(l+f,t.maxThrottleCredit);if(u<1)return!0;u-=1,this.creditInfoMapByGroupId[r]={lastUsageTime:n,credit:u}}return!1}),e.clear=freeOnUnref(function(){this.creditInfoMapByGroupId={}}),e.creditInfoMapByGroupId={},e})();t.MetricEventThrottler=n}));e(er);er.MetricEventThrottler;var tr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.shouldDenyListMetric=void 0;var n=freeOnUnref(function(e,t){var n=e.minervaMetricIdentifier.groupId,r=n+"|"+e.minervaMetricIdentifier.schemaId.slice(0,4),i=n+"|*",o=t.denyListedPairs;return-1!==o.indexOf(i)||-1!==o.indexOf(r)});t.shouldDenyListMetric=n}));e(tr);tr.shouldDenyListMetric;var nr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MinervaTSClient=void 0;var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c){this.minervaClientConfigProvider=e,this.childProfileVerifier=n,this.userControlVerifier=r,this.nMetricDroppedWarnings=0,a&&Gn.setPromiseImpl(a),s&&Qn.setTimerFunctions(s),this.redactor=u,this.userKpiReporter=new Wn.UserKPIReporter(i.kpiMetricsSchemaIdentifier,i.deviceInfoProvider),this.metricsBatcher=new $n.MetricsBatcher(i.deviceInfoProvider,e,t,this.userKpiReporter,l,f,c),Hn.initMinervaKPICollector(i.deviceInfoProvider),o&&Kn.setFetch(o)}return e.prototype.record=freeOnUnref(function(e,t,n){var r=this.minervaClientConfigProvider.getConfig(),i=e.minervaMetricIdentifier.groupId,o=e.minervaMetricIdentifier.schemaId;if(!zn.validate(e,r.validationConfiguration,this.childProfileVerifier,this.userControlVerifier)){var a=JSON.stringify(e,this.redactor);return Fn.Logger.warn("Metric event "+a+" dropped due to validation failure."),void(void 0!==n&&n(e,"INVALID_METRIC_EVENT"))}return tr.shouldDenyListMetric(e,r.denyListConfiguration)?(this.nMetricDroppedWarnings<10&&(this.nMetricDroppedWarnings+=1,Fn.Logger.warn("Metric event with groupid:"+i+" and schemaid:"+o+" dropped due to denylisting.")),void 0!==n&&n(e,"DENY_LISTED"),void Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.Service.Denylist",1,e.minervaMetricIdentifier.groupId)):(void 0!==t?t:r.samplingConfiguration.defaultSamplingRate)<100*Math.random()?(Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.API.Sample",1,e.minervaMetricIdentifier.groupId),this.userKpiReporter.recordPerGroupKPI(e.minervaMetricIdentifier.groupId,"Sampled"),void(void 0!==n&&n(e,"SAMPLED"))):er.MetricEventThrottler.shouldThrottleMetricEvent(e,r.throttleConfiguration)?(this.nMetricDroppedWarnings<10&&(this.nMetricDroppedWarnings+=1,Fn.Logger.warn("Metric event with groupid:"+i+" and schemaid:"+o+" dropped due to throttling.")),this.userKpiReporter.recordPerGroupKPI(e.minervaMetricIdentifier.groupId,"Throttled"),Hn.reportMinervaPerGroupIdKPI("DroppedMetricEvent.API.Throttle",1,e.minervaMetricIdentifier.groupId),void(void 0!==n&&n(e,"THROTTLED"))):void this.metricsBatcher.addMetricEvent(e)}),e.prototype.forceUpload=freeOnUnref(function(){return this.metricsBatcher.forceUpload()}),e.prototype.uploadPersistedMetricBatch=freeOnUnref(function(){return this.metricsBatcher.uploadPersistedMetricBatch()}),e.prototype.uploadFailedBatches=freeOnUnref(function(){return this.metricsBatcher.uploadFailedBatches()}),e.prototype.setLogger=freeOnUnref(function(e){Fn.updateLogger(e)}),e})();t.MinervaTSClient=n}));e(nr);nr.MinervaTSClient;var rr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultMinervaClientConfig=void 0,t.defaultMinervaClientConfig={samplingConfiguration:{defaultSamplingRate:100},throttleConfiguration:{throttleSwitch:!0,defaultThrottleCreditHour:500,maxThrottleCredit:1500},validationConfiguration:{maxKeySizeBytes:256,maxValueSizeBytes:512,maxKeyValuePairCount:256,maxMetricEventSizeBytes:4096},uploadConfiguration:{urlSchema:"https://{deviceType}.{region}.prod.service.minerva.devices.a2z.com:443/metric-batch",KPIRegion:"us-east-1",minervaServiceRegion:"us-east-1",ionFormat:"application/x-amzn-ion",uploadPeriodMs:6e5,maxBatchEntries:504,maxBatchSizeBytes:65536},denyListConfiguration:{denyListedPairs:[]}}}));e(rr);rr.defaultMinervaClientConfig;var ir=t(freeOnUnref(function(e,t){var r=ce&&ce.__createBinding||(Object.create?freeOnUnref(function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:freeOnUnref(function(){return t[n]})})}):freeOnUnref(function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]})),n=ce&&ce.__exportStar||freeOnUnref(function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)});Object.defineProperty(t,"__esModule",{value:!0}),t.defaultMinervaClientConfig=t.isPredefinedKey=t.MinervaTSClient=void 0,n(xn,t),Object.defineProperty(t,"MinervaTSClient",{enumerable:!0,get:freeOnUnref(function(){return nr.MinervaTSClient})}),Object.defineProperty(t,"isPredefinedKey",{enumerable:!0,get:freeOnUnref(function(){return Ln.isPredefinedKey})}),Object.defineProperty(t,"defaultMinervaClientConfig",{enumerable:!0,get:freeOnUnref(function(){return rr.defaultMinervaClientConfig})})}));e(ir);ir.defaultMinervaClientConfig,ir.isPredefinedKey,ir.MinervaTSClient;var or=t(freeOnUnref(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=de.get("MinervaReporter"),i={getConfig:freeOnUnref(function(){return ir.defaultMinervaClientConfig})},o={getAccessToken:freeOnUnref(function(){})},a={isChildProfile:freeOnUnref(function(){return!1})},s={isUsageCollectionEnabled:freeOnUnref(function(){return!0})},l={deviceInfoProvider:{getDeviceInfo:freeOnUnref(function(){return{deviceTypeId:zt.deviceInformation.hardware.deviceTypeId}})},kpiMetricsSchemaIdentifier:{schemaId:"wxw2/2/03330460",groupId:"g8ugfl2a"}},f=["DSN"];n.fetchFn=freeOnUnref(function(e,t){if(!t)return lt.Promise.reject(new Error("Cannot proceed as request is "+t));var n=t.headers,r=t.body,i=n;return new lt.Promise(freeOnUnref(function(t,n){pn.HttpRequestBuilder.post(e.toString()).headers(i).body(r).build().onError(freeOnUnref(function(e){return n(e)})).onLoad(freeOnUnref(function(e){t({ok:200<=e.getStatus()&&e.getStatus()<=299,status:e.getStatus(),text:freeOnUnref(function(){return lt.Promise.resolve(e.getText())})})})).send()}))});var t=freeOnUnref(function(){function e(){this.minervaClient=null;try{var e={setTimeout:freeOnUnref(function(e,t){return oe.timer.setTimeout(e,t)}),setInterval:freeOnUnref(function(e,t){return oe.timer.setInterval(e,t)}),clearTimeout:freeOnUnref(function(e){return oe.timer.clearTimeout(e)}),clearInterval:freeOnUnref(function(e){return oe.timer.clearInterval(e)})},t=freeOnUnref(function(e,t){return-1!==f.indexOf(e)?"<REDACTED>":t});this.minervaClient=new ir.MinervaTSClient(i,o,a,s,l,freeOnUnref(function(e,t){return n.fetchFn(e,t)}),lt.Promise,e,void 0,void 0,t),this.minervaClient.setLogger(r)}catch(e){r.warn("MinervaTSClient initialization error",e),this.minervaClient=null}}return e.getInstance=freeOnUnref(function(){return e.instance||(e.instance=new e),e.instance}),e.prototype.recordMetric=freeOnUnref(function(e){if(null!=this.minervaClient)try{this.minervaClient.record(e)}catch(e){r.warn("Failed to record metric",e)}}),e})();n.MinervaReporter=t}));e(or);or.fetchFn,or.MinervaReporter;var ar=t(freeOnUnref(function(e,s){var l=ce&&ce.__assign||freeOnUnref(function(){return(l=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(s,"__esModule",{value:!0});var f=freeOnUnref(function(e){return"number"==typeof e&&200<=e&&e<=399});s.convertNullableValueToMinervaValueType=freeOnUnref(function(e,t){return null!=e?{val:e,dataType:t}:null});var t=freeOnUnref(function(){function t(e){this.minervaReporter=or.MinervaReporter.getInstance(),this.cachedContextDimensions=this.initCachedNetworkEdgeRequestStaticContext(e)}return t.getInstance=freeOnUnref(function(e){return t.instance||(t.instance=new t(e)),t.instance}),t.prototype.initCachedNetworkEdgeRequestStaticContext=freeOnUnref(function(e){return{DTID:zt.deviceInformation.hardware.deviceTypeId,Firmware:Qe.nestedValue(zt.deviceInformation,["software","nativeRuntime","version"]),Chipset:Qe.nestedValue(zt.deviceInformation,["hardware","chipset"]),DSN:e.deviceID,AppVersion:Qe.nestedValue(zt.deviceInformation,["software","playerBundle","version"]),NativeAppVersion:Qe.nestedValue(zt.deviceInformation,["software","nativeApplication","version"]),PlatformType:"xp-player",NativePlatformType:Qe.nestedValue(zt.deviceInformation,["software","nativeRuntime","name"]),UserAgent:Qe.nestedValue(zt.deviceInformation,["software","middleware","userAgent"]),MarketplaceName:null!=e.marketplaceID?e.marketplaceID:null}}),t.prototype.reportOverallRequestMetrics=freeOnUnref(function(e,t){var n={OverallRequestAvailability:{val:f(e.ResponseStatusCode)?1:0,dataType:ir.MinervaValueDataType.INTEGER},OverallBytesSent:{val:t.overallBytesSent,dataType:ir.MinervaValueDataType.INTEGER},OverallBytesReceived:{val:t.overallBytesReceived,dataType:ir.MinervaValueDataType.INTEGER},OverallRequestTime:{val:t.overallRequestTime,dataType:ir.MinervaValueDataType.DOUBLE}},r={DTID:this.cachedContextDimensions.DTID,Firmware:this.cachedContextDimensions.Firmware,Chipset:this.cachedContextDimensions.Chipset,DSN:this.cachedContextDimensions.DSN,AppVersion:this.cachedContextDimensions.AppVersion,NativeAppVersion:this.cachedContextDimensions.NativeAppVersion,PlatformType:this.cachedContextDimensions.PlatformType,NativePlatformType:this.cachedContextDimensions.NativePlatformType,MarketplaceName:this.cachedContextDimensions.MarketplaceName,UserAgent:this.cachedContextDimensions.UserAgent,ApiPath:e.ApiPath.toString(),RequiredAttempts:e.RequiredAttempts.toString(),ResponseStatusCode:null!=e.ResponseStatusCode?e.ResponseStatusCode.toString():null,PageType:e.PageType.toString(),Endpoint:e.Endpoint.toString(),OverallAttemptId:e.OverallAttemptId.toString(),StartTime:e.StartTime.toString()},i=this.createMetricEvent(Dn.MetricRegistry.OverallRequestAvailability,n,r);this.minervaReporter.recordMetric(i)}),t.prototype.reportRequestAttemptMetrics=freeOnUnref(function(e,t){var n=f(e.ResponseStatusCode)?1:0,r={RequestTimeToFirstByte:s.convertNullableValueToMinervaValueType(t.timeToFirstByte,ir.MinervaValueDataType.DOUBLE),RequestTimeToLastByte:s.convertNullableValueToMinervaValueType(t.timeToLastByte,ir.MinervaValueDataType.DOUBLE),LastMileTimeToLastByte:s.convertNullableValueToMinervaValueType(t.lastMileTimeToLastByte,ir.MinervaValueDataType.DOUBLE),CdnUpstreamDNS:s.convertNullableValueToMinervaValueType(t.cdnUpstreamDNS,ir.MinervaValueDataType.DOUBLE),CdnUpstreamConnect:s.convertNullableValueToMinervaValueType(t.cdnUpstreamConnect,ir.MinervaValueDataType.DOUBLE),CdnUpstreamFbl:s.convertNullableValueToMinervaValueType(t.cdnUpstreamFbl,ir.MinervaValueDataType.DOUBLE),ResponseSize:s.convertNullableValueToMinervaValueType(t.responseSize,ir.MinervaValueDataType.INTEGER)},i=l({},r,{RequestAvailability:{val:n,dataType:ir.MinervaValueDataType.INTEGER},RequestSize:{val:t.requestSize,dataType:ir.MinervaValueDataType.INTEGER}}),o={DTID:this.cachedContextDimensions.DTID,Firmware:this.cachedContextDimensions.Firmware,Chipset:this.cachedContextDimensions.Chipset,DSN:this.cachedContextDimensions.DSN,AppVersion:this.cachedContextDimensions.AppVersion,NativeAppVersion:this.cachedContextDimensions.NativeAppVersion,PlatformType:this.cachedContextDimensions.PlatformType,NativePlatformType:this.cachedContextDimensions.NativePlatformType,MarketplaceName:this.cachedContextDimensions.MarketplaceName,ApiPath:e.ApiPath.toString(),ResponseStatusCode:null!=e.ResponseStatusCode?e.ResponseStatusCode.toString():null,PageType:e.PageType.toString(),Endpoint:e.Endpoint.toString(),OverallAttemptId:e.OverallAttemptId.toString(),AttemptCount:e.AttemptCount.toString(),ClientSideRequestId:e.ClientSideRequestId.toString(),RequestStartTime:e.RequestStartTime.toString()},a=this.createMetricEvent(Dn.MetricRegistry.RequestAvailability,i,o);this.minervaReporter.recordMetric(a)}),t.prototype.createMetricEvent=freeOnUnref(function(e,t,n){for(var r={},i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];null!=(f=t[a])&&(r[a]=f)}for(var s=0,l=Object.keys(n);s<l.length;s++){var f,u=l[s];null!=(f=n[u])&&""!==f.trim()&&(r[u]={val:f,dataType:ir.MinervaValueDataType.STRING})}return{keyValuePairs:r,minervaMetricIdentifier:e}}),t})();s.NetworkEdgeRequestMeasurer=t}));e(ar);ar.convertNullableValueToMinervaValueType,ar.NetworkEdgeRequestMeasurer;var sr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=re.connector.randomAPI),this.randomAPI=e}return e.prototype.getRandom=freeOnUnref(function(){return this.randomAPI.getRandom()}),e.prototype.getRandomValues=freeOnUnref(function(e){for(var t=0;t<e.length;t++)e[t]=this.randomAPI.getRandom()}),e})();t.RandomEngineAdapter=n}));e(sr);sr.RandomEngineAdapter;var lr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RandomEngine=sr.RandomEngineAdapter;var n=new sr.RandomEngineAdapter;t.randomEngine=n}));e(lr);lr.RandomEngine,lr.randomEngine;var fr=t(freeOnUnref(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=de.get("DecorateRequestWithRequestId"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").map(freeOnUnref(function(e){return e.charCodeAt(0)})),n=/^[A-Za-z0-9+/]{22}[0-9]{2}$/;i.REQUEST_ID_QUERY_PARAM="nerid";i.generateBase64EpochTimestamp=freeOnUnref(function(){for(var e=new Array(7),t=Date.now(),n=6;0<=n;n--){var r=t%64;t=Math.floor(t/64),e[n]=a[r]}return String.fromCharCode.apply(String,e)}),i.generateRandomBase64String=freeOnUnref(function(e){for(var t="undefined"!=typeof performance&&"function"==typeof performance.now&&1e3*performance.now()||0,n=lr.randomEngine,r=new Array(e),i=0;i<e;i++){var o=Math.floor((64*n.getRandom()+t)%64);t=Math.floor(t/64),r[i]=a[o]}return String.fromCharCode.apply(String,r)});var o=freeOnUnref(function(e){for(var t=e.toString(),n="";t.length+n.length<2;)n="0"+n;return n+t});i.generateNetworkEdgeRequestId=freeOnUnref(function(e){return i.generateBase64EpochTimestamp()+i.generateRandomBase64String(15)+o(e%100)}),i.updateNetworkRequestId=freeOnUnref(function(e,t){if(!t.match(n))throw new Error("Invalid Network Edge request ID: "+t);return t.substring(0,22)+o(e%100)});var s=freeOnUnref(function(e,t){if(t)try{return i.updateNetworkRequestId(e,t)}catch(e){var n=e instanceof Error?e.message:"UNKNOWN";r.warn("Failed to update existing Network Edge request ID. Generating new request ID. Cause: "+n+".")}return i.generateNetworkEdgeRequestId(e)});i.decorateRequestWithRequestId=freeOnUnref(function(e,t){t.queryParams||(t.queryParams={});var n=t.queryParams[i.REQUEST_ID_QUERY_PARAM],r=s(e,n);t.queryParams[i.REQUEST_ID_QUERY_PARAM]=r});var t=freeOnUnref(function(){function t(e,t,n){this.overallRequestId=e,this.attempt=t,this.requestId=n}return t.buildFromString=freeOnUnref(function(e){if(null==e||!e.match(n))throw new Error("Invalid Network Edge request ID: "+e);return new t(e.substring(0,22),parseInt(e.substring(22,24)),e)}),t})();i.NetworkEdgeRequestID=t}));e(fr);fr.REQUEST_ID_QUERY_PARAM,fr.generateBase64EpochTimestamp,fr.generateRandomBase64String,fr.generateNetworkEdgeRequestId,fr.updateNetworkRequestId,fr.decorateRequestWithRequestId,fr.NetworkEdgeRequestID;var ur=t(freeOnUnref(function(e,t){function n(e){for(var t=0,n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],o=e[i];t+=i.length+(null!=o?o.toString().length:0)}return t}function o(e){if("string"==typeof e&&0!==e.trim().length){var t=Number(e);return isNaN(t)?void 0:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.isNetworkEdgeInsightsEnabled=function(){return null==L.configurationStore.configuration||null==L.configurationStore.configuration.serviceClient||!1!==L.configurationStore.configuration.serviceClient.networkEdgeInsightsReportingEnabled},t.getSizeOfMap=n,t.processServerTimingsResponseHeader=function(e){if(e&&e.length){for(var t={},n=0,r=e.split(",");n<r.length;n++){var i=r[n].split(";");1===i.length?t[i[0]]="":2===i.length&&-1!==i[1].indexOf("=")&&(t[i[0]]=i[1].split("=")[1].replace('"',"").replace('"',""))}if(t.hasOwnProperty("cdn-upstream-layer")||t.hasOwnProperty("cdn-hit-layer"))return t.hasOwnProperty("cdn-cache-miss")?{layer:t["cdn-upstream-layer"],upstreamDns:o(t["cdn-upstream-dns"]),upstreamConnect:o(t["cdn-upstream-connect"]),upstreamFbl:o(t["cdn-upstream-fbl"]),downstreamFbl:o(t["cdn-downstream-fbl"]),pop:t["cdn-pop"],cacheHit:!1}:{layer:t["cdn-hit-layer"],pop:t["cdn-pop"],cacheHit:!0}}},t.parseNumberWithUndefinedDefaultValue=o,t.calculateRequestSize=function(e){return(e.data?e.data.length:0)+e.url.length+e.method.length+n(e.headers)+n(e.fields)+n(e.parameters)},t.calculateLastMileTimeToLastByte=function(e,t){return null!=t&&null!=e&&void 0!==e.upstreamFbl?t.getTotalMs()-e.upstreamFbl:null}}));e(ur);ur.isNetworkEdgeInsightsEnabled,ur.getSizeOfMap,ur.processServerTimingsResponseHeader,ur.parseNumberWithUndefinedDefaultValue,ur.calculateRequestSize,ur.calculateLastMileTimeToLastByte;var cr=t(freeOnUnref(function(e,t){var r=ce&&ce.__assign||freeOnUnref(function(){return(r=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateOverallRequestContext=function(e,t){var n={RequiredAttempts:t.networkEdgeRequestID.attempt+1,ResponseStatusCode:t.httpResponse?t.httpResponse.getStatus():null,OverallAttemptId:t.networkEdgeRequestID.overallRequestId};return e=e?r({},e,n,{overallBytesSent:e.overallBytesSent+t.requestSizeBytes,overallBytesReceived:e.overallBytesReceived+(t.responseSizeBytes||0)}):r({},n,{ApiPath:t.url.pathname,PageType:"ATVPlayer",Endpoint:t.url.hostname,StartTime:t.startEpochTime,RequestDurationStart:t.durationStart,overallBytesSent:t.requestSizeBytes,overallBytesReceived:t.responseSizeBytes||0})},t.createRequestAttemptContext=function(e){return{ApiPath:e.url.pathname,AttemptCount:e.networkEdgeRequestID.attempt,ResponseStatusCode:e.httpResponse?e.httpResponse.getStatus():null,PageType:"ATVPlayer",Endpoint:e.url.hostname,OverallAttemptId:e.networkEdgeRequestID.overallRequestId,ClientSideRequestId:e.networkEdgeRequestID.requestId,RequestStartTime:e.startEpochTime}},t.createRequestAttemptMeasurements=function(e){var t=ur.processServerTimingsResponseHeader(e.httpResponse?e.httpResponse.getHeaders()["Server-Timing"]:null);return{timeToFirstByte:e.httpResponse?e.httpResponse.getLatencyMs():null,timeToLastByte:e.httpResponse?e.httpResponse.getTotalMs():null,lastMileTimeToLastByte:ur.calculateLastMileTimeToLastByte(t,e.httpResponse),requestSize:e.requestSizeBytes,responseSize:e.responseSizeBytes,cdnUpstreamDNS:null!=t&&null!=t.upstreamDns?t.upstreamDns:null,cdnUpstreamConnect:null!=t&&null!=t.upstreamConnect?t.upstreamConnect:null,cdnUpstreamFbl:null!=t&&null!=t.upstreamFbl?t.upstreamFbl:null}},t.createRequestAttemptMetadata=function(e,t,n,r){var i=e.getRequest(),o=new mt.URL(i.url);return{durationStart:t,startEpochTime:n,requestSizeBytes:ur.calculateRequestSize(i),responseSizeBytes:r?r.getMetrics().totalBytes:null,url:o,networkEdgeRequestID:fr.NetworkEdgeRequestID.buildFromString(e.getQuery()[fr.REQUEST_ID_QUERY_PARAM]),httpResponse:r}}}));e(cr);cr.createOrUpdateOverallRequestContext,cr.createRequestAttemptContext,cr.createRequestAttemptMeasurements,cr.createRequestAttemptMetadata;var dr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a){void 0===r&&(r=[]),void 0===i&&(i=!1),void 0===a&&(a=!1);var s=this;this.eventEmitter=new A.EventEmitter,this.on=freeOnUnref(function(e,t){s.eventEmitter.on(e,t)}),this.off=freeOnUnref(function(e,t){s.eventEmitter.off(e,t)}),this.once=freeOnUnref(function(e,t){s.eventEmitter.once(e,t)}),this.createRetry=e,this.createRequest=t,this.processResponse=n,this.unretriableHttpErrors=r,this.processFailedResponse=i,this.networkEdgeRequestMeasurer=ar.NetworkEdgeRequestMeasurer.getInstance(o),this.isNetworkEdgeInsightsEnabled=a}return e.prototype.send=freeOnUnref(function(e){var t=this.sendWithRetries(e),n={on:this.on,off:this.off,once:this.once,response:freeOnUnref(function(){return t})};return lt.Promise.resolve(n)}),e.prototype.sendWithRetries=freeOnUnref(function(i){var o=this;return new lt.Promise(freeOnUnref(function(t,n){var r=o.createRetry().onSuccess(freeOnUnref(function(e){o.reportOverallRequestMetrics(),t(e)})).onError(freeOnUnref(function(e){o.reportOverallRequestMetrics(),n(e)})).onAttempt(freeOnUnref(function(e,t,n,r){o.emit("attempt",e),o.sendRequest(o.createRequest(e),e,i,t,n,r)})).execute();i.promise.then(freeOnUnref(function(e){r.abort(),n(e)}))}))}),e.prototype.sendRequest=freeOnUnref(function(n,t,e,r,i,o){var a=this,s=Rn(),l=Date.now();n.onLoad(freeOnUnref(function(e){a.updateOverallContextAndReportAttemptMetrics(n,s,l,e),a.emit("latency",e.getLatencyMs()),a.emit("downloadTime",e.getDownloadMs()),a.emit("success",{url:e.getResponseUrl(),latencyMs:e.getLatencyMs(),downloadTimeMs:e.getDownloadMs(),status:e.getStatus(),totalBytes:null!=e.getMetrics()?e.getMetrics().totalBytes:0,headers:e.getHeaders(),attempt:t});try{a.processResponse(e,i,r,o)}catch(e){o(e)}})).onError(freeOnUnref(function(e,t){if(a.updateOverallContextAndReportAttemptMetrics(n,s,l,t),null!=t&&(a.emit("latency",t.getLatencyMs()),a.emit("fail",{error:e,url:t.getResponseUrl(),latencyMs:t.getLatencyMs(),downloadTimeMs:t.getDownloadMs(),status:t.getStatus(),totalBytes:null!=t.getMetrics()?t.getMetrics().totalBytes:0,headers:t.getHeaders()})),null==t)r(e);else if(a.processFailedResponse)try{a.processResponse(t,i,r,o)}catch(e){o(e)}else x.contains(a.unretriableHttpErrors,t.getStatus())?o(e):r(e)})).send(),e.promise.then(freeOnUnref(function(e){n.abort(),o(e)}))}),e.prototype.emit=freeOnUnref(function(e,t){this.eventEmitter.emit(e,t)}),e.prototype.updateOverallContextAndReportAttemptMetrics=freeOnUnref(function(e,t,n,r){if(this.isNetworkEdgeInsightsEnabled){var i=cr.createRequestAttemptMetadata(e,t,n,r);this.overallRequestContext=cr.createOrUpdateOverallRequestContext(this.overallRequestContext,i),this.networkEdgeRequestMeasurer.reportRequestAttemptMetrics(cr.createRequestAttemptContext(i),cr.createRequestAttemptMeasurements(i))}}),e.prototype.reportOverallRequestMetrics=freeOnUnref(function(){if(this.isNetworkEdgeInsightsEnabled&&null!=this.overallRequestContext){var e=Rn()-this.overallRequestContext.RequestDurationStart;this.networkEdgeRequestMeasurer.reportOverallRequestMetrics(this.overallRequestContext,{overallBytesSent:this.overallRequestContext.overallBytesSent,overallBytesReceived:this.overallRequestContext.overallBytesReceived,overallRequestTime:e})}}),e})();t.RetriableHttpRequest=n}));e(dr);dr.RetriableHttpRequest;var pr=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var a=[400,401,403],s={method:"GET",queryParams:{},headers:(n={},n["x-atv-client-type"]="XpPlayer",n),timeoutMs:4e3},r=freeOnUnref(function(){function e(e,t,n,r,i,o){var a=this;this.maxAttempts=4,this.createRetry=freeOnUnref(function(){return(new _n.ExponentialBackoffRetry).withMaxAttempts(a.maxAttempts).withInitialIntervalMs(500).withExponentialFactor(2).withRandomizationFactor(200)}),this.url=e,this.serviceQueryParameters=t,this.responseProcessor=n,this.authContext=r,this.serviceClientPrefix=o,this.baseServiceClientParams=i,this.isNetworkEdgeInsightsEnabled=ur.isNetworkEdgeInsightsEnabled()}return e.prototype.send=freeOnUnref(function(e,t,n,r,i){var o=this;void 0===r&&(r=!0),void 0===i&&(i=!1);var a=$t(!0,{},s,{queryParams:this.serviceQueryParameters},e);return null!=a.maxAttempts&&(this.maxAttempts=a.maxAttempts),this.createRetriableRequest(a,n,r,i).send(t).then(freeOnUnref(function(e){var t=e.response;return e.response=freeOnUnref(function(){return t().catch(freeOnUnref(function(e){throw null!=o.serviceClientPrefix?ct.XpError.generatePrefixedError(e,o.serviceClientPrefix):e}))}),e}))}),e.prototype.createRetriableRequest=freeOnUnref(function(n,r,i,e){var o=this;return new dr.RetriableHttpRequest(this.createRetry,freeOnUnref(function(e){o.isNetworkEdgeInsightsEnabled&&fr.decorateRequestWithRequestId(e,n);var t=new pn.HttpRequest(n.method,o.url).headers(n.headers).headers(o.authContext.getHeaders()).withCredentials().query(n.queryParams);return"number"==typeof n.timeoutMs?t.timeout(n.timeoutMs):t.timeout(n.timeoutMs(e)),null!=n.body&&t.body(n.body),(i||0<e)&&(t.header("x-retry-count",""+e),null!=r&&t.header("x-request-priority",r)),t}),this.responseProcessor,a,e,this.baseServiceClientParams,this.isNetworkEdgeInsightsEnabled)}),e})();t.BaseServiceClient=r}));e(pr);pr.BaseServiceClient;var hr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("CDPResponseProcessorFactory");t.createCDPResponseProcessor=function(l,f){return void 0===f&&(f=!1),freeOnUnref(function(e,t,n,r){var i=e.getText();if(null!==i){var o;if(""===i){var a=e.getHeaders()["x-denied-code"];if(null==a||""===a)return void n(new ct.XpError("parse",void 0,"Empty response body",!1));u.warn("Empty response body received, falling back to x-denied-code header: "+a),o={code:a}}else try{o=JSON.parse(i)}catch(e){return void n(new ct.XpError("parse",void 0,e.message,!1,e))}if("ERROR"!==Qe.nestedValue(o,"message.statusCode"))try{f?l(e.getStatus(),o,t,n,r):l(o,t,n,r)}catch(e){n(new ct.XpError("parse",void 0,e.message,!1,e))}else{var s=Qe.nestedValue(o,"message.body.code","");r(new ct.XpError("error_status",void 0,"statusCode='ERROR', code='"+s+"'"))}}else n(new ct.XpError("null_response"))})}}));e(hr);hr.createCDPResponseProcessor;var mr=t(freeOnUnref(function(e,t){var o=ce&&ce.__assign||freeOnUnref(function(){return(o=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r){void 0===r&&(r=pr.BaseServiceClient),this.baseServiceUrl=e.replace(/\/$/,""),this.parameters={};for(var i=0,o=Object.keys(t);i<o.length;i++){var a=o[i],s=t[a];null!=s&&(this.parameters[a]=s.toString())}this.baseServiceClientParams=t,this.authContext=n,this.baseServiceClientType=r}return e.prototype.createBasicServiceClient=freeOnUnref(function(e,t){return this.createServiceClient(e,t,freeOnUnref(function(e,t){t(e)}))}),e.prototype.createServiceClient=freeOnUnref(function(e,t,n,r){var i=this.baseServiceUrl+e;return new this.baseServiceClientType(i,o({},this.parameters,t),n,this.authContext,this.baseServiceClientParams,r)}),e})();t.ServiceClientFactory=n}));e(mr);mr.ServiceClientFactory;var yr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BaseServiceClient=pr.BaseServiceClient,t.createCDPResponseProcessor=hr.createCDPResponseProcessor,t.RetriableHttpRequest=dr.RetriableHttpRequest,t.ServiceClientFactory=mr.ServiceClientFactory}));e(yr);yr.BaseServiceClient,yr.createCDPResponseProcessor,yr.RetriableHttpRequest,yr.ServiceClientFactory;var gr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("PlaybackResourceErrorHandler"),s={PRS:"prs.general","PRS.Dependency":"prs.dependency","PRS.Dependency.DRM.Widevine.UnsupportedCdmVersion":"prs.unsupported_cdm_version","PRS.InvalidRequest":"prs.invalid_request","PRS.NoRights":"prs.no_rights","PRS.NoRights.AnonymizerIP":"prs.no_rights.anonymizer_ip","PRS.NoRights.ConsentExpired":"prs.no_rights.consent_expired","PRS.NoRights.DeviceLimitReached":"prs.no_rights.device_limit_reached","PRS.NoRights.DownloadLimitExceeded":"prs.no_rights.download_limit_exceeded","PRS.NoRights.InvalidGeoIP":"prs.no_rights.invalid_geo_ip","PRS.NoRights.NoAvailableStreams":"prs.no_rights.no_available_streams","PRS.NoRights.NotAcceptedTermsAndConditions":"prs.no_rights.not_accepted_terms","PRS.NoRights.NotOwned":"prs.no_rights.not_owned","PRS.NoRights.PVLowerTierDeviceNotPermittedAccess":"prs.no_rights.pv_lower_tier_device_not_permitted_access","PRS.NoRights.PVLowerTierConcurrencyLimitUpgrade":"prs.no_rights.no_available_streams"},l={"PRS.Dependency.DRM.Widevine.HdContentNotAllowed":"prs.hd_content_not_allowed"},n=freeOnUnref(function(){function t(){}return t.createError=freeOnUnref(function(e){if(null==e.errorCode){var t="PRSWidevine2LicenseDeniedException"===e.type?"prs.widevine_license_denied":"prs.unknown_codeless_exception";return new ct.XpError(t,void 0,e.message)}var n=s[e.errorCode];if(null!=n)return new ct.XpError(n,void 0,e.message);for(var r=0,i=Object.keys(l);r<i.length;r++){var o=i[r];if(e.errorCode===o||0===e.errorCode.indexOf(o+"."))return a.warn(JSON.stringify(e)),new ct.XpError(l[o],e.type,e.message)}return new ct.XpError("prs.unknown",void 0,e.message)}),t.convertResourceExceptions=freeOnUnref(function(e){if(void 0!==e)return x.mapObject(e,freeOnUnref(function(e){return t.createError(e)}))}),t})();t.PlaybackResourceErrorHandler=n}));e(gr);gr.PlaybackResourceErrorHandler;var vr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var m=de.get("PlaybackResourceClient"),y={adInsertionType:"deviceAdInsertionTypeOverride",drm:"deviceDrmOverride",videoQuality:"deviceVideoQualityOverride",audioQuality:"deviceAudioQualityOverride",protocol:"deviceProtocolOverride",streamingTechnology:"deviceStreamingTechnologyOverride",hdrFormat:"deviceHdrFormatsOverride",videoCodec:"deviceVideoCodecOverride",bitrateAdaptation:"deviceBitrateAdaptationsOverride",vodStreamSupport:"vodStreamSupportOverride"},o=["PRSDependencyException"],r=yr.createCDPResponseProcessor(freeOnUnref(function(e,t,n,r){if(null==e.error)e.errorsByResource=gr.PlaybackResourceErrorHandler.convertResourceExceptions(e.errorsByResource),t(e);else{var i=gr.PlaybackResourceErrorHandler.createError(e.error);x.contains(o,e.error.type)?n(i):r(i)}})),n=freeOnUnref(function(){function e(e,t){this.deviceInformation=zt.deviceInformation;var n={firmware:"1",playerType:"xp",operatingSystemName:Qe.nestedValue(this.deviceInformation,"software.operatingSystem.name"),operatingSystemVersion:Qe.nestedValue(this.deviceInformation,"software.operatingSystem.version"),deviceModel:Qe.nestedValue(this.deviceInformation,"hardware.model.name"),deviceChipset:Qe.nestedValue(this.deviceInformation,"hardware.chipset"),manufacturer:Qe.nestedValue(this.deviceInformation,"hardware.manufacturer")};null!=t&&(n.appBundleId=t.appBundleId,n.appStoreUrl=t.appStoreUrl,n.deviceApplicationName=t.deviceApplicationName),Qe.sanitize(n,!0),this.serviceClient=e.createServiceClient("/cdp/catalog/GetPlaybackResources",n,r,"prs")}return e.prototype.send=freeOnUnref(function(e,t){var n="ImmediateConsumption"===e.resourceUsage?"CRITICAL":"BACKGROUND",r={asin:e.titleId,consumptionType:e.consumptionType,desiredResources:e.resources.map(freeOnUnref(function(e){return e.resourceName})).join(","),resourceUsage:e.resourceUsage,videoMaterialType:e.videoMaterialType};null!=e.clientId&&(r.clientId=e.clientId),null!=e.userWatchSessionId&&(r.userWatchSessionId=e.userWatchSessionId),null!=e.sitePageUrl&&(r.sitePageUrl=e.sitePageUrl),null!=e.acceptedCreativeApis&&0<e.acceptedCreativeApis.length&&(r.acceptedCreativeApis=e.acceptedCreativeApis.join(",")),null!=e.displayResolution&&(r.displayWidth=e.displayResolution.width.toString(),r.displayHeight=e.displayResolution.height.toString()),null!=e.supportsVariableAspectRatio&&(r.supportsVariableAspectRatio=e.supportsVariableAspectRatio.toString()),null!=e.supportsEmbeddedTimedTextForVod&&(r.supportsEmbeddedTimedTextForVod=e.supportsEmbeddedTimedTextForVod.toString());for(var i=0,o=Object.keys(e.capabilityOverrides);i<o.length;i++){var a=o[i],s=e.capabilityOverrides[a];null==s?m.warn("Capability override:"+a+" is "+s+"."):r[y[a]]=s.toString()}"DASH"===e.capabilityOverrides.streamingTechnology&&null!=e.supportsEmbeddedTrickplayForVodDash&&(r.supportsEmbeddedTrickplayForVod=e.supportsEmbeddedTrickplayForVodDash.toString()),"HLS"===e.capabilityOverrides.streamingTechnology&&null!=e.supportsEmbeddedTrickplayForVodHls&&(r.supportsEmbeddedTrickplayForVod=e.supportsEmbeddedTrickplayForVodHls.toString());var l={};null!=e.playbackToken&&(l={playbackToken:e.playbackToken});for(var f=0,u=e.resources;f<u.length;f++){var c=u[f];r=x.extend(r,c.queryParams),l=x.extend(l,c.postParams)}x.isEmpty(e.playerAttributes)||(r.playerAttributes=JSON.stringify(e.playerAttributes)),x.isEmpty(e.weblabTreatments)||(r.weblabTreatments=JSON.stringify(e.weblabTreatments));var d={method:"POST",queryParams:r,headers:{},body:null,timeoutMs:9e3};Qe.sanitize(l),x.isEmpty(l)||(d.headers["Content-Type"]="application/x-www-form-urlencoded",d.body=mt.URLUtils.wwwFormUrlEncode(l));var p=Qe.nestedValue(this.deviceInformation,"software.advertisingId"),h=this.sanitizeNonEmptyString(Qe.withDefault(d.queryParams.advertisingId,p));return void 0===h?delete d.queryParams.advertisingId:d.queryParams.advertisingId=h,Qe.sanitize(d),this.serviceClient.send(d,t,n,!1)}),e.prototype.sanitizeNonEmptyString=freeOnUnref(function(e){return null==e||x.isEmpty(e.trim())?void 0:e}),e})();t.PlaybackResourceClient=n}));e(vr);vr.PlaybackResourceClient;var Or=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.deviceCapabilitiesNames={supportedDynamicRangeFormat:"output.video.display.dynamicRangeFormatSupport"}}));e(Or);Or.deviceCapabilitiesNames;var Sr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.deviceInformationNames={middlewareName:"software.middleware.name",middlewareVersion:"software.middleware.version",scriptEngineName:"software.scriptEngine.name",scriptEngineVersion:"software.scriptEngine.version",nativeApplicationName:"software.nativeApplication.name",nativeApplicationVersion:"software.nativeApplication.version",nativeRuntimeName:"software.nativeRuntime.name",nativeRuntimeVersion:"software.nativeRuntime.version",firmwareName:"software.firmware.name",firmwareVersion:"software.firmware.version"}}));e(Sr);Sr.deviceInformationNames;var Ur=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var r=f.of("PlaybackResourceRequestBuilder"),m=de.get("PlaybackResourceRequestBuilder"),i=freeOnUnref(function(){function h(){this.capabilityOverrides={},this.playerAttributes={},this.weblabTreatments={},this.resources=[]}return h.prototype.content=freeOnUnref(function(e,t,n,r,i){return this.titleId=e,this.videoMaterialType=t,this.consumptionType=n,this.playbackToken=r,this.clientId=i,this}),h.prototype.resource=freeOnUnref(function(e){return this.resources.push(e),this}),h.prototype.overrideDeviceCapability=freeOnUnref(function(e,t){return this.capabilityOverrides[e]=t,this}),h.prototype.acceptedCreativeApis=freeOnUnref(function(e){return this._acceptedCreativeApis=e,this}),h.prototype.playerAttribute=freeOnUnref(function(e,t){return r(e,"name").not.empty(),r(t,"playerAttributesValue").not.empty(),Array.isArray(t)&&(t=t.join()),this.playerAttributes[e]=t,this}),h.prototype.weblabTreatment=freeOnUnref(function(e,t){return r(e,"weblabName").not.empty(),r(t,"weblabTreatment").not.empty(),this.weblabTreatments[e]=t,this}),h.prototype.userWatchSessionId=freeOnUnref(function(e){return this._userWatchSessionId=e,this}),h.prototype.sitePageUrl=freeOnUnref(function(e){return this._sitePageUrl=e,this}),h.prototype.build=freeOnUnref(function(e){return r(this.titleId,"titleId").exists(),r(this.resources,"resources").not.empty(),{titleId:this.titleId,videoMaterialType:this.videoMaterialType,consumptionType:this.consumptionType,playbackToken:this.playbackToken,clientId:this.clientId,userWatchSessionId:this._userWatchSessionId,sitePageUrl:this._sitePageUrl,capabilityOverrides:n({},this.capabilityOverrides),resources:this.resources.slice(),resourceUsage:e,acceptedCreativeApis:this._acceptedCreativeApis,playerAttributes:n({},this.playerAttributesFromDeviceInformation(zt.deviceInformation,Sr.deviceInformationNames),this.playerAttributesFromDeviceInformation(zt.deviceCapabilities,Or.deviceCapabilitiesNames),this.playerAttributes),displayResolution:this.getDisplayResolution(),supportsVariableAspectRatio:this.getVariableAspectRatioSupport(),supportsEmbeddedTimedTextForVod:this.getEmbeddedTimedTextSupport(),supportsEmbeddedTrickplayForVodDash:this.getEmbeddedTrickplaySupportDash(),supportsEmbeddedTrickplayForVodHls:this.getEmbeddedTrickplaySupportHls(),weblabTreatments:n({},this.weblabTreatments)}}),h.prototype.playerAttributesFromDeviceInformation=freeOnUnref(function(e,t){for(var n={},r=0,i=Object.keys(t);r<i.length;r++){var o=i[r],a=Qe.nestedValue(e,t[o]);if(null!=a){a=this.removeHDR10Plus(o,a);var s=Array.isArray(a)?a.join():a.toString();x.isEmpty(s)||(n[o]=s)}}return n}),h.prototype.removeHDR10Plus=freeOnUnref(function(e,t){return"supportedDynamicRangeFormat"===e&&(t=t.filter(freeOnUnref(function(e){return"HDR10Plus"!==e}))),t}),h.prototype.getDisplayResolution=freeOnUnref(function(){var e=zt.deviceCapabilities.output.video.display;if(null!=e.height&&null!=e.width)return{height:Math.floor(e.height),width:Math.floor(e.width)}}),h.prototype.getVariableAspectRatioSupport=freeOnUnref(function(){var e=L.configurationStore.configuration;if(null!=e&&null!=e.capabilities&&!0===e.capabilities.supportsVariableAspectRatio)return!0;var t=zt.deviceCapabilities.output.video.display.supportsVariableAspectRatio;return null!=t&&t}),h.prototype.getEmbeddedTimedTextSupport=freeOnUnref(function(){var e=L.configurationStore.configuration;return null==e||null==e.prs||!1!==e.prs.enableEmbeddedTimedTextForVod}),h.prototype.getEmbeddedTrickplaySupportDash=freeOnUnref(function(){var e=L.configurationStore.configuration;return null!=e&&null!=e.prs&&!0===e.prs.enableEmbeddedTrickplayForVodDash}),h.prototype.getEmbeddedTrickplaySupportHls=freeOnUnref(function(){var e=L.configurationStore.configuration;return null!=e&&null!=e.prs&&!0===e.prs.enableEmbeddedTrickplayForVodHls}),h.prototype.clone=freeOnUnref(function(){for(var e=(new h).content(this.titleId,this.videoMaterialType,this.consumptionType,this.playbackToken,this.clientId).userWatchSessionId(this._userWatchSessionId).sitePageUrl(this._sitePageUrl).acceptedCreativeApis(this._acceptedCreativeApis),t=0,n=this.resources;t<n.length;t++){var r=n[t];e.resource(r)}for(var i=0,o=Object.keys(this.capabilityOverrides);i<o.length;i++){var a=o[i],s=this.capabilityOverrides[a];void 0===s?m.warn("Capability override:"+a+" is undefined, hence won't be included in the clone."):e.overrideDeviceCapability(a,s)}for(var l=0,f=Object.keys(this.playerAttributes);l<f.length;l++){var u=f[l];e.playerAttribute(u,this.playerAttributes[u])}for(var c=0,d=Object.keys(this.weblabTreatments);c<d.length;c++){var p=d[c];e.weblabTreatment(p,this.weblabTreatments[p])}return e}),h})();t.PlaybackResourceRequestBuilder=i}));e(Ur);Ur.PlaybackResourceRequestBuilder;var br=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("PRSResponseValidator"),n=freeOnUnref(function(){function e(){}return e.prototype.validateResponse=freeOnUnref(function(e){var t=this.validatePlaybackUrls(e);if(null!==t)return t;var n=this.validateTitleRendition(e);return null!==n?n:null}),e.prototype.validateTitleRendition=freeOnUnref(function(e){var t=Qe.nestedValue(e,"returnedTitleRendition.selectedEntitlement");if(null===t)return o.error("No returnedTitleRendition.selectedEntitlement"),new ct.XpError("prs.no_selected_entitlement");var n=t.rightsException;return null!=n?"PAYMENT_FAILURE"===n.downstreamReason?(o.error("Rights Exception due to PaymentFailure"),new ct.XpError("prs.payment_failure")):gr.PlaybackResourceErrorHandler.createError(n):null}),e.prototype.validatePlaybackUrls=freeOnUnref(function(e){var t=Qe.nestedValue(e,"errorsByResource.PlaybackUrls",null);if(null!==t)return t;if(null===Qe.nestedValue(e,"playbackUrls.urlSets"))return o.error("No playbackUrls.urlSets"),new ct.XpError("prs.no_playback_url_sets");var n=e.playbackUrls,r=n.defaultUrlSetId,i=n.urlSets[r].urls.manifest;return o.info("Frame rate for manifest URL "+i.url+" is "+i.frameRate),null}),e})();t.PRSResponseValidator=n}));e(br);br.PRSResponseValidator;var Pr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlaybackResource=Mt.PlaybackResource,t.PlaybackResourceClient=vr.PlaybackResourceClient,t.PlaybackResourceRequestBuilder=Ur.PlaybackResourceRequestBuilder,t.PRSResponseValidator=br.PRSResponseValidator}));e(Pr);Pr.PlaybackResource,Pr.PlaybackResourceClient,Pr.PlaybackResourceRequestBuilder,Pr.PRSResponseValidator;var Mr=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.Legacy="Legacy",e.Player="Player"})(n||(n={})),t.HfrControlMode=n}));e(Mr);Mr.HfrControlMode;var Cr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={Denied:"prs.denied","Denied.ConcurrencyLimitBreached":"prs.concurrency_limit_breached",Fault:"prs.fault","Fault.Timeout":"prs.fault.timeout",Invalid:"prs.invalid","PlaybackEnvelope.Expired":"prs.playback_envelope_expired","PlaybackEnvelope.Invalid":"prs.playback_envelope_invalid"};t.createError=function(e){if(null==e.code)return new ct.XpError("prs.unknown_codeless_exception",void 0,e.message);var t=n[e.code];return null!=t?new ct.XpError(t,void 0,e.message):new ct.XpError("prs.unknown",void 0,e.message)}}));e(Cr);Cr.createError;var Er=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createPlaybackUrlSetMap=function(e){if(null==e||0===e.length)throw new ct.XpError("prs.rapid_recap_playback_urls.no_url_sets");for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t[i.urlSetId]=i}return t},t.createRapidRecapSlateMap=function(e){return null==e?{}:{intro:x.find(e,freeOnUnref(function(e){return"Intro"===e.type})),outro:x.find(e,freeOnUnref(function(e){return"Outro"===e.type}))}}}));e(Er);Er.createPlaybackUrlSetMap,Er.createRapidRecapSlateMap;var Tr=t(freeOnUnref(function(e,t){var o=ce&&ce.__assign||freeOnUnref(function(){return(o=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var g=["PRSDependencyException"],v={__metadata:!1,auditPings:!0,fairPlayApplicationCertificate:!0,playbackData:!0,livePlaybackUrls:!0,syeUrls:!0,rapidRecap:!0,widevineServiceCertificate:!0,xrayMetadata:!0};function O(e,t){null!=e&&null!=e.error?(t.error=Cr.createError(e.error),t.ok=!1):null!=e&&null!=t&&(t.ok=!0)}var S=de.get("LivePlaybackResourceClientV2");var n=yr.createCDPResponseProcessor(function(e,t,n,r){var i=e,o=e.__metadata;if(null!=o&&S.info("PRS response metadata: ",JSON.stringify(o)),null==e.globalError){for(var a=0,s=Object.keys(e);a<s.length;a++){var l=s[a];if(!0===v[l]){var f=l,u=e[f];null!=u&&O(u,i[f])}else S.info('Ignoring attribute "'+l+'" from PRS response')}if(null!=e.livePlaybackUrls&&null!=e.livePlaybackUrls.result&&(i.livePlaybackUrls.result.urlSets=Er.createPlaybackUrlSetMap(e.livePlaybackUrls.result.urlSets),O(e.livePlaybackUrls.result.playbackSettings,i.livePlaybackUrls.result.playbackSettings)),null!=e.rapidRecap&&null!=e.rapidRecap.result){var c=i.rapidRecap.result.playbackUrls,d=e.rapidRecap.result.playbackUrls.urlSets;if(null!=d)for(var p=0,h=d;p<h.length;p++){var m=h[p];(null!=m.urls.manifest.startTime||m.urls.manifest.duration)&&(S.warn("RapidRecap urls contain startTime and/or duration. Removing."),delete m.urls.manifest.startTime,delete m.urls.manifest.duration)}c.urlSets=Er.createPlaybackUrlSetMap(d),i.rapidRecap.result.slates=Er.createRapidRecapSlateMap(e.rapidRecap.result.slates),O(e.rapidRecap.result.playbackSettings,i.rapidRecap.result.playbackSettings)}t(i)}else{var y=Cr.createError(e.globalError);0<=g.indexOf(e.globalError.exception)?n(y):r(y)}}),r=freeOnUnref(function(){function e(e){this.liveServiceClient=e.createServiceClient("/playback/prs/GetLivePlaybackResources",{},n,"prs")}return e.prototype.sendLiveRequest=freeOnUnref(function(e,t){var n=o({globalParameters:{deviceCapabilityFamily:e.deviceCapabilityFamily,playbackEnvelope:e.playbackEnvelope,capabilityDiscriminators:e.capabilityDiscriminators,sessionTrackingMode:e.sessionTrackingMode,userWatchSessionId:e.userWatchSessionId}},e.resources);Qe.sanitize(n);var r={firmware:"1",titleId:e.titleId};Qe.sanitize(r);var i={method:"POST",queryParams:r,headers:{},body:null,timeoutMs:6e3};return 0<Object.keys(n).length&&(i.headers["Content-Type"]="application/json",i.body=JSON.stringify(n)),Qe.sanitize(i),this.liveServiceClient.send(i,t,"CRITICAL",!1)}),e})();t.LivePlaybackResourceClient=r}));e(Tr);Tr.LivePlaybackResourceClient;var wr=t(freeOnUnref(function(e,t){var o=ce&&ce.__assign||freeOnUnref(function(){return(o=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var d=["PRSDependencyException"],p={__metadata:!1,sessionization:!1,auditPings:!0,fairPlayApplicationCertificate:!0,playbackData:!0,liveLinearPlaybackUrls:!0,widevineServiceCertificate:!0};function h(e,t){null!=e&&null!=e.error?(t.error=Cr.createError(e.error),t.ok=!1):null!=e&&null!=t&&(t.ok=!0)}var m=de.get("LiveLinearPlaybackResourceClientV2");var n=yr.createCDPResponseProcessor(function(e,t,n,r){var i=e,o=e.__metadata;if(null!=o&&m.info("PRS response metadata: ",JSON.stringify(o)),null==e.globalError){for(var a=0,s=Object.keys(e);a<s.length;a++){var l=s[a];if(!0===p[l]){var f=l,u=e[f];null!=u&&h(u,i[f])}else m.info('Ignoring attribute "'+l+'" from PRS response')}null!=e.liveLinearPlaybackUrls&&null!=e.liveLinearPlaybackUrls.result&&(i.liveLinearPlaybackUrls.result.urlSets=Er.createPlaybackUrlSetMap(e.liveLinearPlaybackUrls.result.urlSets),h(e.liveLinearPlaybackUrls.result.playbackSettings,i.liveLinearPlaybackUrls.result.playbackSettings)),t(i)}else{var c=Cr.createError(e.globalError);0<=d.indexOf(e.globalError.exception)?n(c):r(c)}}),r=freeOnUnref(function(){function e(e){this.liveLinearServiceClient=e.createServiceClient("/playback/prs/GetLiveLinearPlaybackResources",{},n,"prs")}return e.prototype.sendLiveLinearRequest=freeOnUnref(function(e,t){var n=o({globalParameters:{deviceCapabilityFamily:e.deviceCapabilityFamily,playbackEnvelope:e.playbackEnvelope,capabilityDiscriminators:e.capabilityDiscriminators,sessionTrackingMode:e.sessionTrackingMode,userWatchSessionId:e.userWatchSessionId}},e.resources);Qe.sanitize(n);var r={firmware:"1",titleId:e.titleId};Qe.sanitize(r);var i={method:"POST",queryParams:r,headers:{},body:null,timeoutMs:6e3};return 0<Object.keys(n).length&&(i.headers["Content-Type"]="application/json",i.body=JSON.stringify(n)),Qe.sanitize(i),this.liveLinearServiceClient.send(i,t,"CRITICAL",!1)}),e})();t.LiveLinearPlaybackResourceClient=r}));e(wr);wr.LiveLinearPlaybackResourceClient;var Ir=t(freeOnUnref(function(e,t){var s=ce&&ce.__assign||freeOnUnref(function(){return(s=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var d=["PRSDependencyException"],p={__metadata:!1,sessionization:!1,auditPings:!0,fairPlayApplicationCertificate:!0,playbackData:!0,timedTextUrls:!0,transitionTimecodes:!0,trickplayUrls:!0,vodPlaybackUrls:!0,vodPlaylistedPlaybackUrls:!0,vodXrayMetadata:!0,widevineServiceCertificate:!0};function h(e,t){null!=e&&null!=e.error?(t.error=Cr.createError(e.error),t.ok=!1):null!=e&&null!=t&&(t.ok=!0)}var m=de.get("VodPlaybackResourceClientV2");var n=yr.createCDPResponseProcessor(function(e,t,n,r){var i=e,o=e.__metadata;if(null!=o&&m.info("PRS response metadata: ",JSON.stringify(o)),null==e.globalError){for(var a=0,s=Object.keys(e);a<s.length;a++){var l=s[a];if(!0===p[l]){var f=l,u=e[f];null!=u&&h(u,i[f])}else m.info('Ignoring attribute "'+l+'" from PRS response')}null!=e.vodPlaybackUrls&&null!=e.vodPlaybackUrls.result&&(i.vodPlaybackUrls.result.playbackUrls.urlSets=Er.createPlaybackUrlSetMap(e.vodPlaybackUrls.result.playbackUrls.urlSets),h(e.vodPlaybackUrls.result.playbackSettings,i.vodPlaybackUrls.result.playbackSettings)),null!=e.vodPlaylistedPlaybackUrls&&null!=e.vodPlaylistedPlaybackUrls.result&&h(e.vodPlaylistedPlaybackUrls.result.playbackSettings,i.vodPlaylistedPlaybackUrls.result.playbackSettings),t(i)}else{var c=Cr.createError(e.globalError);0<=d.indexOf(e.globalError.exception)?n(c):r(c)}}),r=freeOnUnref(function(){function e(e){this.vodServiceClient=e.createServiceClient("/playback/prs/GetVodPlaybackResources",{},n,"prs")}return e.prototype.sendRequest=freeOnUnref(function(e,t){var n=s({globalParameters:{deviceCapabilityFamily:e.deviceCapabilityFamily,playbackEnvelope:e.playbackEnvelope,capabilityDiscriminators:e.capabilityDiscriminators}},e.resources);Qe.sanitize(n);var r={firmware:"1",titleId:e.titleId};Qe.sanitize(r);var i={method:"POST",queryParams:r,headers:{},body:null,timeoutMs:6e3};if(0<Object.keys(n).length){var o=L.configurationStore.configuration,a=null!=o&&null!=o.prs&&!0===o.prs.enablePlainTextContentType;i.headers["Content-Type"]=a?"text/plain":"application/json",i.body=JSON.stringify(n)}return Qe.sanitize(i),this.vodServiceClient.send(i,t,"CRITICAL",!1)}),e})();t.VodPlaybackResourceClient=r}));e(Ir);Ir.VodPlaybackResourceClient;var kr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("PRSResponseValidator"),s=["Restricted","Unrestricted"],l=["LiveHead","PlayStart"],f=["Rolling","Fixed"],n=freeOnUnref(function(){function e(){}return e.prototype.validateLiveResponse=freeOnUnref(function(e,t){if(void 0===t&&(t={}),!0===t.rapidRecap){var n=this.validateRapidRecapPlaybackUrlsResponse(e.rapidRecap);if(null!=n)return n}return this.validateLivePlaybackUrlsResponse(e)}),e.prototype.validateLivePlaybackUrlsResponse=freeOnUnref(function(e){if(null==e.livePlaybackUrls)return new ct.XpError("prs.live_playback_urls.no_resource");if(!e.livePlaybackUrls.ok)return e.livePlaybackUrls.error;if(null==e.livePlaybackUrls.result.urlSets)return new ct.XpError("prs.live_playback_urls.no_url_sets");if(null!=e.playbackData&&e.playbackData.ok&&null!=e.playbackData.result.liveLookbackMetadata){var t=e.playbackData.result.liveLookbackMetadata;if(-1===s.indexOf(t.liveLookbackControl))return new ct.XpError("prs.invalid_response",void 0,"invalid liveLookbackRoot "+t.liveLookbackControl);if("Restricted"===t.liveLookbackControl&&(null==t.liveLookbackRoot||-1===l.indexOf(t.liveLookbackRoot)))return new ct.XpError("prs.invalid_response",void 0,"invalid liveLookbackRoot "+t.liveLookbackRoot);if("Restricted"===t.liveLookbackControl&&(null==t.liveLookbackRootMode||-1===f.indexOf(t.liveLookbackRootMode)))return new ct.XpError("prs.invalid_response",void 0,"invalid liveLookbackRootMode "+t.liveLookbackRootMode)}var n=e.livePlaybackUrls.result,r=n.defaultUrlSetId,i=n.urlSets[r];if(null==i)return new ct.XpError("prs.live_playback_urls.invalid_default_url_set_id");var o=i.urls.manifest;return a.info("Frame rate for manifest URL "+o.url+" is "+o.frameRate),null}),e.prototype.validateRapidRecapPlaybackUrlsResponse=freeOnUnref(function(e){if(null==e)return new ct.XpError("prs.rapid_recap_playback_urls.no_resource");if(!e.ok)return e.error;if(null==e.result.playbackUrls||null==e.result.playbackUrls.urlSets)return new ct.XpError("prs.rapid_recap_playback_urls.no_url_sets");var t,n=e.result.playbackUrls.defaultUrlSetId;if(null==n)return new ct.XpError("prs.rapid_recap_playback_urls.invalid_default_url_set_id");if(null==(t=e.result.playbackUrls.urlSets[n])||null==t.urls||null==t.urls.manifest)return new ct.XpError("prs.rapid_recap_playback_urls.invalid_default_url_set_id");var r=t.urls.manifest;return a.info("Frame rate for Rapid Recap manifest URL "+r.url+" is "+r.frameRate),null}),e})();t.PRSResponseValidator=n}));e(kr);kr.PRSResponseValidator;var _r=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HfrControlMode=Mr.HfrControlMode,t.PlaybackResourceClient=Tr.LivePlaybackResourceClient,t.LivePlaybackResourceClient=Tr.LivePlaybackResourceClient,t.LiveLinearPlaybackResourceClient=wr.LiveLinearPlaybackResourceClient,t.VodPlaybackResourceClient=Ir.VodPlaybackResourceClient,t.PRSResponseValidator=kr.PRSResponseValidator}));e(_r);_r.HfrControlMode,_r.PlaybackResourceClient,_r.LivePlaybackResourceClient,_r.LiveLinearPlaybackResourceClient,_r.VodPlaybackResourceClient,_r.PRSResponseValidator;var Rr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createPrsGeneralApiParameters=function(e){var t,n,r,i=zt.deviceInformation;return null!=e.applicationIdentity?(t=e.applicationIdentity.name,n=e.applicationIdentity.bundle,r=e.applicationIdentity.storeUrl):null!=i.software&&null!=i.software.nativeApplication&&(t=i.software.nativeApplication.name),{appBundleId:n,appStoreUrl:r,deviceApplicationName:t}}}));e(Rr);Rr.createPrsGeneralApiParameters;var Ar=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createPrsV1CuepointPlaylistOptions=function(e,t,n){var r={optOutAdTracking:e,advertisingId:!0===e?void 0:n};return null!=t&&null!=t.gdprPrivacyConsent&&(r.gdpr={applicable:t.gdprPrivacyConsent.applicable,gvlString:t.gdprPrivacyConsent.gvlString,avlString:t.gdprPrivacyConsent.avlString}),r}}));e(Ar);Ar.createPrsV1CuepointPlaylistOptions;var Dr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createPrsV2AdParameters=function(e,t,n,r,i,o,a){var s,l=null!=t?t.gdprPrivacyConsent:void 0;return null!=l&&(s={applicable:l.applicable,gvlString:l.gvlString,avlString:l.avlString}),{advertisingId:!0===e?void 0:n,optOutAdTracking:e,gdpr:s,appBundle:r,appStoreUrl:i,sitePageUrl:o,mainContentResumeOffsetHintMillis:a}}}));e(Dr);Dr.createPrsV2AdParameters;var xr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c={};u.split("").map(freeOnUnref(function(e,t){c[e]=t}));var d=u.length-1;function n(e){for(var t=[],n=0;n<e.length;){var r=e.charCodeAt(n++),i=e.charCodeAt(n++),o=e.charCodeAt(n++),a=r>>2,s=(3&r)<<4|i>>4,l=(15&i)<<2|o>>6,f=63&o;isNaN(i)?l=f=64:isNaN(o)&&(f=64),t.push(u.charAt(a)),t.push(u.charAt(s)),t.push(u.charAt(l)),t.push(u.charAt(f))}return t.join("")}function r(e){var t=[],n=(e=e.replace(/\s/g,"")).length;if((e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length!==n)throw new Error("Invalid characters found in base64 string");if(e.length%4==1)throw new Error("Invalid input length");for(var r=0;r<e.length;){var i=c[e[r++]],o=c[e[r++]],a=c[e[r++]],s=c[e[r++]];if(i===d||a===d&&s!==d||o===d&&a!==d)throw new Error("Invalid input: padding characters found in the middle of the input string");var l=i<<2|o>>4,f=(15&o)<<4|a>>2,u=(3&a)<<6|s;t.push(String.fromCharCode(l)),64!==a&&t.push(String.fromCharCode(f)),64!==s&&t.push(String.fromCharCode(u))}return t.join("")}t.encode=function(e){var t=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);return n(String.fromCharCode.apply(null,t))},t.decode=function(e){return new Uint8Array(r(e).split("").map(freeOnUnref(function(e){return e.charCodeAt(0)})))},t.encodeString=n,t.decodeString=r}));e(xr);xr.encode,xr.decode,xr.encodeString,xr.decodeString;var Fr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={encode:freeOnUnref(function(e){var t=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);return Duktape.enc("base64",t)}),decode:freeOnUnref(function(e){return Object(Duktape.dec("base64",e))}),encodeString:freeOnUnref(function(e){return Duktape.enc("base64",e)}),decodeString:freeOnUnref(function(e){return(new TextDecoder).decode(Duktape.dec("base64",e))})};t.base64Duktape=n}));e(Fr);Fr.base64Duktape;var Br=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=re.tryGetNative(),r={encode:freeOnUnref(function(e){if(ArrayBuffer.isView(e)){var t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return n.Encoding_Base64EncodeBinaryToString(t)}return n.Encoding_Base64EncodeBinaryToString(e)}),decode:freeOnUnref(function(e){var t=n.Encoding_Base64DecodeStringToBinary(e);if(null===t)throw new Error("Error base64 decoding input string to byte array");return new Uint8Array(t)}),encodeString:freeOnUnref(function(e){return n.Encoding_Base64EncodeStringToString(e)}),decodeString:freeOnUnref(function(e){var t=n.Encoding_Base64DecodeStringToString(e);if(null===t)throw new Error("Error base64 decoding input string to string");return t})};t.base64Native=r}));e(Br);Br.base64Native;var Lr=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.base64=n;var r=re.tryGetNative(),i=null!=r&&"function"==typeof r.Encoding_Base64EncodeStringToString,o="undefined"!=typeof Duktape&&Duktape.hasOwnProperty("version");t.base64=n=o?Fr.base64Duktape:i?Br.base64Native:xr;var a=n.encode;t.encode=a;var s=n.decode;t.decode=s;var l=n.encodeString;t.encodeString=l;var f=n.decodeString;t.decodeString=f}));e(Lr);Lr.base64,Lr.encode,Lr.decode,Lr.encodeString,Lr.decodeString;var Nr=t(freeOnUnref(function(e,t){function a(e,t,n){for(var r=e.toString();r.length<t;)r=n+r;return r}Object.defineProperty(t,"__esModule",{value:!0}),t.millisecondsToIsoDuration=function(e){var t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4),r=e%6e4/1e3,i="PT";return 0<t&&(i+=t+"H"),0<n&&(i+=n+"M"),(0<r||2===i.length)&&(i+=r+"S"),i},t.millisecondsToExtendedLimitedIso8601TimeFormat=function(e){var t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4),r=Math.floor(e%6e4/1e3),i=e%1e3,o="";return o+=a(t,2,"0")+":",o+=a(n,2,"0")+":",o+=""+a(r,2,"0"),o+="."+a(i,3,"0")}}));e(Nr);Nr.millisecondsToIsoDuration,Nr.millisecondsToExtendedLimitedIso8601TimeFormat;var Vr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="([-+]?[0-9]+(?:\\.[0-9]+)?)",r=new RegExp("^([-+]?)P(?:"+n+"D)?(T(?:"+n+"H)?(?:"+n+"M)?(?:"+n+"S)?)?$");t.isoToMillis=function(e){var t=e.match(r);if(null==t||"PT"===t[0]||"+PT"===t[0]||"-PT"===t[0]||"T"===t[3])throw new Error("Invalid ISO Duration String "+e+" passed into isoToMillis");return("-"===t[1]?-1:1)*(86400*(null!=t[2]?Number(t[2]):0)+3600*(null!=t[4]?Number(t[4]):0)+60*(null!=t[5]?Number(t[5]):0)+(null!=t[6]?Number(t[6]):0))*1e3},t.extendedLimitedIso8601TimeFormatToMilliseconds=function(e){var t=e.match(/^(\d{2}):(\d{2}):(\d{2})(?:\.(\d{3}))?$/);if(null===t)throw new Error("Unsupported timestamp: "+e);var n=parseInt(t[1]),r=parseInt(t[2]),i=parseInt(t[3]),o=0;return t[4]&&(o=parseInt(t[4])),o+1e3*(i+60*(r+60*n))}}));e(Vr);Vr.isoToMillis,Vr.extendedLimitedIso8601TimeFormatToMilliseconds;var jr=t(freeOnUnref(function(e,n){function t(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),t(Nr),t(Vr)}));e(jr);var qr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("PlayReadyLicenseTransformer");var n=freeOnUnref(function(){function t(){}return t.transform=freeOnUnref(function(e){return{cdmLicenseData:Lr.decode(e.encodedLicenseResponse),keyMetadata:t.createPlayReadyKeyMetadata(e.metadata.licenses)}}),t.transformV2=freeOnUnref(function(e){return{cdmLicenseData:Lr.decode(e.license),keyMetadata:function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n],o=void 0;if(null!=i.outputProtection){var a=i.outputProtection.uncompressedDigitalVideoOpl;a<=250||251<=a&&a<=270&&(o={hdcp:"HDCP_V1",hdcpEnforcementResolutionPixels:52e4})}var s=o=void 0;null!=i.rightsWindow&&(s={startTimeMs:Date.parse(i.rightsWindow.startTime),endTimeMs:Date.parse(i.rightsWindow.endTime)},(isNaN(s.startTimeMs)||isNaN(s.endTimeMs))&&f.warn("Received non standard ISO 8601 timestamp in rights window:",JSON.stringify(i.rightsWindow)));var l=void 0;if(null!=i.consumptionDuration)try{l=jr.isoToMillis(i.consumptionDuration)}catch(e){f.warn("Received non standard ISO 8601 duration as consumption duration:",i.consumptionDuration)}t.push({id:i.keyId?i.keyId:"",keyType:"CONTENT",hdcp:o,rightsWindow:s,consumptionDurationMs:l})}return t}(e.metadata.licenses)}}),t.createPlayReadyKeyMetadata=freeOnUnref(function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n],o=void 0;if(null!=i.outputProtection){var a=i.outputProtection.uncompressedDigitalVideoOpl;a<=250||251<=a&&a<=270&&(o={hdcp:"HDCP_V1",hdcpEnforcementResolutionPixels:52e4})}var s=o=void 0;null!=i.rightsWindow&&(s={startTimeMs:Date.parse(i.rightsWindow.startTime),endTimeMs:Date.parse(i.rightsWindow.endTime)},(isNaN(s.startTimeMs)||isNaN(s.endTimeMs))&&f.warn("Received non standard ISO 8601 timestamp in rights window:",JSON.stringify(i.rightsWindow)));var l=void 0;if(null!=i.consumptionDuration)try{l=jr.isoToMillis(i.consumptionDuration)}catch(e){f.warn("Received non standard ISO 8601 duration as consumption duration:",i.consumptionDuration)}t.push({id:i.keyId?i.keyId:"",keyType:"CONTENT",hdcp:o,rightsWindow:s,consumptionDurationMs:l})}return t}),t})();t.PlayReadyLicenseTransformer=n}));e(qr);qr.PlayReadyLicenseTransformer;var Hr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("LicenseAcquirer"),n=freeOnUnref(function(){function e(e,t){this.prsClient=e,this.requestBuilder=t,this.eventEmitter=new A.EventEmitter}return e.prototype.initialize=freeOnUnref(function(){}),e.prototype.uninitialize=freeOnUnref(function(){}),e.prototype.acquireLicense=freeOnUnref(function(e,t,n){if(-1!==e.indexOf("fps"))return this.acquireFPLicense(t,n);if(-1!==e.indexOf("widevine"))return this.acquireWVLicense(t,n);if(-1!==e.indexOf("playready"))return this.acquirePRLicense(t,n);var r='Unexpected key system "'+e+'"';return o.error(r),lt.Promise.reject(new ct.XpError("drm.unexpected_key_system",void 0,r))}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.acquireFPLicense=freeOnUnref(function(e,n){var t=this.requestBuilder.clone().resource(Pr.PlaybackResource.FairPlayLicense(Lr.encode(e),"0")).build("ImmediateConsumption");return this.triggerRequest(t,n).then(freeOnUnref(function(e){if(n.throwIfRequested(),null==e.fairPlayLicense){var t=e.errorsByResource;throw null!=t&&null!=t.FairPlayLicense?t.FairPlayLicense:new ct.XpError("prs.absent_resource",void 0,"FairPlayLicense request error without errorsByResource")}return{cdmLicenseData:Lr.decode(e.fairPlayLicense.encodedLicenseResponse),keyMetadata:[{id:"0",keyType:"CONTENT"}]}})).catch(freeOnUnref(function(e){throw e instanceof lt.CancelError||q.metrics.putMetric("ServiceRequest.PRS.License.Error"),ct.XpError.generatePrefixedError(e,"license")}))}),e.prototype.acquireWVLicense=freeOnUnref(function(e,r){var t=this.requestBuilder.clone().resource(Pr.PlaybackResource.Widevine2License(Lr.encode(e),!0)).build("ImmediateConsumption");return this.triggerRequest(t,r).then(freeOnUnref(function(e){if(r.throwIfRequested(),null==e.widevine2License){var t=e.errorsByResource;if(null!=t&&null!=t.Widevine2License){if("SD"===e.returnedTitleRendition.videoQuality&&"prs.hd_content_not_allowed"===t.Widevine2License.code)throw new ct.XpError("prs.invalid_hd_content_downgrade",void 0,"Widevine2License request error: service returned hd not allowed error even when sd asset was requested");throw t.Widevine2License}throw new ct.XpError("prs.absent_resource",void 0,"Widevine2License request error without errorsByResource")}var n=e.widevine2License;return{cdmLicenseData:Lr.decode(n.license),keyMetadata:n.metadata.keyMetadata}})).catch(freeOnUnref(function(e){throw e instanceof lt.CancelError||q.metrics.putMetric("ServiceRequest.PRS.License.Error"),ct.XpError.generatePrefixedError(e,"license")}))}),e.prototype.acquirePRLicense=freeOnUnref(function(e,n){var t=null;if(e.byteLength%2==0){var r=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(-1!==r.indexOf("PlayReadyKeyMessage")){var i=r.indexOf("<Challenge"),o=r.indexOf(">",i),a=r.indexOf("</Challenge");t=r.substring(o+1,a),this.validatePRClientTime(t,!0)}}null===t&&(this.validatePRClientTime(e,!1),t=Lr.encode(e));var s=this.requestBuilder.clone().resource(Pr.PlaybackResource.PlayReadyLicense(t)).build("ImmediateConsumption");return this.triggerRequest(s,n).then(freeOnUnref(function(e){if(n.throwIfRequested(),null==e.playReadyLicense){var t=e.errorsByResource;throw null!=t&&null!=t.PlayReadyLicense?t.PlayReadyLicense:new ct.XpError("prs.absent_resource",void 0,"PlayReadyLicense request error without errorsByResource")}return qr.PlayReadyLicenseTransformer.transform(e.playReadyLicense)})).catch(freeOnUnref(function(e){throw e instanceof lt.CancelError||q.metrics.putMetric("ServiceRequest.PRS.License.Error"),ct.XpError.generatePrefixedError(e,"license")}))}),e.prototype.validatePRClientTime=freeOnUnref(function(e,t){try{var n=void 0;n=t?Lr.decode(e):e;var r=String.fromCharCode.apply(null,n).match(/<clienttime>([0-9]*)<\/clienttime>/i);if(null!=r){var i=1e3*parseInt(r[1]);864e5<Math.abs(i-Date.now())&&o.error("Clock skew detected between clienttime in PlayReady challenge and local clock! Challenge clientTime=["+new Date(i)+"] and local time=["+new Date+"]")}else o.info("No clienttime found on PlayReady challenge")}catch(e){o.warn("Failed to extract clienttime from PlayReady challenge!")}}),e.prototype.triggerRequest=freeOnUnref(function(e,t){var n=this;return this.prsClient.send(e,t).then(freeOnUnref(function(e){return t.throwIfRequested(),e.on("latency",freeOnUnref(function(e){q.metrics.putMetric("ServiceRequest.PRS.License.RequestLatencyTime",e,"ms")})),e.on("success",freeOnUnref(function(e){n.eventEmitter.emit("licenseAcquired",e)})),e.on("fail",freeOnUnref(function(e){n.eventEmitter.emit("licenseAcquisitionFailed",e)})),e.response()}))}),e})();t.LicenseAcquirerV1=n}));e(Hr);Hr.LicenseAcquirerV1;var zr=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.LIVE="LIVE",e.VOD="VOD",e.LINEAR="LINEAR"})(n||(n={})),t.DrmEndpointType=n}));e(zr);zr.DrmEndpointType;var Wr=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.None="NO_HDCP_ENFORCEMENT",e.Type0="HDCP_TYPE_0",e.Type1="HDCP_TYPE_1"})(n||(n={})),t.HdcpEnforcement=n}));e(Wr);Wr.HdcpEnforcement;var Kr=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.NonPersistent="NON_PERSISTENT",e.SingleWindowPersistent="SINGLE_WINDOW_PERSISTENT",e.DualWindowPersistent="DUAL_WINDOW_PERSISTENT"})(n||(n={})),t.LicenseType=n}));e(Kr);Kr.LicenseType;var Gr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i={"AccessTicket.Invalid":"drm_service.access_ticket.invalid",Denied:"drm_service.license_denied","Denied.UnsupportedCdmVersion":"drm_service.unsupported_cdm_version","Handoff.PromiseMismatch":"drm_service.session_handoff_mismatch","PlaybackEnvelope.Expired":"drm_service.playback_envelope_expired","PlaybackEnvelope.Invalid":"drm_service.playback_envelope_invalid","Downgrade.Sd":"drm_service.hd_content_not_allowed","Downgrade.Sd.VmpValidationRequired":"drm_service.hd_content_not_allowed.vmp_validation","Downgrade.Hd":"drm_service.uhd_content_not_allowed","Downgrade.Hd.VmpValidationRequired":"drm_service.uhd_content_not_allowed.vmp_validation","PlaybackSessionTicket.Invalid":"drm_service.playback_session_ticket.invalid"},o={DRMInvalidRequestException:"drm_service.invalid_request",DRMInternalException:"drm_service.internal"};t.createError=function(e){if(null==e.code){var t=o[e.exception],n=null==t?"drm_service.unknown":t;return new ct.XpError(n,void 0,e.message)}var r=i[e.code];return null!=r?new ct.XpError(r,void 0,e.message):new ct.XpError("drm_service.unknown",void 0,e.message)}}));e(Gr);Gr.createError;var Qr=t(freeOnUnref(function(e,t){var n,r=ce&&ce.__assign||freeOnUnref(function(){return(r=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var i=((n={})[zr.DrmEndpointType.LIVE]={fairPlay:"/playback/drm/GetFairPlayLicense",playReady:"/playback/drm/GetPlayReadyLicense",widevine:"/playback/drm/GetWidevineLicense"},n[zr.DrmEndpointType.VOD]={fairPlay:"/playback/drm-vod/GetFairPlayLicense",playReady:"/playback/drm-vod/GetPlayReadyLicense",widevine:"/playback/drm-vod/GetWidevineLicense"},n[zr.DrmEndpointType.LINEAR]={fairPlay:"/playback/drm-linear/GetFairPlayLicense",playReady:"/playback/drm-linear/GetPlayReadyLicense",widevine:"/playback/drm-linear/GetWidevineLicense"},n),o={500:"DRMInternalException",400:"DRMInvalidRequestException",403:"DRMDeniedException"},a=["DRMInternalException"];function s(e,t){return r({exception:null!=o[e]?o[e]:"unknown"},t)}function l(e,t,n){var r=Gr.createError(e);0<=a.indexOf(e.exception)?t(r):n(r)}var f=yr.createCDPResponseProcessor(freeOnUnref(function(e,t,n,r,i){if(400<=e){l(s(e,t),r,i)}else{var o=t;if(null==o.fairPlayLicense)i(new ct.XpError("drm_service.empty_response"));else n(o.fairPlayLicense)}}),!0),u=yr.createCDPResponseProcessor(freeOnUnref(function(e,t,n,r,i){if(400<=e){l(s(e,t),r,i)}else{var o=t;if(null==o.playReadyLicense)i(new ct.XpError("drm_service.empty_response"));else n(o.playReadyLicense)}}),!0),c=yr.createCDPResponseProcessor(freeOnUnref(function(e,t,n,r,i){if(400<=e){l(s(e,t),r,i)}else{var o=t;if(null==o.widevineLicense)i(new ct.XpError("drm_service.empty_response"));else n(o.widevineLicense)}}),!0),d=freeOnUnref(function(){function e(e,t){void 0===t&&(t=zr.DrmEndpointType.LIVE);var n=i[t];this.fairPlayServiceClient=e.createServiceClient(n.fairPlay,{firmware:"1"},f,"drm_service"),this.playReadyServiceClient=e.createServiceClient(n.playReady,{firmware:"1"},u,"drm_service"),this.widevineServiceClient=e.createServiceClient(n.widevine,{firmware:"1"},c,"drm_service")}return e.prototype.sendFairPlay=freeOnUnref(function(e,t){var n=this.createRequestParameters(e,{});return this.fairPlayServiceClient.send(n,t,"CRITICAL",!1,!0)}),e.prototype.sendPlayReady=freeOnUnref(function(e,t){var n={packagingFormat:e.packagingFormat},r=this.createRequestParameters(e,n);return this.playReadyServiceClient.send(r,t,"CRITICAL",!1,!0)}),e.prototype.sendWidevine=freeOnUnref(function(e,t){var n={includeHdcpTestKey:e.includeHdcpTestKey},r=this.createRequestParameters(e,n);return this.widevineServiceClient.send(r,t,"CRITICAL",!1,!0)}),e.prototype.createRequestParameters=freeOnUnref(function(e,t){t.playbackEnvelope=e.playbackEnvelope,t.sessionHandoffToken=e.sessionHandoff,t.sessionToken=e.sessionToken,t.licenseChallenge=e.licenseChallenge,Qe.sanitize(t);var n={titleId:e.titleId};Qe.sanitize(n);var r={method:"POST",queryParams:n,headers:{},body:null,timeoutMs:6e3};if(0<Object.keys(t).length){var i=L.configurationStore.configuration,o=null!=i&&null!=i.drm&&!0===i.drm.enablePlainTextContentType;r.headers["Content-Type"]=o?"text/plain":"application/json",r.body=JSON.stringify(t)}return Qe.sanitize(r),r}),e})();t.DrmServiceClient=d}));e(Qr);Qr.DrmServiceClient;var Xr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DrmEndpointType=zr.DrmEndpointType,t.HdcpEnforcement=Wr.HdcpEnforcement,t.LicenseType=Kr.LicenseType,t.DrmServiceClient=Qr.DrmServiceClient}));e(Xr);Xr.DrmEndpointType,Xr.HdcpEnforcement,Xr.LicenseType,Xr.DrmServiceClient;var Yr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("PlayReadyChallengePreProcessor"),i=864e5;function a(e){try{var t=String.fromCharCode.apply(null,e).match(/<clienttime>([0-9]*)<\/clienttime>/i);if(null!=t){var n=1e3*parseInt(t[1]);Math.abs(n-Date.now())>i&&r.error("Clock skew detected between clienttime in PlayReady challenge and local clock! Challenge clientTime=["+new Date(n)+"] and local time=["+new Date+"]")}else r.info("No clienttime found on PlayReady challenge")}catch(e){r.warn("Failed to extract clienttime from PlayReady challenge!")}}t.extractChallengeContents=function(e){var t=null;if(e.byteLength%2==0){var n=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(-1!==n.indexOf("PlayReadyKeyMessage")){var r=n.indexOf("<Challenge"),i=n.indexOf(">",r),o=n.indexOf("</Challenge");t=n.substring(i+1,o),a(Lr.decode(t))}}return null===t&&(a(e),t=Lr.encode(e)),t}}));e(Yr);Yr.extractChallengeContents;var Jr=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a={NO_HDCP_ENFORCEMENT:"HDCP_NONE",HDCP_TYPE_0:"HDCP_V1",HDCP_TYPE_1:"HDCP_V2"},s=de.get("FairPlayLicenseTransformer");function l(e){return null!=e?jr.isoToMillis(e):void 0}var n=freeOnUnref(function(){function e(){}return e.transformV2=freeOnUnref(function(e){return{cdmLicenseData:Lr.decode(e.license),keyMetadata:[function(e){var t=e.policies.licensePersistence,n=void 0;if(t.licenseType===Xr.LicenseType.DualWindowPersistent)try{n=l(t.playbackDuration)}catch(e){s.warn("playbackDuration is an invalid ISO 8601 duration, "+t.playbackDuration)}var r=void 0;if(t.licenseType===Xr.LicenseType.SingleWindowPersistent)try{r=l(t.validityDuration)}catch(e){s.warn("validityDuration is an invalid ISO 8601 duration, "+t.validityDuration)}var i=(new Date).getTime(),o=null==r?void 0:{startTimeMs:i,endTimeMs:i+r};return{id:e.keyId,keyType:"CONTENT",hdcp:{hdcp:a[e.policies.hdcpEnforcement]},rightsWindow:o,consumptionDurationMs:n}}(e.metadata)]}}),e})();t.FairPlayLicenseTransformer=n}));e(Jr);Jr.FairPlayLicenseTransformer;var Zr=t(freeOnUnref(function(e,t){var a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("LicenseAcquirerV2");function s(e){return a({},e,{hdcp:{hdcp:e.hdcp.hdcp,hdcpEnforcementResolutionPixels:e.hdcp.hdcpEnforcementPixels}})}var n=freeOnUnref(function(){function e(e,t,n,r){if(this.contentConfig=t,this.envelopeRefreshController=n,this.eventEmitter=new A.EventEmitter,this.sessionHandoff=r,null==this.contentConfig.playbackEnvelope)throw new ct.XpError("license.envelope.missing");var i;i=null!=this.contentConfig.playbackEnvelope.playbackResourceType&&"LINEAR"===this.contentConfig.playbackEnvelope.playbackResourceType?Xr.DrmEndpointType.LINEAR:"LiveStreaming"===this.contentConfig.videoMaterialType?Xr.DrmEndpointType.LIVE:Xr.DrmEndpointType.VOD,this.drmServiceClient=new Xr.DrmServiceClient(e,i)}return e.prototype.initialize=freeOnUnref(function(){this.envelopeRefreshController.initialize()}),e.prototype.uninitialize=freeOnUnref(function(){this.envelopeRefreshController.uninitialize()}),e.prototype.updateSessionToken=freeOnUnref(function(e){this.sessionToken=e}),e.prototype.acquireLicense=freeOnUnref(function(e,t,n){if(-1!==e.indexOf("fps"))return this.acquireFPLicense(t,n);if(-1!==e.indexOf("widevine"))return this.acquireWVLicense(t,n);if(-1!==e.indexOf("playready")){var r=Yr.extractChallengeContents(t);return this.acquirePRLicense(r,n)}var i='Unexpected key system "'+e+'"';return o.error(i),lt.Promise.reject(new ct.XpError("drm.unexpected_key_system",void 0,i))}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.acquireFPLicense=freeOnUnref(function(n,r,i){var o=this;return void 0===i&&(i=!1),r.requested?lt.Promise.reject(new lt.CancelError):this.prepareSessionIdentifier(r,i).then(freeOnUnref(function(e){r.throwIfRequested();var t=a({},e,{titleId:o.contentConfig.titleId,licenseChallenge:Lr.encode(n)});return o.drmServiceClient.sendFairPlay(t,r).then(freeOnUnref(function(e){return o.registerRequestEventHandlers(e),e.response()})).then(freeOnUnref(function(e){return r.throwIfRequested(),Jr.FairPlayLicenseTransformer.transformV2(e)})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;if(q.metrics.putMetric("ServiceRequest.DrmService.License.Error"),e instanceof ct.XpError&&"drm_service.playback_envelope_expired"===e.code){if(q.metrics.putMetric("ServiceRequest.DrmService.PlaybackEnvelope.Expired"),i)throw new ct.XpError("license.envelope.refresh.loop");return o.acquireFPLicense(n,r,!0)}throw ct.XpError.generatePrefixedError(e,"license")}))}))}),e.prototype.acquireWVLicense=freeOnUnref(function(n,r,i){var o=this;return void 0===i&&(i=!1),r.requested?lt.Promise.reject(new lt.CancelError):this.prepareSessionIdentifier(r,i).then(freeOnUnref(function(e){r.throwIfRequested();var t=a({},e,{titleId:o.contentConfig.titleId,licenseChallenge:Lr.encode(n),includeHdcpTestKey:!0});return o.drmServiceClient.sendWidevine(t,r).then(freeOnUnref(function(e){return o.registerRequestEventHandlers(e),e.response()})).then(freeOnUnref(function(e){return r.throwIfRequested(),{cdmLicenseData:Lr.decode(e.license),keyMetadata:e.metadata.keyMetadata.map(s)}})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;if(q.metrics.putMetric("ServiceRequest.DrmService.License.Error"),e instanceof ct.XpError&&"drm_service.playback_envelope_expired"===e.code){if(q.metrics.putMetric("ServiceRequest.DrmService.PlaybackEnvelope.Expired"),i)throw new ct.XpError("license.envelope.refresh.loop");return o.acquireWVLicense(n,r,!0)}throw ct.XpError.generatePrefixedError(e,"license")}))}))}),e.prototype.acquirePRLicense=freeOnUnref(function(n,r,i){var o=this;return void 0===i&&(i=!1),r.requested?lt.Promise.reject(new lt.CancelError):this.prepareSessionIdentifier(r,i).then(freeOnUnref(function(e){r.throwIfRequested();var t=a({},e,{titleId:o.contentConfig.titleId,licenseChallenge:n,packagingFormat:"MPEG_DASH"});return o.drmServiceClient.sendPlayReady(t,r).then(freeOnUnref(function(e){return o.registerRequestEventHandlers(e),e.response()})).then(freeOnUnref(function(e){return r.throwIfRequested(),qr.PlayReadyLicenseTransformer.transformV2(e)})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;if(q.metrics.putMetric("ServiceRequest.DrmService.License.Error"),e instanceof ct.XpError&&"drm_service.playback_envelope_expired"===e.code){if(q.metrics.putMetric("ServiceRequest.DrmService.PlaybackEnvelope.Expired"),i)throw new ct.XpError("license.envelope.refresh.loop");return o.acquirePRLicense(n,r,!0)}throw ct.XpError.generatePrefixedError(e,"license")}))}))}),e.prototype.registerRequestEventHandlers=freeOnUnref(function(e){var t=this;e.on("latency",freeOnUnref(function(e){q.metrics.putMetric("ServiceRequest.DrmService.License.RequestLatencyTime",e,"ms")})),e.on("success",freeOnUnref(function(e){t.eventEmitter.emit("licenseAcquired",e)})),e.on("fail",freeOnUnref(function(e){t.eventEmitter.emit("licenseAcquisitionFailed",e)}))}),e.prototype.prepareSessionIdentifier=freeOnUnref(function(e,t){var n=this;return null!=this.sessionToken?lt.Promise.resolve({sessionToken:this.sessionToken}):ct.prefixPromiseError("license",lt.makeCancellable(e,this.envelopeRefreshController.getFreshEnvelope(t))).then(freeOnUnref(function(e){var t={playbackEnvelope:e.envelope};return null!=n.sessionHandoff&&(t.sessionHandoff=n.sessionHandoff),t}))}),e})();t.LicenseAcquirerV2=n}));e(Zr);Zr.LicenseAcquirerV2;var $r=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=6e4,u=de.get("PlaybackEnvelopeRefreshUtils");function c(e){return null!=e.expiration&&e.expiration<Date.now()+n}t.refreshEnvelopeWithTimeout=function(e,t,n,r){var i;void 0===r&&(r=6e3);var o=Date.now(),a=new lt.Delay(r,n),s=lt.CancelToken.source(),l=s.cancel,f=s.token;return(i=lt.Promise.race([a.promise.then(freeOnUnref(function(){throw n.throwIfRequested(),f.throwIfRequested(),l(),q.metrics.putMetric("PlaybackEnvelope.Refresh.Time",Date.now()-o,"ms"),q.metrics.putMetric("PlaybackEnvelope.Refresh.Timeout"),new ct.XpError("envelope.refresh.timeout",void 0,"Refresh")})),t(e).catch(freeOnUnref(function(e){n.throwIfRequested(),f.throwIfRequested(),l(),q.metrics.putMetric("PlaybackEnvelope.Refresh.Error");var t=function(e){switch(e){case"CUSTOMER_CONSENT_REQUIRED_DUE_TO_VPPA":return"envelope.refresh.error.vppa";case"CUSTOMER_ENTITLEMENT_CHANGED":case"CUSTOMER_NOT_ENTITLED":case"NO_ENTITLEMENT":return"envelope.refresh.error.entitlement";case"PREORDER_NOT_RELEASED":case"GEO_POLICY_REJECTION":case"FEATURE_NOT_SUPPORTED_BY_CLIENT":case"VIDEO_DEFINITION_NOT_ALLOWED":case"NOT_STREAMABLE":case"DEVICE_RESTRICTED":case"CHILD_PROFILE_AD_SUPPRESSION":case"LIVE_EVENT_PARTICIPANT_BLACKOUT":case"LIVE_EVENT_EVENT_BLACKOUT":case"LIVE_EVENT_SUSPENDED":case"LIVE_EVENT_POSTPONED":case"LIVE_EVENT_IN_FUTURE":case"LIVE_EVENT_ENDED":case"LIVE_EVENT_CANCELLED":case"LINEAR_DATA_NOT_SUPPORTED":case"TNF_REPLAY_NOT_ELIGIBLE":case"MISSING_CHILD_PRIMARY_TITLE":case"COUCH_RIGHTS_EXPIRED":case"HOME_LOCATION_RESTRICTED":case"MULTIVIEW_NOT_AVAILABLE":return"envelope.refresh.error.non_retriable";case"UNKNOWN_REASON":default:return"envelope.refresh.error"}}(e.message);throw new ct.XpError(t,void 0,void 0,!0,e)})).then(freeOnUnref(function(e){return n.throwIfRequested(),f.throwIfRequested(),l(),q.metrics.putMetric("PlaybackEnvelope.Refresh.Time",Date.now()-o,"ms"),c(e)&&u.warn("Refreshed playback envelope has stale expiration timestamp: "+e.expiration+", whereas current timestamp is "+Date.now()),e}))])).then.apply(i,lt.FINALLY(freeOnUnref(function(){a.clear()})))},t.isPlaybackEnvelopeExpired=c,t.shouldDisableUseOfExpiredPlaybackEnvelope=function(){return null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.prs&&null!=L.configurationStore.configuration.prs.disableUseOfExpiredPlaybackEnvelope&&L.configurationStore.configuration.prs.disableUseOfExpiredPlaybackEnvelope}}));e($r);$r.refreshEnvelopeWithTimeout,$r.isPlaybackEnvelopeExpired,$r.shouldDisableUseOfExpiredPlaybackEnvelope;var ei=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("PlaybackEnvelopeRefreshController"),n=freeOnUnref(function(){function e(e,t){void 0===t&&(t=1),this.lastAttemptCompletedMs=-1,this.cancelAttempt=null,this.refreshPromise=null,this.envelopeHolder=e,this.maxRefreshAttempt=t}return e.prototype.initialize=freeOnUnref(function(){}),e.prototype.uninitialize=freeOnUnref(function(){null!=this.cancelAttempt&&this.cancelAttempt(),this.refreshPromise=null,this.lastAttemptCompletedMs=0,this.cancelAttempt=null}),e.prototype.getFreshEnvelope=freeOnUnref(function(e){return null==this.envelopeHolder.playbackEnvelope?lt.Promise.reject(new ct.XpError("envelope.missing")):!this.isWithinRefreshGracePeriod()&&$r.isPlaybackEnvelopeExpired(this.envelopeHolder.playbackEnvelope)||e?this.refreshEnvelope():lt.Promise.resolve(this.envelopeHolder.playbackEnvelope)}),e.prototype.refreshEnvelope=freeOnUnref(function(){var e,o=this;if(null!=this.refreshPromise)return this.refreshPromise;var t=lt.CancelToken.source(),a=t.token,n=t.cancel;return this.cancelAttempt=n,this.refreshPromise=(e=lt.Promise.resolve().then(freeOnUnref(function(){if(a.throwIfRequested(),null==o.envelopeHolder.refreshEnvelope)throw new ct.XpError("envelope.expired");var r=0,i=freeOnUnref(function(){r++;var e=o.envelopeHolder,n=e.playbackEnvelope,t=e.refreshEnvelope;return $r.refreshEnvelopeWithTimeout(n,t,a).then(freeOnUnref(function(e){a.throwIfRequested(),s.info("Playback envelope refreshed successfully"),o.lastAttemptCompletedMs=Date.now();var t={correlationId:e.correlationId,envelope:e.envelope,expiration:e.expiration,playbackResourceType:null!=e.playbackResourceType?e.playbackResourceType:n.playbackResourceType};return o.envelopeHolder.playbackEnvelope=t})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;if(s.error("Playback envelope refresh attempt #"+r+" failed.",e),r>=o.maxRefreshAttempt){if(null!=n&&e instanceof ct.XpError&&"envelope.refresh.error"===e.code&&!$r.shouldDisableUseOfExpiredPlaybackEnvelope())return s.warn("Playback envelope refresh attempt failed, but returning expired envelop for resiliency."),q.metrics.putMetric("PlaybackEnvelope.Resilience.ExpiredEnvelope"),n;throw e}return i()}))});return s.info("Refreshing playback envelope."),i()}))).then.apply(e,lt.FINALLY(freeOnUnref(function(){o.cancelAttempt=null,o.refreshPromise=null}))),this.refreshPromise}),e.prototype.isWithinRefreshGracePeriod=freeOnUnref(function(){return this.lastAttemptCompletedMs+6e4>=Date.now()}),e})();t.PlaybackEnvelopeRefreshController=n}));e(ei);ei.PlaybackEnvelopeRefreshController;var ti=t(freeOnUnref(function(e,t){var n,r,s,l,f;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.EAC3="Codecs.EAC3",e.AACLC="Codecs.AACLC",e.AAC="Codecs.AAC",e.AACHE_V1="Codecs.AACHE_V1",e.AACHE_V2="Codecs.AACHE_V2",e.AC3="Codecs.AC3"})(s=t.AudioCodecMetrics||(t.AudioCodecMetrics={})),freeOnUnref(function(e){e.AVCMain="Codecs.AVC.Main",e.AVCBaseline="Codecs.AVC.Baseline",e.AVCHigh="Codecs.AVC.High",e.AV1Main="Codecs.AV1.Main",e.HEVCMain="Codecs.HEVC.Main",e.HEVCMain10="Codecs.HEVC.Main10",e.DVHE_STN="Codecs.DVHE_STN"})(l=t.VideoCodecMetrics||(t.VideoCodecMetrics={})),freeOnUnref(function(e){e.UNF="UNF",e.MML="MML"})(f=t.IgXStack||(t.IgXStack={})),t.IS_AUDIO_CODEC=((n={}).AACL=!0,n.EAC3=!0,n.AC3=!0,n),t.IS_VIDEO_CODEC=((r={}).AV1=!0,r.AVC=!0,r.HEVC=!0,r.DVHE=!0,r);var i=freeOnUnref(function(){function e(e){var t,n,r,i,o,a=this;this.isMMLStack=!1,this.putAV1MainMetric=freeOnUnref(function(){a.putStackMetric(l.AV1Main)}),this.putAVCMainMetric=freeOnUnref(function(){a.putStackMetric(l.AVCMain)}),this.putAVCHighMetric=freeOnUnref(function(){a.putStackMetric(l.AVCHigh)}),this.putAVCBaseLineMetric=freeOnUnref(function(){a.putStackMetric(l.AVCBaseline)}),this.putHEVCMainMetric=freeOnUnref(function(){a.putStackMetric(l.HEVCMain)}),this.putHEVCMain10Metric=freeOnUnref(function(){a.putStackMetric(l.HEVCMain10)}),this.putDVHEStnMetric=freeOnUnref(function(){a.putStackMetric(l.DVHE_STN)}),this.putAACLMetric=freeOnUnref(function(){a.putStackMetric(s.AACLC)}),this.putEAC3Metric=freeOnUnref(function(){a.putStackMetric(s.EAC3)}),this.putAC3Metric=freeOnUnref(function(){a.putStackMetric(s.AC3)}),this.GET_AUDIO_METRICS_FOR=((t={}).AACL=x.once(this.putAACLMetric),t.EAC3=x.once(this.putEAC3Metric),t.AC3=x.once(this.putAC3Metric),t),this.GET_AV1_VIDEO_CODEC_PROFILE_FN=((n={}).Main=x.once(this.putAV1MainMetric),n),this.GET_AVC_VIDEO_CODEC_PROFILE_FN=((r={}).Main=x.once(this.putAVCMainMetric),r.High=x.once(this.putAVCHighMetric),r.Baseline=x.once(this.putAVCBaseLineMetric),r),this.GET_HEVC_VIDEO_CODEC_PROFILE_FN=((i={}).Main=x.once(this.putHEVCMainMetric),i.Main10=x.once(this.putHEVCMain10Metric),i),this.GET_DVHE_VIDEO_CODEC_PROFILE_FN=((o={})["dvhe.stn"]=x.once(this.putDVHEStnMetric),o),this.isMMLStack=e===f.MML,this.metricPrefix=this.isMMLStack?"MML.":"UNF."}return e.prototype.putStackMetric=freeOnUnref(function(e){q.metrics.putMetric([this.metricPrefix,e].join(""))}),e.prototype.callFunctionIfNotNull=freeOnUnref(function(e){null!=e&&"function"==typeof e&&e()}),e.prototype.putMetricForAudio=freeOnUnref(function(e){this.GET_AUDIO_METRICS_FOR[e.codec]()}),e.prototype.putMetricForVideo=freeOnUnref(function(e){null!=e.profile&&("AV1"===e.codec?this.callFunctionIfNotNull(this.GET_AV1_VIDEO_CODEC_PROFILE_FN[e.profile]):"AVC"===e.codec?this.callFunctionIfNotNull(this.GET_AVC_VIDEO_CODEC_PROFILE_FN[e.profile]):"HEVC"===e.codec?this.callFunctionIfNotNull(this.GET_HEVC_VIDEO_CODEC_PROFILE_FN[e.profile]):"DVHE"===e.codec&&this.callFunctionIfNotNull(this.GET_DVHE_VIDEO_CODEC_PROFILE_FN[e.profile]))}),e})();t.CodecUtils=i}));e(ti);ti.AudioCodecMetrics,ti.VideoCodecMetrics,ti.IgXStack,ti.IS_AUDIO_CODEC,ti.IS_VIDEO_CODEC,ti.CodecUtils;var ni=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function t(e){this.shouldEnableCodecMetrics=!1,this.codecUtils=new ti.CodecUtils(e),this.shouldEnableCodecMetrics=null!=re.connector.clientWeblabConfig.configuration&&!0===re.connector.clientWeblabConfig.configuration[t.CODEC_METRICS_EMITTER_FEATURE_FLAG]}return t.prototype.emitCodecMetrics=freeOnUnref(function(e){this.shouldEnableCodecMetrics&&(ti.IS_AUDIO_CODEC[e.codec]&&this.codecUtils.putMetricForAudio(e),ti.IS_VIDEO_CODEC[e.codec]&&this.codecUtils.putMetricForVideo(e))}),t.CODEC_METRICS_EMITTER_FEATURE_FLAG="XP_CODEC_METRICS",t})();t.CodecMetricsEmitter=n}));e(ni);ni.CodecMetricsEmitter;var ri=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CodecMetricsEmitter=ni.CodecMetricsEmitter,t.IgXStack=ti.IgXStack}));e(ri);ri.CodecMetricsEmitter,ri.IgXStack;var ii=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("CodecCapabilities"),n=freeOnUnref(function(){function t(){this.deviceProperties=re.connector.devicePropertiesAPI,this.nativeDeviceInformation=re.connector.nativeDeviceInformationAPI}return t.prototype.dpcGetBoolProperty=freeOnUnref(function(i,e,o){var t=this;return void 0===o&&(o=!1),new lt.Promise(freeOnUnref(function(n,r){t.deviceProperties.getBoolProperty(i,e,function(e,t){e?n(t):o?("supportsSurroundSound"===i&&a.info("supportsSurroundSound callback has present=false, so assuming Surround Sound not supported"),n(!1)):r(new Error("Device property "+i+" not found"))})}))}),t.prototype.isHEVCSupported=freeOnUnref(function(){return this.dpcGetBoolProperty("supportsHEVC",!0)}),t.prototype.isHEVC10Supported=freeOnUnref(function(){return this.dpcGetBoolProperty("supportsHEVC10Bits",!0)}),t.prototype.isAV1Supported=freeOnUnref(function(){return this.dpcGetBoolProperty("supportsAV1",!0,!0)}),t.prototype.isDVHESupported=freeOnUnref(function(){var e=this;return new lt.Promise(freeOnUnref(function(n,r){e.deviceProperties.getInt32Property("hdrFlags",!1,function(e,t){e?n(t):r(new Error("Device property hdrFlags not found"))})})).then(freeOnUnref(function(e){return!!(e&t.DOLBY_VISION_FLAG)}))}),t.prototype.isSurroundSoundSupported=freeOnUnref(function(){return this.dpcGetBoolProperty("supportsSurroundSound",!1,!0)}),t.prototype.isDolbyDigitalPassthrough=freeOnUnref(function(){return this.dpcGetBoolProperty("dolbyDigitalAudioPassthroughOnly",!1)}),t.prototype.isTTSEnabled=freeOnUnref(function(){return lt.Promise.resolve(this.nativeDeviceInformation.isTTSEnabled())}),t.NATIVE_SUCCESS_CODE=0,t.SHUTDOWN_TIMEOUT=1e3,t.DOLBY_VISION_FLAG=2,t})();t.NativeDpcAdapter=n;var r=freeOnUnref(function(){function i(){this.nativeDpcAdapter=new n,this.metricsEmulator=new ri.CodecMetricsEmitter(ri.IgXStack.UNF)}return i.prototype.emitMetricAndCallHandler=freeOnUnref(function(e,t,n){t&&this.metricsEmulator.emitCodecMetrics(e),n(t)}),i.prototype.canDecodeAudio=freeOnUnref(function(t,n){var r=this;"AACL"===t.codec?this.emitMetricAndCallHandler(t,!0,n):"EAC3"===t.codec?this.nativeDpcAdapter.isSurroundSoundSupported().then(freeOnUnref(function(e){e?r.nativeDpcAdapter.isTTSEnabled().then(freeOnUnref(function(e){e?r.nativeDpcAdapter.isDolbyDigitalPassthrough().then(freeOnUnref(function(e){r.emitMetricAndCallHandler(t,!e,n)})):r.emitMetricAndCallHandler(t,!0,n)})):n(!1)})).catch(freeOnUnref(function(e){return n(!1,new Error("CodecCapabilities error, code: "+e.errorCode+" message: "+e.message))})):(a.warn("Unsupported codec: "+t.codec),n(!1))}),i.prototype.canDecodeVideo=freeOnUnref(function(t,n){var r=this;if("AVC"===t.codec){var e=l.includes(i.AVC_SUPPORT_PROFILE,t.profile);this.emitMetricAndCallHandler(t,e,n)}else if("HEVC"===t.codec){if(!l.includes(i.HEVC_SUPPORT_PROFILE,t.profile))return a.warn("Unsupported HEVC profile: "+t.profile),void n(!1);this.nativeDpcAdapter.isHEVCSupported().then(freeOnUnref(function(e){return e&&"Main10"===t.profile?r.nativeDpcAdapter.isHEVC10Supported():e})).then(freeOnUnref(function(e){r.emitMetricAndCallHandler(t,e,n)})).catch(freeOnUnref(function(e){return n(!1,new Error("CodecCapabilities error, code: "+e.errorCode+" message: "+e.message))}))}else if("DVHE"===t.codec){if(!l.includes(i.DVHE_SUPPORT_PROFILE,t.profile))return a.warn("Unsupported DVHE profile: "+t.profile),void n(!1);this.nativeDpcAdapter.isDVHESupported().then(freeOnUnref(function(e){r.emitMetricAndCallHandler(t,e,n)})).catch(freeOnUnref(function(e){return n(!1,new Error("CodecCapabilities error, code: "+e.errorCode+" message: "+e.message))}))}else if("AV1"===t.codec){if(!l.includes(i.AV1_SUPPORT_PROFILE,t.profile))return a.warn("Unsupported AV1 profile: "+t.profile),void n(!1);this.nativeDpcAdapter.isAV1Supported().then(freeOnUnref(function(e){r.emitMetricAndCallHandler(t,e,n)})).catch(freeOnUnref(function(e){return n(!1,new Error("CodecCapabilities error, code: "+e.errorCode+" message: "+e.message))}))}else a.warn("Unsupported codec: "+t.codec+" profile: "+t.profile),n(!1)}),i.AVC_SUPPORT_PROFILE=[void 0,"Main","Baseline","High"],i.HEVC_SUPPORT_PROFILE=[void 0,"Main","Main10"],i.DVHE_SUPPORT_PROFILE=[void 0,"dvhe.stn"],i.AV1_SUPPORT_PROFILE=[void 0,"Main"],i})(),i=new(t.CodecCapabilities=r);t.codecCapabilities=i}));e(ii);ii.NativeDpcAdapter,ii.CodecCapabilities,ii.codecCapabilities;var oi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.codecCapabilities=ii.codecCapabilities,t.CodecCapabilities=ii.CodecCapabilities}));e(oi);oi.codecCapabilities,oi.CodecCapabilities;var ai=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i={66:"Baseline",77:"Main",100:"High"},n=freeOnUnref(function(){function e(){}return e.prototype.parseProfile=freeOnUnref(function(e){var t=0;if(1===e.length){var n=e[0],r=n.substring(0,2);n.substring(2,4);t=parseInt(r,16)}else if(1<e.length){r=e[0],e[1],e.slice(2);t=parseInt(r)}return i[t]}),e.prototype.extractLevelIdc=freeOnUnref(function(e){if(null!=e[0]&&0!==e[0].trim().length){if(1===e.length)return e[0].substring(4);if(1<e.length){e[0];var t=e[1],n=(e.slice(2),/\d/g.test(t));if(null==t||!1===n)return;return t}}}),e.prototype.parseLevel=freeOnUnref(function(e){var t=this.extractLevelIdc(e);if(null!=t&&0!==t.trim().length){var n=parseInt(t,16);if(!isNaN(n))return(n/10).toFixed(1)}}),e})();t.AvcProfileParser=n}));e(ai);ai.AvcProfileParser;var si=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("Av1ProfileParser"),r={0:"Main",1:"High",2:"Professional"},i={0:"2.0",1:"2.1",2:"2.2",3:"2.3",4:"3.0",5:"3.1",6:"3.2",7:"3.3",8:"4.0",9:"4.1",10:"4.2",11:"4.3",12:"5.0",13:"5.1",14:"5.2",15:"5.3",16:"6.0",17:"6.1",18:"6.2",19:"6.3",20:"7.0",21:"7.1",22:"7.2",23:"7.3",30:void 0,31:void 0},n=freeOnUnref(function(){function e(){}return e.prototype.parseProfile=freeOnUnref(function(e){if(3===e.length||9===e.length){var t=e[0],n=(e[1],e[2]);e.slice(3);return"10"!==n&&o.warn("AV1 Bit depth had a value of "+n+" when 10 was expected"),r[t]}}),e.prototype.parseLevel=freeOnUnref(function(e){e[0];var t=e[1],n=(e[2],e.slice(3),void 0);return null!=t&&0!==t.length&&(n=this.extractNumberFromTierAndLevel(t,i)),n}),e.prototype.extractNumberFromTierAndLevel=freeOnUnref(function(e,t){var n=e.replace(/\D+$/g,""),r=Number(n);if(0!==n.trim().length&&!isNaN(r)){var i=t[r];return null==i&&o.warn("Failed to retrieve level for AV1 codecs, levelAndTierIdc "+e),i}o.warn("Failed to retrieve level for AV1 codecs, levelAndTierIdc "+e)}),e})();t.Av1ProfileParser=n}));e(si);si.Av1ProfileParser;var li=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={dtr:"dvhe.dtr","04":"dvhe.dtr",stn:"dvhe.stn","05":"dvhe.stn",dtb:"dvhe.dtb","07":"dvhe.dtb",st:"dvhe.st","08":"dvhe.st",se:"dvav.se","09":"dvav.se"},r={1:"01",2:"02",3:"03",4:"04",5:"05",6:"06",7:"07",8:"08",9:"09",10:"10",11:"11",12:"12",13:"13"},i=freeOnUnref(function(){function e(){}return e.prototype.parseProfile=freeOnUnref(function(e){if(1<=e.length){var t=e[0];e[1],e.slice(2);return n[t]}}),e.prototype.parseLevel=freeOnUnref(function(e){e[0];var t=e[1];e.slice(2);if(null==t||0!==t.trim().length){var n=parseFloat(t);if(!isNaN(n))return r[n]}}),e})();t.DvheProfileParser=i}));e(li);li.DvheProfileParser;var fi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("HEVCProfileParser"),n=freeOnUnref(function(){function e(){}return e.prototype.parseProfile=freeOnUnref(function(e){if(!(e.length<3)){var t=e[0],n=e[1],r=(e[2],e.slice(3),t),i=t.charAt(0);"A"!==i&&"B"!==i&&"C"!==i||(r=t.substring(1));var o,a=parseInt(r),s=parseInt(n,16);return 2!==a&&0==(4&s)||(o="Main10"),1!==a&&0==(2&s)||(o="Main"),null!=o?o:void 0}}),e.prototype.parseLevel=freeOnUnref(function(e){e[0],e[1];var t=e[2];e.slice(3);if(null!=t&&0!==t.length){var n=parseInt(t.substring(1));if(!isNaN(n))return(n/30).toFixed(1).toString();r.warn("Failed to retrieve level for HEVC codecs, levelAndTierIdc "+t)}}),e})();t.HevcProfileParser=n}));e(fi);fi.HevcProfileParser;var ui=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var i={mp4a:"AACL","ec-3":"EAC3","ac-3":"AC3"},a={hev1:"HEVC",hvc1:"HEVC",avc1:"AVC",dvhe:"DVHE",av01:"AV1"},s=((n={}).AVC=new ai.AvcProfileParser,n.DVHE=new li.DvheProfileParser,n.HEVC=new fi.HevcProfileParser,n.AV1=new si.Av1ProfileParser,n),r=freeOnUnref(function(){function e(){}return e.parseAudioCodec=freeOnUnref(function(e){var t=e.split("."),n=t[0],r=(t.slice(1),i[n]);return null==r?null:{codec:r}}),e.parseVideoCodec=freeOnUnref(function(e,t){void 0===t&&(t=!0);var n=e.split("."),r=n[0],i=n.slice(1),o=a[r];return null==o?null:t?{codec:o,profile:s[o].parseProfile(i),level:s[o].parseLevel(i)}:{codec:o}}),e})();t.CodecParser=r}));e(ui);ui.CodecParser;var ci=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CodecParser=ui.CodecParser}));e(ci);ci.CodecParser;var di=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r,i=de.get("MimeTypeParser");freeOnUnref(function(e){e[e.ParsingType=0]="ParsingType",e[e.ParsingSubtype=1]="ParsingSubtype",e[e.ParsingParameterName=2]="ParsingParameterName",e[e.StartParsingParameterValue=3]="StartParsingParameterValue",e[e.ParsingUnquotedParameterValue=4]="ParsingUnquotedParameterValue",e[e.ParsingQuotedParameterValue=5]="ParsingQuotedParameterValue",e[e.CompleteParsingParameterValue=6]="CompleteParsingParameterValue",e[e.FinishParsingNoPendingParameter=7]="FinishParsingNoPendingParameter"})(r||(r={}));var n=freeOnUnref(function(){function e(){}return e.prototype.parse=freeOnUnref(function(e){var t={text:e,index:0,parameterName:"",parameterValue:"",mimeTypeObject:{type:"",subtype:"",parameters:{}}};return this.parseMimeType(t)}),e.prototype.parseMimeType=freeOnUnref(function(e){for(var t=r.ParsingType;e.index<e.text.length;)switch(t){case r.ParsingType:t=this.parseType(e);break;case r.ParsingSubtype:t=this.parseSubtype(e);break;case r.ParsingParameterName:t=this.parseParameterName(e);break;case r.StartParsingParameterValue:t=this.handleStartParsingParameterValue(e);break;case r.CompleteParsingParameterValue:t=this.handleCompleteParsingParameterValue(e)}return this.handleEndParsing(e,t),e.mimeTypeObject}),e.prototype.parseType=freeOnUnref(function(e){var t=e.text.indexOf("/");if(0<t)return e.mimeTypeObject.type=e.text.substring(e.index,t).trim(),e.index=t+1,r.ParsingSubtype;throw new Error('Encountered malformed top type while parsing "'+e.text.substring(e.index)+'".')}),e.prototype.parseSubtype=freeOnUnref(function(e){var t=e.text.indexOf(";",e.index);return 0<t?(e.mimeTypeObject.subtype=this.extractSubtype(e,t),e.index=t+1,r.ParsingParameterName):(e.mimeTypeObject.subtype=this.extractSubtype(e),e.index=e.text.length,r.FinishParsingNoPendingParameter)}),e.prototype.extractSubtype=freeOnUnref(function(e,t){var n=e.text.substring(e.index,t).trim();if(0===n.length)throw new Error('Encountered empty subtype while parsing "'+e.text.substring(e.index)+'".');return n}),e.prototype.parseParameterName=freeOnUnref(function(e){var t=e.text.indexOf("=",e.index);return t>e.index?(e.parameterName=this.extractParameterName(e,t),0===e.parameterName.length?(e.index=e.text.length,r.FinishParsingNoPendingParameter):(e.index=t+1,r.StartParsingParameterValue)):(i.warn('Encountered malformed parameter name while parsing "'+e.text.substring(e.index)+'".'),e.index=e.text.length,r.FinishParsingNoPendingParameter)}),e.prototype.extractParameterName=freeOnUnref(function(e,t){var n=e.text.substring(e.index,t).trim();return 0===n.length?(i.warn('Encountered empty parameter name while parsing "'+e.text.substring(e.index)+'".'),n):-1!==n.indexOf(";")?(i.warn('Encountered malformed parameter name while parsing "'+e.text.substring(e.index)+'".'),""):n}),e.prototype.handleStartParsingParameterValue=freeOnUnref(function(e){if('"'===e.text[e.index]){e.index++;var t=e.text.indexOf('"',e.index);return t>=e.index?(e.parameterValue=e.text.substring(e.index,t),e.index=t+1,r.CompleteParsingParameterValue):(i.warn('Encountered unbalanced quotation when parsing "'+e.text.substring(e.index)+'".'),r.StartParsingParameterValue)}var n=e.text.indexOf(";",e.index);return n<0&&(n=e.text.length),e.parameterValue=this.extractUnquotedParameterValue(e,n),e.index=n,r.CompleteParsingParameterValue}),e.prototype.extractUnquotedParameterValue=freeOnUnref(function(e,t){var n=e.text.substring(e.index,t).trim();return 0===n.length&&(i.warn('Encountered empty parameter value while parsing "'+e.text.substring(e.index)+'".'),n=""),n}),e.prototype.handleCompleteParsingParameterValue=freeOnUnref(function(e){var t=e.text.indexOf(";",e.index);if(t===e.index)return this.commitNameValuePair(e),e.index++,r.ParsingParameterName;if(t<0&&0===e.text.substring(e.index).trim().length)return this.commitNameValuePair(e),e.index=e.text.length,r.FinishParsingNoPendingParameter;throw new Error('Expected character: ";", but encountered: "'+e.text[e.index]+'", when completing parsing of a parameter value of text "'+e.text+'".')}),e.prototype.handleEndParsing=freeOnUnref(function(e,t){switch(t){case r.CompleteParsingParameterValue:this.commitNameValuePair(e);break;case r.StartParsingParameterValue:e.parameterValue="",this.commitNameValuePair(e);break;case r.FinishParsingNoPendingParameter:case r.ParsingParameterName:break;default:throw new Error("Ended in an invalid state: "+r[t]+', when parsing MIME type "'+e.text+'".')}}),e.prototype.commitNameValuePair=freeOnUnref(function(e){e.mimeTypeObject.parameters[e.parameterName]=e.parameterValue}),e})();t.MimeTypeParser=n}));e(di);di.MimeTypeParser;var pi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MimeTypeParser=di.MimeTypeParser}));e(pi);pi.MimeTypeParser;var hi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("MediaCapabilitiesCodec");var n=freeOnUnref(function(){function e(){var n=this;this.canDecodeAudio=freeOnUnref(function(e,t){n.codecCapabilities.canDecodeAudio(e,t)}),this.canDecodeVideo=freeOnUnref(function(e,t){n.codecCapabilities.canDecodeVideo(e,t)}),this.mimeTypeParser=new pi.MimeTypeParser,this.codecCapabilities=oi.codecCapabilities}return e.prototype.decodingInfo=freeOnUnref(function(e){var t,n;return t=Qe.exists(e.video)?this.isMediaSupported(e.video.contentType,ci.CodecParser.parseVideoCodec,this.canDecodeVideo):lt.Promise.resolve(!0),n=Qe.exists(e.audio)?this.isMediaSupported(e.audio.contentType,ci.CodecParser.parseAudioCodec,this.canDecodeAudio):lt.Promise.resolve(!0),lt.Promise.all([t,n]).then(freeOnUnref(function(e){var t=e[0],n=e[1];return t&&n}))}),e.prototype.isMediaSupported=freeOnUnref(function(e,n,r){var i=this,t=this.mimeTypeParser.parse(e).parameters.codecs;if(Qe.isNullOrUndefined(t))return lt.Promise.resolve(!1);var o=t.split(",").map(freeOnUnref(function(e){return e.trim()})).map(freeOnUnref(function(e){var t=n(e);return Qe.isNullOrUndefined(t)?lt.Promise.resolve(!1):i.promisifyCanDecodeMethod(t,r)}));return lt.Promise.all(o).then(freeOnUnref(function(e){return e.every(freeOnUnref(function(e){return e}))}))}),e.prototype.promisifyCanDecodeMethod=freeOnUnref(function(e,t){return new lt.Promise(freeOnUnref(function(n,r){t(e,freeOnUnref(function(e,t){Qe.exists(t)?r(t):n(e)}))}))}),e})();t.MediaCapabilitiesCodec=n}));e(hi);hi.MediaCapabilitiesCodec;var mi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaCapabilities=hi.MediaCapabilitiesCodec}));e(mi);mi.MediaCapabilities;var yi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=re.connector.devicePropertiesAPI),this.nativeDeviceInformation=re.connector.nativeDeviceInformationAPI,this.deviceProperties=e}return e.prototype.isTTSEnabled=freeOnUnref(function(){return lt.Promise.resolve(this.nativeDeviceInformation.isTTSEnabled())}),e.prototype.isDolbyDigitalPassthrough=freeOnUnref(function(i){var e=this;return void 0===i&&(i=!1),new lt.Promise(freeOnUnref(function(n,r){e.deviceProperties.getBoolProperty("dolbyDigitalAudioPassthroughOnly",!1,function(e,t){e?n(t):i?n(!1):r(new Error("Device property dolbyDigitalAudioPassthroughOnly not found"))})}))}),e})();t.DeviceCapabilitiesHelper=n}));e(yi);yi.DeviceCapabilitiesHelper;var gi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var d=de.get("MMLMediaCapabilitiesCodec"),n=freeOnUnref(function(){function e(e,t,n,r){void 0===e&&(e=new pi.MimeTypeParser),void 0===t&&(t=T.getInstanceManager()),void 0===n&&(n=new yi.DeviceCapabilitiesHelper),void 0===r&&(r=new ri.CodecMetricsEmitter(ri.IgXStack.MML)),this.mimeTypeParser=e,this.instanceManager=t,this.deviceCapabilitiesHelper=n,this.codecMetrics=r}return e.prototype.decodingInfo=freeOnUnref(function(e){var t,n;return t=null!=e.audio?this.canDecodeAudio(e.audio):lt.Promise.resolve(!0),n=null!=e.video?this.canDecodeVideo(e.video):lt.Promise.resolve(!0),lt.Promise.all([t,n]).then(freeOnUnref(function(e){var t=e[0],n=e[1];return t&&n}))}),e.prototype.emitMetricAndResolvePromise=freeOnUnref(function(e,t){return t&&this.codecMetrics.emitCodecMetrics(e),lt.Promise.resolve(t)}),e.prototype.canDecodeVideo=freeOnUnref(function(f){var u=this,e=f.contentType,c=this.getMimeType(e),t=c.parameters.codecs.split(",").map(freeOnUnref(function(e){return e.trim()})).map(freeOnUnref(function(e){var t=ci.CodecParser.parseVideoCodec(e);if(null==t)return d.warn("Failed to parse video codec: "+e),lt.Promise.resolve(!1);if(null==t.profile||null==t.level){var n="Failed to retrieve video codec profile: "+t.profile+" or level: "+t.level+" for codec: "+e;return d.error(n),lt.Promise.reject(new Error(n))}var r=u.getDecimalFramerate(f.framerate);if(null==r){n="Failed to extract decimal value from framerate "+f.framerate+" as "+r+" is not a number";return d.error(n),lt.Promise.reject(new Error(n))}var i=[e,""+f.width,""+f.height,""+f.bitrate,r,""+t.profile,""+t.level],o={mimeType:c.type,mimeSubType:c.subtype,mimeAttributeKeys:["codecs","width","height","bitrate","framerate","profile","level"],mimeAttributeValues:i},a=u.instanceManager.canDecodeMedia(o);if(a.error_code!==p.MPBErrors.OK)return lt.Promise.reject(new Error("Error while retrieving video codec query "+JSON.stringify(o)+", error code: "+a.error_code));if("DVHE"===t.codec){var s=u.isDVHESupported()&&a.is_supported&&a.is_smooth;return u.emitMetricAndResolvePromise(t,s)}var l=a.is_supported&&a.is_smooth;return u.emitMetricAndResolvePromise(t,l)}));return lt.Promise.all(t).then(freeOnUnref(function(e){return e.every(freeOnUnref(function(e){return e}))}))}),e.prototype.canDecodeAudio=freeOnUnref(function(s){var l=this,e=s.contentType,f=this.getMimeType(e),t=f.parameters.codecs.split(",").map(freeOnUnref(function(e){return e.trim()})).map(freeOnUnref(function(e){var t=ci.CodecParser.parseAudioCodec(e);if(null==t)return d.warn("Failed to parse audio codec: "+e),lt.Promise.resolve(!1);if(null==s.bitrate||null==s.samplerate){var n="Cannot decode audio codec without bitrate: "+s.bitrate+" or samplerate: "+s.samplerate+" for codec: "+e;return d.error(n),lt.Promise.reject(new Error(n))}if(null==s.channels){var r=l.getNumberOfChannels(t);if(""===r){n="Cannot decode audio codec without channels: "+s.channels+" for codec: "+e;return d.error(n),lt.Promise.reject(new Error(n))}s.channels=r}var i={mimeType:f.type,mimeSubType:f.subtype,mimeAttributeKeys:["codecs","channels","bitrate","samplerate"],mimeAttributeValues:[e,""+s.channels,""+s.bitrate,""+s.samplerate]},o=l.instanceManager.canDecodeMedia(i);if(o.error_code!==p.MPBErrors.OK)return lt.Promise.reject(new Error("Error while retrieving audio codec "+JSON.stringify(i)+" querier: "+o.error_code));if("EAC3"===t.codec)return l.isEAC3Supported(o).then(freeOnUnref(function(e){return l.emitMetricAndResolvePromise(t,e)}));var a=o.is_supported&&o.is_smooth;return l.emitMetricAndResolvePromise(t,a)}));return lt.Promise.all(t).then(freeOnUnref(function(e){return e.every(freeOnUnref(function(e){return e}))}))}),e.prototype.getNumberOfChannels=freeOnUnref(function(e){switch(e.codec){case"AACL":return"2.0";case"EAC3":return"5.1";default:return""}}),e.prototype.isEAC3Supported=freeOnUnref(function(t){var n=this;if(!1===t.is_supported)return lt.Promise.resolve(t.is_supported);var r=!1;return this.deviceCapabilitiesHelper.isTTSEnabled().then(freeOnUnref(function(e){return r=e,n.deviceCapabilitiesHelper.isDolbyDigitalPassthrough()})).then(freeOnUnref(function(e){return lt.Promise.resolve(!(!0!==t.is_supported||!0!==t.is_smooth||r&&e))}))}),e.prototype.isDVHESupported=freeOnUnref(function(){return-1!==zt.deviceCapabilities.output.video.display.dynamicRangeFormatSupport.indexOf("DolbyVision")}),e.prototype.getMimeType=freeOnUnref(function(e){return this.mimeTypeParser.parse(e)}),e.prototype.getDecimalFramerate=freeOnUnref(function(e){var t=In.stringToNumber(e);if(!isNaN(t))return t.toFixed(3)}),e})();t.MediaCapabilitiesCodec=n}));e(gi);gi.MediaCapabilitiesCodec;var vi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaCapabilities=gi.MediaCapabilitiesCodec}));e(vi);vi.MediaCapabilities;var Oi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("GenericInterceptor"),l="mmlEnabled";t.MML_ENABLED_KEY=l;var f="minNativeVersion";function u(e,t){return 0<=e.localeCompare(t,"en-US",{numeric:!0,sensitivity:"base"})}function a(e,t,n,r){if(void 0===e&&(e=re.isUNFSupported),void 0===t&&(t=T.isMMLSupported),void 0===n&&(n=zt.deviceInformation),void 0===r&&(r=L.configurationStore.configuration),!e&&!t)throw new Error("UNF and MML are unsupported so playback is not possible");if(!e&&t)return!0;if(e&&!t)return!1;if(null==r)return s.warn("Both UNF and MML supported but XP Config was "+r+" - falling back to MML"),!0;var i=function(e,t){var n=Qe.nestedValue(t,["device",l]);if(null!=n){if("boolean"==typeof n)return n;var r=Qe.nestedValue(e,"hardware.model.name");if(null!=r){var i=n[r];if(null!=i){if("boolean"==typeof i)return i;if("object"==typeof i){var o=Qe.nestedValue(e,"software.middleware.version"),a=i[f];if(null!=o&&"string"==typeof o&&null!=a&&"string"==typeof a)return u(o,a)}s.error("Provided MML override in XP config malformed "+JSON.stringify(n)+", falling back to default playback stack")}}else s.error("Model name could not be retrieved from device information "+JSON.stringify(e)+", falling back to default playback stack")}}(n,r);return null==i||i}t.MIN_NATIVE_VERSION_KEY=f,t.chooseImplementation=function(e,t,n,r,i,o){return void 0===n&&(n=re.isUNFSupported),void 0===r&&(r=T.isMMLSupported),void 0===i&&(i=zt.deviceInformation),void 0===o&&(o=L.configurationStore.configuration),a(n,r,i,o)?t:e},t.isAtLeastMinimumVersion=u,t.isMMLEnabled=a}));e(Oi);Oi.MML_ENABLED_KEY,Oi.MIN_NATIVE_VERSION_KEY,Oi.chooseImplementation,Oi.isAtLeastMinimumVersion,Oi.isMMLEnabled;var Si=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.chooseImplementation=Oi.chooseImplementation,t.isMMLEnabled=Oi.isMMLEnabled}));e(Si);Si.chooseImplementation,Si.isMMLEnabled;var Ui=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("MediaCapabilitiesInterceptor"),r=freeOnUnref(function(){function e(e,t,n,r,i,o){void 0===e&&(e=mi.MediaCapabilities),void 0===t&&(t=vi.MediaCapabilities),void 0===n&&(n=re.isUNFSupported),void 0===r&&(r=Si.isMMLEnabled),void 0===i&&(i=Qe.nestedValue(re.connector,"clientWeblabConfig.configuration")),void 0===o&&(o=T.getInstanceManager),this.UNFMediaCapabilities=e,this.MMLMediaCapabilities=t,this.isUNFSupported=n,this.isMMLEnabled=r,this.clientConfig=i,this.getMMLInstanceManager=o,this.realMediaCaps=null}return e.prototype.decodingInfo=freeOnUnref(function(e){if(null==this.realMediaCaps){var t=null!=this.clientConfig&&!1===this.clientConfig[p.MML_CLIENT_FEATURE_FLAG];!1===this.isUNFSupported?(n.warn("UNF unsupported - using MML media capabilities"),this.realMediaCaps=new this.MMLMediaCapabilities):this.isMMLEnabled()&&!t&&this.getMMLInstanceManager().isCanDecodeMediaSupported()?(n.info("Using MML media capabilities"),this.realMediaCaps=new this.MMLMediaCapabilities):(n.info("Using UNF media capabilities"),this.realMediaCaps=new this.UNFMediaCapabilities)}return this.realMediaCaps.decodingInfo(e)}),e})();t.MediaCapabilitiesInterceptor=r}));e(Ui);Ui.MediaCapabilitiesInterceptor;var bi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mediaCapabilities=new Ui.MediaCapabilitiesInterceptor}));e(bi);bi.mediaCapabilities;var Pi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("XpMediaCapabilitiesProxy"),n=freeOnUnref(function(){function e(){this.diagnostics=nn.Diagnostics.create("XpMediaCapabilitiesProxy"),this.pendingRequests=0}return e.prototype.decodingInfo=freeOnUnref(function(e){var t,n=this,r=oe.timer.setTimeout(freeOnUnref(function(){i.warn("MediaCapabilities request for "+JSON.stringify(e)+" stalled for 10000ms")}),1e4);return this.pendingRequests++,this.diagnostics.report("state",{pendingRequests:this.pendingRequests,timestamp:Date.now()}),(t=bi.mediaCapabilities.decodingInfo(e)).then.apply(t,lt.FINALLY(freeOnUnref(function(){oe.timer.clearTimeout(r),n.pendingRequests--,n.diagnostics.report("state",{pendingRequests:n.pendingRequests,timestamp:Date.now()})})))}),e})();t.XpMediaCapabilitiesProxy=n}));e(Pi);Pi.XpMediaCapabilitiesProxy;var Mi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=new Pi.XpMediaCapabilitiesProxy;t.mediaCapabilities=n}));e(Mi);Mi.mediaCapabilities;var Ci=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={video:{"avc1.4D4016":"H264","hev1.1.6.L63.90":"H265","av01.0.00M.10":"AV1"},audio:{"mp4a.40.2":"AAC","ac-3":"AC3","ec-3":"EC3"}};t.playerAttributesCodecs=n}));e(Ci);Ci.playerAttributesCodecs;var Ei=t(freeOnUnref(function(e,t){var o=ce&&ce.__assign||freeOnUnref(function(){return(o=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n={video:{contentType:"video/mp4; codecs=",width:90,height:160,bitrate:1e5,framerate:"24"}},r={audio:{contentType:"audio/mp4; codecs=",channels:"2.0",bitrate:1e5,samplerate:44100}},i=freeOnUnref(function(){function e(){}return e.querySupportedVideoCodecs=freeOnUnref(function(){return e.queryMediaTypeCodecs(Object.keys(Ci.playerAttributesCodecs.video),n,"video").then(freeOnUnref(function(e){return e.map(freeOnUnref(function(e){return Ci.playerAttributesCodecs.video[e]}))}))}),e.querySupportedAudioCodecs=freeOnUnref(function(){return e.queryMediaTypeCodecs(Object.keys(Ci.playerAttributesCodecs.audio),r,"audio").then(freeOnUnref(function(e){return e.map(freeOnUnref(function(e){return Ci.playerAttributesCodecs.audio[e]}))}))}),e.queryMediaTypeCodecs=freeOnUnref(function(e,r,i){var t=e.map(freeOnUnref(function(e){var t,n=((t={})[i]=o({},r[i],{contentType:r[i].contentType+'"'+e+'"'}),t);return Mi.mediaCapabilities.decodingInfo(n)}));return lt.Promise.all(t).then(freeOnUnref(function(n){return e.filter(freeOnUnref(function(e,t){return n[t]}))}))}),e})();t.CodecsQuerier=i}));e(Ei);Ei.CodecsQuerier;var Ti=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.AVC_CODEC_LADDER={codecStrings:["avc1.640034","avc1.640033","avc1.64002A","avc1.64001F","avc1.64001E","avc1.640016"],codecLevels:[5.2,5.1,4.2,3.1,3,2.2]}}));e(Ti);Ti.AVC_CODEC_LADDER;var wi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.DVHE_CODEC_LADDER={codecStrings:["dvhe.05.08","dvhe.05.06","dvhe.05.05","dvhe.05.01","dvhe.05.01","dvhe.05.01"],codecLevels:[8,6,5,1,1,1]}}));e(wi);wi.DVHE_CODEC_LADDER;var Ii=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.HEVC_MAIN_CODEC_LADDER={codecStrings:["hev1.1.6.L153.90","hev1.1.6.L150.90","hev1.1.6.L120.90","hev1.1.6.L93.90","hev1.1.6.L90.90","hev1.1.6.L63.90"],codecLevels:[5.1,5,4,3.1,3,2.1]}}));e(Ii);Ii.HEVC_MAIN_CODEC_LADDER;var ki=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.HEVC_MAIN_10_CODEC_LADDER={codecStrings:["hev1.2.4.L153.90","hev1.2.4.L150.90","hev1.2.4.L120.90","hev1.2.4.L93.90","hev1.2.4.L90.90","hev1.2.4.L63.90"],codecLevels:[5.1,5,4,3.1,3,2.1]}}));e(ki);ki.HEVC_MAIN_10_CODEC_LADDER;var _i=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.AV1_MAIN_CODEC_LADDER={codecStrings:["av01.0.13M.10","av01.0.12M.10","av01.0.09M.10","av01.0.08M.10","av01.0.05M.10","av01.0.04M.10"],codecLevels:[5.1,5,4.1,4,3.1,3]}}));e(_i);_i.AV1_MAIN_CODEC_LADDER;var Ri=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={codecStrings:[],codecLevels:[]},r={H264:{sdr:Ti.AVC_CODEC_LADDER,hdr:{HDR10:n,DolbyVision:n}},H265:{sdr:Ii.HEVC_MAIN_CODEC_LADDER,hdr:{HDR10:ki.HEVC_MAIN_10_CODEC_LADDER,DolbyVision:wi.DVHE_CODEC_LADDER}},AV1:{sdr:_i.AV1_MAIN_CODEC_LADDER,hdr:{HDR10:n,DolbyVision:n}}};t.VIDEO_CODEC_LADDER=r}));e(Ri);Ri.VIDEO_CODEC_LADDER;var Ai=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var p={H264:"H264",H265:"H265",AV1:"AV1"},h={HDR10:"Hdr10",DolbyVision:"DolbyVision"},r=["V2_2","NoDigitalOutput"],l=["V2_2","NoDigitalOutput"],m=de.get("VideoCapabilityParameterConverter"),n=freeOnUnref(function(){function e(){this.deviceCapabilities=zt.deviceCapabilities;var e=null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.codecQuerier&&!0===L.configurationStore.configuration.codecQuerier.disableUhdSfrOverride;this.videoCapabilityOverrideLadder=[{videoQuality:"UHD",frameRate:"HFR"},{videoQuality:"UHD",frameRate:e?"SFR":"HFR"},{videoQuality:"HD",frameRate:"HFR"},{videoQuality:"HD",frameRate:"SFR"},{videoQuality:"SD",frameRate:"HFR"},{videoQuality:"SD",frameRate:"SFR"}]}return e.prototype.convert=freeOnUnref(function(r,i){for(var o={H264:{codecLevel:0,hdrFormats:[]},H265:{codecLevel:0,hdrFormats:[]},AV1:{codecLevel:0,hdrFormats:[]}},a=null,s=[],l=null,e=Object.keys(r),t=freeOnUnref(function(e){var t=f.calculateSdrCodecIndex(e,r);null!=t&&(o[e].codecLevel=Ri.VIDEO_CODEC_LADDER[e].sdr.codecLevels[t]),null!=t&&(null==a||t<a)&&(a=t);var n=x.mapObject(r[e].hdr,freeOnUnref(function(e){return null!=e&&null!=t&&e<=t}));o[e].hdrFormats=f.createDynamicRangeCapabilities(n,i),"AV1"===e&&null!=t&&a===t&&s.push(p[e]),"H265"===e&&null!=t&&a===t&&(s.push(p[e]),l=o[e].hdrFormats.map(freeOnUnref(function(e){return h[e]})))}),f=this,n=0,u=e;n<u.length;n++){t(u[n])}var c=null!=a?this.videoCapabilityOverrideLadder[a].videoQuality:"SD",d=null!=a?this.videoCapabilityOverrideLadder[a].frameRate:"SFR";return null!==l&&0!==l.length||(l=["None"]),null===a&&m.error("No Video codec indicated support. Setting H264 as supported."),s.push("H264"),{videoQuality:c,frameRate:d,hdrFormats:l,videoCodec:s,videoDecodeCapabilities:this.flattenVideoDecodeCapabilities(o)}}),e.prototype.createDynamicRangeCapabilities=freeOnUnref(function(e,t){var n=this.deviceCapabilities.output.video.display.dynamicRangeFormatSupport,r=this.deviceCapabilities.output.video.display.hdcpStatus;if(0===n.length||-1===l.indexOf(r))return[];for(var i=[],o=0,a=Object.keys(e);o<a.length;o++){var s=a[o];!(e[s]&&-1<n.indexOf(s))||null!=t&&-1!==t.indexOf(s)||null!=t&&"HDR10"===s&&-1!==t.indexOf("HDR10Plus")||i.push(s)}return i}),e.prototype.flattenVideoDecodeCapabilities=freeOnUnref(function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],o=e[i];t[i+".codecLevel"]=o.codecLevel.toFixed(1),0<o.hdrFormats.length&&(t[i+".hdrFormats"]=o.hdrFormats)}return t}),e.prototype.calculateSdrCodecIndex=freeOnUnref(function(e,t){var n=t[e].sdr;null!=n&&"H264"===e&&n<2&&(n=2);var r=this.displayCapabilityToCodecLadderIndex();return null!=n&&n<r&&(n=r),n}),e.prototype.displayCapabilityToCodecLadderIndex=freeOnUnref(function(){var e=this.deviceCapabilities.output.video.display.height,t=this.deviceCapabilities.output.video.display.hdcpStatus,n=!1!==this.deviceCapabilities.obeysLicensePoliciesForHDCP;return 1080<e&&-1<r.indexOf(t)?0:480<e&&(n||-1<["V1","V2_2","NoDigitalOutput"].indexOf(t))?2:4}),e})();t.VideoCapabilityParameterConverter=n}));e(Ai);Ai.VideoCapabilityParameterConverter;var Di=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.newEmptyTopCodecLevelIndexItem=function(){return{sdr:null,hdr:{DolbyVision:null,HDR10:null}}}}));e(Di);Di.newEmptyTopCodecLevelIndexItem;var xi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.newEmptyTopLevelIndex=function(){return{H264:Di.newEmptyTopCodecLevelIndexItem(),H265:Di.newEmptyTopCodecLevelIndexItem(),AV1:Di.newEmptyTopCodecLevelIndexItem()}}}));e(xi);xi.newEmptyTopLevelIndex;var Fi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=Qe,c=de.get("VideoCodecsQuerier"),r=[{video:{contentType:"",width:3840,height:2160,bitrate:12e5,framerate:"50"}},{video:{contentType:"",width:3840,height:2160,bitrate:1e6,framerate:"24"}},{video:{contentType:"",width:1280,height:720,bitrate:5e5,framerate:"50"}},{video:{contentType:"",width:1280,height:720,bitrate:3e5,framerate:"24"}},{video:{contentType:"",width:720,height:480,bitrate:25e4,framerate:"50"}},{video:{contentType:"",width:720,height:480,bitrate:2e5,framerate:"24"}}],n=freeOnUnref(function(){function e(){this.cachedCodecIndex=null}return e.prototype.querySupportedCapabilities=freeOnUnref(function(){var o=this;if(null!==this.cachedCodecIndex)return lt.Promise.resolve(Qe.deepClone(this.cachedCodecIndex));for(var a=xi.newEmptyTopLevelIndex(),e=Object.keys(Ri.VIDEO_CODEC_LADDER),t=["H264","H265"].concat(this.getAdditionalCodecsToQuery(e)),n=x.uniq(t),s=[],r=Date.now(),i=freeOnUnref(function(r){for(var i=l.queryConfigs(Ri.VIDEO_CODEC_LADDER[r].sdr.codecStrings),e=freeOnUnref(function(t){var n=Ri.VIDEO_CODEC_LADDER[r].hdr[t].codecStrings,e=void 0;e=0!==n.length?i.then(freeOnUnref(function(e){return a[r].sdr=e,o.querySingleConfig(e,n)})).then(freeOnUnref(function(e){e&&(a[r].hdr[t]=a[r].sdr)})).catch(freeOnUnref(function(){})):i.then(freeOnUnref(function(e){a[r].sdr=e})),s.push(e)}),t=0,n=Object.keys(Ri.VIDEO_CODEC_LADDER[r].hdr);t<n.length;t++){e(n[t])}}),l=this,f=0,u=n;f<u.length;f++){i(u[f])}return lt.Promise.all(s).then(freeOnUnref(function(){return c.info("Query duration: "+(Date.now()-r)+" ms"),o.cachedCodecIndex=a,Qe.deepClone(o.cachedCodecIndex)}))}),e.prototype.clearCache=freeOnUnref(function(){this.cachedCodecIndex=null}),e.prototype.getAdditionalCodecsToQuery=freeOnUnref(function(t){var e=[],n=L.configurationStore.configuration;if(null!=n&&null!=n.capabilities&&null!=n.capabilities.additionalCodecEnableList&&null!=n.capabilities.additionalCodecEnableList.Video){var r=n.capabilities.additionalCodecEnableList.blockedDeviceModels;if(null!=r){var i=f.nestedValue(zt.deviceInformation,"hardware.model.name");if(null!=i&&-1!==r.indexOf(i))return[]}var o=n.capabilities.additionalCodecEnableList.allowByFirmwareVersion;if(null!=o&&null!=o.firmwareVersionRegex&&null!=o.minFirmwareVersion){var a=o.firmwareVersionRegex,s=this.getDeviceFirmwareVersion(a);if(null==s)return[];var l=o.minFirmwareVersion;if(!this.isMinFirmwareVersion(s,l))return[]}e=n.capabilities.additionalCodecEnableList.Video.filter(freeOnUnref(function(e){return-1<t.indexOf(e)}))}return e}),e.prototype.getDeviceFirmwareVersion=freeOnUnref(function(e){var t=f.nestedValue(zt.deviceInformation,"software.firmware.version");if(null==t)return null;var n=new RegExp(e),r=t.match(n);return null==r||!1===Array.isArray(r)||0===r.length?null:r[0]}),e.prototype.isMinFirmwareVersion=freeOnUnref(function(e,t){return 0<=e.localeCompare(t,"en-US",{numeric:!0,sensitivity:"base"})}),e.prototype.queryConfigs=freeOnUnref(function(e){return this.queryConfigIndexStartingAt(0,e)}),e.prototype.queryConfigIndexStartingAt=freeOnUnref(function(t,n){var r=this;return 5<t?lt.Promise.resolve(null):this.querySingleConfig(t,n).then(freeOnUnref(function(e){return e?t:r.queryConfigIndexStartingAt(t+1,n)}))}),e.prototype.querySingleConfig=freeOnUnref(function(e,t){if(null==e)return lt.Promise.resolve(!1);var n={video:Qe.deepClone(r[e].video)};return n.video.contentType='video/mp4; codecs="'+t[e]+'"',Mi.mediaCapabilities.decodingInfo(n)}),e})();t.VideoCodecsQuerier=n}));e(Fi);Fi.VideoCodecsQuerier;var Bi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CodecsQuerier=Ei.CodecsQuerier,t.VideoCapabilityParameterConverter=Ai.VideoCapabilityParameterConverter,t.VideoCodecsQuerier=Fi.VideoCodecsQuerier}));e(Bi);Bi.CodecsQuerier,Bi.VideoCapabilityParameterConverter,Bi.VideoCodecsQuerier;var Li=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("MediaKeySessionManager");var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a){var s=this;this.eventEmitter=new A.EventEmitter,this.generateRequestStart=null,this.licenseRequestNumber=0,this.onMessageEvent=freeOnUnref(function(e){var t=s.sessionId;try{switch(e.messageType){case"license-request":s.licenseRequestNumber++,s.reportGenerateLicenseRequestTime(s.generateRequestStart);var n=e.message,r=new Date;s.requestLicense(new Uint8Array(n),r,s.licenseRequestNumber);break;case"certificate-request":u.warn("["+t+"] 'certificate-request' received. Not handled.");break;case"key-id-request":u.warn("["+t+"] 'key-id-request' received. Not handled.");break;case"license-renewal":case"license-release":case"individualization-request":u.warn("["+t+"] Unexpected media key message:",e.messageType);break;default:!function(e){throw new ct.XpError("media_key_session.invalid_message_type",void 0,"Reached code that should not be reachable")}(e.messageType)}}catch(e){u.error("["+t+"] MediaKeySession 'message' handler error:",e),s.onSessionError(e)}}),this.onKeyStatusesChange=freeOnUnref(function(){try{s.mediaKeySession.keyStatuses.forEach(freeOnUnref(function(e,t){var n=Lr.encode(t),r="["+s.sessionId+"] [keystatuschange] keyId:"+n+"; keyStatus:"+e;"internal-error"===e?(u.error(r),s.onSessionError(new ct.XpError("internal_error"))):u.info(r),s.eventEmitter.emit("keyStatusChange",{keyId:n,status:e})}))}catch(e){u.error("["+s.sessionId+"] MediaKeySession 'keystatuseschange' handler error:",e),s.onSessionError(e)}}),this.mediaKeySession=e,this.desiredType=t,this.actualType=n,this.mimeType=a,this.getLicenseData=null,this.onSessionError=r,this.hdcpStore=i,this.traceEventController=o,this.sessionInitializationPromises=[],this.diagnostics=nn.Diagnostics.create("MediaKeySessionManager")}return e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),Object.defineProperty(e.prototype,"expiration",{get:freeOnUnref(function(){return this.mediaKeySession.expiration}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:freeOnUnref(function(){return this.mediaKeySession.sessionId}),enumerable:!0,configurable:!0}),e.prototype.initialize=freeOnUnref(function(){this.mediaKeySession.on("message",this.onMessageEvent),this.mediaKeySession.on("keystatuseschange",this.onKeyStatusesChange),this.mediaKeySession.on("keystatuseschange",this.hdcpStore.updateHdcpStatus)}),e.prototype.terminate=freeOnUnref(function(e){var t=this;void 0===e&&(e=!1);var n=this.mediaKeySession;return n.off("message",this.onMessageEvent),n.off("keystatuseschange",this.onKeyStatusesChange),n.off("keystatuseschange",this.hdcpStore.updateHdcpStatus),lt.Promise.all(this.sessionInitializationPromises).catch(freeOnUnref(function(e){u.warn("["+t.sessionId+"] session initialization promise rejected while awaiting to close session. Ignoring and closing anyway.",e)})).then(freeOnUnref(function(){return t.sessionInitializationPromises=[],"persistent-license"!==t.desiredType&&"persistent-license"===t.actualType?(u.info("["+t.sessionId+"] session was created as "+t.actualType+" when a "+t.desiredType+" session was desired. Removing license data."),t.mediaKeySession.remove().catch(freeOnUnref(function(e){u.warn("Failed to remove license for session "+t.mediaKeySession.sessionId+". Ignoring and closing anyway.",e)}))):"persistent-license"===t.desiredType&&"persistent-license"===t.actualType&&e?(u.info("["+t.sessionId+"] force removing license data due to error in persistent session."),t.mediaKeySession.remove().catch(freeOnUnref(function(e){u.warn("Failed to remove license for session "+t.mediaKeySession.sessionId+". Ignoring and closing anyway.",e)}))):void u.info("["+t.sessionId+"] session was created as "+t.actualType+" when a "+t.desiredType+" session was desired. NOT removing license data.")})).then(freeOnUnref(function(){return u.info("["+t.sessionId+"] Calling MediaKeySession close."),n.close().then(freeOnUnref(function(){u.info("["+t.sessionId+"] MediaKeySession closed.")})).catch(freeOnUnref(function(e){u.warn("["+t.sessionId+"] MediaKeySession failed while closing. Error:",e)}))})).then(freeOnUnref(function(){}))}),e.prototype.applyInitData=freeOnUnref(function(e,t,n){this.getLicenseData=n,this.generateRequestStart=new Date,null!=this.traceEventController&&this.traceEventController.reportTraceStart("PlaybackStartup","DrmGenerateRequest"+this.formatMimeTypeForTrace(),"Licensing",{sessionId:this.sessionId});var r=this.mediaKeySession.generateRequest(e,t);return this.sessionInitializationPromises.push(r),r}),e.prototype.load=freeOnUnref(function(t){var n=this,e=this.mediaKeySession.load(t).catch(freeOnUnref(function(e){return u.error("["+t+"] Error when loading mediaKeySession:",e),n.onSessionError(e,!1),!1}));return this.sessionInitializationPromises.push(e),e}),e.prototype.remove=freeOnUnref(function(){var t=this;return this.mediaKeySession.remove().catch(freeOnUnref(function(e){u.error("["+t.sessionId+"] Error when removing mediaKeySession:",e),t.onSessionError(e)}))}),e.prototype.formatMimeTypeForTrace=freeOnUnref(function(){if(!this.mimeType)return"";if("Dual"===this.mimeType)return"Dual";var e=this.mimeType.split("/")[0];return e.charAt(0).toUpperCase()+e.slice(1)}),e.prototype.requestLicense=freeOnUnref(function(e,t,n){var r=this,i=this.mediaKeySession;if(null==this.getLicenseData){var o=new ct.XpError("media_key_session.invalid_state",void 0,"getLicenseData does not exist at request time");return u.error("["+this.sessionId+"] Unable to make license request. Error:",o),void this.onSessionError(o)}u.info("["+this.sessionId+"] Start to acquire license."),null!=this.traceEventController&&this.traceEventController.reportTraceStart("PlaybackStartup","DrmRequestLicense"+this.formatMimeTypeForTrace(),"Licensing",{sessionId:this.sessionId,licenseRequestNumber:n.toString()}),this.getLicenseData(e).then(freeOnUnref(function(e){if("NotNeeded"!==e.type)return u.info("["+r.sessionId+"] Received license, passing to CDM."),i.update(e.license)})).then(freeOnUnref(function(){r.reportLicenseAcquisitionTime(t,n),u.info("["+r.sessionId+"] Successfully set license.")})).catch(freeOnUnref(function(e){e instanceof lt.CancelError?u.info("["+r.sessionId+"] License request was cancelled."):(null!=r.traceEventController&&r.traceEventController.reportTraceStop("PlaybackStartup","DrmRequestLicense"+r.formatMimeTypeForTrace(),"Failure","Licensing",{sessionId:r.sessionId,licenseRequestNumber:n.toString(),error:e.message}),u.error("["+r.sessionId+"] Failed to set license. Error:",e),r.onSessionError(e))}))}),e.prototype.reportGenerateLicenseRequestTime=freeOnUnref(function(e){var t;if(null!=e&&!(1<this.licenseRequestNumber)){var n=new Date,r=e.getTime(),i=n.getTime(),o=i-r;if(this.diagnostics.report("ttff",((t={drmSessionId:this.sessionId})["drm{SESSION_ID}GenerateRequestStartTime"]=r,t["drm{SESSION_ID}GenerateRequestEndTime"]=i,t)),q.metrics.putMetric("MediaKeySession.GenerateRequest.Time",o),u.info("["+this.sessionId+"] [TTFF] Time to generate license request took "+o+" ms"),null!=this.traceEventController&&this.traceEventController.reportTraceStop("PlaybackStartup","DrmGenerateRequest"+this.formatMimeTypeForTrace(),"Success","Licensing",{sessionId:this.sessionId,durationMs:o.toString()}),u.enabledFor(de.DEBUG)){var a={type:"Generate License Request",startTime:e.toISOString(),endTime:n.toISOString()};u.info(JSON.stringify(a))}}}),e.prototype.reportLicenseAcquisitionTime=freeOnUnref(function(e,t){var n;if(null!=e){var r=new Date,i=e.getTime(),o=r.getTime(),a=o-i,s="drm{SESSION_ID}RequestLicense"+t+"StartTime",l="drm{SESSION_ID}RequestLicense"+t+"EndTime";if(this.diagnostics.report("ttff",((n={drmSessionId:this.sessionId})[s]=i,n[l]=o,n)),q.metrics.putMetric("MediaKeySession.LicenseAcquisition.Time",a),u.info("["+this.sessionId+"] ["+t+"] [TTFF] Time to acquire and set license took "+a+" ms"),null!=this.traceEventController&&this.traceEventController.reportTraceStop("PlaybackStartup","DrmRequestLicense"+this.formatMimeTypeForTrace(),"Success","Licensing",{sessionId:this.sessionId,licenseRequestNumber:t.toString(),durationMs:a.toString()}),u.enabledFor(de.DEBUG)){var f={type:"License Update",startTime:e.toISOString(),endTime:r.toISOString()};u.info(JSON.stringify(f))}}}),e})();t.MediaKeySessionManager=n}));e(Li);Li.MediaKeySessionManager;var Ni=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.codes={xp:{unknown:"xp.unknown",content:{envelope:{expired:"xp.content.envelope.expired",refresh:{error:"xp.content.envelope.refresh.error",timeout:"xp.content.envelope.refresh.timeout"}},no_rights:{anonymizer_ip:"xp.content.no_rights.anonymizer_ip",consent_expired:"xp.content.no_rights.consent_expired",download_limit_exceeded:"xp.content.no_rights.download_limit_exceeded",hd_content_not_allowed:"xp.content.no_rights.hd_content_not_allowed",uhd_content_not_allowed:"xp.content.no_rights.uhd_content_not_allowed",invalid_geo_ip:"xp.content.no_rights.invalid_geo_ip",no_available_streams:"xp.content.no_rights.no_available_streams",not_accepted_terms_and_conditions:"xp.content.no_rights.not_accepted_terms_and_conditions",not_owned:"xp.content.no_rights.not_owned",pv_lower_tier_device_not_permitted_access:"xp.content.no_rights.pv_lower_tier_device_not_permitted_access",device_limit_reached:"xp.content.no_rights.device_limit_reached",unknown:"xp.content.no_rights.unknown"},concurrency_limit:"xp.content.concurrency_limit",service:{null_response:"xp.content.service.null_response",parse:"xp.content.service.parse",unknown:"xp.content.service.unknown"},rapid_recap_unplayable:"xp.content.rapid_recap_unplayable",playback_waiting_timeout:"xp.content.playback_waiting_timeout"},network:{ipv6_unsupported_marketplace:"xp.network.ipv6_unsupported_marketplace"},system:{backgrounded:"xp.system.backgrounded",display_disconnected:"xp.system.display_disconnected",hdcp_insufficient:"xp.system.hdcp_insufficient",unsupported_cdm_version:"xp.system.unsupported_cdm_version"},sdk:{destroyed:"xp.sdk.destroyed"},download:{storage:{disk_full:"xp.download.storage.disk_full",unknown:"xp.download.storage.unknown"},drm:{license:{no_rights:"xp.download.drm.license.no_rights"}},operation_not_found:"xp.download.operation_not_found"}}};t.allCodes=["xp.unknown","xp.content.envelope.expired","xp.content.envelope.refresh.error","xp.content.envelope.refresh.timeout","xp.content.no_rights.anonymizer_ip","xp.content.no_rights.consent_expired","xp.content.no_rights.download_limit_exceeded","xp.content.no_rights.hd_content_not_allowed","xp.content.no_rights.uhd_content_not_allowed","xp.content.no_rights.invalid_geo_ip","xp.content.no_rights.no_available_streams","xp.content.no_rights.not_accepted_terms_and_conditions","xp.content.no_rights.not_owned","xp.content.no_rights.pv_lower_tier_device_not_permitted_access","xp.content.no_rights.device_limit_reached","xp.content.no_rights.unknown","xp.content.concurrency_limit","xp.content.service.null_response","xp.content.service.parse","xp.content.service.unknown","xp.content.rapid_recap_unplayable","xp.content.playback_waiting_timeout","xp.network.ipv6_unsupported_marketplace","xp.system.backgrounded","xp.system.display_disconnected","xp.system.hdcp_insufficient","xp.system.unsupported_cdm_version","xp.sdk.destroyed","xp.download.storage.disk_full","xp.download.storage.unknown","xp.download.drm.license.no_rights","xp.download.operation_not_found"]}));e(Ni);Ni.codes,Ni.allCodes;var Vi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.FAILURE_CODE=-1,t.makeError=function(e,t){var n=new Error;return n.code=e,n.message=t,n},t.makeHdcpError=function(e,t){var n=new Error;return n.code=1001,n.message="HDCP "+t.major+"."+t.minor+" is not sufficient for "+e.width+"x"+e.height+" content",n.maxResolution=e,n.hdcpVersion=t,n}}));e(Vi);Vi.FAILURE_CODE,Vi.makeError,Vi.makeHdcpError;var ji=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(e,t){void 0===e&&(e=-1),void 0===t&&(t=-1),this.major=e,this.minor=t}})();t.HdcpVersion=n}));e(ji);ji.HdcpVersion;var qi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=f.of("HdcpPoller"),n=freeOnUnref(function(){function e(e,t,n){void 0===e&&(e=1e3),void 0===t&&(t=10),void 0===n&&(n=5),r(0<e,"Non-negative pollingInterval").is.true(),r(0<t,"Non-negative retries").is.true(),r(0<n,"Non-negative hdmi disconnect retries").is.true(),this.interval=e,this.retries=t,this.disconnectRetries=n}return Object.defineProperty(e.prototype,"pollingInterval",{get:freeOnUnref(function(){return this.interval}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pollingRetries",{get:freeOnUnref(function(){return this.retries}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pollingDisconnectRetries",{get:freeOnUnref(function(){return this.disconnectRetries}),enumerable:!0,configurable:!0}),e})();t.HdcpPollerConfig=n;var i=de.get("HdcpPoller"),o=freeOnUnref(function(){function e(e,t,n){r(e,"config").exists(),r(t,"timer").exists(),r(n,"deviceProperties").exists(),this.config=e,this.timer=t,this.deviceProperties=n,this.hasAnalogOutput=this.queryAnalogOutput(),this.prevHdcpVersion=new ji.HdcpVersion,this.prevSupportsHDCP=!1,this.isRunning=!1,this.hdcpLevelChangedHandler=l.noop,this.attempts=0,this.disconnectAttempts=0}return e.prototype.start=freeOnUnref(function(e){r(e,"handler").exists(),this.isRunning&&this.stop(),this.hdcpLevelChangedHandler=e,this.scheduleRun()}),e.prototype.stop=freeOnUnref(function(){this.isRunning&&(null!=this.timerHandle&&this.timer.clearTimeout(this.timerHandle),this.timerHandle=void 0,this.isRunning=!1)}),e.prototype.runOnce=freeOnUnref(function(e){r(e,"callback").exists(),this.queryExternalOutput(e)}),e.prototype.scheduleRun=freeOnUnref(function(){var e=this;this.timerHandle=this.timer.setTimeout(freeOnUnref(function(){return e.validateHdcpLevel()}),this.config.pollingInterval),this.isRunning=!0}),e.prototype.validateHdcpLevel=freeOnUnref(function(){var r=this;this.isRunning=!1,this.runOnce(freeOnUnref(function(e,t,n){null!=e?r.hdcpLevelChangedHandler(e):t&&(n.major===r.prevHdcpVersion.major&&n.minor===r.prevHdcpVersion.minor||(r.prevHdcpVersion=n,r.hdcpLevelChangedHandler(void 0,n))),r.scheduleRun()}))}),e.prototype.queryExternalOutput=freeOnUnref(function(n){var r=this;try{this.deviceProperties.getBoolProperty("hasExternalOutput",!1,freeOnUnref(function(e,t){e?t?r.queryHdcp(n):n(void 0,!1):n(Vi.makeError(1001,"Property key hasExternalOutput not found"))}))}catch(e){n(Vi.makeError(Vi.FAILURE_CODE,e.message))}}),e.prototype.queryHdcp=freeOnUnref(function(n){var r=this;try{this.deviceProperties.getBoolProperty("supportsHDCP",!1,freeOnUnref(function(e,t){e?t?(r.prevSupportsHDCP=!0,r.queryHDCPVersion(n)):!r.prevSupportsHDCP&&r.hasAnalogOutput?(r.attempts=0,n(void 0,!0,new ji.HdcpVersion(void 0,void 0))):(r.attempts=0,r.disconnectAttempts++,i.warn("hdmi is disconnected! retry "+r.disconnectAttempts+" / "+r.config.pollingDisconnectRetries+"..."),r.retryQuery(1004,"Display disconnected",n)):r.retryQuery(1001,"Property key supportsHDCP not found",n)}))}catch(e){this.retryQuery(Vi.FAILURE_CODE,e.message,n)}}),e.prototype.queryHDCPVersion=freeOnUnref(function(n){var r=this;try{this.deviceProperties.getInt32Property("hdcpMajorVersion",!1,freeOnUnref(function(e,t){e?r.queryHdcpMinorValue(t,n):r.retryQuery(1001,"Property key hdcpMajorVersion not found",n)}))}catch(e){this.retryQuery(Vi.FAILURE_CODE,e.message,n)}}),e.prototype.queryHdcpMinorValue=freeOnUnref(function(n,r){var i=this;try{this.deviceProperties.getInt32Property("hdcpMinorVersion",!1,freeOnUnref(function(e,t){e?(r(void 0,!0,new ji.HdcpVersion(n,t)),i.attempts=0):i.retryQuery(1001,"Property key hdcpMinorVersion not found",r)}))}catch(e){this.retryQuery(Vi.FAILURE_CODE,e.message,r)}}),e.prototype.retryQuery=freeOnUnref(function(e,t,n){var r=this;this.attempts<this.config.pollingRetries&&this.disconnectAttempts<=this.config.pollingDisconnectRetries?(this.attempts++,this.timer.setTimeout(freeOnUnref(function(){return r.queryHdcp(n)}),this.config.pollingInterval)):(this.attempts=0,this.disconnectAttempts=0,n(Vi.makeError(e,t)),this.stop())}),e.prototype.queryAnalogOutput=freeOnUnref(function(){var e=!1,t=L.configurationStore.configuration;if(null!=t&&null!=t.device&&null!=t.device.hasAnalogOutput&&!(e=!0===t.device.hasAnalogOutput)&&Array.isArray(t.device.hasAnalogOutput)){var n=zt.deviceInformation.hardware.model;null!=n&&null!=n.name&&(e=-1!==t.device.hasAnalogOutput.indexOf(n.name))}return e}),e})();t.HdcpPoller=o;var a=freeOnUnref(function(){function e(){}return e.prototype.createPoller=freeOnUnref(function(e,t,n){return new o(e,t,n)}),e})();t.HdcpPollerFactory=a}));e(qi);qi.HdcpPollerConfig,qi.HdcpPoller,qi.HdcpPollerFactory;var Hi=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.SD=480]="SD",e[e.FHD=1080]="FHD",e[e.UHD=2160]="UHD"})(n||(n={})),t.HDCP_RULES=[{resolutionHeight:n.UHD,minimumRequiredHdcpVersion:{major:Number.POSITIVE_INFINITY,minor:Number.POSITIVE_INFINITY}},{resolutionHeight:n.FHD,minimumRequiredHdcpVersion:{major:2,minor:2}},{resolutionHeight:n.SD,minimumRequiredHdcpVersion:{major:1,minor:0}}]}));e(Hi);Hi.HDCP_RULES;var zi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.extractKeyIdsFromLicenseResponse=freeOnUnref(function(e){return[]}),e})();t.NullKeyIdExtractor=n}));e(zi);zi.NullKeyIdExtractor;var Wi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.convertBufferSourceToUint8Array=freeOnUnref(function(e){return ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}),e})();t.BinaryUtils=n}));e(Wi);Wi.BinaryUtils;var Ki=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function a(e){void 0===e&&(e=[]),this.buffers=[];for(var t=this.byteLength=0,n=e;t<n.length;t++){var r=n[t];this.appendBuffer(r)}}return a.create=freeOnUnref(function(e){return e instanceof a?e:new a([new Uint8Array(e)])}),a.prototype.appendBuffer=freeOnUnref(function(e){if(e instanceof a)for(var t=0,n=e.buffers;t<n.length;t++){var r=n[t];this.buffers.push(r),this.byteLength+=r.byteLength}else this.buffers.push(e),this.byteLength+=e.byteLength}),Object.defineProperty(a.prototype,"length",{get:freeOnUnref(function(){return this.byteLength}),enumerable:!0,configurable:!0}),a.prototype.getByte=freeOnUnref(function(e){if(e>=this.length)throw new Error("Index out of bounds");for(var t=0;e>=this.buffers[t].byteLength;)e-=this.buffers[t].byteLength,t++;return this.buffers[t][e]}),a.prototype.setByte=freeOnUnref(function(e,t){if(e>=this.length)throw new Error("Index out of bounds");for(var n=0;e>=this.buffers[n].byteLength;)e-=this.buffers[n].byteLength,n++;this.buffers[n][e]=t}),a.prototype.subarray=freeOnUnref(function(e,t){void 0===e&&(e=0),void 0===t&&(t=1/0);var n=0;for(t--;n<this.buffers.length&&e>=this.buffers[n].byteLength;)e-=this.buffers[n].byteLength,t-=this.buffers[n].byteLength,n++;if(n>=this.buffers.length)return new a;for(var r=n;r<this.buffers.length-1&&t>=this.buffers[r].byteLength;)t-=this.buffers[r].byteLength,r++;t>=this.buffers[r].byteLength&&(t=this.buffers[r].byteLength-1);var i=new a;if(n===r)return i.appendBuffer(this.buffers[n].subarray(e,t+1)),i;i.appendBuffer(this.buffers[n].subarray(e));for(var o=n+1;o<r;o++)i.appendBuffer(this.buffers[o]);return i.appendBuffer(this.buffers[r].subarray(0,t+1)),i}),a.prototype.coalesce=freeOnUnref(function(){if(1===this.buffers.length)return this.buffers[0];for(var e=new Uint8Array(this.length),t=0,n=0,r=this.buffers;n<r.length;n++){var i=r[n];e.set(i,t),t+=i.length}return e}),a})();t.MultiBuffer=n}));e(Ki);Ki.MultiBuffer;var Gi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function r(e,t,n){void 0===t&&(t=0),this.backingBuffer=e,this.offset=t,this.length=n,this.scratchArea=new Uint8Array(8),this.scratchView=new DataView(this.scratchArea.buffer)}return r.createFor=freeOnUnref(function(e,t,n){return e instanceof ArrayBuffer?new DataView(e,t,n):new r(e,t,n)}),Object.defineProperty(r.prototype,"byteOffset",{get:freeOnUnref(function(){return this.offset}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"byteLength",{get:freeOnUnref(function(){return null!=this.length?this.length:this.backingBuffer.length-this.offset}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"buffer",{get:freeOnUnref(function(){return this.backingBuffer}),enumerable:!0,configurable:!0}),r.prototype.getInt8=freeOnUnref(function(e){return this.read(e,1),this.scratchView.getInt8(0)}),r.prototype.getUint8=freeOnUnref(function(e){return this.backingBuffer.getByte(this.byteOffset+e)}),r.prototype.getInt16=freeOnUnref(function(e,t){return this.read(e,2),this.scratchView.getInt16(0,t)}),r.prototype.getUint16=freeOnUnref(function(e,t){return this.read(e,2),this.scratchView.getUint16(0,t)}),r.prototype.getInt32=freeOnUnref(function(e,t){return this.read(e,4),this.scratchView.getInt32(0,t)}),r.prototype.getUint32=freeOnUnref(function(e,t){return this.read(e,4),this.scratchView.getUint32(0,t)}),r.prototype.getFloat32=freeOnUnref(function(e,t){return this.read(e,4),this.scratchView.getFloat32(0,t)}),r.prototype.getFloat64=freeOnUnref(function(e,t){return this.read(e,8),this.scratchView.getFloat64(0,t)}),r.prototype.setInt8=freeOnUnref(function(e,t){this.scratchView.setInt8(0,t),this.write(e,1)}),r.prototype.setUint8=freeOnUnref(function(e,t){this.scratchView.setUint8(0,t),this.write(e,1)}),r.prototype.setInt16=freeOnUnref(function(e,t,n){this.scratchView.setInt16(0,t,n),this.write(e,2)}),r.prototype.setUint16=freeOnUnref(function(e,t,n){this.scratchView.setUint16(0,t,n),this.write(e,2)}),r.prototype.setInt32=freeOnUnref(function(e,t,n){this.scratchView.setInt32(0,t,n),this.write(e,4)}),r.prototype.setUint32=freeOnUnref(function(e,t,n){this.scratchView.setUint32(0,t,n),this.write(e,4)}),r.prototype.setFloat32=freeOnUnref(function(e,t,n){this.scratchView.setFloat32(0,t,n),this.write(e,4)}),r.prototype.setFloat64=freeOnUnref(function(e,t,n){this.scratchView.setFloat64(0,t,n),this.write(e,8)}),r.prototype.read=freeOnUnref(function(e,t){var n=0;switch(t){case 8:this.scratchArea[n++]=this.backingBuffer.getByte(this.offset+e++);case 7:this.scratchArea[n++]=this.backingBuffer.getByte(this.offset+e++);case 6:this.scratchArea[n++]=this.backingBuffer.getByte(this.offset+e++);case 5:this.scratchArea[n++]=this.backingBuffer.getByte(this.offset+e++);case 4:this.scratchArea[n++]=this.backingBuffer.getByte(this.offset+e++);case 3:this.scratchArea[n++]=this.backingBuffer.getByte(this.offset+e++);case 2:this.scratchArea[n++]=this.backingBuffer.getByte(this.offset+e++);case 1:this.scratchArea[n++]=this.backingBuffer.getByte(this.offset+e++)}}),r.prototype.write=freeOnUnref(function(e,t){var n=0;switch(t){case 8:this.backingBuffer.setByte(this.offset+e++,this.scratchArea[n++]);case 7:this.backingBuffer.setByte(this.offset+e++,this.scratchArea[n++]);case 6:this.backingBuffer.setByte(this.offset+e++,this.scratchArea[n++]);case 5:this.backingBuffer.setByte(this.offset+e++,this.scratchArea[n++]);case 4:this.backingBuffer.setByte(this.offset+e++,this.scratchArea[n++]);case 3:this.backingBuffer.setByte(this.offset+e++,this.scratchArea[n++]);case 2:this.backingBuffer.setByte(this.offset+e++,this.scratchArea[n++]);case 1:this.backingBuffer.setByte(this.offset+e++,this.scratchArea[n++])}}),r})();t.MultiBufferDataView=n}));e(Gi);Gi.MultiBufferDataView;var Qi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function n(e){this.view=e,this.position=0}return n.from=freeOnUnref(function(e){if(ArrayBuffer.isView(e)){var t=e;return new n(new DataView(t.buffer,t.byteOffset,t.byteLength))}if(e instanceof ArrayBuffer)return new n(new DataView(e));if(e instanceof Ki.MultiBuffer)return new n(t=new Gi.MultiBufferDataView(e));if(e instanceof Gi.MultiBufferDataView)return new n(e);if(e instanceof n)return e;throw new Error("Invalid input object")}),n.prototype.clone=freeOnUnref(function(){var e=new n(this.view);return e.position=this.position,e}),n.prototype.size=freeOnUnref(function(){return this.view.byteLength}),n.prototype.hasData=freeOnUnref(function(){return 0<this.remaining()}),n.prototype.remaining=freeOnUnref(function(){return this.view.byteLength-this.position}),n.prototype.readu8=freeOnUnref(function(){var e=this.view.getUint8(this.position);return this.position++,e}),n.prototype.readu16=freeOnUnref(function(){var e=this.view.getUint16(this.position);return this.position+=2,e}),n.prototype.readu24=freeOnUnref(function(){var e=this.view.getUint16(this.position);return e=e<<8|this.view.getUint8(this.position+2),this.position+=3,e}),n.prototype.readu32=freeOnUnref(function(){var e=this.view.getUint32(this.position);return this.position+=4,e}),n.prototype.reads32=freeOnUnref(function(){var e=this.view.getInt32(this.position);return this.position+=4,e}),n.prototype.readu64=freeOnUnref(function(){return 4294967296*this.readu32()+this.readu32()}),n.prototype.readString=freeOnUnref(function(e){var t=[];t.length=e;for(var n=0;n<e;n++)t[n]=String.fromCharCode(this.view.getUint8(this.position++));return t.join("")}),n.prototype.readCString=freeOnUnref(function(){for(var e=[],t=this.readu8();0!==t;)e.push(String.fromCharCode(t)),t=this.readu8();return e.join("")}),n.prototype.readUUID=freeOnUnref(function(){return this.pad(this.readu32(),"00000000")+"-"+this.pad(this.readu16(),"0000")+"-"+this.pad(this.readu16(),"0000")+"-"+this.pad(this.readu16(),"0000")+"-"+this.pad(this.readu24(),"000000")+this.pad(this.readu24(),"000000")}),n.prototype.skip=freeOnUnref(function(e){return this.position+=e,this}),n.prototype.readBuffer=freeOnUnref(function(e){null==e&&(e=this.view.byteLength-this.position);var t=new n(Gi.MultiBufferDataView.createFor(this.view.buffer,this.view.byteOffset+this.position,e));return this.position+=e,t}),n.prototype.readUint8Array=freeOnUnref(function(e){return this.readChunk(e).coalesce()}),n.prototype.readChunk=freeOnUnref(function(e){null==e&&(e=this.view.byteLength-this.position);var t=Ki.MultiBuffer.create(this.view.buffer).subarray(this.view.byteOffset+this.position,this.view.byteOffset+this.position+e);return this.position+=e,t}),n.prototype.getAbsolutePosition=freeOnUnref(function(){return this.view.byteOffset+this.position}),n.prototype.pad=freeOnUnref(function(e,t,n){return void 0===n&&(n=16),(t+e.toString(n)).slice(-t.length)}),n})();t.DataReader=n}));e(Qi);Qi.DataReader;var Xi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function f(){}return f.parse=freeOnUnref(function(e){for(var t=new Qi.DataReader(new DataView(e.buffer,e.byteOffset,e.byteLength)),n={};t.hasData();){var r=f.readVarint(t),i=r>>3,o=7&r,a=void 0;switch(o){case 0:a=f.readVarint(t);break;case 1:a=t.readUint8Array(8);break;case 5:a=t.readUint8Array(4);break;case 2:var s=f.readVarint(t);a=t.readUint8Array(s);break;default:throw new Error("Unrecognized wireType: "+o)}var l=n[i];null==l?n[i]=a:Array.isArray(l)?l.push(a):n[i]=[l,a]}return n}),f.readVarint=freeOnUnref(function(e){for(var t,n=0,r=0;n|=(127&(t=e.readu8()))<<r,r+=7,0!=(128&t););return n}),f})();t.ProtobufDecoder=n}));e(Xi);Xi.ProtobufDecoder;var Yi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryUtils=Wi.BinaryUtils,t.DataReader=Qi.DataReader,t.MultiBuffer=Ki.MultiBuffer,t.MultiBufferDataView=Gi.MultiBufferDataView,t.ProtobufDecoder=Xi.ProtobufDecoder}));e(Yi);Yi.BinaryUtils,Yi.DataReader,Yi.MultiBuffer,Yi.MultiBufferDataView,Yi.ProtobufDecoder;var Ji=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("DrmKeyStatusMapEmulator"),n=freeOnUnref(function(){function l(){}return l.prototype.extractKeyIdsFromLicenseResponse=freeOnUnref(function(e){var t=Yi.ProtobufDecoder.parse(e)[l.LICENSE_IDX];if(!(t instanceof Uint8Array))return f.error("Failed to parse license response"),[];for(var n=Yi.ProtobufDecoder.parse(t)[l.KEY_CONTAINER_IDX],r=[],i=0,o=Array.isArray(n)?n:[n];i<o.length;i++){var a=o[i];if(a instanceof Uint8Array){var s=Yi.ProtobufDecoder.parse(a)[l.KEY_ID_IDX];s instanceof Uint8Array?r.push(s):f.error("Failed to parse keyId: "+s)}else f.error("Failed to parse key container: "+a)}return r}),l.LICENSE_IDX=2,l.KEY_CONTAINER_IDX=3,l.KEY_ID_IDX=1,l})();t.WidevineKeyIdExtractor=n}));e(Ji);Ji.WidevineKeyIdExtractor;var Zi=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(e){return"com.widevine.alpha"===e?new Ji.WidevineKeyIdExtractor:new zi.NullKeyIdExtractor}}));e(Zi);Zi.create;var $i=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=f.of("DrmKeyStatusMapEmulator"),r=freeOnUnref(function(){function e(e,t,n){void 0===t&&(t=Zi.create(e)),void 0===n&&(n=Lr.encode),this.base64Encode=n,this.callback=l.noop,this.drmKeyStatusMap={},this.keyIdExtractor=t}return Object.defineProperty(e.prototype,"size",{get:freeOnUnref(function(){return Object.keys(this.drmKeyStatusMap).length}),enumerable:!0,configurable:!0}),e.prototype.has=freeOnUnref(function(e){return n(e,"keyId").exists(),this.encodeKeyIdToString(e)in this.drmKeyStatusMap}),e.prototype.get=freeOnUnref(function(e){n(e,"keyId").exists();var t=this.encodeKeyIdToString(e);return t in this.drmKeyStatusMap?this.drmKeyStatusMap[t].status:void 0}),e.prototype.forEach=freeOnUnref(function(e){for(var t=0,n=Object.keys(this.drmKeyStatusMap);t<n.length;t++){var r=n[t];e(this.drmKeyStatusMap[r].status,this.drmKeyStatusMap[r].key)}}),e.prototype.onKeyStatusChange=freeOnUnref(function(e){this.callback=e}),e.prototype.offKeyStatusChange=freeOnUnref(function(){this.callback=l.noop}),e.prototype.generateRequest=freeOnUnref(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.addKeyId(r,"status-pending")}this.invokeCallbackIfTrue(0<e.length)}),e.prototype.processResponse=freeOnUnref(function(e,t){var n=!1,r=t?"internal-error":"usable";"usable"===r&&(n=this.updateKeyIdsFromResponse(e));for(var i=0,o=Object.keys(this.drmKeyStatusMap);i<o.length;i++){var a=o[i];"status-pending"===this.drmKeyStatusMap[a].status&&(this.drmKeyStatusMap[a].status=r,n=!0)}this.invokeCallbackIfTrue(n)}),e.prototype.releaseKeys=freeOnUnref(function(e){var t=e?"internal-error":"released";if(!(this.size<1)){for(var n=0,r=Object.keys(this.drmKeyStatusMap);n<r.length;n++){var i=r[n];this.drmKeyStatusMap[i].status=t}this.invokeCallbackIfTrue(!0)}}),e.prototype.invokeCallbackIfTrue=freeOnUnref(function(e){e&&this.callback()}),e.prototype.updateKeyIdsFromResponse=freeOnUnref(function(e){for(var t=!1,n=0,r=this.keyIdExtractor.extractKeyIdsFromLicenseResponse(e);n<r.length;n++){var i=r[n];this.has(i)||(this.addKeyId(i,"usable"),t=!0)}return t}),e.prototype.encodeKeyIdToString=freeOnUnref(function(e){return this.base64Encode(e)}),e.prototype.addKeyId=freeOnUnref(function(e,t){this.drmKeyStatusMap[this.encodeKeyIdToString(e)]={key:e,status:t}}),e})();t.DrmKeyStatusMapAdapter=r}));e($i);$i.DrmKeyStatusMapAdapter;var eo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HdcpPoller=qi.HdcpPoller,t.HdcpPollerConfig=qi.HdcpPollerConfig,t.HdcpPollerFactory=qi.HdcpPollerFactory,t.HdcpVersion=ji.HdcpVersion,t.HDCP_RULES=Hi.HDCP_RULES,t.FAILURE_CODE=Vi.FAILURE_CODE,t.makeError=Vi.makeError,t.makeHdcpError=Vi.makeHdcpError,t.DrmKeyStatusMapAdapter=$i.DrmKeyStatusMapAdapter}));e(eo);eo.HdcpPoller,eo.HdcpPollerConfig,eo.HdcpPollerFactory,eo.HdcpVersion,eo.HDCP_RULES,eo.FAILURE_CODE,eo.makeError,eo.makeHdcpError,eo.DrmKeyStatusMapAdapter;var to=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("CreateSystemRetryConfig"),f="createSystemRetry",n=freeOnUnref(function(){function s(e,t,n){this.drmKeySystemName="",this.retryCount=0,this.retrySleepMs=0,this.drmKeySystemName=e,this.retryCount=t,this.retrySleepMs=n}return s.create=freeOnUnref(function(e,t){var n=Qe.nestedValue(e,"hardware.model.name");if(null==n)return null;if(null==t)return null;var r=Qe.nestedValue(t,["device",f,n]);if(null==r||!Qe.isObject(r))return null;var i=this.getConfigStringField(r,"drmKeySystemName"),o=this.getConfigNumberField(r,"retryCount"),a=this.getConfigNumberField(r,"retrySleepMs");return null!==i&&0<o&&0<a?(l.info("Retry of createSystem is enabled for drmKeySystemName="+i+": retryCount="+o+", retrySleepMs="+a),new s(i,o,a)):(l.error("Failed to read valid fields of "+f+" config for model "+n+", createSystem retry is disabled."),null)}),s.getConfigStringField=freeOnUnref(function(e,t){var n=Qe.nestedValue(e,t);return"string"==typeof n?n:null}),s.getConfigNumberField=freeOnUnref(function(e,t){var n=Qe.nestedValue(e,t);return"number"==typeof n?n:0}),s})();t.CreateSystemRetryConfig=n}));e(to);to.CreateSystemRetryConfig;var no=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=f.of("DrmSession"),n=freeOnUnref(function(){function e(e,t,n){void 0===n&&(n=new eo.DrmKeyStatusMapAdapter(t)),this._sessionId="",this._isSessionCreated=!1,this._drmSystem=e,this._drmKeyStatusMap=n}return e.prototype.convertMessageType=freeOnUnref(function(e){switch(e){case"LICENSE_REQUEST":return 0;case"LICENSE_RENEWAL":return 1;case"LICENSE_RELEASE":return 2;case"INDIVIDUALIZATION_REQUEST":return 3}}),e.prototype.createSession=freeOnUnref(function(e){var n=this;s(e,"handler").exists();var r={},i=freeOnUnref(function(){null!=r.sessionError&&null!=r.messageRegistryError&&(r.sessionError===p.MPBErrors.OK&&r.messageRegistryError===p.MPBErrors.OK&&null!=r.sessionID?e():r.sessionError===p.MPBErrors.OK&&r.messageRegistryError!==p.MPBErrors.OK?e(eo.makeError(r.messageRegistryError,"receive errorCode: "+r.messageRegistryError+' in MessageCallbackRegistryCallback of "ConnectorDRMSystemAPI.createSession"')):r.sessionError!==p.MPBErrors.OK&&e(eo.makeError(r.sessionError,"receive errorCode: "+r.sessionError+' in SessionCallback of "ConnectorDRMSystemAPI.createSession"')))}),t=freeOnUnref(function(e,t){e===p.MPBErrors.OK&&(n._sessionId=t,n._isSessionCreated=!0,r.sessionID=t),r.sessionError=e,i()}),o=freeOnUnref(function(e){r.messageRegistryError=e,i()}),a=freeOnUnref(function(e){null!=n._messageCallback&&n._messageCallback(n.convertMessageType(e.getMessageType()),e.getMessageBuffer())});this._drmSystem.createSession(t,a,o)}),e.prototype.generateRequest=freeOnUnref(function(e,t){s(t,"handler").exists(),s(e,"initData").exists(),s(e.data,"initData.data").exists(),s(e.kids,"initData.kids").exists(),this._drmSystem.generateRequest(this._sessionId,e.data,freeOnUnref(function(e){e===p.MPBErrors.OK?t():t(eo.makeError(e,"receive errorCode: "+e+' in callback of "ConnectorDRMSystemAPI.generateRequest"'))})),this._drmKeyStatusMap.generateRequest(e.kids)}),e.prototype.processResponse=freeOnUnref(function(t,n){var r=this;s(n,"handler").exists(),s(t,"data").exists();var i=freeOnUnref(function(e){r._drmKeyStatusMap.processResponse(t,null!=e),n(e)});this._drmSystem.processResponse(this._sessionId,t,freeOnUnref(function(e){e===p.MPBErrors.OK?i():i(eo.makeError(e,"receive errorCode: "+e+' in callback of "ConnectorDRMSystemAPI.processResponse"'))}))}),e.prototype.onMessage=freeOnUnref(function(e){s(e,"callback").exists(),this._messageCallback=e}),e.prototype.offMessage=freeOnUnref(function(){this._messageCallback=void 0}),e.prototype.onKeyStatusChange=freeOnUnref(function(e){s(e,"callback").exists(),this._drmKeyStatusMap.onKeyStatusChange(e)}),e.prototype.offKeyStatusChange=freeOnUnref(function(){this._drmKeyStatusMap.offKeyStatusChange()}),e.prototype.releaseKeys=freeOnUnref(function(t){var n=this;s(t,"handler").exists();var r=freeOnUnref(function(e){n._drmKeyStatusMap.releaseKeys(null!=e),t(e)});this._drmSystem.releaseSessionKeys(this._sessionId,freeOnUnref(function(e){e===p.MPBErrors.OK?r():r(eo.makeError(e,"receive errorCode: "+e+' in callback of "ConnectorDRMSystemAPI.releaseSessionKeys"'))}))}),e.prototype.close=freeOnUnref(function(t){var n=this;s(t,"handler").exists(),this._drmSystem.destroySession(this._sessionId,freeOnUnref(function(e){e===p.MPBErrors.OK?(n._isSessionCreated=!1,t()):t(eo.makeError(e,"receive errorCode: "+e+' in callback of "ConnectorDRMSystemAPI.destroySession"'))}))}),Object.defineProperty(e.prototype,"isClosed",{get:freeOnUnref(function(){return!this._isSessionCreated}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:freeOnUnref(function(){return this._sessionId}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyStatusMap",{get:freeOnUnref(function(){return this._drmKeyStatusMap}),enumerable:!0,configurable:!0}),e})();t.DrmSessionAdapter=n}));e(no);no.DrmSessionAdapter;var ro=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=f.of("DrmSystem"),n=freeOnUnref(function(){function s(e,t,n,r,i){void 0===i&&(i=new eo.HdcpPollerFactory),this.errorCallbacks=[],this.nativeDrmSystem=e,this.keySystemName=t,this.hdcpPoller=i.createPoller(new eo.HdcpPollerConfig,n,r)}return s.prototype.createSession=freeOnUnref(function(t){a(t,"handler").exists();var n=new no.DrmSessionAdapter(this.nativeDrmSystem,this.keySystemName);n.createSession(freeOnUnref(function(e){e?e.code===s.drmResetRequiredErrorCode?t(eo.makeError(1005,"Error detected at native level requiring full DRM System reset")):t(e):t(void 0,n)}))}),s.prototype.createPersistentSession=freeOnUnref(function(e){a(e,"handler").exists(),e(eo.makeError(1006,"Drm system is unable to create persistent sessions via UNF interface"),void 0)}),s.prototype.loadSession=freeOnUnref(function(e,t){a(t,"handler").exists(),t(eo.makeError(1006,"Drm system is unable to load persistent sessions via UNF interface"),void 0)}),s.prototype.getOutputStatus=freeOnUnref(function(i,o){a(i,"hdcpQuery").exists(),a(o,"handler").exists(),this.hdcpPoller.runOnce(freeOnUnref(function(e,t,n){var r;null==e?(r=t?i.major<=n.major&&i.minor<=n.minor?"usable":"output-restricted":"usable",o(void 0,r)):o(e)}))}),s.prototype.onError=freeOnUnref(function(e){a(e,"callback").exists(),this.errorCallbacks=l.union(this.errorCallbacks,[e])}),s.prototype.offError=freeOnUnref(function(e){a(e,"callback").exists(),this.errorCallbacks=l.without(this.errorCallbacks,e)}),s.prototype.getNativeDrmSystem=freeOnUnref(function(){return this.nativeDrmSystem}),s.prototype.handleMpbError=freeOnUnref(function(e,t,n,r){var i;switch(e){case-2013069050:i=1001;break;case-2013069049:i=1004}if(null!=i){var o=eo.makeError(i,"[MPB DRM ERROR]["+n+"]["+r+"]["+e+"]["+i+"] "+t);return this.notifyError(o),!0}return!1}),s.prototype.startHdcpPolling=freeOnUnref(function(n){var r=this;a(n,"maxResolution").exists(),this.hdcpPoller.start(freeOnUnref(function(e,t){r.handleHdcpLevelChange(n,e,t)}))}),s.prototype.stopHdcpPolling=freeOnUnref(function(){this.hdcpPoller.stop()}),s.prototype.handleHdcpLevelChange=freeOnUnref(function(e,t,n){var r=t;if(null==r)for(var i=0,o=s.hdcpRules;i<o.length;i++){var a=o[i];if(e.height>a.height&&(n.major<a.major||n.minor<a.minor)){r=eo.makeHdcpError(e,n);break}}null!=r&&this.notifyError(r)}),s.prototype.notifyError=freeOnUnref(function(e){for(var t=0,n=this.errorCallbacks;t<n.length;t++){(0,n[t])(e)}}),s.hdcpRules=[{height:2160,major:Number.POSITIVE_INFINITY,minor:Number.POSITIVE_INFINITY},{height:1080,major:2,minor:2},{height:480,major:1,minor:0}],s.drmResetRequiredErrorCode=29,s})();t.DrmSystemAdapter=n}));e(ro);ro.DrmSystemAdapter;var io=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=f.of("DrmProvider"),l=de.get("DrmProviderAdapter"),a=freeOnUnref(function(){function e(e,t,n){void 0===n&&(n=re.connector.drmSystemFactoryAPI),this._timer=e,this._deviceProperties=t,this._nativeDrmProvider=n,this._drmSystemKeyMap={}}return e.prototype.createSystem=freeOnUnref(function(t,n,r){var i=this;o(r,"handler").exists(),o(t,"keySystemName").exists(),this._drmSystemKeyMap.hasOwnProperty(t)?null!=this._drmSystemKeyMap[t]?r(void 0,this._drmSystemKeyMap[t]):r(eo.makeError(1003,"System: "+t+" is creating. please wait..")):(this._nativeDrmProvider.startDRM(t,freeOnUnref(function(e){e===p.MPBErrors.OK?i.createDRMSystemManager(t,n,r,1):i._nativeDrmProvider.stopDRM(freeOnUnref(function(){i._drmSystemKeyMap={},r(eo.makeError(e,"received errorCode: "+e+' in callback of "ConnectorDRMSystemFactoryAPI.startDrm"'))}))})),this._drmSystemKeyMap[t]=null)}),e.prototype.destroySystem=freeOnUnref(function(e,t){delete this._drmSystemKeyMap[e],this._nativeDrmProvider.stopDRM(freeOnUnref(function(e){e===p.MPBErrors.OK?t():t(eo.makeError(e,"received errorCode: "+e+' in callback of "ConnectorDRMSystemFactoryAPI.stopDrm"'))}))}),e.prototype.createDRMSystemManager=freeOnUnref(function(r,i,o,a){var s=this;this._nativeDrmProvider.createSystem(freeOnUnref(function(e,t){if(e===p.MPBErrors.OK){var n=new ro.DrmSystemAdapter(t,r,s._timer,s._deviceProperties);s._drmSystemKeyMap[r]=n,o(void 0,n)}else i&&r===i.drmKeySystemName&&a<=i.retryCount?(l.warn("Scheduling timer in "+i.retrySleepMs+"ms for createSystem retry attempt #"+a+" of "+i.retryCount+" for "+r),s._timer.setTimeout(freeOnUnref(function(){l.warn("createSystem retry attempt "+a+" of "+i.retryCount+" for "+r),s.createDRMSystemManager(r,i,o,a+1)}),i.retrySleepMs)):s._nativeDrmProvider.stopDRM(freeOnUnref(function(){s._drmSystemKeyMap={},o(eo.makeError(e,"receive errorCode: "+e+' in callback of "ConnectorDRMSystemFactoryAPI.createSystem"'))}))}))}),Object.defineProperty(e.prototype,"nativeDrmProvider",{set:freeOnUnref(function(e){this._nativeDrmProvider=e}),enumerable:!0,configurable:!0}),e})(),n=freeOnUnref(function(){function i(e,t,n,r){void 0===t&&(t=oe.timer),void 0===n&&(n=re.connector.devicePropertiesAPI),void 0===r&&(r=to.CreateSystemRetryConfig.create(zt.deviceInformation,L.configurationStore.configuration)),this.createSystemRetryConfig=r,null==i.drmProviderAdapterSingleton&&(i.drmProviderAdapterSingleton=new a(t,n,e)),null!=e&&(i.drmProviderAdapterSingleton.nativeDrmProvider=e)}return i.prototype.createSystem=freeOnUnref(function(e,t){o(t,"handler").exists(),o(e,"keySystemName").exists(),i.drmProviderAdapterSingleton?i.drmProviderAdapterSingleton.createSystem(e,this.createSystemRetryConfig,t):t(eo.makeError(1002,"drmProviderAdapter is not initialized yet"))}),i.prototype.destroySystem=freeOnUnref(function(e,t){i.drmProviderAdapterSingleton.destroySystem(e,t)}),i})();t.DrmProviderAdapter=n}));e(io);io.DrmProviderAdapter;var oo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DrmProvider=io.DrmProviderAdapter,t.DrmSystem=ro.DrmSystemAdapter,t.DrmSession=no.DrmSessionAdapter}));e(oo);oo.DrmProvider,oo.DrmSystem,oo.DrmSession;var ao=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("CreateSystemRetryConfig"),f="createSystemRetry",n=freeOnUnref(function(){function s(e,t,n){this.drmKeySystemName="",this.retryCount=0,this.retrySleepMs=0,this.drmKeySystemName=e,this.retryCount=t,this.retrySleepMs=n}return s.create=freeOnUnref(function(e,t){var n=Qe.nestedValue(e,"hardware.model.name");if(null==n)return null;if(null==t)return null;var r=Qe.nestedValue(t,["device",f,n]);if(null==r||!Qe.isObject(r))return null;var i=this.getConfigStringField(r,"drmKeySystemName"),o=this.getConfigNumberField(r,"retryCount"),a=this.getConfigNumberField(r,"retrySleepMs");return null!==i&&0<o&&0<a?(l.info("Retry of createSystem is enabled for drmKeySystemName="+i+": retryCount="+o+", retrySleepMs="+a),new s(i,o,a)):(l.error("Failed to read valid fields of "+f+" config for model "+n+", createSystem retry is disabled."),null)}),s.getConfigStringField=freeOnUnref(function(e,t){var n=Qe.nestedValue(e,t);return"string"==typeof n?n:null}),s.getConfigNumberField=freeOnUnref(function(e,t){var n=Qe.nestedValue(e,t);return"number"==typeof n?n:0}),s})();t.CreateSystemRetryConfig=n}));e(ao);ao.CreateSystemRetryConfig;var so=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=f.of("DrmSession"),n=freeOnUnref(function(){function e(e,t,n,r,i){void 0===i&&(i=new eo.DrmKeyStatusMapAdapter(t));var o=this;this.onDrmMessageCallback=freeOnUnref(function(e){null!=o.messageCallback&&o.messageCallback(e.message_type,e.buffer)}),this.onDrmErrorCallback=freeOnUnref(function(e){null!=o.errorCallback&&o.errorCallback(e.error_code,e.description,e.component_name,e.severity)}),this.isSessionClosed=!1,this.drmSessionManager=e,this.keyStatusMap=i,this.timer=n,this.drmSessionId=r,this.drmSessionManager.on("drm-message",this.onDrmMessageCallback),this.drmSessionManager.on("drm-error",this.onDrmErrorCallback)}return Object.defineProperty(e.prototype,"isClosed",{get:freeOnUnref(function(){return this.isSessionClosed}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:freeOnUnref(function(){return this.drmSessionId}),enumerable:!0,configurable:!0}),e.prototype.generateRequest=freeOnUnref(function(e,t){i(t,"handler").exists(),i(e,"initData").exists(),i(e.data,"initData.data").exists(),i(e.kids,"initData.kids").exists();var n=this.drmSessionManager.generateRequest(e.data);n===p.MPBErrors.OK?this.timer.setImmediate(t):this.timer.setImmediate(freeOnUnref(function(){return t(eo.makeError(n,"Drm Session Manager generateRequest() returned "+n+" error code"))})),this.keyStatusMap.generateRequest(e.kids)}),e.prototype.processResponse=freeOnUnref(function(e,t){var n=this;i(t,"handler").exists(),i(e,"data").exists();var r=this.drmSessionManager.processResponse(e);this.timer.setImmediate(freeOnUnref(function(){r===p.MPBErrors.OK?(n.keyStatusMap.processResponse(e,!1),t()):(n.keyStatusMap.processResponse(e,!0),t(eo.makeError(r,"Drm Session Manager processResponse() returned "+r+" error code")))}))}),e.prototype.onMessage=freeOnUnref(function(e){i(e,"callback").exists(),this.messageCallback=e}),e.prototype.offMessage=freeOnUnref(function(){this.messageCallback=void 0}),e.prototype.onKeyStatusChange=freeOnUnref(function(e){i(e,"callback").exists(),this.keyStatusMap.onKeyStatusChange(e)}),e.prototype.offKeyStatusChange=freeOnUnref(function(){this.keyStatusMap.offKeyStatusChange()}),e.prototype.releaseKeys=freeOnUnref(function(e){var t=this;i(e,"handler").exists();var n=this.drmSessionManager.releaseKeys();this.timer.setImmediate(freeOnUnref(function(){n===p.MPBErrors.OK?(t.keyStatusMap.releaseKeys(!1),e()):(t.keyStatusMap.releaseKeys(!0),e(eo.makeError(n,"Drm Session Manager releaseKeys() returned "+n+" error code")))}))}),e.prototype.close=freeOnUnref(function(e){var t=this;i(e,"handler").exists();var n=this.drmSessionManager.destroy();this.timer.setImmediate(freeOnUnref(function(){n===p.MPBErrors.OK?(t.isSessionClosed=!0,e()):e(eo.makeError(n,"Drm Session Manager destroy() returned "+n+" error code"))}))}),e})();t.DrmSessionAdapter=n}));e(so);so.DrmSessionAdapter;var lo=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=f.of("DrmSession"),i=freeOnUnref(function(a){function e(e,t,n,r,i){void 0===i&&(i=new eo.DrmKeyStatusMapAdapter(t));var o=a.call(this,e,t,n,r,i)||this;return o.drmPersistentSessionManager=e,o}return n(e,a),e.prototype.removeKeys=freeOnUnref(function(e){r(e,"handler").exists();var t=this.drmPersistentSessionManager.removeKeys();this.timer.setImmediate(freeOnUnref(function(){null===t||t===p.MPBErrors.OK?e():e(eo.makeError(t,"Drm Session Manager removeKeys() returned "+t+" error code"))}))}),e.prototype.getLicenseStatus=freeOnUnref(function(t){r(t,"handler").exists();var n=this.drmPersistentSessionManager.getLicenseStatus();this.timer.setImmediate(freeOnUnref(function(){if(n.error_code===p.MPBErrors.OK){var e;try{e=JSON.parse(n.license_status_json)}catch(e){return void t(eo.makeError(eo.FAILURE_CODE,"Drm Session Manager getLicenseStatus() was unable to parse license status. Error: '"+e+"'"))}t(void 0,e)}else t(eo.makeError(n.error_code,"Drm Session Manager getLicenseStatus() returned "+n.error_code+" error code"))}))}),e.prototype.getPersistentSessionId=freeOnUnref(function(e){r(e,"handler").exists();var t=this.drmPersistentSessionManager.getPersistentSessionId();this.timer.setImmediate(freeOnUnref(function(){t.error_code===p.MPBErrors.OK?e(void 0,t.persistent_session_id):e(eo.makeError(t.error_code,"Drm Session Manager getPersistentSessionId() returned "+t.error_code+" error code"))}))}),e})(so.DrmSessionAdapter);t.DrmPersistentSessionAdapter=i}));e(lo);lo.DrmPersistentSessionAdapter;var fo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=f.of("DrmSystem"),n=freeOnUnref(function(){function e(e,t,n,r,i){void 0===i&&(i=new eo.HdcpPollerFactory),this.errorCallbacks=[],this.drmSystemManager=e,this.keySystemName=t,this.timer=n,this.hdcpPoller=i.createPoller(new eo.HdcpPollerConfig,n,r)}return e.prototype.getDrmSystemManager=freeOnUnref(function(){return this.drmSystemManager}),e.prototype.createSession=freeOnUnref(function(e){a(e,"handler").exists();var t=this.drmSystemManager.createSession();if(null!=t){var n=t.getSessionId(),r=new so.DrmSessionAdapter(t,this.keySystemName,this.timer,n);this.timer.setImmediate(freeOnUnref(function(){e(void 0,r)}))}else this.timer.setImmediate(freeOnUnref(function(){e(eo.makeError(eo.FAILURE_CODE,"Create DRM session failed"))}))}),e.prototype.createPersistentSession=freeOnUnref(function(e){a(e,"handler").exists();var t=this.drmSystemManager.createPersistentSession();if(null!=t){var n=t.getSessionId(),r=new lo.DrmPersistentSessionAdapter(t,this.keySystemName,this.timer,n);this.timer.setImmediate(freeOnUnref(function(){e(void 0,r)}))}else this.timer.setImmediate(freeOnUnref(function(){e(eo.makeError(eo.FAILURE_CODE,"Create persistent DRM session failed"))}))}),e.prototype.loadSession=freeOnUnref(function(e,t){a(e,"persistentSessionId").exists(),a(t,"handler").exists();var n=this.drmSystemManager.loadSession(e);if(null!=n){var r=n.getSessionId(),i=new lo.DrmPersistentSessionAdapter(n,this.keySystemName,this.timer,r);this.timer.setImmediate(freeOnUnref(function(){t(void 0,i)}))}else this.timer.setImmediate(freeOnUnref(function(){t(eo.makeError(eo.FAILURE_CODE,"Load persistent DRM session failed"))}))}),e.prototype.getOutputStatus=freeOnUnref(function(i,o){a(i,"hdcpQuery").exists(),a(o,"handler").exists(),this.hdcpPoller.runOnce(freeOnUnref(function(e,t,n){var r;null==e?(r=!0===t&&null!=n?i.major<=n.major&&i.minor<=n.minor?"usable":"output-restricted":"usable",o(void 0,r)):o(e)}))}),e.prototype.onError=freeOnUnref(function(e){a(e,"callback").exists(),this.errorCallbacks=l.union(this.errorCallbacks,[e])}),e.prototype.offError=freeOnUnref(function(e){a(e,"callback").exists(),this.errorCallbacks=l.without(this.errorCallbacks,e)}),e.prototype.handleMpbError=freeOnUnref(function(e,t,n,r){var i;switch(e){case p.MPBErrors.DRM_INSUFFICIENT_PROTECTION:i=1001;break;case p.MPBErrors.DRM_DISPLAY_DISCONNECTED:i=1004}if(null!=i){var o=eo.makeError(i,"[MPB DRM ERROR]["+n+"]["+r+"]["+e+"]["+i+"] "+t);return this.notifyError(o),!0}return!1}),e.prototype.startHdcpPolling=freeOnUnref(function(n){var r=this;a(n,"maxResolution").exists(),this.hdcpPoller.start(freeOnUnref(function(e,t){r.handleHdcpLevelChange(n,e,t)}))}),e.prototype.stopHdcpPolling=freeOnUnref(function(){this.hdcpPoller.stop()}),e.prototype.handleHdcpLevelChange=freeOnUnref(function(e,t,n){var r=t;if(null==r)for(var i=0,o=eo.HDCP_RULES;i<o.length;i++){var a=o[i];if(e.height>a.resolutionHeight&&(n.major<a.minimumRequiredHdcpVersion.major||n.minor<a.minimumRequiredHdcpVersion.minor)){r=eo.makeHdcpError(e,n);break}}null!=r&&this.notifyError(r)}),e.prototype.notifyError=freeOnUnref(function(e){for(var t=0,n=this.errorCallbacks;t<n.length;t++){(0,n[t])(e)}}),e})();t.DrmSystemAdapter=n}));e(fo);fo.DrmSystemAdapter;var uo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=f.of("DrmProvider"),s=de.get("DrmProvider"),a=freeOnUnref(function(){function e(e,t,n){this.drmSystemKeyMap={},this.drmManager=e,this.timer=t,this.deviceProperties=n}return e.prototype.createSystem=freeOnUnref(function(e,t,n){if(o(n,"handler").exists(),o(e,"keySystemName").exists(),o(this.drmManager).exists(),this.drmSystemKeyMap.hasOwnProperty(e))n(void 0,this.drmSystemKeyMap[e]);else{var r=this.drmManager.init(e);r===p.MPBErrors.OK?this.createDRMSystemManager(e,t,n,1):this.timer.setImmediate(freeOnUnref(function(){n(eo.makeError(r,"received errorCode: "+r+" from DrmManager.init"))}))}}),e.prototype.createDRMSystemManager=freeOnUnref(function(t,n,r,i){var o=this,a=this.drmManager.createSystem();this.timer.setImmediate(freeOnUnref(function(){if(null==a)return n&&t===n.drmKeySystemName&&i<=n.retryCount?(s.warn("Scheduling timer in "+n.retrySleepMs+"ms for createSystem retry attempt #"+i+" of "+n.retryCount+" for "+t),void o.timer.setTimeout(freeOnUnref(function(){s.warn("createSystem retry attempt "+i+" of "+n.retryCount+" for "+t),o.createDRMSystemManager(t,n,r,i+1)}),n.retrySleepMs)):(o.drmManager.shutdown(),void r(eo.makeError(eo.FAILURE_CODE,"DRM create system failed for "+t)));var e=new fo.DrmSystemAdapter(a,t,o.timer,o.deviceProperties);o.drmSystemKeyMap[t]=e,r(void 0,e)}))}),e.prototype.destroySystem=freeOnUnref(function(e,t){delete this.drmSystemKeyMap[e];var n=this.drmManager.shutdown();n===p.MPBErrors.OK?t():t(eo.makeError(n,"received errorCode: "+n+" from DrmManager.shutdown"))}),Object.defineProperty(e.prototype,"nativeDrmManager",{set:freeOnUnref(function(e){this.drmManager=e}),enumerable:!0,configurable:!0}),e})(),n=freeOnUnref(function(){function i(e,t,n,r){void 0===e&&(e=T.getDrmManager()),void 0===t&&(t=oe.timer),void 0===n&&(n=re.connector.devicePropertiesAPI),void 0===r&&(r=ao.CreateSystemRetryConfig.create(zt.deviceInformation,L.configurationStore.configuration)),this.timer=t,this.createSystemRetryConfig=r,null==i.drmProviderAdapterSingleton&&(i.drmProviderAdapterSingleton=new a(e,t,n)),null!=e&&(i.drmProviderAdapterSingleton.nativeDrmManager=e)}return i.prototype.createSystem=freeOnUnref(function(e,t){o(t,"handler").exists(),o(e,"keySystemName").exists(),i.drmProviderAdapterSingleton?i.drmProviderAdapterSingleton.createSystem(e,this.createSystemRetryConfig,t):this.timer.setImmediate(freeOnUnref(function(){t(eo.makeError(1002,"drmProviderAdapter is not initialised yet"))}))}),i.prototype.destroySystem=freeOnUnref(function(e,t){i.drmProviderAdapterSingleton.destroySystem(e,t)}),i})();t.DrmProviderAdapter=n}));e(uo);uo.DrmProviderAdapter;var co=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DrmProvider=uo.DrmProviderAdapter,t.DrmSystem=fo.DrmSystemAdapter,t.DrmSession=so.DrmSessionAdapter,t.DrmKeyStatusMap=eo.DrmKeyStatusMapAdapter}));e(co);co.DrmProvider,co.DrmSystem,co.DrmSession,co.DrmKeyStatusMap;var po=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(){return new(Si.chooseImplementation(oo.DrmProvider,co.DrmProvider))}})();t.DrmProviderInterceptor=n}));e(po);po.DrmProviderInterceptor;var ho=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(){return new(Si.chooseImplementation(oo.DrmSystem,co.DrmSystem))}})();t.DrmSystemInterceptor=n}));e(ho);ho.DrmSystemInterceptor;var mo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(){return new(Si.chooseImplementation(oo.DrmSession,co.DrmSession))}})();t.DrmSessionInterceptor=n}));e(mo);mo.DrmSessionInterceptor;var yo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DrmProvider=po.DrmProviderInterceptor,t.DrmSystem=ho.DrmSystemInterceptor,t.DrmSession=mo.DrmSessionInterceptor}));e(yo);yo.DrmProvider,yo.DrmSystem,yo.DrmSession;var go=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return Object.defineProperty(e,"supportedKeySystems",{get:freeOnUnref(function(){var e=L.configurationStore.configuration,t=Qe.nestedValue(e,["device","supportedKeySystemsOverride"]);if(null!=t){var n=Qe.nestedValue(zt.deviceInformation,"hardware.model.name");if(null!=n){var r=t[n];if(null!=r&&Array.isArray(r))return r}var i=t.default;if(null!=i&&Array.isArray(i))return i}return[]}),enumerable:!0,configurable:!0}),e.create=freeOnUnref(function(t){if(!No.MediaKeysDrm.isValidKeySystem(t))return lt.Promise.reject(new Error('Unknown key system "'+t+'".'));var n=new yo.DrmProvider;return this.createSystem(n,t).then(freeOnUnref(function(e){return new No.MediaKeysDrm(t,e,n)}))}),e.createSystem=freeOnUnref(function(e,t){return new lt.Promise(freeOnUnref(function(n,r){e.createSystem(t,freeOnUnref(function(e,t){null!=e?r(e):null==t?r(new Error("DRM provider did not return a drm system")):n(t)}))}))}),e})();t.MediaKeyFactory=n}));e(go);go.MediaKeyFactory;var vo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.MIN_BOX_HEADER_BYTES=8;t.BOX_TYPE_FIELD_BYTES=4;t.BOX_EXT_SIZE_FIELD_BYTES=8;t.BOX_UUID_BYTES=16;var n=freeOnUnref(function(){function e(){}return e.prototype.parseBoxes=freeOnUnref(function(e,t,n){for(var r=[];e.hasData();){var i=this.parseBox(e,t,n);r.push(i)}return r}),e.prototype.parseBox=freeOnUnref(function(e,t,n){var r=this.readBox(e,n),i=r,o=t[r.type];if(null!=o){var a=o.parser,s=r.reader;delete i.reader,null!=a&&(i=a(i,s));var l=o.children;null!=l&&(i.boxes=this.parseBoxes(s,l,n+"/"+r.type));var f=o.postProcessor;null!=f&&f(r)}return i}),e.prototype.readBox=freeOnUnref(function(e,t){var n=this.readBoxHeader(e,t,!0);if(e.remaining()<n.boxContentsSize)throw new Error("Remaining box "+n.type+" content size is "+n.boxContentsSize+" bytes, but have only "+e.remaining()+" bytes left. Path: "+t);var r=n;return r.reader=e.readBuffer(n.boxContentsSize),r}),e.prototype.readBoxHeader=freeOnUnref(function(e,t,n){var r=e.getAbsolutePosition();if(e.remaining()<8){if(n)throw new Error("Need at least 8 bytes, but have only "+e.remaining()+" bytes left. Path: "+t);return null}var i=8,o=e.readu32(),a=e.readString(4);if(1===o){if(e.remaining()<8){if(n)throw new Error("Not enough data to read extended size for box "+a+". Need 8 bytes, but have only "+e.remaining()+". Path: "+t);return null}o=e.readu64(),i+=8}if("uuid"===a){if(e.remaining()<16){if(n)throw new Error("Not enough data to read extended type for box "+a+". Need 16 bytes, but have only "+e.remaining()+". Path: "+t);return null}a=e.readUUID(),i+=16}if(o-i<0)throw new Error("Inconsistency detected: Remaining size in reader for box "+a+" is "+(o-i)+". Path: "+t);return{type:a,size:o,boxContentsSize:o-i,absoluteStartPosition:r,boxes:[]}}),e.prototype.peek=freeOnUnref(function(e,t){var n=e.clone();return this.readBoxHeader(n,t,!1)}),e})();t.BoxParser=n}));e(vo);vo.MIN_BOX_HEADER_BYTES,vo.BOX_TYPE_FIELD_BYTES,vo.BOX_EXT_SIZE_FIELD_BYTES,vo.BOX_UUID_BYTES,vo.BoxParser;var Oo=t(freeOnUnref(function(e,t){var y=ce&&ce.__assign||freeOnUnref(function(){return(y=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function m(){}return m.parseMVHD=freeOnUnref(function(e,t){var n=t.readu8();t.skip(3);var r=y({creationTime:0===n?t.readu32():t.readu64(),modificationTime:0===n?t.readu32():t.readu64(),timescale:t.readu32(),duration:0===n?t.readu32():t.readu64(),rate:t.readu32(),volume:t.readu16(),matrix:[],nextTrackId:0},e);t.skip(2),t.skip(8);for(var i=0;i<9;i++)r.matrix[i]=t.readu32();return t.skip(24),r.nextTrackId=t.readu32(),r}),m.parseMDAT=freeOnUnref(function(e,t){return y({data:t.readUint8Array(e.boxContentsSize)},e)}),m.parseTFDT=freeOnUnref(function(e,t){var n=t.readu8();return t.skip(3),y({baseMediaDecodeTime:0===n?t.readu32():t.readu64()},e)}),m.parseMFHD=freeOnUnref(function(e,t){return t.skip(1),t.skip(3),y({sequenceNumber:t.readu32()},e)}),m.parseTFHD=freeOnUnref(function(e,t){t.skip(1);var n=t.readu24();return y({baseDataOffsetPresent:m.isSet(n,1),sampleDescriptionIndexPresent:m.isSet(n,2),defaultSampleDurationPresent:m.isSet(n,8),defaultSampleSizePresent:m.isSet(n,16),defaultSampleFlagsPresent:m.isSet(n,32),durationIsEmpty:m.isSet(n,65536),defaultBaseIsMoof:m.isSet(n,131072),trackId:t.readu32(),baseDataOffset:m.isSet(n,1)?t.readu32():void 0,sampleDescriptionIndex:m.isSet(n,2)?t.readu32():void 0,defaultSampleDuration:m.isSet(n,8)?t.readu32():void 0,defaultSampleSize:m.isSet(n,16)?t.readu32():void 0,defaultSampleFlags:m.isSet(n,32)?t.readu32():void 0},e)}),m.parseTRUN=freeOnUnref(function(e,t){for(var n=t.readu8(),r=t.readu24(),i=t.readu32(),o=y({sampleCount:i,dataOffset:m.isSet(r,1)?t.reads32():void 0,firstSampleFlags:m.isSet(r,4)?t.readu32():void 0,samples:[]},e),a=m.isSet(r,256),s=m.isSet(r,512),l=m.isSet(r,1024),f=m.isSet(r,2048),u=t.readUint8Array(),c=new DataView(u.buffer,u.byteOffset,u.byteLength),d=0,p=0;p<o.sampleCount;p++){var h={};o.samples[p]=h,a&&(h.duration=c.getUint32(d),d+=4),s&&(h.size=c.getUint32(d),d+=4),l&&(h.flags=c.getUint32(d),d+=4),f&&(h.compositionTimeOffset=0===n?c.getUint32(d):c.getInt32(d),d+=4)}return o}),m.parseSIDX=freeOnUnref(function(e,t){var n=t.readu8();t.skip(3);for(var r=y({referenceId:t.readu32(),timescale:t.readu32(),earliestPresentationTime:0===n?t.readu32():t.readu64(),firstOffset:0===n?t.readu32():t.readu64(),referenceCount:t.skip(2).readu16(),references:[]},e),i=0,o=0,a=0;a<r.referenceCount;a++){var s=t.readu32(),l=t.readu32(),f=t.readu32();r.references[a]={referenceType:s>>31,referencedSize:s&~(1<<31),subsegmentDuration:l,startsWithSAP:f>>31!=0,sapType:f>>28&7,sapDeltaTime:268435455&f,subsegmentPosition:i,referencedOffset:o},i+=r.references[a].subsegmentDuration,o+=r.references[a].referencedSize}return r}),m.parseTKHD=freeOnUnref(function(e,t){var n=t.readu8(),r=t.readu24();return y({enabled:m.isSet(r,1),inMovie:m.isSet(r,2),inPreview:m.isSet(r,4),creationTime:0===n?t.readu32():t.readu64(),modificationTime:0===n?t.readu32():t.readu64(),trackId:t.readu32(),duration:(t.skip(4),0===n?t.readu32():t.readu64()),layer:(t.skip(8),t.readu16()),alternateGroup:t.readu16(),volume:t.readu16(),matrix:[t.readu32(),t.readu32(),t.readu32(),t.readu32(),t.readu32(),t.readu32(),t.readu32(),t.readu32(),t.readu32()],width:t.readu32(),height:t.readu32()},e)}),m.parseMDHD=freeOnUnref(function(e,t){var n=t.readu8();t.skip(3);var r,i=y({creationTime:0===n?t.readu32():t.readu64(),modificationTime:0===n?t.readu32():t.readu64(),timescale:t.readu32(),duration:0===n?t.readu32():t.readu64(),language:(r=t.readu16(),String.fromCharCode(96+(r>>10&31),96+(r>>5&31),96+(31&r)))},e);return t.skip(2),i}),m.parseMEHD=freeOnUnref(function(e,t){var n=t.readu8();return t.skip(3),y({fragmentDuration:1===n?t.readu64():t.readu32()},e)}),m.parseTREX=freeOnUnref(function(e,t){return t.skip(1),t.skip(3),y({trackId:t.readu32(),defaultSampleDescriptionIndex:t.readu32(),defaultSampleDuration:t.readu32(),defaultSampleSize:t.readu32(),defaultSampleFlags:t.readu32()},e)}),m.parseHDLR=freeOnUnref(function(e,t){return t.skip(1),t.skip(3),t.skip(4),y({handlerType:t.readu32(),name:(t.skip(12),t.readCString())},e)}),m.parseSTSD=freeOnUnref(function(e,t){for(var n=y({version:t.readu8(),entryCount:(t.skip(3),t.readu32()),entries:[]},e),r=new vo.BoxParser,i=0;i<n.entryCount;i++){var o=r.readBox(t,"stsd");o.reader.skip(6),o.dataReferenceIndex=o.reader.readu16(),n.entries[i]=o}return n}),m.parseSCHM=freeOnUnref(function(e,t){t.skip(1);var n=t.readu24();return y({schemeType:t.readu32(),schemeVersion:t.readu32(),schemeUri:m.isSet(n,1)?t.readCString():void 0},e)}),m.parseEMSG=freeOnUnref(function(e,t){return t.skip(1),t.skip(3),y({schemeIdUri:t.readCString(),value:t.readCString(),timescale:t.readu32(),presentationTimeDelta:t.readu32(),eventDuration:t.readu32(),id:t.readu32(),messageData:t.readUint8Array()},e)}),m.parseSAIZ=freeOnUnref(function(e,t){t.skip(1);for(var n=t.readu24(),r=y({flags:n,auxInfoType:m.isSet(n,1)?t.readu32():void 0,auxInfoTypeParameter:m.isSet(n,1)?t.readu32():void 0,defaultSampleInfoSize:t.readu8(),sampleCount:t.readu32(),sampleInfoSize:[]},e),i=0;i<r.sampleCount;i++)r.sampleInfoSize[i]=0===r.defaultSampleInfoSize?t.readu8():r.defaultSampleInfoSize;return r}),m.parseSAIO=freeOnUnref(function(e,t){for(var n=t.readu8(),r=t.readu24(),i=y({version:n,flags:r,auxInfoType:m.isSet(r,1)?t.readu32():void 0,auxInfoTypeParameter:m.isSet(r,1)?t.readu32():void 0,entryCount:t.readu32(),offset:[]},e),o=0;o<i.entryCount;o++)i.offset[o]=0===i.version?t.readu32():t.readu64();return i}),m.parseSBGP=freeOnUnref(function(e,t){for(var n=t.readu8(),r=y({version:n,groupingType:(t.skip(3),t.readu32()),groupingTypeParameters:1===n?t.readu32():0,entries:[]},e),i=t.readu32(),o=0;o<i;o++)r.entries[o]={sampleCount:t.readu32(),groupDescriptionIndex:t.readu32()};return r}),m.parseFRMA=freeOnUnref(function(e,t){return y({dataFormat:t.readu32()},e)}),m.isSet=freeOnUnref(function(e,t){return 0!=(e&t)}),m})();t.BmffBoxParsers=n}));e(Oo);Oo.BmffBoxParsers;var So=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.registerParser=function(e,t,n){for(var r=t.split("/"),i=e,o=0;o<r.length-1;o++){if(null==i.children)throw new Error("Unable to register parser for path "+t+": no children for "+r[o]);if(null==i.children[r[o]])throw new Error("Unable to register parser for path "+t+": no parser for "+r[o]);i=i.children[r[o]]}null==i.children&&(i.children={});var a=r[r.length-1];if(null!=i.children[a])throw new Error("Unable to register parser for path "+t+": Already have a parser for "+a);i.children[a]=n}}));e(So);So.registerParser;var Uo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.fourCCToNumber=freeOnUnref(function(e){return((e.charCodeAt(0)<<8|e.charCodeAt(1))<<8|e.charCodeAt(2))<<8|e.charCodeAt(3)}),e.numberToFourCC=freeOnUnref(function(e){return String.fromCharCode(e>>>24,e>>>16&255,e>>>8&255,255&e)}),e.ofType=freeOnUnref(function(t){return freeOnUnref(function(e){return e.type===t})}),e.all=freeOnUnref(function(e,t){return e.boxes.filter(t)}),e.find=freeOnUnref(function(e,t){var n=x.find(e.boxes,t);return null!=n?n:null}),e.getPath=freeOnUnref(function(o,a){var s=/^([0-9a-zA-Z]{4,})\[([0-9]+)\]$/,l=a.split("/"),f=0;0===l[f].length&&f++;for(var e=freeOnUnref(function(){var e=s.exec(l[f++]);if(null==e)throw new Error("path "+a+' is invalid: "'+l[f-1]+'" is not valid');var t=e[1],n=e[2],r=parseInt(n),i=o.boxes.filter(freeOnUnref(function(e){return e.type===t}));if(null===i||i.length<=r)return{value:null};o=i[r]});f<l.length;){var t=e();if("object"==typeof t)return t.value}return o}),e})();t.Boxes=n}));e(Uo);Uo.Boxes;var bo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function o(){}return o.registerSampleSubBox=freeOnUnref(function(e,t,n){if(null==o.sampleEntryBoxParsers[e])throw new Error("Unrecognized sample type: "+e);var r={parser:null,children:o.sampleEntryBoxParsers[e]};So.registerParser(r,t,n)}),o.process=freeOnUnref(function(e){var t=Uo.Boxes.getPath(e,"mdia[0]/hdlr[0]");if(null==t)throw new Error("Missing required `hdlr' box in track");t.handlerType===Uo.Boxes.fourCCToNumber("soun")?o.postProcessAudioTrack(e):t.handlerType===Uo.Boxes.fourCCToNumber("vide")&&o.postProcessVideoTrack(e)}),o.postProcessAudioTrack=freeOnUnref(function(e){var t=Uo.Boxes.getPath(e,"mdia[0]/minf[0]/stbl[0]/stsd[0]");if(null==t)throw new Error("Missing required 'stsd' box in track");for(var n=0,r=t.entries;n<r.length;n++){var i=r[n];o.postProcessAudioSampleDescriptionEntry(i)}}),o.postProcessVideoTrack=freeOnUnref(function(e){var t=Uo.Boxes.getPath(e,"mdia[0]/minf[0]/stbl[0]/stsd[0]");if(null==t)throw new Error("Missing required 'stsd' box in track");for(var n=0,r=t.entries;n<r.length;n++){var i=r[n];o.postProcessVisualSampleDescriptionEntry(i)}}),o.postProcessVisualSampleDescriptionEntry=freeOnUnref(function(e){var t=e.reader;delete e.reader;var n=e;t.skip(2),t.skip(2),t.skip(12),n.width=t.readu16(),n.height=t.readu16(),n.horizontalResolution=t.reads32(),n.verticalResolution=t.reads32(),t.skip(4),n.frameCount=t.readu16(),n.compressorName=t.readString(32),n.depth=t.readu16(),t.skip(2);var r=new vo.BoxParser;n.boxes=r.parseBoxes(t,o.sampleEntryBoxParsers.vide,"stsd/vide")}),o.postProcessAudioSampleDescriptionEntry=freeOnUnref(function(e){var t=e.reader;delete e.reader;var n=e;t.readu16();t.skip(6),n.channelCount=t.readu16(),n.sampleSize=t.readu16(),t.skip(2),t.skip(2),n.sampleRate=t.readu32();var r=new vo.BoxParser;n.boxes=r.parseBoxes(t,o.sampleEntryBoxParsers.soun,"stsd/soun")}),o.sampleEntryBoxParsers={soun:{sinf:{parser:null,children:{frma:{parser:Oo.BmffBoxParsers.parseFRMA,children:null},schm:{parser:Oo.BmffBoxParsers.parseSCHM,children:null},schi:{parser:null,children:null}}}},vide:{sinf:{parser:null,children:{frma:{parser:Oo.BmffBoxParsers.parseFRMA,children:null},schm:{parser:Oo.BmffBoxParsers.parseSCHM,children:null},schi:{parser:null,children:null}}}}},o})();t.BmffTrackPostProcessor=n}));e(bo);bo.BmffTrackPostProcessor;var Po=t(freeOnUnref(function(e,t){var s=ce&&ce.__assign||freeOnUnref(function(){return(s=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var r=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],n=freeOnUnref(function(){function e(){}return e.register=freeOnUnref(function(){bo.BmffTrackPostProcessor.registerSampleSubBox("soun","dac3",{parser:e.parseDAC3,children:null}),bo.BmffTrackPostProcessor.registerSampleSubBox("soun","dec3",{parser:e.parseDEC3,children:null})}),e.parseDAC3=freeOnUnref(function(e,t){var n=t.readu24();return s({fscod:n>>22&3,bsid:n>>17&31,bsmod:n>>14&7,acmod:n>>11&7,lfeon:1==(n>>10&1),bitRate:r[n>>5&31]},e)}),e.parseDEC3=freeOnUnref(function(e,t){var n=s({dataRate:-1,independentSubstreams:[]},e),r=t.readu16();n.dataRate=r>>3&8191;var i=1+(7&r);n.independentSubstreams.length=i;for(var o=0;o<i;o++){r=t.readu16();var a=t.readu8();n.independentSubstreams[o]={fscod:r>>14&3,bsid:r>>9&31,asvc:1==(r>>7&1),bsmod:r>>4&7,acmod:r>>1&7,lfeon:1==(1&r),numDepSub:a>>1&15,chanLoc:0},0<n.independentSubstreams[o].numDepSub&&(n.independentSubstreams[o].chanLoc=(1&a)<<8|t.readu8())}return n}),e})();t.AC3BoxParsers=n}));e(Po);Po.AC3BoxParsers;var Mo=t(freeOnUnref(function(e,t){var h=ce&&ce.__assign||freeOnUnref(function(){return(h=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.register=freeOnUnref(function(){bo.BmffTrackPostProcessor.registerSampleSubBox("vide","av1C",{parser:e.parseAV1C,children:null})}),e.parseAV1C=freeOnUnref(function(e,t){var n=t.readu8();if(1!==n>>7||1!==(127&n))throw Error("expected marker & version field to be 1");var r=(n=t.readu8())>>5,i=31&n,o=(n=t.readu8())>>7,a=n>>6&1,s=n>>5&1,l=n>>4&1,f=n>>3&1,u=n>>2&1,c=3&n,d=0!=((n=t.readu8())>>4&1)?15&n:void 0,p=t.readUint8Array();return h({seqProfile:r,seqLevelIdx0:i,seqTier0:o,highBitdepth:a,twelveBit:s,monochrome:l,chromaSubsamplingX:f,chromaSubsamplingY:u,chromaSamplePosition:c,initialPresentationDelayMinusOne:d,configOBUs:p},e)}),e})();t.AV1BoxParsers=n}));e(Mo);Mo.AV1BoxParsers;var Co=t(freeOnUnref(function(e,t){var l=ce&&ce.__assign||freeOnUnref(function(){return(l=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.register=freeOnUnref(function(){bo.BmffTrackPostProcessor.registerSampleSubBox("vide","avcC",{parser:e.parseAVCC,children:null})}),e.parseAVCC=freeOnUnref(function(e,t){t.readu8();for(var n=l({profileIndication:t.readu8(),profileCompatibility:t.readu8(),levelIndication:t.readu8(),lengthSizeMinusOne:3&t.readu8(),SPSs:[],PPSs:[]},e),r=31&t.readu8(),i=0;i<r;i++){var o=t.readu16();n.SPSs.push(t.readUint8Array(o))}var a=t.readu8();for(i=0;i<a;i++){var s=t.readu16();n.PPSs.push(t.readUint8Array(s))}return n}),e})();t.AVCBoxParsers=n}));e(Co);Co.AVCBoxParsers;var Eo=t(freeOnUnref(function(e,t){var T=ce&&ce.__assign||freeOnUnref(function(){return(T=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.register=freeOnUnref(function(){bo.BmffTrackPostProcessor.registerSampleSubBox("vide","hvcC",{parser:e.parseHVCC,children:null})}),e.parseHVCC=freeOnUnref(function(e,t){t.readu8();var n=t.readu8(),r=n>>6,i=32==(32&n),o=31&n,a=t.readu32(),s=t.readu16(),l=t.readu32(),f=t.readu8(),u=4095&t.readu16(),c=3&t.readu8(),d=3&t.readu8(),p=7&t.readu8(),h=7&t.readu8(),m=t.readu16(),y=(n=t.readu8())>>6,g=n>>3&7,v=4==(4&n),O=3&n,S=t.readu8(),U=[];U.length=S;for(var b=0;b<S;b++){var P={arrayCompleteness:128==(128&(n=t.readu8())),nalUnitType:63&n,nals:[]};U[b]=P;var M=t.readu16();P.nals.length=M;for(var C=0;C<M;C++){var E=t.readu16();P.nals[C]=t.readUint8Array(E)}}return T({generalProfileSpace:r,generalTierFlag:i,generalProfileIdc:o,generalProfileCompatibilityFlag:a,generalConstraintIndicatorFlagsLo:l,generalConstraintIndicatorFlagsHi:s,generalLevelIdc:f,minSpatialSegmentationIdc:u,parallelismType:c,chromaFormat:d,bitDepthLumaMinus8:p,bitDepthChromaMinus8:h,avgFrameRate:m,constantFrameRate:y,numTemporalLayers:g,temporalIdNested:v,lengthSizeMinusOne:O,arrays:U},e)}),e})();t.HEVCBoxParsers=n}));e(Eo);Eo.HEVCBoxParsers;var To=t(freeOnUnref(function(e,t){var a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.register=freeOnUnref(function(){bo.BmffTrackPostProcessor.registerSampleSubBox("vide","dvcC",{parser:e.parseDVCC,children:null}),bo.BmffTrackPostProcessor.registerSampleSubBox("vide","dvvC",{parser:e.parseDVCC,children:null})}),e.parseDVCC=freeOnUnref(function(e,t){var n=t.readu8(),r=t.readu8(),i=t.readu16(),o=t.readu32();return a({versionMajor:n,versionMinor:r,profile:(65024&i)>>9,level:(504&i)>>3,rpuPresentFlag:(4&i)>>2==1,elPresentFlag:(2&i)>>1==1,blPresentFlag:1==(1&i),blSignalCompatibilityId:(4026531840&o)>>28},e)}),e})();t.DVCCBoxParsers=n}));e(To);To.DVCCBoxParsers;var wo=t(freeOnUnref(function(e,t){var f=ce&&ce.__assign||freeOnUnref(function(){return(f=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function l(){}return l.registerSampleGroupType=freeOnUnref(function(e,t){l.groupingTypeParsers[e]=t}),l.rawSampleParser=freeOnUnref(function(e){return{reader:e.readBuffer()}}),l.parse=freeOnUnref(function(e,t){var n=t.readu8(),r=f({version:n,flags:t.readu24(),groupingType:t.readu32(),defaultLength:1===n?t.readu32():0,defaultSampleDescriptionIndex:2<=n?t.readu32():0,entryCount:t.readu32(),entries:[]},e),i=Qe.withDefault(l.groupingTypeParsers[r.groupingType],l.rawSampleParser);if(1===n)for(var o=0;o<r.entryCount;o++){var a=0===r.defaultLength?t.readu32():r.defaultLength,s=t.readBuffer(a);r.entries.push(i(s))}else for(;t.hasData();)r.entries.push(i(t));return r}),l.groupingTypeParsers={},l})();t.SGPDParser=n}));e(wo);wo.SGPDParser;var Io=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function r(){}return r.getBoxStructure=freeOnUnref(function(){return this.boxStructure}),r.registerBox=freeOnUnref(function(e,t){var n={parser:null,children:r.boxStructure};So.registerParser(n,e,t)}),r.boxStructure={moov:{parser:null,children:{mvhd:{parser:Oo.BmffBoxParsers.parseMVHD,children:null},trak:{parser:null,postProcessor:bo.BmffTrackPostProcessor.process,children:{tkhd:{parser:Oo.BmffBoxParsers.parseTKHD,children:null},mdia:{parser:null,children:{mdhd:{parser:Oo.BmffBoxParsers.parseMDHD,children:null},hdlr:{parser:Oo.BmffBoxParsers.parseHDLR,children:null},minf:{parser:null,children:{stbl:{parser:null,children:{stsd:{parser:Oo.BmffBoxParsers.parseSTSD,children:null},sgpd:{parser:wo.SGPDParser.parse,children:null}}}}}}}}},mvex:{parser:null,children:{mehd:{parser:Oo.BmffBoxParsers.parseMEHD,children:null},trex:{parser:Oo.BmffBoxParsers.parseTREX,children:null}}}}},moof:{parser:null,children:{mfhd:{parser:Oo.BmffBoxParsers.parseMFHD,children:null},traf:{parser:null,children:{tfhd:{parser:Oo.BmffBoxParsers.parseTFHD,children:null},trun:{parser:Oo.BmffBoxParsers.parseTRUN,children:null},tfdt:{parser:Oo.BmffBoxParsers.parseTFDT,children:null},sgpd:{parser:wo.SGPDParser.parse,children:null},sbgp:{parser:Oo.BmffBoxParsers.parseSBGP,children:null},saio:{parser:Oo.BmffBoxParsers.parseSAIO,children:null},saiz:{parser:Oo.BmffBoxParsers.parseSAIZ,children:null}}}}},mdat:{parser:Oo.BmffBoxParsers.parseMDAT,children:null},sidx:{parser:Oo.BmffBoxParsers.parseSIDX,children:null},emsg:{parser:Oo.BmffBoxParsers.parseEMSG,children:null}},r})();t.BmffBoxStructure=n}));e(Io);Io.BmffBoxStructure;var ko=t(freeOnUnref(function(e,t){var o=ce&&ce.__assign||freeOnUnref(function(){return(o=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.register=freeOnUnref(function(){Io.BmffBoxStructure.registerBox("pssh",{parser:e.parsePSSH,children:null}),Io.BmffBoxStructure.registerBox("moof/pssh",{parser:e.parsePSSH,children:null}),Io.BmffBoxStructure.registerBox("moov/pssh",{parser:e.parsePSSH,children:null}),bo.BmffTrackPostProcessor.registerSampleSubBox("vide","sinf/schi/tenc",{parser:e.parseTENC,children:null}),bo.BmffTrackPostProcessor.registerSampleSubBox("soun","sinf/schi/tenc",{parser:e.parseTENC,children:null}),wo.SGPDParser.registerSampleGroupType(Uo.Boxes.fourCCToNumber("seig"),e.parseCencSampleEncryptionInformationGroupEntry)}),e.parseTENC=freeOnUnref(function(e,t){return t.skip(1),t.skip(3),o({defaultIsEncrypted:0!==t.readu24(),defaultIvSize:t.readu8(),defaultKID:t.readUint8Array(16)},e)}),e.parseCencSampleEncryptionInformationGroupEntry=freeOnUnref(function(e){return{isEncrypted:0!==e.readu24(),ivSize:e.readu8(),KID:e.readUint8Array(16)}}),e.parsePSSH=freeOnUnref(function(e,t){var n=t.readu8();t.skip(3);var r=o({systemId:t.readUUID(),dataSize:-1,data:null},e);if(0<n){r.kidCount=t.readu32(),r.kids=[];for(var i=0;i<r.kidCount;i++)r.kids[i]=t.readUint8Array(16)}return r.dataSize=t.readu32(),r.data=t.readUint8Array(r.dataSize),r}),e})();t.CENCBoxParsers=n}));e(ko);ko.CENCBoxParsers;var _o=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function o(){this.boxParsers=Io.BmffBoxStructure.getBoxStructure(),this.boxParser=new vo.BoxParser}return o.prototype.parseFragment=freeOnUnref(function(e,t){return this.parseBoxes(e,t)}),o.prototype.parse=freeOnUnref(function(e){return this.parseOneBox(e)}),o.prototype.parseBoxes=freeOnUnref(function(e,t){var n=Yi.DataReader.from(e),r=null!=t?x.pick(this.boxParsers,t):this.boxParsers,i=n.remaining();return{type:o.ROOT_BOX_TYPE,size:i,boxContentsSize:i,absoluteStartPosition:0,boxes:this.boxParser.parseBoxes(n,r,"")}}),o.prototype.parseOneBox=freeOnUnref(function(e,t){var n=Yi.DataReader.from(e);return this.boxParser.parseBox(n,this.boxParsers,"")}),o.prototype.peek=freeOnUnref(function(e){var t=Yi.DataReader.from(e);return this.boxParser.peek(t,"")}),o.ROOT_BOX_TYPE="root",o})();t.BmffParser=n,freeOnUnref(function(){ko.CENCBoxParsers.register(),Po.AC3BoxParsers.register(),Mo.AV1BoxParsers.register(),Co.AVCBoxParsers.register(),Eo.HEVCBoxParsers.register(),To.DVCCBoxParsers.register()})()}));e(_o);_o.BmffParser;var Ro=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("CencParser"),n=freeOnUnref(function(){function e(){}return e.prototype.parseSampleAuxiliaryInfo=freeOnUnref(function(e,t){t<0&&l.warn("[neguintarray] SampleAuxiliaryInfo has a negative ivSize of: "+t);var n={initializationVector:new Uint8Array(e.buffer,e.byteOffset,t),entries:[]};if(e.byteLength>t){var r=0,i=new DataView(e.buffer,e.byteOffset+t,e.byteLength-t),o=i.getUint16(r);r+=2;for(var a=0;a<o;a++){var s={bytesOfClearData:i.getUint16(r),bytesOfProtectedData:i.getUint32(r+2)};r+=6,n.entries.push(s)}}return n}),e})();t.CencParser=n}));e(Ro);Ro.CencParser;var Ao=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BmffParser=_o.BmffParser,t.Boxes=Uo.Boxes,t.CencParser=Ro.CencParser}));e(Ao);Ao.BmffParser,Ao.Boxes,Ao.CencParser;var Do=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,n){var r=this;this.keyStatusMap={},e.forEach(freeOnUnref(function(e,t){r.keyStatusMap[Lr.encode(t)]=n}))}return Object.defineProperty(e.prototype,"size",{get:freeOnUnref(function(){return Object.keys(this.keyStatusMap).length}),enumerable:!0,configurable:!0}),e.prototype.has=freeOnUnref(function(e){return Lr.encode(e)in this.keyStatusMap}),e.prototype.get=freeOnUnref(function(e){return this.keyStatusMap[Lr.encode(e)]}),e.prototype.forEach=freeOnUnref(function(e){for(var t=0,n=Object.keys(this.keyStatusMap);t<n.length;t++){var r=n[t];this.keyStatusMap.hasOwnProperty(r)&&e(this.keyStatusMap[r],Lr.decode(r))}}),e})(),r=freeOnUnref(function(){function e(){this.drmKeyStatusMap=null}return Object.defineProperty(e.prototype,"size",{get:freeOnUnref(function(){return Qe.exists(this.drmKeyStatusMap)?this.drmKeyStatusMap.size:0}),enumerable:!0,configurable:!0}),e.prototype.has=freeOnUnref(function(e){return!!Qe.exists(this.drmKeyStatusMap)&&this.drmKeyStatusMap.has(Yi.BinaryUtils.convertBufferSourceToUint8Array(e))}),e.prototype.get=freeOnUnref(function(e){if(Qe.exists(this.drmKeyStatusMap))return this.drmKeyStatusMap.get(Yi.BinaryUtils.convertBufferSourceToUint8Array(e))}),e.prototype.forEach=freeOnUnref(function(n){if(Qe.exists(this.drmKeyStatusMap))return this.drmKeyStatusMap.forEach(freeOnUnref(function(e,t){n(e,t.buffer)}))}),e.prototype.setAllKeyStatusesAs=freeOnUnref(function(e){Qe.exists(this.drmKeyStatusMap)&&(this.drmKeyStatusMap=new n(this.drmKeyStatusMap,e))}),e.prototype.setDrmKeyStatusMap=freeOnUnref(function(e){this.drmKeyStatusMap=e}),e})();t.MediaKeyStatusMapProxy=r}));e(Do);Do.MediaKeyStatusMapProxy;var xo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.promisify=function(i,o){for(var a=[],e=2;e<arguments.length;e++)a[e-2]=arguments[e];return new lt.Promise(freeOnUnref(function(t,n){var e=freeOnUnref(function(e){null!=e?n(e):t()}),r=Array.prototype.slice.call(a);r.push(e),o.apply(i,r)}))}}));e(xo);xo.promisify;var Fo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=f.of("PlayReadyPrivateDataExtractor"),n=freeOnUnref(function(){function e(){}return e.prototype.getPrivateKeyIds=freeOnUnref(function(e){s("9a04f079-9840-4286-ab92-e65be0885f95"===e.systemId,"PlayReady PSSH box").is.true();var t=e.data,n=t.byteOffset+10,r=t.byteLength-t.byteLength%2-10,i=t.buffer.slice(n,n+r),o=new Uint16Array(i),a=String.fromCharCode.apply(null,o);return this.getKeyIdsFromWRMHeader(a)}),e.prototype.getKeyIdsFromWRMHeader=freeOnUnref(function(e){var t=e.indexOf("<KID"),n=e.indexOf(">",t),r=e.indexOf("</KID"),i=e.substring(n+1,r),o=Lr.decode(i);return[this.reorderKeyId(o)]}),e.prototype.reorderKeyId=freeOnUnref(function(e){var t=new Uint8Array(e.length);t[0]=e[3],t[1]=e[2],t[2]=e[1],t[3]=e[0],t[4]=e[5],t[5]=e[4],t[6]=e[7],t[7]=e[6];for(var n=8;n<t.length;++n)t[n]=e[n];return t}),e})();t.PlayReadyPrivateDataExtractor=n}));e(Fo);Fo.PlayReadyPrivateDataExtractor;var Bo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=f.of("WidevinePrivateDataExtractor"),n=freeOnUnref(function(){function a(){}return a.prototype.getPrivateKeyIds=freeOnUnref(function(e){s("edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===e.systemId,"Widevine PSSH box").is.true();var t=Yi.ProtobufDecoder.parse(e.data)[a.KEY_IDS_IDX];if(Array.isArray(t)){for(var n=t,r=0,i=n;r<i.length;r++){var o=i[r];s(o instanceof Uint8Array,"keyIds instanceof Uint8Array").is.true()}return n}return s(t instanceof Uint8Array,"keyIds instanceof Uint8Array").is.true(),[t]}),a.KEY_IDS_IDX=2,a})();t.WidevinePrivateDataExtractor=n}));e(Bo);Bo.WidevinePrivateDataExtractor;var Lo=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var i=((n={})[0]="license-request",n[1]="license-renewal",n[2]="license-release",n[3]="individualization-request",n),o=f.of("MediaKeySessionDrm"),a=de.get("MediaKeySessionDrm"),r=freeOnUnref(function(){function e(e,t){var r=this;this.onDrmSessionMessage=freeOnUnref(function(e,t){var n={messageType:i[e],message:t};r.callable?r.eventEmitter.emit("message",n):r.queuedMessageEvents.push(n)}),this.releaseQueuedMessageEvents=freeOnUnref(function(){for(var e=0,t=r.queuedMessageEvents;e<t.length;e++){var n=t[e];r.eventEmitter.emit("message",n)}r.queuedMessageEvents=[]}),this.sessionIdValue="",this.expirationValue=NaN,this.closedDeferred=new lt.Deferred,this.keyStatusMap=new Do.MediaKeyStatusMapProxy,this.sessionType=t,this.uninitialized=!0,this.callable=!1,this.closingOrClosed=!1,this.mediaKeysDrm=e,this.systemId=e.systemId,this.drmSession=null,this.bridge=e.mediaKeysBridge,this.eventEmitter=new A.EventEmitter,this.queuedMessageEvents=[]}return Object.defineProperty(e.prototype,"sessionId",{get:freeOnUnref(function(){return this.sessionIdValue}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expiration",{get:freeOnUnref(function(){return this.expirationValue}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closed",{get:freeOnUnref(function(){return this.closedDeferred.promise}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyStatuses",{get:freeOnUnref(function(){return this.keyStatusMap}),enumerable:!0,configurable:!0}),e.prototype.generateRequest=freeOnUnref(function(e,t){var r=this;if(o(e,"initDataType").exists(),o(t,"initData").exists(),this.closingOrClosed)return lt.Promise.reject(new Error("Session is closing or closed"));if(!this.uninitialized)return lt.Promise.reject(new Error("Session is already initialized"));if(this.uninitialized=!1,""===e)return lt.Promise.reject(new TypeError("initDataType cannot be empty"));if(0===t.byteLength)return lt.Promise.reject(new TypeError("initData cannot be empty"));if("cenc"!==e)return lt.Promise.reject(new Error('Initialization Data Type "'+e+'" is not supported.'));var i=ArrayBuffer.isView(t)?t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength):t.slice(0),n=new lt.Promise(freeOnUnref(function(t,e){var n=r.extractSystemPSSH(i);null!==n?r.createDrmSession().then(freeOnUnref(function(e){return r.generateRequestOnCDM(e,n)})).then(freeOnUnref(function(e){r.drmSession=e,r.sessionIdValue=r.drmSession.sessionId,r.callable=!0,t()})).catch(e):e(new TypeError("Invalid cenc init data: no PSSH for current DRM system"))}));return n.then(this.releaseQueuedMessageEvents),n}),e.prototype.load=freeOnUnref(function(n){var r=this;return this.closingOrClosed?lt.Promise.reject(new Error("Session is closing or closed")):this.uninitialized?(this.uninitialized=!1,""===n?lt.Promise.reject(new TypeError("sessionId cannot be empty")):new lt.Promise(freeOnUnref(function(e,t){""===r.sanitizeSessionID(n)&&t(new TypeError("SessionID cannot be empty")),e(!1)}))):lt.Promise.reject(new Error("Session has already been initialized"))}),e.prototype.update=freeOnUnref(function(e){var i=this;if(this.closingOrClosed)return lt.Promise.reject(new Error("Cannot update a closing or closed session"));if(!this.callable)return lt.Promise.reject(new Error("Session is not callable"));if(0===e.byteLength)return lt.Promise.reject(new TypeError("Response cannot be empty"));var o=ArrayBuffer.isView(e)?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e.slice(0);return new lt.Promise(freeOnUnref(function(t,n){var r=new Uint8Array(o);null!=i.drmSession?i.drmSession.processResponse(r,freeOnUnref(function(e){null!=e?n(e):(i.updateKeyStatuses(r),t())})):n(new Error("Native drmSession is null"))}))}),e.prototype.close=freeOnUnref(function(){var t=this;return this.closingOrClosed?lt.Promise.resolve():this.callable?(this.closingOrClosed=!0,this.ensureSessionNotInUse(this.sessionIdValue).then(freeOnUnref(function(){return xo.promisify(t.drmSession,t.drmSession.close)})).then(freeOnUnref(function(){return t.sessionClosed()})).catch(freeOnUnref(function(e){a.error("Something failed while closing session "+t.sessionIdValue,e)}))):lt.Promise.reject(new Error("Cannot close non-callable session"))}),e.prototype.remove=freeOnUnref(function(){return lt.Promise.reject(new Error("Not implemented"))}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.createDrmSession=freeOnUnref(function(){var i=this,o=this.mediaKeysDrm.systemPromise;return o.then(freeOnUnref(function(e){return new lt.Promise(freeOnUnref(function(n,r){e.createSession(freeOnUnref(function(e,t){null!=e?(1005===e.code&&o===i.mediaKeysDrm.systemPromise&&(a.warn("Detected errorCode "+e.code+" requiring full DRM System reset"),i.mediaKeysDrm.resetDrmSystem()),r(e)):null==t?r(new Error("No session returned")):(t.onMessage(i.onDrmSessionMessage),n(t))}))}))}))}),e.prototype.extractSystemPSSH=freeOnUnref(function(e){var t=this,n=(new Ao.BmffParser).parseFragment(e),r=Ao.Boxes.all(n,Ao.Boxes.ofType("pssh")),i=x.find(r,freeOnUnref(function(e){return e.systemId===t.systemId}));return Qe.withDefault(i,null)}),e.prototype.generateRequestOnCDM=freeOnUnref(function(i,o){return new lt.Promise(freeOnUnref(function(t,n){var e=[];switch(o.systemId){case"9a04f079-9840-4286-ab92-e65be0885f95":e=(new Fo.PlayReadyPrivateDataExtractor).getPrivateKeyIds(o);break;case"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":e=(new Bo.WidevinePrivateDataExtractor).getPrivateKeyIds(o)}var r=x.defaults(o,{kids:e,kidCount:e.length});i.generateRequest(r,freeOnUnref(function(e){null!=e?n(e):t(i)}))}))}),e.prototype.sanitizeSessionID=freeOnUnref(function(e){return e}),e.prototype.updateKeyStatuses=freeOnUnref(function(e){this.keyStatusMap.setDrmKeyStatusMap(this.drmSession.keyStatusMap),this.eventEmitter.emit("keystatuseschange")}),e.prototype.sessionClosed=freeOnUnref(function(){this.closingOrClosed=!0,this.keyStatusMap.setDrmKeyStatusMap(null),this.updateExpiration(NaN),this.closedDeferred.resolve()}),e.prototype.updateExpiration=freeOnUnref(function(e){this.expirationValue=e}),e.prototype.ensureSessionNotInUse=freeOnUnref(function(e){return null==this.bridge.value?lt.Promise.resolve():this.bridge.value.ensureDrmSessionNotInUse(e)}),e})();t.MediaKeySessionDrm=r}));e(Lo);Lo.MediaKeySessionDrm;var No=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("MediaKeysDrm"),o=f.of("MediaKeysDrm"),a={"com.microsoft.playready":"9a04f079-9840-4286-ab92-e65be0885f95","com.widevine.alpha":"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","org.w3.clearkey":"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b"},n=freeOnUnref(function(){function e(e,t,n){var r=this;this.onKeyStatusesChange=freeOnUnref(function(){r.newKeysCallback.invoke()}),this.invokeErrorCallback=freeOnUnref(function(e){var t=r.mapDrmErrorCodeToXpErrorCode(e.code),n=new ct.XpError(t,void 0,e.message,void 0,e);r.errorCallback.invokeSync(n)}),this.mapDrmErrorCodeToXpErrorCode=freeOnUnref(function(e){switch(e){case 1001:return Ni.codes.xp.system.hdcp_insufficient;case 1004:return Ni.codes.xp.system.display_disconnected;default:return Ni.codes.xp.unknown}}),this.closeAndEmptyAllSessions=freeOnUnref(function(){r.keySessions.forEach(freeOnUnref(function(e){e.keyStatuses.setAllKeyStatusesAs("internal-error")})),i.info("Closed and emptied all cached Key Sessions")}),o(t,"drmSystem").exists(),this.bridge={value:null},this.keySystem=e,this.systemId=a[e],this.drmSystemPromise=lt.Promise.resolve(t),this.drmProvider=n,this.keySessions=[],this.newKeysCallback=new A.MulticastCallback,this.errorCallback=new A.MulticastCallback,t.onError(this.invokeErrorCallback)}return Object.defineProperty(e.prototype,"systemPromise",{get:freeOnUnref(function(){return this.drmSystemPromise}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mediaKeysBridge",{get:freeOnUnref(function(){return this.bridge}),enumerable:!0,configurable:!0}),e.prototype.createSession=freeOnUnref(function(e){var t=this;if(void 0===e&&(e="temporary"),"temporary"!==e)throw new Error("Only temporary sessions are supported");var n=new Lo.MediaKeySessionDrm(this,e);return n.closed.then(freeOnUnref(function(){var e=x.indexOf(t.keySessions,n);-1!==e&&t.keySessions.splice(e,1),n.off("keystatuseschange",t.onKeyStatusesChange)})),n.on("keystatuseschange",this.onKeyStatusesChange),this.keySessions.push(n),n}),e.prototype.setServerCertificate=freeOnUnref(function(e){return lt.Promise.resolve(!1)}),e.prototype.getStatusForPolicy=freeOnUnref(function(e){var t=zt.deviceCapabilities.output.video.display.hdcpStatus,n=Number(e.minHdcpVersion);return isNaN(n)?lt.Promise.resolve("output-restricted"):"NoDigitalOutput"===t||"V2_2"===t&&n<=2.2||"V1"===t&&n<=1.4?lt.Promise.resolve("usable"):lt.Promise.resolve("output-restricted")}),e.prototype.setHdcpTestKeyId=freeOnUnref(function(e,t){}),e.prototype.onError=freeOnUnref(function(e){this.errorCallback.add(e)}),e.prototype.offError=freeOnUnref(function(e){this.errorCallback.remove(e)}),e.prototype.getSessionForKeyId=freeOnUnref(function(e){for(var t=0,n=this.keySessions;t<n.length;t++){var r=n[t];if(""!==r.sessionId&&!r.closingOrClosed&&0<r.keyStatuses.size&&"usable"===r.keyStatuses.get(e))return r.sessionId}return null}),e.prototype.onKeyLoaded=freeOnUnref(function(e){this.newKeysCallback.add(e)}),e.prototype.offKeyLoaded=freeOnUnref(function(e){this.newKeysCallback.remove(e)}),e.prototype.attach=freeOnUnref(function(e){this.bridge.value=e}),e.prototype.resetDrmSystem=freeOnUnref(function(){var r=this;this.closeAndEmptyAllSessions(),this.drmSystemPromise=new lt.Promise(freeOnUnref(function(t,n){return r.drmProvider.destroySystem(r.keySystem,freeOnUnref(function(e){null!=e&&(r.invokeErrorCallback(e),n(e)),t()}))})).then(freeOnUnref(function(){return go.MediaKeyFactory.createSystem(r.drmProvider,r.keySystem)}))}),e.isValidKeySystem=freeOnUnref(function(e){return Qe.exists(a[e])}),e})();t.MediaKeysDrm=n}));e(No);No.MediaKeysDrm;var Vo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaKeys=No.MediaKeysDrm,t.MediaKeySession=Lo.MediaKeySessionDrm,t.MediaKeyFactory=go.MediaKeyFactory}));e(Vo);Vo.MediaKeys,Vo.MediaKeySession,Vo.MediaKeyFactory;var jo=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.Playback="Playback",e.Download="Download"})(n||(n={})),t.MediaKeysPurpose=n}));e(jo);jo.MediaKeysPurpose;var qo=t(freeOnUnref(function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("MediaKeysAccessor"),l=["com.widevine.alpha","com.microsoft.playready"],i=freeOnUnref(function(){function a(){}return a.getSupportedKeySystem=freeOnUnref(function(){return null!=Vo.MediaKeyFactory.overrideKeySystem?(s.info("Device configured with a Key System override. This Key System is used directly without probing. override: "+Vo.MediaKeyFactory.overrideKeySystem),lt.Promise.resolve(Vo.MediaKeyFactory.overrideKeySystem)):a.getMediaKeys().then(freeOnUnref(function(e){return e.system})).catch(freeOnUnref(function(){s.warn("Could not create a MediaKeys instance of ANY type. Attempting to play encrypted media WILL fail on devices that can't recover")}))}),a.getMediaKeys=freeOnUnref(function(e){if(void 0===e&&(e=jo.MediaKeysPurpose.Playback),null==a.separateDownloadMediaKeys){var t=L.configurationStore.configuration;(a.separateDownloadMediaKeys=null!=t&&null!=t.drm&&!0===t.drm.separateDownloadMediaKeys)&&s.info("Use separate MediaKeys instances for Playback and Downloads")}var n=a.separateDownloadMediaKeys?e:jo.MediaKeysPurpose.Playback;return null!=a.cachedFactoryResult[n]?a.cachedFactoryResult[n]:(null!=a.pendingFactoryPromise[n]||(a.pendingFactoryPromise[n]=a.internalGetMediaKeys(e).then(freeOnUnref(function(e){return a.cachedFactoryResult[n]=a.pendingFactoryPromise[n],e})).catch(freeOnUnref(function(e){throw a.pendingFactoryPromise[n]=null,e}))),a.pendingFactoryPromise[n])}),a.internalGetMediaKeys=freeOnUnref(function(t){var e;null!=Vo.MediaKeyFactory.overrideKeySystem?(s.info("Device configured with a Key System override. Ignoring any other Key Systems. override: "+Vo.MediaKeyFactory.overrideKeySystem),e=[Vo.MediaKeyFactory.overrideKeySystem]):e=null!=Vo.MediaKeyFactory.supportedKeySystems&&0<Vo.MediaKeyFactory.supportedKeySystems.length?Vo.MediaKeyFactory.supportedKeySystems:l,s.info("Attempting to create MediaKeys for "+t);for(var n=null,r=freeOnUnref(function(e){n=null==n?a.tryCreateMediaKeys(e,t):n.catch(freeOnUnref(function(){return a.tryCreateMediaKeys(e,t)}))}),i=0,o=e;i<o.length;i++){r(o[i])}return n.then(freeOnUnref(function(e){return s.info("MediaKeys created for "+t+" using keySystem "+e.system),e})).catch(freeOnUnref(function(e){throw s.error("Could not create a Widevine or PlayReady MediaKeys instance for "+t+". Error:",e),e}))}),a.tryCreateMediaKeys=freeOnUnref(function(t,n){return Vo.MediaKeyFactory.create(t).then(freeOnUnref(function(e){return{system:t,mediaKeys:e,purpose:n}}))}),a.cachedFactoryResult=((n={})[jo.MediaKeysPurpose.Playback]=null,n[jo.MediaKeysPurpose.Download]=null,n),a.pendingFactoryPromise=((r={})[jo.MediaKeysPurpose.Playback]=null,r[jo.MediaKeysPurpose.Download]=null,r),a.separateDownloadMediaKeys=null,a})();t.MediaKeysAccessor=i}));e(qo);qo.MediaKeysAccessor;var Ho=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=f.of("BinaryConverter"),n=freeOnUnref(function(){function t(){}return t.arrayBufferToString=freeOnUnref(function(e){return i(e,"arrayBuffer").exists(),String.fromCharCode.apply(null,new Uint8Array(e))}),t.uint8ArrayToString=freeOnUnref(function(e){return i(e,"array").exists(),String.fromCharCode.apply(null,e)}),t.uint16ArrayToString=freeOnUnref(function(e){return i(e,"array").exists(),String.fromCharCode.apply(null,e)}),t.toUTF16LE=freeOnUnref(function(e){i(e,"text").exists();for(var t=new ArrayBuffer(2*e.length),n=new DataView(t),r=0;r<e.length;r++)n.setUint16(2*r,e.charCodeAt(r),!0);return new Uint8Array(t)}),t.stringToArrayBuffer=freeOnUnref(function(e){return t.stringToUint8Array(e).buffer}),t.stringToUint8Array=freeOnUnref(function(e){i(e,"text").exists();for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n}),t})();t.BinaryConverter=n}));e(Ho);Ho.BinaryConverter;var zo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("CENCKeyIdExtractor"),n=freeOnUnref(function(){function e(e,t){void 0===t&&(t=new Ao.BmffParser),this.systemId=e,this.bmffParser=t}return e.prototype.extractDRMKeyInfoFromInitData=freeOnUnref(function(e){return{keyId:this.extractFromInitData(e),allKeyIds:this.extractAllKeyIdsFromInitData(e)}}),e.prototype.extractFromInitData=freeOnUnref(function(e){try{var t=this.bmffParser.parseFragment(e),n=Ao.Boxes.all(t,Ao.Boxes.ofType("pssh"));return this.extractFromPSSH(n)}catch(e){return o.error("Failed to extract keyId from initData",e),null}}),e.prototype.extractAllKeyIdsFromInitData=freeOnUnref(function(e){try{var t=this.bmffParser.parseFragment(e),n=Ao.Boxes.all(t,Ao.Boxes.ofType("pssh"));return this.extractAllKeyIdsFromPSSH(n)}catch(e){return o.error("Failed to extract all keyIds from initData",e),null}}),e.prototype.extractFromPSSH=freeOnUnref(function(e){var t=this,n=e.filter(freeOnUnref(function(e){return e.systemId===t.systemId}));return null==n||0===n.length?(o.error("Could not find a PSSH box for system id "+this.systemId),null):this.extractFromPrivateData(n[0].data)}),e.prototype.extractAllKeyIdsFromPSSH=freeOnUnref(function(e){var t=this,n=e.filter(freeOnUnref(function(e){return e.systemId===t.systemId}));return null==n||0===n.length?(o.error("Could not find a PSSH box for system id "+this.systemId),null):this.extractAllKeyIdsFromPrivateData(n[0].data)}),e.prototype.extractFromContentProtectionHeader=freeOnUnref(function(e){var t=this,n=e.filter(freeOnUnref(function(e){return e.systemId===t.systemId}));if(null==n||0===n.length)return o.error("Could not find a ContentProtection header for system id "+this.systemId),null;var r=atob(n[0].value),i=Ho.BinaryConverter.stringToUint8Array(r);return this.extractFromPrivateData(i)}),e.prototype.extractAllKeyIdsFromPrivateData=freeOnUnref(function(e){var t=this.extractFromPrivateData(e);return null===t?null:[t]}),e})();t.CencKeyIdExtractor=n}));e(zo);zo.CencKeyIdExtractor;var Wo=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("WidevineCencKeyIdExtractor"),n=freeOnUnref(function(t){function n(e){return t.call(this,n.WIDEVINE_SYSTEM_ID,e)||this}return r(n,t),n.prototype.extractFromPrivateData=freeOnUnref(function(e){try{var t=Yi.ProtobufDecoder.parse(e)[2];return Lr.encode(t)}catch(e){return o.error("Failed to extract keyId from initData.",e),null}}),n.prototype.extractAllKeyIdsFromPrivateData=freeOnUnref(function(e){var t=null,n=null,r=this.extractFromPrivateData(e);null!==r&&(n=[r]);try{var i=Yi.ProtobufDecoder.parse(e)[4];return 0===(t=Ho.BinaryConverter.uint8ArrayToString(i)).lastIndexOf("key-id:",0)?n:0===t.lastIndexOf("cid:",0)?t.substring("cid:".length).split(","):(o.error("Unexpected format. keyIdString = "+t+" does not start with key-id: or cid: so we are returning fallbackKeyIds = "+n),q.metrics.putMetric("Widevine.InvalidKeyIdPrefix"),q.metrics.putMetric("SingleMediaSession.FallbackToDoubleRequest"),n)}catch(e){return o.error("Failed to extract all keyIds from initData. keyIdString = "+t+" and fallbackKeyIds = "+n,e),q.metrics.putMetric("Widevine.FailedToExtractAllKeyIds"),q.metrics.putMetric("SingleMediaSession.FallbackToDoubleRequest"),n}}),n.WIDEVINE_SYSTEM_ID="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",n})(zo.CencKeyIdExtractor);t.WidevineCencKeyIdExtractor=n}));e(Wo);Wo.WidevineCencKeyIdExtractor;var Ko=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("PlayReadyCencKeyIdExtractor"),r=freeOnUnref(function(t){function a(e){return t.call(this,a.PLAYREADY_SYSTEM_ID,e)||this}return n(a,t),a.prototype.extractFromPrivateData=freeOnUnref(function(e){var t=e.byteOffset+10,n=e.byteOffset+(e.byteLength-e.byteLength%2),r=e.buffer.slice(t,n),i=String.fromCharCode.apply(null,new Uint16Array(r)),o=a.KID_REGEX.exec(i);return null==o||o.length<2?(s.warn('Unable to find key id in Rights Management Header "'+i+'"'),null):o[1]}),a.PLAYREADY_SYSTEM_ID="9a04f079-9840-4286-ab92-e65be0885f95",a.KID_REGEX=/<KID>([^<]*)<\/KID>/,a})(zo.CencKeyIdExtractor);t.PlayReadyCencKeyIdExtractor=r}));e(Ko);Ko.PlayReadyCencKeyIdExtractor;var Go=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.create=freeOnUnref(function(e){if(0===e.indexOf("com.microsoft.playready"))return new Ko.PlayReadyCencKeyIdExtractor;if(0===e.indexOf("com.chromecast.playready"))return new Ko.PlayReadyCencKeyIdExtractor;if("com.widevine.alpha"===e)return new Wo.WidevineCencKeyIdExtractor;throw new Error("Cannot create a key id extractor for system "+e+": Unknown systemId")}),e})();t.CencKeyIdExtractorFactory=n}));e(Go);Go.CencKeyIdExtractorFactory;var Qo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var h=de.get("MediaKeysManager"),r={Pending:{id:"pending",keyType:"CONTENT"}};function i(t){return freeOnUnref(function(e){return e.sessionId===t})}function m(){var e=L.configurationStore.configuration;return null!=e&&null!=e.drm&&!0===e.drm.useSingleMediaKeySession}Object.freeze(r);var n=freeOnUnref(function(){function p(e,t){var n,r=this;this.sessionsOpenPending=0,this.mediaKeySessions=[],this.requestedKeyIds=[],this.keyIdExtractor=null,this.onKeyStatusChange=freeOnUnref(function(e){r.eventEmitter.emit("keyStatusChange",e)}),this.diagnostics=nn.Diagnostics.create("MediaKeysManager"),this.eventEmitter=new A.EventEmitter,this.hdcpStore=e,this.traceEventController=t,this.state={mediaKeys:(n={},n[jo.MediaKeysPurpose.Playback]={status:"pending"},n),sessions:{}},this.reportDiagnostics();var i=L.configurationStore.configuration,o=null!=i&&null!=i.drm&&!0===i.drm.separateDownloadMediaKeys;this.usePersistentSession=null!=i&&null!=i.drm&&!0===i.drm.usePersistentSession,this.usePersistentSession&&h.info("Device is configured for persistent sessions. ALL DRM sessions will be created as persistent!");var a=Qe.nestedValue(zt.deviceInformation,"encryptedMedia.maxSupportedMediaKeySessions",11);if(null!=i&&null!=i.drm&&null!=i.drm.maxOpenDrmSessions){var s=parseInt(""+i.drm.maxOpenDrmSessions);0<s&&s<a&&(a=s)}this.maxCachedOpenSessions=a,h.info("Will keep up to "+this.maxCachedOpenSessions+" cached DRM sessions, separateDownloadMediaKeys: "+o),this.prepareMediaKeys(jo.MediaKeysPurpose.Playback),o&&(this.state.mediaKeys[jo.MediaKeysPurpose.Download]={status:"pending"},this.prepareMediaKeys(jo.MediaKeysPurpose.Download))}return p.getSupportedKeySystem=freeOnUnref(function(){return qo.MediaKeysAccessor.getSupportedKeySystem()}),p.prototype.reset=freeOnUnref(function(){for(var e=0,t=this.mediaKeySessions;e<t.length;e++){var n=t[e];null!=n.mediaKeySessionManager&&this.terminateMediaKeySessionManager(n.mediaKeySessionManager)}this.mediaKeySessions=[],this.requestedKeyIds=[],this.state.sessions={},this.reportDiagnostics()}),p.getMediaKeys=freeOnUnref(function(e){return void 0===e&&(e=jo.MediaKeysPurpose.Playback),qo.MediaKeysAccessor.getMediaKeys(e)}),p.prototype.applyInitData=freeOnUnref(function(o,a,s,e,r,i){var l,f,u,c,d,p=this;return void 0===e&&(e=jo.MediaKeysPurpose.Playback),void 0===r&&(r=!1),h.info(">> applyInitData, purpose: "+e+", persistent: "+r),qo.MediaKeysAccessor.getMediaKeys(e).then(freeOnUnref(function(e){l=e.system,f=e.mediaKeys,null===p.keyIdExtractor&&(p.keyIdExtractor=Go.CencKeyIdExtractorFactory.create(l));var t=p.keyIdExtractor.extractDRMKeyInfoFromInitData(a);if(u=t.keyId,c=t.allKeyIds,null===u)return h.warn("InitData is missing a CENC KeyId with key system "+l),null;if(null===c&&(h.info("** allKeyIds is null and we fallback"),c=[u]),1<c.length&&m()&&(i="Dual"),m()&&-1!==p.requestedKeyIds.indexOf(u))return null;var n=p.findMediaKeySessionItemByKeyId(u);return null!=n?n:(m()&&p.updateRequestedKeyIds(c),d="PENDING_SESSION_ID_"+c.sort().join(","),p.createMediaKeySessionItem(e,d,r,c,i))})).then(freeOnUnref(function(t){if(null==t||null==u||null==c)return null;if(null!=t.applyInitDataPromise)return t.applyInitDataPromise;var n=t.mediaKeySessionManager,e=n.mediaKeySession,r=p.createLicenseDataAcquireCallback(l,f,e,u,s),i=n.applyInitData(o,a,r).then(freeOnUnref(function(){var e=n.sessionId;return 0<e.length?(t.sessionId=e,p.formalizeSessionId(d,e),e):null}));return t.applyInitDataPromise=i})).catch(freeOnUnref(function(e){return h.error("Attempted to acquire a license but MediaKeys is not available, cached key count: "+p.mediaKeySessions.length+":",e),p.eventEmitter.emit("error",e),m()&&null!=c&&p.removeFromRequestedKeyIds(c),null}))}),p.prototype.getKeyMetadata=freeOnUnref(function(e){var t=null!=this.keyIdExtractor?this.keyIdExtractor.extractFromInitData(e):null,n=this.findMediaKeySessionItemByKeyId(t);return null!=n?null!=n.keyMetadata?n.keyMetadata:m()?(h.info("[getKeyMetadata] a pending session was requested. Key Metadata not yet available."),[r.Pending]):null:m()&&null!==t&&-1!==this.requestedKeyIds.indexOf(t)?(h.info("[getKeyMetadata] a pending session was requested."),[r.Pending]):null}),p.prototype.loadPersistentLicense=freeOnUnref(function(t,e,n,r){var i=this;return void 0===r&&(r=jo.MediaKeysPurpose.Playback),h.info(">> loadPersistentLicense for session "+t+", key count: "+e.length+", purpose: "+r),this.internalLoad(t,"load",r,e).then(freeOnUnref(function(e){return e?(i.updateSessionState("loaded",t),i.emitLoadedSessionExpiration(t,n),e):(h.warn("Load for sessionId "+t+" failed, not removing any persistent data"),i.removeCachedSession(t),i.updateSessionStateError(new Error("Failed to load"),t),!1)}))}),p.prototype.removePersistentLicense=freeOnUnref(function(t,e){var n=this;return void 0===e&&(e=jo.MediaKeysPurpose.Download),h.info(">> removePersistentLicense for session "+t+", purpose: "+e),this.internalLoad(t,"remove",e).then(freeOnUnref(function(e){return e||h.warn("Load persistent session to be removed for "+t+" failed, attempting to remove session data anyway"),n.internalRemovePersistentLicense(t)}))}),p.prototype.extractKeyId=freeOnUnref(function(n){var r=this;return null!=this.keyIdExtractor?lt.Promise.resolve(this.keyIdExtractor.extractFromInitData(n)):qo.MediaKeysAccessor.getMediaKeys().then(freeOnUnref(function(e){var t=e.system;return null===r.keyIdExtractor&&(r.keyIdExtractor=Go.CencKeyIdExtractorFactory.create(t)),r.keyIdExtractor.extractFromInitData(n)})).catch(freeOnUnref(function(e){return h.error("Attempted to extractKeyId but MediaKeys is not available",e),r.eventEmitter.emit("error",e),null}))}),p.prototype.removeCachedSession=freeOnUnref(function(e,t){void 0===t&&(t=!1);var n=x.findIndex(this.mediaKeySessions,i(e));if(-1<n){var r=this.mediaKeySessions[n];return this.mediaKeySessions.splice(n,1),null!=r.mediaKeySessionManager&&this.terminateMediaKeySessionManager(r.mediaKeySessionManager,t),r}return null}),p.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),p.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),p.prototype.updateRequestedKeyIds=freeOnUnref(function(e){var t=this;e.forEach(freeOnUnref(function(e){-1===t.requestedKeyIds.indexOf(e)&&t.requestedKeyIds.push(e)}))}),p.prototype.removeFromRequestedKeyIds=freeOnUnref(function(e){var n=this;void 0!==e&&e.forEach(freeOnUnref(function(e){var t=n.requestedKeyIds.indexOf(e);-1!==t&&n.requestedKeyIds.splice(t,1)}))}),p.prototype.prepareMediaKeys=freeOnUnref(function(t){var n=this;qo.MediaKeysAccessor.getMediaKeys(t).then(freeOnUnref(function(e){e.mediaKeys.onError(freeOnUnref(function(e){n.eventEmitter.emit("error",e)})),n.state.mediaKeys[t]={status:"ok"},n.reportDiagnostics()})).catch(freeOnUnref(function(e){h.warn("Failed to initialize "+t+" MediaKeys: "+e),n.state.mediaKeys[t]={status:"error",reason:e.toString()},n.reportDiagnostics()}))}),p.prototype.internalLoad=freeOnUnref(function(n,r,e,i){var o=this;return qo.MediaKeysAccessor.getMediaKeys(e).then(freeOnUnref(function(e){if(null==e)return null;var t=o.findMediaKeySessionItemBySessionId(n);return null!=t?t:o.createMediaKeySessionItem(e,n,!0)})).then(freeOnUnref(function(e){if(null==e)return!1;if(null!=e.applyInitDataPromise)return null!=e.keyMetadata||(h.warn("applyInitData was initiated but not completed for session "+n+". Not proceeding "+r+"."),!1);if(e.keyMetadata=i,null!=e.loadPromise)return e.loadPromise;var t=e.mediaKeySessionManager.load(n);return e.loadPromise=t})).catch(freeOnUnref(function(e){return h.error("Attempted to "+r+" persistent license "+n+" but MediaKeys is not available, cached key count: "+o.mediaKeySessions.length+":",e),o.eventEmitter.emit("error",e),!1}))}),p.prototype.internalRemovePersistentLicense=freeOnUnref(function(t){var e=this,n=this.findMediaKeySessionItemBySessionId(t);return null==n?(h.info("Can't find MediaKeySessionItem for session "+t+", no removal possible"),lt.Promise.resolve()):n.mediaKeySessionManager.remove().catch(freeOnUnref(function(e){h.info("Removal of session data for "+t+" failed, ignoring error: "+e)})).then(freeOnUnref(function(){e.removeCachedSession(t),e.updateSessionState("deleted",t)}))}),p.prototype.findMediaKeySessionItemByKeyId=freeOnUnref(function(e){if(null!=e)for(var t=0,n=this.mediaKeySessions;t<n.length;t++){var r=n[t];if(null!=r.allKeyIds&&-1!==r.allKeyIds.indexOf(e))return r}}),p.prototype.findMediaKeySessionItemBySessionId=freeOnUnref(function(e){return x.find(this.mediaKeySessions,i(e))}),p.prototype.limitMediaKeySessionInstances=freeOnUnref(function(){if(this.sessionsOpenPending++,this.mediaKeySessions.length+this.sessionsOpenPending<=this.maxCachedOpenSessions)return lt.Promise.resolve();var e=this.mediaKeySessions.shift();return null==e?lt.Promise.resolve():(h.info("Cached "+this.mediaKeySessions.length+" sessions and "+this.sessionsOpenPending+" pending-open sessions, removing cached sessionId: ["+e.sessionId+"], allKeyIds: "+e.allKeyIds+", sessionManager.sessionId: "+(null!=e.mediaKeySessionManager?e.mediaKeySessionManager.sessionId:null)),null!=e.sessionId&&delete this.state.sessions[e.sessionId],null!=e.mediaKeySessionManager?this.terminateMediaKeySessionManager(e.mediaKeySessionManager):lt.Promise.resolve())}),p.prototype.createMediaKeySessionItem=freeOnUnref(function(a,s,l,f,u){var c=this;return void 0===l&&(l=!1),this.limitMediaKeySessionInstances().then(freeOnUnref(function(){c.sessionsOpenPending--;var e=a.mediaKeys,t=l?"persistent-license":"temporary",n=c.usePersistentSession&&l?"persistent-license":"temporary";if("persistent-license"===t&&"temporary"===n)throw new ct.XpError("media_keys.no_persistence",void 0,"A persistent session was requested, but the device is only configured for temporary licenses");var r=e.createSession(n);h.info("Created mediaKeySession with allKeyIds: "+f+" with type "+n+" when the desired session type was "+t);var i=new Li.MediaKeySessionManager(r,t,n,freeOnUnref(function(e,t){void 0===t&&(t=!0);var n=s;h.info("onError() called for session ["+s+"], allKeyIds: "+f+", error: "+e+", isFatal: "+t+", removing cached keyedSessionId: ["+n+"]");var r=c.removeCachedSession(n,!0);null!=r&&c.updateSessionStateError(e,r.sessionId),t&&c.eventEmitter.emit("error",e)}),c.hdcpStore,c.traceEventController,u);i.initialize();var o={mediaKeySessionManager:i,sessionId:s};return r.closed.then(freeOnUnref(function(){var e=s;null!=c.findMediaKeySessionItemBySessionId(e)&&(h.warn("MediaKeySession for sessionId '"+e+"' unexpectedly closed. Removing MediaKeySessionItem"),c.removeCachedSession(e))})),null!=f&&(o.allKeyIds=f),c.mediaKeySessions.push(o),m()&&c.removeFromRequestedKeyIds(f),c.updateSessionState("pending",s),i.on("keyStatusChange",c.onKeyStatusChange),o}))}),p.prototype.createLicenseDataAcquireCallback=freeOnUnref(function(t,f,u,c,n){var d=this;return freeOnUnref(function(e){return n(t,e).then(freeOnUnref(function(e){var t=p.extractHdcpTestKeyId(e);null!==t&&f.setHdcpTestKeyId(u,Lr.decode(t));var n=d.findMediaKeySessionItemByKeyId(c);null!=n&&(n.keyMetadata=e.keyMetadata);var r,i=e;i.keyId=c,d.eventEmitter.emit("licenseAcquired",i);for(var o=0,a=d.mediaKeySessions;o<a.length;o++){var s=a[o];if(null!=s.allKeyIds&&-1!==s.allKeyIds.indexOf(c)){r=s.sessionId;break}}null!=r&&(h.info("updating session state to loaded for "+r),d.updateSessionState("loaded",r));var l=L.configurationStore.configuration;if(null!=l&&null!=l.drm&&!0===l.drm.dedupeLicenses&&x.every(e.keyMetadata,freeOnUnref(function(t){return x.some(d.mediaKeySessions,freeOnUnref(function(e){return null!=e.keyMetadata&&u.sessionId!==e.sessionId&&x.some(e.keyMetadata,freeOnUnref(function(e){return e.id===t.id&&e.keyType===t.keyType}))}))})))return h.info("["+u.sessionId+"] the keys "+JSON.stringify(e.keyMetadata.map(freeOnUnref(function(e){return e.id})))+" have already been loaded into another MediaKeySessions. Closing this MediaKeySession"),d.removeCachedSession(u.sessionId),{type:"NotNeeded"};return{type:"Successful",license:e.cdmLicenseData}})).catch(freeOnUnref(function(e){for(var t=void 0,n=0,r=d.mediaKeySessions;n<r.length;n++){var i=r[n];if(null!=i.allKeyIds&&-1!==i.allKeyIds.indexOf(c)){t=i.sessionId;break}}throw void 0!==t&&(d.removeCachedSession(t,!0),d.updateSessionStateError(e,t)),e instanceof lt.CancelError||d.eventEmitter.emit("error",e),e}))})}),p.extractHdcpTestKeyId=freeOnUnref(function(e){for(var t=0,n=e.keyMetadata;t<n.length;t++){var r=n[t];if("HDCP_TEST"===r.keyType)return r.id}return null}),p.prototype.formalizeSessionId=freeOnUnref(function(t,n){this.state.sessions[n]=this.state.sessions[t],delete this.state.sessions[t],this.mediaKeySessions.forEach(freeOnUnref(function(e){e.sessionId===t&&(e.sessionId=n)})),this.reportDiagnostics()}),p.prototype.updateSessionState=freeOnUnref(function(e,t){this.state.sessions[t]={status:e},this.reportDiagnostics()}),p.prototype.updateSessionStateError=freeOnUnref(function(e,t){var n=this.state.sessions[t];null!=n&&"error"===n.status||(this.state.sessions[t]={status:"error",reason:e.toString()},this.reportDiagnostics())}),p.prototype.reportDiagnostics=freeOnUnref(function(){this.diagnostics.report("state",this.state)}),p.prototype.emitLoadedSessionExpiration=freeOnUnref(function(e,t){var n=this.findMediaKeySessionItemBySessionId(e);if(null!=n&&null!=n.keyMetadata){var r=n.keyMetadata.filter(freeOnUnref(function(e){return"CONTENT"===e.keyType}))[0],i={keyId:r.id,expiration:n.mediaKeySessionManager.expiration};null!=r&&this.eventEmitter.emit("licenseLoaded",i),null!=t&&t.setExpiration(i)}}),p.prototype.terminateMediaKeySessionManager=freeOnUnref(function(e,t){return void 0===t&&(t=!1),e.off("keyStatusChange",this.onKeyStatusChange),e.terminate(t)}),p})();t.MediaKeysManager=n}));e(Qo);Qo.MediaKeysManager;var Xo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("HdcpStore"),n=freeOnUnref(function(){function e(e){var n=this;this.currentHdcpStatus=null,this.pollingHandle=null,this.shouldPollHdcpStatus=!1,this.updateHdcpStatus=freeOnUnref(function(){return Qo.MediaKeysManager.getMediaKeys().then(freeOnUnref(function(e){var t=e.mediaKeys,n=t.getStatusForPolicy({minHdcpVersion:"2.2"}),r=t.getStatusForPolicy({minHdcpVersion:"1.4"});return lt.Promise.all([n,r])})).then(freeOnUnref(function(e){var t="0";"usable"===e[0]?t="2.2":"usable"===e[1]&&(t="1.4"),null!=n.currentHdcpStatus&&n.currentHdcpStatus===t||(n.notifyHdcpStatusChange(n.currentHdcpStatus,t),n.currentHdcpStatus=t)}))}),this.pollHdcpStatus=freeOnUnref(function(){n.updateHdcpStatus().catch(freeOnUnref(function(e){r.error("Error querying HDCP status: ",e)})).then(freeOnUnref(function(){n.shouldPollHdcpStatus&&(n.pollingHandle=oe.timer.setTimeout(n.pollHdcpStatus,5e3))}))}),this.eventEmitter=new A.EventEmitter,this.useCachedHdcpStatus=e,this.start()}return e.prototype.start=freeOnUnref(function(){this.shouldPollHdcpStatus||(this.shouldPollHdcpStatus=!0,this.pollingHandle=oe.timer.setTimeout(this.pollHdcpStatus,5e3))}),e.prototype.stop=freeOnUnref(function(){this.shouldPollHdcpStatus=!1,null!=this.pollingHandle&&(oe.timer.clearTimeout(this.pollingHandle),this.pollingHandle=null)}),e.compareHdcpStatuses=freeOnUnref(function(e,t){return Number(e)>=Number(t)}),e.prototype.getHdcpStatus=freeOnUnref(function(){var e=this;return null!=this.currentHdcpStatus&&this.useCachedHdcpStatus?lt.Promise.resolve(this.currentHdcpStatus):this.updateHdcpStatus().then(freeOnUnref(function(){return e.currentHdcpStatus}))}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.notifyHdcpStatusChange=freeOnUnref(function(e,t){r.info("HDCP status change detected, previous HDCP status: "+e+", new HDCP status: "+t),this.eventEmitter.emit("hdcpStatusChange")}),e})();t.HdcpStore=n}));e(Xo);Xo.HdcpStore;var Yo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.capabilities={isSupported:!0}}return e.prototype.get=freeOnUnref(function(e){return Pt.localStorage.getText(e).then(freeOnUnref(function(e){return null==e?null:JSON.parse(e)}))}),e.prototype.put=freeOnUnref(function(e,t){return Pt.localStorage.put(e,JSON.stringify(t))}),e.prototype.remove=freeOnUnref(function(e){return Pt.localStorage.remove(e)}),e})();t.MetadataStorage=n}));e(Yo);Yo.MetadataStorage;var Jo=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataStorage=Yo.MetadataStorage;var n=new Yo.MetadataStorage;t.metadataStorage=n}));e(Jo);Jo.MetadataStorage,Jo.metadataStorage;var Zo=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("LicenseConsumptionTracker"),i=freeOnUnref(function(){function e(e){var i=this;this.licenseInformation=null,this.licenseKeyId="",this.setExpiration=freeOnUnref(function(e){if(e.keyId===i.licenseKeyId){var t=i.licenseInformation;if(null===t)return;t.hasBeenConsumed=!0;var n=null==e.expiration||isNaN(e.expiration)?1/0:e.expiration,r=Date.now()+t.playbackExpirationDurationMs;t.viewingEndTimestampMs=Math.min(t.viewingEndTimestampMs,r,n),i.writeLicenseInfoToMetadataStorage()}}),this.licenseInformationMetadataStorageKey=this.createLicenseInformationMetadataKey(e)}return e.prototype.initialize=freeOnUnref(function(){var n=this;return Jo.metadataStorage.get(this.licenseInformationMetadataStorageKey).then(freeOnUnref(function(e){if(null!=e){var t=e;null==t.playbackExpirationDurationMs&&(t.playbackExpirationDurationMs=1/0),n.licenseKeyId=t.licenseKeyMetadataId,n.licenseInformation={hasBeenConsumed:t.hasBeenConsumed,playbackExpirationDurationMs:t.playbackExpirationDurationMs,storageExpirationTimestampMs:t.storageExpirationTimestampMs,viewingEndTimestampMs:t.viewingEndTimestampMs}}else r.info("No license information stored for this download operation")}))}),e.prototype.setLicenseInformation=freeOnUnref(function(e){for(var t=0,n=e.keyMetadata;t<n.length;t++){var r=n[t];if("CONTENT"===r.keyType){var i=1/0,o=0,a=0;null!=r.consumptionDurationMs&&(i=r.consumptionDurationMs),null!=r.rightsWindow&&(o=r.rightsWindow.endTimeMs,a=r.rightsWindow.endTimeMs),this.licenseKeyId=r.id,this.licenseInformation={hasBeenConsumed:!1,playbackExpirationDurationMs:i,storageExpirationTimestampMs:o,viewingEndTimestampMs:a},this.writeLicenseInfoToMetadataStorage()}}}),e.prototype.writeLicenseInfoToMetadataStorage=freeOnUnref(function(){Jo.metadataStorage.put(this.licenseInformationMetadataStorageKey,n({},this.licenseInformation,{licenseKeyMetadataId:this.licenseKeyId}))}),e.prototype.createLicenseInformationMetadataKey=freeOnUnref(function(e){return"license_information_"+e}),e})();t.LicenseConsumptionTracker=i}));e(Zo);Zo.LicenseConsumptionTracker;var $o=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.licenseConsumptionTrackers={}}return e.getInstance=freeOnUnref(function(){return null==e.instance&&(e.instance=new e),e.instance}),e.prototype.getLicenseConsumptionTracker=freeOnUnref(function(e){if(null!=this.licenseConsumptionTrackers[e])return this.licenseConsumptionTrackers[e];var t=new Zo.LicenseConsumptionTracker(e);return this.licenseConsumptionTrackers[e]=t}),e.instance=null,e})();t.LicenseConsumptionTrackerManager=n}));e($o);$o.LicenseConsumptionTrackerManager;var ea=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HdcpStore=Xo.HdcpStore,t.LicenseConsumptionTracker=Zo.LicenseConsumptionTracker,t.LicenseConsumptionTrackerManager=$o.LicenseConsumptionTrackerManager,t.MediaKeysManager=Qo.MediaKeysManager,t.MediaKeysPurpose=jo.MediaKeysPurpose}));e(ea);ea.HdcpStore,ea.LicenseConsumptionTracker,ea.LicenseConsumptionTrackerManager,ea.MediaKeysManager,ea.MediaKeysPurpose;var ta=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=[{prefix:"com.widevine.alpha",streamingTechnology:"DASH",streamingTechnologyV2:"DASH",contentProtection:"CENC",drmType:"Widevine",keyScheme:"DualKey",patternManifestSupported:!0,ssaiStitchType:"MultiPeriod",ssaiSegmentInfoSupport:"Base"},{prefix:"com.microsoft.playready",streamingTechnology:"DASH",streamingTechnologyV2:"DASH",contentProtection:"CENC",drmType:"PlayReady",keyScheme:"SingleKey",patternManifestSupported:!0,ssaiStitchType:"MultiPeriod",ssaiSegmentInfoSupport:"Base"},{prefix:"com.apple.fps",streamingTechnology:"HLS",streamingTechnologyV2:"HLS",contentProtection:"FairPlay",drmType:"FairPlay",keyScheme:"SingleKey",patternManifestSupported:!1,bitrateAdaptationOverride:["CBR"],bitrateAdaptationOverrideV2:["CBR"]},{prefix:"com.chromecast.playready",streamingTechnology:"DASH",streamingTechnologyV2:"DASH",contentProtection:"CENC",drmType:"PlayReady",keyScheme:"SingleKey",patternManifestSupported:!0,ssaiStitchType:"MultiPeriod",ssaiSegmentInfoSupport:"Base"}];t.KEY_SYSTEM_PREFIX_DETAILS=i;var n=freeOnUnref(function(){function e(){}return e.resolve=freeOnUnref(function(){return ea.MediaKeysManager.getSupportedKeySystem().then(freeOnUnref(function(e){if(null!=e)for(var t=0,n=i;t<n.length;t++){var r=n[t];if(0===e.indexOf(r.prefix))return r}}))}),e})();t.DrmConfigResolver=n}));e(ta);ta.KEY_SYSTEM_PREFIX_DETAILS,ta.DrmConfigResolver;var na=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("VideoCapabilitiesQuerier"),n=freeOnUnref(function(){function e(){this.topCodecLevelPromise=null,this.videoCodecsQuerier=new Bi.VideoCodecsQuerier,this.videoCapabilityParameterConverter=new Bi.VideoCapabilityParameterConverter}return e.prototype.queryCapabilities=freeOnUnref(function(n,r){var i=this;return null==this.topCodecLevelPromise&&(this.topCodecLevelPromise=this.videoCodecsQuerier.querySupportedCapabilities()),this.topCodecLevelPromise.then(freeOnUnref(function(e){var t;return null!=r&&null!=r.allowedCodecs?(o.info("Codecs before overrides returned:",JSON.stringify(e)),t=x.pick(e,r.allowedCodecs),o.info("Codecs after overrides:",JSON.stringify(t))):t=e,i.videoCapabilityParameterConverter.convert(t,i.mergeHdrBlocklist(n,r))}))}),e.prototype.mergeHdrBlocklist=freeOnUnref(function(e,t){var n=Qe.nestedValue(e,"dynamicRangeBlocklist",[]),r=Qe.nestedValue(t,"hdrBlocklist",[]);if(0!==n.length||0!==r.length)return x.uniq(n.concat(r))}),e})();t.VideoCapabilitiesQuerier=n}));e(na);na.VideoCapabilitiesQuerier;var ra=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("PlaybackResourceRequestBuilderFactory"),n=freeOnUnref(function(){function m(){null==m.baseBuilder&&(m.baseBuilder=m.createBaseRequest()),this.videoCapabilitiesQuerier=new na.VideoCapabilitiesQuerier}return m.prototype.createDeviceCompliantBuilder=freeOnUnref(function(h,r,e,t){var n=Bi.CodecsQuerier.querySupportedAudioCodecs().then(freeOnUnref(function(e){r.throwIfRequested();var t=L.configurationStore.configuration;if(null==t||null==t.capabilities||null==t.capabilities.codecBlocklist||null==t.capabilities.codecBlocklist.Audio||x.isEmpty(t.capabilities.codecBlocklist.Audio))return e;var n=t.capabilities.codecBlocklist.Audio;return a.info("The following audio codecs have been blocklisted:",JSON.stringify(n)),e.filter(freeOnUnref(function(e){return!x.contains(n,e)}))})),i=this.videoCapabilitiesQuerier.queryCapabilities(e,t),o=ta.DrmConfigResolver.resolve();return lt.Promise.all([n,i,o]).then(freeOnUnref(function(e){var t=e[0],n=e[1],r=e[2],i=m.baseBuilder.clone(),o=t,a=n,s=r;0<o.length&&i.playerAttribute("supportedAudioCodecs",o),i.playerAttribute("frameRate",a.frameRate);for(var l=0,f=Object.keys(a.videoDecodeCapabilities);l<f.length;l++){var u=f[l];i.playerAttribute(u,a.videoDecodeCapabilities[u])}var c="DASH",d="CENC",p=["CVBR","CBR"];return zt.deviceInformation&&zt.deviceInformation.mediaPlayer&&null!=zt.deviceInformation.mediaPlayer.bitrateAdaptations&&(p=zt.deviceInformation.mediaPlayer.bitrateAdaptations),null!=s&&(c=s.streamingTechnology,d=s.contentProtection,p=null!=s.bitrateAdaptationOverride?s.bitrateAdaptationOverride:p),i.overrideDeviceCapability("streamingTechnology",c).overrideDeviceCapability("drm",d).overrideDeviceCapability("adInsertionType","SSAI").overrideDeviceCapability("hdrFormat",a.hdrFormats).overrideDeviceCapability("videoCodec",a.videoCodec).overrideDeviceCapability("videoQuality",null===h?a.videoQuality:h).overrideDeviceCapability("bitrateAdaptation",p),"FairPlay"===d&&i.resource(Pr.PlaybackResource.FairPlayApplicationCertificate()),i}))}),m.createBaseRequest=freeOnUnref(function(){var e=null==L.configurationStore.configuration||null==L.configurationStore.configuration.prs||!1!==L.configurationStore.configuration.prs.enableCardStitching?"Auxiliary":null,t=(new Pr.PlaybackResourceRequestBuilder).overrideDeviceCapability("protocol","Https");return null!=e&&t.overrideDeviceCapability("vodStreamSupport",e),t}),m.baseBuilder=null,m})();t.PlaybackResourceRequestBuilderFactory=n}));e(ra);ra.PlaybackResourceRequestBuilderFactory;var ia=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(ia);var oa=t(freeOnUnref(function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.CacheLevel=t.CachePriority=void 0,freeOnUnref(function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"})(n||(n={})),t.CachePriority=n,freeOnUnref(function(e){e[e.ULTRA_DATA_SAVER=0]="ULTRA_DATA_SAVER",e[e.DATA_SAVER=1]="DATA_SAVER",e[e.BALANCED=2]="BALANCED",e[e.MAX=3]="MAX"})(r||(r={})),t.CacheLevel=r}));e(oa);oa.CacheLevel,oa.CachePriority;var aa=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"CachePriority",{enumerable:!0,get:freeOnUnref(function(){return oa.CachePriority})}),Object.defineProperty(t,"CacheLevel",{enumerable:!0,get:freeOnUnref(function(){return oa.CacheLevel})})}));e(aa);var sa=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerSDKFeatures=void 0,freeOnUnref(function(e){e.CacheFeature="CacheFeature",e.LocalContentManager="LocalContentManager",e.MetricsReporting="MetricsReporting",e.Player="Player",e.PlayerCapabilities="PlayerCapabilities",e.MultiPlayerFeature="MultiPlayerFeature",e.MultiviewFeature="MultiviewFeature",e.RequestManager="RequestManager"})(n||(n={})),t.PlayerSDKFeatures=n}));e(sa);sa.PlayerSDKFeatures;var la=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PlayerSDKFeatures",{enumerable:!0,get:freeOnUnref(function(){return sa.PlayerSDKFeatures})})}));e(la);var fa=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ContentState=void 0,freeOnUnref(function(e){e.Unloaded="Unloaded",e.Waiting="Waiting",e.Ready="Ready",e.Error="Error"})(n||(n={})),t.ContentState=n}));e(fa);fa.ContentState;var ua=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.PlaybackExperience=void 0,freeOnUnref(function(e){e.RapidRecap="RapidRecap"})(n||(n={})),t.PlaybackExperience=n}));e(ua);ua.PlaybackExperience;var ca=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.PlaybackResourceType=void 0,freeOnUnref(function(e){e.Vod="VOD",e.Live="LIVE",e.Linear="LINEAR"})(n||(n={})),t.PlaybackResourceType=n}));e(ca);ca.PlaybackResourceType;var da=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.PlaybackState=void 0,freeOnUnref(function(e){e.Paused="Paused",e.Playing="Playing"})(n||(n={})),t.PlaybackState=n}));e(da);da.PlaybackState;var pa=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerEvent=void 0,freeOnUnref(function(e){e.ContentStateChange="ContentStateChange",e.PlaybackStateChange="PlaybackStateChange",e.TimeDataChange="TimeDataChange",e.TimelineChange="TimelineChange",e.TimelineEnded="TimelineEnded",e.Error="Error",e.ContentError="ContentError",e.PictureModeChange="PictureModeChange"})(n||(n={})),t.PlayerEvent=n}));e(pa);pa.PlayerEvent;var ha=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerFeatures=void 0,freeOnUnref(function(e){e.MetricsReporting="MetricsReporting",e.AdReporting="AdReporting",e.PictureInPicture="PictureInPicture",e.Stream="Stream",e.VideoPreview="VideoPreview",e.Volume="Volume",e.Diagnostics="Diagnostics",e.Troubleshooting="Troubleshooting"})(n||(n={})),t.PlayerFeatures=n}));e(ha);ha.PlayerFeatures;var ma=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.TimeUnit=void 0,freeOnUnref(function(e){e.EpochMillis="EpochMillis",e.ContentMillis="ContentMillis"})(n||(n={})),t.TimeUnit=n}));e(ma);ma.TimeUnit;var ya=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ContentState",{enumerable:!0,get:freeOnUnref(function(){return fa.ContentState})}),Object.defineProperty(t,"PlaybackExperience",{enumerable:!0,get:freeOnUnref(function(){return ua.PlaybackExperience})}),Object.defineProperty(t,"PlaybackResourceType",{enumerable:!0,get:freeOnUnref(function(){return ca.PlaybackResourceType})}),Object.defineProperty(t,"PlaybackState",{enumerable:!0,get:freeOnUnref(function(){return da.PlaybackState})}),Object.defineProperty(t,"PlayerEvent",{enumerable:!0,get:freeOnUnref(function(){return pa.PlayerEvent})}),Object.defineProperty(t,"PlayerFeatures",{enumerable:!0,get:freeOnUnref(function(){return ha.PlayerFeatures})}),Object.defineProperty(t,"TimeUnit",{enumerable:!0,get:freeOnUnref(function(){return ma.TimeUnit})})}));e(ya);var ga=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(ga);var va=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(va);var Oa=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(Oa);var Sa=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(Sa);var Ua=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(Ua);var ba=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(ba);var Pa=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(Pa);var Ma=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(Ma);var Ca=t(freeOnUnref(function(e,t){var r=ce&&ce.__createBinding||(Object.create?freeOnUnref(function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:freeOnUnref(function(){return t[n]})})}):freeOnUnref(function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]})),n=ce&&ce.__exportStar||freeOnUnref(function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)});Object.defineProperty(t,"__esModule",{value:!0}),n(Ma,t)}));e(Ca);var Ea=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(Ea);var Ta=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(Ta);var wa=t(freeOnUnref(function(e,t){var r=ce&&ce.__createBinding||(Object.create?freeOnUnref(function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:freeOnUnref(function(){return t[n]})})}):freeOnUnref(function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]})),n=ce&&ce.__exportStar||freeOnUnref(function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)});Object.defineProperty(t,"__esModule",{value:!0}),n(Ta,t)}));e(wa);var Ia=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(Ia);var ka=t(freeOnUnref(function(e,t){var r=ce&&ce.__createBinding||(Object.create?freeOnUnref(function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:freeOnUnref(function(){return t[n]})})}):freeOnUnref(function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]})),n=ce&&ce.__exportStar||freeOnUnref(function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Error=t.MetricsReporting=void 0,n(ia,t),n(aa,t),n(la,t),n(ya,t),n(ga,t),n(va,t),n(Oa,t),n(Sa,t),n(Ua,t),n(ba,t),n(Pa,t),n(Ca,t),n(Ea,t),t.MetricsReporting=wa,t.Error=Ia}));e(ka);ka.Error,ka.MetricsReporting;var _a=t(freeOnUnref(function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0});t.HDCP_VERSION_CAPABILITY_MAP={None:"None",NoDigitalOutput:"2.3",V1:"1.4",V2:"2.0",V2_1:"2.1",V2_2:"2.2",Unknown:"1.4"};var i=((n={}).Hdr10="HDR10",n.DolbyVision="DolbyVision",n.None="None",n);t.HDR_FORMAT_V2_MAP=i;var o=((r={}).H264="H264",r.H265="H265",r.AV1="AV1",r);t.VIDEO_CODEC_V2_MAP=o}));e(_a);_a.HDCP_VERSION_CAPABILITY_MAP,_a.HDR_FORMAT_V2_MAP,_a.VIDEO_CODEC_V2_MAP;var Ra=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.shouldBlockSyeUrlsRequest=function(e){return"511cc9af-3ecb-48fe-9825-886ebfbb6503"===e}}));e(Ra);Ra.shouldBlockSyeUrlsRequest;var Aa=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){var i=this;this.sources=[],this.sinks=[],this.onSourceLog=freeOnUnref(function(e,t){for(var n=0,r=i.sinks;n<r.length;n++){r[n].write(e,t)}})}return e.prototype.addSources=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=x.difference(e,this.sources),r=0,i=n;r<i.length;r++){i[r].onLog(this.onSourceLog)}this.sources=this.sources.concat(n)}),e.prototype.removeSources=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,r=e;n<r.length;n++){r[n].offLog(this.onSourceLog)}this.sources=x.difference(this.sources,e)}),e.prototype.addSinks=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.sinks=x.union(this.sinks,e)}),e.prototype.removeSinks=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.sinks=x.difference(this.sinks,e)}),e})();t.LogRouter=n}));e(Aa);Aa.LogRouter;var Da=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={})[0]=de.DEBUG,n[1]=de.INFO,n[2]=de.INFO,n[3]=de.WARN,n[4]=de.ERROR,n);t.LOG_LEVEL_TO_JS_LOGGER_LEVEL_MAP=r}));e(Da);Da.LOG_LEVEL_TO_JS_LOGGER_LEVEL_MAP;var xa=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.ephemeralId="",this.logger=de.get(e)}return e.prototype.log=freeOnUnref(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.logger).log.apply(e,[this.ephemeralId].concat(t))}),e.prototype.debug=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}),e.prototype.info=freeOnUnref(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.logger).info.apply(e,[this.ephemeralId].concat(t))}),e.prototype.warn=freeOnUnref(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.logger).warn.apply(e,[this.ephemeralId].concat(t))}),e.prototype.error=freeOnUnref(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.logger).error.apply(e,[this.ephemeralId].concat(t))}),e.prototype.setId=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.ephemeralId=e.map(freeOnUnref(function(e){return"["+e+"]"})).join(" ")}),e.prototype.enabledFor=freeOnUnref(function(e){return this.logger.enabledFor(Da.LOG_LEVEL_TO_JS_LOGGER_LEVEL_MAP[e])}),e})();t.EphemeralJSLogger=n}));e(xa);xa.EphemeralJSLogger;var Fa=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.scope=e}return n.prototype.push=freeOnUnref(function(e){var t=new n;return t.scope=this.scope.concat(e),t}),n.prototype.pop=freeOnUnref(function(){var e=new n;return e.scope=this.scope.slice(0,-1),e}),n.prototype.get=freeOnUnref(function(e){var t=new xa.EphemeralJSLogger(e);return t.setId.apply(t,this.scope),t}),n})();t.ScopedJSLogger=n}));e(Fa);Fa.ScopedJSLogger;var Ba=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={})[de.DEBUG.value]=0,n[de.INFO.value]=1,n[de.TIME.value]=1,n[de.WARN.value]=3,n[de.ERROR.value]=4,n);t.JS_LOGGER_LEVEL_TO_LOG_LEVEL_MAP=r}));e(Ba);Ba.JS_LOGGER_LEVEL_TO_LOG_LEVEL_MAP;var La=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){var i=this;this.eventEmitter=new A.EventEmitter,this.onJSLog=freeOnUnref(function(e,t){var n=t.name?"["+t.name+"] ":"";n+=Array.prototype.slice.call(e).join(" ");var r=Ba.JS_LOGGER_LEVEL_TO_LOG_LEVEL_MAP[t.level.value];i.eventEmitter.emitSync("log",r,n)}),de.setHandler(this.onJSLog)}return e.prototype.onLog=freeOnUnref(function(e){this.eventEmitter.on("log",e)}),e.prototype.offLog=freeOnUnref(function(e){this.eventEmitter.off("log",e)}),e.prototype.setLevel=freeOnUnref(function(e){de.setLevel(Da.LOG_LEVEL_TO_JS_LOGGER_LEVEL_MAP[e])}),e.prototype.getLevel=freeOnUnref(function(){return Ba.JS_LOGGER_LEVEL_TO_LOG_LEVEL_MAP[de.getLevel().value]}),e})();t.JSLoggerLogSource=n}));e(La);La.JSLoggerLogSource;var Na=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=re.connector.consoleAPI),this.consoleAPI=e}return e.prototype.log=freeOnUnref(function(e,t){switch(e){case 0:this.consoleAPI.trace(t);break;case 1:this.consoleAPI.info(t);break;case 2:this.consoleAPI.warn(t);break;case 3:this.consoleAPI.error(t)}}),e})();t.PlatformConsoleImpl=n}));e(Na);Na.PlatformConsoleImpl;var Va=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.isDirectlyLogging=!0}return e.prototype.onLog=freeOnUnref(function(e){}),e.prototype.onLogBatch=freeOnUnref(function(e,t,n){throw"Batching not supported"}),e.prototype.offLogBatch=freeOnUnref(function(){throw"Batching not supported"}),e.prototype.pullLogBatch=freeOnUnref(function(){throw"Batching not supported"}),e.prototype.configureLogLevel=freeOnUnref(function(e,t){}),e})();t.PlatformLogsManagerJasper=n}));e(Va);Va.PlatformLogsManagerJasper;var ja=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformConsole=Na.PlatformConsoleImpl,t.PlatformLogLevel=Va.PlatformLogsManagerJasper;var n=new Na.PlatformConsoleImpl;t.platformConsole=n;var r=new Va.PlatformLogsManagerJasper;t.platformLogsManager=r}));e(ja);ja.PlatformConsole,ja.PlatformLogLevel,ja.platformConsole,ja.platformLogsManager;var qa=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={})[0]=0,n[1]=1,n[2]=1,n[3]=2,n[4]=3,n);t.LOG_LEVEL_TO_PLATFORM_LEVEL_MAP=r}));e(qa);qa.LOG_LEVEL_TO_PLATFORM_LEVEL_MAP;var Ha=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=0),this.logLevel=e}return e.prototype.setLevel=freeOnUnref(function(e){this.logLevel=e}),e.prototype.getLevel=freeOnUnref(function(){return this.logLevel}),e.prototype.write=freeOnUnref(function(e,t){if(!(e<this.logLevel)){var n=qa.LOG_LEVEL_TO_PLATFORM_LEVEL_MAP[e];ja.platformConsole.log(n,t)}}),e})();t.PlatformLogSink=n}));e(Ha);Ha.PlatformLogSink;var za=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={})[0]=0,n[1]=1,n[2]=3,n[3]=4,n);t.PLATFORM_LEVEL_TO_LOG_LEVEL_MAP=r}));e(za);za.PLATFORM_LEVEL_TO_LOG_LEVEL_MAP;var Wa=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){var r=this;this.eventEmitter=new A.EventEmitter,this.onPlatformLog=freeOnUnref(function(e){var t=za.PLATFORM_LEVEL_TO_LOG_LEVEL_MAP[e.level],n=(e.timestamp?e.timestamp:"")+" ["+e.logger+"] "+e.message;r.eventEmitter.emitSync("log",t,n)}),ja&&ja.platformLogsManager&&(this.logsManager=ja.platformLogsManager,this.logsManager.onLog(this.onPlatformLog)),this.currentLevel=0}return e.prototype.setLevel=freeOnUnref(function(e){this.currentLevel=e,this.logsManager&&this.logsManager.configureLogLevel(qa.LOG_LEVEL_TO_PLATFORM_LEVEL_MAP[e])}),e.prototype.getLevel=freeOnUnref(function(){return this.currentLevel}),e.prototype.onLog=freeOnUnref(function(e){this.eventEmitter.on("log",e)}),e.prototype.offLog=freeOnUnref(function(e){this.eventEmitter.off("log",e)}),e})();t.PlatformLogSource=n}));e(Wa);Wa.PlatformLogSource;var Ka=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LogRouter=Aa.LogRouter,t.EphemeralJSLogger=xa.EphemeralJSLogger,t.ScopedJSLogger=Fa.ScopedJSLogger,t.JSLoggerLogSource=La.JSLoggerLogSource,t.PlatformLogSink=Ha.PlatformLogSink,t.PlatformLogSource=Wa.PlatformLogSource}));e(Ka);Ka.LogRouter,Ka.EphemeralJSLogger,Ka.ScopedJSLogger,Ka.JSLoggerLogSource,Ka.PlatformLogSink,Ka.PlatformLogSource;var Ga=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.vmManager=t,this.is64Bit=64===this.vmManager.WebAssembly_ModuleGetPointerSize(e)}return e.prototype.toSignedOffset=freeOnUnref(function(e){if(this.is64Bit)return e;var t=Number(e);return 2147483647<t?t-4294967296:t}),e.prototype.getViewWithOffset=freeOnUnref(function(e,t,n){return this.is64Bit?this.vmManager.WebAssembly_MemoryGetViewWithOffset64(e,t,n):this.vmManager.WebAssembly_MemoryGetViewWithOffset32(e,this.toSignedOffset(t),n)}),e.prototype.toModuleOffset=freeOnUnref(function(e){return this.is64Bit?e:Number(e)}),e.prototype.getOwnedBuffer=freeOnUnref(function(e,t,n,r,i){return this.is64Bit?this.vmManager.WebAssembly_MemoryGetWasmOwnedBuffer64(e,t,n,r,i):this.vmManager.WebAssembly_MemoryGetWasmOwnedBuffer32(e,t,this.toSignedOffset(n),r,this.toSignedOffset(i))}),e})();t.VmBitSpecifics=n}));e(Ga);Ga.VmBitSpecifics;var Qa=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("LiveLowLatencySDKUnf"),n=freeOnUnref(function(){function l(e,t,n,r,i,o){this.instance=e,this.vmManager=t,this.native=n,this.vmBitSpecifics=r,this.isNativeModule=i,this.moduleName=o,this.functionCache={},this.nullPtBigInt=BigInt(0);var a=this.vmManager.WebAssembly_ModuleInstanceGetMemory(e);if(!a)throw new Error("No memory found in the module instance");if(1!==a.length)throw new Error("Unexpected memory count "+a.length);this.memory=a[0],this.removeBufferFnc=this.getFunction("ignition_x_sye_remove_buffer","v(III)"),this.mallocFnc=this.getFunction("ignition_x_sye_ext_malloc","p(i)"),this.freeFnc=this.getFunction("ignition_x_sye_ext_free","v(p)")}return l.prototype.getFunction=freeOnUnref(function(e,t){if(void 0===t&&(t="I(IIII)"),e in this.functionCache)return this.functionCache[e];var n=this.isNativeModule?this.vmManager.WebAssembly_ModuleInstanceGetFunctionWithSignatureByName(this.instance,e,t):this.vmManager.WebAssembly_ModuleInstanceGetFunctionByName(this.instance,e);return this.functionCache[e]=n}),l.createModuleInstance=freeOnUnref(function(e,t,n,r,i){if(0===e.result.result){var o=n.WebAssembly_CreateModuleInstance(e.module);if(0===o.result.result)return new l(o.instance,n,r,new Ga.VmBitSpecifics(e.module,n),"DefaultNative"===t||"Native"===t||"Ignite"===t,i);f.error("Failed to create instance: "+o.result.result)}else f.error("Failed to load module: "+e.result.result)}),l.createModuleInstanceFromPath=freeOnUnref(function(e,t,n,r,i){var o=n.CreateCoroutineVm(t),a=r.DiskStorage_OpenFile(2,e);if(0===a.error_code){var s=n.LoadModuleFromStorageFile(o,a.file_handler,e);return r.DiskStorage_CloseFile(a.file_handler),l.createModuleInstance(s,t,n,r,i)}f.error("Failed to open file "+e+": "+a.error_code)}),l.createModuleInstanceFromByteArray=freeOnUnref(function(e,t,n,r,i){var o=n.CreateCoroutineVm(t),a=n.LoadModuleFromByteArray(o,new Uint8Array(e));return l.createModuleInstance(a,t,n,r,i)}),l.prototype.getOwnedBuffer=freeOnUnref(function(e,t,n,r){return this.vmBitSpecifics.getOwnedBuffer(this.memory,r||this.removeBufferFnc,e,t,n)}),l.prototype.writeString=freeOnUnref(function(e){var t=this.malloc(e.length),n=this.native.Encoding_StringToBuffer(e);return this.vmBitSpecifics.getViewWithOffset(this.memory,t,e.length).set(n,0),[t,e.length]}),l.prototype.readString=freeOnUnref(function(e){if(0!==Number(e)){var t=this.vmBitSpecifics.getViewWithOffset(this.memory,e,65536);return this.native.Encoding_BufferToString(t,!0)}}),l.prototype.readJSON=freeOnUnref(function(e,t){var n=this.readString(e);if(!n){if(void 0===t)throw new Error("Failed to read JSON from buffer");return t}return JSON.parse(n)}),l.prototype.writeJSON=freeOnUnref(function(e){return this.writeString(JSON.stringify(e))}),l.prototype.callFunction=freeOnUnref(function(e){for(var t,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];if(!this.isNativeModule)return(t=this.vmManager).WebAssembly_FunctionInvoke.apply(t,[this.getFunction(e)].concat(r));if(4<r.length)throw new Error("Function "+e+" cannot be called because it has too many arguments");for(var o=new Array(4),a=0;a<4;a++)a<r.length?o[a]=BigInt(r[a]):o[a]=this.nullPtBigInt;return(n=this.vmManager).WebAssembly_FunctionInvoke.apply(n,[this.getFunction(e)].concat(o))}),l.prototype.malloc=freeOnUnref(function(e){return this.vmManager.WebAssembly_FunctionInvoke(this.mallocFnc,e)}),l.prototype.toSignedOffset=freeOnUnref(function(e){return this.vmBitSpecifics.toSignedOffset(e)}),l.prototype.free=freeOnUnref(function(e){if(0!==Number(e))return this.vmManager.WebAssembly_FunctionInvoke(this.freeFnc,this.toSignedOffset(e))}),l.prototype.toModuleOffset=freeOnUnref(function(e){return this.vmBitSpecifics.toModuleOffset(e)}),l.prototype.getModuleName=freeOnUnref(function(){return this.moduleName}),l})();t.WasmModuleInstance=n}));e(Qa);Qa.WasmModuleInstance;var Xa=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("LiveLowLatencySDKUnf"),n=freeOnUnref(function(){return function(e,t){var o=this;this.supportsIntraChunkSeeking=freeOnUnref(function(){return o.getBooleanProperty("supportsIntraChunkSeeking")}),this.supportsEac3PlaybackRateAdjustment=freeOnUnref(function(){return o.getBooleanProperty("supportsEac3PlaybackRateAdjustment",!1)}),this.supportsHEVC=freeOnUnref(function(){return o.getBooleanProperty("supportsHEVC")}),this.supportsHEVC720p=freeOnUnref(function(){return o.getBooleanProperty("supportsHEVC")}),this.supportsHEVC10Bits=freeOnUnref(function(){return o.getBooleanProperty("supportsHEVC10Bits")}),this.supportsUHD=freeOnUnref(function(){return o.getBooleanProperty("supportsUHD")}),this.supportsHDR10=freeOnUnref(function(){return o.getInt32Property("hdrFlags").then(freeOnUnref(function(e){return-1!==e&&Boolean(1&e)}))}),this.supportsHDR10Plus=freeOnUnref(function(){return o.getInt32Property("hdrFlags").then(freeOnUnref(function(e){return-1!==e&&Boolean(4&e)}))}),this.supportsEC3=freeOnUnref(function(t){return o.getBooleanProperty("supportsSurroundSound",!1).then(freeOnUnref(function(e){return e?o.getBooleanProperty("supportsEac3PlaybackRateAdjustment",!1).then(freeOnUnref(function(e){return e||t?o.getMaybeBooleanProperty("dolbyDigitalAudioPassthroughOnly",!1).then(freeOnUnref(function(e){return!1===e?(a.info("EC3 audio supported"),!0):(void 0===e&&a.warn("Could not find out if device supports EC3 passthrough only, assuming true"),o.isTextToSpeechEnabled().then(freeOnUnref(function(e){return!1===e?(a.info("EC3 audio supported"),!0):(void 0===e&&a.warn("Could not find out if text-to-speech is enabled, assuming true"),a.info("EC3 audio not supported (EC3 passthrough is incompatible with TTS)"),!1)})))})):(a.info("EC3 audio not supported (Device does not support rate adjustment and coarse grain ec3 adjustments disabled)"),!1)})):(a.info("EC3 audio not supported (Device does not support surround)"),!1)}))}),this.getMaybeBooleanProperty=freeOnUnref(function(r,i){return void 0===i&&(i=!0),new lt.Promise(freeOnUnref(function(n,e){try{var t=freeOnUnref(function(e,t){n(e&&void 0!==t?t:void 0)});o.devicePropertiesProvider.getBoolProperty(r,i,t)}catch(e){return a.warn('Returning undefined due to unexpected error while reading device property "'+r+'": '+e.toString()),n(void 0)}}))}),this.getBooleanProperty=freeOnUnref(function(e,t){return void 0===t&&(t=!0),o.getMaybeBooleanProperty(e,t).then(freeOnUnref(function(e){return void 0!==e&&e}))}),this.getMaybeInt32Property=freeOnUnref(function(r){return new lt.Promise(freeOnUnref(function(n,e){try{var t=freeOnUnref(function(e,t){n(e&&void 0!==t?t:void 0)});o.devicePropertiesProvider.getInt32Property(r,!1,t)}catch(e){return a.warn('Returning undefined due to unexpected error while reading device property "'+r+'": '+e.toString()),n(void 0)}}))}),this.getInt32Property=freeOnUnref(function(e){return o.getMaybeInt32Property(e).then(freeOnUnref(function(e){return void 0===e?-1:e}))}),this.isTextToSpeechEnabled=freeOnUnref(function(){return new lt.Promise(freeOnUnref(function(n,r){if(o.keyValueStore.isInitialized){var i="ttsEnabled";o.keyValueStore.get(i,freeOnUnref(function(e,t){null!==e?r(new Error("keyValueStore::get("+i+") failed with code: "+e.code+" and message: "+e.message)):null==t?r(new Error("keyValueStore::get("+i+") failed. The key is not available")):n("true"===t)}))}else r(new Error("keyValueStore instance is not initialized"))})).catch(freeOnUnref(function(e){a.warn("Returning undefined after checking if TTS is enabled. Reason: "+e.toString())}))}),this.devicePropertiesProvider=e,this.keyValueStore=t}})();t.DevicePropertiesWrapper=n}));e(Xa);Xa.DevicePropertiesWrapper;var Ya=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("LiveLowLatencySDKUnf"),n=freeOnUnref(function(){function e(e){var n=this;this.mpbCapabilities=void 0,this.supportsIntraChunkSeeking=freeOnUnref(function(){var e=n.getMpbCapabilities();return void 0===e||null===e.intraChunkSeekSupport?(r.error("getIntraChunkSeekCapability failed, intra chunk seek support returned: "+JSON.stringify(e)),lt.Promise.resolve(!1)):lt.Promise.resolve(!0===e.intraChunkSeekSupport)}),this.supportsEac3PlaybackRateAdjustment=freeOnUnref(function(){return lt.Promise.resolve(!1)}),this.supportsHEVC=freeOnUnref(function(){return bi.mediaCapabilities.decodingInfo({video:{contentType:'video/mp4; codecs="hev1.1.6.L63.90"',width:1920,height:1080,bitrate:9e6,framerate:"30.0"}})}),this.supportsHEVC720p=freeOnUnref(function(){return bi.mediaCapabilities.decodingInfo({video:{contentType:'video/mp4; codecs="hev1.1.6.L120.90"',width:1280,height:720,bitrate:9e6,framerate:"30.0"}})}),this.supportsHEVC10Bits=freeOnUnref(function(){return bi.mediaCapabilities.decodingInfo({video:{contentType:'video/mp4; codecs="hev1.2.4.L150.90"',width:1920,height:1080,bitrate:9e6,framerate:"30.0"}})}),this.supportsUHD=freeOnUnref(function(){return bi.mediaCapabilities.decodingInfo({video:{contentType:'video/mp4; codecs="hev1.1.6.L150.90"',width:3840,height:2160,bitrate:25e6,framerate:"30.0"}})}),this.supportsHDR10=freeOnUnref(function(){var e={mimeType:"video",mimeSubType:"mp4",mimeAttributeKeys:["codecs","width","height","bitrate","framerate","profile","level","hdrMetadataType","colorGamut","transferFunction"],mimeAttributeValues:["hev1.2.4.L150.90","3840","2160","25000000","30.0","Main10","5.0",p.HdrMetadataType.SMPTE_ST_2086,p.ColorGamut.REC_2020,p.TransferFunction.PQ]},t=n.instanceManager.canDecodeMedia(e);return t.error_code!==p.MPBErrors.OK?(r.error("canDecodeMedia failed with error code "+t.error_code),lt.Promise.resolve(!1)):lt.Promise.resolve(!0===t.is_supported)}),this.supportsHDR10Plus=freeOnUnref(function(){var e={mimeType:"video",mimeSubType:"mp4",mimeAttributeKeys:["codecs","width","height","bitrate","framerate","profile","level","hdrMetadataType","colorGamut","transferFunction"],mimeAttributeValues:["hev1.2.4.L150.90","3840","2160","25000000","30.0","Main10","5.0",p.HdrMetadataType.SMPTE_ST_2094_40,p.ColorGamut.REC_2020,p.TransferFunction.PQ]},t=n.instanceManager.canDecodeMedia(e);return t.error_code!==p.MPBErrors.OK?(r.error("canDecodeMedia failed with error code "+t.error_code),lt.Promise.resolve(!1)):lt.Promise.resolve(!0===t.is_supported)}),this.supportsEC3=freeOnUnref(function(e){return bi.mediaCapabilities.decodingInfo({audio:{contentType:'audio/mp4; codecs="ec-3"',channels:"5.1",bitrate:64e4,samplerate:48e3}})}),this.instanceManager=e}return e.prototype.getMpbCapabilities=freeOnUnref(function(){if(void 0!==this.mpbCapabilities&&null!==this.mpbCapabilities.capabilities)return this.mpbCapabilities.capabilities;if(this.mpbCapabilities=this.instanceManager.getCapabilities(),this.mpbCapabilities.errorCode===p.MPBErrors.OK){if(null!==this.mpbCapabilities.capabilities)return this.mpbCapabilities.capabilities;r.error("MPB getCapabilities returns null: "+JSON.stringify(this.mpbCapabilities))}else r.error("MPB getCapabilities failed: "+JSON.stringify(this.mpbCapabilities))}),e})();t.DeviceCapabilitiesMPBv3=n}));e(Ya);Ya.DeviceCapabilitiesMPBv3;var Ja=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("SyeCorePlayerIgnitionXConnector");t.createDeviceCapabilities=function(e,t,n,r,i){if((null===i.clientWeblabConfig||null===i.clientWeblabConfig.configuration||!1!==i.clientWeblabConfig.configuration[p.MML_CLIENT_FEATURE_FLAG])&&(!t||3===e&&n&&r)){var o=void 0;try{if((o=T.getInstanceManager())&&o.isCanDecodeMediaSupported())return a.info("Using DeviceCapabilitiesMPBv3"),new Ya.DeviceCapabilitiesMPBv3(o)}catch(e){a.error("Failed to get instance manager or check decode media support")}}return a.info("Using DevicePropertiesWrapper"),new Xa.DevicePropertiesWrapper(i.devicePropertiesAPI,Tt.keyValueStore)}}));e(Ja);Ja.createDeviceCapabilities;var Za=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.tryGetNative=function(){return"undefined"==typeof Native?void 0:Native}}));e(Za);Za.tryGetNative;var $a=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.syePlayerControlAPI=e||Za.tryGetNative()}return e.prototype.isUsingExternalBuffers=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_IsUsingExternalBuffers(e)}),e.prototype.useExternalBuffers=freeOnUnref(function(e,t){this.syePlayerControlAPI.SYE_Player_UseExternalBuffers(e,t)}),e.prototype.poll=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_Poll(e)}),e.prototype.poll_scp=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_Poll_Scp(e)}),e.prototype.playFromLive=freeOnUnref(function(e,t){this.syePlayerControlAPI.SYE_Player_PlayFromLive(e,t)}),e.prototype.playFromUtcTime=freeOnUnref(function(e,t,n){this.syePlayerControlAPI.SYE_Player_PlayFromUtcTime(e,t,n)}),e.prototype.playWithOffset=freeOnUnref(function(e,t,n){this.syePlayerControlAPI.SYE_Player_PlayWithOffset(e,t,n)}),e.prototype.playResume=freeOnUnref(function(e){this.syePlayerControlAPI.SYE_Player_PlayResume(e)}),e.prototype.getPresentationDelayMillis=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_GetPresentationDelayMillis(e)}),e.prototype.getUtcTimeMicros=freeOnUnref(function(e,t){return Math.round(this.syePlayerControlAPI.SYE_Player_GetUtcTimeMicros(e,t))}),e.prototype.setViewResolution=freeOnUnref(function(e,t,n){this.syePlayerControlAPI.SYE_Player_SetViewResolution(e,t,n)}),e.prototype.getCurrentChannelId=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_GetCurrentChannelId(e)}),e.prototype.pause=freeOnUnref(function(e){this.syePlayerControlAPI.SYE_Player_Pause(e)}),e.prototype.stop=freeOnUnref(function(e){this.syePlayerControlAPI.SYE_Player_Stop(e)}),e.prototype.selectClosedCaptionsType=freeOnUnref(function(e,t){this.syePlayerControlAPI.SYE_Player_CC_SelectType(e,t)}),e.prototype.getSelectedClosedCaptionsType=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_CC_GetSelectedType(e)}),e.prototype.getVideoStreamInfo=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_GetVideoStreamInfo(e)}),e.prototype.getMetrics=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_GetMetrics(e)}),e.prototype.getMetadata=freeOnUnref(function(){return{scpCompilationTarget:"Native"}}),e.prototype.updateSyeSystem=freeOnUnref(function(e,t){this.syePlayerControlAPI.SYE_Player_Update(e,JSON.stringify(t))}),e.prototype.getPlayerState=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_GetState(e)}),e.prototype.getAudioStreamInfo=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_GetAudioStreamInfo(e)}),e.prototype.getAvailableAudioTracks=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_GetAvailableAudioTracks(e)}),e.prototype.getSelectedClosedCaptionsChannel=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_CC_GetSelectedChannel(e)}),e.prototype.getSelectedClosedCaptionsService=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_CC_GetSelectedService(e)}),e.prototype.selectClosedCaptionsChannel=freeOnUnref(function(e,t){this.syePlayerControlAPI.SYE_Player_CC_SelectChannel(e,t)}),e.prototype.selectClosedCaptionsService=freeOnUnref(function(e,t){this.syePlayerControlAPI.SYE_Player_CC_SelectService(e,t)}),e.prototype.getAvailableClosedCaptionsChannels=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_CC_GetAvailableChannels(e)}),e.prototype.getAvailableClosedCaptionsServices=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_CC_GetAvailableServices(e)}),e.prototype.getThumbnail=freeOnUnref(function(e,t){return this.syePlayerControlAPI.SYE_Player_TN_GetForUtc(e,t)}),e.prototype.synchronize=freeOnUnref(function(e){this.syePlayerControlAPI.SYE_Player_Synchronize(e)}),e.prototype.cacheThumbnailsFromLive=freeOnUnref(function(e,t){this.syePlayerControlAPI.SYE_Player_TN_CacheFromLive(e,t)}),e.prototype.cacheThumbnailsForInterval=freeOnUnref(function(e,t,n){this.syePlayerControlAPI.SYE_Player_TN_CacheForInterval(e,t,n)}),e.prototype.getDTVCCSettings=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_CC_GetDTVCCSettings(e)}),e.prototype.setDTVCCSettings=freeOnUnref(function(e,t){this.syePlayerControlAPI.SYE_Player_CC_SetDTVCCSettings(e,JSON.stringify(t))}),e.prototype.getAudioPreferences=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_GetAudioPreferences(e)}),e.prototype.setAudioPreferences=freeOnUnref(function(e,t){this.syePlayerControlAPI.SYE_Player_SetAudioPreferences(e,JSON.stringify(t))}),e.prototype.getVideoPreferences=freeOnUnref(function(e){return this.syePlayerControlAPI.SYE_Player_GetVideoPreferences(e)}),e.prototype.setVideoPreferences=freeOnUnref(function(e,t){this.syePlayerControlAPI.SYE_Player_SetVideoPreferences(e,JSON.stringify(t))}),e.prototype.reportWarning=freeOnUnref(function(e,t,n){this.syePlayerControlAPI.SYE_Player_ReportWarning(e,t,n)}),e.prototype.reportError=freeOnUnref(function(e,t,n){this.syePlayerControlAPI.SYE_Player_ReportError(e,t,n)}),e.prototype.setAudioFocus=freeOnUnref(function(e,t){this.syePlayerControlAPI.SYE_Player_SetAudioFocus(e,t)}),e})(),r=freeOnUnref(function(){function e(e){this.syeNativeAPI=e||Za.tryGetNative()}return e.prototype.getSyePlayerAPI=freeOnUnref(function(){return new n(this.syeNativeAPI.syePlayerInterface||void 0)}),e})();t.SyePlayerControlFactory=r}));e($a);$a.SyePlayerControlFactory;var es=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateMinimumSupportedVersion=function(e){var t=e;if(void 0!==t&&void 0!==t.minimumSupportedVersion){var n=t.minimumSupportedVersion;return"number"==typeof n.major&&"number"==typeof n.minor&&"number"==typeof n.patch?n:"invalid"}},t.isSupportedVersion=function(e,t){return void 0===e||void 0!==t&&(t.major>e.major||!(t.major<e.major)&&(t.minor>e.minor||!(t.minor<e.minor)&&(t.patch>e.patch||!(t.patch<e.patch))))}}));e(es);es.validateMinimumSupportedVersion,es.isSupportedVersion;var ts=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("LiveLowLatencySDKIgnitionXConnector"),n=freeOnUnref(function(){function e(e,t){var n=this;this.syeAPIControlAPI=e||Za.tryGetNative(),this.syeMpbControlAPI=t||Za.tryGetNative(),void 0!==this.syeAPIControlAPI&&(this.getThumbnailPreferences=this.syeAPIControlAPI.SYE_GetThumbnailPreferences,void 0!==this.syeAPIControlAPI.SYE_SetThumbnailPreferences&&(this.setThumbnailPreferences=freeOnUnref(function(e){n.syeAPIControlAPI.SYE_SetThumbnailPreferences(e.maxMemoryMB,e.numChannelsCached,e.width)})))}return e.prototype.getContext=freeOnUnref(function(){return this.syeAPIControlAPI.SYE_GetContext()}),e.prototype.isSyeSupported=freeOnUnref(function(e){var t=this.syeAPIControlAPI.IsFeatureSupported;if(void 0!==t)return t("IgnitionX_Supports_SYE");var n=es.validateMinimumSupportedVersion(e);if("invalid"===n)return o.error("Minimum Sye supported version is malformed: "+JSON.stringify(e.minimumSupportedVersion)),!1;var r=this.isNativeVersionSupported({major:3,minor:0,patch:0}),i=void 0===n||this.isNativeVersionSupported(n);return r&&i}),e.prototype.isFeatureSupported=freeOnUnref(function(e){switch(e){case"ExternalBuffers":return this.isNativeVersionSupported({major:4,minor:4,patch:0});case"PlaybackInitCallback":return this.isNativeVersionSupported({major:4,minor:2,patch:0});case"SetAudioFocus":case"SetViewResolution":return this.isNativeVersionSupported({major:6,minor:1,patch:0});default:return!1}}),e.prototype.isMPBv2Supported=freeOnUnref(function(){return void 0!==this.syeMpbControlAPI.SYE_Mpb_PlaybackInit}),e.prototype.getSyeCorePlayerVersion=freeOnUnref(function(){var e=this.getSyeVersion();return void 0!==e?e.syeCorePlayer:void 0}),e.prototype.isNativeVersionSupported=freeOnUnref(function(e){var t=this.getSyeVersion(),n=void 0!==t?t.syeNative:void 0;return es.isSupportedVersion(e,n)}),e.prototype.getSyeVersion=freeOnUnref(function(){var e=this.syeAPIControlAPI.SYE_GetVersion;if(void 0!==e)return e()}),e.prototype.setup=freeOnUnref(function(e){this.syeAPIControlAPI.SYE_Setup(JSON.stringify(e))}),e.prototype.createPlayer=freeOnUnref(function(e,t,n){return this.syeAPIControlAPI.SYE_CreatePlayer(e,JSON.stringify(t),JSON.stringify(n))}),e.prototype.setVideoLimitations=freeOnUnref(function(e){this.syeAPIControlAPI.SYE_SetVideoLimitations(JSON.stringify(e))}),e.prototype.getLocalTimeMicros=freeOnUnref(function(){return this.syeAPIControlAPI.SYE_GetLocalTimeMicros()}),e.prototype.getAudioCapabilitiesAPI=freeOnUnref(function(){if(void 0!==this.syeAPIControlAPI&&void 0!==this.syeAPIControlAPI.SYE_SetAudioCapabilities){var t=this.syeAPIControlAPI;return{setAudioCapabilities:freeOnUnref(function(e){return t.SYE_SetAudioCapabilities(JSON.stringify(e))}),getAudioCapabilities:t.SYE_GetAudioCapabilities,constants:t}}}),e.prototype.getVideoCapabilitiesAPI=freeOnUnref(function(){if(void 0!==this.syeAPIControlAPI&&void 0!==this.syeAPIControlAPI.SYE_SetVideoCapabilities){var t=this.syeAPIControlAPI;return{setVideoCapabilities:freeOnUnref(function(e){return t.SYE_SetVideoCapabilities(JSON.stringify(e))}),getVideoCapabilities:t.SYE_GetVideoCapabilities,constants:t}}}),e})(),r=freeOnUnref(function(){function e(e){this.syeNativeAPI=e||Za.tryGetNative()}return e.prototype.getSyeAPI=freeOnUnref(function(){return new n(this.syeNativeAPI.syeApiInterface||void 0,this.syeNativeAPI.syeMpbInterface||void 0)}),e})();t.SyeAPIControlFactory=r}));e(ts);ts.SyeAPIControlFactory;var ns=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var t=this;this.syeMpbControlAPI=e||Za.tryGetNative(),void 0!==this.syeMpbControlAPI.SYE_Mpb_SetPictureMode&&(this.setPictureMode=freeOnUnref(function(e){t.syeMpbControlAPI.SYE_Mpb_SetPictureMode(e)}))}return e.prototype.poll=freeOnUnref(function(){return this.syeMpbControlAPI.SYE_Mpb_Poll()}),e.prototype.getScreenWidth=freeOnUnref(function(){return this.syeMpbControlAPI.GetScreenWidth()}),e.prototype.getScreenHeight=freeOnUnref(function(){return this.syeMpbControlAPI.GetScreenHeight()}),e.prototype.playbackInit=freeOnUnref(function(e){this.syeMpbControlAPI.SYE_Mpb_PlaybackInit(e)}),e.prototype.playbackShutdown=freeOnUnref(function(){this.syeMpbControlAPI.SYE_Mpb_PlaybackShutdown()}),e.prototype.playbackPlay=freeOnUnref(function(e){this.syeMpbControlAPI.SYE_Mpb_PlaybackPlay(e)}),e.prototype.playbackStop=freeOnUnref(function(){this.syeMpbControlAPI.SYE_Mpb_PlaybackStop()}),e.prototype.playbackPause=freeOnUnref(function(){this.syeMpbControlAPI.SYE_Mpb_PlaybackPause()}),e.prototype.playbackSeek=freeOnUnref(function(e){this.syeMpbControlAPI.SYE_Mpb_PlaybackSeek(e)}),e.prototype.playbackFlush=freeOnUnref(function(){this.syeMpbControlAPI.SYE_Mpb_PlaybackFlush()}),e.prototype.getPlaybackTime=freeOnUnref(function(){return this.syeMpbControlAPI.SYE_Mpb_GetPlaybackTime()}),e.prototype.getDiagnosticInfo=freeOnUnref(function(){return this.syeMpbControlAPI.SYE_Mpb_GetDiagnosticInfo()}),e.prototype.sendVideoMetadata=freeOnUnref(function(e,t,n,r){this.syeMpbControlAPI.SYE_Mpb_SendVideoMetadata(e,t,n,r)}),e.prototype.sendAudioMetadata=freeOnUnref(function(e,t,n){this.syeMpbControlAPI.SYE_Mpb_SendAudioMetadata(e,t,n)}),e.prototype.videoStreamStart=freeOnUnref(function(){this.syeMpbControlAPI.SYE_Mpb_VideoStreamStart()}),e.prototype.videoStreamFinish=freeOnUnref(function(){this.syeMpbControlAPI.SYE_Mpb_VideoStreamFinish()}),e.prototype.sendVideoUnencryptedAU=freeOnUnref(function(e,t,n){this.syeMpbControlAPI.SYE_Mpb_SendVideoUnencryptedAU(e,t,n)}),e.prototype.audioStreamStart=freeOnUnref(function(){this.syeMpbControlAPI.SYE_Mpb_AudioStreamStart()}),e.prototype.audioStreamFinish=freeOnUnref(function(){this.syeMpbControlAPI.SYE_Mpb_AudioStreamFinish()}),e.prototype.sendAudioUnencryptedAU=freeOnUnref(function(e,t,n,r){this.syeMpbControlAPI.SYE_Mpb_SendAudioUnencryptedAU(e,t,n,r)}),e.prototype.mapConnectorPictureModeToNativePictureMode=freeOnUnref(function(e){return this.syeMpbControlAPI.UNF_PICTURE_MODE_CM_BROADCAST}),e.prototype.mapNativePictureModeToConnectorPictureMode=freeOnUnref(function(e){switch(e){case this.syeMpbControlAPI.UNF_PICTURE_MODE_NONE:return 0;case this.syeMpbControlAPI.UNF_PICTURE_MODE_CM_BROADCAST:return 2}return-1}),e})(),r=freeOnUnref(function(){function e(e){this.syeNativeAPI=e||Za.tryGetNative()}return e.prototype.getSyeMpbAPI=freeOnUnref(function(){return new n(this.syeNativeAPI.syeMpbInterface||void 0)}),e})();t.SyeMpbControlFactory=r}));e(ns);ns.SyeMpbControlFactory;var rs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(){this.syePlayerControlFactoryAPI=new $a.SyePlayerControlFactory,this.syeAPIControlFactoryAPI=new ts.SyeAPIControlFactory,this.syeMpbControlFactoryAPI=new ns.SyeMpbControlFactory}})();t.Connector=n}));e(rs);rs.Connector;var is=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=new rs.Connector;t.connector=n}));e(is);is.connector;var os=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.kEnabled=0]="kEnabled",e[e.kHardwareDisabled=1]="kHardwareDisabled",e[e.kSoftwareDisabled=2]="kSoftwareDisabled"})(t.SyeAudioTrackState||(t.SyeAudioTrackState={})),freeOnUnref(function(e){e[e.kUndefined=0]="kUndefined",e[e.kAAC=1]="kAAC",e[e.kEC3=2]="kEC3"})(t.SyeAudioCodec||(t.SyeAudioCodec={}))}));e(os);os.SyeAudioTrackState,os.SyeAudioCodec;var as=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.kUndefined=0]="kUndefined",e[e.kAAC_LC=1]="kAAC_LC",e[e.kEC3_Atmos=2]="kEC3_Atmos",e[e.kEC3=3]="kEC3"})(t.SyeAudioCodecProfile||(t.SyeAudioCodecProfile={}))}));e(as);as.SyeAudioCodecProfile;var ss=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.kNewPlay=0]="kNewPlay",e[e.kTrackChange=1]="kTrackChange"})(t.SyeAudioTrackSwitchMode||(t.SyeAudioTrackSwitchMode={}))}));e(ss);ss.SyeAudioTrackSwitchMode;var ls=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.kStopped=0]="kStopped",e[e.kLoading=1]="kLoading",e[e.kPlaying=2]="kPlaying",e[e.kStalled=3]="kStalled",e[e.kAIS=4]="kAIS",e[e.kError=5]="kError"})(t.SyePlayerState||(t.SyePlayerState={})),freeOnUnref(function(e){e[e.kClosest=0]="kClosest",e[e.kForward=1]="kForward",e[e.kBackward=2]="kBackward"})(t.SyeSearchPredicate||(t.SyeSearchPredicate={}))}));e(ls);ls.SyePlayerState,ls.SyeSearchPredicate;var fs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.kEnabled=0]="kEnabled",e[e.kHardwareDisabled=1]="kHardwareDisabled",e[e.kSoftwareDisabled=2]="kSoftwareDisabled"})(t.SyeVideoTrackState||(t.SyeVideoTrackState={})),freeOnUnref(function(e){e[e.kUndefined=0]="kUndefined",e[e.kH264=1]="kH264",e[e.kHEVC=2]="kHEVC"})(t.SyeVideoCodec||(t.SyeVideoCodec={}))}));e(fs);fs.SyeVideoTrackState,fs.SyeVideoCodec;var us=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.kLive=0]="kLive",e[e.kOffset=1]="kOffset",e[e.kUtcTime=2]="kUtcTime"})(t.SyePlaybackType||(t.SyePlaybackType={}))}));e(us);us.SyePlaybackType;var cs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.kForbidden="Forbidden",e.kBadRequest="BadRequest",e.kAuthServerError="AuthServerError",e.kServerError="ServerError",e.kNetworkError="NetworkError",e.kUnexpectedStatus="UnexpectedStatus",e.kNoPitcher="NoPitcher"})(t.SyeFetchChannelsError||(t.SyeFetchChannelsError={}))}));e(cs);cs.SyeFetchChannelsError;var ds=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.FrontendError="FrontendError",e.StreamingError="StreamingError",e.TTFF="TTFF",e.Rebuffer="Rebuffer",e.FatalError="FatalError",e.MediaPipelineError="MediaPipelineError",e.PlaybackDrift="PlaybackDrift",e.BufferUnderrun="BufferUnderrun",e.TimeToPlaybackStarted="TimeToPlaybackStarted",e.TimeSeekReadyToPlay="TimeSeekReadyToPlay",e.AVSync="AVSync",e.GlobalSync="GlobalSync",e.CoarseSpeedUpPerSecond="CoarseSpeedUpPerSecond",e.CoarseSlowDownPerSecond="CoarseSlowDownPerSecond",e.FineSpeedUpPerSecond="FineSpeedUpPerSecond",e.FineSlowDownPerSecond="FineSlowDownPerSecond",e.UtcLocalDriftPerSecond="UtcLocalDriftPerSecond",e.UtcPlaybackDriftPerSecond="UtcPlaybackDriftPerSecond",e.LocalPlaybackDriftPerSecond="LocalPlaybackDriftPerSecond",e.TimeToSync="TimeToSync",e.InitialAVSync="InitialAVSync",e.InitialGlobalSync="InitialGlobalSync",e.InitialCoarseSpeedUpPerSecond="InitialCoarseSpeedUpPerSecond",e.InitialCoarseSlowDownPerSecond="InitialCoarseSlowDownPerSecond",e.InitialFineSpeedUpPerSecond="InitialFineSpeedUpPerSecond",e.InitialFineSlowDownPerSecond="InitialFineSlowDownPerSecond",e.InitialUtcLocalDriftPerSecond="InitialUtcLocalDriftPerSecond",e.InitialUtcPlaybackDriftPerSecond="InitialUtcPlaybackDriftPerSecond",e.InitialLocalPlaybackDriftPerSecond="InitialLocalPlaybackDriftPerSecond"})(t.SyeMetricsType||(t.SyeMetricsType={}))}));e(ds);ds.SyeMetricsType;var ps=t(freeOnUnref(function(e,t){var n,r,i;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.Samples=0]="Samples",e[e.Segments=1]="Segments"})(n||(n={})),freeOnUnref(function(e){e[e.AnnexB=0]="AnnexB",e[e.Avcc=1]="Avcc"})(r||(r={})),freeOnUnref(function(e){e[e.NoFraming=0]="NoFraming",e[e.ADTS=1]="ADTS"})(i||(i={}));var o=freeOnUnref(function(){return function(){}})();t.SyePlayerConfig=o}));e(ps);ps.SyePlayerConfig;var hs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.kForbidden="Forbidden",e.kAuthServerError="AuthServerError",e.kBadRequest="BadRequest",e.kChannelNotFound="ChannelNotFound",e.kNoPitcher="NoPitcher",e.kTimeshiftOutOfRange="TimeshiftOutOfRange",e.kUnexpectedStatus="UnexpectedStatus",e.kServerError="ServerError",e.kUnsupportedProtocol="UnsupportedProtocol",e.kUnsupportedVersion="UnsupportedVersion",e.kCommunicationTimeout="CommunicationTimeout",e.kUnknownChannel="UnknownChannel",e.kUnknownTrack="UnknownTrack",e.kException="Exception",e.kReallocateStream="ReallocateStream",e.kDRMNoKeyError="DRMNoKeyError",e.kDRMError="DRMError",e.kNetworkError="NetworkError",e.kSendError="SendError",e.kBadInput="BadInput",e.kUnsupportedVideoFormat="UnsupportedVideoFormat",e.kUnsupportedAudioFormat="UnsupportedAudioFormat",e.kApplicationSuspended="ApplicationSuspended",e.kPlatformException="PlatformException",e.kInitialPlayAttemptFailed="InitialPlayAttemptFailed",e.kTryAgain="TryAgain",e.kMediaTimeout="MediaTimeout",e.kUDPTimeout="UDPTimeout",e.kPlayingStateTimeout="PlayingStateTimeout",e.kFatalPlatformException="FatalPlatformException",e.kClockInitialJumpTooLarge="ClockInitialJumpTooLarge",e.kClockMovingTooFast="ClockMovingTooFast",e.kClockMovingBackwards="ClockMovingBackwards",e.kClockJumpTooLarge="ClockJumpTooLarge",e.kWasmSetupFailed="WasmSetupFailed"})(t.SyePlayerError||(t.SyePlayerError={}))}));e(hs);hs.SyePlayerError;var ms=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(e,t){this.baseUrl=e,this.credentials=t||""}})();t.SyeFrontend=n;var r=freeOnUnref(function(){function e(e,t){this.urls=[e],this.name=t}return e.prototype.add=freeOnUnref(function(e){this.urls.push(e)}),e.prototype.getUrls=freeOnUnref(function(){return this.urls}),e.prototype.getName=freeOnUnref(function(){return this.name}),e})();t.SyeDomain=r;var i=freeOnUnref(function(){function e(e,t){if(this.domains=[],this.syeFrontends=[],this.credentials=t||"",e instanceof r)this.domains=[e];else{if(!(e instanceof n))throw TypeError("SyeSystem(): First argument must be a SyeDomain or SyeFrontend");this.syeFrontends=[e],this.credentials=e.credentials}}return e.prototype.add=freeOnUnref(function(e){this.domains.push(e)}),e.prototype.getDomains=freeOnUnref(function(){return this.domains}),e.prototype.set=freeOnUnref(function(e){this.credentials=e}),e.prototype.addSyeFrontend=freeOnUnref(function(e){this.syeFrontends.push(e)}),e.prototype.getSyeFrontends=freeOnUnref(function(){return this.syeFrontends}),e.prototype.toInternalJSON=freeOnUnref(function(){var t=[];this.domains.forEach(freeOnUnref(function(e){return t.push(e)})),this.syeFrontends.forEach(freeOnUnref(function(e){return t.push(new r(e.baseUrl,"Unknown"))}));var e={domains:t,credentials:this.credentials};return JSON.stringify(e)}),e})();t.SyeSystem=i}));e(ms);ms.SyeFrontend,ms.SyeDomain,ms.SyeSystem;var ys=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(e,t){this.kid=e,this.key=t}})();t.SyeDrmKey=n}));e(ys);ys.SyeDrmKey;var gs=t(freeOnUnref(function(e,t){function i(e){return"number"==typeof e}Object.defineProperty(t,"__esModule",{value:!0}),t.bind=function(e,t){for(var n=Object.getOwnPropertyDescriptors,r=Object.keys(n(Object.getPrototypeOf(e))),i=0,o=t;i<o.length;i++)for(var a=o[i],s=0,l=r;s<l.length;s++){var f=l[s];e[f]===a&&(e[f]=a.bind(e))}},t.isNumber=i,t.validateNumericEnumValue=function(e,t,n,r){if(void 0!==e){if(!i(e))throw new TypeError(r+": should be a number");if(e<t||n<e)throw new TypeError(r+": Invalid value. "+e+" is not in the expected enum range")}};var n=freeOnUnref(function(){function e(e,t){if(this.mAverage=0,this.mFirst=!0,this.mRequiredSamples=0,this.mNumberOfSamples=0,100<e||e<0)throw TypeError("aForgettingPercent must be a number between 0 and 100");this.mForgettingFactor=(100-e)/100,this.mRequiredSamples=t}return e.prototype.Add=freeOnUnref(function(e){if(this.mNumberOfSamples++,this.mFirst)this.mFirst=!1,this.mAverage=e;else{var t=this.mAverage*this.mForgettingFactor+(1-this.mForgettingFactor)*e;this.mAverage=t}}),e.prototype.Value=freeOnUnref(function(){return this.mAverage}),e.prototype.Ready=freeOnUnref(function(){return this.mRequiredSamples<=this.mNumberOfSamples}),e.prototype.Reset=freeOnUnref(function(){this.mFirst=!0,this.mAverage=0,this.mNumberOfSamples=0}),e})();t.MovingAverage=n}));e(gs);gs.bind,gs.isNumber,gs.validateNumericEnumValue,gs.MovingAverage;var vs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.windowFillColor=void 0,this.windowOpacity=void 0,this.textBackgroundColor=void 0,this.textBackgroundOpacity=void 0,this.textColor=void 0,this.textOpacity=void 0,this.textEdgeColor=void 0,this.textEdgeStyle=void 0,this.fontStyle=void 0,this.penSize=1,this.safeTitleArea=0,this.aspectRatio=1}return e.prototype.getWindowFillColor=freeOnUnref(function(){return this.windowFillColor}),e.prototype.setWindowFillColor=freeOnUnref(function(e){this.windowFillColor=e}),e.prototype.getWindowOpacity=freeOnUnref(function(){return this.windowOpacity}),e.prototype.setWindowOpacity=freeOnUnref(function(e){gs.validateNumericEnumValue(e,0,3,"windowOpacity"),this.windowOpacity=e}),e.prototype.getTextBackgroundColor=freeOnUnref(function(){return this.textBackgroundColor}),e.prototype.setTextBackgroundColor=freeOnUnref(function(e){this.textBackgroundColor=e}),e.prototype.getTextBackgroundOpacity=freeOnUnref(function(){return this.textBackgroundOpacity}),e.prototype.setTextBackgroundOpacity=freeOnUnref(function(e){gs.validateNumericEnumValue(e,0,3,"textBackgroundOpacity"),this.textBackgroundOpacity=e}),e.prototype.getTextColor=freeOnUnref(function(){return this.textColor}),e.prototype.setTextColor=freeOnUnref(function(e){this.textColor=e}),e.prototype.getTextOpacity=freeOnUnref(function(){return this.textOpacity}),e.prototype.setTextOpacity=freeOnUnref(function(e){gs.validateNumericEnumValue(e,0,3,"textOpacity"),this.textOpacity=e}),e.prototype.getTextEdgeColor=freeOnUnref(function(){return this.textEdgeColor}),e.prototype.setTextEdgeColor=freeOnUnref(function(e){this.textEdgeColor=e}),e.prototype.getTextEdgeStyle=freeOnUnref(function(){return this.textEdgeStyle}),e.prototype.setTextEdgeStyle=freeOnUnref(function(e){gs.validateNumericEnumValue(e,0,5,"textEdgeStyle"),this.textEdgeStyle=e}),e.prototype.getFontStyle=freeOnUnref(function(){return this.fontStyle}),e.prototype.setFontStyle=freeOnUnref(function(e){gs.validateNumericEnumValue(e,0,7,"fontStyle"),this.fontStyle=e}),e.prototype.getPenSize=freeOnUnref(function(){return this.penSize}),e.prototype.setPenSize=freeOnUnref(function(e){gs.validateNumericEnumValue(e,0,4,"penSize"),this.penSize=e}),e.prototype.getSafeTitleArea=freeOnUnref(function(){return this.safeTitleArea}),e.prototype.setSafeTitleArea=freeOnUnref(function(e){gs.validateNumericEnumValue(e,0,1,"safeTitleArea"),this.safeTitleArea=e}),e.prototype.getAspectRatio=freeOnUnref(function(){return this.aspectRatio}),e.prototype.setAspectRatio=freeOnUnref(function(e){gs.validateNumericEnumValue(e,0,1,"aspectRatio"),this.aspectRatio=e}),e})();t.SyeDTVCCSettings=n}));e(vs);vs.SyeDTVCCSettings;var Os=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.None="None",e.Filmmaker="Filmmaker",e.CalibratedBroadcast="CalibratedBroadcast",e.CalibratedCinematic="CalibratedCinematic"})(t.SyePictureMode||(t.SyePictureMode={}))}));e(Os);Os.SyePictureMode;var Ss=t(freeOnUnref(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SyeAudioTrackState=os.SyeAudioTrackState,n.SyeAudioCodec=os.SyeAudioCodec,n.SyeAudioCodecProfile=as.SyeAudioCodecProfile,n.SyeAudioTrackSwitchMode=ss.SyeAudioTrackSwitchMode,n.SyePlayerState=ls.SyePlayerState,n.SyeSearchPredicate=ls.SyeSearchPredicate,n.SyeVideoTrackState=fs.SyeVideoTrackState,n.SyeVideoCodec=fs.SyeVideoCodec,n.SyePlaybackType=us.SyePlaybackType,n.SyeFetchChannelsError=cs.SyeFetchChannelsError,n.SyeMetricsType=ds.SyeMetricsType,n.SyePlayerConfig=ps.SyePlayerConfig,n.SyePlayerError=hs.SyePlayerError,n.SyeFrontend=ms.SyeFrontend,n.SyeSystem=ms.SyeSystem,n.SyeDomain=ms.SyeDomain,n.SyeDrmKey=ys.SyeDrmKey,function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(vs),n.SyePictureMode=Os.SyePictureMode}));e(Ss);Ss.SyeAudioTrackState,Ss.SyeAudioCodec,Ss.SyeAudioCodecProfile,Ss.SyeAudioTrackSwitchMode,Ss.SyePlayerState,Ss.SyeSearchPredicate,Ss.SyeVideoTrackState,Ss.SyeVideoCodec,Ss.SyePlaybackType,Ss.SyeFetchChannelsError,Ss.SyeMetricsType,Ss.SyePlayerConfig,Ss.SyePlayerError,Ss.SyeFrontend,Ss.SyeSystem,Ss.SyeDomain,Ss.SyeDrmKey,Ss.SyePictureMode;var Us=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.kForbidden=1]="kForbidden",e[e.kAuthServerError=2]="kAuthServerError",e[e.kBadRequest=3]="kBadRequest",e[e.kChannelNotFound=4]="kChannelNotFound",e[e.kNoPitcher=5]="kNoPitcher",e[e.kTimeshiftOutOfRange=6]="kTimeshiftOutOfRange",e[e.kUnexpectedStatus=7]="kUnexpectedStatus",e[e.kServerError=8]="kServerError",e[e.kUnsupportedProtocol=9]="kUnsupportedProtocol",e[e.kUnsupportedVersion=10]="kUnsupportedVersion",e[e.kCommunicationTimeout=11]="kCommunicationTimeout",e[e.kUnknownChannel=12]="kUnknownChannel",e[e.kException=13]="kException",e[e.kReallocateStream=14]="kReallocateStream",e[e.kDRMNoKeyError=15]="kDRMNoKeyError",e[e.kDRMError=16]="kDRMError",e[e.kNetworkError=17]="kNetworkError",e[e.kBadInput=18]="kBadInput",e[e.kUnsupportedVideoFormat=19]="kUnsupportedVideoFormat",e[e.kUnsupportedAudioFormat=20]="kUnsupportedAudioFormat",e[e.kApplicationSuspended=21]="kApplicationSuspended",e[e.kPlatformException=22]="kPlatformException",e[e.kPlayAttemptFailed=23]="kPlayAttemptFailed",e[e.kTryAgain=24]="kTryAgain",e[e.kMediaTimeout=25]="kMediaTimeout",e[e.kUDPTimeout=26]="kUDPTimeout",e[e.kPlayingStateTimeout=27]="kPlayingStateTimeout",e[e.kFatalPlatformException=28]="kFatalPlatformException"})(n||(n={})),t.SCPPlayerErrorToSyePlayerError=function(e){switch(e){case n.kForbidden:return Ss.SyePlayerError.kForbidden;case n.kAuthServerError:return Ss.SyePlayerError.kAuthServerError;case n.kBadRequest:return Ss.SyePlayerError.kBadRequest;case n.kChannelNotFound:return Ss.SyePlayerError.kChannelNotFound;case n.kNoPitcher:return Ss.SyePlayerError.kNoPitcher;case n.kTimeshiftOutOfRange:return Ss.SyePlayerError.kTimeshiftOutOfRange;case n.kUnexpectedStatus:return Ss.SyePlayerError.kUnexpectedStatus;case n.kServerError:return Ss.SyePlayerError.kServerError;case n.kUnsupportedProtocol:return Ss.SyePlayerError.kUnsupportedProtocol;case n.kUnsupportedVersion:return Ss.SyePlayerError.kUnsupportedVersion;case n.kCommunicationTimeout:return Ss.SyePlayerError.kCommunicationTimeout;case n.kUnknownChannel:return Ss.SyePlayerError.kUnknownChannel;case n.kException:return Ss.SyePlayerError.kException;case n.kReallocateStream:return Ss.SyePlayerError.kReallocateStream;case n.kDRMNoKeyError:return Ss.SyePlayerError.kDRMNoKeyError;case n.kDRMError:return Ss.SyePlayerError.kDRMError;case n.kNetworkError:return Ss.SyePlayerError.kNetworkError;case n.kBadInput:return Ss.SyePlayerError.kBadInput;case n.kUnsupportedVideoFormat:return Ss.SyePlayerError.kUnsupportedVideoFormat;case n.kUnsupportedAudioFormat:return Ss.SyePlayerError.kUnsupportedAudioFormat;case n.kApplicationSuspended:return Ss.SyePlayerError.kApplicationSuspended;case n.kPlatformException:return Ss.SyePlayerError.kPlatformException;case n.kPlayAttemptFailed:return Ss.SyePlayerError.kInitialPlayAttemptFailed;case n.kTryAgain:return Ss.SyePlayerError.kTryAgain;case n.kMediaTimeout:return Ss.SyePlayerError.kMediaTimeout;case n.kUDPTimeout:return Ss.SyePlayerError.kUDPTimeout;case n.kPlayingStateTimeout:return Ss.SyePlayerError.kPlayingStateTimeout;case n.kFatalPlatformException:return Ss.SyePlayerError.kFatalPlatformException;default:throw TypeError("Unknown SCP PlayerError code.")}},t.NativePlayerStateStringToSyePlayerState=function(e){switch(e){case"Stopped":return Ss.SyePlayerState.kStopped;case"Loading":return Ss.SyePlayerState.kLoading;case"Playing":return Ss.SyePlayerState.kPlaying;case"Stalled":return Ss.SyePlayerState.kStalled;case"AIS":return Ss.SyePlayerState.kAIS;case"Error":return Ss.SyePlayerState.kError;default:throw TypeError("Unknown SCP PlayerState string.")}}}));e(Us);Us.SCPPlayerErrorToSyePlayerError,Us.NativePlayerStateStringToSyePlayerState;var bs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("LiveLowLatencySDKUnf"),r=freeOnUnref(function(){function e(e){this.instance=e,this.prevValue=new Uint8Array([])}return e.prototype.getBuffer=freeOnUnref(function(e,t,n){return 1!==e&&(this.prevValue=this.instance.getOwnedBuffer(e,t,n.pointer)),this.prevValue}),e})(),i=freeOnUnref(function(){function e(e,t){this.instance=e,this.vmManager=t,this.getEventsFnc=this.instance.getFunction("ignition_x_sye_get_events","p(p)"),this.pollFnc=this.instance.getFunction("ignition_x_sye_poll","F(p)"),this.getPresentationDelayMillisFnc=this.instance.getFunction("ignition_x_sye_get_presentation_delay_millis","F(p)"),this.getUtcTimeMicrosFnc=this.instance.getFunction("ignition_x_sye_get_utc_time_micros","F(pF)"),this.vpsCache=new r(e),this.spsCache=new r(e),this.ppsCache=new r(e),n.info("ScpWasmPlayerControl initialized")}return e.prototype.bufferOffsetToModuleOffset=freeOnUnref(function(e){return"number"==typeof e?e:BigInt(e)}),e.prototype.callSyeFunction=freeOnUnref(function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(t=this.instance).callFunction.apply(t,["ignition_x_sye_"+e].concat(n))}),e.prototype.isUsingExternalBuffers=freeOnUnref(function(e){return!!this.callSyeFunction("is_using_external_buffers",e.pointer)}),e.prototype.useExternalBuffers=freeOnUnref(function(e,t){if(!t)throw new Error("External buffers must be enabled for Sye WASM");this.callSyeFunction("use_external_buffers",e.pointer,1)}),e.prototype.poll=freeOnUnref(function(e){var t=this.vmManager.WebAssembly_FunctionInvoke(this.getEventsFnc,this.instance.toSignedOffset(e.pointer));try{for(var n=this.instance.readJSON(t,[]),r=n.length;r--;)2===n[r][0]?n[r]={fn:"onVideoSampleEvent",arg:{data:{externalBuffer:this.instance.getOwnedBuffer(this.bufferOffsetToModuleOffset(n[r][1]),n[r][2],e.pointer)},vps:{externalBuffer:this.vpsCache.getBuffer(this.bufferOffsetToModuleOffset(n[r][3]),n[r][4],e)},sps:{externalBuffer:this.spsCache.getBuffer(this.bufferOffsetToModuleOffset(n[r][5]),n[r][6],e)},pps:{externalBuffer:this.ppsCache.getBuffer(this.bufferOffsetToModuleOffset(n[r][7]),n[r][8],e)},width:n[r][9],height:n[r][10],framerateNum:n[r][11],framerateDen:n[r][12],localTimeMicros:n[r][13],pts:n[r][14],dts:n[r][15],videoCodec:n[r][16],isIDRFrame:!!n[r][17],decodeOnly:!!n[r][18],displayImmediately:!!n[r][19],origin:n[r][20],doviProfile:n[r][21],doviLevel:n[r][22],isEncrypted:!!n[r][23],kid:n[r][24],iv:n[r][25],subsamples:n[r][26].map(freeOnUnref(function(e){return{numClearBytes:e[0],numEncryptedBytes:e[1]}}))}}:1===n[r][0]&&(n[r]={fn:"onAudioSampleEvent",arg:{data:{externalBuffer:this.instance.getOwnedBuffer(this.bufferOffsetToModuleOffset(n[r][1]),n[r][2],e.pointer)},localTimeMicros:n[r][3],duration:n[r][4],timescale:n[r][5],pts:n[r][6],samplerate:n[r][7],numChannels:n[r][8],audioCodec:n[r][9],isDiscontinuity:!!n[r][10],origin:n[r][11],isEncrypted:!!n[r][12],kid:n[r][13],iv:n[r][14],subsamples:n[r][15].map(freeOnUnref(function(e){return{numClearBytes:e[0],numEncryptedBytes:e[1]}}))}});return n}finally{this.instance.free(t)}}),e.prototype.poll_scp=freeOnUnref(function(e){return this.vmManager.WebAssembly_FunctionInvoke(this.pollFnc,this.instance.toSignedOffset(e.pointer))}),e.prototype.playFromLive=freeOnUnref(function(e,t){var n=this.instance.writeString(t),r=n[0],i=n[1];try{this.callSyeFunction("play_from_live",e.pointer,r,i)}finally{this.instance.free(r)}}),e.prototype.playFromUtcTime=freeOnUnref(function(e,t,n){var r=this.instance.writeString(t),i=r[0],o=r[1];try{this.callSyeFunction("play_from_utc_time",e.pointer,i,o,n)}finally{this.instance.free(i)}}),e.prototype.playWithOffset=freeOnUnref(function(e,t,n){var r=this.instance.writeString(t),i=r[0],o=r[1];try{this.callSyeFunction("play_with_offset",e.pointer,i,o,n)}finally{this.instance.free(i)}}),e.prototype.playResume=freeOnUnref(function(e){this.callSyeFunction("play_resume",e.pointer)}),e.prototype.getPresentationDelayMillis=freeOnUnref(function(e){return this.vmManager.WebAssembly_FunctionInvoke(this.getPresentationDelayMillisFnc,this.instance.toSignedOffset(e.pointer))}),e.prototype.getUtcTimeMicros=freeOnUnref(function(e,t){return this.vmManager.WebAssembly_FunctionInvoke(this.getUtcTimeMicrosFnc,this.instance.toSignedOffset(e.pointer),t)}),e.prototype.getCurrentChannelId=freeOnUnref(function(e){var t=this.instance.toModuleOffset(this.callSyeFunction("get_current_channel_id",e.pointer));try{var n=this.instance.readString(t);if(void 0===n)throw new Error("Failed to read string from Sye module instance");return n}finally{this.instance.free(t)}}),e.prototype.pause=freeOnUnref(function(e){this.callSyeFunction("pause",e.pointer)}),e.prototype.stop=freeOnUnref(function(e){this.callSyeFunction("stop",e.pointer)}),e.prototype.selectClosedCaptionsType=freeOnUnref(function(e,t){this.callSyeFunction("select_closed_captions_type",e.pointer,t)}),e.prototype.getSelectedClosedCaptionsType=freeOnUnref(function(e){return Number(this.callSyeFunction("get_selected_closed_captions_type",e.pointer))}),e.prototype.getVideoStreamInfo=freeOnUnref(function(e){var t=this.instance.toModuleOffset(this.callSyeFunction("get_video_stream_info",e.pointer));try{return this.instance.readJSON(t)}finally{this.instance.free(t)}}),e.prototype.getMetrics=freeOnUnref(function(e){var t=this.instance.toModuleOffset(this.callSyeFunction("get_metrics",e.pointer));try{return this.instance.readJSON(t)}finally{this.instance.free(t)}}),e.prototype.getMetadata=freeOnUnref(function(){return{scpCompilationTarget:this.instance.getModuleName()}}),e.prototype.updateSyeSystem=freeOnUnref(function(e,t){var n=this.instance.writeJSON(t),r=n[0],i=n[1];try{this.callSyeFunction("update",e.pointer,r,i)}finally{this.instance.free(r)}}),e.prototype.getPlayerState=freeOnUnref(function(e){switch(Number(this.callSyeFunction("get_player_state",e.pointer))){case 0:return"Stopped";case 1:return"Loading";case 2:return"Playing";case 3:return"Stalled";case 4:return"AIS";case 5:return"Error";default:return"Unknown"}}),e.prototype.getAudioStreamInfo=freeOnUnref(function(e){var t=this.instance.toModuleOffset(this.callSyeFunction("get_audio_stream_info",e.pointer));try{return this.instance.readJSON(t)}finally{this.instance.free(t)}}),e.prototype.getAvailableAudioTracks=freeOnUnref(function(e){var t=this.instance.toModuleOffset(this.callSyeFunction("get_available_audio_tracks",e.pointer));try{return this.instance.readJSON(t)}finally{this.instance.free(t)}}),e.prototype.getSelectedClosedCaptionsChannel=freeOnUnref(function(e){return Number(this.callSyeFunction("get_selected_closed_captions_channel",e.pointer))}),e.prototype.getSelectedClosedCaptionsService=freeOnUnref(function(e){return Number(this.callSyeFunction("get_selected_closed_captions_service",e.pointer))}),e.prototype.selectClosedCaptionsChannel=freeOnUnref(function(e,t){this.callSyeFunction("select_closed_captions_channel",e.pointer,t)}),e.prototype.selectClosedCaptionsService=freeOnUnref(function(e,t){this.callSyeFunction("select_closed_captions_service",e.pointer,t)}),e.prototype.getAvailableClosedCaptionsChannels=freeOnUnref(function(e){var t=this.instance.toModuleOffset(this.callSyeFunction("get_available_closed_captions_channels",e.pointer));try{return this.instance.readJSON(t)}finally{this.instance.free(t)}}),e.prototype.getAvailableClosedCaptionsServices=freeOnUnref(function(e){var t=this.instance.toModuleOffset(this.callSyeFunction("get_available_closed_captions_services",e.pointer));try{return this.instance.readJSON(t)}finally{this.instance.free(t)}}),e.prototype.getThumbnail=freeOnUnref(function(e,t){var n=this.callSyeFunction("get_thumbnail_metadata",e.pointer,t);try{return this.instance.readJSON(n,null)}finally{this.instance.free(n)}}),e.prototype.synchronize=freeOnUnref(function(e){this.callSyeFunction("synchronize",e.pointer)}),e.prototype.cacheThumbnailsFromLive=freeOnUnref(function(e,t){this.callSyeFunction("cache_thumbnails_from_live",e.pointer,t)}),e.prototype.cacheThumbnailsForInterval=freeOnUnref(function(e,t,n){this.callSyeFunction("cache_thumbnails_for_interval",e.pointer,t,n)}),e.prototype.getDTVCCSettings=freeOnUnref(function(e){var t=this.instance.toModuleOffset(this.callSyeFunction("get_dtvcc_settings",e.pointer));try{return this.instance.readJSON(t)}finally{this.instance.free(t)}}),e.prototype.setDTVCCSettings=freeOnUnref(function(e,t){var n=this.instance.writeJSON(t),r=n[0],i=n[1];try{this.callSyeFunction("set_dtvcc_settings",e.pointer,r,i)}finally{this.instance.free(r)}}),e.prototype.getAudioPreferences=freeOnUnref(function(e){var t=this.instance.toModuleOffset(this.callSyeFunction("get_audio_preferences",e.pointer));try{return this.instance.readJSON(t)}finally{this.instance.free(t)}}),e.prototype.setAudioPreferences=freeOnUnref(function(e,t){var n=this.instance.writeJSON(t),r=n[0],i=n[1];try{this.callSyeFunction("set_audio_preferences",e.pointer,r,i)}finally{this.instance.free(r)}}),e.prototype.getVideoPreferences=freeOnUnref(function(e){var t=this.instance.toModuleOffset(this.callSyeFunction("get_video_preferences",e.pointer));try{return this.instance.readJSON(t)}finally{this.instance.free(t)}}),e.prototype.setVideoPreferences=freeOnUnref(function(e,t){var n=this.instance.writeJSON(t),r=n[0],i=n[1];try{this.callSyeFunction("set_video_preferences",e.pointer,r,i)}finally{this.instance.free(r)}}),e.prototype.reportWarning=freeOnUnref(function(e,t,n){var r=this.instance.writeString(n),i=r[0],o=r[1];try{var a=0;switch(t){case"kDecodeFailure":a=0;break;case"kDroppedFrames":a=1}this.callSyeFunction("report_warning",e.pointer,a,i,o)}finally{this.instance.free(i)}}),e.prototype.reportError=freeOnUnref(function(e,t,n){var r=this.instance.writeString(n),i=r[0],o=r[1];try{var a=0;switch(t){case"kUnsupportedVideoFormat":a=0;break;case"kUnsupportedAudioFormat":a=1;break;case"kApplicationSuspended":a=2;break;case"kPlatformException":a=3;break;case"kFatalPlatformException":a=4}this.callSyeFunction("report_error",e.pointer,a,i,o)}finally{this.instance.free(i)}}),e})();t.SyeWasmPlayerControl=i}));e(bs);bs.SyeWasmPlayerControl;var Ps=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.tryGetNative=function(){return"undefined"==typeof Native?void 0:Native},t.tryGetVmManager=function(){return"undefined"==typeof VmManager?void 0:VmManager}}));e(Ps);Ps.tryGetNative,Ps.tryGetVmManager;var Ms=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("LiveLowLatencySDKUnf"),n=freeOnUnref(function(){function e(e,t,n,r,i){this.syeCallbacks=null,this.scpPollTimerId=null,this.wasmFailed=void 0,this.syeNativePlayerRef=e,this.playerId=t,this.syePlayerControl=r?new bs.SyeWasmPlayerControl(r,Ps.tryGetVmManager()):is.connector.syePlayerControlFactoryAPI.getSyePlayerAPI(),n&&this.syePlayerControl.useExternalBuffers(this.syeNativePlayerRef,!0),this.wasmFailed=i}return e.prototype.createSyeAudioStreamInfoFromAny=freeOnUnref(function(e){if(void 0===e.language)throw TypeError("createSyeAudioStreamInfoFromAny -> language undefined");if(void 0===e.languageDescription)throw TypeError("createSyeAudioStreamInfoFromAny -> languageDescription undefined");if(void 0===e.samplerate)throw TypeError("createSyeAudioStreamInfoFromAny -> samplerate undefined");if(void 0===e.numChannels)throw TypeError("createSyeAudioStreamInfoFromAny -> numChannels undefined");if(void 0===e.codec)throw TypeError("createSyeAudioStreamInfoFromAny -> codec undefined");return{language:e.language,languageDescription:e.languageDescription,samplerate:e.samplerate,numChannels:e.numChannels,codec:e.codec,codecProfile:e.codecProfile}}),e.prototype.createSyeVideoTrackFromVideoStreamInfo=freeOnUnref(function(e){if(void 0===e.width)throw TypeError("createSyeVideoTrackFromAny -> width undefined");if(void 0===e.height)throw TypeError("createSyeVideoTrackFromAny -> height undefined");if(void 0===e.bitrate)throw TypeError("createSyeVideoTrackFromAny -> bitrate undefined");if(void 0===e.codec)throw TypeError("createSyeVideoTrackFromAny -> codec undefined");var t=e.framerateNum,n=e.framerateDen,r=n<1?void 0:t/(1*n);return{trackId:0,width:e.width,height:e.height,bitrate:e.bitrate,framerate:r,tsStreamType:0,codec:e.codec,state:0,profileString:"",levelString:""}}),e.prototype.createSyeTimelineInfoFromAny=freeOnUnref(function(e){if(void 0===e.playbackType)throw TypeError("createSyeTimelineInfoFromAny -> playbackType undefined");if(isNaN(e.playbackType))throw TypeError("createSyeTimelineInfoFromAny -> playbackType not a number");if(e.playbackType<Ss.SyePlaybackType.kLive||e.playbackType>Ss.SyePlaybackType.kUtcTime)throw TypeError("createSyeTimelineInfoFromAny -> Invalid value for PlaybackType enumeration: "+e.playbackType);if(void 0===e.currentPosUtcMillis)throw TypeError("createSyeTimelineInfoFromAny -> currentPosUtcMillis undefined");if(isNaN(e.currentPosUtcMillis))throw TypeError("createSyeTimelineInfoFromAny -> currentPosUtcMillis not a number");if(void 0===e.livePosUtcMillis)throw TypeError("createSyeTimelineInfoFromAny -> livePosUtcMillis undefined");if(isNaN(e.livePosUtcMillis))throw TypeError("createSyeTimelineInfoFromAny -> livePosUtcMillis not a number");if(isNaN(e.thumbnailFillRate))throw TypeError("createSyeTimelineInfoFromAny -> thumbnailFillRate not a number");return{playbackType:e.playbackType,currentPosUtcMillis:e.currentPosUtcMillis,livePosUtcMillis:e.livePosUtcMillis,thumbnailFillRate:e.thumbnailFillRate}}),e.prototype.createSyeVideoStreamInfoFromAny=freeOnUnref(function(e){if(void 0===e.width)throw TypeError("createSyeVideoStreamInfoFromAny -> width undefined");if(void 0===e.height)throw TypeError("createSyeVideoStreamInfoFromAny -> height undefined");if(void 0===e.bitrate)throw TypeError("createSyeVideoStreamInfoFromAny -> bitrate undefined");if(void 0===e.codec)throw TypeError("createSyeVideoStreamInfoFromAny -> codec undefined");var t=e.framerateNum,n=e.framerateDen;return{width:e.width,height:e.height,bitrate:e.bitrate,framerateDen:n,framerateNum:t,codec:e.codec}}),e.prototype.createSyeAudioTrackFromAny=freeOnUnref(function(e){if(void 0===e.language)throw TypeError("createSyeAudioTrackFromAny -> language undefined");if(void 0===e.languageDescription)throw TypeError("createSyeAudioTrackFromAny -> languageDescription undefined");if(void 0===e.numChannels)throw TypeError("createSyeAudioTrackFromAny -> numChannels undefined");if(void 0===e.codec)throw TypeError("createSyeAudioTrackFromAny -> codec undefined");return{language:e.language,languageDescription:e.languageDescription,numChannels:e.numChannels,codec:e.codec,codecProfile:e.codecProfile}}),e.prototype.createSyeAudioTrackFromAudioStreamInfo=freeOnUnref(function(e){if(void 0===e.language)throw TypeError("createSyeAudioTrackFromAudioStreamInfo -> language undefined");if(void 0===e.languageDescription)throw TypeError("createSyeAudioTrackFromAudioStreamInfo -> languageDescription undefined");if(void 0===e.samplerate)throw TypeError("createSyeAudioTrackFromAudioStreamInfo -> samplerate undefined");if(void 0===e.numChannels)throw TypeError("createSyeAudioTrackFromAudioStreamInfo -> numChannels undefined");if(void 0===e.codec)throw TypeError("createSyeAudioTrackFromAudioStreamInfo -> codec undefined");return{language:e.language,languageDescription:e.languageDescription,numChannels:e.numChannels,codec:e.codec,codecProfile:e.codecProfile}}),e.prototype.StartCheckingForCallbacks=freeOnUnref(function(){var e=this;this.StopCheckingForCallbacks(),this.scpPollTimerId=oe.timer.setInterval(freeOnUnref(function(){e.CallbackPoll()}),20)}),e.prototype.StopCheckingForCallbacks=freeOnUnref(function(){null!==this.scpPollTimerId&&(oe.timer.clearInterval(this.scpPollTimerId),this.CallbackPoll(),this.scpPollTimerId=null)}),e.prototype.CallbackPoll=freeOnUnref(function(){var e=this.syePlayerControl.poll(this.syeNativePlayerRef);this.scpCallbackDispatch(e)}),e.prototype.scpCallbackDispatch=freeOnUnref(function(a){var s=this;if(null!==this.syeCallbacks)for(var e=freeOnUnref(function(e){switch(a[e].fn){case"onVideoSampleEvent":l.syeCallbacks.onVideoSample(a[e].arg);break;case"onAudioSampleEvent":l.syeCallbacks.onAudioSample(a[e].arg);break;case"onFrontendError":l.syeCallbacks.onFrontendError(Us.SCPPlayerErrorToSyePlayerError(a[e].arg.code),a[e].arg.info,a[e].arg.message);break;case"onError":l.syeCallbacks.onError(Us.SCPPlayerErrorToSyePlayerError(a[e].arg.code),a[e].arg.message);break;case"onStateChange":l.syeCallbacks.onStateChange(a[e].arg.from,a[e].arg.to);break;case"onFrontendSuccess":l.syeCallbacks.onFrontendSuccess(a[e].arg.info);break;case"onStreamingError":l.syeCallbacks.onStreamingError(Us.SCPPlayerErrorToSyePlayerError(a[e].arg.code),a[e].arg.message);break;case"onErrorRetry":l.syeCallbacks.onErrorRetry(Us.SCPPlayerErrorToSyePlayerError(a[e].arg.code),a[e].arg.message,a[e].arg.after);break;case"onEgressAllocated":l.syeCallbacks.onEgressAllocated(a[e].arg);break;case"onEgressContact":l.syeCallbacks.onEgressContact(a[e].arg);break;case"onTimeToFirstFrame":l.syeCallbacks.onTimeToFirstFrame(a[e].arg.egress,a[e].arg.total);break;case"onAvailableAudioTracks":var t=[];a[e].arg.forEach(freeOnUnref(function(e){t.push(s.createSyeAudioTrackFromAny(e))})),l.syeCallbacks.onAvailableAudioTracks(t);break;case"onAudioStreamChange":var n=l.createSyeAudioStreamInfoFromAny(a[e].arg.info);l.syeCallbacks.onAudioStreamChange(n);break;case"onVideoStreamChange":n=l.createSyeVideoStreamInfoFromAny(a[e].arg.info);l.syeCallbacks.onVideoStreamChange(n);break;case"onNotificationMessage":l.syeCallbacks.onNotificationMessage(a[e].arg.messageType,a[e].arg.localTimeMicros,a[e].arg.data);break;case"onAvailableClosedCaptionsChannels":var r=a[e].arg;if(!Array.isArray(r))throw TypeError("onAvailableClosedCaptionsChannels -> Not an Array.");var i=r;l.syeCallbacks.onAvailableClosedCaptionsChannels(i);break;case"onAvailableClosedCaptionsServices":r=a[e].arg;if(!Array.isArray(r))throw TypeError("onAvailableClosedCaptionsServices -> Not an Array.");i=r;l.syeCallbacks.onAvailableClosedCaptionsServices(i);break;case"onTimelineUpdate":try{var o=l.createSyeTimelineInfoFromAny(a[e].arg);l.syeCallbacks.onTimelineUpdate(o)}catch(e){f.warn("onTimelineUpdate: "+e)}break;case"onCEA708Event":l.syeCallbacks.onCEA708(a[e].arg.data)}}),l=this,t=0;t<a.length;t++)e(t)}),e.prototype.RegisterCallbacks=freeOnUnref(function(e){this.syeCallbacks=e,this.wasmFailed&&this.syeCallbacks.onStreamingError(Ss.SyePlayerError.kWasmSetupFailed,"Wasm was enabled but failed to initialize")}),e.prototype.Poll=freeOnUnref(function(){return this.syePlayerControl.poll_scp(this.syeNativePlayerRef)}),e.prototype.Update=freeOnUnref(function(e){this.syePlayerControl.updateSyeSystem(this.syeNativePlayerRef,e)}),e.prototype.PlayFromLive=freeOnUnref(function(e){this.syePlayerControl.playFromLive(this.syeNativePlayerRef,e)}),e.prototype.PlayWithOffset=freeOnUnref(function(e,t){this.syePlayerControl.playWithOffset(this.syeNativePlayerRef,e,t)}),e.prototype.PlayFromUtcTime=freeOnUnref(function(e,t){this.syePlayerControl.playFromUtcTime(this.syeNativePlayerRef,e,t)}),e.prototype.Stop=freeOnUnref(function(){this.syePlayerControl.stop(this.syeNativePlayerRef)}),e.prototype.Pause=freeOnUnref(function(){this.syePlayerControl.pause(this.syeNativePlayerRef)}),e.prototype.PlayResume=freeOnUnref(function(){this.syePlayerControl.playResume(this.syeNativePlayerRef)}),e.prototype.GetCurrentChannelId=freeOnUnref(function(){return this.syePlayerControl.getCurrentChannelId(this.syeNativePlayerRef)}),e.prototype.GetPlayerState=freeOnUnref(function(){return null===this.syeNativePlayerRef?Ss.SyePlayerState.kStopped:Us.NativePlayerStateStringToSyePlayerState(this.syePlayerControl.getPlayerState(this.syeNativePlayerRef))}),e.prototype.GetPresentationDelayMillis=freeOnUnref(function(){return this.syePlayerControl.getPresentationDelayMillis(this.syeNativePlayerRef)}),e.prototype.GetLocalConvertedToServerUtcMicros=freeOnUnref(function(e){return this.syePlayerControl.getUtcTimeMicros(this.syeNativePlayerRef,e)}),e.prototype.ReportError=freeOnUnref(function(e,t){this.syePlayerControl.reportError(this.syeNativePlayerRef,e,t)}),e.prototype.ReportWarning=freeOnUnref(function(e,t){this.syePlayerControl.reportWarning(this.syeNativePlayerRef,e,t)}),e.prototype.SetViewResolution=freeOnUnref(function(e,t){this.syePlayerControl.setViewResolution(this.syeNativePlayerRef,e,t)}),e.prototype.GetCurrentAudioTrack=freeOnUnref(function(){var e=this.GetAudioStreamInfo();if(void 0!==e)return this.createSyeAudioTrackFromAudioStreamInfo(e)}),e.prototype.GetAvailableAudioTracks=freeOnUnref(function(){return this.syePlayerControl.getAvailableAudioTracks(this.syeNativePlayerRef)}),e.prototype.GetAudioStreamInfo=freeOnUnref(function(){var e=this.syePlayerControl.getAudioStreamInfo(this.syeNativePlayerRef);if(0<Object.keys(e).length)return e}),e.prototype.SetAudioPreferences=freeOnUnref(function(e){var t=this.GetAudioPreferences();return t.channels===e.channels&&t.codec===e.codec&&t.language===e.language?(f.warn("[setAudioPreferences] Player: "+this.playerId+" Attempting to set already applied audio preferences. Ignoring this command."),!1):(this.CallbackPoll(),this.syePlayerControl.setAudioPreferences(this.syeNativePlayerRef,e),!0)}),e.prototype.GetAudioPreferences=freeOnUnref(function(){return this.syePlayerControl.getAudioPreferences(this.syeNativePlayerRef)}),e.prototype.SetAudioFocus=freeOnUnref(function(e){this.syePlayerControl.setAudioFocus(this.syeNativePlayerRef,e)}),e.prototype.GetCurrentVideoTrack=freeOnUnref(function(){var e=this.GetVideoStreamInfo();if(void 0!==e)return this.createSyeVideoTrackFromVideoStreamInfo(e)}),e.prototype.GetAvailableVideoTracks=freeOnUnref(function(){var e=this.GetCurrentVideoTrack();return void 0===e?[]:[e]}),e.prototype.GetVideoStreamInfo=freeOnUnref(function(){var e=this.syePlayerControl.getVideoStreamInfo(this.syeNativePlayerRef);if(0<Object.keys(e).length)return e}),e.prototype.SetVideoPreferences=freeOnUnref(function(e){var t=this.GetVideoPreferences();return t.maxBitrate===e.maxBitrate&&t.maxHeight===e.maxHeight?(f.warn("[setVideoPreferences] Player: "+this.playerId+" Attempting to set already applied video preferences. Ignoring this command."),!1):(this.syePlayerControl.setVideoPreferences(this.syeNativePlayerRef,e),!0)}),e.prototype.GetVideoPreferences=freeOnUnref(function(){return this.syePlayerControl.getVideoPreferences(this.syeNativePlayerRef)}),e.prototype.GetAvailableClosedCaptionsChannels=freeOnUnref(function(){return this.syePlayerControl.getAvailableClosedCaptionsChannels(this.syeNativePlayerRef)}),e.prototype.GetAvailableClosedCaptionsServices=freeOnUnref(function(){return this.syePlayerControl.getAvailableClosedCaptionsServices(this.syeNativePlayerRef)}),e.prototype.SelectClosedCaptionsType=freeOnUnref(function(e){this.syePlayerControl.selectClosedCaptionsType(this.syeNativePlayerRef,e)}),e.prototype.GetSelectedClosedCaptionsType=freeOnUnref(function(){return this.syePlayerControl.getSelectedClosedCaptionsType(this.syeNativePlayerRef)}),e.prototype.SelectClosedCaptionsChannel=freeOnUnref(function(e){if(e<0||3<e)throw RangeError("selectedClosedCaptionsChannel -> SyeChannelIndex must be in the range 0-3");this.syePlayerControl.selectClosedCaptionsChannel(this.syeNativePlayerRef,e)}),e.prototype.GetSelectedClosedCaptionsChannel=freeOnUnref(function(){return this.syePlayerControl.getSelectedClosedCaptionsChannel(this.syeNativePlayerRef)}),e.prototype.SelectClosedCaptionsService=freeOnUnref(function(e){if(e<0||6<e)throw RangeError("selectedClosedCaptionsService -> SyeServiceIndex must be in the range 0-6");this.syePlayerControl.selectClosedCaptionsService(this.syeNativePlayerRef,e)}),e.prototype.GetSelectedClosedCaptionsService=freeOnUnref(function(){return this.syePlayerControl.getSelectedClosedCaptionsService(this.syeNativePlayerRef)}),e.prototype.SetDTVCCSettings=freeOnUnref(function(e){this.syePlayerControl.setDTVCCSettings(this.syeNativePlayerRef,e)}),e.prototype.GetDTVCCSettings=freeOnUnref(function(){return this.syePlayerControl.getDTVCCSettings(this.syeNativePlayerRef)}),e.prototype.CacheThumbnailsFromLive=freeOnUnref(function(e){this.syePlayerControl.cacheThumbnailsFromLive(this.syeNativePlayerRef,e)}),e.prototype.CacheThumbnailsForInterval=freeOnUnref(function(e,t){this.syePlayerControl.cacheThumbnailsForInterval(this.syeNativePlayerRef,e,t)}),e.prototype.GetThumbnail=freeOnUnref(function(e){var t=this.syePlayerControl.getThumbnail(this.syeNativePlayerRef,e);if(null!==t){return t.data="mem://"+t.data,t}}),e.prototype.GetMetrics=freeOnUnref(function(){return this.syePlayerControl.getMetrics(this.syeNativePlayerRef)}),e.prototype.GetMetadata=freeOnUnref(function(){return this.syePlayerControl.getMetadata()}),e.prototype.Teardown=freeOnUnref(function(){this.syeNativePlayerRef=null}),e})();t.ScpPlayer=n}));e(Ms);Ms.ScpPlayer;var Cs=t(freeOnUnref(function(e,t){var r=ce&&ce.__assign||freeOnUnref(function(){return(r=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0}),t.createManagedPointer=function(e,t,n){return r({},e,{deleter:t.getOwnedBuffer(t.toModuleOffset(BigInt(e.pointer)),1,e.pointer,t.getFunction(n,"v(III)"))})}}));e(Cs);Cs.createManagedPointer;var Es=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("LiveLowLatencySDKUnf"),n=freeOnUnref(function(){function e(e,t){var i=this;this.instance=e,this.native=t,this.getThumbnailPreferences=freeOnUnref(function(){var e=i.instance.toModuleOffset(i.callSyeFunction("get_thumbnail_preferences"));try{return i.instance.readJSON(e)}finally{i.instance.free(e)}}),this.setThumbnailPreferences=freeOnUnref(function(e){var t=i.instance.writeJSON(e),n=t[0],r=t[1];try{i.callSyeFunction("set_thumbnail_preferences",n,r)}finally{i.instance.free(n)}}),l.info("ScpWasmApiControl initialized")}return e.prototype.callSyeFunction=freeOnUnref(function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(t=this.instance).callFunction.apply(t,["ignition_x_sye_"+e].concat(n))}),e.prototype.getSyeCorePlayerVersion=freeOnUnref(function(){var e=this.callSyeFunction("get_scp_version");try{return this.instance.readJSON(e)}finally{this.instance.free(e)}}),e.prototype.isFeatureSupported=freeOnUnref(function(e){switch(e){case"ExternalBuffers":case"PlaybackInitCallback":return!0;default:return!1}}),e.prototype.isSyeSupported=freeOnUnref(function(){return!0}),e.prototype.getContext=freeOnUnref(function(){var e=this.instance.toModuleOffset(this.callSyeFunction("create_context"));return Cs.createManagedPointer({_tag:"SyeNativeContext",pointer:e},this.instance,"ignition_x_sye_destroy_context")}),e.prototype.isMPBv2Supported=freeOnUnref(function(){return!1}),e.prototype.setVideoLimitations=freeOnUnref(function(e){var t=this.instance.writeJSON(e),n=t[0],r=t[1];this.callSyeFunction("set_video_limitations",n,r),this.instance.free(n)}),e.prototype.getLocalTimeMicros=freeOnUnref(function(){return this.native.Time_GetMonotonicTimestampUs()}),e.prototype.createPlayer=freeOnUnref(function(e,t,n){l.info("ScpWasmApiControl - createPlayer");var r=e,i=this.instance.writeString(JSON.stringify({syeSystem:t,config:n})),o=i[0],a=i[1];try{var s=this.instance.toModuleOffset(this.callSyeFunction("create_player",r.pointer,o,a));return Cs.createManagedPointer({_tag:"SyeNativePlayerRef",pointer:s},this.instance,"ignition_x_sye_destroy_player")}finally{this.instance.free(o)}}),e.prototype.setup=freeOnUnref(function(e){}),e.prototype.getAudioCapabilitiesAPI=freeOnUnref(function(){var i=this;return{setAudioCapabilities:freeOnUnref(function(e){var t=i.instance.writeJSON(e),n=t[0],r=t[1];i.callSyeFunction("set_audio_capabilities",n,r),i.instance.free(n)}),getAudioCapabilities:freeOnUnref(function(){var e=i.instance.toModuleOffset(i.callSyeFunction("get_audio_capabilities"));try{return i.instance.readJSON(e)}finally{i.instance.free(e)}}),constants:{SYE_AUDIO_CODEC_UNDEFINED:0,SYE_AUDIO_CODEC_AAC:1,SYE_AUDIO_CODEC_EC3:2}}}),e.prototype.getVideoCapabilitiesAPI=freeOnUnref(function(){var i=this;return{setVideoCapabilities:freeOnUnref(function(e){var t=i.instance.writeJSON(e),n=t[0],r=t[1];i.callSyeFunction("set_video_capabilities",n,r),i.instance.free(n)}),getVideoCapabilities:freeOnUnref(function(){var e=i.instance.toModuleOffset(i.callSyeFunction("get_video_capabilities"));try{return i.instance.readJSON(e)}finally{i.instance.free(e)}}),constants:{SYE_VIDEO_CODEC_UNDEFINED:0,SYE_VIDEO_CODEC_AVC:1,SYE_VIDEO_CODEC_HEVC:2,SYE_VIDEO_CODEC_PROFILE_UNDEFINED:0,SYE_VIDEO_CODEC_PROFILE_AVC_CONSTRAINED_BASELINE:11100,SYE_VIDEO_CODEC_PROFILE_AVC_BASELINE:11500,SYE_VIDEO_CODEC_PROFILE_AVC_MAIN:12500,SYE_VIDEO_CODEC_PROFILE_AVC_EXTENDED:13500,SYE_VIDEO_CODEC_PROFILE_AVC_CONSTRAINED_HIGH:14100,SYE_VIDEO_CODEC_PROFILE_AVC_HIGH:14500,SYE_VIDEO_CODEC_PROFILE_AVC_HIGH_10:14510,SYE_VIDEO_CODEC_PROFILE_AVC_HIGH_422:14520,SYE_VIDEO_CODEC_PROFILE_AVC_HIGH_444:14540,SYE_VIDEO_CODEC_PROFILE_HEVC_MAIN:22500,SYE_VIDEO_CODEC_PROFILE_HEVC_MAIN_10:22510,SYE_VIDEO_CODEC_PROFILE_HEVC_MAIN_10_HDR_10:22520,SYE_VIDEO_CODEC_PROFILE_HEVC_MAIN_10_HDR_10_PLUS:22530,SYE_VIDEO_CODEC_LEVEL_UNDEFINED:0,SYE_VIDEO_CODEC_LEVEL_AVC_1:11e3,SYE_VIDEO_CODEC_LEVEL_AVC_1B:11050,SYE_VIDEO_CODEC_LEVEL_AVC_11:11100,SYE_VIDEO_CODEC_LEVEL_AVC_12:11200,SYE_VIDEO_CODEC_LEVEL_AVC_13:11300,SYE_VIDEO_CODEC_LEVEL_AVC_2:12e3,SYE_VIDEO_CODEC_LEVEL_AVC_21:12100,SYE_VIDEO_CODEC_LEVEL_AVC_22:12200,SYE_VIDEO_CODEC_LEVEL_AVC_3:13e3,SYE_VIDEO_CODEC_LEVEL_AVC_31:13100,SYE_VIDEO_CODEC_LEVEL_AVC_32:13200,SYE_VIDEO_CODEC_LEVEL_AVC_4:14e3,SYE_VIDEO_CODEC_LEVEL_AVC_41:14100,SYE_VIDEO_CODEC_LEVEL_AVC_42:14200,SYE_VIDEO_CODEC_LEVEL_AVC_5:15e3,SYE_VIDEO_CODEC_LEVEL_AVC_51:15100,SYE_VIDEO_CODEC_LEVEL_AVC_52:15200,SYE_VIDEO_CODEC_LEVEL_AVC_6:16e3,SYE_VIDEO_CODEC_LEVEL_AVC_61:16100,SYE_VIDEO_CODEC_LEVEL_AVC_62:16200,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_1:21e3,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_1:21050,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_2:22e3,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_2:22050,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_21:22100,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_21:22150,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_3:23e3,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_3:23050,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_31:23100,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_31:23150,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_4:24e3,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_4:24050,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_41:24100,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_41:24150,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_5:25e3,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_5:25050,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_51:25100,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_51:25150,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_52:25200,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_52:25250,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_6:26e3,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_6:26050,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_61:26100,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_61:26150,SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_62:26200,SYE_VIDEO_CODEC_LEVEL_HEVC_HIGH_TIER_62:26250}}}),e})();t.SyeWasmAPIControl=n}));e(Es);Es.SyeWasmAPIControl;var Ts=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a={wasm_bundle:{name:"SyeWasmBundle-1.0",suffix:"/SyeWasmBundle"},native_module:{name:"SyeCorePlayerNativeModule-1.0",suffix:""}};t.buildUrl=function(e,t,n,r){var i=e?a.native_module:a.wasm_bundle,o=t?"gamma":"prod";return"https://cloudfront.xp-assets.aiv-cdn.net/packages/{package}/{env}{suffix}/{platform}/{moduleName}".replace("{package}",i.name).replace("{env}",o).replace("{suffix}",i.suffix).replace("{platform}",n).replace("{moduleName}",r)}}));e(Ts);Ts.buildUrl;var ws=t(freeOnUnref(function(e,t){var m=ce&&ce.__assign||freeOnUnref(function(){return(m=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var y=freeOnUnref(function(){function e(e){this.nativeAPI=e}return e.prototype.info=freeOnUnref(function(e){this.nativeAPI.LogMessage(this.nativeAPI.E_LogLevel_Info,e)}),e})();function g(e,t){return null!==t&&null!==t.configuration&&!0===t.configuration[e]}t.loadWasmConfig=function(e,t,n){var r,i,o,a,s,l,f=new y(e),u=function(e,r){var i={};try{var o=JSON.parse(e.GetClientConfig()),t=freeOnUnref(function(e,t){if(e in o){var n=o[e];r.info("Overriding "+t+' with: "'+n+'"'),i[t]=n}});return t("sye-use-module","isWasmEnabled"),t("sye-vm-type","engineType"),t("sye-module-url","wasmUrl"),i}catch(e){return r.info("Failed to parse client config for wasm config overrides: "+e),null}}(e,f),c=g("useSyeNativeModuleArtifact",n),d=g("useGammaRelease",n);if("Ignite"===(l=t).ScriptEngineType_Ignite&&"function"==typeof l.IsScriptEngineTypeSupported&&l.IsScriptEngineTypeSupported("Ignite")&&g("syeIgniteNativeModule",n)){var p=function(e,t){if("function"!=typeof e.GetVmVersionString)return null;var n=e.GetVmVersionString(t);return n||"0.0.0"}(t,r="Ignite"),h=function(e){if("function"!=typeof e.GetWasmBuildTarget)return null;var t=e.GetWasmBuildTarget();return t?t.toLowerCase():null}(e);i=null!==p&&null!==h,o="sye-"+h+"-"+p+".so",a=Ts.buildUrl(c,d,"ignite",o),f.info("EngineType: "+r+", version: "+p+", architecture: "+h)}else r="DefaultNative",i="Native"===(s=t).ScriptEngineType_Native&&"function"==typeof s.IsScriptEngineTypeSupported&&s.IsScriptEngineTypeSupported("Native")&&g("prioritizeWasm",n),o="sye.so",a=Ts.buildUrl(c,d,e.GetDeviceTypeId(),o);return m({isWasmEnabled:i,wasmUrl:a,engineType:r,moduleName:o},u)}}));e(ws);ws.loadWasmConfig;var Is=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("LiveLowLatencySDKUnf"),s=null,n=freeOnUnref(function(){function e(){this.syeAPIControl=null,this.nativeContext=null,this.playerCount=0,this.supportsEC3=!1,this.supportsIntraChunkSeeking=!1,this.supportsHDR10=!1,this.supportsHDR10plus=!1,this.supportsHEVC=!1,this.supportsHEVC720p=!1,this.supportsHEVC10Bits=!1,this.supportsUHD=!1,this.enableCoarseGrainEC3=!0,this.forceCoarseGrainEC3=!0,this.forceDisableEC3=!1,this.audioSampleDequeueMarginMillis=1500,this.videoSampleDequeueMarginMillis=1500,this.deviceCapabilitiesFixEnabled=!1,this.limitMaxHeight=!1,this.useWasm=void 0,this.instance=void 0,this.mpbVersion=2,this.wasmConfig=ws.loadWasmConfig(Ps.tryGetNative(),Ps.tryGetVmManager(),re.connector.clientWeblabConfig),this.wasmConfig.isWasmEnabled?(this.useWasm=!0,this.wasmPromise=this.loadWasmModule(this.wasmConfig.wasmUrl)):(this.useWasm=!1,this.wasmPromise=lt.Promise.resolve())}return e.prototype.getSyeAPI=freeOnUnref(function(){return null===this.syeAPIControl&&(this.useWasm&&this.instance?(a.info("Using WASM"),this.syeAPIControl=new Es.SyeWasmAPIControl(this.instance,Ps.tryGetNative())):(a.info("useWasm: "+this.useWasm+", Wasm Instance exists: "+(void 0!==this.instance)+", using native API"),this.syeAPIControl=is.connector.syeAPIControlFactoryAPI.getSyeAPI())),this.syeAPIControl}),e.prototype.loadWasmModule=freeOnUnref(function(e){var o=this;return new lt.Promise(freeOnUnref(function(r,i){un.HttpRequest.get(e).timeout(1e4).responseType("arraybuffer").onLoad(freeOnUnref(function(e){try{var t=e.getArrayBuffer(),n=Qa.WasmModuleInstance.createModuleInstanceFromByteArray(t,o.wasmConfig.engineType,Ps.tryGetVmManager(),Ps.tryGetNative(),o.wasmConfig.moduleName);null!=n?(a.info("WASM module loaded successfully"),r(n)):i(new Error("Module creation returned undefined or null"))}catch(e){i(e)}})).onError(freeOnUnref(function(e,t){i(e)})).send()})).catch(freeOnUnref(function(e){a.error("Failed to load WASM module: "+e)}))}),e.prototype.getSyeNativeContext=freeOnUnref(function(){return null===this.nativeContext&&(this.nativeContext=this.getSyeAPI().getContext()),this.nativeContext}),e.prototype.isSyeWasmSupported=freeOnUnref(function(){var e=Ps.tryGetNative().IsFeatureSupported;return void 0!==e&&e("IgnitionX_Supports_SYE_Module")&&T.isMMLSupported?(a.info("Sye WASM is supported"),!0):(a.info("Sye WASM not supported"),!1)}),e.prototype.CreatePlayer=freeOnUnref(function(e,t,n){var r,i=this.getSyeAPI().createPlayer(this.getSyeNativeContext(),e,t);return r=this.useWasm&&this.instance&&n?new Ms.ScpPlayer(i,this.playerCount.toString(),n,this.instance,!1):new Ms.ScpPlayer(i,this.playerCount.toString(),n,void 0,this.useWasm&&!this.instance),this.playerCount++,r}),e.prototype.IsSyeSupported=freeOnUnref(function(e){return this.isSyeWasmSupported()&&!0===this.useWasm?(a.info("Sye WASM is prioritized"),!0):(a.info("Sye WASM is not prioritized"),this.useWasm=!1,this.getSyeAPI().isSyeSupported(e))}),e.prototype.GetLocalTimeMicros=freeOnUnref(function(){return this.getSyeAPI().getLocalTimeMicros()}),e.prototype.SupportsFeature=freeOnUnref(function(e){switch(e){case"ExternalBuffers":return this.IsExternalBuffersSupported();case"PlaybackInitCallback":return this.IsPlaybackInitCallbackSupported();case"SetAudioFocus":return this.IsSetAudioFocusSupported();case"SetViewResolution":return this.IsSetViewResolutionSupported()}return!1}),e.prototype.SetVideoLimitations=freeOnUnref(function(e){zt.deviceCapabilities.output.video.applicationViewport.height<1080&&this.limitMaxHeight&&0===e.maxHeight&&(e.maxHeight=zt.deviceCapabilities.output.video.applicationViewport.height),this.getSyeAPI().setVideoLimitations(e)}),e.prototype.Setup=freeOnUnref(function(n){var r=this;return this.wasmPromise.then(freeOnUnref(function(e){void 0!==e&&r.useWasm&&(r.instance=e),r.initializeSyeApiConfig(n),r.getSyeAPI().setup({runtimeMode:"JS"}),r.setThumbnailPreferences(n);var t=lt.Promise.resolve();return void 0===zt.deviceCapabilities.output&&(t=t.then(freeOnUnref(function(){return r.initDeviceCapabilitiesAsync()})).catch(freeOnUnref(function(e){a.error("Failed to initialize device capabilities: "+e)}))),t.then(freeOnUnref(function(){r.initializeSyeDeviceCapabilities()})).then(freeOnUnref(function(){return r.deviceCapabilitiesFixEnabled?lt.Promise.all([r.checkIntraChunkSeekingSupport(),r.checkHEVCSupport(),r.checkHEVC720pSupport(),r.checkHEVC10BitsSupport(),r.checkUHDSupport(),r.checkHDR10Support(),r.checkHDR10PlusSupport(),r.setAudioCapabilities()]):lt.Promise.all([r.checkIntraChunkSeekingSupport(),r.checkHEVCSupport(),r.checkHEVC10BitsSupport(),r.checkUHDSupport(),r.checkHDR10Support(),r.checkHDR10PlusSupport(),r.setAudioCapabilities()])})).then(freeOnUnref(function(){return lt.Promise.all([r.setVideoCapabilities()])})).then(freeOnUnref(function(){a.info("Setup complete")})).catch(freeOnUnref(function(e){throw a.error("Error in Setup: "+e),e}))}))}),e.prototype.SupportsCapability=freeOnUnref(function(e){switch(e){case"EC3":return this.supportsEC3;case"IntraChunkSeeking":return this.supportsIntraChunkSeeking;case"HDR10":return this.supportsHDR10;case"HDR10Plus":return this.supportsHDR10plus;case"HEVC":return this.supportsHEVC;case"HEVC10Bit":return this.supportsHEVC10Bits;case"UHD":return this.supportsUHD}return!1}),e.prototype.GetThumbnailPreferences=freeOnUnref(function(){var e=this.getSyeAPI();return void 0===e.setThumbnailPreferences||void 0===e.getThumbnailPreferences?{maxMemoryMB:0,numChannelsCached:0,width:0}:e.getThumbnailPreferences()}),e.prototype.initializeSyeApiConfig=freeOnUnref(function(e){var t=JSON.stringify(e);if(void 0!==t){var n=JSON.parse(t);void 0!==n.limitMaxHeight&&(this.limitMaxHeight=n.limitMaxHeight),void 0!==n.enableCoarseGrainEC3&&(this.enableCoarseGrainEC3=n.enableCoarseGrainEC3),void 0!==n.forceCoarseGrainEC3&&(this.forceCoarseGrainEC3=n.forceCoarseGrainEC3),void 0!==n.forceDisableEC3&&(this.forceDisableEC3=n.forceDisableEC3),void 0!==n.audioSampleDequeueMarginMillis&&(this.audioSampleDequeueMarginMillis=n.audioSampleDequeueMarginMillis),void 0!==n.videoSampleDequeueMarginMillis&&(this.videoSampleDequeueMarginMillis=n.videoSampleDequeueMarginMillis),void 0!==n.deviceCapabilitiesFixEnabled&&(this.deviceCapabilitiesFixEnabled=n.deviceCapabilitiesFixEnabled),void 0!==n.mpbVersion&&(this.mpbVersion=n.mpbVersion)}}),e.prototype.initializeSyeDeviceCapabilities=freeOnUnref(function(){var t=this;return new lt.Promise(freeOnUnref(function(e){s=Ja.createDeviceCapabilities(t.mpbVersion,t.IsMPBv2Supported(),T.isMMLSupported,t.IsExternalBuffersSupported(),re.connector),e()}))}),e.prototype.initDeviceCapabilitiesAsync=freeOnUnref(function(){return new lt.Promise(freeOnUnref(function(t,n){zt.initDeviceCapabilities({},freeOnUnref(function(e){void 0!==e&&n(e),t()}))}))}),e.prototype.SetThumbnailPreferences=freeOnUnref(function(e){var t=this.getSyeAPI();void 0!==t.setThumbnailPreferences&&void 0!==t.getThumbnailPreferences&&t.setThumbnailPreferences(e)}),e.prototype.checkIntraChunkSeekingSupport=freeOnUnref(function(){var t=this;return null!==s?s.supportsIntraChunkSeeking().then(freeOnUnref(function(e){t.supportsIntraChunkSeeking=e})):new lt.Promise(freeOnUnref(function(e){a.error("failed to read device capabilities"),e()}))}),e.prototype.checkHEVC10BitsSupport=freeOnUnref(function(){var t=this;return null!==s?s.supportsHEVC10Bits().then(freeOnUnref(function(e){t.supportsHEVC10Bits=e})):new lt.Promise(freeOnUnref(function(e){a.error("failed to read device capabilities"),e()}))}),e.prototype.checkHEVCSupport=freeOnUnref(function(){var t=this;return null!==s?s.supportsHEVC().then(freeOnUnref(function(e){t.supportsHEVC=e})):new lt.Promise(freeOnUnref(function(e){a.error("failed to read device capabilities"),e()}))}),e.prototype.checkHEVC720pSupport=freeOnUnref(function(){var t=this;return null!==s?s.supportsHEVC720p().then(freeOnUnref(function(e){t.supportsHEVC720p=e})):new lt.Promise(freeOnUnref(function(e){a.error("failed to read device capabilities"),e()}))}),e.prototype.checkUHDSupport=freeOnUnref(function(){var t=this;return null!==s?s.supportsUHD().then(freeOnUnref(function(e){t.supportsUHD=e})):new lt.Promise(freeOnUnref(function(e){a.error("failed to read device capabilities"),e()}))}),e.prototype.checkHDR10Support=freeOnUnref(function(){var t=this;return null!==s?s.supportsHDR10().then(freeOnUnref(function(e){t.supportsHDR10=e})):new lt.Promise(freeOnUnref(function(e){a.error("failed to read device capabilities"),e()}))}),e.prototype.checkHDR10PlusSupport=freeOnUnref(function(){var t=this;return null!==s?s.supportsHDR10Plus().then(freeOnUnref(function(e){t.supportsHDR10plus=e})):new lt.Promise(freeOnUnref(function(e){a.error("failed to read device capabilities"),e()}))}),e.prototype.setAudioCapabilities=freeOnUnref(function(){var t=this,n=this.getSyeAPI().getAudioCapabilitiesAPI();if(void 0===n)return a.info("Audio capabilities API not available, using default capabilities"),lt.Promise.resolve();var r={audioPathDelayMs:0,maxChannels:2,codecs:[{codec:n.constants.SYE_AUDIO_CODEC_AAC}],supportsFastSwitch:void 0!==this.audioSampleDequeueMarginMillis};return null!==s?s.supportsEC3(this.enableCoarseGrainEC3||this.forceCoarseGrainEC3).then(freeOnUnref(function(e){t.supportsEC3=e&&!t.forceDisableEC3,t.supportsEC3&&(r.maxChannels=6,r.codecs.push({codec:n.constants.SYE_AUDIO_CODEC_EC3})),a.info("SetAudioCapabilities: "+JSON.stringify(r)),n.setAudioCapabilities(r)})):new lt.Promise(freeOnUnref(function(e){a.error("failed to read device capabilities"),e()}))}),e.prototype.setVideoCapabilities=freeOnUnref(function(){var r=this,i=this.getSyeAPI().getVideoCapabilitiesAPI();if(void 0===i)return a.info("Video capabilities API not available, using default capabilities"),lt.Promise.resolve();var e=i.constants.SYE_VIDEO_CODEC_LEVEL_UNDEFINED;zt.deviceCapabilities.output.video.applicationViewport.height<1080&&!this.limitMaxHeight?e=i.constants.SYE_VIDEO_CODEC_LEVEL_AVC_32:(e=i.constants.SYE_VIDEO_CODEC_LEVEL_AVC_42,zt.deviceCapabilities.output.video.applicationViewport.height<1080&&this.limitMaxHeight&&this.SetVideoLimitations({maxBitrate:0,maxHeight:zt.deviceCapabilities.output.video.applicationViewport.height}));var o={videoPathDelayMs:0,codecs:[{codec:i.constants.SYE_VIDEO_CODEC_AVC,profile:i.constants.SYE_VIDEO_CODEC_PROFILE_AVC_HIGH,level:e}]};return null!==s?s.supportsHEVC().then(freeOnUnref(function(e){if(r.deviceCapabilitiesFixEnabled&&r.supportsHEVC720p&&(e=!0),e){var t=r.supportsUHD?i.constants.SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_51:i.constants.SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_41;zt.deviceCapabilities.output.video.applicationViewport.height<1080&&!r.limitMaxHeight?t=i.constants.SYE_VIDEO_CODEC_LEVEL_HEVC_MAIN_TIER_31:zt.deviceCapabilities.output.video.applicationViewport.height<1080&&r.limitMaxHeight&&r.SetVideoLimitations({maxBitrate:0,maxHeight:zt.deviceCapabilities.output.video.applicationViewport.height});var n=i.constants.SYE_VIDEO_CODEC_PROFILE_HEVC_MAIN;r.supportsHEVC10Bits&&(n=i.constants.SYE_VIDEO_CODEC_PROFILE_HEVC_MAIN_10,r.supportsHDR10plus?n=i.constants.SYE_VIDEO_CODEC_PROFILE_HEVC_MAIN_10_HDR_10_PLUS:r.supportsHDR10&&(n=i.constants.SYE_VIDEO_CODEC_PROFILE_HEVC_MAIN_10_HDR_10)),o.codecs.push({codec:i.constants.SYE_VIDEO_CODEC_HEVC,profile:n,level:t})}a.info("SetVideoCapabilities: "+JSON.stringify(o)),i.setVideoCapabilities(o)})):new lt.Promise(freeOnUnref(function(e){e()}))}),e.prototype.setThumbnailPreferences=freeOnUnref(function(e){var t=this.GetThumbnailPreferences();t.numChannelsCached=1;var n=e.thumbnailPreferences;if(void 0!==n){var r="number"==typeof n.maxMemoryMB,i="number"==typeof n.numChannelsCached,o="number"==typeof n.width;r&&(t.maxMemoryMB=n.maxMemoryMB),i&&(t.numChannelsCached=n.numChannelsCached),o&&(t.width=n.width),r||i||o||a.warn("Sye thumbnail preferences are empty or malformed")}this.SetThumbnailPreferences(t)}),e.prototype.IsPlaybackInitCallbackSupported=freeOnUnref(function(){return this.getSyeAPI().isFeatureSupported("PlaybackInitCallback")}),e.prototype.IsMPBv2Supported=freeOnUnref(function(){return this.getSyeAPI().isMPBv2Supported()}),e.prototype.IsExternalBuffersSupported=freeOnUnref(function(){return this.getSyeAPI().isFeatureSupported("ExternalBuffers")}),e.prototype.IsSetAudioFocusSupported=freeOnUnref(function(){return this.getSyeAPI().isFeatureSupported("SetAudioFocus")}),e.prototype.IsSetViewResolutionSupported=freeOnUnref(function(){return this.getSyeAPI().isFeatureSupported("SetViewResolution")}),e})();t.ScpApi=n}));e(Is);Is.ScpApi;var ks=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ScpPlayer=Ms.ScpPlayer;var n=new Is.ScpApi;t.scpApi=n}));e(ks);ks.ScpPlayer,ks.scpApi;var _s=t(freeOnUnref(function(e,t){var r,n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.InitialJumpTooLarge=5e4]="InitialJumpTooLarge",e[e.MovingTooFast=50001]="MovingTooFast",e[e.MovingBackwards=50002]="MovingBackwards",e[e.JumpTooLarge=50003]="JumpTooLarge"})(r=t.ClockErrorCode||(t.ClockErrorCode={}));var i,o={speedThreshold:5,warningThreshold:10,resetIntervalNanos:1e10,maxJumpNanos:15e8,initialMovementToleranceNanos:15e8,stopToleranceNanos:1e8};freeOnUnref(function(e){e.Stopped="Stopped",e.Seeked="Seeked",e.Playing="Playing",e.StopInitiated="StopInitiated"})(i||(i={}));var a=freeOnUnref(function(){function e(e,t){void 0===e&&(e={}),this.previousPlaybackClock=0,this.previousWallClock=0,this.playbackClockBeforeStop=0,this.invalidMovements={count:0,startTime:null,clockPairs:[]},this.state=i.Stopped,this.config=n({},o,e),this.onError=t}return e.prototype.initiateStop=freeOnUnref(function(){this.state=i.StopInitiated}),e.prototype.handlePlaybackStop=freeOnUnref(function(e){this.playbackClockBeforeStop=e,this.resetInvalidMovements(),this.state=i.Stopped}),e.prototype.teardown=freeOnUnref(function(){this.playbackClockBeforeStop=0,this.previousPlaybackClock=0,this.previousWallClock=0,this.resetInvalidMovements(),this.state=i.Stopped}),e.prototype.monitorPlaybackClockMovements=freeOnUnref(function(e){var t=this.getCurrentTimeNanos();if(this.state===i.Stopped){var n=Math.abs(e-this.playbackClockBeforeStop);if(n<=this.config.stopToleranceNanos)return void(0<n&&(this.playbackClockBeforeStop=e));0!==e&&e!==this.playbackClockBeforeStop&&(this.state=i.Seeked)}else this.state===i.Seeked?e!==this.previousPlaybackClock&&(this.validateInitialMovement(e),this.state=i.Playing):this.state===i.Playing&&(this.monitorPlaybackClockSpeed(e,t),this.validateClockDirection(e),this.validateJumpSize(e));this.previousWallClock=t,this.previousPlaybackClock=e}),e.prototype.roundToNearestThreshold=freeOnUnref(function(e,t){return Math.round(e/t)*t}),e.prototype.roundUpToNextSecond=freeOnUnref(function(e){var t=e<0,n=1e9*Math.ceil(Math.abs(e)/1e9);return t?-n:n}),e.prototype.validateInitialMovement=freeOnUnref(function(e){var t=e-this.previousPlaybackClock;if(Math.abs(t)>this.config.initialMovementToleranceNanos){var n=this.roundToNearestThreshold(t,this.config.initialMovementToleranceNanos);this.onError({code:r.InitialJumpTooLarge,message:"Initial jump too large: "+n/1e6+"ms"})}}),e.prototype.validateClockDirection=freeOnUnref(function(e){if(e<this.previousPlaybackClock){var t=e-this.previousPlaybackClock,n=this.roundUpToNextSecond(t);this.onError({code:r.MovingBackwards,message:"Clock moving backwards: "+n/1e6+"ms"})}}),e.prototype.validateJumpSize=freeOnUnref(function(e){var t=e-this.previousPlaybackClock;if(Math.abs(t)>this.config.maxJumpNanos){var n=this.roundToNearestThreshold(t,this.config.maxJumpNanos);this.onError({code:r.JumpTooLarge,message:"Clock jump too large: "+n/1e6+"ms"})}}),e.prototype.monitorPlaybackClockSpeed=freeOnUnref(function(e,t){if(!(e<=this.previousPlaybackClock)){var n=this.calculateSpeedRatio(e,t);this.isSpeedTooFast(n)&&this.handleInvalidMovement(e,t,n),this.shouldResetCounts(t)&&this.resetInvalidMovements()}}),e.prototype.getCurrentTimeNanos=freeOnUnref(function(){return 1e6*Date.now()}),e.prototype.calculateSpeedRatio=freeOnUnref(function(e,t){return(e-this.previousPlaybackClock)/(t-this.previousWallClock)}),e.prototype.isSpeedTooFast=freeOnUnref(function(e){return e>this.config.speedThreshold}),e.prototype.handleInvalidMovement=freeOnUnref(function(e,t,n){this.invalidMovements.count++,this.invalidMovements.startTime||(this.invalidMovements.startTime=t),this.invalidMovements.clockPairs.push({previous:{playbackTime:this.previousPlaybackClock,wallClock:this.previousWallClock},current:{playbackTime:e,wallClock:t},ratio:n}),this.invalidMovements.count===this.config.warningThreshold&&this.logInvalidMovements()}),e.prototype.logInvalidMovements=freeOnUnref(function(){var e=Math.round(this.invalidMovements.clockPairs.reduce(freeOnUnref(function(e,t){return e+t.ratio}),0)/this.invalidMovements.clockPairs.length);this.onError({code:r.MovingTooFast,message:"Clock moving too fast: average ratio "+e})}),e.prototype.shouldResetCounts=freeOnUnref(function(e){return null!==this.invalidMovements.startTime&&e>this.invalidMovements.startTime+this.config.resetIntervalNanos}),e.prototype.resetInvalidMovements=freeOnUnref(function(){this.invalidMovements={count:0,startTime:null,clockPairs:[]}}),e})();t.ClockMonitor=a}));e(_s);_s.ClockErrorCode,_s.ClockMonitor;var Rs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.surfaceRefContainsValidViewport=function(e){return null!=(t=e)&&"object"==typeof t&&_t.isViewportValid(e.viewport);var t},t.isFullScreenPlayback=function(e){if(!_t.isViewportValid(e))return!0;var t=Qe.nestedValue(zt.deviceCapabilities,"output.video.display.width",-1),n=Qe.nestedValue(zt.deviceCapabilities,"output.video.display.height",-1),r=e.x,i=e.y,o=e.width,a=e.height;return 0===r&&0===i&&a===n&&o===t}}));e(Rs);Rs.surfaceRefContainsValidViewport,Rs.isFullScreenPlayback;var As=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u;freeOnUnref(function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.INITIALIZED=1]="INITIALIZED",e[e.PLAYING=2]="PLAYING"})(u=t.MpbState||(t.MpbState={}));var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l){var f=this;this.mpbCallbacks=null,this.syeMpbControl=is.connector.syeMpbControlFactoryAPI.getSyeMpbAPI(),this.mpbPollTimerId=null,this.previousWallClock=0,this.previousPlaybackClock=0,this.waitingForPlaybackStartedCb=!1,this.mpbState=u.UNINITIALIZED,this.startPlaybackTimer=null,this.initPlaybackTimer=null,this.enableCheckPlaybackInitCallback=!1,this.resizeAfterStop=!1,this.resizeFnc=freeOnUnref(function(e){var r=e.x,i=e.y,o=e.width,a=e.height;return f.log.info("Calling setSyeVideoOutputPosition for dynamic resize with viewport: "+JSON.stringify({x:r,y:i,width:o,height:a})),new lt.Promise(freeOnUnref(function(t,n){var e=freeOnUnref(function(e){0===e?(q.metrics.putMetric("Resize.Success.Sye"),f.log.info("Dynamic Player viewport resize succeeded on SYE MPB"),t("surface.resize.success")):(q.metrics.putMetric("Resize.Fail.Sye.PlatformError"),f.log.error("Dynamic player viewport resize failed on SYE MPB due to an error: "+e),n("surface.resize.platform"))});re.connector.mpbFactoryAPI.getMPBCommandAPI().setSyeVideoOutputPosition(r,i,o,a,e)}))}),this.log=e.get("MpbPlayerV2IgnitionX"),this.readyToPlayTimeoutNano=t,this.initTimeoutNano=n,this.enableCheckPlaybackInitCallback=r,this.resizeAfterStop=i,o&&(this.clockMonitor=new _s.ClockMonitor(l||{},freeOnUnref(function(e){f.mpbCallbacks&&f.mpbCallbacks.onError("ClockMonitor",e.message,js.ErrorSeverity.NonFatal,e.code)})))}return e.prototype.Teardown=freeOnUnref(function(){this.clockMonitor&&this.clockMonitor.teardown()}),e.prototype.StartPolling=freeOnUnref(function(){var t=this;this.StopPolling(),this.mpbPollTimerId=oe.timer.setInterval(freeOnUnref(function(){t.CallbackPoll();var e=t.GetPlaybackTime();t.clockMonitor&&t.clockMonitor.monitorPlaybackClockMovements(e),e>t.previousPlaybackClock&&0!==t.previousPlaybackClock&&t.mpbState!==u.PLAYING&&!0===t.waitingForPlaybackStartedCb&&null!==t.mpbCallbacks&&(t.mpbState=u.PLAYING,t.waitingForPlaybackStartedCb=!1,t.mpbCallbacks.onPlaybackStarted()),t.previousPlaybackClock=e}),20)}),e.prototype.StopPolling=freeOnUnref(function(){null!==this.mpbPollTimerId&&(oe.timer.clearInterval(this.mpbPollTimerId),this.CallbackPoll(),this.mpbPollTimerId=null)}),e.prototype.CallbackPoll=freeOnUnref(function(){var e=this.syeMpbControl.poll();this.mpbCallbackDispatch(e)}),e.prototype.IsResizingSupported=freeOnUnref(function(){return re.connector.mpbFactoryAPI.getMPBCommandAPI().isResizingSupported()}),e.prototype.setVideoOutputPosition=freeOnUnref(function(){var t=this;if(this.IsResizingSupported()){var n=_t.surfaceRefManager.getSurfaceRef();if(Rs.surfaceRefContainsValidViewport(n)){var e=n.viewport;this.log.info("Calling setSyeVideoOutputPosition for static resize with viewport: "+JSON.stringify(e));var r=e.x,i=e.y,o=e.width,a=e.height;re.connector.mpbFactoryAPI.getMPBCommandAPI().setSyeVideoOutputPosition(r,i,o,a,freeOnUnref(function(e){0!==e&&null!==t.mpbCallbacks&&t.mpbCallbacks.onError("SetVideoOutputPosition","Failed to set video output position with viewport "+JSON.stringify(n)+" for SYE MPB",js.ErrorSeverity.Fatal,e)}))}else this.log.warn("Cannot resize as no valid surface ref found in surfaceRefManager "+JSON.stringify(n))}else this.log.warn("Resizing viewport not supported in this device")}),e.prototype.mpbCallbackDispatch=freeOnUnref(function(e){if(null!==this.mpbCallbacks)for(var t=0;t<e.length;t++){var n=e[t];switch(this.log.info("Sye emitting event type "+n.fn),n.fn){case"onErrorEvent":void 0!==n.arg?this.mpbCallbacks.onError(n.arg.componentName,n.arg.description,n.arg.fatal?js.ErrorSeverity.Fatal:js.ErrorSeverity.NonFatal,n.arg.errorCode):this.mpbCallbacks.onErrorLegacy();break;case"onEndOfStreamEvent":this.mpbCallbacks.onEndOfStream();break;case"onReadyToPlayEvent":null!==this.startPlaybackTimer&&oe.timer.clearTimeout(this.startPlaybackTimer),this.mpbCallbacks.onReadyToPlay(),this.waitingForPlaybackStartedCb=!0;break;case"onBufferUnderrunEvent":this.mpbCallbacks.onBufferUnderrun(),this.mpbState=u.INITIALIZED;break;case"onPlaybackStartedEvent":this.mpbCallbacks.onPlaybackStarted(),this.mpbState=u.PLAYING,this.waitingForPlaybackStartedCb=!1;break;case"onPictureModeChangedEvent":this.log.info("Ignoring onPictureModeChangedEvent "+JSON.stringify(n.arg));break;case"onMediaPipelineBackendErrorEvent":this.mpbCallbacks.onMediaPipelineBackendError(n.arg.errorCode);break;case"onPlaybackInitEvent":null!==this.initPlaybackTimer&&oe.timer.clearTimeout(this.initPlaybackTimer),n.arg.initSucceeded?(this.setVideoOutputPosition(),_t.surfaceRefManager.setResizeViewportFunction(this.resizeFnc),this.mpbState=u.INITIALIZED):(this.mpbState=u.UNINITIALIZED,this.mpbCallbacks.onError("MediaPipelineBackend","Init failed",js.ErrorSeverity.Fatal,void 0))}}else this.log.warn("Polling should not be done before registering callbacks")}),e.prototype.RegisterCallbacks=freeOnUnref(function(e){this.mpbCallbacks=e}),e.prototype.GetScreenWidth=freeOnUnref(function(){return this.syeMpbControl.getScreenWidth()}),e.prototype.GetScreenHeight=freeOnUnref(function(){return this.syeMpbControl.getScreenHeight()}),e.prototype.PlaybackInit=freeOnUnref(function(e){var t=this;this.mpbState=u.UNINITIALIZED,this.enableCheckPlaybackInitCallback&&(this.initPlaybackTimer=oe.timer.setTimeout(freeOnUnref(function(){t.mpbState=u.UNINITIALIZED,null!==t.mpbCallbacks?t.mpbCallbacks.onError("MediaPipelineBackend","Timeout waiting for playback init to finish",js.ErrorSeverity.Fatal,void 0):t.log.error("Init operation timed out and no error callback is registered")}),this.initTimeoutNano/1e6)),this.syeMpbControl.playbackInit(e)}),e.prototype.PlaybackShutdown=freeOnUnref(function(){null!==this.initPlaybackTimer&&oe.timer.clearTimeout(this.initPlaybackTimer),this.mpbState=u.UNINITIALIZED,this.syeMpbControl.playbackShutdown(),_t.surfaceRefManager.setResizeViewportFunction(void 0),this.clockMonitor&&this.clockMonitor.teardown()}),e.prototype.PlaybackPlay=freeOnUnref(function(e){this.log.info("Sye playback command PlaybackPlay"),this.syeMpbControl.playbackPlay(e)}),e.prototype.PlaybackStop=freeOnUnref(function(){this.mpbState=u.INITIALIZED,this.log.info("Sye playback command PlaybackStop"),this.clockMonitor&&this.clockMonitor.initiateStop(),this.syeMpbControl.playbackStop(),null!==this.startPlaybackTimer&&oe.timer.clearTimeout(this.startPlaybackTimer);var e=this.GetPlaybackTime();this.clockMonitor&&this.clockMonitor.handlePlaybackStop(e)}),e.prototype.PlaybackPause=freeOnUnref(function(){this.mpbState=u.INITIALIZED,this.log.info("Sye playback command PlaybackPause"),this.clockMonitor&&this.clockMonitor.initiateStop(),this.syeMpbControl.playbackPause(),null!==this.startPlaybackTimer&&oe.timer.clearTimeout(this.startPlaybackTimer);var e=this.GetPlaybackTime();this.clockMonitor&&this.clockMonitor.handlePlaybackStop(e)}),e.prototype.PlaybackSeek=freeOnUnref(function(e){var t=this;this.startPlaybackTimer=oe.timer.setTimeout(freeOnUnref(function(){null!==t.mpbCallbacks?t.mpbCallbacks.onError("MediaPipelineBackend","Timeout waiting for playback to start",js.ErrorSeverity.Fatal,void 0):t.log.error("Seek operation timed out and no error callback is registered")}),this.readyToPlayTimeoutNano/1e6),this.log.info("Sye playback command PlaybackSeek"),this.syeMpbControl.playbackSeek(e)}),e.prototype.PlaybackFlush=freeOnUnref(function(){this.log.info("Sye playback command PlaybackFlush"),this.syeMpbControl.playbackFlush(),this.previousPlaybackClock=0,this.previousWallClock=0,this.waitingForPlaybackStartedCb=!1,this.resizeAfterStop&&this.setVideoOutputPosition()}),e.prototype.GetPlaybackTime=freeOnUnref(function(){return this.mpbState===u.UNINITIALIZED&&this.enableCheckPlaybackInitCallback?0:this.syeMpbControl.getPlaybackTime()}),e.prototype.GetDiagnosticInfo=freeOnUnref(function(){var e=this.syeMpbControl.getDiagnosticInfo();return{error_code:e.error_code,num_dropped_frames:e.num_dropped_frames}}),e.prototype.SendVideoMetadata=freeOnUnref(function(e,t,n,r){this.syeMpbControl.sendVideoMetadata(e,t,n,r)}),e.prototype.SendAudioMetadata=freeOnUnref(function(e,t,n){this.syeMpbControl.sendAudioMetadata(e,t,n)}),e.prototype.VideoStreamStart=freeOnUnref(function(){this.syeMpbControl.videoStreamStart()}),e.prototype.VideoStreamFinish=freeOnUnref(function(){this.syeMpbControl.videoStreamFinish()}),e.prototype.SendVideoUnencryptedAU=freeOnUnref(function(e,t,n){this.syeMpbControl.sendVideoUnencryptedAU(e.sample,t,n)}),e.prototype.AudioStreamStart=freeOnUnref(function(){this.syeMpbControl.audioStreamStart()}),e.prototype.AudioStreamFinish=freeOnUnref(function(){this.syeMpbControl.audioStreamFinish()}),e.prototype.SendAudioUnencryptedAU=freeOnUnref(function(e,t,n,r){this.syeMpbControl.sendAudioUnencryptedAU(e.sample,t,n,r)}),Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){return 1}),set:freeOnUnref(function(e){}),enumerable:!0,configurable:!0}),e.prototype.GetMetadata=freeOnUnref(function(){return{nativePlaybackStack:"UNF"}}),e.prototype.SupportsFeature=freeOnUnref(function(e){return!1}),e})();t.MpbPlayerV2IgnitionX=n}));e(As);As.MpbState,As.MpbPlayerV2IgnitionX;var Ds=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=freeOnUnref(function(){function e(e,t,n,r,i,o){var a=this;this.surfaceRefId=t,this.instanceManager=n,this.surfaceRegistry=r,this.metrics=i,this.metricsPrefix=o,this.isInstanceManaged=!1,this.resizeNow=freeOnUnref(function(e,t){if(a.surfaceRefId!==e)return lt.Promise.resolve("NotExecuted");if(!_t.isViewportValid(t))return a.log.warn("skipping setOutputPosition for dynamic resize as given viewport is invalid: "+JSON.stringify(t)),lt.Promise.resolve("InvalidArgs");a.log.info("Calling MPB setOutputPosition for dynamic resize with viewport: "+JSON.stringify(t));var n=a.setVideoOutputPosition(t);return n!==p.MPBErrors.OK?(a.log.error("MPB error "+n+' when resizing surface id "'+e+'"'),a.metrics.putMetric("Resize.Fail."+a.metricsPrefix+".PlatformError"),lt.Promise.resolve("PlatformError")):(a.metrics.putMetric("Resize.Success."+a.metricsPrefix),lt.Promise.resolve("Ok"))}),this.setExternalSurfaceIdNow=freeOnUnref(function(e,t){if(a.surfaceRefId!==e)return lt.Promise.resolve("NotExecuted");var n=a.setExternalSurfaceId(t);return n!==p.MPBErrors.OK?(a.log.error("MPB error "+n+' when setting external surface id "'+e+'" with: '+t),lt.Promise.resolve("PlatformError")):lt.Promise.resolve("Ok")}),this.log=e.get("MMLMediaControlSurface");var s=this.surfaceRef,l=s.instanceId;if(null==l&&(this.log.info("creating new MPB instance as no instance id provided"),l=this.instanceManager.createInstance(),this.isInstanceManaged=!0),null==l)throw new Error("error creating new MPB instance for surfaceId="+t+" and surfaceRef="+JSON.stringify(s));this.wrapped=T.createMediaControl(l,this.instanceManager),this.buffer=T.createMediaBuffer(l,this.instanceManager)}return Object.defineProperty(e.prototype,"viewport",{get:freeOnUnref(function(){return this.surfaceRef.viewport}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mediaControl",{get:freeOnUnref(function(){return this.wrapped}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"surfaceRef",{get:freeOnUnref(function(){var e=this.surfaceRegistry.getSurfaceRef(this.surfaceRefId);return Qe.withDefault(e,{})}),enumerable:!0,configurable:!0}),e.prototype.init=freeOnUnref(function(e){var t=this.surfaceRef,n=t.viewport,r=t.externalSurfaceId;this.log.info("init, viewport="+JSON.stringify(n)+", externalSurfaceId="+r);var i,o=this.wrapped.init(e);if(o!==p.MPBErrors.OK)return o;if(_t.isViewportValid(n)){if(this.log.info("Calling MPB setOutputPosition for static resize with viewport: "+JSON.stringify(n)),(i=this.setVideoOutputPosition(n))!==p.MPBErrors.OK)return this.log.error("Error setting output position "+i+" with viewport: "+JSON.stringify(n)),i}else this.log.warn("skipping setOutputPosition as given viewport is invalid: "+JSON.stringify(n));if(null!=r&&(i=this.setExternalSurfaceId(r))!==p.MPBErrors.OK)return this.log.error("Error "+i+" setting external surface id with value "+r),i;return this.surfaceRegistry.registerCommand("set-viewport",this.resizeNow),this.surfaceRegistry.registerCommand("set-external-surface-id",this.setExternalSurfaceIdNow),o}),e.prototype.shutdown=freeOnUnref(function(){this.surfaceRegistry.deregisterCommand("set-viewport",this.resizeNow),this.surfaceRegistry.deregisterCommand("set-external-surface-id",this.setExternalSurfaceIdNow);var e=this.wrapped.shutdown();return e===p.MPBErrors.NOT_INITIALIZED&&(this.log.warn("MPB shutdown returned with native error code "+e+" - MPB was not initialised, ignoring"),e=p.MPBErrors.OK),e}),e.prototype.destroy=freeOnUnref(function(){return this.isInstanceManaged?(this.log.info("destroy, destroying managed MPB instance"),this.wrapped.destroy()):(this.log.info("destroy, releasing MPB instance handle"),this.wrapped.release(),p.MPBErrors.OK)}),e.prototype.setVideoOutputPosition=freeOnUnref(function(e){var t=e.x,n=e.y,r=e.width,i=e.height,o=e.zIndex;return this.wrapped.setOutputPosition(t,n,r,i,o)}),e.prototype.setExternalSurfaceId=freeOnUnref(function(e){var t=Qe.withDefault(e,"");return this.log.info("Calling MPB setProperty for surface change with externalSurface: "+t),this.wrapped.setProperty(p.EXTERNAL_SURFACE_KEY,t)}),e})();t.MediaControlSurface=s,t.createMediaControlSurface=function(e,t,n,r,i,o){void 0===o&&(o=new Ka.ScopedJSLogger);var a=Qe.withDefault(e,t.singletonId);return new s(o,a,n,t,r,i)}}));e(Ds);Ds.MediaControlSurface,Ds.createMediaControlSurface;var xs=t(freeOnUnref(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(Ds)}));e(xs);var Fs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.items={},this.head=0,this.tail=0}return e.prototype.enqueue=freeOnUnref(function(e){this.items[this.tail]=e,this.tail++}),e.prototype.dequeue=freeOnUnref(function(){if(this.head!==this.tail){var e=this.items[this.head];return delete this.items[this.head],this.head++,e}}),e.prototype.peek=freeOnUnref(function(){if(this.head!==this.tail)return this.items[this.head]}),Object.defineProperty(e.prototype,"length",{get:freeOnUnref(function(){return this.tail-this.head}),enumerable:!0,configurable:!0}),e.prototype.clear=freeOnUnref(function(){this.items={},this.head=0,this.tail=0}),e})();t.Queue=n}));e(Fs);Fs.Queue;var Bs=t(freeOnUnref(function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0});var i=freeOnUnref(function(){function e(){}return e.NATIVE_TO_MEDIA_CONTROL={filmmaker:"Filmmaker",calibratedBroadcast:"CalibratedBroadcast",calibratedCinematic:"CalibratedCinematic",none:"None"},e.MEDIA_CONTROL_TO_NATIVE=((n={}).Filmmaker="filmmaker",n.CalibratedBroadcast="calibratedBroadcast",n.CalibratedCinematic="calibratedCinematic",n.None="none",n),e.MEDIA_CONTROL_TO_DEVICE_INFO=((r={}).Filmmaker="Filmmaker",r.CalibratedCinematic="CalibratedCinematic",r.CalibratedBroadcast="CalibratedBroadcast",r.None=void 0,r),e.DEVICE_INFO_TO_MEDIA_CONTROL={Filmmaker:"Filmmaker",CalibratedCinematic:"CalibratedCinematic",CalibratedBroadcast:"CalibratedBroadcast"},e.SYE_PICTURE_MODE_TO_MEDIA_CONTROL={Filmmaker:"Filmmaker",CalibratedBroadcast:"CalibratedBroadcast",CalibratedCinematic:"CalibratedCinematic",None:"None"},e})();t.PictureModeMappings=i}));e(Bs);Bs.PictureModeMappings;var Ls=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("PictureModeManager"),n=freeOnUnref(function(){function e(e,t,n){void 0===n&&(n=q.metrics),this.playerSuggestedPictureModes=e,this.eventEmitter=t,this.metrics=n,this.deviceSupportedPictureModes=void 0,Array.isArray(this.playerSuggestedPictureModes)||(o.warn("Received an invalid player suggested picture mode array: ",this.playerSuggestedPictureModes),this.playerSuggestedPictureModes=[]),o.info("Player suggested picture modes: ["+this.playerSuggestedPictureModes+"], Device supported picture modes: ["+this.getDeviceSupportedPictureModes()+"]")}return e.prototype.handlePictureMode=freeOnUnref(function(e){switch(o.info("handlePictureMode: "+e),e){case"Filmmaker":case"CalibratedBroadcast":case"CalibratedCinematic":this.onPictureModeEnabled(e);break;case"None":this.onPictureModeDisabled(e);break;default:o.error("Unknown picture mode: "+e+" tried to set on the device"),this.onPictureModeDisabled(e)}}),e.prototype.handleSetPictureModeReturnCode=freeOnUnref(function(e,t){switch(e){case p.MPBErrors.OK:o.info("Picture mode set to '"+t+"' mode successfully"),this.metrics.putMetric("PictureMode."+t+".Success");break;case 50800:o.warn("Picture mode not set to '"+t+"': Automatic '"+t+"' mode not enabled on the device"),this.metrics.putMetric("PictureMode."+t+".Failure.AutoSettingDisabled");break;case p.MPBErrors.VALUE_NOT_SUPPORTED:case-1:o.warn("Picture mode not set to '"+t+"': Native function for setting picture mode not implemented error "+e),this.metrics.putMetric("PictureMode."+t+".NotEnabled.NotImplemented");break;default:o.error("Picture mode not set to '"+t+"': Native error code: "+e+" received in setPictureMode callback"),this.metrics.putMetric("PictureMode."+t+".Failure.Error")}}),e.prototype.shouldEnablePictureMode=freeOnUnref(function(e,t){var n=this.getDeviceSupportedPictureModes();return-1===this.playerSuggestedPictureModes.indexOf(e)||-1===n.indexOf(e)?(this.metrics.putMetric("MediaControlPictureMode."+e+".NotEnabled.NotSuggested"),!1):!!t||(this.metrics.putMetric("MediaControlPictureMode."+e+".NotEnabled.NotFullscreen"),!1)}),e.prototype.getDeviceSupportedPictureModes=freeOnUnref(function(){if(null!=this.deviceSupportedPictureModes)return this.deviceSupportedPictureModes;for(var e=[],t=0,n=Qe.nestedValue(zt.deviceCapabilities,"output.video.display.supportedPictureModes",[]);t<n.length;t++){var r=n[t],i=Bs.PictureModeMappings.DEVICE_INFO_TO_MEDIA_CONTROL[r];null==i?o.warn("Unsupported media control picture mode: "+r):e.push(i)}return this.deviceSupportedPictureModes=e}),e.prototype.onPictureModeEnabled=freeOnUnref(function(e){this.metrics.putMetric("PictureMode."+e+".EnabledByUser.Count"),this.eventEmitter.emit("PictureModeChange",e)}),e.prototype.onPictureModeDisabled=freeOnUnref(function(e){this.metrics.putMetric("PictureMode."+e+".DisabledByUser.Count"),this.eventEmitter.emit("PictureModeChange","None")}),e})();t.PictureModeManager=n}));e(Ls);Ls.PictureModeManager;var Ns=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PictureModeManager=Ls.PictureModeManager,t.PictureModeMappings=Bs.PictureModeMappings}));e(Ns);Ns.PictureModeManager,Ns.PictureModeMappings;var Vs=t(freeOnUnref(function(e,t){var i=ce&&ce.__assign||freeOnUnref(function(){return(i=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var f={onError:l.noop,onErrorLegacy:l.noop,onEndOfStream:l.noop,onReadyToPlay:l.noop,onBufferUnderrun:l.noop,onPlaybackStarted:l.noop,onMediaPipelineBackendError:l.noop,onPictureModeChanged:l.noop,onViewportChanged:l.noop},n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s){void 0===s&&(s=q.metrics);var l=this;this.metrics=s,this.startPlayCallTimer=null,this.pollInterval=null,this.seekPosition=null,this.capResolution=!1,this.videoAUQueue=new Fs.Queue,this.audioAUQueue=new Fs.Queue,this.notReadyToReceiveAudioSamplesTimer=null,this.notReadyToReceiveVideoSamplesTimer=null,this.mpbCapabilities=void 0,this.mediaControlSurfaceInitialised=!1,this.onReadyToPlay=freeOnUnref(function(){l.mpbCallbacks.onReadyToPlay()}),this.onPlaybackStarted=freeOnUnref(function(){l.mpbCallbacks.onPlaybackStarted()}),this.onBufferUnderrun=freeOnUnref(function(){l.mpbCallbacks.onBufferUnderrun()}),this.onMediaControlError=freeOnUnref(function(e){l.mpbCallbacks.onError(e.component_name,e.description,0===e.severity?js.ErrorSeverity.Fatal:js.ErrorSeverity.NonFatal,e.error_code)}),this.onPictureManagerEventEmitterEmit=freeOnUnref(function(e){var t="CalibratedBroadcast"===e?2:0;l.mpbCallbacks.onPictureModeChanged(t)}),this.onPictureModeChanged=freeOnUnref(function(e){if(l.log.info("API level MEDIA_PROPERTY_CHANGED: "+e),"calibratedBroadcast"===e||"none"===e){var t=Ns.PictureModeMappings.NATIVE_TO_MEDIA_CONTROL[e];l.pictureModeManager.handlePictureMode(t)}else l.log.info("Unsupported picturemode: "+e)}),this.log=e.get("MpbPlayerV3IgnitionX"),this.mpbCallbacks=f,this.instanceManager=T.getInstanceManager("LiveLowLatency",this.metrics),this.pictureModeSet=!1,this.suggestedPictureModes=[],this.eventEmitter=new A.EventEmitter,this.playerSuggestedPictureModes=[],this.deviceSupportedPictureModes=[],this.pictureModeManager=new Ns.PictureModeManager(this.playerSuggestedPictureModes,this.eventEmitter),Array.isArray(a)&&0<a.length&&(this.instanceManager.on("picture-mode-changed",this.onPictureModeChanged),this.suggestedPictureModes=a,this.eventEmitter.on("PictureModeChange",this.onPictureManagerEventEmitterEmit),this.playerSuggestedPictureModes=Qe.withDefault(this.suggestedPictureModes.map(freeOnUnref(function(e){return Ns.PictureModeMappings.SYE_PICTURE_MODE_TO_MEDIA_CONTROL[e]})),[]),this.pictureModeManager=new Ns.PictureModeManager(this.playerSuggestedPictureModes,this.eventEmitter),this.deviceSupportedPictureModes=this.pictureModeManager.getDeviceSupportedPictureModes()),void 0===zt.deviceCapabilities.output&&zt.initDeviceCapabilities({},freeOnUnref(function(e){})),this.mediaControlSurface=xs.createMediaControlSurface(i,_t.surfaceRefRegistry,this.instanceManager,this.metrics,"V3.Sye",e),this.rendererDelayNano=t,n&&(this.clockMonitor=new _s.ClockMonitor(o||{},freeOnUnref(function(e){l.mpbCallbacks&&l.mpbCallbacks.onError("ClockMonitor",e.message,js.ErrorSeverity.NonFatal,e.code)}))),this.capResolution=r}return Object.defineProperty(e.prototype,"mediaControl",{get:freeOnUnref(function(){return this.mediaControlSurface.mediaControl}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferControl",{get:freeOnUnref(function(){return this.mediaControlSurface.buffer}),enumerable:!0,configurable:!0}),e.prototype.Teardown=freeOnUnref(function(){var e=this.mediaControlSurface.destroy();e!==p.MPBErrors.OK&&this.log.warn("error "+JSON.stringify(e)+" when destroying MML controller, proceeding anyway"),this.instanceManager.off("picture-mode-changed",this.onPictureModeChanged),this.clockMonitor&&this.clockMonitor.teardown()}),e.prototype.RegisterCallbacks=freeOnUnref(function(e){this.mpbCallbacks=e}),e.prototype.GetScreenWidth=freeOnUnref(function(){var e=zt.deviceCapabilities.output.video.applicationViewport.width;return this.capResolution?e<1920?1280:1920:e}),e.prototype.GetScreenHeight=freeOnUnref(function(){var e=zt.deviceCapabilities.output.video.applicationViewport.height;return this.capResolution?e<1080?720:1080:e}),e.prototype.PlaybackInit=freeOnUnref(function(e){var t=this.mediaControlSurface.init(e);this.seekPosition=null,this.mediaControlSurfaceInitialised=t===p.MPBErrors.OK,t!==p.MPBErrors.OK&&this.mpbCallbacks.onError("MediaPipelineBackend","Init failed",js.ErrorSeverity.Fatal,t)}),e.prototype.StartPolling=freeOnUnref(function(){var t=this;this.StopPolling(),this.mediaControl.on("ready-to-play",this.onReadyToPlay),this.mediaControl.on("playback-started",this.onPlaybackStarted),this.mediaControl.on("buffer-underrun",this.onBufferUnderrun),this.mediaControl.on("error",this.onMediaControlError),this.pollInterval=oe.timer.setInterval(freeOnUnref(function(){t.trySendVideoAccessUnits(),t.trySendAudioAccessUnits();var e=t.GetPlaybackTime();t.clockMonitor&&t.clockMonitor.monitorPlaybackClockMovements(e)}),16)}),e.prototype.StopPolling=freeOnUnref(function(){this.mediaControl.off("ready-to-play",this.onReadyToPlay),this.mediaControl.off("playback-started",this.onPlaybackStarted),this.mediaControl.off("buffer-underrun",this.onBufferUnderrun),this.mediaControl.off("error",this.onMediaControlError),null!==this.pollInterval&&(oe.timer.clearInterval(this.pollInterval),this.pollInterval=null)}),e.prototype.PlaybackShutdown=freeOnUnref(function(){var e=this.mediaControlSurface.shutdown();this.seekPosition=null,e!==p.MPBErrors.OK&&this.mpbCallbacks.onError("MediaPipelineBackend","Shutdown failed",js.ErrorSeverity.Fatal,e),this.clockMonitor&&this.clockMonitor.teardown(),this.resetPictureMode(),this.pictureModeSet=!1}),e.prototype.PlaybackPlay=freeOnUnref(function(e){var t=this;if(null!==this.seekPosition){this.setPictureMode();var n=0;this.seekPosition>e+this.rendererDelayNano&&(n=this.seekPosition-e-this.rendererDelayNano),this.startPlayCallTimer=oe.timer.setTimeout(freeOnUnref(function(){t.startPlayCallTimer=null;var e=t.mediaControl.play();e!==p.MPBErrors.OK&&(t.resetPictureMode(),t.mpbCallbacks.onError("MediaPipelineBackend","Play failed",js.ErrorSeverity.Fatal,e))}),n/1e6)}else this.mpbCallbacks.onError("MediaPipelineBackend","Play called without seek",js.ErrorSeverity.Fatal,1)}),e.prototype.PlaybackStop=freeOnUnref(function(){null!==this.startPlayCallTimer&&(oe.timer.clearTimeout(this.startPlayCallTimer),this.startPlayCallTimer=null),this.clearNotReadyToReceiveAudioSamplesTimer(),this.clearNotReadyToReceiveVideoSamplesTimer(),this.videoAUQueue.clear(),this.audioAUQueue.clear(),this.clockMonitor&&this.clockMonitor.initiateStop();var e=this.mediaControl.stop();this.seekPosition=null,e!==p.MPBErrors.OK&&this.mpbCallbacks.onError("MediaPipelineBackend","Stop failed",js.ErrorSeverity.Fatal,e);var t=this.GetPlaybackTime();this.clockMonitor&&this.clockMonitor.handlePlaybackStop(t)}),e.prototype.PlaybackPause=freeOnUnref(function(){null!==this.startPlayCallTimer&&(oe.timer.clearTimeout(this.startPlayCallTimer),this.startPlayCallTimer=null),this.clearNotReadyToReceiveAudioSamplesTimer(),this.clearNotReadyToReceiveVideoSamplesTimer(),this.clockMonitor&&this.clockMonitor.initiateStop();var e=this.mediaControl.pause();e!==p.MPBErrors.OK&&this.mpbCallbacks.onError("MediaPipelineBackend","Pause failed",js.ErrorSeverity.Fatal,e);var t=this.GetPlaybackTime();this.clockMonitor&&this.clockMonitor.handlePlaybackStop(t)}),e.prototype.PlaybackSeek=freeOnUnref(function(e){this.seekPosition=e;var t=this.mediaControl.seek(e,1e9);t!==p.MPBErrors.OK&&this.mpbCallbacks.onError("MediaPipelineBackend","Seek failed",js.ErrorSeverity.Fatal,t)}),e.prototype.PlaybackFlush=freeOnUnref(function(){}),e.prototype.GetPlaybackTime=freeOnUnref(function(){var e=this.mediaControl.getPlaybackTime();return 1e9*e.ticks/e.timescale}),e.prototype.GetDiagnosticInfo=freeOnUnref(function(){var e=this.mediaControl.getDiagnostics();return{error_code:e.error_code,num_dropped_frames:e.num_dropped_frames}}),e.prototype.SendVideoMetadata=freeOnUnref(function(e,t,n,r){var i=this.bufferControl.videoMetadata(e,t,n,r);i!==p.MPBErrors.OK&&this.mpbCallbacks.onError("MediaPipelineBackend","Video metadata failed",js.ErrorSeverity.Fatal,i)}),e.prototype.SendAudioMetadata=freeOnUnref(function(e,t,n){var r=this.bufferControl.audioMetadata(e,t,n);r!==p.MPBErrors.OK&&this.mpbCallbacks.onError("MediaPipelineBackend","Audio metadata failed",js.ErrorSeverity.Fatal,r)}),e.prototype.VideoStreamStart=freeOnUnref(function(){}),e.prototype.VideoStreamFinish=freeOnUnref(function(){var e=this.bufferControl.videoEndOfStream();e!==p.MPBErrors.OK&&this.mpbCallbacks.onError("MediaPipelineBackend","Video stream finish failed",js.ErrorSeverity.Fatal,e)}),e.prototype.clearNotReadyToReceiveAudioSamplesTimer=freeOnUnref(function(){null!==this.notReadyToReceiveAudioSamplesTimer&&(oe.timer.clearTimeout(this.notReadyToReceiveAudioSamplesTimer),this.notReadyToReceiveAudioSamplesTimer=null)}),e.prototype.clearNotReadyToReceiveVideoSamplesTimer=freeOnUnref(function(){null!==this.notReadyToReceiveVideoSamplesTimer&&(oe.timer.clearTimeout(this.notReadyToReceiveVideoSamplesTimer),this.notReadyToReceiveVideoSamplesTimer=null)}),e.prototype.startNotReadyToReceiveAudioSamplesTimer=freeOnUnref(function(){var e=this;null===this.notReadyToReceiveAudioSamplesTimer&&(this.notReadyToReceiveAudioSamplesTimer=oe.timer.setTimeout(freeOnUnref(function(){e.mpbCallbacks.onError("MediaPipelineBackend","Timeout waiting for MPB to be ready to receive audio samples",js.ErrorSeverity.Fatal,p.MPBErrors.NOT_READY_TO_RECEIVE_SAMPLES)}),5e3))}),e.prototype.startNotReadyToReceiveVideoSamplesTimer=freeOnUnref(function(){var e=this;null===this.notReadyToReceiveVideoSamplesTimer&&(this.notReadyToReceiveVideoSamplesTimer=oe.timer.setTimeout(freeOnUnref(function(){e.mpbCallbacks.onError("MediaPipelineBackend","Timeout waiting for MPB to be ready to receive video samples",js.ErrorSeverity.Fatal,p.MPBErrors.NOT_READY_TO_RECEIVE_SAMPLES)}),5e3))}),e.prototype.trySendVideoAccessUnits=freeOnUnref(function(){for(;0<this.videoAUQueue.length;){var e=this.videoAUQueue.peek(),t=this.bufferControl.videoSample(e.data,e.ptsTicks,e.durationTicks,1e9,e.pixelWidth,e.pixelHeight,e.isParameterSet);if(t===p.MPBErrors.NOT_READY_TO_RECEIVE_SAMPLES){this.startNotReadyToReceiveVideoSamplesTimer();break}if(this.clearNotReadyToReceiveVideoSamplesTimer(),t!==p.MPBErrors.OK){if(t===p.MPBErrors.BUFFER_FULL)break;this.videoAUQueue.dequeue(),this.mpbCallbacks.onError("MediaPipelineBackend","Send video AU failed (error: "+t+", pts: "+e.ptsTicks+", isParameterSet: "+e.isParameterSet+")",js.ErrorSeverity.Fatal,t);break}this.videoAUQueue.dequeue()}}),e.prototype.SendVideoUnencryptedAU=freeOnUnref(function(e,t,n){var r={ptsTicks:t,durationTicks:n,pixelWidth:e.width,pixelHeight:e.height};e.isIDRFrame&&(0<e.vps.externalBuffer.length&&this.videoAUQueue.enqueue(i({},r,{data:e.vps.externalBuffer,isParameterSet:!0})),0<e.sps.externalBuffer.length&&this.videoAUQueue.enqueue(i({},r,{data:e.sps.externalBuffer,isParameterSet:!0})),0<e.pps.externalBuffer.length&&this.videoAUQueue.enqueue(i({},r,{data:e.pps.externalBuffer,isParameterSet:!0}))),0<e.data.externalBuffer.length&&this.videoAUQueue.enqueue(i({},r,{data:e.data.externalBuffer,isParameterSet:!1}))}),e.prototype.AudioStreamStart=freeOnUnref(function(){}),e.prototype.AudioStreamFinish=freeOnUnref(function(){var e=this.bufferControl.audioEndOfStream();e!==p.MPBErrors.OK&&this.mpbCallbacks.onError("MediaPipelineBackend","Audio stream finish failed",js.ErrorSeverity.Fatal,e)}),e.prototype.trySendAudioAccessUnits=freeOnUnref(function(){for(;0<this.audioAUQueue.length;){var e=this.audioAUQueue.peek(),t=this.bufferControl.audioSample(e.data,e.ptsTicks,e.durationTicks,1e9);if(t===p.MPBErrors.NOT_READY_TO_RECEIVE_SAMPLES){this.startNotReadyToReceiveAudioSamplesTimer();break}if(this.clearNotReadyToReceiveAudioSamplesTimer(),t!==p.MPBErrors.OK){if(t===p.MPBErrors.BUFFER_FULL)break;this.audioAUQueue.dequeue(),this.mpbCallbacks.onError("MediaPipelineBackend","Send audio AU failed (error: "+t+", pts: "+e.ptsTicks+")",js.ErrorSeverity.Fatal,t);break}this.audioAUQueue.dequeue()}}),e.prototype.SendAudioUnencryptedAU=freeOnUnref(function(e,t,n,r){0<e.data.externalBuffer.length&&this.audioAUQueue.enqueue({data:e.data.externalBuffer,ptsTicks:t,durationTicks:r})}),Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){return this.mediaControlSurfaceInitialised?this.mediaControl.volume:1}),set:freeOnUnref(function(e){this.mediaControlSurfaceInitialised&&(this.mediaControl.volume=e)}),enumerable:!0,configurable:!0}),e.prototype.GetMetadata=freeOnUnref(function(){return{nativePlaybackStack:"MML"}}),e.prototype.SupportsFeature=freeOnUnref(function(e){switch(e){case"supportsAudioVolume":return this.SupportsAudioVolume()}return!1}),e.prototype.setPictureMode=freeOnUnref(function(){var n=this;this.pictureModeSet||(Array.isArray(this.suggestedPictureModes)&&-1===this.suggestedPictureModes.indexOf(Ss.SyePictureMode.CalibratedBroadcast)||(this.deviceSupportedPictureModes&&0!==this.deviceSupportedPictureModes.length?this.playerSuggestedPictureModes.filter(freeOnUnref(function(t){return n.deviceSupportedPictureModes.some(freeOnUnref(function(e){return e===t}))})).forEach(freeOnUnref(function(e){n.log.info("Trying to setPictureMode: "+e),n.tryToSetPictureMode(e)})):this.log.info("Device supported picture modes not available")))}),e.prototype.resetPictureMode=freeOnUnref(function(){if(this.pictureModeSet){var e=this.instanceManager.setProperty(p.PICTURE_MODE_PROPERTY_KEY,"none");this.pictureModeManager.handleSetPictureModeReturnCode(e,"None"),e===p.MPBErrors.OK?(this.metrics.putMetric("PictureMode.None.Enabled",0),this.log.info("setPictureMode for None succeeded with error code "+e)):this.log.error("None setPictureMode failed with native error code "+e)}else this.log.info("Picture mode was not set, skipping reset")}),e.prototype.tryToSetPictureMode=freeOnUnref(function(e){var t=this.mediaControlSurface.viewport;if(!this.pictureModeManager.shouldEnablePictureMode(e,Rs.isFullScreenPlayback(t)))return this.metrics.putMetric("PictureMode."+e+".Enabled",0),void this.log.info(e+" picture mode not set, not all requirements are met");var n=Ns.PictureModeMappings.MEDIA_CONTROL_TO_NATIVE[e];if(null==n)return this.metrics.putMetric("PictureMode."+e+".Enabled",0),this.log.error("setPictureMode for "+e+" failed due to media control to native picture mode conversion failed"),void this.pictureModeManager.handleSetPictureModeReturnCode(p.MPBErrors.VALUE_NOT_SUPPORTED,e);var r=this.instanceManager.setProperty(p.PICTURE_MODE_PROPERTY_KEY,n);this.pictureModeManager.handleSetPictureModeReturnCode(r,e),r===p.MPBErrors.OK?(this.pictureModeSet=!0,this.metrics.putMetric("PictureMode."+e+".Enabled",1),this.log.info("setPictureMode for "+e+" succeeded with error code "+r)):this.log.error(e+" setPictureMode failed with native error code "+r)}),e.prototype.SupportsAudioVolume=freeOnUnref(function(){var e=this.getMpbCapabilities();return void 0===e?(this.log.error("MPB capabilities is undefined when checking audio volume support, assuming AudioVolume is unsupported"),!1):e.supportsAudioVolume}),e.prototype.getMpbCapabilities=freeOnUnref(function(){return void 0!==this.mpbCapabilities&&null!==this.mpbCapabilities.capabilities?this.mpbCapabilities.capabilities:(this.mpbCapabilities=this.instanceManager.getCapabilities(),this.mpbCapabilities.errorCode===p.MPBErrors.OK?this.mpbCapabilities.capabilities:void this.log.error("MPB getCapabilities failed: "+JSON.stringify(this.mpbCapabilities)))}),e})();t.MpbPlayerV3IgnitionX=n}));e(Vs);Vs.MpbPlayerV3IgnitionX;var js=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MpbPlayerV2IgnitionX=As.MpbPlayerV2IgnitionX,t.MpbPlayerV3IgnitionX=Vs.MpbPlayerV3IgnitionX,t.ClockErrorCode=_s.ClockErrorCode,freeOnUnref(function(e){e[e.OK=0]="OK",e[e.INVALID_STATE=50001]="INVALID_STATE",e[e.INVALID_ARGUMENT=50005]="INVALID_ARGUMENT",e[e.NOT_IMPLEMENTED=50007]="NOT_IMPLEMENTED",e[e.NOT_INITIALIZED=50008]="NOT_INITIALIZED",e[e.ALREADY_INIT=50012]="ALREADY_INIT",e[e.IS_DESTROYED=50031]="IS_DESTROYED",e[e.KEY_NOT_FOUND=50040]="KEY_NOT_FOUND",e[e.BUFFER_FULL=50802]="BUFFER_FULL",e[e.DRM_INSUFFICIENT_PROTECTION=-2013069050]="DRM_INSUFFICIENT_PROTECTION",e[e.DRM_DISPLAY_DISCONNECTED=-2013069049]="DRM_DISPLAY_DISCONNECTED"})(t.MPBErrors||(t.MPBErrors={})),freeOnUnref(function(e){e[e.Fatal=0]="Fatal",e[e.NonFatal=1]="NonFatal"})(t.ErrorSeverity||(t.ErrorSeverity={})),t.SupportsMPBv2=function(){return is.connector.syeAPIControlFactoryAPI.getSyeAPI().isMPBv2Supported()},t.SupportsMPBv3=function(){return T.isMMLSupported},t.CreateV2Player=function(e,t,n,r,i,o,a,s,l){return new As.MpbPlayerV2IgnitionX(e,t,n,r,i,o,a,s,l)},t.CreateV3Player=function(e,t,n,r,i,o,a){return new Vs.MpbPlayerV3IgnitionX(e,t,n,r,i,o,a)}}));e(js);js.MpbPlayerV2IgnitionX,js.MpbPlayerV3IgnitionX,js.ClockErrorCode,js.MPBErrors,js.ErrorSeverity,js.SupportsMPBv2,js.SupportsMPBv3,js.CreateV2Player,js.CreateV3Player;var qs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateModelSupported=function(e,t){var n=e;return void 0!==t&&void 0!==t.modelName&&void 0!==n&&void 0!==n.supportedModels&&void 0!==n.supportedModels[t.modelName]?n.supportedModels[t.modelName]:void 0===n||void 0===n.supportedModels},t.getMpbVersionFromModel=function(e,t){var n=e;return void 0!==n&&void 0!==n.mpbVersion?"number"==typeof n.mpbVersion?n.mpbVersion:void 0!==t&&void 0!==t.modelName&&void 0!==n.mpbVersion[t.modelName]?n.mpbVersion[t.modelName]:2:2},t.getDecodeOnlyFixEnabled=function(e,t){var n=e;return void 0!==n&&void 0!==n.decodeOnlyFix&&("boolean"==typeof n.decodeOnlyFix?n.decodeOnlyFix:void 0!==t&&void 0!==t.modelName&&void 0!==n.decodeOnlyFix[t.modelName]&&n.decodeOnlyFix[t.modelName])},t.getV3PictureModeSetEnabled=function(e,t){var n=e;return void 0!==n&&void 0!==n.v3PictureModeSet&&"boolean"==typeof n.v3PictureModeSet&&n.v3PictureModeSet}}));e(qs);qs.validateModelSupported,qs.getMpbVersionFromModel,qs.getDecodeOnlyFixEnabled,qs.getV3PictureModeSetEnabled;var Hs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.sdkVersion=e,this.onListChannelsSuccess=null,this.onListChannelsError=null}return e.prototype.GitVersion=freeOnUnref(function(){return"not implemented"}),e.prototype.BuildTag=freeOnUnref(function(){return"not implemented"}),e.prototype.ProtocolVersion=freeOnUnref(function(){return 0}),e.prototype.GetLocalTimeMicros=freeOnUnref(function(){return 0}),e.prototype.fetchChannels=freeOnUnref(function(e){}),e.prototype.createGlobalCallbackImplementation=freeOnUnref(function(){var r=this;return{__construct:freeOnUnref(function(){this.__parent.__construct.call(this)}),__destruct:freeOnUnref(function(){this.__parent.__destruct.call(this)}),onListChannels:freeOnUnref(function(e){}),onError:freeOnUnref(function(e,t){if(r.onListChannelsError){var n=e;r.onListChannelsError(n,t)}})}}),e})();t.SyeSession=n}));e(Hs);Hs.SyeSession;var zs=t(freeOnUnref(function(e,t){function u(e){if(e<0||isNaN(e))return"00:00:00.000";var t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4),r=Math.floor(e%6e4/1e3),i=e%1e3,o=freeOnUnref(function(e,t){for(var n=e.toString();n.length<t;)n="0"+n;return n});return o(t,2)+":"+o(n,2)+":"+o(r,2)+"."+o(i,3)}Object.defineProperty(t,"__esModule",{value:!0}),t.transformTTML=function(e,t,n){var r,i,o,a,s,l,f=JSON.parse(e);return'<?xml version="1.0" encoding="UTF-8"?>  <tt xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.w3.org/ns/ttml" xmlns:tts="http://www.w3.org/ns/ttml#styling" xmlns:ttm="http://www.w3.org/ns/ttml#metadata"><head><layout>'+(l="",0===(s=f).windows.length?'<region ttm:role="x-sye-subtitle"/>':(s.windows.forEach(freeOnUnref(function(e,t){l+='<region xml:id="speaker'+t+'" ttm:role="x-sye-subtitle"><style tts:origin="'+e.area.x+"px "+e.area.y+'px" tts:extent="'+e.area.w+"px "+e.area.h+'px"/><style tts:textAlign="start"/><style tts:displayAlign="after"/><style tts:overflow="visible"/></region>'})),l))+"</layout></head><body><div>"+(i=t,o=n,a="",0===(r=f).windows.length?a+='<p xml:id="paragraph0" begin="'+u(i)+'" end="'+u(o)+'"></p>':r.windows.forEach(freeOnUnref(function(e,t){var n;a+='<p xml:id="paragraph'+t+'" region="speaker'+t+'" begin="'+u(i)+'" end="'+u(o)+'">'+(n="",e.rows.forEach(freeOnUnref(function(e){e.forEach(freeOnUnref(function(e){n+="<span>"+e.rowSubString+"</span><br/>"}))})),n)+"</p>"})),a)+"</div></body></tt>"}}));e(zs);zs.transformTTML;var Ws=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o,a=freeOnUnref(function(){return function(){this.coarseGrainSpeedUpAdjustments=0,this.coarseGrainSlowDownAdjustments=0,this.fineGrainSpeedUpAdjustments=0,this.fineGrainSlowDownAdjustments=0}})();freeOnUnref(function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.SEEK_PERFORMED=1]="SEEK_PERFORMED",e[e.PLAYBACK_STARTED=2]="PLAYBACK_STARTED",e[e.INITIAL_SYNC_REACHED=3]="INITIAL_SYNC_REACHED",e[e.BUFFER_UNDERRUN=4]="BUFFER_UNDERRUN",e[e.PLAYBACK_STOPPED=5]="PLAYBACK_STOPPED"})(o=t.PlaybackMetricState||(t.PlaybackMetricState={}));var n=freeOnUnref(function(){function e(e,t,n,r,i){this.log=e,this.audioBuffer=[],this.videoBuffer=[],this.maximumAVSync=0,this.maximumGlobalSync=0,this.currentClockData={utcClockNano:0,localClockNano:0,playbackClockNano:0},this.startClockData={utcClockNano:0,localClockNano:0,playbackClockNano:0},this.audioAdjustmentData=new a,this.playbackState=o.UNDEFINED,this.onMetricsCallback=t,this.timeProvider=n,this.avSyncThresholdNano=r,this.globalSyncThresholdNano=i}return e.prototype.addAudioSampleData=freeOnUnref(function(e){this.audioBuffer.push(e),this.clearBufferData(),this.updateMaximumSync()}),e.prototype.addVideoSampleData=freeOnUnref(function(e){this.videoBuffer.push(e),this.clearBufferData(),this.updateMaximumSync()}),e.prototype.addAudioCoarseGrainSpeedUpAdjustment=freeOnUnref(function(){this.playbackState!==o.UNDEFINED&&this.audioAdjustmentData.coarseGrainSpeedUpAdjustments++}),e.prototype.addAudioCoarseGrainSlowDownAdjustment=freeOnUnref(function(){this.playbackState!==o.UNDEFINED&&this.audioAdjustmentData.coarseGrainSlowDownAdjustments++}),e.prototype.addAudioFineGrainSpeedUpAdjustment=freeOnUnref(function(){this.playbackState!==o.UNDEFINED&&this.audioAdjustmentData.fineGrainSpeedUpAdjustments++}),e.prototype.addAudioFineGrainSlowDownAdjustment=freeOnUnref(function(){this.playbackState!==o.UNDEFINED&&this.audioAdjustmentData.fineGrainSlowDownAdjustments++}),e.prototype.poll=freeOnUnref(function(){if(this.hasPlaybackStarted()){var e=this.timeProvider.getLocalTimeMicros(),t={playbackClockNano:this.timeProvider.getPlaybackTimeNano(this.playbackState),localClockNano:1e3*e,utcClockNano:1e3*this.timeProvider.getUtcTimeMicros(e)};this.currentClockData=t;var n=this.getAVSyncNow();if(Math.abs(n)>Math.abs(this.avSyncThresholdNano)){var r=n/1e6;this.playbackState===o.PLAYBACK_STARTED?(this.onMetricsCallback(Ss.SyeMetricsType.InitialAVSync,Math.abs(r),"ms"),this.log.error("Audio and video is not playing in sync at the startup. The diff between audio and video is "+r+" milliseconds")):(this.onMetricsCallback(Ss.SyeMetricsType.AVSync,Math.abs(r),"ms"),this.log.error("Audio and video is not playing in sync after startup. The diff between audio and video is "+r+" milliseconds"))}this.getCurrentPlaybackState()===o.PLAYBACK_STARTED&&Math.abs(this.getGlobalSyncNow())<=this.globalSyncThresholdNano&&this.isAudioVideoFlaggedAsPlaybackStarted()&&(this.changePlaybackState(o.INITIAL_SYNC_REACHED),this.log.info("Initial sync reached"))}}),e.prototype.changePlaybackState=freeOnUnref(function(e){var t=this.timeProvider.getPlaybackTimeNano(e),n=this.timeProvider.getLocalTimeMicros(),r={utcClockNano:1e3*this.timeProvider.getUtcTimeMicros(n),localClockNano:1e3*n,playbackClockNano:t},i=this.playbackState===o.UNDEFINED?r.utcClockNano:this.startClockData.utcClockNano;this.shouldReportStartupMetrics(e)?this.reportStartupMetrics(i,r.utcClockNano):this.shouldReportInitialSyncReached(e)?(this.reportInitialSyncMetrics(i,r.utcClockNano),this.reset()):this.shouldReportSyncMetrics(e)&&(this.reportSyncMetrics(i,r.utcClockNano),this.reset()),this.playbackState=e,this.startClockData=r,this.audioAdjustmentData=new a}),e.prototype.getNumberOfCoarseGrainSpeedUp=freeOnUnref(function(){return this.audioAdjustmentData.coarseGrainSpeedUpAdjustments}),e.prototype.getNumberOfCoarseGrainSlowDown=freeOnUnref(function(){return this.audioAdjustmentData.coarseGrainSlowDownAdjustments}),e.prototype.getNumberOfFineGrainSpeedUp=freeOnUnref(function(){return this.audioAdjustmentData.fineGrainSpeedUpAdjustments}),e.prototype.getNumberOfFineGrainSlowDown=freeOnUnref(function(){return this.audioAdjustmentData.fineGrainSlowDownAdjustments}),e.prototype.reset=freeOnUnref(function(){this.videoBuffer=[],this.audioBuffer=[],this.maximumAVSync=0,this.maximumGlobalSync=0,this.currentClockData={utcClockNano:0,localClockNano:0,playbackClockNano:0},this.startClockData={utcClockNano:0,localClockNano:0,playbackClockNano:0},this.audioAdjustmentData=new a,this.playbackState=o.UNDEFINED}),e.prototype.isAudioVideoFlaggedAsPlaybackStarted=freeOnUnref(function(){return 0<this.audioBuffer.length&&this.audioBuffer[0].playbackStarted&&0<this.videoBuffer.length&&this.videoBuffer[0].playbackStarted}),e.prototype.reportStartupMetrics=freeOnUnref(function(e,t){e<t&&this.onMetricsCallback(Ss.SyeMetricsType.TimeToPlaybackStarted,(t-e)/1e6,"ms")}),e.prototype.reportInitialSyncMetrics=freeOnUnref(function(e,t){if(e<t){var n=(t-e)/1e9,r=this.getNumberOfCoarseGrainSlowDown(),i=this.getNumberOfCoarseGrainSpeedUp(),o=this.getNumberOfFineGrainSlowDown(),a=this.getNumberOfFineGrainSpeedUp(),s=this.getMaximumAVSync(),l=this.getMaximumGlobalSync(),f=i/n,u=r/n,c=a/n,d=o/n,p=this.getUtcLocalClockDriftNow()/n,h=this.getUtcPlaybackClockDriftNow()/n,m=this.getLocalPlaybackClockDriftNow()/n;this.onMetricsCallback(Ss.SyeMetricsType.TimeToSync,(t-e)/1e6,"ms"),this.onMetricsCallback(Ss.SyeMetricsType.InitialAVSync,Math.abs(s/1e6),"ms"),this.onMetricsCallback(Ss.SyeMetricsType.InitialGlobalSync,Math.abs(l/1e6),"ms"),this.onMetricsCallback(Ss.SyeMetricsType.InitialCoarseSpeedUpPerSecond,f,""),this.onMetricsCallback(Ss.SyeMetricsType.InitialCoarseSlowDownPerSecond,u,""),this.onMetricsCallback(Ss.SyeMetricsType.InitialFineSpeedUpPerSecond,c,""),this.onMetricsCallback(Ss.SyeMetricsType.InitialFineSlowDownPerSecond,d,""),this.onMetricsCallback(Ss.SyeMetricsType.InitialUtcLocalDriftPerSecond,Math.abs(p/1e6),"ms"),this.onMetricsCallback(Ss.SyeMetricsType.InitialUtcPlaybackDriftPerSecond,Math.abs(h/1e6),"ms"),this.onMetricsCallback(Ss.SyeMetricsType.InitialLocalPlaybackDriftPerSecond,Math.abs(m/1e6),"ms")}}),e.prototype.reportSyncMetrics=freeOnUnref(function(e,t){if(e<t){var n=(t-e)/1e9,r=this.getNumberOfCoarseGrainSlowDown(),i=this.getNumberOfCoarseGrainSpeedUp(),o=this.getNumberOfFineGrainSlowDown(),a=this.getNumberOfFineGrainSpeedUp(),s=this.getMaximumAVSync(),l=this.getMaximumGlobalSync(),f=i/n,u=r/n,c=a/n,d=o/n,p=this.getUtcLocalClockDriftNow()/n,h=this.getUtcPlaybackClockDriftNow()/n,m=this.getLocalPlaybackClockDriftNow()/n;this.onMetricsCallback(Ss.SyeMetricsType.AVSync,Math.abs(s/1e6),"ms"),this.onMetricsCallback(Ss.SyeMetricsType.GlobalSync,Math.abs(l/1e6),"ms"),this.onMetricsCallback(Ss.SyeMetricsType.CoarseSpeedUpPerSecond,f,""),this.onMetricsCallback(Ss.SyeMetricsType.CoarseSlowDownPerSecond,u,""),this.onMetricsCallback(Ss.SyeMetricsType.FineSpeedUpPerSecond,c,""),this.onMetricsCallback(Ss.SyeMetricsType.FineSlowDownPerSecond,d,""),this.onMetricsCallback(Ss.SyeMetricsType.UtcLocalDriftPerSecond,Math.abs(p/1e6),"ms"),this.onMetricsCallback(Ss.SyeMetricsType.UtcPlaybackDriftPerSecond,Math.abs(h/1e6),"ms"),this.onMetricsCallback(Ss.SyeMetricsType.LocalPlaybackDriftPerSecond,Math.abs(m/1e6),"ms")}}),e.prototype.getCurrentPlaybackState=freeOnUnref(function(){return this.playbackState}),e.prototype.hasPlaybackStarted=freeOnUnref(function(){return this.playbackState===o.PLAYBACK_STARTED||this.playbackState===o.INITIAL_SYNC_REACHED}),e.prototype.shouldReportSyncMetrics=freeOnUnref(function(e){return this.hasPlaybackStarted()&&(e===o.PLAYBACK_STOPPED||e===o.BUFFER_UNDERRUN)}),e.prototype.shouldReportStartupMetrics=freeOnUnref(function(e){return this.getCurrentPlaybackState()===o.SEEK_PERFORMED&&(e===o.PLAYBACK_STARTED||e===o.BUFFER_UNDERRUN)}),e.prototype.shouldReportInitialSyncReached=freeOnUnref(function(e){return this.getCurrentPlaybackState()===o.PLAYBACK_STARTED&&e===o.INITIAL_SYNC_REACHED}),e.prototype.clearBufferData=freeOnUnref(function(){if(0!==this.audioBuffer.length&&0!==this.videoBuffer.length){this.videoBuffer.sort(freeOnUnref(function(e,t){return e.utcPtsNano-t.utcPtsNano}));for(var e=this.videoBuffer[this.videoBuffer.length-1],t=this.audioBuffer[this.audioBuffer.length-1],n=0;n<this.videoBuffer.length-1;n++)this.videoBuffer[n].utcPtsNano<t.utcPtsNano&&this.videoBuffer.splice(n--,1);for(n=0;n<this.audioBuffer.length-1;n++)this.audioBuffer[n].utcPtsNano<e.utcPtsNano&&this.audioBuffer.splice(n--,1)}}),e.prototype.updateMaximumSync=freeOnUnref(function(){var e=this.getAVSyncNow();Math.abs(this.maximumAVSync)<Math.abs(e)&&(this.maximumAVSync=e);var t=this.getGlobalSyncNow();Math.abs(this.maximumGlobalSync)<Math.abs(t)&&(this.maximumGlobalSync=t)}),e.prototype.getAVSyncNow=freeOnUnref(function(){return 0===this.audioBuffer.length||0===this.videoBuffer.length?0:this.audioBuffer[0].utcPtsNano-this.audioBuffer[0].playbackPtsActualNano-(this.videoBuffer[0].utcPtsNano-this.videoBuffer[0].playbackPtsActualNano)}),e.prototype.getMaximumAVSync=freeOnUnref(function(){return this.maximumAVSync}),e.prototype.getGlobalSyncNow=freeOnUnref(function(){var e=0!==this.audioBuffer.length?this.audioBuffer[0].playbackPtsSyncNano-this.audioBuffer[0].playbackPtsActualNano:0,t=0!==this.videoBuffer.length?this.videoBuffer[0].playbackPtsSyncNano-this.videoBuffer[0].playbackPtsActualNano:0;return Math.abs(e)>Math.abs(t)?e:t}),e.prototype.getMaximumGlobalSync=freeOnUnref(function(){return this.maximumGlobalSync}),e.prototype.getLocalPlaybackClockDriftNow=freeOnUnref(function(){return this.currentClockData.localClockNano-this.startClockData.localClockNano-(this.currentClockData.playbackClockNano-this.startClockData.playbackClockNano)}),e.prototype.getUtcLocalClockDriftNow=freeOnUnref(function(){return this.currentClockData.utcClockNano-this.startClockData.utcClockNano-(this.currentClockData.localClockNano-this.startClockData.localClockNano)}),e.prototype.getUtcPlaybackClockDriftNow=freeOnUnref(function(){return this.currentClockData.utcClockNano-this.startClockData.utcClockNano-(this.currentClockData.playbackClockNano-this.startClockData.playbackClockNano)}),e})();t.SyeMetricHandler=n}));e(Ws);Ws.PlaybackMetricState,Ws.SyeMetricHandler;var Ks=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.PLAYING=0]="PLAYING",e[e.PAUSED=1]="PAUSED",e[e.READY=2]="READY",e[e.STOPPED=3]="STOPPED"})(t.PlaybackState||(t.PlaybackState={}))}));e(Ks);Ks.PlaybackState;var Gs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=[24e3/1001,24,25,3e4/1001,30,50,6e4/1001,60],r=freeOnUnref(function(){function l(e){var n=this;this.log=e,this.onAudioMetadataChange=freeOnUnref(function(e){var t=n.currentAudioMetadata;return n.currentAudioMetadata=e,void 0===t?0:e.codec!==t.codec||e.numChannels!==t.numChannels||e.samplerate!==t.samplerate?(n.log.warn("AudioMetadataChange not ok, previous metadata "+JSON.stringify(t)+" new metadata "+JSON.stringify(e)),1):0}),this.onVideoMetadataChange=freeOnUnref(function(e){var t=n.currentVideoMetadata;return n.currentVideoMetadata=e,void 0===t?0:e.codec===t.codec&&l.areFrameratesCompatible(t,e)?0:(n.log.warn("VideoMetadataChange not ok, previous metadata "+JSON.stringify(t)+" new metadata "+JSON.stringify(e)),1)}),this.reset=freeOnUnref(function(){n.currentAudioMetadata=void 0,n.currentVideoMetadata=void 0})}return l.standardToHighFramerate=freeOnUnref(function(e){switch(e){case 25:return 50;case 3e4/1001:return 6e4/1001;case 30:return 60;default:return e}}),l.isValidFramerate=freeOnUnref(function(e){return-1!==n.indexOf(e)}),l.areFrameratesCompatible=freeOnUnref(function(e,t){var n=e.framerateNum,r=e.framerateDen,i=t.framerateNum,o=t.framerateDen;if(void 0===n||void 0===r)return n===i&&r===o;if(void 0===i||void 0===o)return!1;var a=i/o,s=n/r;return a===s||l.standardToHighFramerate(a)===s||l.standardToHighFramerate(s)===a}),l})();t.MediaMetadataMonitor=r}));e(Gs);Gs.MediaMetadataMonitor;var Qs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.log=e,this.minAudioBufferMarginReceiverMs=null,this.maxAudioBufferMarginReceiverMs=null,this.minAudioBufferMarginDecoderMs=null,this.maxAudioBufferMarginDecoderMs=null,this.worstAudioGlobalSyncMs=null,this.minVideoBufferMarginReceiverMs=null,this.maxVideoBufferMarginReceiverMs=null,this.minVideoBufferMarginDecoderMs=null,this.maxVideoBufferMarginDecoderMs=null,this.worstVideoGlobalSyncMs=null,this.logTimerId=null}return e.prototype.updateAudioReceiverMargin=freeOnUnref(function(e){null===this.minAudioBufferMarginReceiverMs?this.minAudioBufferMarginReceiverMs=e:this.minAudioBufferMarginReceiverMs=Math.min(this.minAudioBufferMarginReceiverMs,e),null===this.maxAudioBufferMarginReceiverMs?this.maxAudioBufferMarginReceiverMs=e:this.maxAudioBufferMarginReceiverMs=Math.max(this.maxAudioBufferMarginReceiverMs,e)}),e.prototype.updateAudioDecoderMargin=freeOnUnref(function(e,t){var n=e/1e6-t/1e6;null===this.minAudioBufferMarginDecoderMs?this.minAudioBufferMarginDecoderMs=n:this.minAudioBufferMarginDecoderMs=Math.min(this.minAudioBufferMarginDecoderMs,n),null===this.maxAudioBufferMarginDecoderMs?this.maxAudioBufferMarginDecoderMs=n:this.maxAudioBufferMarginDecoderMs=Math.max(this.maxAudioBufferMarginDecoderMs,n)}),e.prototype.updateAudioGlobalSync=freeOnUnref(function(e,t){var n=e/1e6-t/1e6,r=Math.abs(n);null===this.worstAudioGlobalSyncMs?this.worstAudioGlobalSyncMs=r:this.worstAudioGlobalSyncMs=Math.max(this.worstAudioGlobalSyncMs,r)}),e.prototype.updateVideoReceiverMargin=freeOnUnref(function(e){null===this.minVideoBufferMarginReceiverMs?this.minVideoBufferMarginReceiverMs=e:this.minVideoBufferMarginReceiverMs=Math.min(this.minVideoBufferMarginReceiverMs,e),null===this.maxVideoBufferMarginReceiverMs?this.maxVideoBufferMarginReceiverMs=e:this.maxVideoBufferMarginReceiverMs=Math.max(this.maxVideoBufferMarginReceiverMs,e)}),e.prototype.updateVideoDecoderMargin=freeOnUnref(function(e,t){var n=e/1e6-t/1e6;null===this.minVideoBufferMarginDecoderMs?this.minVideoBufferMarginDecoderMs=n:this.minVideoBufferMarginDecoderMs=Math.min(this.minVideoBufferMarginDecoderMs,n),null===this.maxVideoBufferMarginDecoderMs?this.maxVideoBufferMarginDecoderMs=n:this.maxVideoBufferMarginDecoderMs=Math.max(this.maxVideoBufferMarginDecoderMs,n)}),e.prototype.updateVideoGlobalSync=freeOnUnref(function(e,t){var n=e/1e6-t/1e6,r=Math.abs(n);null===this.worstVideoGlobalSyncMs?this.worstVideoGlobalSyncMs=r:this.worstVideoGlobalSyncMs=Math.max(this.worstVideoGlobalSyncMs,r)}),e.prototype.init=freeOnUnref(function(){var e=this;null!==this.logTimerId&&(oe.timer.clearInterval(this.logTimerId),this.logTimerId=null),this.logTimerId=oe.timer.setInterval(freeOnUnref(function(){e.logMetrics()}),6e4)}),e.prototype.teardown=freeOnUnref(function(){null!==this.logTimerId&&(oe.timer.clearInterval(this.logTimerId),this.logTimerId=null)}),e.prototype.logMetrics=freeOnUnref(function(){this.log.info("Audio buffer margin (receiver): min="+(null!==this.minAudioBufferMarginReceiverMs?Math.round(this.minAudioBufferMarginReceiverMs)+"ms":"N/A")+" max="+(null!==this.maxAudioBufferMarginReceiverMs?Math.round(this.maxAudioBufferMarginReceiverMs)+"ms":"N/A")+", audio buffer margin (decoder): min="+(null!==this.minAudioBufferMarginDecoderMs?Math.round(this.minAudioBufferMarginDecoderMs)+"ms":"N/A")+" max="+(null!==this.maxAudioBufferMarginDecoderMs?Math.round(this.maxAudioBufferMarginDecoderMs)+"ms":"N/A")+", audio global sync: "+(null!==this.worstAudioGlobalSyncMs?Math.round(this.worstAudioGlobalSyncMs)+"ms":"N/A")),this.log.info("Video buffer margin (receiver): min="+(null!==this.minVideoBufferMarginReceiverMs?Math.round(this.minVideoBufferMarginReceiverMs)+"ms":"N/A")+" max="+(null!==this.maxVideoBufferMarginReceiverMs?Math.round(this.maxVideoBufferMarginReceiverMs)+"ms":"N/A")+", video buffer margin (decoder): min="+(null!==this.minVideoBufferMarginDecoderMs?Math.round(this.minVideoBufferMarginDecoderMs)+"ms":"N/A")+" max="+(null!==this.maxVideoBufferMarginDecoderMs?Math.round(this.maxVideoBufferMarginDecoderMs)+"ms":"N/A")+", video global sync: "+(null!==this.worstVideoGlobalSyncMs?Math.round(this.worstVideoGlobalSyncMs)+"ms":"N/A")),this.resetWorstValues()}),e.prototype.resetWorstValues=freeOnUnref(function(){this.minAudioBufferMarginReceiverMs=null,this.maxAudioBufferMarginReceiverMs=null,this.minAudioBufferMarginDecoderMs=null,this.maxAudioBufferMarginDecoderMs=null,this.worstAudioGlobalSyncMs=null,this.minVideoBufferMarginReceiverMs=null,this.maxVideoBufferMarginReceiverMs=null,this.minVideoBufferMarginDecoderMs=null,this.maxVideoBufferMarginDecoderMs=null,this.worstVideoGlobalSyncMs=null}),e})();t.AudioVideoMetricsLogger=n}));e(Qs);Qs.AudioVideoMetricsLogger;var Xs=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})(),r=ce&&ce.__assign||freeOnUnref(function(){return(r=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var o=js;function i(e){return"Called deprecated method SyePlayer."+e.deprecated+". Consider using "+e.recommended+" instead."}var a=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u){var c=this;this.log=e,this.clientPollTimerId=null,this.pollStopped=!0,this.syeMetricHandler=null,this.playbackState=Ks.PlaybackState.STOPPED,this.lastReportDroppedFramesTimeTicks=0,this.distanceToLive=0,this.timelineStartUtc=0,this.mpbRestartRequired=!1,this.previousCCTimestamp=null,this.lastPollReturnMicros=0,this.pollTimeoutMetricsMap={},this.pollNativeMetricsMap={},this.seamlessAudioSamplePending=!1,this.onCorrelationStreamCallback=null,this.onNotificationMessageCallback=null,this.onAvailableAudioLanguagesCallback=null,this.onAvailableClosedCaptionsChannelsCallback=null,this.onAvailableClosedCaptionsServicesCallback=null,this.onAvailableTeletextSubtitlePagesCallback=null,this.onAudioTracksCallback=null,this.onAvailableAudioTracksCallback=null,this.onDiagnosticDataCallback=null,this.onNeedDecryptionKeysCallback=null,this.onVideoTracksCallback=null,this.onAudioTrackChangeCallback=null,this.onAudioStreamChangeCallback=null,this.onSyncEventCallback=null,this.onVideoTrackChangeCallback=null,this.onVideoStreamChangeCallback=null,this.onFrontendErrorCallback=null,this.onFrontendSuccessCallback=null,this.onStreamingErrorCallback=null,this.onMetricsCallback=null,this.onPictureModeChangedCallback=null,this.onStateChangeCallback=null,this.onEgressAllocatedCallback=null,this.onEgressContactCallback=null,this.onTimeToFirstFrameCallback=null,this.onTimelineUpdateCallback=null,this.onClosedCaptionsUpdateCallback=null,this.seamlessAudioChange=f,this.volumeFeatureEnabled=u,this.scpPlayer=t,this.scpPlayer.RegisterCallbacks(this.createScpCallbackImplementation()),this.mpbPlayer=n,this.mpbPlayer.RegisterCallbacks(this.createMpbCallbackImplementation()),this.syncHandler=r,this.syncHandler.RegisterCallbacks(this.createSyncCallbackImplementation()),this.onErrorCallback=i,this.onErrorRetryCallback=o,this.mpbConfiguration=l,this.mpbPlayer.PlaybackInit(this.mpbConfiguration),this.metadataMonitor=new Gs.MediaMetadataMonitor(this.log),this.syeMetricHandler=new Ws.SyeMetricHandler(this.log,freeOnUnref(function(e,t,n){c.onMetricsCallback&&c.onMetricsCallback(e,t,n)}),{getLocalTimeMicros:freeOnUnref(function(){return ks.scpApi.GetLocalTimeMicros()}),getUtcTimeMicros:freeOnUnref(function(e){return c.getUtcTimeMicros(e)}),getPlaybackTimeNano:freeOnUnref(function(e){return e!==Ws.PlaybackMetricState.PLAYBACK_STARTED&&e!==Ws.PlaybackMetricState.INITIAL_SYNC_REACHED?1e3*ks.scpApi.GetLocalTimeMicros():c.mpbPlayer.GetPlaybackTime()})},a,s),this.diagnostics=nn.Diagnostics.create("SyePlayer"),this.metricsLogger=new Qs.AudioVideoMetricsLogger(this.log),this.attachClosedCaptionsViewToSurface=this.attachClosedCaptionsViewToSurface.bind(this),this.attachView=this.attachView.bind(this),this.audioTracks=this.audioTracks.bind(this),this.audioVolume=this.audioVolume.bind(this),this.availableAudioLanguages=this.availableAudioLanguages.bind(this),this.cacheThumbnailsForInterval=this.cacheThumbnailsForInterval.bind(this),this.cacheThumbnailsFromLive=this.cacheThumbnailsFromLive.bind(this),this.currentAudioTrack=this.currentAudioTrack.bind(this),this.currentChannelId=this.currentChannelId.bind(this),this.currentVideoTrack=this.currentVideoTrack.bind(this),this.detachClosedCaptionsViewFromSurface=this.detachClosedCaptionsViewFromSurface.bind(this),this.detachView=this.detachView.bind(this),this.getAttachedView=this.getAttachedView.bind(this),this.getAudioVolume=this.getAudioVolume.bind(this),this.getAvailableClosedCaptionsChannels=this.getAvailableClosedCaptionsChannels.bind(this),this.getAvailableClosedCaptionsServices=this.getAvailableClosedCaptionsServices.bind(this),this.getAvailableTeletextSubtitlePages=this.getAvailableTeletextSubtitlePages.bind(this),this.getSelectedTeletextSubtitlePageNumber=this.getSelectedTeletextSubtitlePageNumber.bind(this),this.createScpCallbackImplementation=this.createScpCallbackImplementation.bind(this),this.createMpbCallbackImplementation=this.createMpbCallbackImplementation.bind(this),this.createSyncCallbackImplementation=this.createSyncCallbackImplementation.bind(this),this.getMetrics=this.getMetrics.bind(this),this.getStatistics=this.getStatistics.bind(this),this.getThumbnail=this.getThumbnail.bind(this),this.isClosedCaptionsEnabled=this.isClosedCaptionsEnabled.bind(this),this.isDiagnosticReportingStarted=this.isDiagnosticReportingStarted.bind(this),this.pause=this.pause.bind(this),this.playFromLive=this.playFromLive.bind(this),this.playFromUtcTime=this.playFromUtcTime.bind(this),this.playWithOffset=this.playWithOffset.bind(this),this.playResume=this.playResume.bind(this),this.selectedAudioLanguage=this.selectedAudioLanguage.bind(this),this.selectAudioLanguage=this.selectAudioLanguage.bind(this),this.selectClosedCaptionsChannel=this.selectClosedCaptionsChannel.bind(this),this.selectClosedCaptionsService=this.selectClosedCaptionsService.bind(this),this.selectClosedCaptionsType=this.selectClosedCaptionsType.bind(this),this.selectTeletextSubtitlePageNumber=this.selectTeletextSubtitlePageNumber.bind(this),this.setAudioSettings=this.setAudioSettings.bind(this),this.setAudioPreferences=this.setAudioPreferences.bind(this),this.getAudioPreferences=this.getAudioPreferences.bind(this),this.setDTVCCSettings=this.setDTVCCSettings.bind(this),this.setIsClosedCaptionsEnabled=this.setIsClosedCaptionsEnabled.bind(this),this.setPreferredBitrateFiltering=this.setPreferredBitrateFiltering.bind(this),this.startDiagnosticReporting=this.startDiagnosticReporting.bind(this),this.stop=this.stop.bind(this),this.stopDiagnosticReporting=this.stopDiagnosticReporting.bind(this),this.synchronize=this.synchronize.bind(this),this.addDecryptionKeys=this.addDecryptionKeys.bind(this),this.updateSyeSystem=this.updateSyeSystem.bind(this),this.videoTracks=this.videoTracks.bind(this),this.startScpPoll=this.startScpPoll.bind(this),this.getPresentationDelayMillis=this.getPresentationDelayMillis.bind(this),this.mayReportDroppedFrames=this.mayReportDroppedFrames.bind(this),this.prepareForPlayAttempt=this.prepareForPlayAttempt.bind(this),this.reportDroppedFrames=this.reportDroppedFrames.bind(this),this.startPollers=this.startPollers.bind(this),this.stopMediaPipelineBackend=this.stopMediaPipelineBackend.bind(this),this.startPollers(),this.metricsLogger.init()}return e.prototype.attachClosedCaptionsViewToSurface=freeOnUnref(function(e){}),e.prototype.attachView=freeOnUnref(function(e){}),e.prototype.audioTracks=freeOnUnref(function(){return i({deprecated:"audioTracks",recommended:"availableAudioTracks"}),this.availableAudioTracks()}),e.prototype.availableAudioTracks=freeOnUnref(function(){var e=this.scpPlayer.GetAvailableAudioTracks();return this.log.info("availableAudioTracks: "+JSON.stringify(e)),e}),e.prototype.availableAudioLanguages=freeOnUnref(function(){return i({deprecated:"availableAudioLanguages",recommended:"availableAudioTracks"}),this.availableAudioTracks().map(freeOnUnref(function(e){return e.language}))}),e.prototype.stopMediaPipelineBackend=freeOnUnref(function(){this.log.info("Stopping media pipeline backend"),this.syncHandler.reset(),this.playbackState=Ks.PlaybackState.STOPPED,this.distanceToLive=0,this.timelineStartUtc=0,this.mpbPlayer.PlaybackPause(),this.mpbPlayer.PlaybackStop(),this.mpbPlayer.PlaybackFlush()}),e.prototype.reportDroppedFrames=freeOnUnref(function(){var e=this.mpbPlayer.GetDiagnosticInfo();0<e.num_dropped_frames&&e.error_code===js.MPBErrors.OK?(this.log.info("report dropped frames "+e.num_dropped_frames),this.scpPlayer.ReportWarning("kDroppedFrames",String(e.num_dropped_frames))):0===e.num_dropped_frames&&e.error_code===js.MPBErrors.OK||this.log.warn("GetDiagnosticInfo call failed with code "+e.error_code)}),e.prototype.mayReportDroppedFrames=freeOnUnref(function(e){1e9<=e-this.lastReportDroppedFramesTimeTicks&&(this.reportDroppedFrames(),this.lastReportDroppedFramesTimeTicks=e)}),e.prototype.getPresentationDelayMillis=freeOnUnref(function(){return this.scpPlayer.GetPresentationDelayMillis()}),e.prototype.getUtcTimeMicros=freeOnUnref(function(e){return this.scpPlayer.GetLocalConvertedToServerUtcMicros(e)}),e.prototype.getAvailableClosedCaptionsChannels=freeOnUnref(function(){var e=this.scpPlayer.GetAvailableClosedCaptionsChannels();return this.log.info("getAvailableClosedCaptionsChannels method "+JSON.stringify(e)),e}),e.prototype.getAvailableClosedCaptionsServices=freeOnUnref(function(){var e=this.scpPlayer.GetAvailableClosedCaptionsServices();return this.log.info("getAvailableClosedCaptionsServices method "+JSON.stringify(e)),e}),e.prototype.getAvailableTeletextSubtitlePages=freeOnUnref(function(){return new Array}),e.prototype.cacheThumbnailsForInterval=freeOnUnref(function(e,t){this.log.info("cacheThumbnailsForInterval startUtcMillis: "+e+" endUtcMillis "+t),this.scpPlayer.CacheThumbnailsForInterval(e,t)}),e.prototype.cacheThumbnailsFromLive=freeOnUnref(function(e){this.log.info("cacheThumbnailsFromLive durationMillis: "+e),this.scpPlayer.CacheThumbnailsFromLive(e)}),e.prototype.currentAudioTrack=freeOnUnref(function(){return i({deprecated:"currentAudioTrack",recommended:"audioStreamInfo"}),this.scpPlayer.GetCurrentAudioTrack()}),e.prototype.audioStreamInfo=freeOnUnref(function(){var e=this.scpPlayer.GetAudioStreamInfo();return void 0!==e&&this.log.info("audioStreamInfo: "+JSON.stringify(e)),e}),e.prototype.currentChannelId=freeOnUnref(function(){return this.scpPlayer.GetCurrentChannelId()}),e.prototype.currentVideoTrack=freeOnUnref(function(){return i({deprecated:"currentVideoTrack",recommended:"videoStreamInfo"}),this.scpPlayer.GetCurrentVideoTrack()}),e.prototype.videoStreamInfo=freeOnUnref(function(){var e=this.scpPlayer.GetVideoStreamInfo();return void 0!==e&&this.log.info("videoStreamInfo: "+JSON.stringify(e)),e}),e.prototype.detachClosedCaptionsViewFromSurface=freeOnUnref(function(e){}),e.prototype.detachView=freeOnUnref(function(){}),e.prototype.getAttachedView=freeOnUnref(function(){}),e.prototype.getAudioSettings=freeOnUnref(function(){i({deprecated:"getAudioSettings",recommended:"getAudioPreferences"});var e=this.getAudioPreferences();return{preferredChannels:e.channels,preferredCodec:e.codec,preferredBitrate:0,preferredLanguage:e.language,switchMode:Ss.SyeAudioTrackSwitchMode.kTrackChange}}),e.prototype.getAudioPreferences=freeOnUnref(function(){var e=this.scpPlayer.GetAudioPreferences();return this.log.info("getAudioPreferences: "+JSON.stringify(e)),e}),e.prototype.getAudioVolume=freeOnUnref(function(){return this.mpbPlayer.SupportsFeature("supportsAudioVolume")&&this.volumeFeatureEnabled?this.mpbPlayer.volume:1}),e.prototype.audioVolume=freeOnUnref(function(e){this.mpbPlayer.SupportsFeature("supportsAudioVolume")&&this.volumeFeatureEnabled&&(this.mpbPlayer.volume=e,ks.scpApi.SupportsFeature("SetAudioFocus")&&this.scpPlayer.SetAudioFocus(0<e))}),e.prototype.getSelectedTeletextSubtitlePageNumber=freeOnUnref(function(){}),e.prototype.getSelectedClosedCaptionsChannel=freeOnUnref(function(){var e=this.scpPlayer.GetSelectedClosedCaptionsChannel();return this.log.info("getSelectedClosedCaptionsChannel: "+JSON.stringify(e)),e}),e.prototype.getSelectedClosedCaptionsService=freeOnUnref(function(){var e=this.scpPlayer.GetSelectedClosedCaptionsService();return this.log.info("getSelectedClosedCaptionsService: "+JSON.stringify(e)),e}),e.prototype.getSelectedClosedCaptionsType=freeOnUnref(function(){var e=this.scpPlayer.GetSelectedClosedCaptionsType();return this.log.info("getSelectedClosedCaptionsType: "+JSON.stringify(e)),e}),e.prototype.setDTVCCSettings=freeOnUnref(function(e){this.scpPlayer.SetDTVCCSettings(e)}),e.prototype.getPreferredBitrateFiltering=freeOnUnref(function(){return i({deprecated:"getPreferredBitrateFiltering",recommended:"getVideoPreferences"}),{minBitrate:0,maxBitrate:this.getVideoPreferences().maxBitrate}}),e.prototype.getDTVCCSettings=freeOnUnref(function(){return this.scpPlayer.GetDTVCCSettings()}),e.prototype.getMetrics=freeOnUnref(function(){return this.scpPlayer.GetMetrics()}),e.prototype.getMetadata=freeOnUnref(function(){var e=r({},this.mpbPlayer.GetMetadata(),this.scpPlayer.GetMetadata());return this.log.info("getMetadata: "+JSON.stringify(e)),e}),e.prototype.getStatistics=freeOnUnref(function(){i({deprecated:"getStatistics",recommended:"getMetrics"});var e=this.scpPlayer.GetMetrics();return JSON.stringify({totalBitsPerSecond:e.bitrateTotal,currentRoundtripMillis:e.roundtripMillis,numReceivedBytes:e.bytesReceived,numReceivedFrames:e.videoFramesReceived,numDecryptedFrames:0,numDecodeFailures:e.videoDecodeFailures,numDamagedAudioFrames:0,audioDropoutMillis:e.audioDropoutMillis,numDroppedVideoFrames:e.videoFramesDropped,numDamagedVideoFrames:e.videoFramesDamaged,videoDivergenceMillis:e.videoDivergenceMillis,pitcherGroup:e.pitcherGroup})}),e.prototype.getThumbnail=freeOnUnref(function(e){return this.scpPlayer.GetThumbnail(e)}),e.prototype.getVideoSettings=freeOnUnref(function(){i({deprecated:"getVideoSettings",recommended:"getVideoPreferences"});var e=this.getVideoPreferences();return{minBitrate:0,minHeight:0,minWidth:0,maxBitrate:e.maxBitrate,maxHeight:e.maxHeight,maxWidth:0}}),e.prototype.getVideoPreferences=freeOnUnref(function(){var e=this.scpPlayer.GetVideoPreferences();return this.log.info("getVideoPreferences: "+JSON.stringify(e)),e}),e.prototype.setVideoPreferences=freeOnUnref(function(e){this.log.info("setVideoPreferences "+JSON.stringify(e)),this.scpPlayer.SetVideoPreferences(e)}),e.prototype.hide=freeOnUnref(function(){}),e.prototype.isDiagnosticReportingStarted=freeOnUnref(function(){return!1}),e.prototype.pause=freeOnUnref(function(){this.log.info("pause"),null!==this.syeMetricHandler&&this.syeMetricHandler.changePlaybackState(Ws.PlaybackMetricState.PLAYBACK_STOPPED),this.scpPlayer.Pause(),this.previousCCTimestamp=null,this.mpbPlayer.PlaybackPause(),this.playbackState=Ks.PlaybackState.PAUSED}),e.prototype.playerState=freeOnUnref(function(){var e=this.scpPlayer.GetPlayerState();return this.log.info("playerState: "+JSON.stringify(e)),e}),e.prototype.playFromLive=freeOnUnref(function(e){this.log.info("playFromLive "+e),this.prepareForPlayAttempt(),this.scpPlayer.PlayFromLive(e),this.playbackState=Ks.PlaybackState.READY}),e.prototype.playFromUtcTime=freeOnUnref(function(e,t){this.log.info("playFromUtcTime "+e+" "+t),this.prepareForPlayAttempt(),this.scpPlayer.PlayFromUtcTime(e,t),this.playbackState=Ks.PlaybackState.READY}),e.prototype.playWithOffset=freeOnUnref(function(e,t){this.log.info("playWithOffset "+e+" "+t),this.prepareForPlayAttempt(),this.scpPlayer.PlayWithOffset(e,t),this.playbackState=Ks.PlaybackState.READY}),e.prototype.playResume=freeOnUnref(function(){this.log.info("playResume"),this.prepareForPlayAttempt(),this.scpPlayer.PlayResume(),this.playbackState=Ks.PlaybackState.READY}),e.prototype.selectedAudioLanguage=freeOnUnref(function(){this.log.warn(i({deprecated:"selectedAudioLanguage",recommended:"getAudioPreferences"}));var e=this.getAudioPreferences().language;return void 0===e?"":e}),e.prototype.selectAudioLanguage=freeOnUnref(function(e){this.log.warn(i({deprecated:"selectAudioLanguage",recommended:"setAudioPreferences"}));var t=this.getAudioPreferences();t.language=e,this.setAudioPreferences(t)}),e.prototype.selectClosedCaptionsChannel=freeOnUnref(function(e){this.log.info("selectClosedCaptionsChannel "+JSON.stringify(e)),this.scpPlayer.SelectClosedCaptionsChannel(e)}),e.prototype.selectClosedCaptionsService=freeOnUnref(function(e){this.log.info("selectClosedCaptionsService "+JSON.stringify(e)),this.scpPlayer.SelectClosedCaptionsService(e)}),e.prototype.setIsClosedCaptionsEnabled=freeOnUnref(function(e){}),e.prototype.isClosedCaptionsEnabled=freeOnUnref(function(){return!1}),e.prototype.selectClosedCaptionsType=freeOnUnref(function(e){this.log.info("selectClosedCaptionsType "+JSON.stringify(e)),this.scpPlayer.SelectClosedCaptionsType(e)}),e.prototype.selectTeletextSubtitlePageNumber=freeOnUnref(function(e){}),e.prototype.setAudioSettings=freeOnUnref(function(e){this.log.warn(i({deprecated:"setAudioSettings",recommended:"setAudioPreferences"}));var t=this.getAudioPreferences();t.channels=e.preferredChannels,t.language=e.preferredLanguage,t.codec=e.preferredCodec,this.setAudioPreferences(t)}),e.prototype.setVideoSettings=freeOnUnref(function(e){this.log.warn(i({deprecated:"setVideoSettings",recommended:"setVideoPreferences"}));var t=this.getVideoPreferences();t.maxBitrate=e.maxBitrate,t.maxHeight=e.maxHeight,this.setVideoPreferences(t)}),e.prototype.setAudioPreferences=freeOnUnref(function(e){var t=this.scpPlayer.SetAudioPreferences(e);this.log.info("setAudioPreferences: "+JSON.stringify(e)+", seamlessAudioChange: "+this.seamlessAudioChange+", audioPreferencesUpdated: "+t),t&&!this.seamlessAudioChange&&(this.log.info("setAudioPreferences: Restarting media pipeline"),this.mpbRestartRequired=!0,this.playResume()),t&&this.seamlessAudioChange&&(this.seamlessAudioSamplePending=!0)}),e.prototype.setPreferredBitrateFiltering=freeOnUnref(function(e){this.log.warn(i({deprecated:"setPreferredBitrateFiltering",recommended:"setVideoPreferences"}));var t=this.getVideoPreferences();t.maxBitrate=e.maxBitrate,this.setVideoPreferences(t)}),e.prototype.show=freeOnUnref(function(){}),e.prototype.startDiagnosticReporting=freeOnUnref(function(){}),e.prototype.stop=freeOnUnref(function(){this.log.info("stop"),null!==this.syeMetricHandler&&this.syeMetricHandler.changePlaybackState(Ws.PlaybackMetricState.PLAYBACK_STOPPED),this.scpPlayer.Stop(),this.previousCCTimestamp=null,this.stopMediaPipelineBackend()}),e.prototype.stopDiagnosticReporting=freeOnUnref(function(){}),e.prototype.synchronize=freeOnUnref(function(e){this.log.warn("SyePlayer.synchronize not implemented on Ignition X, ignoring")}),e.prototype.addDecryptionKeys=freeOnUnref(function(e){this.log.warn("SyePlayer.addDecryptionKeys not implemented on Ignition X, ignoring.")}),e.prototype.updateSyeSystem=freeOnUnref(function(e){this.log.info("updateSyeSystem "+JSON.stringify(e)),this.scpPlayer.Update(e)}),e.prototype.videoTracks=freeOnUnref(function(){this.log.warn("Called deprecated SyePlayer.videoTracks method.This information is no longer available and only the active track (if any) is returned.");var e=this.currentVideoTrack();return void 0===e?[]:[e]}),e.prototype.getCurrentTime=freeOnUnref(function(){return 1e3*(new Date).getTime()}),e.prototype.collectPollData=freeOnUnref(function(e,t,n,r){0===this.lastPollReturnMicros&&(this.lastPollReturnMicros=this.getCurrentTime());var i=this.getCurrentTime()-this.lastPollReturnMicros-r,o=i-i%4e4;1e6<o&&(o=1e6);var a=t-e-(1e4-n),s=a-a%4e4;1e6<s&&(s=1e6),void 0===this.pollTimeoutMetricsMap[o]&&(this.pollTimeoutMetricsMap[o]=0),void 0===this.pollNativeMetricsMap[s]&&(this.pollNativeMetricsMap[s]=0),this.pollTimeoutMetricsMap[o]++,this.pollNativeMetricsMap[s]++,this.lastPollReturnMicros=t}),e.prototype.startScpPoll=freeOnUnref(function(r){var i=this;oe.timer.setTimeout(freeOnUnref(function(){if(!i.pollStopped){var e=i.getCurrentTime(),t=i.scpPlayer.Poll(),n=i.getCurrentTime();i.collectPollData(e,n,t,r),i.startScpPoll(t)}}),r/1e3)}),e.prototype.createSyncCallbackImplementation=freeOnUnref(function(){var s=this;return{onAudioSampleSynced:freeOnUnref(function(e,t,n,r,i){if(s.seamlessAudioSamplePending&&(s.diagnostics.report("seamlessSwitchLatency",{replacedSampleFeedTimeMs:Date.now(),currentPlaybackPositionMs:s.mpbPlayer.GetPlaybackTime()/1e6,replacedSamplePositionMs:r/1e6}),s.seamlessAudioSamplePending=!1),s.metricsLogger.updateAudioDecoderMargin(r,s.mpbPlayer.GetPlaybackTime()),s.metricsLogger.updateAudioGlobalSync(r,i),s.mpbPlayer.SendAudioUnencryptedAU(e,r,t,n),null!==s.syeMetricHandler){var o=e.localTimeMicros,a=1e3*s.getUtcTimeMicros(o);s.syeMetricHandler.addAudioSampleData({utcPtsNano:a,localPtsNano:1e3*o,playbackPtsActualNano:r,playbackPtsSyncNano:i,playbackStarted:s.playbackState===Ks.PlaybackState.PLAYING})}}),onVideoSampleSynced:freeOnUnref(function(e,t,n){var r=1e9/(e.framerateNum/e.framerateDen);if(s.metricsLogger.updateVideoDecoderMargin(t,s.mpbPlayer.GetPlaybackTime()),s.metricsLogger.updateVideoGlobalSync(t,n),s.mpbPlayer.SendVideoUnencryptedAU(e,t,r),!e.decodeOnly){var i=e.localTimeMicros,o=1e3*s.getUtcTimeMicros(i);null!==s.syeMetricHandler&&s.syeMetricHandler.addVideoSampleData({utcPtsNano:o,localPtsNano:1e3*i,playbackPtsActualNano:t,playbackPtsSyncNano:n,playbackStarted:s.playbackState===Ks.PlaybackState.PLAYING})}}),onAudioSpeedUpCoarseAdjustment:freeOnUnref(function(){null!==s.syeMetricHandler&&s.syeMetricHandler.addAudioCoarseGrainSpeedUpAdjustment()}),onAudioSpeedUpFineAdjustment:freeOnUnref(function(){null!==s.syeMetricHandler&&s.syeMetricHandler.addAudioFineGrainSpeedUpAdjustment()}),onAudioSlowDownCoarseAdjustment:freeOnUnref(function(){null!==s.syeMetricHandler&&s.syeMetricHandler.addAudioCoarseGrainSlowDownAdjustment()}),onAudioSlowDownFineAdjustment:freeOnUnref(function(){null!==s.syeMetricHandler&&s.syeMetricHandler.addAudioFineGrainSlowDownAdjustment()}),onReadyToSeek:freeOnUnref(function(e){s.mpbPlayer.PlaybackSeek(e),null!==s.syeMetricHandler&&s.syeMetricHandler.changePlaybackState(Ws.PlaybackMetricState.SEEK_PERFORMED)}),onVideoMetadata:freeOnUnref(function(e){Gs.MediaMetadataMonitor.isValidFramerate(e.framerate)||s.log.error("Starting MPB with a framerate that is not officially supported ("+e.framerate+")"),s.mpbPlayer.SendVideoMetadata(e.codec,e.width,e.height,Gs.MediaMetadataMonitor.standardToHighFramerate(e.framerate)),s.mpbPlayer.VideoStreamStart()}),onAudioMetadata:freeOnUnref(function(e){s.mpbPlayer.SendAudioMetadata(e.codec,e.samplerate,e.numChannels),s.mpbPlayer.AudioStreamStart()})}}),e.prototype.createMpbCallbackImplementation=freeOnUnref(function(){var i=this;return{onError:freeOnUnref(function(e,t,n,r){if(i.log.warn("onError: componentName="+e+", description="+t+", severity="+n+", errorCode="+r),void 0===r||"ClockMonitor"!==e)n===o.ErrorSeverity.Fatal?(i.mpbRestartRequired=!0,void 0!==r?i.scpPlayer.ReportError("kFatalPlatformException",'Description: " '+t+'", Component name: "'+e+'", Error code: '+r):i.scpPlayer.ReportError("kFatalPlatformException",'Description: " '+t+'", Component name: "'+e+'"')):void 0!==r?i.scpPlayer.ReportError("kPlatformException",'Description: " '+t+'", Component name: "'+e+'", Error code: '+r):i.scpPlayer.ReportError("kPlatformException",'Description: " '+t+'", Component name: "'+e+'"');else switch(r){case js.ClockErrorCode.InitialJumpTooLarge:i.onStreamingErrorCallback&&i.onStreamingErrorCallback(Ss.SyePlayerError.kClockInitialJumpTooLarge,t);break;case js.ClockErrorCode.MovingTooFast:i.onStreamingErrorCallback&&i.onStreamingErrorCallback(Ss.SyePlayerError.kClockMovingTooFast,t);break;case js.ClockErrorCode.MovingBackwards:i.onStreamingErrorCallback&&i.onStreamingErrorCallback(Ss.SyePlayerError.kClockMovingBackwards,t);break;case js.ClockErrorCode.JumpTooLarge:i.onStreamingErrorCallback&&i.onStreamingErrorCallback(Ss.SyePlayerError.kClockJumpTooLarge,t)}}),onErrorLegacy:freeOnUnref(function(){i.mpbRestartRequired=!0,i.scpPlayer.ReportError("kFatalPlatformException","No error details available")}),onEndOfStream:freeOnUnref(function(){}),onReadyToPlay:freeOnUnref(function(){i.syncHandler.isSeekDone()&&i.mpbPlayer.PlaybackPlay(1e3*ks.scpApi.GetLocalTimeMicros())}),onBufferUnderrun:freeOnUnref(function(){i.playbackState=Ks.PlaybackState.PAUSED,null!==i.syeMetricHandler&&i.syeMetricHandler.changePlaybackState(Ws.PlaybackMetricState.BUFFER_UNDERRUN)}),onPlaybackStarted:freeOnUnref(function(){i.playbackState=Ks.PlaybackState.PLAYING,null!==i.syeMetricHandler&&i.syeMetricHandler.changePlaybackState(Ws.PlaybackMetricState.PLAYBACK_STARTED)}),onMediaPipelineBackendError:freeOnUnref(function(e){i.log.warn("sye got mpb error with error code "+e),i.onMetricsCallback&&i.onMetricsCallback(Ss.SyeMetricsType.MediaPipelineError)}),onPictureModeChanged:freeOnUnref(function(e){i.onPictureModeChangedCallback&&i.onPictureModeChangedCallback(e)}),onViewportChanged:freeOnUnref(function(e,t,n,r){ks.scpApi.SupportsFeature("SetViewResolution")&&(i.log.info("Setting view resolution in SCP width: "+n+" height: "+r),i.scpPlayer.SetViewResolution(n,r))})}}),e.prototype.reportEndStallMetrics=freeOnUnref(function(){this.log.warn("End stall poll metric: timeout: "+JSON.stringify(this.pollTimeoutMetricsMap)+" native: "+JSON.stringify(this.pollNativeMetricsMap)),this.pollTimeoutMetricsMap={},this.pollNativeMetricsMap={}}),e.prototype.reportBeginStallMetrics=freeOnUnref(function(){this.log.warn("Begin stall poll metric: timeout: "+JSON.stringify(this.pollTimeoutMetricsMap)+" native: "+JSON.stringify(this.pollNativeMetricsMap)),this.pollTimeoutMetricsMap={},this.pollNativeMetricsMap={}}),e.prototype.createScpCallbackImplementation=freeOnUnref(function(){var c=this;return{onFrontendError:freeOnUnref(function(e,t,n){c.onFrontendErrorCallback&&(c.log.info("onFrontendErrorCallback "+JSON.stringify({code:e,frontendInfo:t,message:n})),c.onFrontendErrorCallback(e,t,n))}),onFrontendSuccess:freeOnUnref(function(e){c.onFrontendSuccessCallback&&(c.log.info("onFrontendSuccessCallback "+JSON.stringify({frontendInfo:e})),c.onFrontendSuccessCallback(e))}),onStreamingError:freeOnUnref(function(e,t){c.onStreamingErrorCallback&&(c.log.info("onStreamingErrorCallback "+JSON.stringify({code:e,message:t})),c.onStreamingErrorCallback(e,t))}),onError:freeOnUnref(function(e,t){c.onErrorCallback&&(c.log.info("onErrorCallback "+JSON.stringify({code:e,description:t})),c.onErrorCallback(e,t))}),onErrorRetry:freeOnUnref(function(e,t,n){c.onErrorRetryCallback&&(c.log.info("onErrorRetryCallback "+JSON.stringify({code:e,description:t,retryAfterMillis:n})),c.onErrorRetryCallback(e,t,n))}),onStateChange:freeOnUnref(function(e,t){t===Ss.SyePlayerState.kStalled&&c.reportBeginStallMetrics(),e===Ss.SyePlayerState.kStalled&&c.reportEndStallMetrics(),c.onStateChangeCallback&&(c.log.info("onStateChangeCallback "+JSON.stringify({fromState:e,toState:t})),c.onStateChangeCallback(e,t))}),onEgressAllocated:freeOnUnref(function(e){if(c.onEgressAllocatedCallback){var t={allocationTimeMillis:e};c.log.info("onEgressAllocatedCallback "+JSON.stringify({event:t})),c.onEgressAllocatedCallback(t)}}),onEgressContact:freeOnUnref(function(e){if(c.onEgressContactCallback){var t={timeToResponseMillis:e};c.log.info("onEgressContactCallback "+JSON.stringify({event:t})),c.onEgressContactCallback(t)}}),onTimeToFirstFrame:freeOnUnref(function(e,t){if(c.onTimeToFirstFrameCallback){var n={timeToFirstFrameMillis:e,totalTimeToFirstFrameMillis:t};c.log.info("onTimeToFirstFrameCallback "+JSON.stringify({event:n})),c.onTimeToFirstFrameCallback(n)}}),onStopInternal:freeOnUnref(function(){}),onOffset:freeOnUnref(function(e){}),onAvailableAudioTracks:freeOnUnref(function(e){c.onAvailableAudioTracksCallback&&(c.log.info("onAvailableAudioTracksCallback "+JSON.stringify({audioTracks:e})),c.onAvailableAudioTracksCallback(e)),c.onAudioTracksCallback&&c.onAudioTracksCallback(e)}),onAudioStreamChange:freeOnUnref(function(e){1===c.metadataMonitor.onAudioMetadataChange(e)&&(c.scpPlayer.ReportError("kUnsupportedAudioFormat","Audio metadata change not supported"),c.mpbRestartRequired=!0),c.onAudioStreamChangeCallback&&(c.log.info("onAudioStreamChangeCallback "+JSON.stringify({info:e})),c.onAudioStreamChangeCallback(e))}),onAudioSample:freeOnUnref(function(e){if(c.playbackState!==Ks.PlaybackState.STOPPED){if(c.metricsLogger.updateAudioReceiverMargin((e.localTimeMicros-ks.scpApi.GetLocalTimeMicros())/1e3),!c.syncHandler.isAudioMetadataCached()){var t=e.audioCodec,n="";t===Ss.SyeAudioCodec.kAAC?n="AUDIO_CODEC_AAC":t===Ss.SyeAudioCodec.kEC3&&(n="AUDIO_CODEC_EAC3"),c.syncHandler.cacheAudioMetadata({codec:n,samplerate:e.samplerate,numChannels:e.numChannels})}c.syncHandler.syncAudioSample(e,c.playbackState)}}),onAvailableVideoTracks:freeOnUnref(function(e){}),onVideoStreamChange:freeOnUnref(function(e){1===c.metadataMonitor.onVideoMetadataChange(e)&&(c.scpPlayer.ReportError("kUnsupportedVideoFormat","Video metadata change not supported"),c.mpbRestartRequired=!0),c.onVideoStreamChangeCallback&&(c.log.info("onVideoStreamChangeCallback "+JSON.stringify({info:e})),c.onVideoStreamChangeCallback(e))}),onVideoSample:freeOnUnref(function(e){if(c.playbackState!==Ks.PlaybackState.STOPPED){if(c.metricsLogger.updateVideoReceiverMargin((e.localTimeMicros-ks.scpApi.GetLocalTimeMicros())/1e3),c.mayReportDroppedFrames(1e3*ks.scpApi.GetLocalTimeMicros()),!c.syncHandler.isVideoMetadataCached()){var t=c.mpbPlayer.GetScreenWidth(),n=c.mpbPlayer.GetScreenHeight(),r=e.videoCodec,i=e.framerateNum/e.framerateDen,o="";r===Ss.SyeVideoCodec.kH264?o="VIDEO_CODEC_AVC":r===Ss.SyeVideoCodec.kHEVC&&(o="VIDEO_CODEC_HEVC");var a=e.width,s=e.height,l=0,f=0,u=a/s;a/s<t/n?l=(f=n)*u:f=(l=t)/u,c.syncHandler.cacheVideoMetadata({codec:o,width:l,height:f,framerate:i})}c.syncHandler.syncVideoSample(e,c.playbackState)}}),onNotificationMessage:freeOnUnref(function(e,t,n){if(c.onNotificationMessageCallback){var r={messageType:e,localTimeMicros:t,data:n};c.log.info("onNotificationMessageCallback "+JSON.stringify({message:{messageType:e,localTimeMicros:t,data:n.length}})),c.onNotificationMessageCallback(r)}}),onAvailableClosedCaptionsChannels:freeOnUnref(function(e){c.onAvailableClosedCaptionsChannelsCallback&&(c.log.info("onAvailableClosedCaptionsChannelsCallback "+JSON.stringify({channelIndexes:e})),c.onAvailableClosedCaptionsChannelsCallback(e))}),onAvailableClosedCaptionsServices:freeOnUnref(function(e){c.onAvailableClosedCaptionsServicesCallback&&(c.log.info("onAvailableClosedCaptionsServicesCallback "+JSON.stringify({serviceIndexes:e})),c.onAvailableClosedCaptionsServicesCallback(e))}),onCEA708:freeOnUnref(function(e){if(0!==e.length&&0!==c.timelineStartUtc){var t=JSON.parse(e).localDisplayTime;if(2e5<t-ks.scpApi.GetLocalTimeMicros())c.log.info("CC is received too early");else if(null!==c.previousCCTimestamp&&c.previousCCTimestamp>t)c.log.info("CC is out of order.");else{var n=Math.round(c.getUtcTimeMicros(t)/1e3);if(0!==n){var r=n-c.getPresentationDelayMillis()-c.distanceToLive-c.timelineStartUtc,i=r+1e4;if(!(r<0)&&(c.previousCCTimestamp=t,c.onClosedCaptionsUpdateCallback)){var o=r+c.timelineStartUtc,a=i+c.timelineStartUtc,s=zs.transformTTML(e,r,i);c.onClosedCaptionsUpdateCallback(o,a,c.timelineStartUtc,s)}}}}}),onTimelineUpdate:freeOnUnref(function(e){try{c.onTimelineUpdateCallback&&(0===c.timelineStartUtc&&(c.timelineStartUtc=e.currentPosUtcMillis,c.distanceToLive=e.livePosUtcMillis-e.currentPosUtcMillis),c.onTimelineUpdateCallback(e))}catch(e){c.log.warn("onTimelineUpdate: "+e)}})}}),e.prototype.prepareForPlayAttempt=freeOnUnref(function(){this.playbackState!==Ks.PlaybackState.STOPPED&&(null!==this.syeMetricHandler&&this.playbackState!==Ks.PlaybackState.PAUSED&&this.syeMetricHandler.changePlaybackState(Ws.PlaybackMetricState.PLAYBACK_STOPPED),this.scpPlayer.Stop(),this.previousCCTimestamp=null,this.stopMediaPipelineBackend()),this.mpbRestartRequired&&(this.mpbPlayer.PlaybackShutdown(),this.mpbPlayer.PlaybackInit(this.mpbConfiguration),this.syncHandler.discardMetadata(),this.metadataMonitor.reset(),this.mpbRestartRequired=!1)}),e.prototype.pollMetrics=freeOnUnref(function(){var e=this;null!==this.clientPollTimerId&&(oe.timer.clearInterval(this.clientPollTimerId),this.clientPollTimerId=null),this.clientPollTimerId=oe.timer.setInterval(freeOnUnref(function(){null!==e.syeMetricHandler&&e.syeMetricHandler.poll()}),1e3)}),e.prototype.startPollers=freeOnUnref(function(){this.pollMetrics(),this.scpPlayer.StartCheckingForCallbacks(),this.mpbPlayer.StartPolling(),this.pollStopped=!1,this.startScpPoll(0)}),e.prototype.stopPollers=freeOnUnref(function(){null!==this.clientPollTimerId&&(oe.timer.clearInterval(this.clientPollTimerId),this.clientPollTimerId=null),this.pollStopped=!0,this.scpPlayer.StopCheckingForCallbacks(),this.mpbPlayer.StopPolling()}),e.prototype.teardown=freeOnUnref(function(){this.previousCCTimestamp=null,this.stopPollers(),this.metricsLogger.teardown(),this.scpPlayer.Teardown(),this.mpbPlayer.PlaybackShutdown(),this.mpbPlayer.Teardown()}),e})(),s=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t})(a);t.SyePlayerMPBv2=s;var l=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t})(a);t.SyePlayerMPBv3=l}));e(Xs);Xs.SyePlayerMPBv2,Xs.SyePlayerMPBv3;var Ys=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.log=e,this.audioSpeedUpFramesCoarse=1,this.audioSlowDownFramesCoarse=1,this.syncCallbacks=null,this.audioMetadata=null,this.videoMetadata=null,this.lastAudioDurationNano=0,this.lastAudioPtsNano=0,this.audioFramesToSlowDownFine=0,this.audioFramesToSlowDownCoarse=0,this.audioFramesToSpeedUpFine=0,this.audioFramesToSpeedUpCoarse=0,this.lastVideoMpbPtsNano=0,this.lastVideoDeviceClockPtsNano=0,this.tracking=!1,this.currentAdjustment=0,this.lastAdjustChangeTime=0,this.newAdjustment=0,this.lastSentIdrpts=0,this.seekTimeInFutureNano=0,this.seekTimeComputed=!1,this.videoReady=!1,this.audioReady=!1,this.seekDone=!1,this.timeProvider=t,this.syncParameters=n,this.log.info("Fine adjustments support: {AAC: "+n.IsFineGrainAACAdjustmentsSupported+",EC3: "+n.IsFineGrainEC3AdjustmentsSupported+"}"),this.log.info("Supports intra-chunk seeking: "+n.SupportsIntraChunkSeeking+", seekDelayNano: "+n.SeekDelayNano),this.log.info("Handle mode: "+n.HandleMode),this.log.info("DecodeOnlyFix: "+n.DecodeOnlyFix),this.log.info("PlayAfterSeek: "+n.PlayAfterSeek)}return e.prototype.RegisterCallbacks=freeOnUnref(function(e){this.syncCallbacks=e}),e.prototype.refreshAdjustment=freeOnUnref(function(e,t){if(2===this.syncParameters.HandleMode){var n=e-t;(n-this.currentAdjustment>this.syncParameters.VideoAdjustmentChangeThreshold||n-this.currentAdjustment<-this.syncParameters.VideoAdjustmentChangeThreshold)&&!this.tracking&&(this.newAdjustment=n,this.tracking=!0),(0===this.lastAdjustChangeTime||t-this.lastAdjustChangeTime>this.syncParameters.VideoAdjustmentChangeFreetime)&&this.tracking&&(this.currentAdjustment<this.newAdjustment-this.syncParameters.VideoAdjustmentChangeNano&&0<=this.currentAdjustment?(this.currentAdjustment=this.currentAdjustment+this.syncParameters.VideoAdjustmentChangeNano,this.lastAdjustChangeTime=t):this.currentAdjustment>this.newAdjustment+this.syncParameters.VideoAdjustmentChangeNano&&0<=this.currentAdjustment?(this.currentAdjustment=this.currentAdjustment-this.syncParameters.VideoAdjustmentChangeNano,this.lastAdjustChangeTime=t):this.currentAdjustment>this.newAdjustment+this.syncParameters.VideoAdjustmentChangeNano&&this.currentAdjustment<=0?(this.currentAdjustment=this.currentAdjustment-this.syncParameters.VideoAdjustmentChangeNano,this.lastAdjustChangeTime=t):this.currentAdjustment<this.newAdjustment-this.syncParameters.VideoAdjustmentChangeNano&&this.currentAdjustment<=0?(this.currentAdjustment=this.currentAdjustment+this.syncParameters.VideoAdjustmentChangeNano,this.lastAdjustChangeTime=t):this.tracking=!1)}}),e.prototype.syncVideoSample=freeOnUnref(function(e,t){if(null!==this.syncCallbacks)if(null!==this.videoMetadata){this.processVideoMetadata(),this.computeSeekTime(e),this.readyToSeek()&&(this.seekDone=!0,this.syncCallbacks.onReadyToSeek(this.seekTimeInFutureNano));var n=this.timeProvider.getPlaybackTimeNano(),r=1e3*this.timeProvider.getLocalTimeMicros(),i=1e3*e.localTimeMicros,o=t===Ks.PlaybackState.PLAYING?i+n-r:i,a=0;e.decodeOnly&&t===Ks.PlaybackState.PLAYING&&this.syncParameters.DecodeOnlyFix?a=this.lastSentIdrpts:e.decodeOnly&&t===Ks.PlaybackState.PLAYING?a=0:t===Ks.PlaybackState.PLAYING?(this.refreshAdjustment(n,r),a=i+this.getAdjustment(n,r)):a=this.lastVideoMpbPtsNano+i-this.lastVideoDeviceClockPtsNano,this.lastVideoMpbPtsNano=a,this.lastVideoDeviceClockPtsNano=i,e.isIDRFrame&&(this.lastSentIdrpts=a),this.syncCallbacks.onVideoSampleSynced(e,a,o)}else this.log.warn("trying to sync a video sample before caching video metadata");else this.log.warn("trying to sync a video sample before registering callbacks")}),e.prototype.getAdjustment=freeOnUnref(function(e,t){return 1===this.syncParameters.HandleMode?e-t:2===this.syncParameters.HandleMode?this.currentAdjustment:0}),e.prototype.computeSeekTime=freeOnUnref(function(e){if(!this.seekTimeComputed){var t=1e3*this.timeProvider.getLocalTimeMicros(),n=1e3*e.localTimeMicros;this.syncParameters.SupportsIntraChunkSeeking&&t+this.syncParameters.SeekDelayNano>n?this.seekTimeInFutureNano=t+this.syncParameters.SeekDelayNano:this.seekTimeInFutureNano=n,this.seekTimeComputed=!0}}),e.prototype.isFineGrainAdjustmentsSupported=freeOnUnref(function(){return!("AUDIO_CODEC_AAC"!==this.audioMetadata.codec||!this.syncParameters.IsFineGrainAACAdjustmentsSupported)||!("AUDIO_CODEC_EAC3"!==this.audioMetadata.codec||!this.syncParameters.IsFineGrainEC3AdjustmentsSupported)}),e.prototype.computeAudioSync=freeOnUnref(function(e,t){var n=e-t;0===this.audioFramesToSpeedUpFine&&0===this.audioFramesToSlowDownFine&&0===this.audioFramesToSpeedUpCoarse&&0===this.audioFramesToSlowDownCoarse&&(n<-this.syncParameters.AudioSlowDownThresholdCoarse?this.audioFramesToSlowDownCoarse=this.audioSlowDownFramesCoarse:n<-this.syncParameters.AudioSlowDownThresholdFine&&this.isFineGrainAdjustmentsSupported()?this.audioFramesToSlowDownFine=this.syncParameters.AudioSlowDownFramesFine:n<-this.syncParameters.AudioSlowDownThresholdFine&&!this.isFineGrainAdjustmentsSupported()?this.audioFramesToSlowDownCoarse=this.audioSlowDownFramesCoarse:n>this.syncParameters.AudioSpeedUpThresholdCoarse?this.audioFramesToSpeedUpCoarse=this.audioSpeedUpFramesCoarse:n>this.syncParameters.AudioSpeedUpThresholdFine&&this.isFineGrainAdjustmentsSupported()?this.audioFramesToSpeedUpFine=this.syncParameters.AudioSpeedUpFramesFine:n>this.syncParameters.AudioSpeedUpThresholdFine&&!this.isFineGrainAdjustmentsSupported()&&(this.audioFramesToSpeedUpCoarse=this.audioSpeedUpFramesCoarse))}),e.prototype.processVideoMetadata=freeOnUnref(function(){null===this.syncCallbacks||this.videoReady||null===this.videoMetadata||(this.videoReady=!0,this.syncCallbacks.onVideoMetadata(this.videoMetadata))}),e.prototype.processAudioMetadata=freeOnUnref(function(){null===this.syncCallbacks||this.audioReady||null===this.audioMetadata||(this.audioReady=!0,this.syncCallbacks.onAudioMetadata(this.audioMetadata))}),e.prototype.discardMetadata=freeOnUnref(function(){this.audioReady=!1,this.videoReady=!1,this.audioMetadata=null,this.videoMetadata=null}),e.prototype.isSeekDone=freeOnUnref(function(){return!this.syncParameters.PlayAfterSeek||this.seekDone}),e.prototype.cacheAudioMetadata=freeOnUnref(function(e){this.audioMetadata=e}),e.prototype.cacheVideoMetadata=freeOnUnref(function(e){this.videoMetadata=e}),e.prototype.reset=freeOnUnref(function(){this.lastVideoMpbPtsNano=0,this.lastVideoDeviceClockPtsNano=0,this.lastAudioPtsNano=0,this.audioFramesToSpeedUpFine=0,this.audioFramesToSlowDownFine=0,this.audioFramesToSpeedUpCoarse=0,this.audioFramesToSlowDownCoarse=0,this.tracking=!1,this.lastAdjustChangeTime=0,this.currentAdjustment=0,this.newAdjustment=0,this.seekTimeComputed=!1,this.seekDone=!1}),e.prototype.syncAudioSample=freeOnUnref(function(e,t){if(null!==this.syncCallbacks)if(null!==this.audioMetadata){this.processAudioMetadata(),this.readyToSeek()&&(this.seekDone=!0,this.syncCallbacks.onReadyToSeek(this.seekTimeInFutureNano));var n=this.timeProvider.getPlaybackTimeNano(),r=1e3*this.timeProvider.getLocalTimeMicros(),i=1e3*e.localTimeMicros,o=t===Ks.PlaybackState.PLAYING?i+n-r:i,a=0,s=1e9*e.duration/e.timescale,l=s;if(0===this.lastAudioPtsNano)a=i;else if(t!==Ks.PlaybackState.PLAYING)a=this.lastAudioPtsNano+this.lastAudioDurationNano;else{a=this.lastAudioPtsNano+this.lastAudioDurationNano;var f=i+this.getAdjustment(n,r);this.computeAudioSync(a,f)}if(0<this.audioFramesToSlowDownFine)l+=this.syncParameters.AudioSlowDownNano,--this.audioFramesToSlowDownFine,this.syncCallbacks.onAudioSlowDownFineAdjustment();else if(0<this.audioFramesToSlowDownCoarse)this.syncCallbacks.onAudioSampleSynced(e,s,l,a,o),--this.audioFramesToSlowDownCoarse,this.syncCallbacks.onAudioSlowDownCoarseAdjustment(),this.log.info("Duplicating audio AU, PTS:",a,"duration:",l,"fineGrainAdjustmentsSupported:",this.isFineGrainAdjustmentsSupported()),a+=l;else if(0<this.audioFramesToSpeedUpFine)l-=this.syncParameters.AudioSpeedUpNano,--this.audioFramesToSpeedUpFine,this.syncCallbacks.onAudioSpeedUpFineAdjustment();else if(0<this.audioFramesToSpeedUpCoarse)return--this.audioFramesToSpeedUpCoarse,this.syncCallbacks.onAudioSpeedUpCoarseAdjustment(),void this.log.info("Dropping audio AU, PTS:",a,"duration:",l,"fineGrainAdjustmentsSupported:",this.isFineGrainAdjustmentsSupported());this.lastAudioPtsNano=a,this.lastAudioDurationNano=l,this.syncCallbacks.onAudioSampleSynced(e,s,l,a,o)}else this.log.warn("trying to sync a audio sample before caching audio metadata");else this.log.warn("trying to sync an audio sample before registering callbacks")}),e.prototype.readyToSeek=freeOnUnref(function(){return this.videoReady&&this.audioReady&&!this.seekDone&&this.seekTimeComputed}),e.prototype.isAudioMetadataCached=freeOnUnref(function(){return null!==this.audioMetadata}),e.prototype.isVideoMetadataCached=freeOnUnref(function(){return null!==this.videoMetadata}),e})();t.SyeSyncHandler=n}));e(Ys);Ys.SyeSyncHandler;var Js=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.findFirstIndex=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1}}));e(Js);Js.findFirstIndex;var Zs=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.log=e,this.alignCallbacks=null,this.audioMetadata=null,this.videoMetadata=null,this.seekTimeInFutureNano=0,this.videoReady=!1,this.audioReady=!1,this.seekDone=!1,this.bufferAudio=!0,this.bufferVideo=!0,this.audioBuffer=[],this.videoBuffer=[],this.timeProvider=t,this.alignParameters=n}return e.prototype.RegisterCallbacks=freeOnUnref(function(e){this.alignCallbacks=e}),e.prototype.alignVideoSample=freeOnUnref(function(e,t){null!==this.alignCallbacks?null!==this.videoMetadata?(this.processVideoMetadata(),this.bufferVideo?this.videoBuffer.push(e):this.alignCallbacks.onVideoSampleReady(e,t),this.readyToSeek()&&this.computeSeekTime()&&(this.seekDone=!0,this.alignCallbacks.onReadyToSeek(this.seekTimeInFutureNano),this.burstBuffers(t),this.bufferAudio=!1,this.bufferVideo=!1)):this.log.warn("trying to sync a video sample before caching video metadata"):this.log.warn("trying to sync a video sample before registering callbacks")}),e.prototype.computeSeekTime=freeOnUnref(function(){if(0===this.audioBuffer.length||0===this.videoBuffer.length)return this.log.error("Trying to compute seek time without any audio or video buffered. Should not happen"),!1;for(var r=this.timeProvider.getLocalTimeMicros()+this.alignParameters.RendererDelayNano/1e3,e=freeOnUnref(function(t){if(t.isIDRFrame&&t.localTimeMicros>=r){var e=i.audioBuffer.some(freeOnUnref(function(e){return e.localTimeMicros<=t.localTimeMicros})),n=i.audioBuffer.some(freeOnUnref(function(e){return e.localTimeMicros>=t.localTimeMicros}));if(e&&n)return i.seekTimeInFutureNano=1e3*t.localTimeMicros,i.log.info("Seek time computed. Seek time is "+i.seekTimeInFutureNano+" and current time is "+1e3*i.timeProvider.getLocalTimeMicros()),{value:!0}}}),i=this,t=0,n=this.videoBuffer;t<n.length;t++){var o=e(n[t]);if("object"==typeof o)return o.value}return!1}),e.prototype.processVideoMetadata=freeOnUnref(function(){null===this.alignCallbacks||this.videoReady||null===this.videoMetadata||(this.videoReady=!0,this.alignCallbacks.onVideoMetadata(this.videoMetadata))}),e.prototype.processAudioMetadata=freeOnUnref(function(){null===this.alignCallbacks||this.audioReady||null===this.audioMetadata||(this.audioReady=!0,this.alignCallbacks.onAudioMetadata(this.audioMetadata))}),e.prototype.discardMetadata=freeOnUnref(function(){this.audioReady=!1,this.videoReady=!1,this.audioMetadata=null,this.videoMetadata=null}),e.prototype.cacheAudioMetadata=freeOnUnref(function(e){this.audioMetadata=e}),e.prototype.cacheVideoMetadata=freeOnUnref(function(e){this.videoMetadata=e}),e.prototype.reset=freeOnUnref(function(){this.seekDone=!1,this.bufferVideo=!0,this.bufferAudio=!0,this.clearBuffers()}),e.prototype.clearBuffers=freeOnUnref(function(){this.audioBuffer=[],this.videoBuffer=[]}),e.prototype.burstBuffers=freeOnUnref(function(e){if(null!==this.alignCallbacks){var t=this.seekTimeInFutureNano/1e3,n=Js.findFirstIndex(this.videoBuffer,freeOnUnref(function(e){return e.localTimeMicros>=t})),r=Js.findFirstIndex(this.audioBuffer,freeOnUnref(function(e){return e.localTimeMicros>=t}));if(-1===r||-1===n)return this.log.error("No samples found after seek time"),void this.clearBuffers();this.log.info("Bursting buffers with audio starting from "+this.audioBuffer[r].localTimeMicros+" and video starting from "+this.videoBuffer[n].localTimeMicros+" with seek time "+t),this.audioBuffer[r].localTimeMicros=t,this.log.info("After adjustment - Audio starts at: "+this.audioBuffer[r].localTimeMicros+", Video starts at: "+this.videoBuffer[n].localTimeMicros);for(var i=r;i<this.audioBuffer.length;i++)this.alignCallbacks.onAudioSampleReady(this.audioBuffer[i],e);for(i=n;i<this.videoBuffer.length;i++)this.videoBuffer[i].localTimeMicros>=t&&this.alignCallbacks.onVideoSampleReady(this.videoBuffer[i],e);this.clearBuffers()}else this.log.warn("trying to sync an audio sample before registering callbacks")}),e.prototype.alignAudioSample=freeOnUnref(function(e,t){null!==this.alignCallbacks?null!==this.audioMetadata?(this.processAudioMetadata(),this.bufferAudio?this.audioBuffer.push(e):this.alignCallbacks.onAudioSampleReady(e,t),this.readyToSeek()&&this.computeSeekTime()&&(this.seekDone=!0,this.alignCallbacks.onReadyToSeek(this.seekTimeInFutureNano),this.burstBuffers(t),this.bufferAudio=!1,this.bufferVideo=!1)):this.log.warn("trying to sync a audio sample before caching audio metadata"):this.log.warn("trying to sync an audio sample before registering callbacks")}),e.prototype.readyToSeek=freeOnUnref(function(){return this.videoReady&&this.audioReady&&this.bufferAudio&&this.bufferVideo&&!this.seekDone}),e.prototype.isAudioMetadataCached=freeOnUnref(function(){return null!==this.audioMetadata}),e.prototype.isVideoMetadataCached=freeOnUnref(function(){return null!==this.videoMetadata}),e})();t.SampleAligner=n}));e(Zs);Zs.SampleAligner;var $s=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function t(e){this.currentReferenceTime=-1,this.currentPlaybackTime=0,this.timeProvider=e}return t.prototype.getReferenceTimeKey=freeOnUnref(function(e){return Math.floor(e/t.DEFAULT_SAMPLING_INTERVAL_NS)*t.DEFAULT_SAMPLING_INTERVAL_NS}),t.prototype.getInterpolatedPlaybackTime=freeOnUnref(function(e){var t=this.getReferenceTimeKey(e);if(t>this.currentReferenceTime){var n=this.timeProvider.getPlaybackTimeNano();this.currentReferenceTime=t;var r=Math.max(0,e-t);this.currentPlaybackTime=n-r}var i=e-this.currentReferenceTime;return this.currentPlaybackTime+i}),t.prototype.reset=freeOnUnref(function(){this.currentReferenceTime=-1,this.currentPlaybackTime=0}),t.DEFAULT_SAMPLING_INTERVAL_NS=1e8,t})();t.PlaybackTimeInterpolator=n}));e($s);$s.PlaybackTimeInterpolator;var el=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r){this.log=e,this.audioSpeedUpFramesCoarse=1,this.audioSlowDownFramesCoarse=1,this.syncCallbacks=null,this.lastAudioDurationNano=0,this.lastAudioPtsNano=0,this.audioFramesToSlowDownCoarse=0,this.audioFramesToSpeedUpCoarse=0,this.lastVideoMpbPtsNano=0,this.lastVideoDeviceClockPtsNano=0,this.tracking=!1,this.currentAdjustment=0,this.lastAdjustChangeTime=0,this.newAdjustment=0,this.lastSentIdrpts=0,this.timeProvider=t,this.syncParameters=n,this.sampleAligner=r,this.timeInterpolator=new $s.PlaybackTimeInterpolator(t)}return e.prototype.syncVideoSampleImpl=freeOnUnref(function(e,t){if(null!==this.syncCallbacks){var n=1e3*this.timeProvider.getLocalTimeMicros(),r=this.timeInterpolator.getInterpolatedPlaybackTime(n),i=1e3*e.localTimeMicros,o=t===Ks.PlaybackState.PLAYING?i+r-n:i,a=0;e.decodeOnly&&t===Ks.PlaybackState.PLAYING&&this.syncParameters.DecodeOnlyFix?a=this.lastSentIdrpts:e.decodeOnly&&t===Ks.PlaybackState.PLAYING?a=0:t===Ks.PlaybackState.PLAYING?(this.refreshAdjustment(r,n),a=i+this.getAdjustment(r,n)):a=this.lastVideoMpbPtsNano+i-this.lastVideoDeviceClockPtsNano,this.lastVideoMpbPtsNano=a,this.lastVideoDeviceClockPtsNano=i,e.isIDRFrame&&(this.lastSentIdrpts=a),this.syncCallbacks.onVideoSampleSynced(e,a,o)}else this.log.warn("trying to sync a video sample before registering callbacks")}),e.prototype.syncAudioSampleImpl=freeOnUnref(function(e,t){if(null!==this.syncCallbacks){var n=1e3*this.timeProvider.getLocalTimeMicros(),r=this.timeInterpolator.getInterpolatedPlaybackTime(n),i=1e3*e.localTimeMicros,o=t===Ks.PlaybackState.PLAYING?i+r-n:i,a=0,s=1e9*e.duration/e.timescale,l=s;if(0===this.lastAudioPtsNano)a=i;else if(t!==Ks.PlaybackState.PLAYING)a=this.lastAudioPtsNano+this.lastAudioDurationNano;else{a=this.lastAudioPtsNano+this.lastAudioDurationNano;var f=i+this.getAdjustment(r,n);this.computeAudioSync(a,f)}if(0<this.audioFramesToSlowDownCoarse)this.syncCallbacks.onAudioSampleSynced(e,s,s,a,o),--this.audioFramesToSlowDownCoarse,this.syncCallbacks.onAudioSlowDownCoarseAdjustment(),this.log.info("Duplicating audio AU, PTS:",a,"duration:",l),a+=l;else if(0<this.audioFramesToSpeedUpCoarse)return--this.audioFramesToSpeedUpCoarse,this.syncCallbacks.onAudioSpeedUpCoarseAdjustment(),void this.log.info("Dropping audio AU, PTS:",a,"duration:",l);this.lastAudioPtsNano=a,this.lastAudioDurationNano=l,this.syncCallbacks.onAudioSampleSynced(e,s,s,a,o)}else this.log.warn("trying to sync an audio sample before registering callbacks")}),e.prototype.RegisterCallbacks=freeOnUnref(function(t){var n=this;this.syncCallbacks=t,this.sampleAligner.RegisterCallbacks({onReadyToSeek:freeOnUnref(function(e){t.onReadyToSeek(e)}),onVideoMetadata:freeOnUnref(function(e){t.onVideoMetadata(e)}),onAudioMetadata:freeOnUnref(function(e){t.onAudioMetadata(e)}),onAudioSampleReady:freeOnUnref(function(e,t){n.syncAudioSampleImpl(e,t)}),onVideoSampleReady:freeOnUnref(function(e,t){n.syncVideoSampleImpl(e,t)})})}),e.prototype.refreshAdjustment=freeOnUnref(function(e,t){if(2===this.syncParameters.HandleMode){var n=e-t;(n-this.currentAdjustment>this.syncParameters.VideoAdjustmentChangeThreshold||n-this.currentAdjustment<-this.syncParameters.VideoAdjustmentChangeThreshold)&&!this.tracking&&(this.newAdjustment=n,this.tracking=!0),(0===this.lastAdjustChangeTime||t-this.lastAdjustChangeTime>this.syncParameters.VideoAdjustmentChangeFreetime)&&this.tracking&&(this.currentAdjustment<this.newAdjustment-this.syncParameters.VideoAdjustmentChangeNano&&0<=this.currentAdjustment?(this.currentAdjustment=this.currentAdjustment+this.syncParameters.VideoAdjustmentChangeNano,this.lastAdjustChangeTime=t):this.currentAdjustment>this.newAdjustment+this.syncParameters.VideoAdjustmentChangeNano&&0<=this.currentAdjustment?(this.currentAdjustment=this.currentAdjustment-this.syncParameters.VideoAdjustmentChangeNano,this.lastAdjustChangeTime=t):this.currentAdjustment>this.newAdjustment+this.syncParameters.VideoAdjustmentChangeNano&&this.currentAdjustment<=0?(this.currentAdjustment=this.currentAdjustment-this.syncParameters.VideoAdjustmentChangeNano,this.lastAdjustChangeTime=t):this.currentAdjustment<this.newAdjustment-this.syncParameters.VideoAdjustmentChangeNano&&this.currentAdjustment<=0?(this.currentAdjustment=this.currentAdjustment+this.syncParameters.VideoAdjustmentChangeNano,this.lastAdjustChangeTime=t):this.tracking=!1)}}),e.prototype.syncVideoSample=freeOnUnref(function(e,t){this.sampleAligner.alignVideoSample(e,t)}),e.prototype.getAdjustment=freeOnUnref(function(e,t){return 1===this.syncParameters.HandleMode?e-t:2===this.syncParameters.HandleMode?this.currentAdjustment:0}),e.prototype.computeAudioSync=freeOnUnref(function(e,t){var n=e-t;0===this.audioFramesToSpeedUpCoarse&&0===this.audioFramesToSlowDownCoarse&&(n<-this.syncParameters.AudioSlowDownThresholdCoarse?this.audioFramesToSlowDownCoarse=this.audioSlowDownFramesCoarse:n>this.syncParameters.AudioSpeedUpThresholdCoarse&&(this.audioFramesToSpeedUpCoarse=this.audioSpeedUpFramesCoarse))}),e.prototype.reset=freeOnUnref(function(){this.sampleAligner.reset(),this.lastVideoMpbPtsNano=0,this.lastVideoDeviceClockPtsNano=0,this.lastAudioPtsNano=0,this.audioFramesToSpeedUpCoarse=0,this.audioFramesToSlowDownCoarse=0,this.tracking=!1,this.lastAdjustChangeTime=0,this.currentAdjustment=0,this.newAdjustment=0,this.timeInterpolator.reset()}),e.prototype.syncAudioSample=freeOnUnref(function(e,t){this.sampleAligner.alignAudioSample(e,t)}),e.prototype.cacheAudioMetadata=freeOnUnref(function(e){this.sampleAligner.cacheAudioMetadata(e)}),e.prototype.cacheVideoMetadata=freeOnUnref(function(e){this.sampleAligner.cacheVideoMetadata(e)}),e.prototype.isAudioMetadataCached=freeOnUnref(function(){return this.sampleAligner.isAudioMetadataCached()}),e.prototype.isVideoMetadataCached=freeOnUnref(function(){return this.sampleAligner.isVideoMetadataCached()}),e.prototype.discardMetadata=freeOnUnref(function(){this.sampleAligner.discardMetadata()}),e.prototype.isSeekDone=freeOnUnref(function(){return!0}),e})();t.SyeSyncHandlerMpbV3=n}));e(el);el.SyeSyncHandlerMpbV3;var tl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.lastAudioPtsNano=-1/0,this.lastAudioDurationNano=0,this.audioFramesToSlowDownCoarse=0,this.audioFramesToSpeedUpCoarse=0,this.speedUpThresholdNano=e.speedUpThresholdNano,this.slowDownThresholdNano=e.slowDownThresholdNano}return e.prototype.reset=freeOnUnref(function(){this.lastAudioPtsNano=-1/0,this.lastAudioDurationNano=0,this.audioFramesToSlowDownCoarse=0,this.audioFramesToSpeedUpCoarse=0}),e.prototype.getLastAudioPts=freeOnUnref(function(){return this.lastAudioPtsNano}),e.prototype.getLastAudioDuration=freeOnUnref(function(){return this.lastAudioDurationNano}),e.prototype.updateAudioPts=freeOnUnref(function(e,t){this.lastAudioPtsNano=e,this.lastAudioDurationNano=t}),e.prototype.calculateAudioPts=freeOnUnref(function(e){return this.lastAudioPtsNano===-1/0?e:this.lastAudioPtsNano+this.lastAudioDurationNano}),e.prototype.computeAudioSync=freeOnUnref(function(e,t){if(!this.audioFramesToSpeedUpCoarse&&!this.audioFramesToSlowDownCoarse){var n=e-t;n<-this.slowDownThresholdNano?this.audioFramesToSlowDownCoarse=1:n>this.speedUpThresholdNano&&(this.audioFramesToSpeedUpCoarse=1)}}),e.prototype.shouldProcessDuplication=freeOnUnref(function(){return 0<this.audioFramesToSlowDownCoarse}),e.prototype.shouldProcessDrop=freeOnUnref(function(){return 0<this.audioFramesToSpeedUpCoarse}),e.prototype.consumeDuplication=freeOnUnref(function(){this.audioFramesToSlowDownCoarse=0}),e.prototype.consumeDrop=freeOnUnref(function(){this.audioFramesToSpeedUpCoarse=0}),e.prototype.hasPendingAdjustments=freeOnUnref(function(){return!(!this.audioFramesToSlowDownCoarse&&!this.audioFramesToSpeedUpCoarse)}),e.prototype.calculateDuration=freeOnUnref(function(e){return 1e9*e.duration/e.timescale}),e})();t.AudioSyncStrategy=n}));e(tl);tl.AudioSyncStrategy;var nl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.lastVideoMpbPtsNano=0,this.lastVideoDeviceClockPtsNano=0,this.lastSentIdrPts=0}return e.prototype.reset=freeOnUnref(function(){this.lastVideoMpbPtsNano=0,this.lastVideoDeviceClockPtsNano=0,this.lastSentIdrPts=0}),e.prototype.getLastVideoMpbPts=freeOnUnref(function(){return this.lastVideoMpbPtsNano}),e.prototype.getLastVideoDeviceClockPts=freeOnUnref(function(){return this.lastVideoDeviceClockPtsNano}),e.prototype.getLastSentIdrPts=freeOnUnref(function(){return this.lastSentIdrPts}),e.prototype.calculateVideoPts=freeOnUnref(function(e,t,n,r){var i=0;return e.decodeOnly&&r===Ks.PlaybackState.PLAYING?i=this.lastSentIdrPts:(i=r===Ks.PlaybackState.PLAYING?t+n:this.lastVideoMpbPtsNano+t-this.lastVideoDeviceClockPtsNano,this.lastVideoMpbPtsNano=i,this.lastVideoDeviceClockPtsNano=t),e.isIDRFrame&&(this.lastSentIdrPts=i),i}),e.prototype.calculatePlaybackPtsSyncNano=freeOnUnref(function(e,t,n,r){return r===Ks.PlaybackState.PLAYING?e+t-n:e}),e})();t.VideoSyncStrategy=n}));e(nl);nl.VideoSyncStrategy;var rl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.log=e,this.config=t,this.tracking=!1,this.currentAdjustment=0,this.lastAdjustChangeTime=-1/0,this.newAdjustment=0}return e.prototype.reset=freeOnUnref(function(){this.tracking=!1,this.currentAdjustment=0,this.lastAdjustChangeTime=-1/0,this.newAdjustment=0}),e.prototype.getCurrentAdjustment=freeOnUnref(function(){return this.currentAdjustment}),e.prototype.getNewAdjustment=freeOnUnref(function(){return this.newAdjustment}),e.prototype.isTracking=freeOnUnref(function(){return this.tracking}),e.prototype.refreshAdjustment=freeOnUnref(function(e,t){var n=e-t;(n-this.currentAdjustment>this.config.videoAdjustmentChangeThreshold||n-this.currentAdjustment<-this.config.videoAdjustmentChangeThreshold)&&!this.tracking&&(this.newAdjustment=n,this.tracking=!0,this.log.info("Started tracking adjustment: current="+this.currentAdjustment/1e6+"ms, target="+this.newAdjustment/1e6+"ms")),t-this.lastAdjustChangeTime>this.config.videoAdjustmentChangeFreetime&&this.tracking&&this.updateAdjustment(t)}),e.prototype.updateAdjustment=freeOnUnref(function(e){var t=this.config.videoAdjustmentChangeNano;this.currentAdjustment;this.currentAdjustment<this.newAdjustment-t&&0<=this.currentAdjustment?(this.currentAdjustment+=t,this.lastAdjustChangeTime=e):this.currentAdjustment>this.newAdjustment+t&&0<=this.currentAdjustment?(this.currentAdjustment-=t,this.lastAdjustChangeTime=e):this.currentAdjustment>this.newAdjustment+t&&this.currentAdjustment<=0?(this.currentAdjustment-=t,this.lastAdjustChangeTime=e):this.currentAdjustment<this.newAdjustment-t&&this.currentAdjustment<=0&&(this.currentAdjustment+=t,this.lastAdjustChangeTime=e),Math.abs(this.currentAdjustment-this.newAdjustment)<=t&&(this.tracking=!1,this.log.info("Adjustment tracking complete: final="+this.currentAdjustment/1e6+"ms"))}),e.prototype.getAdjustment=freeOnUnref(function(){return this.currentAdjustment}),e})();t.AdjustmentTracker=n}));e(rl);rl.AdjustmentTracker;var il=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r){this.log=e,this.syncCallbacks=null,this.timeProvider=t,this.sampleAligner=r,this.timeInterpolator=new $s.PlaybackTimeInterpolator(t),this.audioStrategy=new tl.AudioSyncStrategy({speedUpThresholdNano:n.AudioSpeedUpThresholdCoarse,slowDownThresholdNano:n.AudioSlowDownThresholdCoarse}),this.videoStrategy=new nl.VideoSyncStrategy,this.adjustmentTracker=new rl.AdjustmentTracker(this.log,{videoAdjustmentChangeNano:n.VideoAdjustmentChangeNano,videoAdjustmentChangeThreshold:n.VideoAdjustmentChangeThreshold,videoAdjustmentChangeFreetime:n.VideoAdjustmentChangeFreetime})}return e.prototype.syncVideoSampleImpl=freeOnUnref(function(e,t){if(null!==this.syncCallbacks){var n=1e3*this.timeProvider.getLocalTimeMicros(),r=this.timeInterpolator.getInterpolatedPlaybackTime(n),i=1e3*e.localTimeMicros,o=this.videoStrategy.calculatePlaybackPtsSyncNano(i,r,n,t);t!==Ks.PlaybackState.PLAYING||e.decodeOnly||this.adjustmentTracker.refreshAdjustment(r,n);var a=this.adjustmentTracker.getAdjustment(),s=this.videoStrategy.calculateVideoPts(e,i,a,t);this.syncCallbacks.onVideoSampleSynced(e,s,o)}else this.log.warn("trying to sync a video sample before registering callbacks")}),e.prototype.syncAudioSampleImpl=freeOnUnref(function(e,t){if(null!==this.syncCallbacks){var n=1e3*this.timeProvider.getLocalTimeMicros(),r=this.timeInterpolator.getInterpolatedPlaybackTime(n),i=1e3*e.localTimeMicros,o=t===Ks.PlaybackState.PLAYING?i+r-n:i,a=this.audioStrategy.calculateDuration(e),s=this.audioStrategy.calculateAudioPts(i);if(t===Ks.PlaybackState.PLAYING){var l=i+this.adjustmentTracker.getAdjustment();this.audioStrategy.computeAudioSync(s,l)}if(this.audioStrategy.shouldProcessDuplication())this.syncCallbacks.onAudioSampleSynced(e,a,a,s,o),this.audioStrategy.consumeDuplication(),this.syncCallbacks.onAudioSlowDownCoarseAdjustment(),this.log.info("Duplicating audio AU, PTS:",s,"duration:",a),s+=a;else if(this.audioStrategy.shouldProcessDrop())return this.audioStrategy.consumeDrop(),this.syncCallbacks.onAudioSpeedUpCoarseAdjustment(),void this.log.info("Dropping audio AU, PTS:",s,"duration:",a);this.audioStrategy.updateAudioPts(s,a),this.syncCallbacks.onAudioSampleSynced(e,a,a,s,o)}else this.log.warn("trying to sync an audio sample before registering callbacks")}),e.prototype.RegisterCallbacks=freeOnUnref(function(t){var n=this;this.syncCallbacks=t,this.sampleAligner.RegisterCallbacks({onReadyToSeek:freeOnUnref(function(e){t.onReadyToSeek(e)}),onVideoMetadata:freeOnUnref(function(e){t.onVideoMetadata(e)}),onAudioMetadata:freeOnUnref(function(e){t.onAudioMetadata(e)}),onAudioSampleReady:freeOnUnref(function(e,t){n.syncAudioSampleImpl(e,t)}),onVideoSampleReady:freeOnUnref(function(e,t){n.syncVideoSampleImpl(e,t)})})}),e.prototype.reset=freeOnUnref(function(){this.sampleAligner.reset(),this.audioStrategy.reset(),this.videoStrategy.reset(),this.adjustmentTracker.reset(),this.timeInterpolator.reset()}),e.prototype.syncVideoSample=freeOnUnref(function(e,t){this.sampleAligner.alignVideoSample(e,t)}),e.prototype.syncAudioSample=freeOnUnref(function(e,t){this.sampleAligner.alignAudioSample(e,t)}),e.prototype.cacheAudioMetadata=freeOnUnref(function(e){this.sampleAligner.cacheAudioMetadata(e)}),e.prototype.cacheVideoMetadata=freeOnUnref(function(e){this.sampleAligner.cacheVideoMetadata(e)}),e.prototype.isAudioMetadataCached=freeOnUnref(function(){return this.sampleAligner.isAudioMetadataCached()}),e.prototype.isVideoMetadataCached=freeOnUnref(function(){return this.sampleAligner.isVideoMetadataCached()}),e.prototype.discardMetadata=freeOnUnref(function(){this.sampleAligner.discardMetadata()}),e.prototype.isSeekDone=freeOnUnref(function(){return!0}),e})();t.SyeSyncHandlerV2MpbV3=n}));e(il);il.SyeSyncHandlerV2MpbV3;var ol=t(freeOnUnref(function(e,A){var D=ce&&ce.__assign||freeOnUnref(function(){return(D=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(A,"__esModule",{value:!0}),function(e){for(var t in e)A.hasOwnProperty(t)||(A[t]=e[t])}(Ss),A.gSyePlayerConfig=new Ss.SyePlayerConfig;var r=new Hs.SyeSession("1.0.0");A.gSyePlayerConfig.videoSampleDequeueMarginMillis=1500,A.gSyePlayerConfig.audioSampleDequeueMarginMillis=1500;var x=15e8,F=0,B=1e6,L=40,N=4e7,V=8e7,j=1e6,q=40,H=4e7,z=8e7,W=!0,K=1e10,G=1e10,Q=5e6,X=4e7,Y=1e8,J=2,Z=!1,$=!1,ee=1e8,te=4e7,ne=!0,re=!0,ie="",oe=2,ae=!1,se=!1,le={},fe=!1,ue=1;A.IsSyeSupported=function(e,t){oe=qs.getMpbVersionFromModel(e,t),Z=qs.getDecodeOnlyFixEnabled(e,t),$=qs.getV3PictureModeSetEnabled(e,t);var n=qs.validateModelSupported(e,t);return ks.scpApi.IsSyeSupported(e)&&n};var i=!(A.IsThumbnailsSupported=function(){return!0});function t(){return"1.0.0"}A.Setup=function(e){var t=de.get("LiveLowLatencySDKUnf");if(!i){var n=JSON.stringify(e);if(t.info("Input DIS configuration: "+n),void 0!==n){var r=JSON.parse(n);void 0!==r.rendererDelayNano&&(F=r.rendererDelayNano),void 0!==r.seekDelayNano&&(x=r.seekDelayNano),void 0!==r.audioSpeedUpThresholdCoarse&&(V=r.audioSpeedUpThresholdCoarse),void 0!==r.audioSlowDownThresholdCoarse&&(z=r.audioSlowDownThresholdCoarse),void 0!==r.videoAdjustmentChangeNano&&(Q=r.videoAdjustmentChangeNano),void 0!==r.videoAdjustmentChangeThreshold&&(X=r.videoAdjustmentChangeThreshold),void 0!==r.videoAdjustmentChangeFreetime&&(Y=r.videoAdjustmentChangeFreetime),void 0!==r.handleMode&&(J=r.handleMode),void 0!==r.mpbConfiguration&&(ie=JSON.stringify(r.mpbConfiguration)),void 0!==r.mpbConfiguration&&(ae=r.resizeAfterStop),void 0!==r.useClockMonitor&&(se=r.useClockMonitor),void 0!==r.clockMonitorConfig&&(le=r.clockMonitorConfig),void 0!==r.volumeFeatureEnabled&&(fe=r.volumeFeatureEnabled),void 0!==r.mpbV3SyncHandlerVersion&&(ue=r.mpbV3SyncHandlerVersion,t.info("MPBv3 Sync Handler Version set to: "+ue))}return i=!0,ks.scpApi.Setup(e)}return lt.Promise.resolve()},A.SetVideoLimitations=function(e){de.get("LiveLowLatencySDKUnf").info("SetVideoLimitations: "+JSON.stringify(e)),ks.scpApi.SetVideoLimitations(e)},A.FetchChannels=function(e,t,n){if(void 0===t)throw new TypeError("Channel success callback function must be set");if(void 0===n)throw new TypeError("Error callback function must be set");r.onListChannelsSuccess=t,r.onListChannelsError=n,r.fetchChannels(e)},A.CreatePlayer=function(e,t,n,r,i,o,a){var s,l,f,u,c,d,p,h,m,y,g,v,O,S,U,b,P,M,C,E,T,w,I,k=null!=(s=a)&&s instanceof Ka.ScopedJSLogger?s:new Ka.ScopedJSLogger,_=k.get("LiveLowLatencySDKUnf"),R=void 0;return _.info("Creating SyePlayer instance with Domains: "+JSON.stringify(e.getDomains())),2===oe&&js.SupportsMPBv2()?(_.info("Using MPB version 2"),S=_,U=k,b=ks.scpApi.CreatePlayer(e,A.gSyePlayerConfig,!1),P=n,M=r,C=void 0,E=o,T=ks.scpApi.SupportsFeature("PlaybackInitCallback"),w=js.CreateV2Player(U,K,G,T,ae,se,C,E,le),I=new Ys.SyeSyncHandler(S,{getLocalTimeMicros:freeOnUnref(function(){return ks.scpApi.GetLocalTimeMicros()}),getPlaybackTimeNano:freeOnUnref(function(){return w.GetPlaybackTime()})},{AudioSpeedUpNano:B,AudioSpeedUpFramesFine:L,AudioSpeedUpThresholdFine:N,AudioSpeedUpThresholdCoarse:V,AudioSlowDownNano:j,AudioSlowDownFramesFine:q,AudioSlowDownThresholdFine:H,AudioSlowDownThresholdCoarse:z,VideoAdjustmentChangeNano:Q,VideoAdjustmentChangeThreshold:X,VideoAdjustmentChangeFreetime:Y,IsFineGrainEC3AdjustmentsSupported:!1,IsFineGrainAACAdjustmentsSupported:!1,HandleMode:J,DecodeOnlyFix:Z,SupportsIntraChunkSeeking:ks.scpApi.SupportsCapability("IntraChunkSeeking"),SeekDelayNano:x,PlayAfterSeek:ne}),R=new Xs.SyePlayerMPBv2(S,b,w,I,P,M,ee,te,ie,W,fe)):js.SupportsMPBv3()&&ks.scpApi.SupportsFeature("ExternalBuffers")?(_.info("Using MPB version 3"),l=_,f=k,u=ks.scpApi.CreatePlayer(e,A.gSyePlayerConfig,!0),c=n,d=r,p=i,h=o,y=js.CreateV3Player(f,F,se,re,p,le,$?h:[]),g=new Zs.SampleAligner(l,{getLocalTimeMicros:freeOnUnref(function(){return ks.scpApi.GetLocalTimeMicros()})},{RendererDelayNano:F}),v={getLocalTimeMicros:freeOnUnref(function(){return ks.scpApi.GetLocalTimeMicros()}),getPlaybackTimeNano:freeOnUnref(function(){return y.GetPlaybackTime()})},O={AudioSpeedUpThresholdCoarse:V,AudioSlowDownThresholdCoarse:z,VideoAdjustmentChangeNano:Q,VideoAdjustmentChangeThreshold:X,VideoAdjustmentChangeFreetime:Y,DecodeOnlyFix:Z},2===ue?(l.info("Creating MPBv3 Sync Handler V2"),m=new il.SyeSyncHandlerV2MpbV3(l,v,O,g)):(l.info("Creating MPBv3 Sync Handler V1 (original)"),m=new el.SyeSyncHandlerMpbV3(l,v,D({},O,{HandleMode:J}),g)),R=new Xs.SyePlayerMPBv3(l,u,y,m,c,d,ee,te,ie,W,fe)):_.error("Neither MPBv2 or MPBv3 are supported on the device."),R},A.syncTimeMicros=function(){return ks.scpApi.GetLocalTimeMicros()},A.ProtocolVersion=function(){return r.ProtocolVersion()},A.SyePlayerStateToString=function(e){switch(e){case Ss.SyePlayerState.kStopped:return"Stopped";case Ss.SyePlayerState.kLoading:return"Loading";case Ss.SyePlayerState.kPlaying:return"Playing";case Ss.SyePlayerState.kStalled:return"Stalled";case Ss.SyePlayerState.kAIS:return"AIS";case Ss.SyePlayerState.kError:return"Error";default:return"unknown"}},A.SdkVersion=t}));e(ol);ol.gSyePlayerConfig,ol.IsSyeSupported,ol.IsThumbnailsSupported,ol.Setup,ol.SetVideoLimitations,ol.FetchChannels,ol.CreatePlayer,ol.syncTimeMicros,ol.ProtocolVersion,ol.SyePlayerStateToString,ol.SdkVersion;var al=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SyeClient=ol}));e(al);al.SyeClient;var sl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.isLiveLowLatencySupported=freeOnUnref(function(){return this.isPlatformCapable()}),e.prototype.isPlatformCapable=freeOnUnref(function(){var e=zt.deviceInformation,t=al.SyeClient;return void 0!==e&&void 0!==e.hardware&&void 0!==e.hardware.model&&null!=L.configurationStore&&null!=L.configurationStore.configuration&&void 0!==L.configurationStore.configuration.device?t.IsSyeSupported(L.configurationStore.configuration.device.syeConfig,{modelName:e.hardware.model.name}):null!=L.configurationStore&&null!=L.configurationStore.configuration&&void 0!==L.configurationStore.configuration.device?t.IsSyeSupported(L.configurationStore.configuration.device.syeConfig):t.IsSyeSupported()}),e.prototype.isUdpFallbackDisabled=freeOnUnref(function(){return!1}),e})();t.LiveLowLatencyContextUnf=n}));e(sl);sl.LiveLowLatencyContextUnf;var ll=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("LiveLowLatencyLoaderUnf"),n=freeOnUnref(function(){function e(){}return e.prototype.load=freeOnUnref(function(e,n){var t=al.SyeClient,r={};if(null!==L.configurationStore&&null!==L.configurationStore.configuration&&void 0!==L.configurationStore.configuration.device){var i=L.configurationStore.configuration.device.syeConfig;null!=i&&(r=i)}t.Setup(r).then(freeOnUnref(function(){e(al.SyeClient)})).catch(freeOnUnref(function(e){var t=e.message||String(e);o.error("Initializing of Live Low Latency SDK failed: "+t),n("LiveLowLatencyInitializationError",t,!0)}))}),e})();t.LiveLowLatencyLoaderUnf=n}));e(ll);ll.LiveLowLatencyLoaderUnf;var fl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=new sl.LiveLowLatencyContextUnf;t.liveLowLatencyContext=n;var r=new ll.LiveLowLatencyLoaderUnf;t.liveLowLatencyLoader=r}));e(fl);fl.liveLowLatencyContext,fl.liveLowLatencyLoader;var ul=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.multicastCallback=new A.MulticastCallback}return e.prototype.updateTimelineInfo=freeOnUnref(function(e){this.timelineInfo=e,this.multicastCallback.invoke()}),e.prototype.onAvailable=freeOnUnref(function(e){this.multicastCallback.add(e)}),e.prototype.offAvailable=freeOnUnref(function(e){this.multicastCallback.remove(e)}),Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){return 0}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){var e=this.timelineInfo;return null==e?Date.now():e.livePosUtcMillis}),enumerable:!0,configurable:!0}),e.prototype.isUpdating=freeOnUnref(function(){return!0}),e})();t.LiveLowLatencyTimeWindow=n}));e(ul);ul.LiveLowLatencyTimeWindow;var cl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("LiveLowLatencySeekPreview"),n=freeOnUnref(function(){function e(){var t=this;this.seekPreviewState=null,this.monitorContext=null,this.syePlayer=null,this.eventDurationMs=null,this.eventStartTimeMs=null,this.timeWindow=null,this.lastKnownThumbnailDurationMs=null,this.onTimelineInfoUpdate=freeOnUnref(function(){if(null!=t.monitorContext&&null!=t.monitorContext.timelineInfo){var e=.9<=t.monitorContext.timelineInfo.thumbnailFillRate?"Ready":"Waiting";e!==t.seekPreviewState&&(t.seekPreviewState=e,t.eventEmitter.emit("seekPreviewStateChange",t.seekPreviewState))}}),this.eventEmitter=new A.EventEmitter}return e.prototype.setCachingInfo=freeOnUnref(function(e,t,n){this.eventStartTimeMs=e,this.timeWindow=t,null!=n&&(this.eventDurationMs=1e3*n)}),e.prototype.start=freeOnUnref(function(e,t,n){var r=L.configurationStore.configuration;if(null!=r&&null!=r.liveLowLatency){var i=r.liveLowLatency;if(!1===i.enableLiveTrickplay)return void s.info(">> disabled by configuration");if(null!=i.trickplayModelNameAllowlist){var o=zt.deviceInformation.hardware.model;if(null==o||null==o.name||-1===i.trickplayModelNameAllowlist.indexOf(o.name))return void s.info(">> disabled by configuration: model not allowlisted")}}if(t.IsThumbnailsSupported())if(null!=this.eventStartTimeMs&&null!=this.timeWindow){s.info(">> start"),this.syePlayer=e,this.monitorContext=n,this.seekPreviewState="Waiting",this.eventEmitter.emit("seekPreviewExists"),this.monitorContext.mpPlayerEventEmitter.on("timeupdate",this.onTimelineInfoUpdate);var a=null==this.eventDurationMs?54e6:this.eventDurationMs+72e5;this.syePlayer.cacheThumbnailsForInterval(this.eventStartTimeMs,this.eventStartTimeMs+a)}else s.info("LiveLowLatencySeekPreview has not been configured correctly.");else s.info("Sye API does not support thumbnails.")}),e.prototype.stop=freeOnUnref(function(){null==this.syePlayer&&null==this.monitorContext||(s.info(">> stop"),this.syePlayer=null,(this.lastKnownThumbnailDurationMs=null)!=this.monitorContext&&(this.monitorContext.mpPlayerEventEmitter.off("timeupdate",this.onTimelineInfoUpdate),this.monitorContext=null),this.eventEmitter.emitSync("revokeSeekPreview"),"Ready"===this.seekPreviewState&&(this.seekPreviewState="Waiting",this.eventEmitter.emitSync("seekPreviewStateChange",this.seekPreviewState)))}),e.prototype.getTileAt=freeOnUnref(function(e){return null==this.syePlayer?null:this.getSyeThumbnailAtPosition(e)}),e.prototype.getTilesInRange=freeOnUnref(function(e,t){if(null==this.syePlayer||null==this.timeWindow||null==this.eventStartTimeMs)return[];var n=[],r=Math.max(e,this.eventStartTimeMs);if((t=Math.min(t,this.timeWindow.endMs))<=e)return[];for(;r<t;){var i;null!=(i=this.getSyeThumbnailAtPosition(r,n))&&(n.push(i),r=i.endTimeMs),r+=(null!=this.lastKnownThumbnailDurationMs?this.lastKnownThumbnailDurationMs:1e4)/2}(0===n.length||n[n.length-1].endTimeMs<t)&&(null!=(i=this.getSyeThumbnailAtPosition(t,n))&&i.startTimeMs<=t&&n.push(i));return n}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.getSyeThumbnailAtPosition=freeOnUnref(function(e,t){if(null==this.syePlayer)return null;var n=this.syePlayer.getThumbnail(e),r=this.syeThumbnailToSeekPreviewTile(n);return null!=r&&(null==t||0===t.length||r.endTimeMs>t[t.length-1].endTimeMs)?(this.lastKnownThumbnailDurationMs=r.tileConfig.thumbnailDurationMs,r):null}),e.prototype.syeThumbnailToSeekPreviewTile=freeOnUnref(function(e){if(null==e)return null;var t,n=e.data;return t=n instanceof Uint8Array?n.buffer.slice(n.byteOffset,n.byteLength+n.byteOffset):n,{startTimeMs:e.thumbnailStartUtcTimeMillis,endTimeMs:e.thumbnailStartUtcTimeMillis+e.thumbnailDurationMillis,presentationTimeOffsetMs:0,data:t,tileConfig:{mimeType:e.mimeType,streamType:"Image",thumbnailHeight:e.height,thumbnailWidth:e.width,tileHeight:1,tileWidth:1,thumbnailDurationMs:e.thumbnailDurationMillis}}}),e})();t.LiveLowLatencySeekPreview=n}));e(cl);cl.LiveLowLatencySeekPreview;var dl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("LiveLowLatencyContentSource"),r=freeOnUnref(function(){function e(e,t,n){this.maxVideoBitrateBps=1/0,this.maxVideoHeightPixels=0,this.streamSelector=null,this.unsupportedAudioCodecs=[],this.getStatistics=freeOnUnref(function(){return null}),this.getBitstreamInfo=freeOnUnref(function(){return null}),this.sourceUrlStore=e,this.seekPreview=new cl.LiveLowLatencySeekPreview,this.vcid=t,this.availabilityTimeWindow=new ul.LiveLowLatencyTimeWindow,this.eventEmitter=new A.EventEmitter,this.suggestedPictureModes=n,this.diagnostics=nn.Diagnostics.create("LiveLowLatencyContentSource")}return Object.defineProperty(e.prototype,"sourceUrlGetter",{get:freeOnUnref(function(){return this.sourceUrlStore}),enumerable:!0,configurable:!0}),e.prototype.flush=freeOnUnref(function(){}),e.prototype.wallClockUtcTimeToContentTime=freeOnUnref(function(e){return e}),e.prototype.getLicense=freeOnUnref(function(e,t,n){return lt.Promise.resolve()}),e.prototype.isEncrypted=freeOnUnref(function(){return lt.Promise.resolve(!1)}),e.prototype.setStreamMatchers=freeOnUnref(function(e,t,n){null!==this.streamSelector&&(n&&this.diagnostics.report("seamlessSwitchLatency",{switchStartTimeMs:Date.now()}),this.streamSelector.setStreamMatchers(e,t))}),e.prototype.setMaxBitrateThreshold=freeOnUnref(function(e,t,n){"Video"===e&&"ExternalNetwork"===t&&(this.maxVideoBitrateBps=n)}),e.prototype.setFrontBufferSize=freeOnUnref(function(e){}),e.prototype.setMaxResolution=freeOnUnref(function(e,t){t<0?n.warn("Tried setting max resolution height to "+t+", ignoring request"):(this.maxVideoHeightPixels=t,null!==this.streamSelector&&this.streamSelector.setMaxResolution(t))}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(e,t){"Audio"===e&&(this.unsupportedAudioCodecs=t,null!==this.streamSelector&&this.streamSelector.setUnsupportedCodecs(t))}),e.prototype.start=freeOnUnref(function(e){}),e.prototype.stop=freeOnUnref(function(){}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e})();t.LiveLowLatencyContentSource=r}));e(dl);dl.LiveLowLatencyContentSource;var pl=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.Restart="Restart",e.Resume="Resume",e.Terminate="Terminate"})(n||(n={})),t.SyeUrlStoreErrorHandlerResult=n}));e(pl);pl.SyeUrlStoreErrorHandlerResult;var hl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var y=de.get("FiniteStateMachine"),n=freeOnUnref(function(){function e(e){var m=this;this.illegalTransitionCallbacks=[],this.handlingUncaughtException=!1,this.actionMap=[],this.stateEnterHandlers=[],this.stateLeaveHandlers=[],this.stateReenterHandlers=[],this.executeAction=freeOnUnref(function(e,t){var n=m.findTransition(m.currentState,e);if(null!=n){m.currentState=n.toState;var r=void 0,i=void 0;n.fromState!==n.toState?(r=m.stateLeaveHandlers.filter(freeOnUnref(function(e){return e.state===n.fromState})),i=m.stateEnterHandlers.filter(freeOnUnref(function(e){return e.state===n.toState}))):i=m.stateReenterHandlers.filter(freeOnUnref(function(e){return e.state===n.fromState}));try{if(null!=r)for(var o=0,a=r;o<a.length;o++){a[o].handler()}for(var s=0,l=n.handlers;s<l.length;s++){(0,l[s])(t)}if(null!=i)for(var f=0,u=i;f<u.length;f++){u[f].handler()}n.fromState!==n.toState&&m.stateChangeHandlers.invokeSync(m.currentState)}catch(e){if(m.handlingUncaughtException)return y.error("Unhandled exception while handling exception:",e),void(m.handlingUncaughtException=!1);m.handlingUncaughtException=!0;var c=m.uncaughtExceptionHandler(e);return void(null!=c&&m.act(c,e))}m.handlingUncaughtException=!1}else for(var d=0,p=m.illegalTransitionCallbacks;d<p.length;d++){var h=p[d];try{h(m.currentState,e,t)}catch(e){y.error("Error when calling an illegal transition callback",e)}}}),this.currentState=e,this.uncaughtExceptionHandler=freeOnUnref(function(e){throw e}),this.stateChangeHandlers=new A.MulticastCallback,this.timer=oe.timer}return e.prototype.onIllegalTransition=freeOnUnref(function(e){this.illegalTransitionCallbacks.push(e)}),e.prototype.onUncaughtException=freeOnUnref(function(e){this.uncaughtExceptionHandler=e}),e.prototype.addTransition=freeOnUnref(function(e,t,n){if(null!=this.findTransition(e,t))throw new Error("Transition already exists from state "+e+" with action "+t);this.actionMap.push({fromState:e,action:t,toState:n,handlers:[]})}),e.prototype.onEnterState=freeOnUnref(function(e,t){this.stateEnterHandlers.push({state:e,handler:t})}),e.prototype.onLeaveState=freeOnUnref(function(e,t){this.stateLeaveHandlers.push({state:e,handler:t})}),e.prototype.onReenterState=freeOnUnref(function(e,t){this.stateReenterHandlers.push({state:e,handler:t})}),e.prototype.onTransition=freeOnUnref(function(e,t,n){var r=this.findTransition(e,t);if(null==r)throw new Error("No transition exists from state "+e+" with action "+t);r.handlers.push(n)}),e.prototype.onStateChange=freeOnUnref(function(e){this.stateChangeHandlers.add(e),e(this.currentState)}),Object.defineProperty(e.prototype,"state",{get:freeOnUnref(function(){return this.currentState}),enumerable:!0,configurable:!0}),e.prototype.act=freeOnUnref(function(e,t){var n=this;this.timer.setImmediate(freeOnUnref(function(){n.executeAction(e,t)}))}),e.prototype.actNow=freeOnUnref(function(e,t){this.executeAction(e,t)}),e.prototype.findTransition=freeOnUnref(function(t,n){return x.find(this.actionMap,freeOnUnref(function(e){return e.fromState===t&&e.action===n}))}),e})();t.FiniteStateMachine=n}));e(hl);hl.FiniteStateMachine;var ml=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.FiniteStateMachine=hl.FiniteStateMachine}));e(ml);ml.FiniteStateMachine;var yl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.monitorContext=e,this.SyeClientSDK=e.SyeClientSDK,this.syePlayer=e.syePlayer,this.mpPlayerEventEmitter=e.mpPlayerEventEmitter,this.internalEventEmitter=e.internalEventEmitter,this.contentSourceEventEmitter=e.contentSourceEventEmitter}return e.prototype.initialize=freeOnUnref(function(){}),e.prototype.uninitialize=freeOnUnref(function(){}),e.prototype.onFrontendFailover=freeOnUnref(function(){}),e})();t.Monitor=n}));e(yl);yl.Monitor;var gl=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.initialize=freeOnUnref(function(){var t=this;this.syePlayer.onAvailableAudioTracksCallback=freeOnUnref(function(e){return t.onAvailableAudioTracksCallback(e)}),this.syePlayer.onAudioStreamChangeCallback=freeOnUnref(function(){return t.onAudioStreamChangeCallback()})}),t.prototype.uninitialize=freeOnUnref(function(){this.syePlayer.onAvailableAudioTracksCallback=null}),t.prototype.onAvailableAudioTracksCallback=freeOnUnref(function(e){this.monitorContext.audioTracksArray=e,this.monitorContext.streamSelector.onAvailableAudioTracksCallback(e)}),t.prototype.onAudioStreamChangeCallback=freeOnUnref(function(){this.monitorContext.streamSelector.onAudioStreamChangeCallback()}),t})(yl.Monitor);t.AudioTrackMonitor=r}));e(gl);gl.AudioTrackMonitor;var vl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.UseSingleCCEnabled=!0,e.EgressContactTimeThresholdInMs=1500,e.StatisticsNotificationIntervalInMs=5e3,e.LocaleAndDisplayNameOverrideMap={eng:"English",aua:"Storm - Kremer",aub:"Scout’s Feed",spa:"Spanish"},e})();t.LiveLowLatencyConfigurations=n}));e(vl);vl.LiveLowLatencyConfigurations;var Ol=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.useSingleCCEnabled=vl.LiveLowLatencyConfigurations.UseSingleCCEnabled,e}return n(e,t),e.prototype.initialize=freeOnUnref(function(){var i=this;this.syePlayer.onAvailableClosedCaptionsChannelsCallback=freeOnUnref(function(e){return i.onAvailableClosedCaptionsChannelsCallback(e)}),this.syePlayer.onAvailableClosedCaptionsServicesCallback=freeOnUnref(function(e){return i.onAvailableClosedCaptionsServicesCallback(e)}),this.syePlayer.onClosedCaptionsUpdateCallback=freeOnUnref(function(e,t,n,r){return i.onClosedCaptionsUpdateCallback(e,t,n,r)})}),e.prototype.uninitialize=freeOnUnref(function(){this.syePlayer.onAvailableClosedCaptionsChannelsCallback=null,this.syePlayer.onAvailableClosedCaptionsServicesCallback=null,this.syePlayer.onClosedCaptionsUpdateCallback=null}),e.prototype.onAvailableClosedCaptionsChannelsCallback=freeOnUnref(function(e){this.useSingleCCEnabled&&1<=e.length?this.monitorContext.channelIndexes=e.slice(0,1):this.monitorContext.channelIndexes=e,this.monitorContext.textTrack.closedCaptionsUpdated(),this.monitorContext.streamSelector.onAvailableClosedCaptionsChannelsCallback(this.monitorContext.channelIndexes)}),e.prototype.onAvailableClosedCaptionsServicesCallback=freeOnUnref(function(e){this.monitorContext.channelServices=e,this.monitorContext.textTrack.closedCaptionsUpdated()}),e.prototype.onClosedCaptionsUpdateCallback=freeOnUnref(function(e,t,n,r){this.monitorContext.streamSelector.closedCaptionsEnabled()&&this.monitorContext.textTrack.emitCue({data:r,startMs:e,endMs:t,timeOffsetMs:n})}),e})(yl.Monitor);t.ClosedCaptionMonitor=r}));e(Ol);Ol.ClosedCaptionMonitor;var Sl=t(freeOnUnref(function(e,t){function s(e){return"k"+e}Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function i(){}return i.getUDPTimeoutError=freeOnUnref(function(){return new ct.XpError("sye.udp_timeout","SyeFallbackUDPBlockedStartStream","Sye fallback - UDP block detected")}),i.getExcessiveWaitingError=freeOnUnref(function(e){return new ct.XpError("sye.excessive_waiting","SyeFallbackMidStream",e)}),i.getFrontendError=freeOnUnref(function(e,t,n){return new ct.XpError("SyeFailoverFrontendStartStream",void 0,"["+s(e)+"]["+t+"]["+n.domainName+"]")}),i.getStreamingError=freeOnUnref(function(e,t){return new ct.XpError(s(e),void 0,t)}),i.getBaseRetryError=freeOnUnref(function(e,t,n,r,i){var o,a=new ct.XpError(e,void 0,"["+s(t)+"]["+n+"][mode: "+(null==(o=i)?"":o.playbackType===Ss.SyePlaybackType.kLive?"live":"timeshift")+"]");return a.stack="retryAfter: "+r,a}),i.getRetryError=freeOnUnref(function(e,t,n,r){return i.getBaseRetryError("SyeRetryMidStream",e,t,n,r)}),i.getFailedRetryError=freeOnUnref(function(e,t,n,r){return i.getBaseRetryError("SyeFailoverMidStream",e,t,n,r)}),i.getStartupFailoverError=freeOnUnref(function(e,t,n){return new ct.XpError(s(e),void 0,"["+t+"]["+n+"]")}),i.getMidstreamFailoverError=freeOnUnref(function(e,t){return new ct.XpError("SyeFailoverMidStream",void 0,"["+s(e)+"]["+t+"]")}),i})();t.LiveLowLatencyErrors=n}));e(Sl);Sl.LiveLowLatencyErrors;var Ul=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("ErrorMonitor"),r=freeOnUnref(function(o){function e(e,t,n,r){var i=o.call(this,e)||this;return i.syeFallbackErrorHistory=[],i.sourceUrlStore=t,i.triggerFrontendFailover=n,i.maxMidstreamRetryTimeoutMs=r,i}return n(e,o),e.prototype.initialize=freeOnUnref(function(){var r=this;this.syePlayer.onErrorCallback=freeOnUnref(function(e,t){return r.onErrorCallback(e,t)}),this.syePlayer.onErrorRetryCallback=freeOnUnref(function(e,t,n){return r.onErrorRetryCallback(e,t,n)}),this.syePlayer.onFrontendErrorCallback=freeOnUnref(function(e,t,n){return r.onFrontendErrorCallback(e,t,n)}),this.syePlayer.onStreamingErrorCallback=freeOnUnref(function(e,t){return r.onStreamingErrorCallback(e,t)})}),e.prototype.uninitialize=freeOnUnref(function(){this.clearFallbackErrorHistory(),this.syePlayer.onErrorCallback=null,this.syePlayer.onErrorRetryCallback=null,this.syePlayer.onFrontendErrorCallback=null,this.syePlayer.onStreamingErrorCallback=null}),e.prototype.onErrorCallback=freeOnUnref(function(e,t){var n=ct.Errors.newError(e,t);this.monitorContext.syeError=n;var r,i=this.sourceUrlStore.get().channelId;if(e===this.SyeClientSDK.SyePlayerError.kTimeshiftOutOfRange)return a.info("[onErrorCallback] Invoking syePlayer.playFromLive due to kTimeshiftOutOfRange error"),void this.syePlayer.playFromLive(i);r=this.monitorContext.playbackStarted?Sl.LiveLowLatencyErrors.getMidstreamFailoverError(e,t):Sl.LiveLowLatencyErrors.getStartupFailoverError(e,t,this.sourceUrlStore.get().cdn),this.monitorContext.contentSourceEventEmitter.emit("nonFatalError",r),this.triggerFrontendFailover(n)}),e.prototype.onErrorRetryCallback=freeOnUnref(function(e,t,n){var r=ct.Errors.newError(e,t);if(this.monitorContext.syeError=r,a.info("Retrying after "+n+"ms with player error:",r),n>this.maxMidstreamRetryTimeoutMs)return this.contentSourceEventEmitter.emit("nonFatalError",Sl.LiveLowLatencyErrors.getFailedRetryError(e,t,n,this.monitorContext.timelineInfo)),void this.triggerFrontendFailover(r);this.contentSourceEventEmitter.emit("nonFatalError",Sl.LiveLowLatencyErrors.getRetryError(e,t,n,this.monitorContext.timelineInfo)),this.attemptResumingPlaybackForPlayerAfter(n)}),e.prototype.onFrontendErrorCallback=freeOnUnref(function(e,t,n){this.monitorContext.playbackStarted||(this.syeFallbackErrorHistory.push(e),this.contentSourceEventEmitter.emit("nonFatalError",Sl.LiveLowLatencyErrors.getFrontendError(e,n,t)))}),e.prototype.onStreamingErrorCallback=freeOnUnref(function(e,t){this.monitorContext.playbackStarted&&(this.syeFallbackErrorHistory.push(e),this.contentSourceEventEmitter.emit("nonFatalError",Sl.LiveLowLatencyErrors.getStreamingError(e,t)))}),e.prototype.attemptResumingPlaybackForPlayerAfter=freeOnUnref(function(e){var t=this;oe.timer.setTimeout(freeOnUnref(function(){t.syePlayer.playerState()===t.SyeClientSDK.SyePlayerState.kError?(a.info("[attemptResumingPlaybackForPlayerAfter] Invoking syePlayer.playResume"),t.syePlayer.playResume()):a.info("Skipping retry - Player no longer in an error state.")}),e)}),e.prototype.clearFallbackErrorHistory=freeOnUnref(function(){this.syeFallbackErrorHistory=[]}),e.prototype.getFallbackErrorHistory=freeOnUnref(function(){return this.syeFallbackErrorHistory}),e})(yl.Monitor);t.ErrorMonitor=r}));e(Ul);Ul.ErrorMonitor;var bl=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});de.get("MetricsMonitor");var n=freeOnUnref(function(n){function e(e){var t=n.call(this,e)||this;return t.onMetricsCallback=freeOnUnref(function(e,t,n){q.metrics.putMetric("LiveLowLatency."+e,t,n)}),t}return r(e,n),e.prototype.initialize=freeOnUnref(function(){this.syePlayer.onMetricsCallback=this.onMetricsCallback}),e.prototype.uninitialize=freeOnUnref(function(){this.syePlayer.onMetricsCallback=null}),e})(yl.Monitor);t.MetricsMonitor=n}));e(bl);bl.MetricsMonitor;var Pl=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("NotificationMonitor"),r=freeOnUnref(function(i){function e(e,t,n){var r=i.call(this,e)||this;return r.triggerEndOfStream=t,r.vcid=n,r}return n(e,i),e.prototype.initialize=freeOnUnref(function(){var t=this;this.syePlayer.onNotificationMessageCallback=freeOnUnref(function(e){return t.onNotificationMessageCallback(e)})}),e.prototype.uninitialize=freeOnUnref(function(){this.syePlayer.onNotificationMessageCallback=null}),e.prototype.onNotificationMessageCallback=freeOnUnref(function(t){this.monitorContext.currentNotificationMessage=t;var e,n=void 0;if(void 0!==this.monitorContext.lastTimelineUpdateSyncTimeMicros&&null!==this.monitorContext.timelineInfo){var r=(t.localTimeMicros-this.monitorContext.lastTimelineUpdateSyncTimeMicros)/1e3;n=this.monitorContext.timelineInfo.currentPosUtcMillis+r;var i={messageType:t.messageType,data:t.data,adjustedMessageTimeMs:n};this.monitorContext.contentSourceEventEmitter.emit("notificationReceived",i)}try{var o=t.data;e=JSON.parse(o)}catch(e){return void a.error("Failed to handle notification with messageType "+t.messageType)}null!=e.filter&&e.filter.vcid!==this.vcid||("quit"===e.signal?this.triggerEndOfStream():a.warn("Ignoring unknown signal '"+e.signal+"'"))}),e})(yl.Monitor);t.NotificationMonitor=r}));e(Pl);Pl.NotificationMonitor;var Ml=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var t=this;this.onTimeUpdateReady=freeOnUnref(function(){var e=t.monitorContext.currentToState;null!=e&&t.processState(e,t.monitorContext.currentFromState)}),this.monitorContext=e,this.mpPlayerStateMachine=e.mpPlayerStateMachine,this.SyeClientSDK=e.SyeClientSDK}return e.prototype.processState=freeOnUnref(function(e,t){switch(e){case this.SyeClientSDK.SyePlayerState.kStopped:t===this.SyeClientSDK.SyePlayerState.kPlaying&&this.tryBecomeReady();break;case this.SyeClientSDK.SyePlayerState.kLoading:this.mpPlayerStateMachine.act("waiting");break;case this.SyeClientSDK.SyePlayerState.kPlaying:this.tryBecomeReady();break;case this.SyeClientSDK.SyePlayerState.kStalled:case this.SyeClientSDK.SyePlayerState.kAIS:case this.SyeClientSDK.SyePlayerState.kError:this.mpPlayerStateMachine.act("waiting");break;default:this.mpPlayerStateMachine.act("error",new ct.XpError("sye.invalid_state",void 0,"Invalid SyePlayerState: "+e))}}),e.prototype.teardown=freeOnUnref(function(){this.monitorContext.mpPlayerEventEmitter.off("timeupdate",this.onTimeUpdateReady)}),e.prototype.tryBecomeReady=freeOnUnref(function(){null!=this.monitorContext.timelineInfo?this.mpPlayerStateMachine.act("ready"):this.monitorContext.mpPlayerEventEmitter.once("timeupdate",this.onTimeUpdateReady)}),e})();t.ContentStateController=n}));e(Ml);Ml.ContentStateController;var Cl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("PlaybackStateController"),n=freeOnUnref(function(){function e(e,t){this.monitorContext=e,this.updatePlaybackStarted=t,this.SyeClientSDK=e.SyeClientSDK,this.mpPlayerEventEmitter=e.mpPlayerEventEmitter}return e.prototype.processState=freeOnUnref(function(e){var t=this.stateReducer(e);if(t!==this.monitorContext.currentPlaybackState){this.monitorContext.currentPlaybackState=t;var n=null!=this.monitorContext.timelineInfo?this.monitorContext.timelineInfo.currentPosUtcMillis:0;r.info("PlaybackState change: "+t+", playbackPositionMs: "+n),this.updatePlaybackStarted(),this.mpPlayerEventEmitter.emit("playbackStateChange",{playbackState:t,playbackPositionMs:n})}}),e.prototype.stateReducer=freeOnUnref(function(e){switch(e){case this.SyeClientSDK.SyePlayerState.kStopped:case this.SyeClientSDK.SyePlayerState.kLoading:return"paused";case this.SyeClientSDK.SyePlayerState.kPlaying:case this.SyeClientSDK.SyePlayerState.kStalled:case this.SyeClientSDK.SyePlayerState.kAIS:return"playing";case this.SyeClientSDK.SyePlayerState.kError:return"paused";default:throw new Error("Invalid SyePlayerState: "+e)}}),e})();t.PlaybackStateController=n}));e(Cl);Cl.PlaybackStateController;var El=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("UnexpectedStallController"),r=freeOnUnref(function(){function e(e){this.SyeClientSDK=e.SyeClientSDK,this.mpPlayerEventEmitter=e.mpPlayerEventEmitter}return e.prototype.processState=freeOnUnref(function(e,t){t!==this.SyeClientSDK.SyePlayerState.kPlaying||e!==this.SyeClientSDK.SyePlayerState.kStalled&&e!==this.SyeClientSDK.SyePlayerState.kAIS&&e!==this.SyeClientSDK.SyePlayerState.kError||(n.info("Received Stall Event, State changed from: "+this.SyeClientSDK.SyePlayerState[t]+" to "+this.SyeClientSDK.SyePlayerState[e]),this.mpPlayerEventEmitter.emit("stall",{expected:!1,reason:this.SyeClientSDK.SyePlayerState[e]}))}),e})();t.UnexpectedStallController=r}));e(El);El.UnexpectedStallController;var Tl=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("PlaybackStateMonitor"),r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e)||this;return n.contentStateController=new Ml.ContentStateController(e),n.playbackStateController=new Cl.PlaybackStateController(e,t),n.unexpectedStallController=new El.UnexpectedStallController(e),n}return n(e,r),e.prototype.initialize=freeOnUnref(function(){var n=this;this.syePlayer.onStateChangeCallback=freeOnUnref(function(e,t){return n.onStateChangeCallback(e,t)})}),e.prototype.uninitialize=freeOnUnref(function(){this.syePlayer.onStateChangeCallback=null,this.contentStateController.teardown()}),e.prototype.onStateChangeCallback=freeOnUnref(function(e,t){i.info("State changed from: "+this.SyeClientSDK.SyePlayerState[e]+" to "+this.SyeClientSDK.SyePlayerState[t]),this.monitorContext.currentFromState=e,this.monitorContext.currentToState=t,this.contentStateController.processState(t,e),this.playbackStateController.processState(t),this.unexpectedStallController.processState(t,e)}),e})(yl.Monitor);t.PlaybackStateMonitor=r}));e(Tl);Tl.PlaybackStateMonitor;var wl=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastReportedVideoStreamInfo=null,e.monitorIntervalId=null,e.onStreamTrackChange=freeOnUnref(function(){null===e.monitorContext.currentVideoStreamInfo||null!==e.lastReportedVideoStreamInfo&&!e.isStreamDataChanged(e.lastReportedVideoStreamInfo,e.monitorContext.currentVideoStreamInfo)||(e.lastReportedVideoStreamInfo=e.monitorContext.currentVideoStreamInfo,e.internalEventEmitter.emit("bitstreamChange",void 0))}),e}return n(e,t),e.prototype.initialize=freeOnUnref(function(){this.internalEventEmitter.on("videoTrackChange",this.onStreamTrackChange),this.internalEventEmitter.on("audioTrackChange",this.onStreamTrackChange)}),e.prototype.uninitialize=freeOnUnref(function(){this.internalEventEmitter.off("videoTrackChange",this.onStreamTrackChange),this.internalEventEmitter.off("audioTrackChange",this.onStreamTrackChange)}),e.prototype.onFrontendFailover=freeOnUnref(function(){this.lastReportedVideoStreamInfo=null}),e.prototype.isStreamDataChanged=freeOnUnref(function(e,t){return e.width!==t.width||e.height!==t.height||e.bitrate!==t.bitrate}),e})(yl.Monitor);t.StatisticsMonitor=r}));e(wl);wl.StatisticsMonitor;var Il=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e)||this;return n.timeWindow=t,n.syeAPI=n.SyeClientSDK,n}return n(e,r),e.prototype.initialize=freeOnUnref(function(){var t=this;this.syePlayer.onTimelineUpdateCallback=freeOnUnref(function(e){return t.onTimelineUpdateCallback(e)})}),e.prototype.uninitialize=freeOnUnref(function(){this.syePlayer.onTimelineUpdateCallback=null}),e.prototype.onTimelineUpdateCallback=freeOnUnref(function(e){this.monitorContext.timelineInfo=e,this.monitorContext.lastTimelineUpdateSyncTimeMicros=this.syeAPI.syncTimeMicros(),null!==this.monitorContext.currentVideoStreamInfo&&this.monitorContext.mpPlayerEventEmitter.emit("timeupdate",{positionMs:e.currentPosUtcMillis,periodId:"1",manifestTimeMs:e.currentPosUtcMillis,mediaWallClockUtcTimeMs:e.currentPosUtcMillis}),this.timeWindow.updateTimelineInfo(e)}),e})(yl.Monitor);t.TimelineMonitor=r}));e(Il);Il.TimelineMonitor;var kl=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("UDPMonitor"),i=freeOnUnref(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.udpTimeoutId=null,e}return n(e,t),e.prototype.initialize=freeOnUnref(function(){var e=this;this.syePlayer.onEgressAllocatedCallback=freeOnUnref(function(){return e.onEgressAllocatedCallback()}),this.syePlayer.onEgressContactCallback=freeOnUnref(function(){return e.onEgressContactCallback()})}),e.prototype.uninitialize=freeOnUnref(function(){this.syePlayer.onEgressAllocatedCallback=null,this.syePlayer.onEgressContactCallback=null}),e.prototype.onFrontendFailover=freeOnUnref(function(){null!=this.udpTimeoutId&&(oe.timer.clearTimeout(this.udpTimeoutId),this.udpTimeoutId=null)}),e.prototype.onEgressAllocatedCallback=freeOnUnref(function(){if(!this.monitorContext.isUDPConnectionSuccessful&&!fl.liveLowLatencyContext.isUdpFallbackDisabled()){var e=L.configurationStore.configuration,t=vl.LiveLowLatencyConfigurations.EgressContactTimeThresholdInMs;null!=e&&null!=e.liveLowLatency&&null!=e.liveLowLatency.egressContactTimeThresholdMs&&(t=e.liveLowLatency.egressContactTimeThresholdMs),this.startUDPTimeout(t)}}),e.prototype.onEgressContactCallback=freeOnUnref(function(){this.monitorContext.isUDPConnectionSuccessful=!0,null!=this.udpTimeoutId&&(oe.timer.clearTimeout(this.udpTimeoutId),this.udpTimeoutId=null)}),e.prototype.startUDPTimeout=freeOnUnref(function(e){var t=this;this.udpTimeoutId=oe.timer.setTimeout(freeOnUnref(function(){t.monitorContext.isUDPConnectionSuccessful=!1,r.info("Egress contact failed - Falling back"),t.monitorContext.mpPlayerStateMachine.act("error",Sl.LiveLowLatencyErrors.getUDPTimeoutError())}),e)}),e})(yl.Monitor);t.UDPMonitor=i}));e(kl);kl.UDPMonitor;var _l=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("VideoTrackMonitor"),i=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.initialize=freeOnUnref(function(){var t=this;this.syePlayer.onVideoStreamChangeCallback=freeOnUnref(function(e){return t.onVideoStreamChangeCallback(e)})}),t.prototype.uninitialize=freeOnUnref(function(){this.syePlayer.onVideoStreamChangeCallback=null}),t.prototype.onVideoStreamChangeCallback=freeOnUnref(function(e){r.info("VideoStreamInfo changed to "+this.videoStreamInformation(e)),this.monitorContext.currentVideoStreamInfo=e,this.internalEventEmitter.emit("videoTrackChange",void 0)}),t.prototype.videoStreamInformation=freeOnUnref(function(e){return"["+e.width+"x"+e.height+" bitrate("+e.bitrate+")]"}),t})(yl.Monitor);t.VideoTrackMonitor=i}));e(_l);_l.VideoTrackMonitor;var Rl=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.initialize=freeOnUnref(function(){var t=this;this.syePlayer.onPictureModeChangedCallback=freeOnUnref(function(e){return t.onPictureModeChangedCallback(e)})}),t.prototype.uninitialize=freeOnUnref(function(){this.syePlayer.onPictureModeChangedCallback=null}),t.prototype.onPictureModeChangedCallback=freeOnUnref(function(e){switch(e){case 2:this.monitorContext.mpPlayerEventEmitter.emit("pictureModeChange","CalibratedBroadcast");break;case 0:default:this.monitorContext.mpPlayerEventEmitter.emit("pictureModeChange","None")}}),t})(yl.Monitor);t.PictureModeMonitor=r}));e(Rl);Rl.PictureModeMonitor;var Al=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("FrontendInfoMonitor"),i=freeOnUnref(function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype.initialize=freeOnUnref(function(){var t=this;this.syePlayer.onFrontendSuccessCallback=freeOnUnref(function(e){return t.onFrontendSuccessCallback(e)})}),e.prototype.uninitialize=freeOnUnref(function(){this.syePlayer.onFrontendSuccessCallback=null}),e.prototype.onFrontendSuccessCallback=freeOnUnref(function(e){var t={pop:e.pop,cdn:e.cdn,consumptionId:e.consumptionId};r.info("onFrontendSuccessCallback "+JSON.stringify(e)),this.monitorContext.frontendInfo=t,this.internalEventEmitter.emit("frontendInfoChange",t),this.internalEventEmitter.emit("bitstreamChange",void 0)}),e})(yl.Monitor);t.FrontendInfoMonitor=i}));e(Al);Al.FrontendInfoMonitor;var Dl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s){this.monitors=[],this.internalEventEmitter=e.internalEventEmitter,this.monitors=[new gl.AudioTrackMonitor(e),new Ol.ClosedCaptionMonitor(e),this.errorMonitor=new Ul.ErrorMonitor(e,a,n,s),new bl.MetricsMonitor(e),new Tl.PlaybackStateMonitor(e,r),new Pl.NotificationMonitor(e,t,i),new wl.StatisticsMonitor(e),new Il.TimelineMonitor(e,o),new kl.UDPMonitor(e),new _l.VideoTrackMonitor(e),new Rl.PictureModeMonitor(e),new Al.FrontendInfoMonitor(e)];for(var l=0,f=this.monitors;l<f.length;l++){f[l].initialize()}}return e.prototype.destroy=freeOnUnref(function(){for(var e=0,t=this.monitors;e<t.length;e++){t[e].uninitialize()}this.monitors=[]}),e.prototype.onFrontendFailover=freeOnUnref(function(){for(var e=0,t=this.monitors;e<t.length;e++){t[e].onFrontendFailover()}}),e.prototype.on=freeOnUnref(function(e,t){this.internalEventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.internalEventEmitter.off(e,t)}),e.prototype.clearSyeFallbackErrorHistory=freeOnUnref(function(){this.errorMonitor.clearFallbackErrorHistory()}),e.prototype.getSyeFallbackErrorHistory=freeOnUnref(function(){return this.errorMonitor.getFallbackErrorHistory().join(",")}),e})();t.MonitorController=n}));e(Dl);Dl.MonitorController;var xl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(e,t,n,r,i,o,a){this.frontendInfo=null,this.isUDPConnectionSuccessful=!1,this.timelineInfo=null,this.audioTracksArray=null,this.availableAudioLanguages=null,this.currentVideoStreamInfo=null,this.channelIndexes=[],this.channelServices=[],this.syeError=null,this.currentNotificationMessage=null,this.currentFromState=null,this.currentToState=null,this.currentPlaybackState="paused",this.playbackStarted=!1,this.SyeClientSDK=e,this.syePlayer=t,this.mpPlayerEventEmitter=n,this.contentSourceEventEmitter=r,this.internalEventEmitter=new A.EventEmitter,this.textTrack=i,this.mpPlayerStateMachine=o,this.streamSelector=a}})();t.MonitorContext=n}));e(xl);xl.MonitorContext;var Fl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.getAggregateBufferedRanges=freeOnUnref(function(e){return new In.NumberLine}),e.prototype.getBufferInformation=freeOnUnref(function(){return{}}),e.prototype.getBufferedRanges=freeOnUnref(function(e){return new In.NumberLine}),e.prototype.getFrontBufferLengthMs=freeOnUnref(function(e){return 0}),e.prototype.isBufferedToEnd=freeOnUnref(function(e){return!1}),e.prototype.getInMemoryBufferInformation=freeOnUnref(function(){return{}}),e.prototype.getSourceBufferInformation=freeOnUnref(function(){return{}}),e})();t.LiveLowLatencyBufferInformationProvider=n}));e(Fl);Fl.LiveLowLatencyBufferInformationProvider;var Bl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.videoElement=null}return e.prototype.isPictureInPicture=freeOnUnref(function(){return null!=this.videoElement&&null!=document&&this.videoElement===document.pictureInPictureElement}),e.prototype.isSupported=freeOnUnref(function(){return null!=document&&"pictureInPictureEnabled"in document}),e.prototype.requestPictureInPicture=freeOnUnref(function(){return null!=this.videoElement?this.videoElement.requestPictureInPicture():lt.Promise.reject("requestPictureInPicture() failed due to feature not being initialized")}),e.prototype.exitPictureInPicture=freeOnUnref(function(){return null!=document?document.exitPictureInPicture():lt.Promise.reject("exitPictureInPicture() failed due to feature not being initialized")}),e.prototype.offChange=freeOnUnref(function(e){null!=this.videoElement&&(this.videoElement.removeEventListener("enterpictureinpicture",e),this.videoElement.removeEventListener("leavepictureinpicture",e))}),e.prototype.onChange=freeOnUnref(function(e){null!=this.videoElement&&(this.videoElement.addEventListener("enterpictureinpicture",e),this.videoElement.addEventListener("leavepictureinpicture",e))}),e.prototype.registerPlayer=freeOnUnref(function(e){null!=e.getAttachedView()&&(this.videoElement=e.getAttachedView())}),e.prototype.unload=freeOnUnref(function(){this.videoElement=null}),e})();t.LiveLowLatencyPictureInPictureFeature=n}));e(Bl);Bl.LiveLowLatencyPictureInPictureFeature;var Ll=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("LiveLowLatencyPlaybackQualityProvider"),r=freeOnUnref(function(){function e(e){this.syePlayer=null,this.monitorContext=null,this.eventEmitter=e}return e.prototype.initialize=freeOnUnref(function(e,t){this.syePlayer=e,this.monitorContext=t}),e.prototype.uninitialize=freeOnUnref(function(){this.syePlayer=null}),e.prototype.getCurrentQualityInfo=freeOnUnref(function(e){return null}),e.prototype.getVideoDecodePerformance=freeOnUnref(function(){try{if(null!=this.syePlayer)return{creationTime:Date.now(),droppedVideoFrames:this.syePlayer.getMetrics().videoFramesDropped,totalVideoFrames:-1}}catch(e){n.error("Failed to get SyePlayer metrics",e)}return{creationTime:Date.now(),droppedVideoFrames:0,totalVideoFrames:-1}}),e.prototype.getCurrentResolution=freeOnUnref(function(){if(null===this.monitorContext||null===this.monitorContext.currentVideoStreamInfo)return null;var e=this.monitorContext.currentVideoStreamInfo;return{width:e.width,height:e.height}}),e.prototype.off=freeOnUnref(function(e,t,n){}),e.prototype.on=freeOnUnref(function(e,t,n){}),e.prototype.onStreamGroupChange=freeOnUnref(function(e){this.eventEmitter.on("streamGroupChange",e)}),e.prototype.offStreamGroupChange=freeOnUnref(function(e){this.eventEmitter.off("streamGroupChange",e)}),e.prototype.emitStreamGroupChange=freeOnUnref(function(e){this.eventEmitter.emit("streamGroupChange",e)}),e})();t.LiveLowLatencyPlaybackQualityProvider=r}));e(Ll);Ll.LiveLowLatencyPlaybackQualityProvider;var Nl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.eventEmitter=new A.EventEmitter,this.trackCues=[]}return Object.defineProperty(e.prototype,"cues",{get:freeOnUnref(function(){return this.trackCues}),enumerable:!0,configurable:!0}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.emitCue=freeOnUnref(function(e){for(this.eventEmitter.emit("newcue",e);0<this.cues.length&&this.cues[0].endMs<e.startMs;)this.cues.splice(0,1);this.cues.push(e)}),e.prototype.clearCue=freeOnUnref(function(){this.trackCues=[]}),e.prototype.closedCaptionsUpdated=freeOnUnref(function(){}),Object.defineProperty(e.prototype,"bufferedIntervalsMs",{get:freeOnUnref(function(){return 0===this.cues.length?[]:[{start:this.cues[0].startMs,end:this.cues[this.cues.length-1].endMs}]}),enumerable:!0,configurable:!0}),e})();t.LiveLowLatencyTextTrack=n}));e(Nl);Nl.LiveLowLatencyTextTrack;var Vl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.syePlayer=null,this.lastRequestedVolume=1,this.lastNonZeroVolume=1,this.multicastCallback=new A.MulticastCallback}return Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){return null==this.syePlayer?this.lastRequestedVolume:this.syePlayer.getAudioVolume()}),set:freeOnUnref(function(e){0<(this.lastRequestedVolume=e)&&(this.lastNonZeroVolume=e),null!=this.syePlayer&&e!==this.volume&&(this.syePlayer.audioVolume(e),this.multicastCallback.invoke())}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:freeOnUnref(function(){return 0===this.volume}),set:freeOnUnref(function(e){null!=this.syePlayer&&e!==this.muted&&(this.volume=e?0:this.lastNonZeroVolume,this.multicastCallback.invoke())}),enumerable:!0,configurable:!0}),e.prototype.offChange=freeOnUnref(function(e){this.multicastCallback.remove(e)}),e.prototype.onChange=freeOnUnref(function(e){this.multicastCallback.add(e)}),e.prototype.registerPlayer=freeOnUnref(function(e){this.syePlayer=e,this.syePlayer.audioVolume(this.lastRequestedVolume)}),e.prototype.unload=freeOnUnref(function(){this.syePlayer=null,this.multicastCallback.removeAll()}),e})();t.LiveLowLatencyVolumeFeature=n}));e(Vl);Vl.LiveLowLatencyVolumeFeature;var jl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.generateLookupFallbackTags=function(e){for(var t=[e],n=e,r=n.lastIndexOf("-");-1!==r;)n=n.substring(0,r),t.push(n),r=n.lastIndexOf("-");return t}}));e(jl);jl.generateLookupFallbackTags;var ql=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isBasicLanguageRangeMatch=function(e,t){var n=e.toLowerCase(),r=t.toLowerCase();return n===r||0===n.indexOf(r+"-")}}));e(ql);ql.isBasicLanguageRangeMatch;var Hl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.ISO_639_2T_TO_ISO639_1={aar:"aa",abk:"ab",afr:"af",aka:"ak",amh:"am",ara:"ar",arg:"an",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",cat:"ca",ces:"cs",cha:"ch",che:"ce",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",dan:"da",deu:"de",dut:"nl",div:"dv",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fry:"fy",ful:"ff",gla:"gd",gle:"ga",glg:"gl",glv:"gv",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mah:"mh",mal:"ml",mar:"mr",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"}}));e(Hl);Hl.ISO_639_2T_TO_ISO639_1;var zl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.toExpectedIso639_1LanguageCode=function(e){if(null==e||3!==e.length)return e;if("enm"===e)return"en-gb";if("eng"===e)return"en-us";var t=Hl.ISO_639_2T_TO_ISO639_1[e];return null!=t?t:e}}));e(zl);zl.toExpectedIso639_1LanguageCode;var Wl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.generateLookupFallbackTags=jl.generateLookupFallbackTags,t.isBasicLanguageRangeMatch=ql.isBasicLanguageRangeMatch,t.toExpectedIso639_1LanguageCode=zl.toExpectedIso639_1LanguageCode}));e(Wl);Wl.generateLookupFallbackTags,Wl.isBasicLanguageRangeMatch,Wl.toExpectedIso639_1LanguageCode;var Kl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isMatch=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];if(e[i]!==t[i]){if("language"!==i)return!1;var o=e.language;if(null==o)return!1;if(null!=t.language&&!Wl.isBasicLanguageRangeMatch(o,t.language))return!1}}return!0}}));e(Kl);Kl.isMatch;var Gl=t(freeOnUnref(function(e,t){var l=ce&&ce.__assign||freeOnUnref(function(){return(l=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0}),t.expandMatcherLanguages=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];if(null==i.language)t.push(i);else for(var o=0,a=Wl.generateLookupFallbackTags(i.language.toLowerCase());o<a.length;o++){var s=a[o];t.push(l({},i,{language:s}))}}return t}}));e(Gl);Gl.expandMatcherLanguages;var Ql=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.generateCustomLanguageRangeFallbackOrder=function(e){for(var t=[],n=0,r=Wl.generateLookupFallbackTags(e);n<r.length;n++){var i=r[n];t.push(i),t.push(new RegExp("^"+i+"-.+$"))}return t}}));e(Ql);Ql.generateCustomLanguageRangeFallbackOrder;var Xl=t(freeOnUnref(function(e,t){var l=ce&&ce.__assign||freeOnUnref(function(){return(l=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0}),t.expandCustomMatcherLanguages=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];if(null==i.language)t.push(i);else for(var o=0,a=Ql.generateCustomLanguageRangeFallbackOrder(i.language.toLowerCase());o<a.length;o++){var s=a[o];t.push(l({},i,{language:s}))}}return t}}));e(Xl);Xl.expandCustomMatcherLanguages;var Yl=t(freeOnUnref(function(e,t){function l(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n],o=t[i];if(null!=o){var a=e[i];if("language"===i&&(null!=a&&(a=a.toLowerCase()),"string"==typeof o&&(o=o.toLowerCase())),a!==o&&!(null!=a&&o instanceof RegExp&&o.test(a)))return!1}}return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.isStreamMatch=l,t.selectStream=function(e,t){for(var n=0,r=t;n<r.length;n++)for(var i=r[n],o=0,a=e;o<a.length;o++){var s=a[o];if(l(s,i))return s}return null}}));e(Yl);Yl.isStreamMatch,Yl.selectStream;var Jl=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isMatch=Kl.isMatch,t.expandMatcherLanguages=Gl.expandMatcherLanguages,t.expandCustomMatcherLanguages=Xl.expandCustomMatcherLanguages,t.selectStream=Yl.selectStream,t.isStreamMatch=Yl.isStreamMatch}));e(Jl);Jl.isMatch,Jl.expandMatcherLanguages,Jl.expandCustomMatcherLanguages,Jl.selectStream,Jl.isStreamMatch;var Zl=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var c=de.get("LiveLowLatencyStreamSelector"),d=vl.LiveLowLatencyConfigurations.UseSingleCCEnabled;function p(e){return{id:e.language,variants:[{id:""+e.language+e.numChannels+e.codec,bitrate:0,restrictions:[],channelConfiguration:""}],activeVariantId:""+e.language+e.numChannels+e.codec,language:Wl.toExpectedIso639_1LanguageCode(e.language),type:"Dialog",label:vl.LiveLowLatencyConfigurations.LocaleAndDisplayNameOverrideMap[e.language]}}var r=freeOnUnref(function(){function e(e,t,n){var r,i;this.isClosedCaptionsEnabled=!1,this.currentAudioStreamGroup={type:"Audio",streams:[],activeId:null},this.currentTimedTextStreamGroup={type:"TimedText",streams:[],activeId:null},this.currentStreamTypeMatchers=((r={}).Audio=[],r.Video=[],r.TimedText=[],r),this.streamMatcherUpdateActionMap=((i={}).Audio=this.selectPreferredAudioTrack,i.TimedText=this.selectPreferredClosedCaptionTrack,i.Video=freeOnUnref(function(){}),i),this.unsupportedAudioCodecs=[],this.SyeClientSDK=e,this.syePlayer=t,this.playbackQualityProvider=n}return e.prototype.setStreamMatchers=freeOnUnref(function(e,t){this.currentStreamTypeMatchers[e]=t,this.streamMatcherUpdateActionMap[e].call(this)}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(e){this.unsupportedAudioCodecs=e;var t=this.syePlayer.getAudioPreferences();this.syePlayer.setAudioPreferences({language:t.language,codec:this.getPreferredAudioCodec(),channels:t.channels})}),e.prototype.setMaxResolution=freeOnUnref(function(e){var t=this.syePlayer.getVideoPreferences();this.syePlayer.setVideoPreferences({maxBitrate:t.maxBitrate,maxHeight:e})}),e.prototype.onAvailableAudioTracksCallback=freeOnUnref(function(e){this.handleAvailableAudioTracksChange(e),this.handleAudioStreamChange(),this.playbackQualityProvider.emitStreamGroupChange(this.currentAudioStreamGroup),this.handleAvailableClosedCaptionsChannelsChange(this.syePlayer.getAvailableClosedCaptionsChannels())}),e.prototype.handleAvailableAudioTracksChange=freeOnUnref(function(e){var t=this.selectPreferredAudioTrack(),n=this.filterSupportedAudioTracks(e).map(p);this.currentAudioStreamGroup={type:"Audio",activeId:t,streams:n}}),e.prototype.onAudioStreamChangeCallback=freeOnUnref(function(){this.handleAudioStreamChange(),this.playbackQualityProvider.emitStreamGroupChange(this.currentAudioStreamGroup)}),e.prototype.handleAudioStreamChange=freeOnUnref(function(){var t=this,e=this.syePlayer.audioStreamInfo();if(null==e)this.currentAudioStreamGroup.activeId=null;else{this.currentAudioStreamGroup.activeId=e.language;var n=x.find(this.currentAudioStreamGroup.streams,freeOnUnref(function(e){return e.id===t.currentAudioStreamGroup.activeId}));null==n?(c.info("Unable to find activeStream: "+this.currentAudioStreamGroup.activeId),this.currentAudioStreamGroup.activeId=null):n.activeVariantId=""+e.language+e.numChannels+e.codec}}),e.prototype.selectPreferredAudioTrack=freeOnUnref(function(){var e=this.filterSupportedAudioTracks(this.syePlayer.availableAudioTracks()),t=e.map(p),n=this.currentStreamTypeMatchers.Audio.map(freeOnUnref(function(e){return{language:e.language}})),r=Jl.selectStream(t,n);if(null!=r){var i=e[x.findIndex(t,freeOnUnref(function(e){return e.language===r.language}))];if(null==i)return c.error("Found preferred AudioStream (lang:"+r.language+"), without associated ISyeAudioTrack"),null;c.info("Selecting audio track language: "+r.language+"/"+i.language);var o=this.syePlayer.getAudioPreferences();return this.syePlayer.setAudioPreferences({language:i.language,codec:this.getPreferredAudioCodec(),channels:o.channels}),i.language}return null}),e.prototype.getPreferredAudioCodec=freeOnUnref(function(){return 0===this.unsupportedAudioCodecs.length?this.SyeClientSDK.SyeAudioCodec.kUndefined:-1!==this.unsupportedAudioCodecs.indexOf("ec-3")?this.SyeClientSDK.SyeAudioCodec.kAAC:this.SyeClientSDK.SyeAudioCodec.kUndefined}),e.prototype.onAvailableClosedCaptionsChannelsCallback=freeOnUnref(function(e){this.handleAvailableClosedCaptionsChannelsChange(e)}),e.prototype.closedCaptionsEnabled=freeOnUnref(function(){return this.isClosedCaptionsEnabled}),e.prototype.handleAvailableClosedCaptionsChannelsChange=freeOnUnref(function(e){var t=this.generateTimedTextStreams(e);this.updateTimedTextStreamGroup({streams:t}),this.selectPreferredClosedCaptionTrack()}),e.prototype.generateTimedTextStreams=freeOnUnref(function(e){var t=this.filterSupportedAudioTracks(this.syePlayer.availableAudioTracks());if(0===t.length)return c.info("No audio tracks available yet. Ignoring all closed caption channels."),[];e.length>t.length&&c.warn("TimedText track length ("+e.length+") > AudioTrack length ("+t.length+")");for(var n,r,i,o=[],a=0,s=e;a<s.length;a++){var l=s[a],f=t[l];null!=f?o.push((n=l,void 0,r=f.language,i=vl.LiveLowLatencyConfigurations.LocaleAndDisplayNameOverrideMap[r],{id:""+n,variants:[{id:""+n,restrictions:[],format:"TTMLv1"}],activeVariantId:""+n,language:r?Wl.toExpectedIso639_1LanguageCode(r):"und",type:"Subtitle",label:i||void 0})):c.warn("Failed to find associated audio track for channel '"+l+"'. Ignoring.")}return o}),e.prototype.selectPreferredClosedCaptionTrack=freeOnUnref(function(){var e=this.syePlayer.getAvailableClosedCaptionsChannels(),t=d&&1<=e.length?e.slice(0,1):e,n=this.filterSupportedAudioTracks(this.syePlayer.availableAudioTracks()),r=this.currentStreamTypeMatchers.TimedText.filter(freeOnUnref(function(e){return null!=e.language&&"Mandatory"!==e.textType})).map(freeOnUnref(function(e){return{language:e.language}})),i=freeOnUnref(function(e){return null!=e[0]&&null!=e[1]}),o=x.chain(t).zip(n).filter(i).value(),a=o.map(freeOnUnref(function(e){return p(e[1])})),s=Jl.selectStream(a,r);if(null==s)this.syePlayer.setIsClosedCaptionsEnabled(!1),this.isClosedCaptionsEnabled=!1,this.updateTimedTextStreamGroup({activeId:null});else{var l=o[x.findIndex(a,s)];if(null==l)return void c.error("Found associated audio match, without ClosedCaptions");var f=l[0],u=l[1];c.info("Selecting closed caption index: "+f+" language: "+u.language),this.syePlayer.selectClosedCaptionsChannel(f),this.syePlayer.setIsClosedCaptionsEnabled(!0),this.isClosedCaptionsEnabled=!0,this.updateTimedTextStreamGroup({activeId:""+f})}}),e.prototype.updateTimedTextStreamGroup=freeOnUnref(function(e){this.currentTimedTextStreamGroup=n({},this.currentTimedTextStreamGroup,e),this.playbackQualityProvider.emitStreamGroupChange(this.currentTimedTextStreamGroup)}),e.prototype.filterSupportedAudioTracks=freeOnUnref(function(e){var t=this;return e.filter(freeOnUnref(function(e){return e.codec===t.SyeClientSDK.SyeAudioCodec.kAAC}))}),e})();t.LiveLowLatencyStreamSelector=r}));e(Zl);Zl.LiveLowLatencyStreamSelector;var $l=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("SeekController"),n=freeOnUnref(function(){function e(e){var t=this;this.requestedSeekPositionMs=null,this.isPendingTimelineToSeek=!1,this.channelId=null,this.contentSource=null,this.monitorContext=null,this.syePlayer=null,this.triggerDeferredSeek=freeOnUnref(function(){null!=t.monitorContext&&null!=t.monitorContext.timelineInfo&&null!==t.requestedSeekPositionMs&&(t.eventEmitter.off("timeupdate",t.triggerDeferredSeek),t.isPendingTimelineToSeek=!1,t.seekAndPlay(t.requestedSeekPositionMs))}),this.eventEmitter=e}return e.prototype.initialize=freeOnUnref(function(e,t,n,r){this.syePlayer=e,this.monitorContext=t,this.contentSource=n,this.SyePlaybackType=r}),e.prototype.uninitialize=freeOnUnref(function(){this.syePlayer=null,this.monitorContext=null,this.contentSource=null,this.requestedSeekPositionMs=null,this.isPendingTimelineToSeek=!1,this.channelId=null,this.eventEmitter.off("timeupdate",this.triggerDeferredSeek)}),e.prototype.setChannelId=freeOnUnref(function(e){this.channelId=e}),e.prototype.emitSyntheticTimeUpdate=freeOnUnref(function(){if(null!=this.requestedSeekPositionMs){var e=Math.min(this.requestedSeekPositionMs,Date.now());this.eventEmitter.emit("seeking"),this.eventEmitter.emit("timeupdate",{positionMs:e,periodId:"1",manifestTimeMs:e,mediaWallClockUtcTimeMs:e})}}),e.prototype.seekAndPlay=freeOnUnref(function(e){if(null!=e&&(this.requestedSeekPositionMs=e),null!=this.requestedSeekPositionMs){if(null==this.contentSource)return o.warn("No ContentSource"),void this.emitSyntheticTimeUpdate();if(null==this.syePlayer||null==this.channelId)return o.warn("No SyePlayer or channelId"),void this.emitSyntheticTimeUpdate();var t=null!=this.monitorContext&&null!=this.monitorContext.timelineInfo?"knownTimeline":"estimatedTimeline",n=null!=this.monitorContext&&null!=this.monitorContext.timelineInfo&&this.monitorContext.timelineInfo.playbackType===this.SyePlaybackType.kLive,r=this.contentSource.availabilityTimeWindow,i=In.clamp(this.requestedSeekPositionMs,r.startMs,r.endMs);i<r.endMs-8e3?(o.info("[seekAndPlay]["+t+"] Invoking syePlayer.playFromUtcTime("+i+") -- current UTC time is "+Date.now()),this.syePlayer.playFromUtcTime(this.channelId,i)):n||(o.info("[seekAndPlay][${timelineAccuracy}] Invoking syePlayer.playFromLive"),this.syePlayer.playFromLive(this.channelId)),this.requestedSeekPositionMs=null,this.eventEmitter.emit("seeking")}}),e})();t.SeekController=n}));e($l);$l.SeekController;var ef=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("PlayPauseController"),r=freeOnUnref(function(){function e(e){this.syePlayer=null,this.seekController=e,this.requestedPlaybackState="paused",this.hasStarted=!1}return e.prototype.initialize=freeOnUnref(function(e){this.syePlayer=e,"playing"===this.requestedPlaybackState&&this.internalPlay()}),e.prototype.uninitialize=freeOnUnref(function(){this.syePlayer=null,this.requestedPlaybackState="paused",this.hasStarted=!1}),e.prototype.isRequestedToPlay=freeOnUnref(function(){return"playing"===this.requestedPlaybackState}),e.prototype.pause=freeOnUnref(function(){this.requestedPlaybackState="paused",null!=this.syePlayer&&this.syePlayer.pause()}),e.prototype.play=freeOnUnref(function(){"playing"!==this.requestedPlaybackState&&this.internalPlay()}),e.prototype.executeFailover=freeOnUnref(function(){null!=this.syePlayer&&(n.info("[executeFailover] Invoking syePlayer.stop and syePlayer.playResume"),this.syePlayer.stop(),this.syePlayer.playResume())}),e.prototype.internalPlay=freeOnUnref(function(){this.requestedPlaybackState="playing",null!=this.syePlayer&&(this.hasStarted?(n.info("[internalPlay] Invoking syePlayer.playResume"),this.syePlayer.playResume()):(this.seekController.seekAndPlay(),this.hasStarted=!0))}),e})();t.PlayPauseController=r}));e(ef);ef.PlayPauseController;var tf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var d=de.get("MpPlayerLiveLowLatency"),n=freeOnUnref(function(){function t(e){var c=this;this.contentState="unloaded",this.maxMidstreamCdnRetryTimeoutMs=15e3,this.excessiveWaitingTimeoutMs=15e3,this.pictureInPictureFeature=null,this.eventEmitter=new A.EventEmitter,this.SyeClientSDK=null,this.syePlayer=null,this.monitorContext=null,this.monitorController=null,this.contentSource=null,this.isContentSourceLoadAttempted=!1,this.hasEnded=!1,this.cdnSwitchTimeoutId=null,this.streamSelector=null,this.excessiveWaitingTimeoutId=null,this.midstreamRetryTimeoutId=null,this.onLoad=freeOnUnref(function(e){c.contentSource=e,c.isContentSourceLoadAttempted=!0,c.hasEnded=!1,q.metrics.putMetric("LiveLowLatency.Load");var t=freeOnUnref(function(e){var t;if(c.isContentSourceLoadAttempted){c.SyeClientSDK=e;var n=c.SyeClientSDK;n.Setup({},de.get("SyeSDK")),d.info("Setting up Sye SDK "+n.SdkVersion()+" succeeded");var r,i,o=c.contentSource,a=o.sourceUrlStore.get(),s=new c.SyeClientSDK.SyeDomain(a.url,a.cdn),l=new c.SyeClientSDK.SyeSystem(s,a.token),f=((t={}).None=c.SyeClientSDK.SyePictureMode.None,t.Filmmaker=c.SyeClientSDK.SyePictureMode.Filmmaker,t.CalibratedBroadcast=c.SyeClientSDK.SyePictureMode.CalibratedBroadcast,t.CalibratedCinematic=c.SyeClientSDK.SyePictureMode.CalibratedCinematic,t),u=[];o.suggestedPictureModes&&(u=o.suggestedPictureModes.map(freeOnUnref(function(e){return f[e]}))),c.isHtmlVideoElement(c.surfaceRef)?(r=c.surfaceRef,i=null):(r=null,i=c.surfaceRef),c.syePlayer=n.CreatePlayer(l,r,freeOnUnref(function(){c.mpPlayerStateMachine.act("error",new ct.XpError("sye.player_creation_failed"))}),freeOnUnref(function(){c.mpPlayerStateMachine.act("error",new ct.XpError("sye.player_creation_failed",void 0,"create player retry failed"))}),i,u),null!=c.syePlayer?(c.streamSelector=new Zl.LiveLowLatencyStreamSelector(c.SyeClientSDK,c.syePlayer,c.playbackQualityProvider),o.streamSelector=c.streamSelector,(0<o.maxVideoBitrateBps&&o.maxVideoBitrateBps<1/0||0<o.maxVideoHeightPixels)&&(d.info(">> setting max bitrate: "+o.maxVideoBitrateBps+" and max height: "+o.maxVideoHeightPixels),c.syePlayer.setVideoPreferences({maxBitrate:o.maxVideoBitrateBps===1/0?0:o.maxVideoBitrateBps,maxHeight:o.maxVideoHeightPixels})),0<o.unsupportedAudioCodecs.length&&c.streamSelector.setUnsupportedCodecs(o.unsupportedAudioCodecs),c.monitorContext=new xl.MonitorContext(c.SyeClientSDK,c.syePlayer,c.eventEmitter,o.eventEmitter,c.textTrack,c.mpPlayerStateMachine,c.streamSelector),c.monitorController=new Dl.MonitorController(c.monitorContext,c.triggerEndOfStream,c.triggerFrontendFailover,c.updatePlaybackStarted,o.vcid,o.availabilityTimeWindow,o.sourceUrlGetter,c.maxMidstreamCdnRetryTimeoutMs),c.monitorController.on("bitstreamChange",c.onBitstreamChange),c.monitorController.on("frontendInfoChange",c.onFrontendInfoChange),c.volumeFeature.registerPlayer(c.syePlayer),o.seekPreview.start(c.syePlayer,n,c.monitorContext),c.syePlayer.selectClosedCaptionsType(0),c.seekController.initialize(c.syePlayer,c.monitorContext,o,c.SyeClientSDK.SyePlaybackType),c.seekController.setChannelId(a.channelId),c.playPauseController.initialize(c.syePlayer),c.playbackQualityProvider.initialize(c.syePlayer,c.monitorContext),null!=c.pictureInPictureFeature&&c.pictureInPictureFeature.registerPlayer(c.syePlayer),c.playPauseController.isRequestedToPlay()?c.playPauseController.play():c.mpPlayerStateMachine.act("ready")):c.mpPlayerStateMachine.act("error",new ct.XpError("sye.player_creation_failed",void 0,"syeApi.CreatePlayer() returned undefined"))}else d.warn("Ignoring attempt to set up Sye SDK when content source was unloaded.")}),n=freeOnUnref(function(e,t,n){c.mpPlayerStateMachine.act("error",new ct.XpError("sye.sdk_download_failed",e,t))});fl.liveLowLatencyLoader.load(t,n),e.getStatistics=c.getSyeStatistics,e.getBitstreamInfo=c.getSyeBitstreamInfo}),this.onUnload=freeOnUnref(function(){if(delete c.contentError,c.hasEnded=!1,c.playbackQualityProvider.uninitialize(),c.playPauseController.uninitialize(),c.seekController.uninitialize(),null!=c.monitorContext&&(c.monitorContext.playbackStarted=!1),null!==c.monitorController&&(c.monitorController.off("bitstreamChange",c.onBitstreamChange),c.monitorController.off("frontendInfoChange",c.onFrontendInfoChange),c.monitorController.destroy()),null!==c.pictureInPictureFeature&&c.pictureInPictureFeature.unload(),null!==c.volumeFeature&&c.volumeFeature.unload(),null!==c.contentSource&&(c.contentSource.seekPreview.stop(),c.contentSource.getStatistics=freeOnUnref(function(){return null}),c.contentSource.getBitstreamInfo=freeOnUnref(function(){return null}),c.contentSource=null),null!=c.syePlayer&&(c.syePlayer.stop(),c.syePlayer.teardown(),c.syePlayer=null),null!=c.monitorContext&&"playing"===c.monitorContext.currentPlaybackState){var e=null!=c.monitorContext.timelineInfo?c.monitorContext.timelineInfo.currentPosUtcMillis:0;c.eventEmitter.emit("playbackStateChange",{playbackState:"paused",playbackPositionMs:e})}(c.monitorContext=null)!=c.cdnSwitchTimeoutId&&(oe.timer.clearTimeout(c.cdnSwitchTimeoutId),c.cdnSwitchTimeoutId=null),c.isContentSourceLoadAttempted=!1,c.mpPlayerStateMachine.act("unloaded")}),this.getSyeStatistics=freeOnUnref(function(){if(null==c.monitorContext||null==c.syePlayer)return null;var e;try{var t=c.syePlayer.getMetrics();e={totalBitsPerSecond:t.bitrateTotal,currentRoundtripMillis:t.roundtripMillis,numReceivedBytes:t.bytesReceived,numReceivedFrames:t.videoFramesReceived,numDecryptedFrames:0,numDecodeFailures:t.videoDecodeFailures,numDamagedAudioFrames:0,audioDropoutMillis:t.audioDropoutMillis,numDroppedVideoFrames:t.videoFramesDropped,numDamagedVideoFrames:t.videoFramesDamaged,videoDivergenceMillis:t.videoDivergenceMillis,pitcherGroup:t.pitcherGroup,egressEndpoint:t.egressEndpoint,packetsReceived:t.packetsReceived,packetsLost:t.packetsLost,packetsInvalid:t.packetsInvalid,packetsRetransmitReceived:t.packetsRetransmitReceived,packetsRetransmitReceivedUnused:t.packetsRetransmitReceivedUnused,thumbnailsReceived:t.thumbnailsReceived,notificationsReceived:t.notificationsReceived}}catch(e){return d.error("Failed to get SyePlayer metrics",e),null}return e}),this.getSyeBitstreamInfo=freeOnUnref(function(){if(null==c.monitorContext||null==c.monitorContext.currentVideoStreamInfo||null==c.contentSource||null==c.syePlayer)return null;var e=c.monitorContext.currentVideoStreamInfo,t=c.getSyeStatistics(),n=c.syePlayer.getVideoPreferences(),r=null;null!=t&&null!=t.pitcherGroup&&0<t.pitcherGroup.length&&(r=t.pitcherGroup);var i=null;null!=c.monitorContext.frontendInfo&&null!=c.monitorContext.frontendInfo.pop&&0<c.monitorContext.frontendInfo.pop.length&&(i=c.monitorContext.frontendInfo.pop);var o=e.height,a=e.width,s=null==n?o:n.maxHeight;return{width:a,maxWidth:a*s/o,height:o,maxHeight:s,bitrate:e.bitrate,maxBitrate:c.contentSource.maxVideoBitrateBps,pitcherGroup:r,pointOfPresence:i}}),this.triggerEndOfStream=freeOnUnref(function(){var e=c.currentTimeMs;null===e&&(d.warn("End of stream triggered without a current position. Defaulting to `0`"),e=0),c.hasEnded=!0,c.eventEmitter.emit("durationchange",e),c.eventEmitter.emit("ended",e),c.pause()}),this.triggerFrontendFailover=freeOnUnref(function(e){if(null!==c.contentSource&&null!==c.SyeClientSDK&&null!==c.syePlayer)if(null==c.cdnSwitchTimeoutId){var t=c.contentSource.sourceUrlStore.onError();if(t===pl.SyeUrlStoreErrorHandlerResult.Terminate)c.mpPlayerStateMachine.act("error",new ct.XpError("sye.player_state",void 0,e.toString()));else if(t===pl.SyeUrlStoreErrorHandlerResult.Restart){var n=c.contentSource.sourceUrlStore.get();c.scheduleCDNSwitch(n.isFirstCdn)}else{if(t!==pl.SyeUrlStoreErrorHandlerResult.Resume)throw new Error("Unsupported SourceUrlStore result: "+pl.SyeUrlStoreErrorHandlerResult[t]+" ("+t+")");c.syePlayer.playResume()}}else d.warn("Another CDN switch attempted when one pending already. Ignoring")}),this.excessiveWaitingTimeoutHandler=freeOnUnref(function(e){c.mpPlayerStateMachine.act("error",Sl.LiveLowLatencyErrors.getExcessiveWaitingError(e))}),this.midstreamRetryTimeoutHandler=freeOnUnref(function(){c.triggerFrontendFailover(new ct.XpError("sye.midstream_cdn_timeout"))}),this.isPictureInPictureFeatureEnabled=freeOnUnref(function(){return null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.liveLowLatency&&!0===L.configurationStore.configuration.liveLowLatency.enablePictureInPicture}),this.onBitstreamChange=freeOnUnref(function(){null!=c.contentSource&&c.contentSource.eventEmitter.emit("bitstreamChange")}),this.onFrontendInfoChange=freeOnUnref(function(e){null!=c.contentSource&&c.contentSource.sourceUrlStore.onFrontendInfoUpdate(e),t.stashedFrontendInfo=e,d.info("Sye frontendInfo updated: "+JSON.stringify(e))}),this.surfaceRef=e,this.textTrack=new Nl.LiveLowLatencyTextTrack,this.mpPlayerStateMachine=this.createContentStateMachine(),this.bufferInformationProvider=new Fl.LiveLowLatencyBufferInformationProvider,this.playbackQualityProvider=new Ll.LiveLowLatencyPlaybackQualityProvider(this.eventEmitter),this.volumeFeature=new Vl.LiveLowLatencyVolumeFeature,this.seekController=new $l.SeekController(this.eventEmitter),this.playPauseController=new ef.PlayPauseController(this.seekController),this.isPictureInPictureFeatureEnabled()&&(this.pictureInPictureFeature=new Bl.LiveLowLatencyPictureInPictureFeature),this.configureExcessiveWaitingTimeout(),this.configureCdnFailoverTimeout()}return Object.defineProperty(t.prototype,"error",{get:freeOnUnref(function(){if(null!=this.monitorContext&&null!=this.monitorContext.syeError)return ct.XpError.generatePrefixedError(this.monitorContext.syeError,"sye")}),enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playbackState",{get:freeOnUnref(function(){return null===this.monitorContext?"paused":this.monitorContext.currentPlaybackState}),enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTimeMs",{get:freeOnUnref(function(){return null!==this.monitorContext&&null!==this.monitorContext.timelineInfo?this.monitorContext.timelineInfo.currentPosUtcMillis:null}),enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playbackTime",{get:freeOnUnref(function(){if(null!==this.monitorContext&&null!==this.monitorContext.timelineInfo&&null!==this.monitorContext.currentVideoStreamInfo){var e=this.monitorContext.timelineInfo;return{positionMs:e.currentPosUtcMillis,periodId:"1",manifestTimeMs:e.currentPosUtcMillis,mediaWallClockUtcTimeMs:e.currentPosUtcMillis}}return null}),enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:freeOnUnref(function(){return this.hasEnded}),enumerable:!0,configurable:!0}),t.prototype.isSupported=freeOnUnref(function(e){return!0}),t.prototype.destroy=freeOnUnref(function(){null!=this.syePlayer&&this.unload(),null!=this.monitorController&&(this.monitorController.off("bitstreamChange",this.onBitstreamChange),this.monitorController.off("frontendInfoChange",this.onFrontendInfoChange)),t.stashedFrontendInfo=null}),t.prototype.load=freeOnUnref(function(e,t){if(d.info(">> load"),this.isContentSourceLoadAttempted)d.info("Content source successfully loaded - Ignoring duplicate load() calls");else{var n=null!=t?t:1/0;this.seek(n),this.mpPlayerStateMachine.act("load",e)}}),t.prototype.unload=freeOnUnref(function(){d.info(">> unload"),this.mpPlayerStateMachine.act("unload")}),t.prototype.pause=freeOnUnref(function(){null!==this.monitorContext&&this.monitorContext.textTrack.clearCue(),d.info(">> pause"),this.playPauseController.pause()}),t.prototype.play=freeOnUnref(function(){var e=this;return d.info(">> play"),lt.Promise.resolve().then(freeOnUnref(function(){e.playPauseController.play()}))}),t.prototype.seek=freeOnUnref(function(e){null!==this.monitorContext&&this.monitorContext.textTrack.clearCue(),d.info(">> seek to "+e+"ms"),this.seekController.seekAndPlay(e)}),Object.defineProperty(t.prototype,"playbackRate",{get:freeOnUnref(function(){return 1}),set:freeOnUnref(function(e){}),enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:freeOnUnref(function(){if(null!=this.syePlayer&&null!=this.syePlayer.getMetadata)return this.syePlayer.getMetadata()}),enumerable:!0,configurable:!0}),Object.defineProperty(t,"frontendInfo",{get:freeOnUnref(function(){return t.stashedFrontendInfo}),enumerable:!0,configurable:!0}),t.prototype.getVolumeFeature=freeOnUnref(function(){return this.volumeFeature}),t.prototype.getPictureInPictureFeature=freeOnUnref(function(){return this.pictureInPictureFeature}),t.prototype.getPlaybackQualityProvider=freeOnUnref(function(){return this.playbackQualityProvider}),t.prototype.getBufferInformationProvider=freeOnUnref(function(){return this.bufferInformationProvider}),t.prototype.getDisplayController=freeOnUnref(function(){return null}),t.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),t.prototype.once=freeOnUnref(function(e,t){this.eventEmitter.once(e,t)}),t.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),t.prototype.show=freeOnUnref(function(){null!=this.syePlayer?this.syePlayer.show():this.isHtmlVideoElement(this.surfaceRef)&&(this.surfaceRef.style.display="")}),t.prototype.hide=freeOnUnref(function(){null!=this.syePlayer?this.syePlayer.hide():this.isHtmlVideoElement(this.surfaceRef)&&(this.surfaceRef.style.display="none")}),t.prototype.isPlayerPlaying=freeOnUnref(function(){if(null==this.syePlayer)return!1;switch(this.syePlayer.playerState()){case fl.SyeClient.SyePlayerState.kStopped:case fl.SyeClient.SyePlayerState.kError:return!1;default:return!0}}),t.prototype.isHtmlVideoElement=freeOnUnref(function(e){return null!=e&&null!=e.tagName&&"video"===e.tagName.toLowerCase()}),t.prototype.updatePlaybackStarted=freeOnUnref(function(){"playing"===this.playbackState&&"ready"===this.contentState&&null!=this.monitorContext&&(this.monitorContext.playbackStarted=!0)}),t.prototype.createContentStateMachine=freeOnUnref(function(){var t=this,e=new ml.FiniteStateMachine("unloaded");e.addTransition("unloaded","load","waiting"),e.addTransition("unloaded","unload","unloaded"),e.addTransition("unloaded","error","error"),e.addTransition("waiting","ready","ready"),e.addTransition("waiting","waiting","waiting"),e.addTransition("waiting","unload","unloading"),e.addTransition("waiting","error","error"),e.addTransition("ready","waiting","waiting"),e.addTransition("ready","ready","ready"),e.addTransition("ready","unload","unloading"),e.addTransition("ready","error","error"),e.addTransition("unloading","unloaded","unloaded"),e.addTransition("unloading","unload","unloading"),e.addTransition("unloading","error","error"),e.addTransition("error","error","error"),e.addTransition("error","unload","unloading"),e.onTransition("unloaded","load",this.onLoad),e.onTransition("waiting","unload",this.onUnload),e.onTransition("ready","unload",this.onUnload),e.onTransition("error","unload",this.onUnload);var n=freeOnUnref(function(e){t.contentError=ct.XpError.generatePrefixedError(e,"sye")});e.onTransition("unloading","error",n),e.onTransition("unloaded","error",n),e.onTransition("waiting","error",n),e.onTransition("ready","error",n),e.onTransition("error","error",freeOnUnref(function(e){d.warn("Received content error while it's already in error state",e)}));var r=void 0,i=freeOnUnref(function(e){r=e});return e.onTransition("ready","waiting",i),e.onEnterState("unloaded",freeOnUnref(function(){t.onContentStateTransition("unloaded")})),e.onEnterState("waiting",freeOnUnref(function(){t.onContentStateTransition("waiting",r),t.excessiveWaitingTimeoutId=oe.timer.setTimeout(freeOnUnref(function(){var e="No Sye Fallback Error History";null!==t.monitorController&&(e=t.monitorController.getSyeFallbackErrorHistory()),t.excessiveWaitingTimeoutHandler(e)}),t.excessiveWaitingTimeoutMs),t.attemptStartMidstreamRetryTimeout(),r=void 0})),e.onLeaveState("waiting",freeOnUnref(function(){null!==t.excessiveWaitingTimeoutId&&(oe.timer.clearTimeout(t.excessiveWaitingTimeoutId),t.excessiveWaitingTimeoutId=null),t.clearMidstreamRetryTimeout()})),e.onEnterState("ready",freeOnUnref(function(){t.onContentStateTransition("ready")})),e.onEnterState("error",freeOnUnref(function(){d.error("contentError: "+JSON.stringify(t.contentError)),t.onContentStateTransition("error")})),e.onIllegalTransition(freeOnUnref(function(e,t,n){d.error("IllegalTransitionError",e," :: ",t)})),e.onEnterState("ready",freeOnUnref(function(){null!==t.monitorController&&t.monitorController.clearSyeFallbackErrorHistory()})),e}),t.prototype.onContentStateTransition=freeOnUnref(function(e,t){this.contentState=e,d.info("ContentState change: "+this.contentState),this.updatePlaybackStarted(),this.eventEmitter.emit("contentStateChange",{contentState:this.contentState,playbackPositionMs:t})}),t.prototype.scheduleCDNSwitch=freeOnUnref(function(e){var t=this;e?this.cdnSwitchTimeoutId=oe.timer.setTimeout(freeOnUnref(function(){t.cdnSwitchTimeoutId=null,t.processCDNSwitch()}),2e3):this.processCDNSwitch()}),t.prototype.processCDNSwitch=freeOnUnref(function(){if(null!==this.contentSource&&null!==this.SyeClientSDK&&null!==this.syePlayer){var e=this.contentSource.sourceUrlStore.get(),t=new this.SyeClientSDK.SyeDomain(e.url,e.cdn),n=new this.SyeClientSDK.SyeSystem(t,e.token);d.info("Update Sye system to "+e.cdn+": "+e.url),this.syePlayer.updateSyeSystem(n),this.seekController.setChannelId(e.channelId),this.playPauseController.executeFailover(),this.clearMidstreamRetryTimeout(),this.attemptStartMidstreamRetryTimeout(),null!=this.monitorController&&this.monitorController.onFrontendFailover()}}),t.prototype.attemptStartMidstreamRetryTimeout=freeOnUnref(function(){null!=this.monitorContext&&this.monitorContext.playbackStarted&&null==this.midstreamRetryTimeoutId&&(this.midstreamRetryTimeoutId=oe.timer.setTimeout(this.midstreamRetryTimeoutHandler,this.maxMidstreamCdnRetryTimeoutMs))}),t.prototype.clearMidstreamRetryTimeout=freeOnUnref(function(){null!=this.midstreamRetryTimeoutId&&(oe.timer.clearTimeout(this.midstreamRetryTimeoutId),this.midstreamRetryTimeoutId=null)}),t.prototype.configureCdnFailoverTimeout=freeOnUnref(function(){var e=L.configurationStore.configuration;null!=e&&null!=e.liveLowLatency&&null!=e.liveLowLatency.cdnFailoverTimeoutMs&&(this.maxMidstreamCdnRetryTimeoutMs=e.liveLowLatency.cdnFailoverTimeoutMs)}),t.prototype.configureExcessiveWaitingTimeout=freeOnUnref(function(){var e=L.configurationStore.configuration;null!=e&&null!=e.liveLowLatency&&null!=e.liveLowLatency.excessiveWaitingTimeoutMs&&(this.excessiveWaitingTimeoutMs=e.liveLowLatency.excessiveWaitingTimeoutMs)}),t.stashedFrontendInfo=null,t})();t.MpPlayerLiveLowLatency=n}));e(tf);tf.MpPlayerLiveLowLatency;var nf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LiveLowLatencyContentSource=dl.LiveLowLatencyContentSource,t.SyeUrlStoreErrorHandlerResult=pl.SyeUrlStoreErrorHandlerResult,t.MpPlayerLiveLowLatency=tf.MpPlayerLiveLowLatency;var n=freeOnUnref(function(){return fl.liveLowLatencyContext.isLiveLowLatencySupported()});t.isLiveLowLatencySupported=n}));e(nf);nf.LiveLowLatencyContentSource,nf.SyeUrlStoreErrorHandlerResult,nf.MpPlayerLiveLowLatency,nf.isLiveLowLatencySupported;var rf=t(freeOnUnref(function(e,t){var M=ce&&ce.__assign||freeOnUnref(function(){return(M=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var C="UNKNOWN",n=de.get("PlaybackResourceRequestV2Factory");function r(e){if(null!=e)return{name:Qe.withDefault(e.name,C),version:Qe.withDefault(e.version,C)}}function E(e){var t=null!=e?e.advertisingId:void 0,n=null!=e?e.optOutAdTracking:void 0,r=null!=e?e.appBundle:void 0,i=null!=e?e.appStoreUrl:void 0,o=null!=e?e.sitePageUrl:void 0,a=null!=e?e.mainContentResumeOffsetHintMillis:0,s=void 0;if(null!=e&&null!=e.gdpr){var l=e.gdpr.gvlString,f=e.gdpr.avlString,u={};null!=l&&(u.GVL=l),null!=f&&(u.AVL=f),s={enabled:e.gdpr.applicable,consentMap:u}}return{advertisingId:t,appBundle:r,appStoreUrl:i,sitePageUrl:o,optOutOfAdTracking:n,gdpr:s,mainContentResumeOffsetHintMillis:a}}var i=freeOnUnref(function(){function e(){this.prsConfig={},this.videoCapabilitiesQuerier=new na.VideoCapabilitiesQuerier;var e=L.configurationStore.configuration;this.prsConfig=null!=e&&null!=e.prs?e.prs:{}}return e.prototype.createVodPlaybackResourcesRequest=freeOnUnref(function(m){var y=this;return this.getCapabilities(m.encodePreferences).then(freeOnUnref(function(e){var t,n=e.videoCapabilityParameters,r=e.drmConfig,i=r.streamingTechnologyV2,o=["CBR","CVBR"];zt.deviceInformation&&zt.deviceInformation.mediaPlayer&&null!=zt.deviceInformation.mediaPlayer.bitrateAdaptations&&(o=zt.deviceInformation.mediaPlayer.bitrateAdaptations),null!=r.bitrateAdaptationOverrideV2&&(o=r.bitrateAdaptationOverrideV2);var a=E(m.adParams),s={hdcpLevel:_a.HDCP_VERSION_CAPABILITY_MAP[zt.deviceCapabilities.output.video.display.hdcpStatus],maxVideoResolution:y.getMaxVideoResolution(n.videoQuality,m.capVideoDefinition),supportedStreamingTechnologies:[i],streamingTechnologies:(t={},t[i]={bitrateAdaptations:o,codecs:n.videoCodec.map(freeOnUnref(function(e){return _a.VIDEO_CODEC_V2_MAP[e]})),drmKeyScheme:r.keyScheme,drmType:r.drmType,dynamicRangeFormats:n.hdrFormats.map(freeOnUnref(function(e){return _a.HDR_FORMAT_V2_MAP[e]})),edgeDeliveryAuthorizationSchemes:y.getEdgeDeliveryAuthorizationSchemes(i),fragmentRepresentations:["ByteOffsetRange","SeparateFile"],frameRates:"HFR"===n.frameRate?["Standard","High"]:["Standard"],stitchType:"DASH"===i?"MultiPeriod":void 0,segmentInfoType:"DASH"===i?"Base":void 0,timedTextRepresentations:y.getVodTimedTextRepresentations(),trickplayRepresentations:y.getVodTrickplayRepresentations(i),variableAspectRatio:y.variableAspectRatioSupported()?"supported":"unsupported"},t),displayWidth:zt.deviceCapabilities.output.video.display.width,displayHeight:zt.deviceCapabilities.output.video.display.height,acceptedCreativeApis:m.acceptedCreativeApis},l=null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.prs&&!0===L.configurationStore.configuration.prs.enablePlaylistingSupport&&null!=L.configurationStore.configuration.prs.playlistSupportedTitles&&-1!==L.configurationStore.configuration.prs.playlistSupportedTitles.indexOf(m.titleId),f=null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.prs&&!0===L.configurationStore.configuration.prs.enablePlaylistingSupport&&!0===L.configurationStore.configuration.prs.enablePlaylistingSupportForTesting,u="DASH"===i||"HLS"===i&&null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.prs&&!0===L.configurationStore.configuration.prs.enablePlaylistingSupportForHLS,c={device:s,ads:a,playbackCustomizations:{capVideoDefinition:m.capVideoDefinition},playbackSettingsRequest:y.createPlaybackSettingsRequest(m.titleId,m.heuristicProfile)},d=m.enablePlaylisting||f||l,p=u&&d?{vodPlaylistedPlaybackUrlsRequest:M({},c)}:{vodPlaybackUrlsRequest:M({},c)},h={deviceCapabilityFamily:Qe.withDefault(zt.deviceInformation.software.deviceFamily,"WebPlayer"),playbackEnvelope:m.playbackEnvelope,titleId:m.titleId,capabilityDiscriminators:y.preparePlayerSpecificProperties(),resources:M({auditPingsRequest:{},fairPlayApplicationCertificateRequest:"HLS"===i?{}:void 0,playbackDataRequest:{},timedTextUrlsRequest:{supportedTimedTextFormats:["TTMLv2","DFXP"]},trickplayUrlsRequest:{},transitionTimecodesRequest:{}},p)};return null!=m.xrayConfig&&(h.resources.vodXrayMetadataRequest={xrayDeviceClass:m.xrayConfig.deviceClass,xrayPlaybackMode:m.xrayConfig.playbackMode,xrayToken:m.xrayConfig.token}),h}))}),e.prototype.createLivePlaybackResourcesRequest=freeOnUnref(function(b){var P=this;return this.getCapabilities(b.encodePreferences,b.streamStartOverrides).then(freeOnUnref(function(e){var t,n=e.videoCapabilityParameters,r=e.drmConfig,i=r.streamingTechnologyV2,o=zt.deviceInformation.hardware.isHighPerformance,a=[];null!=r&&r.patternManifestSupported&&a.push("PatternTemplate"),!0===o&&a.push("Accumulating"),a.push("Live");var s=["CBR","CVBR"];null!=r.bitrateAdaptationOverrideV2&&(s=r.bitrateAdaptationOverrideV2);var l=P.createPlayableLiveManifestTypes(a),f=void 0;"disabled"!==P.prsConfig.liveEmbeddedTrickplay&&(f=["None","InManifest"]);var u,c,d=(u=b.adParams,{advertisingId:(c=E(u)).advertisingId,optOutAdTracking:c.optOutOfAdTracking,gdpr:c.gdpr}),p={firmwareVersion:Qe.nestedValue(zt.deviceInformation,"software.firmware.version",C),hdcpLevel:_a.HDCP_VERSION_CAPABILITY_MAP[zt.deviceCapabilities.output.video.display.hdcpStatus],liveManifestTypes:a,playableLiveManifestTypes:l,maxVideoResolution:"2160p",operatingSystem:zt.deviceInformation.software.operatingSystem.name,supportedStreamingTechnologies:[i],streamingTechnologies:(t={},t[i]={bitrateAdaptations:s,codecs:n.videoCodec.map(freeOnUnref(function(e){return _a.VIDEO_CODEC_V2_MAP[e]})),drmKeyScheme:r.keyScheme,drmType:r.drmType,dynamicRangeFormats:n.hdrFormats.map(freeOnUnref(function(e){return _a.HDR_FORMAT_V2_MAP[e]})),edgeDeliveryAuthorizationSchemes:P.getEdgeDeliveryAuthorizationSchemesForLive(i),fragmentRepresentations:["ByteOffsetRange","SeparateFile"],frameRates:"HFR"===n.frameRate?["Standard","High"]:["Standard"]},t),thumbnailRepresentations:f,acceptedCreativeApis:b.acceptedCreativeApis},h=!0===b.preserveStreamingAffinity?P.getCdnAffinity():null,m={deviceCapabilityFamily:Qe.withDefault(zt.deviceInformation.software.deviceFamily,"WebPlayer"),playbackEnvelope:b.playbackEnvelope,titleId:b.titleId,sessionTrackingMode:"WITH_SESSION_HANDOFF",userWatchSessionId:b.userWatchSessionId,capabilityDiscriminators:P.preparePlayerSpecificProperties(),resources:{auditPingsRequest:{},fairPlayApplicationCertificateRequest:"HLS"===i?{}:void 0,playbackDataRequest:{}}};P.shouldBlockDashRequest(b.streamStartOverrides)||(m.resources.livePlaybackUrlsRequest={ads:d,capVideoDefinition:b.capVideoDefinition,device:p,playbackSettingsRequest:P.createPlaybackSettingsRequest(b.titleId,b.heuristicProfile)});var y,g,v=null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.liveLowLatency&&!0===L.configurationStore.configuration.liveLowLatency.disable;if(b.isLiveLowLatencySupported&&!Ra.shouldBlockSyeUrlsRequest(b.clientId)&&!v){var O=zt.deviceInformation.software.operatingSystem,S=null,U=(y=b.adParams,{advertisingId:(g=E(y)).advertisingId,appBundle:g.appBundle,appStoreUrl:g.appStoreUrl,sitePageUrl:g.sitePageUrl,optOutAdTracking:g.optOutOfAdTracking,gdpr:g.gdpr});null!=zt.deviceInformation.software.browser?S=zt.deviceInformation.software.browser:null!=zt.deviceInformation.software.middleware&&null!=zt.deviceInformation.software.middleware.userAgent&&(S=zt.deviceInformation.software.middleware),m.resources.syeUrlsRequest=M({ads:U,device:{browserName:Qe.nestedValue(S,"name",void 0),browserVersion:Qe.nestedValue(S,"version",void 0),codecs:n.videoCodec.map(freeOnUnref(function(e){return _a.VIDEO_CODEC_V2_MAP[e]})),deviceModel:Qe.nestedValue(zt.deviceInformation,"hardware.model.name",void 0),dynamicRangeFormats:n.hdrFormats.map(freeOnUnref(function(e){return _a.HDR_FORMAT_V2_MAP[e]})),firmware:Qe.nestedValue(zt.deviceInformation,"software.firmware.version",void 0),frameRates:"HFR"===n.frameRate?["Standard","High"]:["Standard"],hdcpLevel:_a.HDCP_VERSION_CAPABILITY_MAP[zt.deviceCapabilities.output.video.display.hdcpStatus],manufacturer:Qe.withDefault(zt.deviceInformation.hardware.manufacturer,void 0),operatingSystemName:Qe.nestedValue(O,"name",void 0),operatingSystemVersion:Qe.nestedValue(O,"version",void 0),playerType:"xp",clientVersion:Qe.nestedValue(zt.deviceInformation,"software.playerBundle.version",void 0),acceptedCreativeApis:b.acceptedCreativeApis}},null!=h?{cdnAffinity:h}:{})}return null!=b.xrayConfig&&(m.resources.xrayMetadataRequest={preferredLocale:b.xrayConfig.preferredLocale,xrayDeviceClass:b.xrayConfig.deviceClass,xrayPlaybackMode:b.xrayConfig.playbackMode,xrayToken:b.xrayConfig.token,exploreClientCapabilitiesToken:b.xrayConfig.exploreClientCapabilitiesToken}),null!=b.playbackExperiences&&x.contains(b.playbackExperiences,ka.PlaybackExperience.RapidRecap)&&(m.resources.rapidRecapRequest={capVideoDefinition:b.capVideoDefinition,device:p,playbackSettingsRequest:P.createPlaybackSettingsRequest(b.titleId,b.heuristicProfile)}),m}))}),e.prototype.createLiveLinearPlaybackResourcesRequest=freeOnUnref(function(p){var h=this;return this.getCapabilities(p.encodePreferences).then(freeOnUnref(function(e){var t,n=e.videoCapabilityParameters,r=e.drmConfig,i=r.streamingTechnologyV2,o=zt.deviceInformation.hardware.isHighPerformance,a=[];null!=r&&r.patternManifestSupported&&a.push("PatternTemplate"),!0===o&&a.push("Accumulating"),a.push("Live");var s=["CBR","CVBR"];zt.deviceInformation&&zt.deviceInformation.mediaPlayer&&null!=zt.deviceInformation.mediaPlayer.bitrateAdaptations&&(s=zt.deviceInformation.mediaPlayer.bitrateAdaptations),null!=r.bitrateAdaptationOverrideV2&&(s=r.bitrateAdaptationOverrideV2);var l,f,u=h.createPlayableLiveManifestTypes(a),c=(l=p.adParams,{advertisingId:(f=E(l)).advertisingId,gdpr:f.gdpr,appBundle:f.appBundle,appStoreUrl:f.appStoreUrl,optOutAdTracking:f.optOutOfAdTracking,sitePageUrl:f.sitePageUrl}),d={acceptedCreativeApis:p.acceptedCreativeApis,firmwareVersion:Qe.nestedValue(zt.deviceInformation,"software.firmware.version",C),hdcpLevel:_a.HDCP_VERSION_CAPABILITY_MAP[zt.deviceCapabilities.output.video.display.hdcpStatus],maxVideoResolution:"2160p",operatingSystem:zt.deviceInformation.software.operatingSystem.name,playableLiveManifestTypes:u,supportedStreamingTechnologies:[i],streamingTechnologies:(t={},t[i]={bitrateAdaptations:s,codecs:n.videoCodec.map(freeOnUnref(function(e){return _a.VIDEO_CODEC_V2_MAP[e]})),drmKeyScheme:r.keyScheme,drmType:r.drmType,dynamicRangeFormats:n.hdrFormats.map(freeOnUnref(function(e){return _a.HDR_FORMAT_V2_MAP[e]})),edgeDeliveryAuthorizationSchemes:h.getEdgeDeliveryAuthorizationSchemesForLive(i),fragmentRepresentations:["ByteOffsetRange","SeparateFile"],frameRates:"HFR"===n.frameRate?["Standard","High"]:["Standard"]},t)};return{deviceCapabilityFamily:Qe.withDefault(zt.deviceInformation.software.deviceFamily,"WebPlayer"),playbackEnvelope:p.playbackEnvelope,titleId:p.titleId,sessionTrackingMode:"WITH_SESSION_HANDOFF",userWatchSessionId:p.userWatchSessionId,capabilityDiscriminators:h.preparePlayerSpecificProperties(),resources:{auditPingsRequest:{},fairPlayApplicationCertificateRequest:"HLS"===i?{}:void 0,playbackDataRequest:{},liveLinearPlaybackUrlsRequest:{ads:c,playbackCustomizations:{capVideoDefinition:p.capVideoDefinition},device:d,playbackSettingsRequest:h.createPlaybackSettingsRequest(p.titleId,p.heuristicProfile)}}}}))}),e.prototype.createPlaybackSettingsRequest=freeOnUnref(function(e,t){var n=Qe.nestedValue(zt.deviceInformation,"hardware.model.name",null);return{deviceModel:null==n?void 0:n,firmware:Qe.nestedValue(zt.deviceInformation,"software.firmware.version",C),heuristicProfile:null!=t?JSON.stringify(t.profilePriorities):void 0,playerType:"xp",responseFormatVersion:"1.0.0",titleId:e}}),e.prototype.preparePlayerSpecificProperties=freeOnUnref(function(){var e=zt.deviceInformation.software.operatingSystem,t=zt.deviceCapabilities.output.video.display.hfrMediaCapabilityMode;return{operatingSystem:r(e),deviceModel:r(zt.deviceInformation.hardware.model),middleware:r(zt.deviceInformation.software.middleware),scriptEngine:r(zt.deviceInformation.software.scriptEngine),nativeApplication:r(zt.deviceInformation.software.nativeApplication),nativeRuntime:r(zt.deviceInformation.software.nativeRuntime),firmware:r(zt.deviceInformation.software.firmware),chipset:zt.deviceInformation.hardware.chipset,hfrControlMode:"Detected"===t?_r.HfrControlMode.Player:_r.HfrControlMode.Legacy,displayResolution:{height:zt.deviceCapabilities.output.video.display.height,width:zt.deviceCapabilities.output.video.display.width}}}),e.prototype.createPlayableLiveManifestTypes=freeOnUnref(function(e){for(var t="disabled"!==this.prsConfig.liveDaiTimeshiftingTrickplay?"supported":"notSupported",n="disabled"!==this.prsConfig.liveEmbeddedTrickplay?"supported":"notSupported",r=!0===this.prsConfig.disableDaiTimeshifting?"notSupported":"supported",i={},o={Live:{daiSettings:{supportsDai:"supported",supportedDaiFeatures:{supportsEmbeddedTrickplay:t}},embeddedTrickplaySettings:{supportsEmbeddedTrickplay:n}},Accumulating:{daiSettings:{supportsDai:r,supportedDaiFeatures:{supportsEmbeddedTrickplay:t}},embeddedTrickplaySettings:{supportsEmbeddedTrickplay:n}},PatternTemplate:{daiSettings:{supportsDai:r,supportedDaiFeatures:{supportsEmbeddedTrickplay:t}},embeddedTrickplaySettings:{supportsEmbeddedTrickplay:n}}},a=0,s=e;a<s.length;a++){var l=s[a];i[l]=o[l]}return i}),e.prototype.getCapabilities=freeOnUnref(function(e,t){var n=this.videoCapabilitiesQuerier.queryCapabilities(e,t),r=ta.DrmConfigResolver.resolve();return lt.Promise.all([n,r]).then(freeOnUnref(function(e){var t=e[0],n=e[1];if(null==n)throw new Error("DRM is not supported in this device.");return{videoCapabilityParameters:t,drmConfig:n}}))}),e.prototype.getCdnAffinity=freeOnUnref(function(){if(null!=nf.MpPlayerLiveLowLatency.frontendInfo){var e=nf.MpPlayerLiveLowLatency.frontendInfo;if(null!=e.cdn&&null!=e.pop)return n.info("CDN affinity preserved: "+e.cdn+"/"+e.pop),q.metrics.putMetric("DTH.NextUp.CDNAffinity.Preserved",1),{cdn:e.cdn,pop:e.pop}}return q.metrics.putMetric("DTH.NextUp.CDNAffinity.Preserved",0),null}),e.prototype.getVodTrickplayRepresentations=freeOnUnref(function(e){var t=["NotInManifestNorStream"];return("DASH"===e&&!0===this.prsConfig.enableEmbeddedTrickplayForVodDash||"HLS"===e&&!0===this.prsConfig.enableEmbeddedTrickplayForVodHls)&&t.push("SeparateStreamInManifest"),t}),e.prototype.getVodTimedTextRepresentations=freeOnUnref(function(){return!1!==this.prsConfig.enableEmbeddedTimedTextForVod?["NotInManifestNorStream","SeparateStreamInManifest"]:["NotInManifestNorStream"]}),e.prototype.variableAspectRatioSupported=freeOnUnref(function(){if(!0===Qe.nestedValue(L.configurationStore,"configuration.capabilities.supportsVariableAspectRatio"))return!0;var e=zt.deviceCapabilities.output.video.display.supportsVariableAspectRatio;return null!=e&&e}),e.prototype.getMaxVideoResolution=freeOnUnref(function(e,t){var n=this.prsConfig.maxVideoResolutionOverride;if(null!=n&&-1<["480p","576p","720p","1080p","2160p"].indexOf(n))return n;switch(null!=t?t:e){case"UHD":return"2160p";case"HD":return"1080p";default:return"576p"}}),e.prototype.getEdgeDeliveryAuthorizationSchemes=freeOnUnref(function(e){return!0===this.prsConfig.enableTokenAuth&&"HLS"!==e?["PVExchangeV1","Transparent"]:void 0}),e.prototype.getEdgeDeliveryAuthorizationSchemesForLive=freeOnUnref(function(e){return!0===this.prsConfig.enableTokenAuthForLive&&"HLS"!==e?["PVExchangeV1","Transparent"]:void 0}),e.prototype.shouldBlockDashRequest=freeOnUnref(function(e){return null!=e&&!0===e.disableDashForLive}),e})();t.PlaybackResourceRequestV2Factory=i}));e(rf);rf.PlaybackResourceRequestV2Factory;var of=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("PlaybackUrlsOptionsFactory"),n=freeOnUnref(function(){function e(){}return e.create=freeOnUnref(function(){var s=this;return ta.DrmConfigResolver.resolve().then(freeOnUnref(function(e){var t=[];null!=e&&e.patternManifestSupported&&t.push("patternTemplate"),!0===zt.deviceInformation.hardware.isHighPerformance&&t.push("accumulating"),t.push("live");var n={audioTrackId:"all",languageFeature:"MLFv2",liveManifestType:t,daiLiveManifestType:t,supportsEmbeddedTrickplay:!0,daiSupportsEmbeddedTrickplay:!0},r=L.configurationStore.configuration;if(null!=r&&null!=r.prs){var i=r.prs;!0===i.disableDaiTimeshifting&&delete n.daiLiveManifestType,"disabled"===i.liveEmbeddedTrickplay&&delete n.supportsEmbeddedTrickplay,"disabled"===i.liveDaiTimeshiftingTrickplay&&delete n.daiSupportsEmbeddedTrickplay}null!=e&&(n.ssaiStitchType=e.ssaiStitchType,n.ssaiSegmentInfoSupport=e.ssaiSegmentInfoSupport);var o=s.computeVideoMaxBitrateBps();null!==o&&(n.videoMaxBitrateBps=o);var a=null!=e?e.prefix:null;return null==a?l.warn("No keySystem is available"):"com.widevine.alpha"===a?n.drmKeyScheme="DUAL_KEY":0===a.indexOf("com.microsoft.playready")||0===a.indexOf("com.apple.fps")||0===a.indexOf("com.chromecast.playready")?n.drmKeyScheme="SINGLE_KEY":l.warn("Unexpected supported keySystem '"+a+"'"),n}))}),e.computeVideoMaxBitrateBps=freeOnUnref(function(){var e=Qe.nestedValue(zt.deviceInformation,"mediaSource.maxVideoBitrate");return null!==e&&this.isSaneBitrate(e)?Math.floor(e):null}),e.isSaneBitrate=freeOnUnref(function(e){return e<1e12}),e})();t.PlaybackUrlsOptionsFactory=n}));e(of);of.PlaybackUrlsOptionsFactory;var af=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.MAX_AUDIO_BANDWIDTH_BPS=449e3}return e.prototype.isQualityLevelSupported=freeOnUnref(function(e,t){if("Audio"===e.type){var n=ci.CodecParser.parseAudioCodec(t.codecs);if(192e3===t.bandwidth&&null!=n&&"AACL"===n.codec)return!1;if(t.bandwidth>=this.MAX_AUDIO_BANDWIDTH_BPS)return!1}return!0}),e})();t.AudioQualityLevelFilter=n}));e(af);af.AudioQualityLevelFilter;var sf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.AUDIO_SUBTYPE_MAP={dialog:"Dialog",descriptive:"Descriptive",commentary:"Commentary",boosteddialoglow:"BoostedDialogLow",boosteddialogmedium:"BoostedDialogMedium",boosteddialoghigh:"BoostedDialogHigh",filteredcontent:"FilteredContent",dialogmachinegenerated:"DialogMachineGenerated"}}));e(sf);sf.AUDIO_SUBTYPE_MAP;var lf=t(freeOnUnref(function(e,t){var a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var l="periodId",f="streamId",u="qualityLevelId",c="index",d="byteOffset",p="customSuffix",h="init";function s(e,t,n,r,i,o,a){var s=new mt.URLSearchParams;return s.append(l,t),s.append(f,n),s.append(u,r),null!=o?s.append(d,o.toString()):null!=i&&(i.isInitSegment?s.append(c,h):s.append(c,i.index.toString())),null!=a&&s.append(p,a),e+"/segment_data/"+s.toString()}function m(e){var t=e.indexOf("/");if(-1===t)return null;var n=e.substring(0,t),r=new mt.URLSearchParams(e.substring(e.lastIndexOf("/")+1)),i=r.get(l),o=r.get(f),a=r.get(u);if(null==i||null==o||null==a)return null;var s=r.get(p);return{params:r,keyParts:{downloadOperationId:n,periodId:i,streamId:o,qualityLevelId:a,customSuffix:s}}}t.createLocalStorageSegmentId=function(e,t,n,r,i){return s(e,t,n,r,i,null!=i.byteRange?i.byteRange.start:void 0)},t.createLocalStorageSegmentIdWithByteOffset=function(e,t,n,r,i,o){return s(e,t,n,r,void 0,i,o)},t.getKeyPartsFromLocalStorageSegmentIdWithSegmentIndex=function(e){var t=m(e);if(null==t)return null;var n=t.params,r=t.keyParts,i=n.get(c);if(null==i)return null;var o=parseInt(i);return isNaN(o)?i===h?a({},r,{segmentIndex:i}):null:a({},r,{segmentIndex:o})},t.getKeyPartsFromLocalStorageSegmentIdWithByteOffset=function(e){var t=m(e);if(null==t)return null;var n=t.params,r=t.keyParts,i=n.get(d),o=null!=i?parseInt(i):null;return null==o||isNaN(o)?null:a({},r,{byteOffset:o})}}));e(lf);lf.createLocalStorageSegmentId,lf.createLocalStorageSegmentIdWithByteOffset,lf.getKeyPartsFromLocalStorageSegmentIdWithSegmentIndex,lf.getKeyPartsFromLocalStorageSegmentIdWithByteOffset;var ff=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.cancelUpdate=null,this.suspendSegmentQuery=!1,this.updatePromise=null,this.acquireManifest=e,this.processManifest=t}return e.prototype.waitUpdate=freeOnUnref(function(){return null===this.updatePromise?lt.Promise.reject(new Error("No update is ongoing")):this.updatePromise}),e.prototype.update=freeOnUnref(function(t){var e,n=this;if(void 0===t&&(t=!1),!t&&null!==this.updatePromise)return this.updatePromise;null!==this.cancelUpdate&&this.cancelUpdate();var r=lt.CancelToken.source(),i=r.token,o=r.cancel;this.cancelUpdate=o;var a=(e=this.acquireManifest().then(freeOnUnref(function(e){return i.throwIfRequested(),n.processManifest(e),t&&(n.suspendSegmentQuery=!1),e}))).then.apply(e,lt.FINALLY(freeOnUnref(function(){a===n.updatePromise&&(n.cancelUpdate=null,n.updatePromise=null)})));return this.updatePromise=a,t&&(this.suspendSegmentQuery=!0),this.updatePromise}),e.prototype.stop=freeOnUnref(function(){null!==this.cancelUpdate&&(this.cancelUpdate(),this.cancelUpdate=null,this.updatePromise=null),this.suspendSegmentQuery=!1}),e.prototype.shouldSuspendSegmentQuery=freeOnUnref(function(){return this.suspendSegmentQuery}),e})();t.ManifestAcquirer=n}));e(ff);ff.ManifestAcquirer;var uf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("ManifestRefresher"),n=freeOnUnref(function(){function e(e,t,n){void 0===n&&(n=null);var r=this;this.timer=oe.timer,this.refresh=freeOnUnref(function(){r.manifestUpdater.update().then(freeOnUnref(function(e){null!=r.waitDeferred&&(r.manifest=e,r.actualUpdatePeriodMs=r.getActualUpdatePeriodMs(),r.waitDeferred.resolve(),null!=r.actualUpdatePeriodMs?(r.waitDeferred=new lt.Deferred,r.refreshIntervalId=r.timer.setTimeout(r.refresh,r.actualUpdatePeriodMs)):(i.info("ManifestMetadata.minimumUpdatePeriod removed. Stopping refresher."),r.waitDeferred=null))})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||i.error("An error occurred while updating the manifest:",e),null==r.waitDeferred?i.warn("Stopping the refresher."):r.refreshIntervalId=r.timer.setTimeout(r.refresh,500)}))}),this.manifest=e,this.manifestUpdater=t,this.waitDeferred=null,this.schedulerSettings=n,this.expectedTimeBehindLiveMs=0}return Object.defineProperty(e.prototype,"updatePeriodMs",{get:freeOnUnref(function(){return Qe.withDefault(this.actualUpdatePeriodMs,this.manifest.minimumUpdatePeriodMs)}),enumerable:!0,configurable:!0}),e.prototype.waitRefresh=freeOnUnref(function(){return null==this.waitDeferred?lt.Promise.reject(new Error("Not refreshing the manifest")):this.waitDeferred.promise}),e.prototype.start=freeOnUnref(function(e){if(null!=this.refreshIntervalId)throw new Error("Attempted to restart manifest refreshing while already refreshing");this.expectedTimeBehindLiveMs=e,this.actualUpdatePeriodMs=this.getActualUpdatePeriodMs(),null!=this.actualUpdatePeriodMs?(this.refreshIntervalId=this.timer.setTimeout(this.refresh,this.actualUpdatePeriodMs),this.waitDeferred=new lt.Deferred):i.info("Not starting refresher")}),e.prototype.stop=freeOnUnref(function(){null!=this.refreshIntervalId&&(this.timer.clearTimeout(this.refreshIntervalId),this.refreshIntervalId=void 0),this.actualUpdatePeriodMs=void 0,null!=this.waitDeferred&&(this.waitDeferred.reject(new lt.CancelError),this.waitDeferred=null)}),e.prototype.getActualUpdatePeriodMs=freeOnUnref(function(){return null==this.manifest.minimumUpdatePeriodMs?void 0:null!=this.schedulerSettings&&this.schedulerSettings.isMinUpdatePeriodEnforced?this.manifest.minimumUpdatePeriodMs:Math.max(this.manifest.minimumUpdatePeriodMs,this.expectedTimeBehindLiveMs-1e4)}),e})();t.ManifestRefresher=n}));e(uf);uf.ManifestRefresher;var cf=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("AudioStreamFilterHelper"),r=((n={}).AACL="AAC",n.EAC3="EC3",n),u={buildMediaDecodingConfiguration:freeOnUnref(function(e,t){return{audio:{contentType:e+'; codecs="'+t.codecs+'"',bitrate:t.bandwidth,samplerate:t.samplingRate}}}),buildBlocklistItem:freeOnUnref(function(e){return{bandwidth:e.bandwidth,codecs:e.codecs,samplingRate:e.samplingRate}}),isQualityLevelBlocklisted:freeOnUnref(function(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i.bandwidth===e.bandwidth&&i.codecs===e.codecs&&i.samplingRate===e.samplingRate)return!0}return!1}),generateKey:freeOnUnref(function(e,t){return[e,t.codecs,t.bandwidth,t.samplingRate].join("_")}),getConfigurationStoreBlocklist:freeOnUnref(function(e){var t=L.configurationStore.configuration;if(null==t||null==t.capabilities||null==t.capabilities.codecBlocklist)return[];var n=t.capabilities.codecBlocklist.Audio;return null==n||0===n.length?[]:e.qualityLevels.filter(freeOnUnref(function(e){var t=ci.CodecParser.parseAudioCodec(e.codecs);return null!=t&&x.contains(n,r[t.codec])})).map(freeOnUnref(function(e){return{codecs:e.codecs,bandwidth:e.bandwidth,samplingRate:e.samplingRate}}))}),determineCodecsCapabilities:freeOnUnref(function(e,t,n){var r=p(e.qualityLevels),i=[];if(null==r)return f.error("groupedCodecs cannot be null, returning an empty blocklist array"),lt.Promise.resolve(i);for(var o=[],a=0,s=Object.keys(r);a<s.length;a++){var l=d(r[s[a]]);o.push(c(l,e,t,i,n))}return lt.Promise.all(o).then(freeOnUnref(function(){return i}))})};function c(e,n,r,i,o){for(var a=lt.Promise.resolve(!1),t=freeOnUnref(function(t){a=a.then(freeOnUnref(function(e){return e||function(t,e,n,r,i){var o=u.generateKey(e.mimeType,t),a=n[o];if(null!=a)return a;var s=u.buildMediaDecodingConfiguration(e.mimeType,t);r[e.type]++;var l=Mi.mediaCapabilities.decodingInfo(s).then(freeOnUnref(function(e){return e||i.push(u.buildBlocklistItem(t)),e})).catch(freeOnUnref(function(e){return i.push(u.buildBlocklistItem(t)),f.error("Error checking quality level support "+JSON.stringify(s)+":",e),!1}));return n[o]=l}(t,n,o,r,i)}))}),s=0,l=e;s<l.length;s++){t(l[s])}return a}function d(e){return e.sort(freeOnUnref(function(e,t){return(null!=t.bandwidth?t.bandwidth:0)-(null!=e.bandwidth?e.bandwidth:0)}))}function p(e){if(0===e.length)return f.error("AudioQualityLevels should not be an empty array"),null;for(var t={},n=0,r=e;n<r.length;n++){var i=r[n],o=ci.CodecParser.parseAudioCodec(i.codecs),a=null!=o?o.codec:i.codecs;null==t[a]&&(t[a]=[]),t[a].push(i)}return t}t.AudioStreamFilterHelper=u,t.sortQualityLevels=d,t.groupCodecs=p}));e(cf);cf.AudioStreamFilterHelper,cf.sortQualityLevels,cf.groupCodecs;var df=t(freeOnUnref(function(e,t){var n,r,i,o,a;Object.defineProperty(t,"__esModule",{value:!0});var y=de.get("VideoStreamFilterHelper"),s=90,l=160,f="24",g="unknown",v={buildMediaDecodingConfiguration:freeOnUnref(function(e,t){return{video:{contentType:e+'; codecs="'+t.codecs+'"',width:Qe.withDefault(t.width,s),height:Qe.withDefault(t.height,l),framerate:Qe.withDefault(t.frameRate,f),bitrate:t.bandwidth}}}),buildBlocklistItem:freeOnUnref(function(e){return{bandwidth:e.bandwidth,codecs:e.codecs,height:e.height,width:e.width,frameRate:e.frameRate}}),isQualityLevelBlocklisted:freeOnUnref(function(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i.bandwidth===e.bandwidth&&i.codecs===e.codecs&&i.height===e.height&&i.width===e.width&&i.frameRate===e.frameRate)return!0}return!1}),generateKey:freeOnUnref(function(e,t){return[e,t.codecs,t.bandwidth,t.height,t.width,t.frameRate].join("_")}),getConfigurationStoreBlocklist:freeOnUnref(function(e){return function(e){var t=[],n=L.configurationStore.configuration;if("Video"!==e.type||null==n||null==n.capabilities||null==n.capabilities.maxQualities)return[];var r=n.capabilities.maxQualities.Video;if(null==r||0===r.length)return[];return t.push.apply(t,e.qualityLevels.filter(freeOnUnref(function(e){for(var t=0,n=r;t<n.length;t++)if(h(n[t],e))return!0;return!1}))),t}(e)}),determineCodecsCapabilities:freeOnUnref(function(e,t,n){var r=c(e.qualityLevels),i=[];if(null==r)return y.error("groupedCodecs cannot be null, returning an empty blocklist array"),lt.Promise.resolve(i);for(var o=[],a=0,s=Object.keys(r);a<s.length;a++){var l=s[a];o.push(u(i,n,r,l,e,t))}return lt.Promise.all(o).then(freeOnUnref(function(){return i}))})};function O(e,n,t){if(t)return lt.Promise.all(e.map(n)).then(freeOnUnref(function(e){return e.some(freeOnUnref(function(e){return e}))}));for(var r=lt.Promise.resolve(!1),i=freeOnUnref(function(t){r=r.then(freeOnUnref(function(e){return e||n(t)}))}),o=0,a=e;o<a.length;o++){i(a[o])}return r}function u(o,a,s,p,h,m){var l,e=(l=p,Object.keys(s[p]).sort(freeOnUnref(function(e,t){return i=t,o=S(n=l,r=e),a=S(n,i),null==o||null==a?r.localeCompare(i):o-a;var n,r,i,o,a}))),t=e.some(freeOnUnref(function(e){return-1!==e.indexOf(g)}));return O(e,freeOnUnref(function(e){return l=o,f=a,t=e,u=h,c=m,d=s[p][t],i=Object.keys(d),n=i.sort(U),r=n.some(freeOnUnref(function(e){return-1!==e.indexOf(g)})),O(n,freeOnUnref(function(e){return t=d[e],n=u,r=c,i=l,o=f,a=1<t.length?b(t):t,s=a.some(freeOnUnref(function(e){return-1!==e.codecs.indexOf(g)})),O(a,freeOnUnref(function(e){return function(t,e,n,r,i){var o=v.generateKey(e.mimeType,t),a=n[o];if(null!=a)return a;var s=v.buildMediaDecodingConfiguration(e.mimeType,t),l=Mi.mediaCapabilities.decodingInfo(s).then(freeOnUnref(function(e){return e||i.push(v.buildBlocklistItem(t)),e})).catch(freeOnUnref(function(e){return i.push(v.buildBlocklistItem(t)),y.error("[checkQualityLevelSupport] Error checking quality level support "+JSON.stringify(s)+":",e),!1}));return n[o]=l,r[e.type]++,l}(e,n,o,r,i)}),s);var t,n,r,i,o,a,s}),r);var l,f,t,u,c,d,n,r,i}),t)}function c(e){if(0===e.length)return y.error("VideoQualityLevels should not be an empty array"),null;for(var t={},n=g+"_codec",r=g+"_profile",i=g+"_level",o=0,a=e;o<a.length;o++){var s=a[o],l=ci.CodecParser.parseVideoCodec(s.codecs),f=void 0,u=void 0,c=void 0;null==l?(y.error("Failed to parse codec: "+s.codecs),f=n,u=r,c=i):(f=l.codec,u=null!=l.profile?l.profile:r,c=null!=l.level?l.level:i);var d=t[f];null==d&&(d=t[f]={});var p=d[u];null==p&&(p=d[u]={});var h=p[c];null==h&&(h=p[c]=[]),t[f][u][c].push(s)}return t}t.VideoStreamFilterHelper=v,t.groupCodecs=c;var d=((n={}).DVHE=((r={})["dvav.se"]=1,r["dvhe.st"]=2,r["dvhe.dtb"]=3,r["dvhe.stn"]=4,r["dvhe.dtr"]=5,r),n.HEVC=((i={}).Main10=1,i.Main=2,i),n.AV1=((o={}).Professional=1,o.High=2,o.Main=3,o),n.AVC=((a={}).High=1,a.Main=2,a.Baseline=3,a),n);function S(e,t){var n=d[e];if(null==n)return null;var r=n[t];return null==r?null:r}function U(e,t){var n=parseFloat(e),r=parseFloat(t);return isNaN(n)&&isNaN(r)?0:isNaN(n)?1:isNaN(r)?-1:r-n}function p(e,t){return e.height!==t.height?(null!=t.height?t.height:-1)-(null!=e.height?e.height:-1):e.width!==t.width?(null!=t.width?t.width:-1)-(null!=e.width?e.width:-1):(null!=t.bandwidth?t.bandwidth:-1)-(null!=e.bandwidth?e.bandwidth:-1)}function b(e){return e.sort(p)}function h(e,t){for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],o=e[i],a=t[i];if(null==o||null==a)return!1;var s=In.stringToNumber(o);if(isNaN(s))return!1;if("number"==typeof a&&a<=s)return!1;if("frameRate"===i&&"string"==typeof a){var l=In.stringToNumber(a);if(isNaN(l)||l<=s)return!1}}return!0}t.sortQualityLevels=b}));e(df);df.VideoStreamFilterHelper,df.groupCodecs,df.sortQualityLevels;var pf=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={}).Audio=cf.AudioStreamFilterHelper,n.Video=df.VideoStreamFilterHelper,n.TimedText=null,n.Image=null,n);t.STREAM_FILTER_HELPER_MAP=r}));e(pf);pf.STREAM_FILTER_HELPER_MAP;var hf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("MediaCapabilitiesFilter");function f(e){for(var t=0,n=Object.keys(e);t<n.length;t++){if(0!==e[n[t]].length)return!1}return!0}var n=freeOnUnref(function(){function n(){var e,t,i=this;this.blocklists=((e={}).Audio={},e.Video={},e.TimedText={},e.Image={},e),this.diagnostics=nn.Diagnostics.create("MediaCapabilitiesFilter"),this.mediaDecodeQueryCounts=((t={}).Audio=0,t.Video=0,t.TimedText=0,t.Image=0,t),this.requestedChecks={},this.cachedCodecQueryResults={},this.xpConfiguration=L.configurationStore.configuration,this.useLegacyMode=null!=this.xpConfiguration&&null!=this.xpConfiguration.codecQuerier&&null!=this.xpConfiguration.codecQuerier.mode&&"LegacyMode"===this.xpConfiguration.codecQuerier.mode,this.isQualityLevelSupported=freeOnUnref(function(e,t){var n=i.blocklists[e.type][e.mimeType],r=pf.STREAM_FILTER_HELPER_MAP[e.type];return!(null!=n&&0<n.length&&null!=r)||!r.isQualityLevelBlocklisted(t,n)})}return n.create=freeOnUnref(function(e){var t=new n;return t.initialize(e).then(freeOnUnref(function(){return t}))}),n.prototype.initialize=freeOnUnref(function(e){for(var r=this,i=Date.now(),t=[],n=0,o=e.periods.contents;n<o.length;n++)for(var a=0,s=o[n].streams;a<s.length;a++){var l=s[a];t.push(this.checkStream(l))}return lt.Promise.all(t).then(freeOnUnref(function(){var e,t=Date.now(),n=t-i;q.metrics.putMetric("Filter.MediaCapabilities.Time",n,"ms"),r.diagnostics.report("ttff",{mediaCapabilitiesFilterStartTime:i,mediaCapabilitiesFilterEndTime:t,mediaCapabilitiesFilterQueryCountAudio:r.mediaDecodeQueryCounts.Audio,mediaCapabilitiesFilterQueryCountVideo:r.mediaDecodeQueryCounts.Video}),250<n&&u.warn("Excessive media capabilities filter time: "+n+"ms"),f((e=r.blocklists).Audio)&&f(e.Video)&&f(e.TimedText)||u.warn("Blocklists: "+JSON.stringify(r.blocklists))}))}),n.prototype.checkStream=freeOnUnref(function(e){var t=pf.STREAM_FILTER_HELPER_MAP[e.type];return null==t?lt.Promise.resolve():this.processCodecCapabilitiesCheck(t,e)}),n.prototype.getBlocklist=freeOnUnref(function(e){var t=this.blocklists[e.type];return null==t[e.mimeType]&&(t[e.mimeType]=[]),t[e.mimeType]}),n.prototype.processCodecCapabilitiesCheck=freeOnUnref(function(e,t){return this.useLegacyMode?this.useLegacyModeDetection(e,t):this.useSortedModeDetection(e,t)}),n.prototype.handleBlocklistItems=freeOnUnref(function(e,t,n){for(var r=this.getBlocklist(e),i=0,o=t;i<o.length;i++){null!==(f=o[i])&&r.push(f)}var a=n.getConfigurationStoreBlocklist(e);0<a.length&&u.info(a.length+" "+e.type+" quality levels have been blocklisted by configurationStore.");for(var s=0,l=a;s<l.length;s++){var f=l[s];r.push(f)}}),n.prototype.useLegacyModeDetection=freeOnUnref(function(r,i){for(var t=this,o=[],e=freeOnUnref(function(t){var e=r.generateKey(i.mimeType,t);if(null==a.requestedChecks[e]){var n=bi.mediaCapabilities.decodingInfo(r.buildMediaDecodingConfiguration(i.mimeType,t));a.requestedChecks[e]=n,a.mediaDecodeQueryCounts[i.type]++,o.push(n.then(freeOnUnref(function(e){return e?null:r.buildBlocklistItem(t)})))}}),a=this,n=0,s=i.qualityLevels;n<s.length;n++){e(s[n])}return lt.Promise.all(o).then(freeOnUnref(function(e){t.handleBlocklistItems(i,e,r)}))}),n.prototype.useSortedModeDetection=freeOnUnref(function(t,n){var r=this;return t.determineCodecsCapabilities(n,this.mediaDecodeQueryCounts,this.cachedCodecQueryResults).then(freeOnUnref(function(e){r.handleBlocklistItems(n,e,t)}))}),n})();t.MediaCapabilitiesFilter=n}));e(hf);hf.MediaCapabilitiesFilter;var mf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function o(e){this.currentValue=e}return o.for=freeOnUnref(function(e){return new o(e)}),o.prototype.itemById=freeOnUnref(function(t){if(null===this.currentValue)return new o(null);var e=x.find(this.currentValue.periods.contents,freeOnUnref(function(e){return e.id===t}));return new o(Qe.withDefault(e,null))}),o.prototype.itemByPosition=freeOnUnref(function(e){if(null===this.currentValue)return new o(null);var t=this.currentValue.periods.contents;if(0===t.length||e<t[0].startMs)return new o(null);for(var n=0,r=t;n<r.length;n++){var i=r[n];if(e<i.endMs)return new o(i)}return new o(null)}),o.prototype.nextItem=freeOnUnref(function(t){if(null===this.currentValue)return new o(null);var e=x.findIndex(this.currentValue.periods.contents,freeOnUnref(function(e){return t.id===e.id}));return new o(-1<e?Qe.withDefault(this.currentValue.periods.contents[e+1],null):null)}),o.prototype.previousItem=freeOnUnref(function(t){if(null===this.currentValue)return new o(null);var e=x.findIndex(this.currentValue.periods.contents,freeOnUnref(function(e){return t.id===e.id}));return new o(-1<e?Qe.withDefault(this.currentValue.periods.contents[e-1],null):null)}),o.prototype.streamsByType=freeOnUnref(function(t){return null==this.currentValue?new o([]):new o((Array.isArray(this.currentValue)?this.currentValue:this.currentValue.streams).filter(freeOnUnref(function(e){return e.type===t})))}),o.prototype.streamById=freeOnUnref(function(t){if(null==this.currentValue)return new o(null);var e;e=Array.isArray(this.currentValue)?this.currentValue:this.currentValue.streams;var n=x.find(e,freeOnUnref(function(e){return e.id===t}));return new o(Qe.withDefault(n,null))}),o.prototype.qualityLevelById=freeOnUnref(function(t){if(null==this.currentValue)return new o(null);var e=x.find(this.currentValue.qualityLevels,freeOnUnref(function(e){return e.id===t}));return new o(Qe.withDefault(e,null))}),o.prototype.qualityLevelByBandwidth=freeOnUnref(function(t){if(null==this.currentValue)return new o(null);var e=x.find(this.currentValue.qualityLevels,freeOnUnref(function(e){return e.bandwidth===t}));return new o(Qe.withDefault(e,null))}),o.prototype.first=freeOnUnref(function(){return null==this.currentValue||0===this.currentValue.length?new o(null):new o(this.currentValue[0])}),o.prototype.value=freeOnUnref(function(){return Qe.withDefault(this.currentValue,null)}),o})();t.MediaRepresentationQuerier=n}));e(mf);mf.MediaRepresentationQuerier;var yf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.contains=freeOnUnref(function(e,t){return t>=e.startTimeMs-1&&t<e.endTimeMs}),e})();t.SegmentPosition=n}));e(yf);yf.SegmentPosition;var gf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioQualityLevelFilter=af.AudioQualityLevelFilter,t.AUDIO_SUBTYPE_MAP=sf.AUDIO_SUBTYPE_MAP,t.createLocalStorageSegmentId=lf.createLocalStorageSegmentId,t.createLocalStorageSegmentIdWithByteOffset=lf.createLocalStorageSegmentIdWithByteOffset,t.getKeyPartsFromLocalStorageSegmentIdWithByteOffset=lf.getKeyPartsFromLocalStorageSegmentIdWithByteOffset,t.getKeyPartsFromLocalStorageSegmentIdWithSegmentIndex=lf.getKeyPartsFromLocalStorageSegmentIdWithSegmentIndex,t.ManifestAcquirer=ff.ManifestAcquirer,t.ManifestRefresher=uf.ManifestRefresher,t.MediaCapabilitiesFilter=hf.MediaCapabilitiesFilter,t.MediaRepresentationQuerier=mf.MediaRepresentationQuerier,t.SegmentPosition=yf.SegmentPosition}));e(gf);gf.AudioQualityLevelFilter,gf.AUDIO_SUBTYPE_MAP,gf.createLocalStorageSegmentId,gf.createLocalStorageSegmentIdWithByteOffset,gf.getKeyPartsFromLocalStorageSegmentIdWithByteOffset,gf.getKeyPartsFromLocalStorageSegmentIdWithSegmentIndex,gf.ManifestAcquirer,gf.ManifestRefresher,gf.MediaCapabilitiesFilter,gf.MediaRepresentationQuerier,gf.SegmentPosition;var vf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapAudioTracks=function(e){if(null==e||0===e.length)return null;for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t[null!=i.audioTrackId?i.audioTrackId:i.languageCode+"_"+i.audioSubtype+"_"+i.index]={languageCode:i.languageCode,subtype:gf.AUDIO_SUBTYPE_MAP[i.audioSubtype],label:i.displayName}}return t}}));e(vf);vf.mapAudioTracks;var Of=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.fromPlaybackUrls=function(e){var t={},n=e.defaultAudioTrackId;if(null!=n&&(t.Audio=[{baseId:n}]),null==e.audioTracks)return t;for(var r=0,i=e.audioTracks;r<i.length;r++){var o=i[r];if(o.audioTrackId===n){t.TimedText=[{language:o.languageCode}];break}}return t},t.fromPlaylistedPlaybackUrls=function(e){var t={},n=e.defaultAudioTrackId;null!=n&&(t.Audio=[{baseId:n}]);var r=function(e){for(var t=0,n=e.intraTitlePlaylist;t<n.length;t++){var r=n[t];if("Main"===r.type)return r.audioTracks}return[]}(e);if(r.length<=0)return t;for(var i=0,o=r;i<o.length;i++){var a=o[i];if(a.audioTrackId===n){t.TimedText=[{language:a.languageCode}];break}}return t}}));e(Of);Of.fromPlaybackUrls,Of.fromPlaylistedPlaybackUrls;var Sf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.LINEAR_RESTRICTIONS_START_TIME_MINS=-120,e.LINEAR_RESTRICTIONS_END_TIME_MINS=120,e})();t.LinearRestrictionsConfig=n}));e(Sf);Sf.LinearRestrictionsConfig;var Uf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(Uf);var bf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.valueOrNull=freeOnUnref(function(e){return null!=e&&e.ok&&null!=e.value?e.value:null}),e.valueOrUndefined=freeOnUnref(function(e){if(null!=e&&e.ok&&null!=e.value)return e.value}),e})();t.PlaybackResourceUtils=n}));e(bf);bf.PlaybackResourceUtils;var Pf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createTimedTextDataKey=function(e,t){return e+"/timed_text_data/"+t},t.createTimedTextDataPrefixKey=function(e){return e+"/timed_text_data/"}}));e(Pf);Pf.createTimedTextDataKey,Pf.createTimedTextDataPrefixKey;var Mf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("StaticTimedTextDataStore"),r=freeOnUnref(function(){function e(){this.assetCache=[],this.eventEmitter=new A.EventEmitter}return e.deleteContentsFromStorage=freeOnUnref(function(e){return Pt.localStorage.removePrefix(Pf.createTimedTextDataPrefixKey(e))}),e.prototype.getContents=freeOnUnref(function(t,e){var n=this;if(null==t.activeVariantId)return lt.Promise.reject(new Error("Can't get TimedText contents because there's no active variant on "+t.id+"."));var r=this.tryGetCachedContents(t);return null!==r?lt.Promise.resolve(r.contents):null!=e&&Pt.localStorage.capabilities.isSupported?this.getContentsFromStorage(e,t.id).then(freeOnUnref(function(e){return null!=e?(n.addToCache(t,e),e):n.downloadContents(t)})):this.downloadContents(t)}),e.prototype.storeContents=freeOnUnref(function(t,n){return this.downloadContents(n).then(freeOnUnref(function(e){return Pt.localStorage.put(Pf.createTimedTextDataKey(t,n.id),e)}))}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.flushCache=freeOnUnref(function(){this.assetCache=[]}),e.prototype.getContentsFromStorage=freeOnUnref(function(e,t){return Pt.localStorage.getText(Pf.createTimedTextDataKey(e,t)).catch(freeOnUnref(function(e){return n.info("Couldn't get static TimedText contents from LocalStorage with error: "+e),null}))}),e.prototype.downloadContents=freeOnUnref(function(i){var o=this,a=x.findWhere(i.variants,{id:i.activeVariantId});return null==a?lt.Promise.reject(new Error("Couldn't find variant for activeVariantId "+i.activeVariantId)):new lt.Promise(freeOnUnref(function(e,t){(new _n.ExponentialBackoffRetry).withMaxAttempts(4).withRandomizationFactor(1e3).onAttempt(freeOnUnref(function(e,t,n,r){o.tryAcquireTimedText(i,a.url,t,n)})).onSuccess(e).onError(t).execute()}))}),e.prototype.tryAcquireTimedText=freeOnUnref(function(n,r,i,o){var a=this;new pn.HttpRequest("GET",r).onLoad(freeOnUnref(function(e){a.eventEmitter.emit("timedTextDownloaded",{url:r,status:e.getStatus(),totalBytes:e.getMetrics().totalBytes,latencyMs:e.getLatencyMs(),totalMs:e.getTotalMs(),headers:e.getHeaders()});var t=e.getText();a.addToCache(n,t),o(t)})).onError(freeOnUnref(function(e,t){var n={url:r,error:e};null!=t&&x.extend(n,{status:t.getStatus(),totalBytes:t.getMetrics().totalBytes,latencyMs:t.getLatencyMs(),totalMs:t.getTotalMs(),headers:t.getHeaders()}),a.eventEmitter.emit("timedTextDownloadFailed",n),i(e)})).send()}),e.prototype.tryGetCachedContents=freeOnUnref(function(e){var t=x.findWhere(this.assetCache,{streamId:e.id,variantId:e.activeVariantId});return null!=t?t:null}),e.prototype.addToCache=freeOnUnref(function(e,t){2===this.assetCache.length&&this.assetCache.shift(),this.assetCache.push({streamId:e.id,variantId:e.activeVariantId,contents:t})}),e})();t.StaticTimedTextDataStore=r}));e(Mf);Mf.StaticTimedTextDataStore;var Cf=t(freeOnUnref(function(e,t){var r=ce&&ce.__assign||freeOnUnref(function(){return(r=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var f={caption:"Caption",narrative:"ForcedNarrative",sdh:"Sdh",subtitle:"Subtitle",subtitlemachinegenerated:"SubtitleMachineGenerated",audio:"Audio"},u={commentary:"Commentary",descriptive:"Descriptive",dialog:"Dialog"},i={Caption:"Caption",ForcedNarrative:"Mandatory",Narrative:"Mandatory",Sdh:"SDH",Subtitle:"Subtitle",SubtitleMachineGenerated:"MachineGenerated",Audio:"Audio"},o={Commentary:"Commentary",Descriptive:"Descriptive",Dialog:"Dialog"},a={DFXP:"TTMLv1",HLS:"WebVTT",TTMLv2:"TTMLv2"},c=de.get("SubtitleUrlTransformer"),s={index:"0",type:"Subtitle",subtype:"Dialog"},n=freeOnUnref(function(){function e(){}return e.toTimedTextStreams=freeOnUnref(function(n,e,t){return void 0===e&&(e=[]),void 0===t&&(t=[]),0===e.length&&0===t.length?[]:(e=e.concat(t)).map(freeOnUnref(function(e){if(null==(e=r({},s,e)).timedTextTrackId&&(e.timedTextTrackId=e.languageCode+"_"+e.type+"_"+e.subtype+"_"+e.index),null==e.format){var t=e.url.split("."),n=t[t.length-1];"dfxp"===n?e.format="DFXP":"ttml"===n?e.format="TTMLv2":"vtt"===n&&(e.format="HLS")}return e})).filter(freeOnUnref(function(e){var t=null==i[e.type]||null==o[e.subtype]||null==e.format||null==a[e.format];return t&&c.warn("Filtering out subtitle track "+e.timedTextTrackId+" because we don't recognize one of these: type ("+e.type+"), subtype ("+e.subtype+"), or format ("+e.format+")."),!t})).map(freeOnUnref(function(e){var t=e.timedTextTrackId+"_"+e.format+"_"+n;return{id:e.timedTextTrackId,language:e.languageCode.toLowerCase(),type:null!=e.type?i[e.type]:"Subtitle",subtype:null!=e.subtype?o[e.subtype]:"Dialog",label:e.displayName,activeVariantId:t,variants:[{id:t,format:a[e.format],url:e.url,restrictions:[]}]}}))}),e.transformV1TimedTextUrls=freeOnUnref(function(e){var t=[];if(null==e)return t;for(var n=0,r=e;n<r.length;n++){var i=r[n],o=null==i.index?"0":i.index,a="Subtitle";null!=i.type&&null!=f[i.type]?a=f[i.type]:c.info("Missing or unexpected subtitle type: "+i.type+", using "+a);var s="Dialog";null!=i.subtype&&null!=u[i.subtype]?s=u[i.subtype]:c.info("Missing or unexpected subtitle subtype: "+i.subtype+", using "+s);var l={displayName:i.displayName,languageCode:i.languageCode,format:i.format,url:i.url,index:o,type:a,subtype:s,trackGroupId:i.trackGroupId,timedTextTrackId:null!=i.timedTextTrackId?i.timedTextTrackId:i.languageCode+"_"+a+"_"+s+"_"+o};t.push(l)}return t}),e.transformV2TimedTextUrls=freeOnUnref(function(e){var t=[];if(null==e)return t;for(var n=0,r=0,i=e;r<i.length;r++){var o=i[r],a=""+n++,s={displayName:o.displayName,languageCode:o.languageCode,format:o.format,url:o.url,index:a,type:o.type,subtype:o.subtype,trackGroupId:o.trackGroupId,timedTextTrackId:o.languageCode+"_"+o.type+"_"+o.subtype+"_"+a};t.push(s)}return t}),e})();t.SubtitleUrlTransformer=n}));e(Cf);Cf.SubtitleUrlTransformer;var Ef=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StaticTimedTextDataStore=Mf.StaticTimedTextDataStore,t.SubtitleUrlTransformer=Cf.SubtitleUrlTransformer}));e(Ef);Ef.StaticTimedTextDataStore,Ef.SubtitleUrlTransformer;var Tf=t(freeOnUnref(function(e,t){function n(e){return"Allowed"===e}function r(){var e=L.configurationStore.configuration;return null!=e&&null!=e.prs&&!0===e.prs.disableLookback}function i(t,n,r){try{return jr.isoToMillis(t)}catch(e){return de.get("parseLookbackDuration").error("Unable to parse "+r+" duration string '"+t+"'. Default value "+n+" ms is used. Error message:",e),n}}Object.defineProperty(t,"__esModule",{value:!0});var o=freeOnUnref(function(){function e(){}return e.transformFromPRSv1=freeOnUnref(function(e){return r()?{liveLookbackControl:"Restricted",liveLookbackRootMode:"Rolling",liveLookbackRoot:"LiveHead",liveLookbackOffsetMs:0}:null==e?{liveLookbackControl:"Unrestricted"}:{liveLookbackControl:"Restricted",liveLookbackRootMode:"Rolling",liveLookbackRoot:"LiveHead",liveLookbackOffsetMs:1e3*-e}}),e.transformFromPRSv2=freeOnUnref(function(e){if(r())return{liveLookbackControl:"Restricted",liveLookbackRootMode:"Rolling",liveLookbackRoot:"LiveHead",liveLookbackOffsetMs:0};if(null==e)return{liveLookbackControl:"Unrestricted"};var t=e.liveLookbackMetadata;if(null!=t&&"Unrestricted"===t.liveLookbackControl)return{liveLookbackControl:"Unrestricted"};if(null!=t&&"Restricted"===t.liveLookbackControl){var n=void 0;return n=null==t.liveLookbackOffset?0:i(t.liveLookbackOffset,0,"liveLookbackOffset"),{liveLookbackControl:"Restricted",liveLookbackRootMode:t.liveLookbackRootMode,liveLookbackRoot:t.liveLookbackRoot,liveLookbackOffsetMs:n}}return null!=e.maxLiveLookback?{liveLookbackControl:"Restricted",liveLookbackRootMode:"Rolling",liveLookbackRoot:"LiveHead",liveLookbackOffsetMs:-i(e.maxLiveLookback,0,"maxLiveLookback")}:{liveLookbackControl:"Unrestricted"}}),e.getTimeshiftPolicyFromPlaybackData=freeOnUnref(function(e){if(null!=e&&null!=e.liveLookbackMetadata&&null!=e.liveLookbackMetadata.liveLookbackScrubControls&&"Unrestricted"!==e.liveLookbackMetadata.liveLookbackControl)return{isSeekBackwardEnabled:n(e.liveLookbackMetadata.liveLookbackScrubControls.backward),isSeekForwardEnabled:n(e.liveLookbackMetadata.liveLookbackScrubControls.forward),isPlayPauseControlEnabled:!0}}),e})();t.LiveLookbackTransformer=o}));e(Tf);Tf.LiveLookbackTransformer;var wf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Ok=function(e){return{ok:!0,value:e}},t.Failure=function(e){return{ok:!1,error:e}}}));e(wf);wf.Ok,wf.Failure;var If=t(freeOnUnref(function(e,t){function p(e){return{id:e.settingsId,playbackSettings:e.playbackSettings}}function h(e){return Ef.SubtitleUrlTransformer.transformV1TimedTextUrls(e.concat())}function m(e,t,n){if(null!=t)return wf.Failure(t);if(null!=e){var r=n(e);if(null!=r)return wf.Ok(r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.transformPRSv1Response=function(e){var t,n=null==e.errorsByResource?{}:e.errorsByResource;if(null!=e.errorsByResource&&null!=e.errorsByResource.PlaybackUrls)t=wf.Failure(e.errorsByResource.PlaybackUrls);else{var r=(new Pr.PRSResponseValidator).validateResponse(e);if(null!=r)t=wf.Failure(r);else{var i=void 0;null!=e.cuepointPlaylist&&(i={encodedManifest:e.cuepointPlaylist.encodedManifest,showCountdownTimer:null==e.cuepointPlaylist.additionalMetadata?void 0:e.cuepointPlaylist.additionalMetadata.showCountdownTimer,pauseBehavior:null==e.cuepointPlaylist.pauseBehavior?void 0:e.cuepointPlaylist.pauseBehavior});var o=m(e.playbackSettings,n.PlaybackSettings,p);t=wf.Ok(function(e,t,n){for(var r,i,o={},a=e.urlSets,s=0,l=Object.keys(a);s<l.length;s++){var f=l[s];o[f]=(r=a[f],i=r.urls.manifest,{urlSetId:r.urlSetId,urls:{manifest:{url:i.url,videoQuality:i.videoQuality,cdn:i.cdn,origin:i.origin,dynamicRange:i.dynamicRange,frameRate:i.frameRate,compressionStandard:i.compressionStandard,streamingTechnology:i.streamingTechnology,livePlaybackStreamId:null==i.livePlaybackStreamId?void 0:i.livePlaybackStreamId,startTime:null==i.startTime?void 0:i.startTime,duration:null==i.duration?void 0:i.duration,isFmmCompatible:!0===i.isFmmCompatible},adsTrackingEndpoint:r.urls.adsTrackingEndpoint},failover:r.failover})}return{cacheKey:e.cacheKey,defaultUrlSetId:e.defaultUrlSetId,urlSets:o,defaultAudioTrackId:e.defaultAudioTrackId,audioTracks:null==e.audioTracks?[]:e.audioTracks,cuepoints:t,playbackSettings:n}}(e.playbackUrls,i,o))}}var a,s=null!=e.returnedTitleRendition?e.returnedTitleRendition.videoMaterialType:"Feature";a="LiveStreaming"===s?null!=e.returnedTitleRendition&&null!=e.returnedTitleRendition.liveLookbackSec?Tf.LiveLookbackTransformer.transformFromPRSv1(e.returnedTitleRendition.liveLookbackSec):Tf.LiveLookbackTransformer.transformFromPRSv1(void 0):{liveLookbackControl:"Unrestricted"};var l,f={contentId:null!=e.returnedTitleRendition?e.returnedTitleRendition.contentId:"UNKNOWN_VCID",liveLookbackPolicy:a,videoMaterialType:s},u=null==(l=e).returnedTitleRendition||null==l.returnedTitleRendition.timeShift?null:{isSeekBackwardEnabled:!l.returnedTitleRendition.timeShift.backward||l.returnedTitleRendition.timeShift.backward.enabled,isSeekForwardEnabled:!l.returnedTitleRendition.timeShift.forward||l.returnedTitleRendition.timeShift.forward.enabled,isPlayPauseControlEnabled:!l.returnedTitleRendition.timeShift.pause||l.returnedTitleRendition.timeShift.pause.enabled};null!=u&&(f.timeShiftPolicy=u);var c="Feature"===f.videoMaterialType||"LiveStreaming"===f.videoMaterialType,d={timestamp:Date.now(),session:{type:"updatestream",enableSessionTracking:c},playbackData:f,playbackUrls:t};return null!=e.returnedTitleRendition&&null!=e.returnedTitleRendition.auditPings&&(d.auditPings=wf.Ok(e.returnedTitleRendition.auditPings)),d.syeUrls=m(e.syeUrlsV2,n.SyeUrlsV2,x.identity),d.xrayMetadata=m(e.xrayMetadata,n.XRayMetadata,x.identity),d.fairPlayApplicationCertificate=m(e.fairPlayApplicationCertificate,n.FairPlayApplicationCertificate,freeOnUnref(function(e){return e.encodedApplicationCertificate})),d.liveSchedule=m(e.liveSchedule,n.LiveSchedule,x.identity),d.linearRestrictions=m(e.linearRestrictions,n.LinearRestrictions,x.identity),d.subtitleUrls=m(e.subtitleUrls,n.SubtitleUrls,h),d.forcedNarratives=m(e.forcedNarratives,n.ForcedNarratives,h),d.transitionTimecodes=m(e.transitionTimecodes,n.TransitionTimecodes,x.identity),d.trickplayUrls=m(e.trickplayUrls,n.TrickplayUrls,x.identity),d.catalogMetadata=m(e.catalogMetadata,n.CatalogMetadata,x.identity),d.whisperSyncBookmark=m(e.whisperSyncBookmark,n.WhisperSyncBookmark,x.identity),d}}));e(If);If.transformPRSv1Response;var kf=t(freeOnUnref(function(e,t){var f=ce&&ce.__assign||freeOnUnref(function(){return(f=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var y="UNKNOWN_VCID",c=de.get("PRSv2ResourcesConverter");function g(e){if(null!=e&&e.ok&&null!=e.result)return e.result}function s(e){return null==e.playbackUrls?new ct.XpError("prs.vod_playlisted_playback_urls.no_playlist_items"):null==e.playbackUrls.intraTitlePlaylist?new ct.XpError("prs.vod_playlisted_playback_urls.no_intra_title_playlist"):0===e.playbackUrls.intraTitlePlaylist.length?new ct.XpError("prs.vod_playlisted_playback_urls.empty_playlist_items"):e.playbackUrls.intraTitlePlaylist.some(freeOnUnref(function(e){return"Main"===e.type}))?void 0:new ct.XpError("prs.vod_playlisted_playback_urls.playlist_missing_main_item")}function v(e,t){if(null!=e){if(!e.ok)return wf.Failure(e.error);var n=t(e.result);if(null!=n)return wf.Ok(n)}}function O(e){var t=e.urls.manifest,n={urlSetId:e.urlSetId,urls:{manifest:{url:t.url,videoQuality:t.videoQuality,cdn:t.cdn,origin:t.origin,dynamicRange:t.dynamicRange,frameRate:t.frameRate,compressionStandard:t.compressionStandard,streamingTechnology:t.streamingTechnology,livePlaybackStreamId:null==t.livePlaybackStreamId?void 0:t.livePlaybackStreamId,startTime:null==t.startTime?void 0:t.startTime,duration:null==t.duration?void 0:t.duration,isFmmCompatible:!1},adsTrackingEndpoint:e.urls.adsTrackingEndpoint},failover:e.failover},r=P(e.urls.manifest.edgeDeliveryAuthorization);return null!=r&&(n.urls.manifest.edgeDeliveryAuthorization=r),n}function d(e,t,n){var r=n.length,i=n.indexOf(e);if(r<=1||-1===i)return c.warn("CDN "+e+" not present in failoverPolicy. Defaulting to the first URL."),l(t[0].consumptionId,t[0].consumptionId);var o=n[(i+1)%r],a=x.find(t,freeOnUnref(function(e){return e.cdn===o}));return null==a?(c.warn("Unable to find "+o+" in the urls list. Defaulting to the first URL."),l(t[0].consumptionId,t[0].consumptionId)):l(a.consumptionId,t[0].consumptionId)}function l(e,t){return{cdn:{urlSetId:e,mode:"seamless"},default:{urlSetId:t,mode:"seamless"}}}function S(e){for(var t=Qe.deepClone(e),n=0,r=t;n<r.length;n++){for(var i=r[n],o=0,a=i.tracks.audio;o<a.length;o++){var s=a[o];s.language=Wl.toExpectedIso639_1LanguageCode(s.language)}for(var l=0,f=i.tracks.captions;l<f.length;l++){var u=f[l];u.language=Wl.toExpectedIso639_1LanguageCode(u.language)}}return t}function U(e){return{id:e.settingsId,playbackSettings:e.playbackSettings}}function n(e){return Ef.SubtitleUrlTransformer.transformV2TimedTextUrls(e.concat())}function u(e){return n(e.subtitleUrls)}function p(e){return n(e.forcedNarrativeUrls)}function h(e){for(var n={trickplayUrlsCdnSets:[]},t=freeOnUnref(function(t){var e=x.find(n.trickplayUrlsCdnSets,freeOnUnref(function(e){return e.cdn===t.cdn}));null!=e?e.trickplayUrlInfoList.push({resolution:t.trickplayResolution,url:t.trickplayUrl}):n.trickplayUrlsCdnSets.push({cdn:t.cdn,trickplayUrlInfoList:[{resolution:t.trickplayResolution,url:t.trickplayUrl}]})}),r=0,i=e.trickplayUrls;r<i.length;r++){t(i[r])}return n}function b(e){for(var t={duration:null!=e.duration?jr.isoToMillis(e.duration)/1e3:void 0,startTime:e.startTime,listOfCdns:[],maxBitrateBps:e.maxBitrateBps,multiviewMetadata:e.multiviewMetadata?S(e.multiviewMetadata.contentsMetadata):void 0},n=0,r=e.cdns;n<r.length;n++)for(var i=r[n],o=0,a=i.frontendUrls;o<a.length;o++){var s=a[o];t.listOfCdns.push({cdnName:i.name,channelId:i.channelId,frontendUrl:s.frontendUrl,token:i.token,urlSetId:s.urlSetId})}return t}function m(e){if(0!==e.events.length){for(var t=!1,n={outroCreditsStart:1/0,skipElements:[]},r={SKIP_INTRO:"INTRO",SKIP_RECAP:"RECAP"},i=0,o=e.events;i<o.length;i++){var a=o[i];"NEXT_UP"===a.eventType&&(t?c.warn("PRSv2 returned more than one NEXT_UP event for VOD, ignoring all but first."):(null!=a.intervals&&0!==a.intervals.length?n.outroCreditsStart=a.intervals[0].startTimeMs:n.outroCreditsStart=a.startTimeMs,t=!0));var s=null==r[a.eventType]?a.eventType:r[a.eventType];if(null!=a.intervals&&0!==a.intervals.length)for(var l=0,f=a.intervals;l<f.length;l++){var u=f[l];n.skipElements.push({buttonShowtimeMs:null!=a.eventProperties&&null!=a.eventProperties.eventTimerMs?a.eventProperties.eventTimerMs:0,elementType:s,endTimecodeMs:null!=u.endTimeMs?u.endTimeMs:1/0,startTimecodeMs:u.startTimeMs})}else n.skipElements.push({buttonShowtimeMs:null!=a.eventProperties&&null!=a.eventProperties.eventTimerMs?a.eventProperties.eventTimerMs:0,elementType:s,endTimecodeMs:null!=a.endTimeMs?a.endTimeMs:1/0,startTimecodeMs:a.startTimeMs})}return t||c.warn("PRSv2 did not return NEXT_UP event for VOD. Passing "+n.outroCreditsStart+" as outroCreditsStart."),n}}function i(e,t){var n,r=void 0,i=void 0;if(null==e.vodPlaybackUrls)n=wf.Failure(new ct.XpError("prs.vod_playback_urls.no_resource"));else if(e.vodPlaybackUrls.ok)if(null!=(r=function(e){if(null==e.playbackUrls)return new ct.XpError("prs.vod_playback_urls.no_playback_urls");if(null==e.playbackUrls.urlSets)return new ct.XpError("prs.vod_playback_urls.no_url_sets");var t=e.playbackUrls.defaultUrlSetId;return null==e.playbackUrls.urlSets[t]?new ct.XpError("prs.vod_playback_urls.invalid_default_url_set_id"):void 0}(e.vodPlaybackUrls.result)))n=wf.Failure(r);else if(null==e.sessionization)n=wf.Failure(new ct.XpError("pes.session_handoff.invalid"));else{i=v(e.vodPlaybackUrls.result.playbackSettings,U);var o=function(e,t){for(var n,r,i,o,a={},s=e.playbackUrls,l=s.urlSets,f=0,u=Object.keys(l);f<u.length;f++){var c=u[f];a[c]=(n=l[c],r=s.urlMetadata,i=void 0,i={urlSetId:n.urlSetId,urls:{manifest:{url:n.url,videoQuality:r.videoQuality,cdn:n.cdn,origin:n.origin,dynamicRange:r.dynamicRange,frameRate:r.frameRate,compressionStandard:r.codec,streamingTechnology:r.streamingProtocol,isFmmCompatible:!0===r.isFmmCompatible}},failover:n.failover},null!=(o=P(n.edgeDeliveryAuthorization))&&(i.urls.manifest.edgeDeliveryAuthorization=o),i)}var d=s.audioTracks;return{cacheKey:void 0,defaultUrlSetId:s.defaultUrlSetId,urlSets:a,defaultAudioTrackId:s.defaultAudioTrackId,audioTracks:null==d?[]:d,cuepoints:null==s.cuepoints?void 0:{encodedManifest:s.cuepoints.encodedManifest,pauseBehavior:s.cuepoints.pauseBehavior},playbackSettings:t}}(e.vodPlaybackUrls.result,i);n=wf.Ok(o)}else n=wf.Failure(e.vodPlaybackUrls.error);var a=e.sessionization;return{timestamp:Date.now(),session:f({type:"session_api"},a),playbackData:t,playbackUrls:n,playlistedPlaybackUrls:wf.Failure(new ct.XpError("prs.vod_playlisted_playback_urls.no_resource")),auditPings:v(e.auditPings,freeOnUnref(function(e){return e.auditPings})),forcedNarratives:v(e.timedTextUrls,p),subtitleUrls:v(e.timedTextUrls,u),trickplayUrls:v(e.trickplayUrls,h),xrayMetadata:v(e.vodXrayMetadata,x.identity),fairPlayApplicationCertificate:v(e.fairPlayApplicationCertificate,freeOnUnref(function(e){return e.encodedApplicationCertificate})),widevineServiceCertificate:v(e.widevineServiceCertificate,freeOnUnref(function(e){return e.encodedServiceCertificate})),transitionTimecodes:v(e.transitionTimecodes,m)}}function o(e,t){var n,r=void 0,i=void 0;if(null==e.vodPlaylistedPlaybackUrls)n=wf.Failure(new ct.XpError("prs.vod_playlisted_playback_urls.no_playlist_resource"));else if(e.vodPlaylistedPlaybackUrls.ok)if(null==e.sessionization)n=wf.Failure(new ct.XpError("pes.session_handoff.invalid"));else if(null!=(r=s(e.vodPlaylistedPlaybackUrls.result)))n=wf.Failure(r);else{i=v(e.vodPlaylistedPlaybackUrls.result.playbackSettings,U);var o=function(e,t){var n=e.playbackUrls.intraTitlePlaylist;if(1!==n.length)throw new Error("Invalid intraTitlePlaylist length. Expected 1, got "+n.length);var r=n[0];if("Main"!==r.type)throw new Error("Invalid intraTitlePlaylist item type. Expected Main, got "+r.type);for(var i=r.manifestMetadata,o=e.playbackUrls.failoverPolicy.cdnOrder,a={},s=0,l=r.urls;s<l.length;s++){var f=l[s],u={urlSetId:f.consumptionId,urls:{manifest:{url:f.url,videoQuality:i.videoQuality,cdn:f.cdn,origin:f.origin,dynamicRange:i.dynamicRange,frameRate:i.frameRate,compressionStandard:i.codec,streamingTechnology:i.streamingProtocol,isFmmCompatible:i.isFmmCompatible}},failover:d(f.cdn,r.urls,o)},c=P(f.edgeDeliveryAuthorization);null!=c&&(u.urls.manifest.edgeDeliveryAuthorization=c),a[f.consumptionId]=u}return{defaultUrlSetId:r.urls[0].consumptionId,urlSets:a,defaultAudioTrackId:r.defaultAudioTrackId,audioTracks:r.audioTracks,playbackSettings:t}}(e.vodPlaylistedPlaybackUrls.result,i);n=wf.Ok(o)}else n=wf.Failure(e.vodPlaylistedPlaybackUrls.error);var a=e.sessionization;return{timestamp:Date.now(),session:f({type:"session_api"},a),playbackData:t,playbackUrls:n,playlistedPlaybackUrls:wf.Failure(new ct.XpError("prs.vod_playlisted_playback_urls.no_resource")),auditPings:v(e.auditPings,freeOnUnref(function(e){return e.auditPings})),forcedNarratives:v(e.timedTextUrls,p),subtitleUrls:v(e.timedTextUrls,u),trickplayUrls:v(e.trickplayUrls,h),xrayMetadata:v(e.vodXrayMetadata,x.identity),fairPlayApplicationCertificate:v(e.fairPlayApplicationCertificate,freeOnUnref(function(e){return e.encodedApplicationCertificate})),widevineServiceCertificate:v(e.widevineServiceCertificate,freeOnUnref(function(e){return e.encodedServiceCertificate})),transitionTimecodes:v(e.transitionTimecodes,m)}}function a(e,t){var n,r=void 0,i=void 0;if(null==e.vodPlaylistedPlaybackUrls)n=wf.Failure(new ct.XpError("prs.vod_playlisted_playback_urls.no_playlist_resource"));else if(e.vodPlaylistedPlaybackUrls.ok)if(null==e.sessionization)n=wf.Failure(new ct.XpError("pes.session_handoff.invalid"));else if(null!=(r=s(e.vodPlaylistedPlaybackUrls.result)))n=wf.Failure(r);else{i=v(e.vodPlaylistedPlaybackUrls.result.playbackSettings,U);var o=function(e,t){var n=x.find(e.playbackUrls.intraTitlePlaylist,freeOnUnref(function(e){return"Main"===e.type}));if(null==n)throw new Error("Playlist has no main items");for(var r=0,i=e.playbackUrls.intraTitlePlaylist;r<i.length;r++){var o=i[r];if("Card"===o.type||"Main"===o.type)for(var a=0,s=o.urls;a<s.length;a++){var l=s[a];l.edgeDeliveryAuthorization=P(l.edgeDeliveryAuthorization)}}return{failoverPolicy:e.playbackUrls.failoverPolicy,intraTitlePlaylist:e.playbackUrls.intraTitlePlaylist,pauseAdsResolution:e.playbackUrls.pauseAdsResolution,defaultAudioTrackId:n.defaultAudioTrackId,playbackSettings:t}}(e.vodPlaylistedPlaybackUrls.result,i);n=wf.Ok(o)}else n=wf.Failure(e.vodPlaylistedPlaybackUrls.error);var a=e.sessionization;return{timestamp:Date.now(),session:f({type:"session_api"},a),playbackData:t,playbackUrls:wf.Failure(new ct.XpError("prs.vod_playback_urls.no_resource")),playlistedPlaybackUrls:n,auditPings:v(e.auditPings,freeOnUnref(function(e){return e.auditPings})),forcedNarratives:v(e.timedTextUrls,p),subtitleUrls:v(e.timedTextUrls,u),trickplayUrls:v(e.trickplayUrls,h),xrayMetadata:v(e.vodXrayMetadata,x.identity),fairPlayApplicationCertificate:v(e.fairPlayApplicationCertificate,freeOnUnref(function(e){return e.encodedApplicationCertificate})),widevineServiceCertificate:v(e.widevineServiceCertificate,freeOnUnref(function(e){return e.encodedServiceCertificate})),transitionTimecodes:v(e.transitionTimecodes,m)}}function P(e){if(null!=e){if(r(e))return e;c.warn("Edge delivery authorization validation failed"),q.metrics.putMetric("TokenAuth.EdgeDeliveryAuthValidationFailed",1)}}function r(e){if(null==e||!x.isObject(e))return!1;var t=e.authorizationScheme,n=e.accessTokens;if(!x.isString(t)||-1===["PVExchangeV1","Static","Transparent","None"].indexOf(t))return!1;if("PVExchangeV1"===t||"Static"===t){if(!x.isObject(n))return!1;if(!x.isString(n.initialAccessToken)||x.isEmpty(n.initialAccessToken))return!1;if(!x.isFinite(n.initialAccessTokenSecondsOfValidity))return!1;if("PVExchangeV1"===t&&(!x.isString(n.accessTokenGetUrl)||x.isEmpty(n.accessTokenGetUrl)))return!1}return!0}t.transformPRSv2LiveResponse=function(e,t){var n,r=void 0,i=g(e.playbackData),o={contentId:null==i||null==i.contentId?y:i.contentId,liveLookbackPolicy:Tf.LiveLookbackTransformer.transformFromPRSv2(i),videoMaterialType:"LiveStreaming"},a=void 0;if(null==e.livePlaybackUrls)n=wf.Failure(new ct.XpError("prs.live_playback_urls.no_resource"));else if(e.livePlaybackUrls.ok)if(null!=(r=function(e){if(null==e.urlSets)return new ct.XpError("prs.live_playback_urls.no_url_sets");var t=e.defaultUrlSetId;return null==e.urlSets[t]?new ct.XpError("prs.live_playback_urls.invalid_default_url_set_id"):void 0}(e.livePlaybackUrls.result)))n=wf.Failure(r);else{a=v(e.livePlaybackUrls.result.playbackSettings,U);var s=function(e,t){for(var n={},r=e.urlSets,i=0,o=Object.keys(r);i<o.length;i++){var a=o[i];n[a]=O(r[a])}var s=e.multiviewMetadata;return{cacheKey:e.cacheKey,defaultUrlSetId:e.defaultUrlSetId,urlSets:n,audioTracks:[],playbackSettings:t,multiviewMetadata:null!=s?S(s.contentsMetadata):void 0}}(e.livePlaybackUrls.result,a);n=wf.Ok(s)}else n=wf.Failure(e.livePlaybackUrls.error);var l,f={timestamp:Date.now(),session:(l=e,null!=l.sessionization?{type:"session_api",sessionHandoffToken:l.sessionization.sessionHandoffToken,drmCaching:l.sessionization.drmCaching}:{type:"updatestream",enableSessionTracking:!0,token:null==l.session?void 0:l.session.token}),playbackData:o,playbackUrls:n,auditPings:v(e.auditPings,freeOnUnref(function(e){return e.auditPings})),syeUrls:v(e.syeUrls,b),xrayMetadata:v(e.xrayMetadata,x.identity),fairPlayApplicationCertificate:v(e.fairPlayApplicationCertificate,freeOnUnref(function(e){return e.encodedApplicationCertificate})),widevineServiceCertificate:v(e.widevineServiceCertificate,freeOnUnref(function(e){return e.encodedServiceCertificate}))},u=void 0;if(x.contains(t,ka.PlaybackExperience.RapidRecap)){var c=void 0,d=void 0;if(null==e.rapidRecap){var p=new ct.XpError("prs.rapid_recap.missing_resources");c=wf.Failure(p),d=wf.Failure(p)}else if(e.rapidRecap.ok)if(null!=(r=function(e){if(null==e||null==e.urlSets)return new ct.XpError("prs.rapid_recap_playback_urls.no_url_sets");var t,n=e.defaultUrlSetId;return null==n?new ct.XpError("prs.rapid_recap_playback_urls.invalid_default_url_set_id"):null==(t=e.urlSets[n])||null==t.urls||null==t.urls.manifest?new ct.XpError("prs.rapid_recap_playback_urls.invalid_default_url_set_id"):void 0}(e.rapidRecap.result.playbackUrls)))c=wf.Failure(r),d=wf.Failure(r);else{var h=v(e.rapidRecap.result.playbackSettings,U),m=function(e,t){for(var n={},r=e.urlSets,i=0,o=Object.keys(r);i<o.length;i++){var a=o[i];n[a]=O(r[a])}return{audioTracks:[],defaultUrlSetId:e.defaultUrlSetId,urlSets:n,playbackSettings:t}}(e.rapidRecap.result.playbackUrls,null==h?a:h);c=wf.Ok(m),null!=e.rapidRecap.result.slates&&(d=wf.Ok(e.rapidRecap.result.slates))}else c=wf.Failure(e.rapidRecap.error),d=wf.Failure(e.rapidRecap.error);u={timestamp:Date.now(),session:f.session,playbackData:{contentId:f.playbackData.contentId,videoMaterialType:f.playbackData.videoMaterialType,liveLookbackPolicy:{liveLookbackControl:"Unrestricted"}},fairPlayApplicationCertificate:f.fairPlayApplicationCertificate,widevineServiceCertificate:f.widevineServiceCertificate,playbackUrls:c,slates:d}}return{main:f,rapidRecap:u}},t.transformPRSv2VodResponse=function(e,t){var n=g(t.playbackData),r={contentId:null==n||null==n.contentId?y:n.contentId,liveLookbackPolicy:{liveLookbackControl:"Unrestricted"},videoMaterialType:e};return null!=t.vodPlaylistedPlaybackUrls&&t.vodPlaylistedPlaybackUrls.ok?null!=t.vodPlaylistedPlaybackUrls&&t.vodPlaylistedPlaybackUrls.ok&&null!=t.vodPlaylistedPlaybackUrls.result.playbackUrls&&null!=t.vodPlaylistedPlaybackUrls.result.playbackUrls.intraTitlePlaylist&&1===t.vodPlaylistedPlaybackUrls.result.playbackUrls.intraTitlePlaylist.length?o(t,r):a(t,r):i(t,r)},t.transformToStandardPlaybackUrls=i,t.transformPlaylistToStandardPlaybackUrls=o,t.transformPlaylistItemsToPlaylistedPlaybackUrls=a,t.transformPRSv2LiveLinearResponse=function(e,t){var n,r=void 0,i=g(e.playbackData),o={contentId:null==i||null==i.contentId?y:i.contentId,liveLookbackPolicy:Tf.LiveLookbackTransformer.transformFromPRSv2(i),videoMaterialType:t,timeShiftPolicy:Tf.LiveLookbackTransformer.getTimeshiftPolicyFromPlaybackData(i)},a=void 0;if(null==e.liveLinearPlaybackUrls)n=wf.Failure(new ct.XpError("prs.live_linear_playback_urls.no_resource"));else if(e.liveLinearPlaybackUrls.ok)if(null!=(r=function(e){if(null==e.urlSets)return new ct.XpError("prs.live_liner_playback_urls.no_url_sets");var t=e.defaultUrlSetId;return null==e.urlSets[t]?new ct.XpError("prs.live_liner_playback_urls.invalid_default_url_set_id"):void 0}(e.liveLinearPlaybackUrls.result)))n=wf.Failure(r);else{a=v(e.liveLinearPlaybackUrls.result.playbackSettings,U);var s=function(e,t){for(var n={},r=e.urlSets,i=0,o=Object.keys(r);i<o.length;i++){var a=o[i];n[a]=O(r[a])}return{cacheKey:e.cacheKey,defaultUrlSetId:e.defaultUrlSetId,urlSets:n,audioTracks:[],playbackSettings:t}}(e.liveLinearPlaybackUrls.result,a);n=wf.Ok(s)}else n=wf.Failure(e.liveLinearPlaybackUrls.error);var l=e.sessionization;return{timestamp:Date.now(),session:f({type:"session_api"},l),playbackData:o,playbackUrls:n,auditPings:v(e.auditPings,freeOnUnref(function(e){return e.auditPings})),fairPlayApplicationCertificate:v(e.fairPlayApplicationCertificate,freeOnUnref(function(e){return e.encodedApplicationCertificate})),widevineServiceCertificate:v(e.widevineServiceCertificate,freeOnUnref(function(e){return e.encodedServiceCertificate}))}},t.validateEdgeDeliveryAuthorization=r}));e(kf);kf.transformPRSv2LiveResponse,kf.transformPRSv2VodResponse,kf.transformToStandardPlaybackUrls,kf.transformPlaylistToStandardPlaybackUrls,kf.transformPlaylistItemsToPlaylistedPlaybackUrls,kf.transformPRSv2LiveLinearResponse,kf.validateEdgeDeliveryAuthorization;var _f=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={transformPRSv1Response:If.transformPRSv1Response,transformPRSv2LiveResponse:kf.transformPRSv2LiveResponse,transformPRSv2VodResponse:kf.transformPRSv2VodResponse,transformPRSv2LiveLinearResponse:kf.transformPRSv2LiveLinearResponse};t.PlaybackResourcesConverter=n}));e(_f);_f.PlaybackResourcesConverter;var Rf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("PRSv1LiveScheduleRefresher"),n=freeOnUnref(function(){function e(e,t,n){var i=this;this.timer=oe.timer,this.scheduleUpdateIntervalId=null,this.scheduleRequestCancel=null,this.refreshSchedule=freeOnUnref(function(){null!==i.scheduleRequestCancel&&i.scheduleRequestCancel();var e=lt.CancelToken.source(),r=e.token,t=e.cancel;i.scheduleRequestCancel=t,i.prsClient.send(i.liveMetadataRequestBuilder.build("ImmediateConsumption"),r).then(freeOnUnref(function(e){return e.response()})).then(freeOnUnref(function(e){var t,n;r.requested||(o.info("LiveMetadata response:",e),t=null!=e.errorsByResource&&null!=e.errorsByResource.LiveSchedule?wf.Failure(e.errorsByResource.LiveSchedule):null==e.liveSchedule?wf.Failure(new ct.XpError("prs.resource.missing",void 0,"No live schedule returned")):wf.Ok(e.liveSchedule),n=null!=e.errorsByResource&&null!=e.errorsByResource.LinearRestrictions?wf.Failure(e.errorsByResource.LinearRestrictions):null==e.linearRestrictions?wf.Failure(new ct.XpError("prs.resource.missing",void 0,"No linear restrictions returned")):wf.Ok(e.linearRestrictions),i.eventEmitter.emit("schedule",{liveSchedule:t,linearRestrictions:n}))})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||(o.error("LiveMetadata request failed",e),q.metrics.putMetric("ServiceRequest.PRS.LiveMetadataRequest.Error"),i.eventEmitter.emit("error",ct.XpError.generatePrefixedError(e,"schedule")))}))}),this.eventEmitter=new A.EventEmitter,this.prsClient=e,this.liveMetadataRequestBuilder=n.clone().resource(Pr.PlaybackResource.LiveSchedule(t)).resource(Pr.PlaybackResource.LinearRestrictions(Sf.LinearRestrictionsConfig.LINEAR_RESTRICTIONS_START_TIME_MINS,Sf.LinearRestrictionsConfig.LINEAR_RESTRICTIONS_END_TIME_MINS))}return e.prototype.stop=freeOnUnref(function(){null!==this.scheduleUpdateIntervalId&&(this.timer.clearInterval(this.scheduleUpdateIntervalId),this.scheduleUpdateIntervalId=null),null!==this.scheduleRequestCancel&&(this.scheduleRequestCancel(),this.scheduleRequestCancel=null)}),e.prototype.start=freeOnUnref(function(e){this.scheduleUpdateIntervalId=this.timer.setInterval(this.refreshSchedule,e)}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e})();t.PRSv1LiveScheduleRefresher=n}));e(Rf);Rf.PRSv1LiveScheduleRefresher;var Af=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=yr.createCDPResponseProcessor(freeOnUnref(function(e,t,n,r){var i=Qe.nestedValue(e,"message.body");null!==i?null!=i.statusCallbackIntervalSeconds&&null!=i.canStream?t({statusCallbackIntervalMs:1e3*i.statusCallbackIntervalSeconds,canStream:i.canStream}):r(new ct.XpError("UpdateStream.Error.InvalidBodyResponse")):r(new ct.XpError("UpdateStream.Error.NullResponseBody"))})),r=freeOnUnref(function(){function e(e){this.serviceClient=e.createServiceClient("/cdp/usage/UpdateStream",{firmware:"1",version:"1"},n,"updatestream")}return e.prototype.send=freeOnUnref(function(e,t,n,r,i,o,a,s,l,f){var u,c={accept:"application/json"};Qe.sanitize(c,!0);var d=(n/1e3).toFixed(r?0:3),p=((u={titleId:e,event:t,userWatchSessionId:i})[r?"epochUtc":"timecode"]=d,u);o&&(p.streamIntent="AUTOPLAY"),null!=s&&(p.sessionToken=s),null!=l&&(p.scheduleInfo=JSON.stringify(l)),null!=f&&(p.tuneInTimeEpoch=(f/1e3).toFixed(0));var h={method:"GET",headers:c,queryParams:p};return this.serviceClient.send(h,a,"CRITICAL")}),e})();t.UpdateStreamClient=r}));e(Af);Af.UpdateStreamClient;var Df=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStreamClient=Af.UpdateStreamClient}));e(Df);Df.UpdateStreamClient;var xf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("UpdateStreamPlaybackSessionTracker");var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s){this.updateIntervalMs=3e4,this.cancelConsumptionRequest=null,this.terminated=!1,this.eventEmitter=new A.EventEmitter,this.updateStreamClient=new Df.UpdateStreamClient(e),this.hasStarted=!1,this.prsClient=i,this.immediateConsumptionRequest=o,this.cacheKey=a,this.userWatchSessionId=t,this.isDownloadedPlayback=s,this.titleId=r,this.sessionConfig=n,this.updateEvent=null}return e.prototype.play=freeOnUnref(function(e,t,n,r){if(this.updateEvent="PLAY",null!=r&&(this.tuneInTimeMs=r),this.hasStarted)return this.reportForPosition("PLAY",e,t,n);var i=[];return this.hasStarted=!0,null!=this.immediateConsumptionRequest&&i.push(this.requestConsumption()),i.push(this.reportForPosition("START",e,t,n)),lt.Promise.all(i).then(freeOnUnref(function(e){return function(e){for(var t={result:"normal"},n=0,r=e;n<r.length;n++){var i=r[n];if("not_allowed"===i.result){t=i;break}"normal"!==i.result&&"normal"===t.result&&(t=i)}return t}(e)}))}),e.prototype.pause=freeOnUnref(function(e,t,n){return this.updateEvent="PAUSE",this.reportForPosition("PAUSE",e,t,n)}),e.prototype.update=freeOnUnref(function(e,t,n,r){return null==this.updateEvent?lt.Promise.reject(new Error("Cannot report an update on a session that is not started")):(null!=r&&(this.tuneInTimeMs=r),this.reportForPosition(this.updateEvent,e,t,n))}),e.prototype.stop=freeOnUnref(function(e,t,n){return this.updateEvent=null,this.reportForPosition("STOP",e,t,n)}),e.prototype.setAdditionalBookmarkData=freeOnUnref(function(e,t){this.titleId=e,this.updateStreamAdditionalData=t}),e.prototype.terminate=freeOnUnref(function(){null!=this.cancelConsumptionRequest&&(this.cancelConsumptionRequest(),this.cancelConsumptionRequest=null),this.terminated=!0}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.reportForPosition=freeOnUnref(function(e,t,n,r){var i=this;if(!this.sessionConfig.enableSessionTracking)return lt.Promise.resolve({result:"normal"});var o=lt.CancelToken.source().token;return this.updateStreamClient.send(this.titleId,e,t,n===ka.TimeUnit.EpochMillis,this.userWatchSessionId,r,o,this.sessionConfig.token,this.updateStreamAdditionalData,this.tuneInTimeMs).then(freeOnUnref(function(e){return e.response()})).then(freeOnUnref(function(e){return i.terminated?{result:"normal"}:e.canStream?(i.updateIntervalMs=e.statusCallbackIntervalMs,{result:"normal"}):{result:"not_allowed",reason:new ct.XpError(Ni.codes.xp.content.concurrency_limit,void 0,void 0,!0)}})).catch(freeOnUnref(function(e){return i.terminated||e instanceof lt.CancelError||(a.warn("UpdateStream request failed",e),q.metrics.putMetric("ServiceRequest.UpdateStream.Error"),i.eventEmitter.emit("error",ct.XpError.generatePrefixedError(e,"session"))),{result:"normal"}}))}),e.prototype.requestConsumption=freeOnUnref(function(){var r=this,e=lt.CancelToken.source(),i=e.token,t=e.cancel;return this.cancelConsumptionRequest=t,this.prsClient.send(this.immediateConsumptionRequest,i).then(freeOnUnref(function(e){return e.on("latency",freeOnUnref(function(e){q.metrics.putMetric("ServiceRequest.PRS.VerifyConsumption.RequestLatencyTime",e,"ms")})),e.response()})).then(freeOnUnref(function(e){i.throwIfRequested();var t=If.transformPRSv1Response(e);if(!t.playbackUrls.ok)throw t.playbackUrls.error;var n=t.playbackUrls.value;return r.cacheKey===n.cacheKey||r.isDownloadedPlayback?{result:"normal"}:(a.info('Stale PlaybackUrls detected ("'+r.cacheKey+'" -> "'+n.cacheKey+'"). Restarting stream to invalidate cache.'),{result:"stale_resources"})})).catch(freeOnUnref(function(e){return r.terminated||r.isDownloadedPlayback||e instanceof lt.CancelError?{result:"normal"}:{result:"not_allowed",reason:ct.XpError.generatePrefixedError(e,"session")}}))}),e})();t.UpdateStreamPlaybackSessionTracker=n}));e(xf);xf.UpdateStreamPlaybackSessionTracker;var Ff=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={InvalidRequest:"pes.invalid_request","PlaybackEnvelope.Invalid":"pes.playback_envelope.invalid","PlaybackEnvelope.Expired":"pes.playback_envelope.expired","SessionHandoff.Invalid":"pes.session_handoff.invalid","Handoff.PromiseMismatch":"pes.session_handoff.mismatch","SessionToken.Invalid":"pes.session_token.invalid","SessionToken.Expired":"pes.session_token.expired","Denied.ConcurrencyLimitBreached":"pes.concurrency.limit_breached","Denied.PVLowerTierBreached":"pes.concurrency.limit_breached","Denied.PVMidTierBreached":"pes.concurrency.limit_breached","AccessTicket.Denied.CustomerMismatch":"pes.access_ticket.denied","AccessTicket.Denied.DeviceNotAuthorized":"pes.access_ticket.denied","AccessTicket.Denied.GeoLocationChanged":"pes.access_ticket.denied"},r=freeOnUnref(function(){function e(){}return e.createError=freeOnUnref(function(e){var t=n[e.errorCode];return null!=t?new ct.XpError(t,void 0,e.message):new ct.XpError("pes.unknown",void 0,e.message)}),e})();t.PesErrorHandler=r}));e(Ff);Ff.PesErrorHandler;var Bf=t(freeOnUnref(function(e,t){var r=ce&&ce.__assign||freeOnUnref(function(){return(r=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var o=[500];function a(e,t,n,r){var i=Ff.PesErrorHandler.createError(t);0<=o.indexOf(e)?n(i):r(i)}var n=yr.createCDPResponseProcessor(freeOnUnref(function(e,t,n,r,i){if(400<=e)a(e,t,r,i);else{var o=t;if(null==o.callbackIntervalInSeconds)return void i(new ct.XpError("PlaybackEventService.Error.InvalidBodyResponse"));n(o)}}),!0),i=yr.createCDPResponseProcessor(freeOnUnref(function(e,t,n,r,i){if(400<=e)a(e,t,r,i);else{var o=t;if(null==o.callbackIntervalInSeconds)return void i(new ct.XpError("PlaybackEventService.Error.InvalidBodyResponse"));n(o)}}),!0),s=yr.createCDPResponseProcessor(freeOnUnref(function(e,t,n,r,i){400<=e?a(e,t,r,i):n({})}),!0),l=de.get("PlaybackEventServiceClient"),f=freeOnUnref(function(){function e(e){var t={firmware:"1",version:"1"};this.startSessionClient=e.createServiceClient("/cdp/playback/pes/StartSession",t,n,"pes"),this.stopSessionClient=e.createServiceClient("/cdp/playback/pes/StopSession",t,s,"pes"),this.updateSessionClient=e.createServiceClient("/cdp/playback/pes/UpdateSession",t,i,"pes")}return e.prototype.sendStart=freeOnUnref(function(e,t){var n={method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)};return Qe.sanitize(n),l.info("PES Client sendStart request",JSON.stringify(r({eventType:t.streamInfo.eventType},t.userWatchSessionId&&{userWatchSessionId:t.userWatchSessionId},t.streamInfo.streamIntent&&{streamIntent:t.streamInfo.streamIntent}))),this.startSessionClient.send(n,e,"CRITICAL",!0,!0)}),e.prototype.sendUpdate=freeOnUnref(function(e,t){var n={method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)};return Qe.sanitize(n),l.info("PES Client sendUpdate request",JSON.stringify(r({eventType:t.streamInfo.eventType},t.streamInfo.streamIntent&&{streamIntent:t.streamInfo.streamIntent}))),this.updateSessionClient.send(n,e,"NOTIFICATION",!0,!0)}),e.prototype.sendStop=freeOnUnref(function(e,t){var n={method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)};return Qe.sanitize(n),l.info("PES Client sendStop request",JSON.stringify(r({eventType:t.streamInfo.eventType},t.streamInfo.streamIntent&&{streamIntent:t.streamInfo.streamIntent}))),this.stopSessionClient.send(n,e,"NOTIFICATION",!0,!0)}),e})();t.PlaybackEventServiceClient=f}));e(Bf);Bf.PlaybackEventServiceClient;var Lf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlaybackEventServiceClient=Bf.PlaybackEventServiceClient}));e(Lf);Lf.PlaybackEventServiceClient;var Nf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=["pes.session_handoff.mismatch"].map(freeOnUnref(function(e){return e.toString()})),r=["pes.concurrency.limit_breached","envelope.refresh.error.vppa"].map(freeOnUnref(function(e){return e.toString()})),f=de.get("SessionApiPlaybackSessionTracker"),i=freeOnUnref(function(){function e(e,t,n,r){this.updateIntervalMs=2e4,this.cancelCurrentPesRequest=null,this.terminated=!1,this.eventEmitter=new A.EventEmitter,this.playbackEventServiceClient=new Lf.PlaybackEventServiceClient(e),this.session=t,this.envelopeRefreshController=n,this.userWatchSessionId=r,this.updateEvent=null,this.hasStarted=!1}return e.prototype.play=freeOnUnref(function(e,t,n,r){return this.updateEvent="PLAY",this.hasStarted?this.update(e,t,n):this.reportStart(e,t,n,r)}),e.prototype.pause=freeOnUnref(function(e,t,n){return null==this.updateEvent?(f.error("Attempted to report update on a session that has not started"),lt.Promise.resolve({result:"not_allowed",reason:new ct.XpError("pes.session_not_started")})):(this.updateEvent="PAUSE",this.update(e,t,n))}),e.prototype.update=freeOnUnref(function(t,n,r){var i=this;if(null==this.updateEvent)return f.warn("Attempted to report update on a session that has not started"),lt.Promise.resolve({result:"not_allowed",reason:new ct.XpError("pes.session_not_started")});if(null==this.sessionToken)return lt.Promise.resolve({result:"normal"});var e=lt.CancelToken.source(),o=e.token,a=e.cancel;this.cancelCurrentPesRequest=a;var s={eventType:this.updateEvent,streamUpdateTime:(new Date).toISOString()};r&&(s.streamIntent="AUTOPLAY"),this.setProgressInfo(s,t,n);var l={sessionToken:this.sessionToken,streamInfo:s};return this.playbackEventServiceClient.sendUpdate(o,l).then(freeOnUnref(function(e){return e.response()})).then(freeOnUnref(function(e){return i.terminated||(i.sessionToken=e.sessionToken,i.updateIntervalMs=1e3*e.callbackIntervalInSeconds),lt.Promise.resolve({result:"normal"})})).catch(freeOnUnref(function(e){return i.terminated?lt.Promise.resolve({result:"normal"}):e instanceof ct.XpError&&"pes.session_token.expired"===e.code?(f.info("UpdateSession request failed due to expired session token, sending start session",e),q.metrics.putMetric("ServiceRequest.PES.UpdateSession.TokenExpiredRenewalAttempt"),i.reportStart(t,n,r)):(f.warn("UpdateSession request failed",e),q.metrics.putMetric("ServiceRequest.PES.UpdateSession.Error"),i.handleSessionApiError(e))}))}),e.prototype.stop=freeOnUnref(function(e,t,n){if((this.updateEvent=null)==this.sessionToken)return lt.Promise.resolve();var r=lt.CancelToken.source(),i=r.token,o=r.cancel;this.cancelCurrentPesRequest=o;var a={eventType:"STOP",streamUpdateTime:(new Date).toISOString()};n&&(a.streamIntent="AUTOPLAY"),this.setProgressInfo(a,e,t);var s={sessionToken:this.sessionToken,streamInfo:a};return this.playbackEventServiceClient.sendStop(i,s).then(freeOnUnref(function(e){return e.response()})).then(freeOnUnref(function(){})).catch(freeOnUnref(function(e){return f.warn("StopSession request failed",e),q.metrics.putMetric("ServiceRequest.PES.UpdateSession.Error"),lt.Promise.resolve()}))}),e.prototype.setAdditionalBookmarkData=freeOnUnref(function(e,t){}),e.prototype.terminate=freeOnUnref(function(){this.terminated=!0,null!=this.cancelCurrentPesRequest&&(this.cancelCurrentPesRequest(),this.cancelCurrentPesRequest=null)}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.reportStart=freeOnUnref(function(r,i,o,t,n){var a=this;void 0===n&&(n=!1),this.hasStarted=!0;var e=lt.CancelToken.source(),s=e.token,l=e.cancel;return this.cancelCurrentPesRequest=l,lt.makeCancellable(s,this.envelopeRefreshController.getFreshEnvelope(n)).then(freeOnUnref(function(e){var t={eventType:"START",streamUpdateTime:(new Date).toISOString()};o&&(t.streamIntent="AUTOPLAY"),a.setProgressInfo(t,r,i);var n={sessionHandoff:a.session.sessionHandoffToken,playbackEnvelope:e.envelope,streamInfo:t,userWatchSessionId:a.userWatchSessionId};return a.playbackEventServiceClient.sendStart(s,n)})).then(freeOnUnref(function(e){return e.response()})).then(freeOnUnref(function(e){return a.terminated||(a.sessionToken=e.sessionToken,a.updateIntervalMs=1e3*e.callbackIntervalInSeconds),lt.Promise.resolve({result:"normal"})})).catch(freeOnUnref(function(e){return f.warn("StartSession request failed",e),q.metrics.putMetric("ServiceRequest.PES.StartSession.Error"),e instanceof ct.XpError&&"pes.playback_envelope.expired"===e.code?n?lt.Promise.resolve({result:"not_allowed",reason:e}):a.reportStart(r,i,o,t,!0):lt.Promise.resolve(a.handleSessionApiError(e))}))}),e.prototype.setProgressInfo=freeOnUnref(function(e,t,n){n===ka.TimeUnit.ContentMillis?e.vodProgressInfo={currentProgressTime:jr.millisecondsToIsoDuration(t),timeFormat:"ISO8601DURATION"}:n===ka.TimeUnit.EpochMillis&&(e.liveProgressInfo={currentProgressTime:new Date(t).toISOString(),timeFormat:"ISO8601DATETIME"})}),e.prototype.handleSessionApiError=freeOnUnref(function(e){if(this.terminated||e instanceof lt.CancelError)return{result:"normal"};if(e instanceof ct.XpError){if(0<=n.indexOf(e.code))return{result:"stale_resources"};if(0<=r.indexOf(e.code))return{result:"not_allowed",reason:e}}return{result:"normal"}}),e})();t.SessionApiPlaybackSessionTracker=i}));e(Nf);Nf.SessionApiPlaybackSessionTracker;var Vf=t(freeOnUnref(function(e,n){function t(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),t(Sf),t(Uf),t(bf),t(_f),t(wf),t(Rf),t(Tf),t(xf),t(Nf)}));e(Vf);var jf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("PRSResolver");function c(e){return!!e&&!0===e.disableLinearMetadataFetch}var n=freeOnUnref(function(){function e(e,t,n,r,i,o){this.prsClient=e,this.livePrsClient=t,this.liveLinearPrsClient=n,this.vodPrsClient=r,this.serviceClientFactory=i,this.clientPrsParameters=o,this.prsRequestV2Factory=new rf.PlaybackResourceRequestV2Factory,this.diagnostics=nn.Diagnostics.create("PRSResolver")}return e.prototype.resolve=freeOnUnref(function(o,r,a,i,e,t){var s=this,l=null,f=null;return this.createBaseRequestBuilder(o,a,i,e,t).then(freeOnUnref(function(e){return i.throwIfRequested(),l=e,s.createPrimaryRequestBuilder(e,o,i)})).then(freeOnUnref(function(e){i.throwIfRequested(),r||(f=e.clone().build("ImmediateConsumption")),e.resource(Pr.PlaybackResource.SubtitleUrls("TTMLv2")).resource(Pr.PlaybackResource.ForcedNarratives()).resource(Pr.PlaybackResource.TrickplayUrls()).resource(Pr.PlaybackResource.TransitionTimecodes()).resource(Pr.PlaybackResource.PlaybackSettings("1.0.0",o.heuristicProfile)),null!=s.clientPrsParameters.titleDecorationScheme&&e.resource(Pr.PlaybackResource.CatalogMetadata(s.clientPrsParameters.titleDecorationScheme)),null!=o.acceptedCreativeApis&&0<o.acceptedCreativeApis.length&&e.acceptedCreativeApis(o.acceptedCreativeApis),"LiveStreaming"!==o.videoMaterialType||null==s.clientPrsParameters.liveScheduleConfigToken||c(o)||e.resource(Pr.PlaybackResource.LiveSchedule(s.clientPrsParameters.liveScheduleConfigToken)).resource(Pr.PlaybackResource.LinearRestrictions(Vf.LinearRestrictionsConfig.LINEAR_RESTRICTIONS_START_TIME_MINS,Vf.LinearRestrictionsConfig.LINEAR_RESTRICTIONS_END_TIME_MINS)),"LiveStreaming"===o.videoMaterialType&&nf.isLiveLowLatencySupported()&&!Ra.shouldBlockSyeUrlsRequest(o.clientId)&&e.resource(Pr.PlaybackResource.SyeUrls());var t=s.clientPrsParameters.xrayConfig;null!=t&&e.resource(Pr.PlaybackResource.XRayMetadata(t.token,t.playbackMode,t.deviceClass)),o.useBookmarkStartPosition&&e.resource(Pr.PlaybackResource.WhisperSyncBookmark());var n=r?"ImmediateConsumption":"CacheResources";return s.prsClient.send(e.build(n),i)})).then(freeOnUnref(function(e){return e.on("latency",freeOnUnref(function(e){s.reportTtffProfiling(e),q.metrics.putMetric("ServiceRequest.PRS.PrimaryResources.RequestLatencyTime",e,"ms"),u.info("[TTFF] PRSv1 request latency took "+e+" ms")})),e.response()})).then(freeOnUnref(function(e){var t,n=Vf.PlaybackResourcesConverter.transformPRSv1Response(e);"LiveStreaming"!==o.videoMaterialType||null==s.clientPrsParameters.liveScheduleConfigToken||c(o)||(t=new Vf.PRSv1LiveScheduleRefresher(s.prsClient,s.clientPrsParameters.liveScheduleConfigToken,l));var r=Vf.PlaybackResourceUtils.valueOrNull(n.playbackUrls),i=new Vf.UpdateStreamPlaybackSessionTracker(s.serviceClientFactory,a,n.session,o.titleId,s.prsClient,f,null!=r?r.cacheKey:void 0,!1);return{main:{playbackResources:n,licenseAcquirer:new Hr.LicenseAcquirerV1(s.prsClient,l),liveScheduleRefresher:t,playbackSession:i}}})).catch(freeOnUnref(function(e){throw e instanceof lt.CancelError||(q.metrics.putMetric("ServiceRequest.PRS.PrimaryResources.Error"),u.error("PRSv1 request failed",e)),e}))}),e.prototype.createImmediateConsumptionRequest=freeOnUnref(function(e,t,n){return this.createPrimaryRequestBuilder(e,t,n).then(freeOnUnref(function(e){return n.throwIfRequested(),e.clone().build("ImmediateConsumption")}))}),e.prototype.resolveLiveV2=freeOnUnref(function(i,o,e,t,n){var a=this,s=new ei.PlaybackEnvelopeRefreshController(i);return s.initialize(),this.createAndSendLiveRequestV2(i,s,!1,o,e,t,n).then(freeOnUnref(function(e){var t=e.rapidRecap,n=e.main,r={main:{playbackResources:n,licenseAcquirer:new Zr.LicenseAcquirerV2(a.serviceClientFactory,i,s,a.extractSessionHandoffToken(n.session)),playbackSession:a.createSessionTracker(n.session,o,i.titleId,s)}};return t&&(r.recap={playbackResources:t,licenseAcquirer:new Zr.LicenseAcquirerV2(a.serviceClientFactory,i,s,a.extractSessionHandoffToken(t.session)),playbackSession:a.createSessionTracker(t.session,o,i.titleId,s)}),r}))}),e.prototype.resolveCacheLiveV2=freeOnUnref(function(n,e,t){var r=this;u.info("Resolving caching Live request for PRSv2.");var i=new ei.PlaybackEnvelopeRefreshController(n);return i.initialize(),this.createAndSendLiveRequestV2(n,i,!1,void 0,e,t).then(freeOnUnref(function(e){e.rapidRecap;var t=e.main;return{main:{playbackResources:t,licenseAcquirer:new Zr.LicenseAcquirerV2(r.serviceClientFactory,n,i,r.extractSessionHandoffToken(t.session))}}}))}),e.prototype.resolveLiveLinearV2=freeOnUnref(function(t,n,e,r){var i=this,o=new ei.PlaybackEnvelopeRefreshController(t);return o.initialize(),this.createAndSendLiveLinearRequestV2(t,o,!1,n,e,r).then(freeOnUnref(function(e){return{main:{playbackResources:e,licenseAcquirer:new Zr.LicenseAcquirerV2(i.serviceClientFactory,t,o,i.extractSessionHandoffToken(e.session)),playbackSession:i.createSessionTracker(e.session,n,t.titleId,o)}}}))}),e.prototype.resolveVodV2=freeOnUnref(function(t,n,e,r){var i=this;u.info("Resolving Vod for PRSv2."),t.disableContinuousPlayDiscovery=!0;var o=new ei.PlaybackEnvelopeRefreshController(t);return o.initialize(),this.createAndSendVodRequestV2(t,o,!1,e,r).then(freeOnUnref(function(e){return{main:{playbackResources:e,licenseAcquirer:new Zr.LicenseAcquirerV2(i.serviceClientFactory,t,o,i.extractSessionHandoffToken(e.session)),playbackSession:i.createSessionTracker(e.session,n,t.titleId,o)}}}))}),e.prototype.resolveCacheVodV2=freeOnUnref(function(t,e,n){var r=this;u.info("Resolving caching Vod request for PRSv2."),t.disableContinuousPlayDiscovery=!0;var i=new ei.PlaybackEnvelopeRefreshController(t);return i.initialize(),this.createAndSendVodRequestV2(t,i,!1,e,n).then(freeOnUnref(function(e){return{main:{playbackResources:e,licenseAcquirer:new Zr.LicenseAcquirerV2(r.serviceClientFactory,t,i,r.extractSessionHandoffToken(e.session))}}}))}),e.prototype.createAndSendVodRequestV2=freeOnUnref(function(r,t,n,i,o){var a=this;return lt.Promise.all([o.getValue(),ct.prefixPromiseError("prs",lt.makeCancellable(i,t.getFreshEnvelope(n)))]).then(freeOnUnref(function(e){var t=e[0],n=e[1];return a.createVodV2Request(r,n,t,i)})).then(freeOnUnref(function(e){return a.vodPrsClient.sendRequest(e,i)})).then(freeOnUnref(function(e){return a.reportLatencyMetrics(e,"Feature",i)})).then(freeOnUnref(function(e){return Vf.PlaybackResourcesConverter.transformPRSv2VodResponse(r.videoMaterialType,e)})).then(freeOnUnref(function(e){return a.validateCorrectSessionTypeForSessionApi(e)})).catch(freeOnUnref(function(e){return a.retryOnExpiredEnvelope(e,n,"Feature",freeOnUnref(function(){return a.createAndSendVodRequestV2(r,t,!0,i,o)}))}))}),e.prototype.createAndSendLiveRequestV2=freeOnUnref(function(r,t,n,i,o,a,s){var l=this;return lt.Promise.all([a.getValue(),ct.prefixPromiseError("prs",lt.makeCancellable(o,t.getFreshEnvelope(n)))]).then(freeOnUnref(function(e){var t=e[0],n=e[1];return l.createLiveRequestV2(r,i,n,t,o,s)})).then(freeOnUnref(function(e){return l.livePrsClient.sendLiveRequest(e,o)})).then(freeOnUnref(function(e){return l.reportLatencyMetrics(e,"LiveStreaming",o)})).then(freeOnUnref(function(e){return Vf.PlaybackResourcesConverter.transformPRSv2LiveResponse(e,null==r.playbackExperiences?[]:r.playbackExperiences)})).catch(freeOnUnref(function(e){return l.retryOnExpiredEnvelope(e,n,"LiveStreaming",freeOnUnref(function(){return l.createAndSendLiveRequestV2(r,t,!0,i,o,a,s)}))}))}),e.prototype.createAndSendLiveLinearRequestV2=freeOnUnref(function(r,t,n,i,o,a){var s=this;return lt.Promise.all([a.getValue(),ct.prefixPromiseError("prs",lt.makeCancellable(o,t.getFreshEnvelope(n)))]).then(freeOnUnref(function(e){var t=e[0],n=e[1];return s.createLiveLinearRequestV2(r,i,n,t,o)})).then(freeOnUnref(function(e){return s.liveLinearPrsClient.sendLiveLinearRequest(e,o)})).then(freeOnUnref(function(e){return s.reportLatencyMetrics(e,"LiveStreaming",o)})).then(freeOnUnref(function(e){return Vf.PlaybackResourcesConverter.transformPRSv2LiveLinearResponse(e,r.videoMaterialType)})).then(freeOnUnref(function(e){return s.validateCorrectSessionTypeForSessionApi(e)})).catch(freeOnUnref(function(e){return s.retryOnExpiredEnvelope(e,n,"LiveStreaming",freeOnUnref(function(){return s.createAndSendLiveLinearRequestV2(r,t,!0,i,o,a)}))}))}),e.prototype.createVodV2Request=freeOnUnref(function(e,t,n,r){r.throwIfRequested();var i=e.titleId,o=e.optOutAdTracking,a=e.advertisingId,s=e.dataPrivacy,l=e.heuristicProfile,f=e.acceptedCreativeApis,u=e.site,c=e.enablePlaylisting,d=this.clientPrsParameters.xrayConfig,p=null==d?void 0:{token:d.token,deviceClass:d.deviceClass,playbackMode:d.playbackMode,preferredLocale:Qe.withDefault(d.preferredLocale,this.clientPrsParameters.uxLocale)},h=Rr.createPrsGeneralApiParameters(this.clientPrsParameters),m=Dr.createPrsV2AdParameters(o,s,a,h.appBundleId,h.appStoreUrl,null!=u?u.page:void 0,e.position);return this.prsRequestV2Factory.createVodPlaybackResourcesRequest({playbackEnvelope:t.envelope,titleId:i,adParams:m,capVideoDefinition:null==n?void 0:n,xrayConfig:p,heuristicProfile:l,acceptedCreativeApis:f,enablePlaylisting:c})}),e.prototype.createLiveRequestV2=freeOnUnref(function(e,t,n,r,i,o){i.throwIfRequested();var a=e.titleId,s=e.optOutAdTracking,l=e.advertisingId,f=e.dataPrivacy,u=e.playbackExperiences,c=e.encodePreferences,d=e.heuristicProfile,p=e.acceptedCreativeApis,h=e.site,m=Qe.withDefault(e.isAutoplaySession,!1),y=this.clientPrsParameters.xrayConfig,g=null==y?void 0:{token:y.token,deviceClass:y.deviceClass,playbackMode:y.playbackMode,preferredLocale:Qe.withDefault(y.preferredLocale,this.clientPrsParameters.uxLocale),exploreClientCapabilitiesToken:y.exploreClientCapabilitiesToken},v=Rr.createPrsGeneralApiParameters(this.clientPrsParameters),O=Dr.createPrsV2AdParameters(s,f,l,v.appBundleId,v.appStoreUrl,null!=h?h.page:void 0);return this.prsRequestV2Factory.createLivePlaybackResourcesRequest({playbackEnvelope:n.envelope,titleId:a,adParams:O,capVideoDefinition:null==r?void 0:r,xrayConfig:g,isLiveLowLatencySupported:nf.isLiveLowLatencySupported(),playbackExperiences:u,clientId:e.clientId,isAutoplaySession:m,userWatchSessionId:t,acceptedCreativeApis:p,heuristicProfile:d,preserveStreamingAffinity:!!e.preserveStreamingAffinity&&e.preserveStreamingAffinity,streamStartOverrides:o,encodePreferences:c})}),e.prototype.createLiveLinearRequestV2=freeOnUnref(function(e,t,n,r,i){i.throwIfRequested();var o=e.titleId,a=e.optOutAdTracking,s=e.advertisingId,l=e.dataPrivacy,f=(e.playbackExperiences,e.encodePreferences),u=e.heuristicProfile,c=e.acceptedCreativeApis,d=e.site,p=Qe.withDefault(e.isAutoplaySession,!1),h=Rr.createPrsGeneralApiParameters(this.clientPrsParameters),m=Dr.createPrsV2AdParameters(a,l,s,h.appBundleId,h.appStoreUrl,null!=d?d.page:void 0);return this.prsRequestV2Factory.createLiveLinearPlaybackResourcesRequest({playbackEnvelope:n.envelope,titleId:o,adParams:m,capVideoDefinition:null==r?void 0:r,clientId:e.clientId,isAutoplaySession:p,userWatchSessionId:t,acceptedCreativeApis:c,heuristicProfile:u,encodePreferences:f})}),e.prototype.createBaseRequestBuilder=freeOnUnref(function(t,n,r,e,i){var o=t.titleId,a=t.videoMaterialType,s=t.playbackToken,l=t.clientId,f=new ra.PlaybackResourceRequestBuilderFactory;return e.getValue().then(freeOnUnref(function(e){return r.throwIfRequested(),f.createDeviceCompliantBuilder(e,r,t.encodePreferences,i)})).then(freeOnUnref(function(e){return r.throwIfRequested(),e.content(o,a,"Streaming",s,l).userWatchSessionId(n)}))}),e.prototype.createPrimaryRequestBuilder=freeOnUnref(function(r,i,o){var a=i.optOutAdTracking,s=i.advertisingId,l=i.dataPrivacy;return of.PlaybackUrlsOptionsFactory.create().then(freeOnUnref(function(e){o.throwIfRequested();var t=r.clone().resource(Pr.PlaybackResource.PlaybackUrls(e));null!=i.site&&t.sitePageUrl(i.site.page);var n=Ar.createPrsV1CuepointPlaylistOptions(a,l,s);return t.resource(Pr.PlaybackResource.CuepointPlaylist(void 0,n)),t}))}),e.prototype.createSessionTracker=freeOnUnref(function(e,t,n,r){return"updatestream"===e.type?new Vf.UpdateStreamPlaybackSessionTracker(this.serviceClientFactory,t,e,n,this.prsClient,null,void 0,!1):new Vf.SessionApiPlaybackSessionTracker(this.serviceClientFactory,e,r,t)}),e.prototype.reportLatencyMetrics=freeOnUnref(function(e,t,n){var r,i=this;n.throwIfRequested();var o=((r={}).Feature=["ServiceRequest.PRS.VodPlaybackResources.RequestLatencyTime","Vod PRSv2"],r.LiveStreaming=["ServiceRequest.PRS.LivePlaybackResources.RequestLatencyTime","Live PRSv2"],r)[t],a=o[0],s=o[1];return e.on("latency",freeOnUnref(function(e){i.reportTtffProfiling(e),q.metrics.putMetric(a,e,"ms"),u.info("[TTFF] "+s+" request latency took "+e+" ms")})),e.response()}),e.prototype.reportTtffProfiling=freeOnUnref(function(e){var t=Date.now();this.diagnostics.report("ttff",{prsStartTime:Math.round(t-e),prsEndTime:t})}),e.prototype.retryOnExpiredEnvelope=freeOnUnref(function(e,t,n,r){var i;if(e instanceof lt.CancelError)throw e;var o=((i={}).Feature=["VodPlaybackResources","VOD PRSv2"],i.LiveStreaming=["LivePlaybackResources","Live PRSv2"],i)[n],a=o[0],s=o[1];if(q.metrics.putMetric("ServiceRequest.PRS."+a+".Error"),u.error(s+" request failed",e),e instanceof ct.XpError&&"prs.playback_envelope_expired"===e.code){if(q.metrics.putMetric("ServiceRequest.PRS."+a+".PlaybackEnvelope.Expired"),t)throw new ct.XpError("prs.envelope.refresh.loop");return r()}throw e}),e.prototype.validateCorrectSessionTypeForSessionApi=freeOnUnref(function(e){if("session_api"!==e.session.type)throw new ct.XpError("pes.session_handoff.invalid");return e}),e.prototype.extractSessionHandoffToken=freeOnUnref(function(e){return"session_api"===e.type?e.sessionHandoffToken:void 0}),e})();t.PRSResolver=n}));e(jf);jf.PRSResolver;var qf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("SuggestedPictureModeStrategy"),r=freeOnUnref(function(){function e(e,t){this.contentConfig=e,this.dynamicRange=t;var n=L.configurationStore.configuration;null!=n&&null!=n.pictureMode&&null!=n.pictureMode.filmmakerMode&&"boolean"==typeof n.pictureMode.filmmakerMode.enableWhenSDR?this.enableFmmForSDRContent=n.pictureMode.filmmakerMode.enableWhenSDR:this.enableFmmForSDRContent=!1}return e.prototype.getSuggestedPictureModes=freeOnUnref(function(){var e=[];return"LiveStreaming"===this.contentConfig.videoMaterialType?e.push("CalibratedBroadcast"):("Promo"!==this.contentConfig.videoMaterialType&&e.push("CalibratedCinematic"),this.isSdrContent(this.dynamicRange)&&!this.enableFmmForSDRContent||e.push("Filmmaker")),n.info("XP suggested picture modes: ["+e+"], dynamic range: "+this.dynamicRange+", video type: "+this.contentConfig.videoMaterialType+", enableFmmForSDRContent: "+this.enableFmmForSDRContent),e}),e.prototype.isSdrContent=freeOnUnref(function(e){return"Hdr10"!==e&&"DolbyVision"!==e}),e})();t.SuggestedPictureModeStrategy=r}));e(qf);qf.SuggestedPictureModeStrategy;var Hf=t(freeOnUnref(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPrsGeneralApiParameters=Rr.createPrsGeneralApiParameters,n.createPrsV1CuepointPlaylistOptions=Ar.createPrsV1CuepointPlaylistOptions,n.createPrsV2AdParameters=Dr.createPrsV2AdParameters,n.LicenseAcquirerV1=Hr.LicenseAcquirerV1,n.LicenseAcquirerV2=Zr.LicenseAcquirerV2,n.PlaybackEnvelopeRefreshController=ei.PlaybackEnvelopeRefreshController,n.isPlaybackEnvelopeExpired=$r.isPlaybackEnvelopeExpired,n.PlaybackResourceRequestBuilderFactory=ra.PlaybackResourceRequestBuilderFactory,n.PlaybackResourceRequestV2Factory=rf.PlaybackResourceRequestV2Factory,n.PlaybackUrlsOptionsFactory=of.PlaybackUrlsOptionsFactory,n.shouldBlockSyeUrlsRequest=Ra.shouldBlockSyeUrlsRequest,n.mapAudioTracks=vf.mapAudioTracks,n.fromPlaybackUrls=Of.fromPlaybackUrls,n.fromPlaylistedPlaybackUrls=Of.fromPlaylistedPlaybackUrls,function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(Vf),n.PRSResolver=jf.PRSResolver,n.SuggestedPictureModeStrategy=qf.SuggestedPictureModeStrategy}));e(Hf);Hf.createPrsGeneralApiParameters,Hf.createPrsV1CuepointPlaylistOptions,Hf.createPrsV2AdParameters,Hf.LicenseAcquirerV1,Hf.LicenseAcquirerV2,Hf.PlaybackEnvelopeRefreshController,Hf.isPlaybackEnvelopeExpired,Hf.PlaybackResourceRequestBuilderFactory,Hf.PlaybackResourceRequestV2Factory,Hf.PlaybackUrlsOptionsFactory,Hf.shouldBlockSyeUrlsRequest,Hf.mapAudioTracks,Hf.fromPlaybackUrls,Hf.fromPlaylistedPlaybackUrls,Hf.PRSResolver,Hf.SuggestedPictureModeStrategy;var zf=t(freeOnUnref(function(e,t){var a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("CacheBufferManager"),n=freeOnUnref(function(){function e(e){this.contentReservations={},this.pendingReservations=[],this.pendingDeallocationContentId=null,this.maxAvailableBytes=e,this.availableBytes=e}return e.prototype.getContentReservation=freeOnUnref(function(e){var t=this.contentReservations[e];return null!=this.contentReservations[e]?{fulfilled:!0,sizeBytes:t.sizeBytes,onFreed:t.onFreed}:null}),e.prototype.reserveForContent=freeOnUnref(function(e){var t=this;if(e.sizeBytes<0)return s.warn("Expected sizeBytes ["+e.sizeBytes+"] >= 0"),{fulfilled:!1};var n=e.contentId,r=this.contentReservations[n];if(null!=r)return{fulfilled:!0,sizeBytes:r.sizeBytes,onFreed:r.onFreed};this.availableBytes-=e.sizeBytes;var i={fulfilled:!0,sizeBytes:e.sizeBytes,onFreed:freeOnUnref(function(){t.freeReservation(n)})};return this.contentReservations[n]={contentId:e.contentId,sizeBytes:e.sizeBytes,priorityComparable:e.priorityComparable,flush:e.flush,onFreed:i.onFreed},i}),e.prototype.reserve=freeOnUnref(function(e){var t=e.sizeBytes;if(t<=0)return s.warn("Expected sizeBytes ["+t+"] > 0"),{fulfilled:!1};if(null==e.contentId)return s.warn("No contentId provided."),{fulfilled:!1};if(null==e.priorityComparable)return s.warn("No priority comparable provided."),{fulfilled:!1};var n=e.contentId,r=this.contentReservations[n];if(null==r)return s.warn("No previous initialization found for contentId "+e.contentId),{fulfilled:!1};if(this.availableBytes<t){if(this.isRetriable(e)){var i=e;this.pendingReservations.push(i),this.retryPendingReservations()}return{fulfilled:!1}}this.availableBytes-=t;var o={fulfilled:!0,sizeBytes:t,onFreed:freeOnUnref(function(){})};return this.contentReservations[e.contentId]=a({},r,{sizeBytes:r.sizeBytes+e.sizeBytes}),o}),e.prototype.irrevocableReserve=freeOnUnref(function(e){return{fulfilled:!1}}),e.prototype.onPosition=freeOnUnref(function(e){}),e.prototype.getMaxAllowedBps=freeOnUnref(function(){return 1/0}),e.prototype.getMaxAvailableBytes=freeOnUnref(function(){return this.maxAvailableBytes}),e.prototype.tryDeallocateForRequest=freeOnUnref(function(t){var n=this;if(null==this.pendingDeallocationContentId){var e=Object.keys(this.contentReservations).map(freeOnUnref(function(e){return n.contentReservations[e]})).filter(freeOnUnref(function(e){return 0<e.priorityComparable.compareTo(t.priorityComparable)})).sort(freeOnUnref(function(e,t){return t.priorityComparable.compareTo(e.priorityComparable)}));0!==e.length&&(this.pendingDeallocationContentId=e[0].contentId,e[0].flush())}}),e.prototype.freeReservation=freeOnUnref(function(e){if(e===this.pendingDeallocationContentId&&(this.pendingDeallocationContentId=null),null!=this.contentReservations[e]){var t=this.contentReservations[e];this.availableBytes+=t.sizeBytes,delete this.contentReservations[e],this.retryPendingReservations()}}),e.prototype.retryPendingReservations=freeOnUnref(function(){var t=this;this.pendingReservations=this.pendingReservations.filter(freeOnUnref(function(e){return t.isRetriable(e)})).sort(freeOnUnref(function(e,t){return e.priorityComparable.compareTo(t.priorityComparable)}));for(var e=this.availableBytes;0<this.pendingReservations.length&&!(e<this.pendingReservations[0].sizeBytes);){var n=this.pendingReservations.shift();e-=n.sizeBytes,n.onRetry.retry(!1)}0<this.pendingReservations.length&&this.tryDeallocateForRequest(this.pendingReservations[0])}),e.prototype.isRetriable=freeOnUnref(function(e){return null!=e.onRetry&&(!e.onRetry.cancelToken.requested||(e.onRetry.retry(!0),!1))}),e})();t.CacheBufferManager=n}));e(zf);zf.CacheBufferManager;var Wf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.CRITICAL_STREAM_TYPES=["Audio","Video"]}));e(Wf);Wf.CRITICAL_STREAM_TYPES;var Kf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.cacheEntries={}}return e.prototype.get=freeOnUnref(function(e){var t=this.cacheEntries[e.toString()];return null!=t?t:null}),e.prototype.getAll=freeOnUnref(function(){return x.values(this.cacheEntries)}),e.prototype.getAllKeys=freeOnUnref(function(){return Object.keys(this.cacheEntries)}),e.prototype.put=freeOnUnref(function(e,t){this.cacheEntries[e.toString()]=t}),e.prototype.remove=freeOnUnref(function(e){delete this.cacheEntries[e.toString()]}),e.prototype.findValue=freeOnUnref(function(e){for(var t=0,n=Object.keys(this.cacheEntries);t<n.length;t++){var r=n[t];if(e(this.cacheEntries[r]))return this.cacheEntries[r]}return null}),e.prototype.trim=freeOnUnref(function(e){for(var t=[],n=0,r=Object.keys(this.cacheEntries);n<r.length;n++){var i=r[n];e(this.cacheEntries[i])||(t.push(this.cacheEntries[i]),delete this.cacheEntries[i])}return t}),e.prototype.clear=freeOnUnref(function(){this.cacheEntries={}}),e})();t.InMemoryCache=n}));e(Kf);Kf.InMemoryCache;var Gf=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})(),f=ce&&ce.__rest||freeOnUnref(function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n});Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this)||this;return t.downloadOperationId=e,t}return r(e,n),e.prototype.get=freeOnUnref(function(e){return null}),e.prototype.getAll=freeOnUnref(function(){return[]}),e.prototype.getAllKeys=freeOnUnref(function(){return[]}),e.prototype.put=freeOnUnref(function(e,t){var n=t.readySegment,r=n.periodId,i=n.streamId,o=n.qualityLevelId,a=n.data,s=f(n,["periodId","streamId","qualityLevelId","data"]);if(null!=a){var l=gf.createLocalStorageSegmentId(this.downloadOperationId,r,i,o,s);Pt.localStorage.put(l,a)}}),e.prototype.remove=freeOnUnref(function(e){}),e.prototype.findValue=freeOnUnref(function(e){return null}),e.prototype.trim=freeOnUnref(function(e){return[]}),e.prototype.clear=freeOnUnref(function(){}),e})(Kf.InMemoryCache);t.DiskCache=n}));e(Gf);Gf.DiskCache;var Qf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){if(this.downloadOperationId=t,this.isDiskCaching="Disk"===e,this.isDiskCaching&&null==this.downloadOperationId)throw new Error("Attempted to create a CacheFactory with disk storage type, but downloadOperationId cannot be null")}return e.prototype.createSegmentCache=freeOnUnref(function(){return this.isDiskCaching?new Gf.DiskCache(this.downloadOperationId):new Kf.InMemoryCache}),e})();t.CacheFactory=n}));e(Qf);Qf.CacheFactory;var Xf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createCachedPlaybackResourcesKey=function(e){return"cached_playback_resources_"+e},t.createCachedManifestKey=function(e){return"cached_manifest_"+e},t.createCachedRegolithResponseKey=function(e,t){return"cached_regolith_response_"+e+"_"+t},t.createCachedSelectionContextKey=function(e){return"cached_selection_context_"+e},t.createPersistentLicenseMetadataKey=function(e){return"persistent_license_metadata_"+e},t.createCachedContentMetadataKey=function(e){return"cached_content_metadata_"+e}}));e(Xf);Xf.createCachedPlaybackResourcesKey,Xf.createCachedManifestKey,Xf.createCachedRegolithResponseKey,Xf.createCachedSelectionContextKey,Xf.createPersistentLicenseMetadataKey,Xf.createCachedContentMetadataKey;var Yf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.qualityLevelFilter=e}return e.prototype.isMatch=freeOnUnref(function(e){return 0<this.qualityLevelFilter.filter(e.qualityLevels,e).validQualities.length}),e})();t.ImageStreamMatcher=n}));e(Yf);Yf.ImageStreamMatcher;var Jf=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var f=((n={})[4]=[237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237],n[3]=[154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149],n),P=de.get("InitializationDataGenerator"),r=freeOnUnref(function(){function b(e,t){this.contentProtectionKeyIds=[],this.mediaRepresentation=e,this.processedPeriodIds={},this.initDatas=[],this.initDataMimeTypes={},this.pssh={},this.eventEmitter=t,this.updateInitializationData()}return b.prototype.updateInitializationData=freeOnUnref(function(){for(var e=0,t=this.mediaRepresentation.periods.contents;e<t.length;e++){var n=t[e];if(n.isResolved&&!this.processedPeriodIds[n.id]){for(var r=0,i=n.streams;r<i.length;r++){var o=i[r],a=[],s=0;if(null!=o.contentProtections&&0!==o.contentProtections.length){for(var l=[],f={},u=0,c=o.contentProtections;u<c.length;u++){var d=c[u],p=d.keyId,h=d.pssh;if(null!=p&&-1===this.contentProtectionKeyIds.indexOf(p)&&this.contentProtectionKeyIds.push(p),null!=h&&!this.pssh[h])null!=(O=b.createPsshRaw(d))&&(this.pssh[h]=!0,l.push(O),f[d.scheme]=!0,null!=this.eventEmitter&&this.eventEmitter.emit("encrypted",{initData:O.buffer,initDataType:"cenc"}))}var m=f[4],y=f[3];if(!0===m&&!0===y){for(var g=0,v=l;g<v.length;g++){var O=v[g];a.push(O),s+=O.byteLength}var S=b.aggregateData(a,s);if(null!=S){var U=this.initDatas.length;this.initDatas.push(S),this.initDataMimeTypes[U]=o.mimeType}}else 0<Object.keys(f).length&&P.warn("Ignoring all ContentProtection headers. hasValidWidevinePssh:"+m+", hasValidPlayReadyPssh:"+y)}}this.processedPeriodIds[n.id]=!0}}}),b.prototype.getInitializationData=freeOnUnref(function(){return this.initDatas}),b.prototype.getMimeTypeByIndex=freeOnUnref(function(e){return this.initDataMimeTypes[e]}),Object.defineProperty(b.prototype,"keyIds",{get:freeOnUnref(function(){return this.contentProtectionKeyIds.slice()}),enumerable:!0,configurable:!0}),b.aggregateData=freeOnUnref(function(e,t){if(0===t)return null;t<0&&P.warn("[neguintarray] Creating a new Uint8Array for aggregateInitData of size: "+t);for(var n=new Uint8Array(t),r=0,i=0,o=e;i<o.length;i++){var a=o[i];n.set(a,r),r+=a.byteLength}return n}),b.createPsshRaw=freeOnUnref(function(e){var t=e.pssh;if(null==t)return null;var n=Lr.decode(t);try{var r=new DataView(n.buffer,n.byteOffset,n.byteLength),i=r.getUint32(0),o=r.getUint32(4);if(i===n.byteLength&&1886614376===o)return n}catch(e){P.error(e)}if(3===e.scheme&&!1===this.validateManifestPlayReadyPSSH(n))return null;var a=32+n.byteLength,s=new Uint8Array(a),l=new DataView(s.buffer,s.byteOffset,s.byteLength);return l.setUint32(0,a),l.setUint32(4,1886614376),s.set(f[e.scheme],12),l.setUint32(28,n.byteLength),s.set(n,32),s}),b.validateManifestPlayReadyPSSH=freeOnUnref(function(e){try{var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=t.getUint32(0,!0);if(n!==e.byteLength)return P.warn("Manifest PSSH data size ("+e.byteLength+") does not match expected size ("+n+") for PlayReady Header Object. Ignoring."),!1;var r=t.getUint16(4,!0);if(r<=0)return P.warn("Manifest PSSH data has invalid record count ("+r+"). Ignoring."),!1;for(var i=6,o=0,a=!1,s=r;0<s;s--){if(i+4>e.byteLength)return P.warn("Manifest PSSH data is malformed. Need to read "+s+" more records, but not enough data left ("+(e.byteLength-i)+" bytes). Ignoring."),!1;var l=t.getUint16(i,!0);if(1===l&&(a=!0),1!==l&&3!==l)return P.warn("Manifest PSSH data has invalid record type ("+l+"), or the last record length ("+o+") is wrong. Ignoring."),!1;i+=4+(o=t.getUint16(i+2,!0))}return!1===a?(P.warn("Manifest PSSH data has no type 1 record. Ignoring."),!1):i===e.byteLength||(P.warn("Manifest PSSH data is malformed. Ignoring."),!1)}catch(e){return P.error(e),!1}}),b})();t.InitializationDataGenerator=r}));e(Jf);Jf.InitializationDataGenerator;var Zf=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("PersistentLicenseManager"),n=freeOnUnref(function(){function e(e,t,n,r,i){var o=this;this.cancelTokenPair=null,this.deferredLicenseRequests=null,this.expectedLicenseRefreshRequests=0,this.licenseRefreshRequestCount=0,this.onLicenseAcquired=freeOnUnref(function(e){if(a.info("Successfully acquired license"),o.updateLicenseMetadataItemsAndCloseSession(e)){var t=o.createPersistentLicenseMetadata();null!=t&&Jo.metadataStorage.put(o.metadataKey,t)}}),this.onMediaKeysManagerError=freeOnUnref(function(e){o.handleFatalError(e)}),this.onRefreshLicenseAcquired=freeOnUnref(function(e){a.info("Successfully refreshed license"),o.licenseRefreshRequestCount++,o.updateLicenseMetadataItemsAndCloseSession(e),null!=o.deferredLicenseRequests&&o.licenseRefreshRequestCount===o.expectedLicenseRefreshRequests&&(o.deferredLicenseRequests.resolve(),o.deferredLicenseRequests=null)}),this.onRefreshLicenseError=freeOnUnref(function(e){var t=o.convertError(e);null!=o.deferredLicenseRequests&&(o.deferredLicenseRequests.reject(t),o.deferredLicenseRequests=null),o.unload()}),this.getLicense=e,this.onError=t,this.mediaKeysManager=n,this.metadataKey=Xf.createPersistentLicenseMetadataKey(i),this.deferredLoad=new lt.Deferred,this.initializationDataGenerator=new Jf.InitializationDataGenerator(r),this.licenseMetadataItems=[]}return e.prototype.remove=freeOnUnref(function(){var e=this;return Jo.metadataStorage.capabilities.isSupported?(null!=this.cancelTokenPair&&(a.info("Cancelling active load before remove."),this.cancelTokenPair.cancel(),this.cancelTokenPair=null),0===this.licenseMetadataItems.length?lt.Promise.resolve():Jo.metadataStorage.remove(this.metadataKey).then(freeOnUnref(function(){return lt.Promise.all(e.licenseMetadataItems.filter(freeOnUnref(function(e){return null!=e.sessionId})).map(freeOnUnref(function(t){return e.mediaKeysManager.removePersistentLicense(t.sessionId,ea.MediaKeysPurpose.Download).catch(freeOnUnref(function(e){return a.error("Failed to remove license for session "+t.sessionId,e),lt.Promise.resolve()}))})))})).then(freeOnUnref(function(){})).catch(freeOnUnref(function(e){throw a.error("Error removing licenses",e),e}))):lt.Promise.reject(new ct.XpError("download.drm.not_supported"))}),e.prototype.load=freeOnUnref(function(){var e=this;if(!Jo.metadataStorage.capabilities.isSupported)return lt.Promise.reject(new ct.XpError("download.drm.not_supported"));if(null!=this.cancelTokenPair)return a.info("Another load already initiated, ignore."),lt.Promise.resolve();this.cancelTokenPair=lt.CancelToken.source();var t=this.cancelTokenPair.token;this.mediaKeysManager.on("licenseAcquired",this.onLicenseAcquired),this.mediaKeysManager.on("error",this.onMediaKeysManagerError);var n=this.deferredLoad;return this.loadPersistentLicenseMetadata(t).then(freeOnUnref(function(){return t.throwIfRequested(),e.createMediaKeySessions(t)})).then(freeOnUnref(function(){t.throwIfRequested(),n.resolve()})).catch(freeOnUnref(function(e){return n.reject(e)})),n.promise}),e.prototype.refresh=freeOnUnref(function(){var t=this;if(!Jo.metadataStorage.capabilities.isSupported)return lt.Promise.reject(new ct.XpError("download.drm.not_supported"));null!=this.cancelTokenPair&&(this.cancelTokenPair.cancel(),null!=this.deferredLicenseRequests&&this.deferredLicenseRequests.reject(new lt.CancelError),this.cancelTokenPair=null),this.cancelTokenPair=lt.CancelToken.source();var n=this.cancelTokenPair.token;return this.deferredLicenseRequests=new lt.Deferred,this.mediaKeysManager.on("licenseAcquired",this.onRefreshLicenseAcquired),this.mediaKeysManager.on("error",this.onRefreshLicenseError),this.loadPersistentLicenseMetadata(n).then(freeOnUnref(function(){return n.throwIfRequested(),t.createMediaKeySessions(n,!0)})).then(freeOnUnref(function(){n.throwIfRequested();var e=t.getOldDuplicateLicenseMetadata();return 0===e.length?t.deferredLicenseRequests.resolve():t.expectedLicenseRefreshRequests=e.length,t.deferredLicenseRequests.promise.then(freeOnUnref(function(){return e}))})).then(freeOnUnref(function(e){return n.throwIfRequested(),t.mediaKeysManager.off("licenseAcquired",t.onRefreshLicenseAcquired),t.mediaKeysManager.off("error",t.onRefreshLicenseError),t.removeTrackedOldLicenses(e)}))}),e.prototype.unload=freeOnUnref(function(){null!=this.cancelTokenPair&&(this.cancelTokenPair.cancel(),this.cancelTokenPair=null),this.deferredLoad=new lt.Deferred,this.mediaKeysManager.off("licenseAcquired",this.onLicenseAcquired),this.mediaKeysManager.off("error",this.onMediaKeysManagerError);for(var e=0,t=this.licenseMetadataItems;e<t.length;e++){var n=t[e];null!=n.sessionId&&this.mediaKeysManager.removeCachedSession(n.sessionId)}this.licenseMetadataItems=[]}),e.prototype.applyInitData=freeOnUnref(function(e,t,n){var r=this,i=freeOnUnref(function(e,t){return n.requested?lt.Promise.reject(new lt.CancelError):r.getLicense(e,t,n)}),o=[this.mediaKeysManager.applyInitData(e,t,i,ea.MediaKeysPurpose.Download,!0),this.mediaKeysManager.extractKeyId(t)];return lt.Promise.all(o).then(freeOnUnref(function(e){var t=e[0],n=e[1];null!=t&&null!=n?r.licenseMetadataItems.push({sessionId:t,keyId:n}):a.error("Failed to create sessionId or keyId")})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;a.error("Failed to apply initialization data",e),r.handleFatalError(e)}))}),e.prototype.convertError=freeOnUnref(function(e){return e instanceof ct.XpError&&-1!==e.code.indexOf("xp.system")?e:ct.XpError.generatePrefixedError(e,"download.drm")}),e.prototype.createMediaKeySessions=freeOnUnref(function(n,r){var i=this;void 0===r&&(r=!1);for(var o=[],e=freeOnUnref(function(t){if(null!=a.mediaKeysManager.getKeyMetadata(t.data)&&!r)return"continue";var e=(r?lt.Promise.resolve(!0):a.shouldApplyInitData(t.data,n)).then(freeOnUnref(function(e){if(n.throwIfRequested(),e)return i.applyInitData(t.type,t.data,n)}));o.push(e)}),a=this,t=0,s=this.getInitializationData();t<s.length;t++){e(s[t])}return lt.Promise.all(o)}),e.prototype.getInitializationData=freeOnUnref(function(){return this.initializationDataGenerator.getInitializationData().map(freeOnUnref(function(e){return{type:"cenc",data:e}}))}),e.prototype.getOldDuplicateLicenseMetadata=freeOnUnref(function(){for(var n=[],e=freeOnUnref(function(e){var t=r.licenseMetadataItems[e];e!==x.findLastIndex(r.licenseMetadataItems,freeOnUnref(function(e){return e.keyId===t.keyId}))&&null!=t.sessionId&&n.push(t)}),r=this,t=0;t<this.licenseMetadataItems.length;t++)e(t);return n}),e.prototype.handleFatalError=freeOnUnref(function(e){var t=this.convertError(e);this.deferredLoad.reject(t),this.onError(t),this.unload()}),e.prototype.loadPersistentLicenseMetadata=freeOnUnref(function(n){var r=this;return Jo.metadataStorage.get(this.metadataKey).then(freeOnUnref(function(e){if(n.throwIfRequested(),null!=e){var t=e;r.licenseMetadataItems=t.metadataList}})).catch(freeOnUnref(function(e){if(!(e instanceof lt.CancelError))throw a.error("Failed to load persistent license metadata",e),e}))}),e.prototype.removeTrackedOldLicenses=freeOnUnref(function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];t.push(this.mediaKeysManager.removePersistentLicense(i.sessionId,ea.MediaKeysPurpose.Download))}for(var o=[],a=freeOnUnref(function(t){-1===x.findIndex(e,freeOnUnref(function(e){return e.sessionId===t.sessionId}))&&o.push(t)}),s=0,l=this.licenseMetadataItems;s<l.length;s++){a(l[s])}this.licenseMetadataItems=o;var f=this.createPersistentLicenseMetadata();return null!=f&&t.push(Jo.metadataStorage.put(this.metadataKey,f)),lt.Promise.all(t).then(freeOnUnref(function(){}))}),e.prototype.shouldApplyInitData=freeOnUnref(function(e,n){var r=this;return this.mediaKeysManager.extractKeyId(e).then(freeOnUnref(function(t){return n.throwIfRequested(),x.findIndex(r.licenseMetadataItems,freeOnUnref(function(e){return e.keyId===t}))<0})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;return!0}))}),e.prototype.updateLicenseMetadataItemsAndCloseSession=freeOnUnref(function(e){var t=this.findAndUpdateLicenseMetadataItems(e.keyId,e.keyMetadata);return null!=t&&null!=t.sessionId&&null!=this.mediaKeysManager.removeCachedSession(t.sessionId)||a.warn("Unable to close license session"),null!=t}),e.prototype.findAndUpdateLicenseMetadataItems=freeOnUnref(function(t,e){var n=x.findLastIndex(this.licenseMetadataItems,freeOnUnref(function(e){return e.keyId===t}));return n<0?(a.info("None of existing license metadata items match the keyId:",t),null):e.some(freeOnUnref(function(e){return"CONTENT"===e.keyType}))?(this.licenseMetadataItems[n].keyMetadata=e,this.licenseMetadataItems[n]):null}),e.prototype.createPersistentLicenseMetadata=freeOnUnref(function(){for(var e={metadataList:[]},t=0,n=this.licenseMetadataItems;t<n.length;t++){var r=n[t];null!=r.keyMetadata&&e.metadataList.push(r)}return 0===e.metadataList.length?null:e}),e})();t.PersistentLicenseManager=n}));e(Zf);Zf.PersistentLicenseManager;var $f=t(freeOnUnref(function(e,t){function n(e){return 0<e.qualityLevels.length?e.qualityLevels[0].segmentTimeline.segmentDurationMs:void 0}function r(e){if(0!==e.qualityLevels.length){var t=e.qualityLevels[0],n=t.segmentTimeline.segmentDurationMs;if(null!=n)return n/(t.tileHeight*t.tileWidth)}}Object.defineProperty(t,"__esModule",{value:!0}),t.getSegmentDurationOfStream=n,t.hasSegmentDuration=function(e){return null!=n(e)},t.getThumbnailDurationOfStream=r,t.hasThumbnailDuration=function(e){return null!=r(e)}}));e($f);$f.getSegmentDurationOfStream,$f.hasSegmentDuration,$f.getThumbnailDurationOfStream,$f.hasThumbnailDuration;var eu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.minSegmentDurationMs=null}return e.prototype.getMinSegmentDurationMs=freeOnUnref(function(){return this.minSegmentDurationMs}),e.prototype.initialize=freeOnUnref(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t],i=this.getMinSegmentDurationStream(r);null!=i&&(this.minSegmentDurationMs=Math.min($f.getSegmentDurationOfStream(i),Qe.withDefault(this.minSegmentDurationMs,1/0)))}}),e.prototype.uninitialize=freeOnUnref(function(){this.minSegmentDurationMs=null}),e.prototype.selectStream=freeOnUnref(function(e){return this.getMinSegmentDurationStream(e)}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(e){}),e.prototype.getMinSegmentDurationStream=freeOnUnref(function(e){var t=x.findLastIndex(e,$f.hasSegmentDuration);return-1===t?null:e[t]}),e})();t.MinimumDurationImageStreamAlternator=n}));e(eu);eu.MinimumDurationImageStreamAlternator;var tu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.queue=[],this.hasOpenSlotsCallback=new A.MulticastCallback}return e.prototype.peekHead=freeOnUnref(function(){return Qe.withDefault(this.queue[0],null)}),e.prototype.peekTail=freeOnUnref(function(){return 0<this.queue.length?this.queue[this.queue.length-1]:null}),e.prototype.clear=freeOnUnref(function(){this.queue=[]}),e.prototype.take=freeOnUnref(function(){var e=Qe.withDefault(this.queue.shift(),null);return 2===this.queue.length&&this.hasOpenSlotsCallback.invoke(),e}),e.prototype.isFull=freeOnUnref(function(){return 3===this.queue.length}),e.prototype.offer=freeOnUnref(function(e){return!(3<=this.queue.length)&&(this.queue.push(e),!0)}),e.prototype.forEach=freeOnUnref(function(e){for(var t=0,n=this.queue;t<n.length;t++){e(n[t])}}),e.prototype.onHasSlot=freeOnUnref(function(e){this.hasOpenSlotsCallback.add(e)}),e.prototype.offHasSlot=freeOnUnref(function(e){this.hasOpenSlotsCallback.remove(e)}),e})();t.Queue=n}));e(tu);tu.Queue;var nu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.defaultTableFormatterConfig={headerAlignment:1,cellAlignment:0,columnSeparator:"|",headerSeparator:"-"}}));e(nu);nu.defaultTableFormatterConfig;var ru=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=nu.defaultTableFormatterConfig),this.rows=[],this.maxColumnsWidth={},this.config=e}return e.prototype.renderString=freeOnUnref(function(){if(0===this.rows.length)return"";if(null==this.headers)throw new Error("this.headers is undefined");var e=[];this.renderHeader(e),this.renderLineSeparator(e,this.config.headerSeparator);for(var t=0,n=this.rows;t<n.length;t++){var r=n[t];this.renderRow(e,r),this.renderLineSeparator(e,this.config.rowSeparator)}return e.join("")}),Object.defineProperty(e.prototype,"hasHeaders",{get:freeOnUnref(function(){return null!=this.headers}),enumerable:!0,configurable:!0}),e.prototype.setHeaders=freeOnUnref(function(e){if(null!=this.headers)throw new Error("this.headers is already defined");this.headers=e;for(var t=0,n=this.headers;t<n.length;t++){var r=n[t];this.maxColumnsWidth[r]=r.length+2}}),e.prototype.addRowString=freeOnUnref(function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];null!=this.maxColumnsWidth[r]&&(this.maxColumnsWidth[r]=Math.max(this.maxColumnsWidth[r],e[r].length+2))}this.rows.push(e)}),e.prototype.renderHeader=freeOnUnref(function(e){for(var t=0,n=this.headers;t<n.length;t++){var r=n[t],i=this.maxColumnsWidth[r]-(r.length+2),o=this.getLeftPadding(this.config.headerAlignment,i),a=this.getRightPadding(this.config.headerAlignment,i);e.push(this.repeat(" ",o)),e.push(r),e.push(this.repeat(" ",a))}e.push("\n")}),e.prototype.renderRow=freeOnUnref(function(e,t){for(var n=0,r=this.headers;n<r.length;n++){var i=r[n],o=this.maxColumnsWidth[i]-(t[i].length+2),a=this.getLeftPadding(this.config.cellAlignment,o),s=this.getRightPadding(this.config.cellAlignment,o);e.push(this.repeat(" ",a)),e.push(t[i]),e.push(this.repeat(" ",s))}e.push("\n")}),e.prototype.renderLineSeparator=freeOnUnref(function(e,t){if(null!=t){var n=x.values(this.maxColumnsWidth).reduce(freeOnUnref(function(e,t){return e+t}),0);e.push(this.repeat(t,n)),e.push("\n")}}),e.prototype.getLeftPadding=freeOnUnref(function(e,t){switch(e){case 1:return t/2+1;case 0:return 1;case 2:return t+1}}),e.prototype.getRightPadding=freeOnUnref(function(e,t){switch(e){case 1:return t%2==0?t/2+1:t/2+2;case 0:return t+1;case 2:return 1}}),e.prototype.repeat=freeOnUnref(function(e,t){return t=Math.floor(t),0===e.length?"":t<=0?"":1===t?e:new Array(t+1).join(e)}),e})();t.TableFormatterBase=n}));e(ru);ru.TableFormatterBase;var iu=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype.addRow=freeOnUnref(function(e){for(var t={},n=Object.keys(e),r=0,i=n;r<i.length;r++){var o=i[r];"string"==typeof e[o]?t[o]=e[o]:t[o]=""+e[o]}this.hasHeaders||this.setHeaders(n),this.addRowString(t)}),e})(ru.TableFormatterBase);t.TableFormatterGeneric=r}));e(iu);iu.TableFormatterGeneric;var ou=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,t)||this;return n.setHeaders(e),n}return n(e,r),e.prototype.addRow=freeOnUnref(function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];"string"==typeof e[i]?t[i]=e[i]:t[i]=""+e[i]}this.addRowString(t)}),e})(ru.TableFormatterBase);t.TableFormatterArray=r}));e(ou);ou.TableFormatterArray;var au=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TableFormatterGeneric=iu.TableFormatterGeneric,t.TableFormatterArray=ou.TableFormatterArray}));e(au);au.TableFormatterGeneric,au.TableFormatterArray;var su=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("AudioStreamAlternator"),v=["EAC3","AACL"],r=freeOnUnref(function(){function e(e){void 0===e&&(e={}),this.allPeriodAudioStreams=[],this.isInitialized=!1,this.unsupportedCodecs=[],this.config=n({},e)}return e.prototype.initialize=freeOnUnref(function(e){var i=this;if(null==this.config.audio||x.isEmpty(this.config.audio)){for(var t=[],n=0,r=e;n<r.length;n++){var o=r[n];if(0!==o.length){var a=o.filter(freeOnUnref(function(e){for(var t=0,n=i.unsupportedCodecs;t<n.length;t++){var r=n[t];if(-1!==e.qualityLevels[0].codecs.indexOf(r))return!1}return!0}));t.push(a)}}var s=t.map(freeOnUnref(function(e){return i.createPrioritizedMatchers(e)})),l=[];if(0<s.length)for(var f=freeOnUnref(function(t){s.every(freeOnUnref(function(e){return e.some(freeOnUnref(function(e){return x.isEqual(t,e)}))}))&&l.push(t)}),u=0,c=s[0];u<c.length;u++){f(c[u])}this.allPeriodAudioStreams=e,this.config.audio=l}}),e.prototype.selectStream=freeOnUnref(function(e){var t=e;if(!this.isInitialized){var n=this.getStreamMatcher(t);null!=n&&(this.streamFilterFunction=this.getStreamFilterFunction(n)),this.isInitialized=!0}return null!=this.streamFilterFunction?this.streamFilterFunction(t):null}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(e){this.unsupportedCodecs=e,0!==this.allPeriodAudioStreams.length&&(this.uninitialize(),this.initialize(this.allPeriodAudioStreams))}),e.prototype.uninitialize=freeOnUnref(function(){this.config.audio=void 0,this.isInitialized=!1}),e.prototype.getStreamMatcher=freeOnUnref(function(r){for(var i=this.getAvailableCodecs(r),e=freeOnUnref(function(n){for(var e=0,t=r;e<t.length;e++){if(t[e].qualityLevels.some(freeOnUnref(function(e){if(null==e.samplingRate)return!1;var t=ci.CodecParser.parseAudioCodec(e.codecs);return null!=t&&(t.codec===n.codec&&e.samplingRate===n.samplingRate)})))return a.info("Audio matcher function was set with codec ["+n.codec+"] and sampling rate ["+n.samplingRate+"] out of "+JSON.stringify(i)),{value:n}}}),t=0,n=this.config.audio;t<n.length;t++){var o=e(n[t]);if("object"==typeof o)return o.value}return null}),e.prototype.createPrioritizedMatchers=freeOnUnref(function(e){for(var t=[],n=[],r=0,i=e;r<i.length;r++)for(var o=0,a=i[r].qualityLevels;o<a.length;o++){var s=a[o];if(null!=s.samplingRate){var l=ci.CodecParser.parseAudioCodec(s.codecs);null!=l&&(-1===t.indexOf(l.codec)&&t.push(l.codec),-1===n.indexOf(s.samplingRate)&&n.push(s.samplingRate))}}for(var f=x.intersection(v,t),u=x.sortBy(n).reverse(),c=[],d=0,p=f;d<p.length;d++)for(var h=p[d],m=0,y=u;m<y.length;m++){var g=y[m];c.push({codec:h,samplingRate:g})}return c}),e.prototype.getAvailableCodecs=freeOnUnref(function(e){for(var r=[],t=0,n=e;t<n.length;t++)for(var i=n[t],o=freeOnUnref(function(t){if(null==t.samplingRate)return"continue";var n=ci.CodecParser.parseAudioCodec(t.codecs);if(null==n)return"continue";r.some(freeOnUnref(function(e){return e.codec===n.codec&&e.samplingRate===t.samplingRate}))||r.push({codec:n.codec,samplingRate:t.samplingRate})}),a=0,s=i.qualityLevels;a<s.length;a++){o(s[a])}return r}),e.prototype.getStreamFilterFunction=freeOnUnref(function(i){var r=freeOnUnref(function(n,r){return n.qualityLevels.some(freeOnUnref(function(e){var t=ci.CodecParser.parseAudioCodec(e.codecs);return null!=t&&(r.addRow({streamId:n.id,language:n.language,streamCodecs:e.codecs,codec:t.codec,samplingRate:e.samplingRate,bandwidth:e.bandwidth}),t.codec===i.codec&&e.samplingRate===i.samplingRate)}))});return freeOnUnref(function(e){var t=new au.TableFormatterGeneric,n=e.filter(function(e){return r(e,t)});return x.isEmpty(n)?(a.warn("Could not find an Audio stream for codec ["+i.codec+"], sampling rate: ["+i.samplingRate+"]"),x.isEmpty(e)?a.warn("Empty AudioStreams!"):a.warn("Available streams:\n",t.renderString()),null):x.max(n,function(e){return x.max(e.qualityLevels,function(e){return e.bandwidth}).bandwidth})})}),e})();t.AudioStreamAlternator=r}));e(su);su.AudioStreamAlternator;var lu=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("TimedTextStreamAlternator"),r=freeOnUnref(function(){function e(e){void 0===e&&(e={}),this.isInitialized=!1,this.unsupportedCodecs=[],this.config=n({},e)}return e.prototype.initialize=freeOnUnref(function(e){}),e.prototype.selectStream=freeOnUnref(function(e){if(x.isEmpty(e))return null;var t=e;if(!this.isInitialized){var n=this.getStreamMatcher(t);null!=n&&(this.streamFilterFunction=this.getStreamFilterFunction(n)),this.isInitialized=!0}return null!=this.streamFilterFunction?this.streamFilterFunction(t):null}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(e){this.unsupportedCodecs=e}),e.prototype.uninitialize=freeOnUnref(function(){this.config.timedText=void 0,this.isInitialized=!1}),e.prototype.getStreamMatcher=freeOnUnref(function(r){if(null==this.config.timedText)return{codecs:r[0].qualityLevels[0].codecs};for(var e=freeOnUnref(function(t){for(var e=0,n=r;e<n.length;e++){if(n[e].qualityLevels.some(freeOnUnref(function(e){return e.codecs===t.codec})))return{value:{codecs:t.codec}}}}),t=0,n=this.config.timedText;t<n.length;t++){var i=e(n[t]);if("object"==typeof i)return i.value}return null}),e.prototype.getStreamFilterFunction=freeOnUnref(function(n){var r=freeOnUnref(function(e){return e.qualityLevels.some(freeOnUnref(function(e){return x.isMatch(e,n)}))});return i.info("TimedTextQualityLevelMatcher was set to: "+JSON.stringify(n)),freeOnUnref(function(e){var t=e.filter(r);return x.isEmpty(t)?(i.warn("Could not find an TimedText stream for codec ["+JSON.stringify(n.codecs)+"]"),null):t[0]})}),e})();t.TimedTextStreamAlternator=r}));e(lu);lu.TimedTextStreamAlternator;var fu=t(freeOnUnref(function(e,t){var n,s=ce&&ce.__assign||freeOnUnref(function(){return(s=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("VideoStreamAlternator"),l=["DVHE","HEVC","AVC","AV1"],f=["dvhe.dtr","dvhe.stn","dvhe.dtb","dvhe.st","Main10","High","Main","Baseline"],u=((n={}).DVHE=["dvhe.dtr","dvhe.stn","dvhe.dtb","dvhe.st"],n.HEVC=["Main10","Main"],n.AVC=["High","Main","Baseline"],n.AV1=["Main"],n),r=freeOnUnref(function(){function e(e){if(void 0===e&&(e={}),this.isInitialized=!1,this.unsupportedCodecs=[],this.config=s({},e),null==this.config.video){this.config.video=[];for(var t=0,n=l;t<n.length;t++)for(var r=n[t],i=0,o=f;i<o.length;i++){var a=o[i];x.contains(u[r],a)&&this.config.video.push({codec:r,codecProfile:a})}}}return e.prototype.initialize=freeOnUnref(function(e){}),e.prototype.selectStream=freeOnUnref(function(e){var t=e;if(!this.isInitialized){var n=this.getStreamMatcher(t);null!=n&&(this.streamFilterFunction=this.getStreamFilterFunction(n)),this.isInitialized=!0}return null!=this.streamFilterFunction?this.streamFilterFunction(t):null}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(e){this.unsupportedCodecs=e}),e.prototype.uninitialize=freeOnUnref(function(){this.isInitialized=!1}),e.prototype.getStreamMatcher=freeOnUnref(function(r){for(var e=freeOnUnref(function(n){for(var e=0,t=r;e<t.length;e++){if(t[e].qualityLevels.some(freeOnUnref(function(e){var t=ci.CodecParser.parseVideoCodec(e.codecs);return null!=t&&null!=t.profile&&(t.codec===n.codec&&t.profile===n.codecProfile)})))return{value:n}}}),t=0,n=this.config.video;t<n.length;t++){var i=e(n[t]);if("object"==typeof i)return i.value}return null}),e.prototype.getStreamFilterFunction=freeOnUnref(function(n){i.info("Video matcher function was set with codec ["+n.codec+"] and codec profile ["+n.codecProfile+"]");var r=freeOnUnref(function(e){return e.qualityLevels.some(freeOnUnref(function(e){var t=ci.CodecParser.parseVideoCodec(e.codecs);return null==t||null==t.profile?(i.warn("Video stream doesn't match: videoCodecParserResult is ["+JSON.stringify(t)+"]"),!1):t.codec===n.codec&&t.profile===n.codecProfile}))});return freeOnUnref(function(e){var t=e.filter(r);return x.isEmpty(t)?(i.warn("Could not find an Video stream for codec ["+n.codec+"], codec profile: ["+n.codecProfile+"]"),null):x.max(t,function(e){return x.max(e.qualityLevels,function(e){return e.bandwidth}).bandwidth})})}),e})();t.VideoStreamAlternator=r}));e(fu);fu.VideoStreamAlternator;var uu=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={}).Audio=su.AudioStreamAlternator,n.TimedText=lu.TimedTextStreamAlternator,n.Video=fu.VideoStreamAlternator,n);t.streamAlternatorTypeMap=r}));e(uu);uu.streamAlternatorTypeMap;var cu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=[{subtype:"Dialog"},{subtype:"Descriptive"},{subtype:"Commentary"},{subtype:"BoostedDialogMedium"},{subtype:"BoostedDialogLow"},{subtype:"BoostedDialogHigh"},{subtype:"FilteredContent"},{subtype:"DialogMachineGenerated"}],n=(de.get("AudioStreamSelector"),freeOnUnref(function(){function e(e){void 0===e&&(e=[]),this.fallbackLanguageStreamMatchers=e}return e.prototype.selectStreams=freeOnUnref(function(e,t){if(void 0===t&&(t=[]),x.isEmpty(e))return[];var n=this.filterByMatchers(e,t);if(x.isEmpty(n)&&(n=this.filterByMatchers(e,this.fallbackLanguageStreamMatchers)),x.isEmpty(n)&&(n=e),n=this.filterByMatchers(n,i),!x.isEmpty(n)){var r=[{language:n[0].language}];n=this.filterByMatchers(n,r)}return n}),e.prototype.filterByMatchers=freeOnUnref(function(n,e){for(var t=freeOnUnref(function(t){var e=n.filter(freeOnUnref(function(e){return Jl.isStreamMatch(e,t)}));if(!x.isEmpty(e))return{value:e}}),r=0,i=e;r<i.length;r++){var o=t(i[r]);if("object"==typeof o)return o.value}return[]}),e})());t.AudioStreamSelector=n}));e(cu);cu.AudioStreamSelector;var du=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.selectStreams=freeOnUnref(function(e,t){return null==t?e:e.filter(freeOnUnref(function(e){return t.isMatch(e)}))}),e})();t.ImageStreamSelector=n}));e(du);du.ImageStreamSelector;var pu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=[{textType:"Subtitle"},{textType:"Caption"},{textType:"MachineGenerated"},{textType:"SDH"},{textType:"Audio"},{textType:"Mandatory"}],n=(de.get("TimedTextStreamSelector"),freeOnUnref(function(){function e(){}return e.prototype.selectStreams=freeOnUnref(function(e,t){if(void 0===t&&(t=[]),x.isEmpty(e))return[];var n=this.filterByMatchers(e,t);if(!x.isEmpty(n)){var r=this.filterByMatchers(n,o);x.isEmpty(r)||(n=r)}if(!x.isEmpty(n)){var i=[{language:n[0].language}];n=this.filterByMatchers(n,i)}return n}),e.prototype.filterByMatchers=freeOnUnref(function(n,e){for(var t=freeOnUnref(function(t){var e=n.filter(freeOnUnref(function(e){return Jl.isStreamMatch(e,t)}));if(!x.isEmpty(e))return{value:e}}),r=0,i=e;r<i.length;r++){var o=t(i[r]);if("object"==typeof o)return o.value}return[]}),e})());t.TimedTextStreamSelector=n}));e(pu);pu.TimedTextStreamSelector;var hu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("VideoStreamSelector");var n=freeOnUnref(function(){function e(){}return e.prototype.selectStreams=freeOnUnref(function(e,t){if(void 0===t&&(t=[]),x.isEmpty(e))return[];var n=this.filterByMatchers(e,t);return x.isEmpty(n)&&(n=e),n}),e.prototype.filterByMatchers=freeOnUnref(function(n,e){var r=this;if(x.isEmpty(e))return[];for(var t=freeOnUnref(function(t){var e=n.filter(freeOnUnref(function(e){return r.isMatch(e,t)}));if(!x.isEmpty(e))return{value:e}}),i=0,o=e;i<o.length;i++){var a=t(o[i]);if("object"==typeof a)return a.value}return[]}),e.prototype.isMatch=freeOnUnref(function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];if(e[i]!==t[i])return!1}return!0}),e})();t.VideoStreamSelector=n}));e(hu);hu.VideoStreamSelector;var mu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.eventEmitter=new A.EventEmitter,this.matchers=e,this.audioStreamSelector=new cu.AudioStreamSelector(t.Audio),this.imageStreamSelector=new du.ImageStreamSelector,this.timedTextStreamSelector=new pu.TimedTextStreamSelector,this.videoStreamSelector=new hu.VideoStreamSelector}return e.prototype.setMatchers=freeOnUnref(function(e,t){this.matchers[e]=t,this.eventEmitter.emit(e)}),e.prototype.onMatcherChange=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.offMatcherChange=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.selectStreams=freeOnUnref(function(e,t){var n=e.streams.filter(freeOnUnref(function(e){return e.type===t}));if(x.isEmpty(n))return[];switch(t){case"Audio":return this.audioStreamSelector.selectStreams(n,this.matchers[t]);case"TimedText":return this.timedTextStreamSelector.selectStreams(n,this.matchers[t]);case"Video":return this.videoStreamSelector.selectStreams(n,this.matchers[t]);case"Image":return this.imageStreamSelector.selectStreams(n,this.matchers[t])}}),e})();t.StreamSelector=n}));e(mu);mu.StreamSelector;var yu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.granularities=[],this.targetGranularityLevelIndex=null}return e.prototype.initialize=freeOnUnref(function(e){this.createGranularityLevels(e),0<this.granularities.length&&(this.targetGranularityLevelIndex=0)}),e.prototype.selectStream=freeOnUnref(function(e){var t=e.filter($f.hasSegmentDuration);if(0===t.length||null==this.targetGranularityLevelIndex)return null;var n=this.granularities[this.targetGranularityLevelIndex];return this.selectStreamForTargetThumbnailDuration(t,n.thumbnailDurationMs)}),e.prototype.getCurrentGranularityLevel=freeOnUnref(function(){return null==this.targetGranularityLevelIndex?null:this.granularities[this.targetGranularityLevelIndex].segmentDurationMs}),e.prototype.getNextGranularityLevel=freeOnUnref(function(){return null==this.targetGranularityLevelIndex||this.targetGranularityLevelIndex>=this.granularities.length-1?null:this.granularities[this.targetGranularityLevelIndex+1].segmentDurationMs}),e.prototype.upgradeGranularityLevel=freeOnUnref(function(){return null==this.targetGranularityLevelIndex?null:(this.targetGranularityLevelIndex<this.granularities.length-1&&this.targetGranularityLevelIndex++,this.granularities[this.targetGranularityLevelIndex].segmentDurationMs)}),e.prototype.downgradeGranularityLevel=freeOnUnref(function(){return null==this.targetGranularityLevelIndex?null:(0<this.targetGranularityLevelIndex&&this.targetGranularityLevelIndex--,this.granularities[this.targetGranularityLevelIndex].segmentDurationMs)}),e.prototype.selectMaxGranularity=freeOnUnref(function(){0!==this.granularities.length&&(this.targetGranularityLevelIndex=this.granularities.length-1)}),e.prototype.updateStreams=freeOnUnref(function(e){if(null==this.targetGranularityLevelIndex)return this.initialize(e),null!=this.targetGranularityLevelIndex?this.granularities[this.targetGranularityLevelIndex].segmentDurationMs:null;var t=this.granularities[this.targetGranularityLevelIndex].thumbnailDurationMs;if(this.createGranularityLevels(e),0===this.granularities.length)return this.targetGranularityLevelIndex=null;var n=this.getIndexForTargetThumbnailDuration(this.granularities,t);return this.targetGranularityLevelIndex=n,this.granularities[this.targetGranularityLevelIndex].segmentDurationMs}),e.prototype.uninitialize=freeOnUnref(function(){this.granularities=[],this.targetGranularityLevelIndex=null}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(e){}),e.prototype.createGranularityLevels=freeOnUnref(function(e){for(var t=0,n=[],r=0,i=e;r<i.length;r++){var o=(f=i[r]).filter($f.hasThumbnailDuration);if(0!==o.length){var a=$f.getThumbnailDurationOfStream(o[0]);t=Math.max(a,t),n.push(o)}}for(var s=0,l=n;s<l.length;s++){var f=l[s];$f.getThumbnailDurationOfStream(f[0])<t&&f.shift()}this.mergeSortedGranularities(n)}),e.prototype.mergeSortedGranularities=freeOnUnref(function(e){var t;this.granularities=[];do{if(null!=(t=this.getMinGranularityAcrossPeriods(e))){var n=this.granularities[this.granularities.length-1];(null==n||t.thumbnailDurationMs<n.thumbnailDurationMs)&&this.granularities.push({thumbnailDurationMs:t.thumbnailDurationMs,segmentDurationMs:t.segmentDurationMs}),e[t.periodIndex].shift()}}while(null!=t)}),e.prototype.getMinGranularityAcrossPeriods=freeOnUnref(function(e){for(var t=null,n=0;n<e.length;n++){var r=e[n];if(0!==r.length){var i=$f.getThumbnailDurationOfStream(r[0]),o=$f.getSegmentDurationOfStream(r[0]);(null==t||i>t.thumbnailDurationMs||i===t.thumbnailDurationMs&&o>t.segmentDurationMs)&&(t={periodIndex:n,thumbnailDurationMs:i,segmentDurationMs:o})}}return t}),e.prototype.selectStreamForTargetThumbnailDuration=freeOnUnref(function(e,t){for(var n=0,r=$f.getSegmentDurationOfStream(e[n]),i=$f.getThumbnailDurationOfStream(e[n]),o=1;o<e.length;o++){var a=e[o],s=$f.getSegmentDurationOfStream(a),l=$f.getThumbnailDurationOfStream(a);l<t||(l<i||l===i&&r<s)&&(n=o,i=l,r=s)}return e[n]}),e.prototype.getIndexForTargetThumbnailDuration=freeOnUnref(function(e,t){for(var n=0,r=e[n].thumbnailDurationMs,i=1;i<e.length;i++){var o=e[i].thumbnailDurationMs;t<=o&&o<r&&(n=i,r=o)}return n}),e})();t.UpgradableImageStreamAlternator=n}));e(yu);yu.UpgradableImageStreamAlternator;var gu=t(freeOnUnref(function(e,t){var n,r,i,o,a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var s=((n={}).Dialog="Dialog",n.Commentary="Commentary",n.Descriptive="Descriptive",n.BoostedDialogLow="BoostedDialogLow",n.BoostedDialogMedium="BoostedDialogMedium",n.BoostedDialogHigh="BoostedDialogHigh",n.FilteredContent="FilteredContent",n.DialogMachineGenerated="DialogMachineGenerated",n);t.MediaRepresentationAudioSubtypeTypeMap=s;var l=((r={}).Audio="Audio",r.TimedText="TimedText",r.Video="Video",r);t.MediaRepresentationStreamTypeMap=l;var f=((i={}).Mandatory="Mandatory",i.Subtitle="Subtitle",i.Caption="Caption",i.SDH="SDH",i.MachineGenerated="MachineGenerated",i.Audio="Audio",i);t.MediaRepresentationTimedTextTypeMap=f;var u=((o={}).Commentary="Commentary",o.Descriptive="Descriptive",o.Dialog="Dialog",o.FilteredContent="FilteredContent",o);t.MediaRepresentationTimedTextSubTypeMap=u;var c=freeOnUnref(function(){function e(){}return e.convertStreamMatcherToTypeMatcher=freeOnUnref(function(e,t){if("Audio"===e){var n=t;return a({type:"Audio"},null!=n.language?{language:n.language}:{},null!=n.type?{subtype:s[n.type]}:{})}if("TimedText"===e){var r=t;return a({type:"TimedText"},null!=t.language?{language:t.language}:{},null!=r.type?{textType:f[r.type]}:{},null!=r.subtype?{subtype:u[r.subtype]}:{})}return{type:"Video"}}),e})();t.StreamMatcherTransformer=c}));e(gu);gu.MediaRepresentationAudioSubtypeTypeMap,gu.MediaRepresentationStreamTypeMap,gu.MediaRepresentationTimedTextTypeMap,gu.MediaRepresentationTimedTextSubTypeMap,gu.StreamMatcherTransformer;var vu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CRITICAL_STREAM_TYPES=Wf.CRITICAL_STREAM_TYPES,t.CacheFactory=Qf.CacheFactory,t.createCachedContentMetadataKey=Xf.createCachedContentMetadataKey,t.createCachedManifestKey=Xf.createCachedManifestKey,t.createCachedPlaybackResourcesKey=Xf.createCachedPlaybackResourcesKey,t.createCachedRegolithResponseKey=Xf.createCachedRegolithResponseKey,t.createCachedSelectionContextKey=Xf.createCachedSelectionContextKey,t.DiskCache=Gf.DiskCache,t.ImageStreamMatcher=Yf.ImageStreamMatcher,t.InitializationDataGenerator=Jf.InitializationDataGenerator,t.InMemoryCache=Kf.InMemoryCache,t.PersistentLicenseManager=Zf.PersistentLicenseManager,t.MinimumDurationImageStreamAlternator=eu.MinimumDurationImageStreamAlternator,t.Queue=tu.Queue,t.streamAlternatorTypeMap=uu.streamAlternatorTypeMap,t.StreamSelector=mu.StreamSelector,t.UpgradableImageStreamAlternator=yu.UpgradableImageStreamAlternator,t.MediaRepresentationAudioSubtypeTypeMap=gu.MediaRepresentationAudioSubtypeTypeMap,t.MediaRepresentationStreamTypeMap=gu.MediaRepresentationStreamTypeMap,t.MediaRepresentationTimedTextSubTypeMap=gu.MediaRepresentationTimedTextSubTypeMap,t.MediaRepresentationTimedTextTypeMap=gu.MediaRepresentationTimedTextTypeMap,t.StreamMatcherTransformer=gu.StreamMatcherTransformer}));e(vu);vu.CRITICAL_STREAM_TYPES,vu.CacheFactory,vu.createCachedContentMetadataKey,vu.createCachedManifestKey,vu.createCachedPlaybackResourcesKey,vu.createCachedRegolithResponseKey,vu.createCachedSelectionContextKey,vu.DiskCache,vu.ImageStreamMatcher,vu.InitializationDataGenerator,vu.InMemoryCache,vu.PersistentLicenseManager,vu.MinimumDurationImageStreamAlternator,vu.Queue,vu.streamAlternatorTypeMap,vu.StreamSelector,vu.UpgradableImageStreamAlternator,vu.MediaRepresentationAudioSubtypeTypeMap,vu.MediaRepresentationStreamTypeMap,vu.MediaRepresentationTimedTextSubTypeMap,vu.MediaRepresentationTimedTextTypeMap,vu.StreamMatcherTransformer;var Ou=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("CacheTTLCleanup"),n=freeOnUnref(function(){function e(){this.cleanupIntervalMs=9e5,this.isRunning=!1}return e.prototype.start=freeOnUnref(function(e){var t=this;this.isRunning?i.info("TTL cleanup timer is already running"):(i.info("Starting TTL cleanup timer with interval: "+this.cleanupIntervalMs+"ms"),this.isRunning=!0,this.timerId=oe.timer.setInterval(freeOnUnref(function(){t.cleanupExpiredCachedContent(e()).catch(freeOnUnref(function(e){i.error("TTL cleanup cycle failed: "+e.message,e)}))}),this.cleanupIntervalMs))}),e.prototype.stop=freeOnUnref(function(){this.isRunning?(i.info("Stopping TTL cleanup timer"),null!=this.timerId&&(oe.timer.clearInterval(this.timerId),this.timerId=void 0),this.isRunning=!1):i.info("TTL cleanup timer is not running")}),e.prototype.cleanupExpiredCachedContent=freeOnUnref(function(e){var t=this;if(i.info("Starting TTL cleanup cycle"),0===e.length)return i.info("No cached content to check for expiration"),lt.Promise.resolve();i.info("Checking "+e.length+" cached content items for expiration");var n=e.map(freeOnUnref(function(e){return t.deleteIfExpired(e)}));return lt.Promise.all(n).then(freeOnUnref(function(e){var t=e.filter(freeOnUnref(function(e){return null!=e})),n=t.length,r=e.length;i.info("TTL cleanup cycle completed. Checked: "+r+", Deleted: "+n+", Deleted IDs: ["+t.join(", ")+"]")})).catch(freeOnUnref(function(e){throw i.error("TTL cleanup cycle encountered errors: "+e.message,e),e}))}),e.prototype.deleteIfExpired=freeOnUnref(function(n){var r=this,e=vu.createCachedContentMetadataKey(n.id);return Jo.metadataStorage.get(e).then(freeOnUnref(function(e){if(null==e)return i.warn("No metadata found for cached content "+n.id+", deleting orphaned content"),n.delete(),n.id;var t=e;return r.isContentExpired(t)?(i.info("Cached content "+n.id+" has expired (expirationTime: "+t.expirationTimeMs+"), deleting"),n.delete(),n.id):null})).catch(freeOnUnref(function(e){return i.error("Failed to check expiration for cached content "+n.id+": "+e.message,e),null}))}),e.prototype.isContentExpired=freeOnUnref(function(e){return Date.now()>e.expirationTimeMs}),e})();t.CacheExpiredTTLCleaner=n}));e(Ou);Ou.CacheExpiredTTLCleaner;var Su=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a,s=de.get("CacheUntrackedFileCleaner");freeOnUnref(function(e){e.File="File",e.Dir="Dir"})(a||(a={}));var n=freeOnUnref(function(){function l(){}return l.getMatchers=freeOnUnref(function(){return[{type:a.Dir,match:/^([a-zA-Z0-9]{64})/},{type:a.File,match:/^cached_playback_resources_([a-zA-Z0-9]{64})$/},{type:a.File,match:/^manifest_([a-zA-Z0-9]{64})$/},{type:a.File,match:/^manifest_([a-zA-Z0-9]{64})_[a-zA-Z0-9]+$/},{type:a.File,match:/^cached_selection_context_([a-zA-Z0-9]{64})$/},{type:a.File,match:/^cached_content_metadata_([a-zA-Z0-9]{64})$/}]}),l.deleteUnknownContent=freeOnUnref(function(r){return Pt.localStorage.listKeys().then(freeOnUnref(function(e){var t=l.filterKnownContent(e,r),i=0,o=0,n=t.map(freeOnUnref(function(e){var t=e[0],n=e[1],r=t===a.Dir?l.removePrefixWithMarkerRedundancy(n):Pt.localStorage.remove(n);return++i,s.info("Removing untracked, key: "+n),r.catch(freeOnUnref(function(e){++o,s.warn("Unable to remove untracked file, id: "+n,e)}))}));return lt.Promise.all(n).then(freeOnUnref(function(){0<i&&(q.metrics.putMetric("XpPlayer.Cache.UntrackedFileCount",i),q.metrics.putMetric("XpPlayer.Cache.UntrackedFileRemovalFailureCount",o),s.info("Found untracked files, total: "+i+", removed: "+(i-o)+", failures: "+o))}))})).catch(freeOnUnref(function(e){s.warn("Unable to remove untracked files",e)}))}),l.removePrefixWithMarkerRedundancy=freeOnUnref(function(t){return Pt.localStorage.removePrefix(t+"/").then(freeOnUnref(function(){return Pt.localStorage.listKeys(t).then(freeOnUnref(function(e){return 0<e.length?(s.info("Removing untracked without marker, key: "+t),Pt.localStorage.removePrefix(t)):lt.Promise.resolve(void 0)})).catch(freeOnUnref(function(){}))}))}),l.filterKnownContent=freeOnUnref(function(e,t){var o=l.getMatchers(),a={};t.forEach(freeOnUnref(function(e){return a[e]=!0}));var s={};return e.forEach(freeOnUnref(function(e){for(var t=0,n=o;t<n.length;t++){var r=n[t],i=e.match(r.match);if(null!=i&&2===i.length&&!a[i[1]]){s[i[0]]=r.type;break}}})),Object.keys(s).map(freeOnUnref(function(e){return[s[e],e]}))}),l})();t.CacheUntrackedFileCleaner=n}));e(Su);Su.CacheUntrackedFileCleaner;var Uu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.fragmentBuffers=e,this.validTypes=Object.keys(e),this.blockedSegmentTracker=t,this.bufferSettings=n}return e.prototype.getBufferInformation=freeOnUnref(function(e){for(var t={},n=0,r=this.validTypes;n<r.length;n++){var i=r[n],o=this.fragmentBuffers[i].getBufferedRanges();t[i]=this.getBufferRangesForStreamType(e,o,i)}return t}),e.prototype.getBufferSizeInBytes=freeOnUnref(function(e,t,n){if(null!=n)return this.getBufferSizeInBytesForStreamType(e,t,n);for(var r=0,i=0,o=this.validTypes;i<o.length;i++){var a=o[i];r+=this.getBufferSizeInBytesForStreamType(e,t,a)}return r}),e.prototype.getBufferedRanges=freeOnUnref(function(e){for(var t=null,n=0,r=Array.isArray(e)?e:[e];n<r.length;n++){var i=r[n],o=this.fragmentBuffers[i];if(null!=o){var a=o.getBufferedRanges();t=null!=t?t.intersection(a):a}}return null!=t?t:new In.NumberLine}),e.prototype.isBufferedToEnd=freeOnUnref(function(e,t){for(var n=0,r=null==t?this.validTypes:[t];n<r.length;n++){var i=r[n],o=this.fragmentBuffers[i].getBufferedRanges().find(e),a=this.fragmentBuffers[i].getBufferedFinalFragment();if(null==o||null==a||o.end<a.position.endTimeMs)return!1}return!0}),e.prototype.isBufferedToCapacity=freeOnUnref(function(e){for(var t=1/0,n=0,r=vu.CRITICAL_STREAM_TYPES;n<r.length;n++){var i=r[n],o=this.blockedSegmentTracker.getMinimumBlockedPositionMs(i);t=Math.min(t,o)}for(var a=!0,s=0,l=vu.CRITICAL_STREAM_TYPES;s<l.length;s++){i=l[s];var f=this.fragmentBuffers[i].getBufferedRanges().find(e);if(null===f)return!1;var u=f.end>=t;a=a&&u}return a}),e.prototype.getValidTypes=freeOnUnref(function(){return this.validTypes}),e.prototype.getBufferSizeInBytesForStreamType=freeOnUnref(function(e,t,n){if(t<=e)return 0;var r=new In.NumberLine;r.add({start:e,end:t});for(var i=this.fragmentBuffers[n],o=i.getBufferedRanges(),a=0,s=0,l=r.intersection(o).getIntervals();s<l.length;s++)for(var f=l[s],u=i.getMediaFragmentAt(f.start);null!=u&&u.position.startTimeMs<f.end;)null!=u.data&&(a+=u.data.byteLength),u=i.getNextMediaFragment(u);return a}),e.prototype.getBufferRangesForStreamType=freeOnUnref(function(e,t,n){var r=this.createEmptyBufferedRange(),i=this.createEmptyBufferedRange();if(null!=t){var o=t.find(e);null!=o&&(r.startTimeMs=e,r.endTimeMs=o.end,r.sizeBytes=this.getBufferSizeInBytes(e,o.end,n),i.startTimeMs=o.start,i.endTimeMs=e,i.sizeBytes=this.getBufferSizeInBytes(o.start,e,n))}return{front:r,back:i}}),e.prototype.createEmptyBufferedRange=freeOnUnref(function(){return{startTimeMs:0,endTimeMs:0,sizeBytes:0}}),e})();t.BufferInformationCalculator=n}));e(Uu);Uu.BufferInformationCalculator;var bu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.bufferedIntervalsMs=[],this.cues=[]}return e.prototype.off=freeOnUnref(function(e,t){}),e.prototype.on=freeOnUnref(function(e,t){}),e})();t.NoOpTextTrack=n}));e(bu);bu.NoOpTextTrack;var Pu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.videoElement=e}return Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){return this.videoElement.volume}),set:freeOnUnref(function(e){this.videoElement.volume=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:freeOnUnref(function(){return this.videoElement.muted}),set:freeOnUnref(function(e){this.videoElement.muted=e}),enumerable:!0,configurable:!0}),e.prototype.onChange=freeOnUnref(function(e){this.videoElement.addEventListener("volumechange",e)}),e.prototype.offChange=freeOnUnref(function(e){this.videoElement.removeEventListener("volumechange",e)}),e})();t.SafariHlsVolumeFeature=n}));e(Pu);Pu.SafariHlsVolumeFeature;var Mu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("VideoElementWrapper"),r=freeOnUnref(function(){function e(e){var t=this;if(this.ignorePdt=!1,this.fallbackEarliestPlayablePositionAnchorSec=0,this.waitingTimeoutId=null,this.mediaKeys=null,this.startWaitingTimeout=freeOnUnref(function(){t.stopWaitingTimeout(),t.waitingTimeoutId=oe.timer.setTimeout(freeOnUnref(function(){t.waitingTimeoutId=null,1===t.readyState&&(t.nudge(),n.warn("In waiting state for 3000ms. Nudging"))}),3e3)}),this.stopWaitingTimeout=freeOnUnref(function(){null!==t.waitingTimeoutId&&(oe.timer.clearTimeout(t.waitingTimeoutId),t.waitingTimeoutId=null)}),this.onPlaying=freeOnUnref(function(){null!=t.deferredPlay&&(t.deferredPlay.resolve(),t.deferredPlay=null),t.off("playing",t.onPlaying)}),null==e)throw new Error("surfaceRef doesn't exist");this.videoElement=this.getVideoElement(e),this.parentElement=this.videoElement.parentElement,this.deferredPlay=null,this.volumeFeature=new Pu.SafariHlsVolumeFeature(this.videoElement),this.hide()}return e.prototype.destroy=freeOnUnref(function(){this.off("waiting",this.startWaitingTimeout),this.off("canplay",this.stopWaitingTimeout);try{this.parentElement.removeChild(this.videoElement)}catch(e){n.warn("Could not remove video surface",e)}}),Object.defineProperty(e.prototype,"audioTracks",{get:freeOnUnref(function(){return this.videoElement.audioTracks}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textTracks",{get:freeOnUnref(function(){return this.videoElement.textTracks}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:freeOnUnref(function(){var t=this,n=this.videoElement.buffered;return{length:n.length,end:freeOnUnref(function(e){return n.end(e)+t.timestampOffsetSec}),start:freeOnUnref(function(e){return n.start(e)+t.timestampOffsetSec})}}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:freeOnUnref(function(){return this.videoElement.currentTime+this.timestampOffsetSec}),set:freeOnUnref(function(e){n.info("Setting currentTime to "+(e-this.timestampOffsetSec)+"."),this.videoElement.currentTime=e-this.timestampOffsetSec}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timestampOffsetSec",{get:freeOnUnref(function(){var e=this.videoElement.getStartDate().getTime();return this.ignorePdt||isNaN(e)?this.fallbackEarliestPlayablePositionAnchorSec:e/1e3}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:freeOnUnref(function(){return this.videoElement.duration}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:freeOnUnref(function(){if(null!=this.videoElement.error){var e=this.videoElement.error,t="errorCode: "+e.code+". ";return null!=e.message&&(t+=e.message),new ct.XpError("media.error",void 0,t)}}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:freeOnUnref(function(){return this.videoElement.ended}),enumerable:!0,configurable:!0}),e.prototype.load=freeOnUnref(function(){this.videoElement.load(),this.stopWaitingTimeout(),this.on("waiting",this.startWaitingTimeout),this.on("canplay",this.stopWaitingTimeout)}),e.prototype.unload=freeOnUnref(function(){this.stopWaitingTimeout(),this.off("waiting",this.startWaitingTimeout),this.off("canplay",this.stopWaitingTimeout),this.videoElement.removeAttribute("src"),this.videoElement.load()}),e.prototype.setIgnorePdtForTimestampOffset=freeOnUnref(function(e){this.ignorePdt=e}),e.prototype.setFallbackEarliestPlayablePositionAnchorSec=freeOnUnref(function(e){this.fallbackEarliestPlayablePositionAnchorSec=e}),e.prototype.hide=freeOnUnref(function(){this.videoElement.style.display="none"}),e.prototype.setMediaKeys=freeOnUnref(function(e){return this.mediaKeys=e,this.videoElement.webkitSetMediaKeys(e)}),e.prototype.off=freeOnUnref(function(e,t){this.videoElement.removeEventListener(e,t)}),e.prototype.on=freeOnUnref(function(e,t){this.videoElement.addEventListener(e,t,!1)}),e.prototype.pause=freeOnUnref(function(){null!=this.deferredPlay&&(this.off("playing",this.onPlaying),this.deferredPlay.reject(new Error("The play() request was interrupted by a call to pause().")),this.deferredPlay=null),this.videoElement.pause()}),Object.defineProperty(e.prototype,"paused",{get:freeOnUnref(function(){return this.videoElement.paused}),enumerable:!0,configurable:!0}),e.prototype.play=freeOnUnref(function(){var e=this.videoElement.play();return null!=e?e:(null==this.deferredPlay&&(this.deferredPlay=new lt.Deferred,this.on("playing",this.onPlaying)),this.deferredPlay.promise)}),Object.defineProperty(e.prototype,"playbackRate",{get:freeOnUnref(function(){return this.videoElement.playbackRate}),set:freeOnUnref(function(e){this.videoElement.playbackRate=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:freeOnUnref(function(){switch(this.videoElement.readyState){case 0:return 0;case 1:case 2:return 1;case 3:case 4:return 2;default:throw new Error("Invalid readyState "+this.videoElement.readyState)}}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seekable",{get:freeOnUnref(function(){var t=this,n=this.videoElement.seekable;return{length:n.length,end:freeOnUnref(function(e){return n.end(e)+t.timestampOffsetSec}),start:freeOnUnref(function(e){return n.start(e)+t.timestampOffsetSec})}}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seeking",{get:freeOnUnref(function(){return this.videoElement.seeking}),enumerable:!0,configurable:!0}),e.prototype.show=freeOnUnref(function(){this.videoElement.style.display=""}),Object.defineProperty(e.prototype,"source",{set:freeOnUnref(function(e){this.unload(),this.videoElement.src=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoPlaybackQuality",{get:freeOnUnref(function(){return null==this.videoElement.getVideoPlaybackQuality?null:this.videoElement.getVideoPlaybackQuality()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoHeight",{get:freeOnUnref(function(){return this.videoElement.videoHeight}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoWidth",{get:freeOnUnref(function(){return this.videoElement.videoWidth}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){return this.volumeFeature}),enumerable:!0,configurable:!0}),e.prototype.nudge=freeOnUnref(function(){n.warn("Nudging the VideoElement at "+this.videoElement.currentTime+"sec, MediaPlayer.readyState "+this.readyState+", VideoElement.readyState "+this.videoElement.readyState+", VideoElement.buffered.length: "+this.videoElement.buffered.length+", VideoElement.seekable.length: "+this.videoElement.seekable.length),this.videoElement.currentTime+=.001}),e.prototype.getVideoElement=freeOnUnref(function(e){if(null!=e.tagName&&"video"===e.tagName.toLowerCase())return e;var t=e.querySelector("video");if(null!=t)return t;var n=document.createElement("video");return n.setAttribute("width","100%"),n.setAttribute("height","100%"),e.appendChild(n),n}),e})();t.VideoElementWrapper=r}));e(Mu);Mu.VideoElementWrapper;var Cu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.getAggregateBufferedRanges=freeOnUnref(function(e){return new In.NumberLine}),e.prototype.getBufferInformation=freeOnUnref(function(){return{}}),e.prototype.getBufferedRanges=freeOnUnref(function(e){return new In.NumberLine}),e.prototype.getFrontBufferLengthMs=freeOnUnref(function(e){return 0}),e.prototype.isBufferedToEnd=freeOnUnref(function(e){return!1}),e.prototype.getInMemoryBufferInformation=freeOnUnref(function(){return{}}),e.prototype.getSourceBufferInformation=freeOnUnref(function(){return{}}),e})();t.SafariHlsBufferInformationProvider=n}));e(Cu);Cu.SafariHlsBufferInformationProvider;var Eu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.videoWidth=null,this.videoHeight=null,this.currentVideoQuality=null,this.mediaRepresentation=e,this.videoWrapper=t}return e.prototype.getCurrentQualityLevel=freeOnUnref(function(){if(0===this.mediaRepresentation.periods.contents.length)return null;var e=this.videoWrapper.videoWidth,t=this.videoWrapper.videoHeight;if(e===this.videoWidth&&t===this.videoHeight)return this.currentVideoQuality;var n=this.mediaRepresentation.periods.contents[0],r=null;this.videoWidth=e,this.videoHeight=t,this.currentVideoQuality=null;for(var i=0,o=n.streams;i<o.length;i++){var a=o[i];if("Video"===a.type)for(var s=0,l=a.qualityLevels;s<l.length;s++){var f=l[s];null!=f.height&&null!=f.width&&f.height>=this.videoHeight&&f.width>=this.videoWidth&&(null==r||f.bandwidth<r)&&(r=f.bandwidth,this.currentVideoQuality={stream:a,qualityLevel:f,period:n})}}return this.currentVideoQuality}),e})();t.VideoQualityMonitor=n}));e(Eu);Eu.VideoQualityMonitor;var Tu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){var n,r,i=this;this.qualityCallbacks={},this.currentQualityLevel={},this.getQualityLevelInfoMap={},this.mediaRepresentation=null,this.qualityMonitor=null,this.getAudioQualityInfo=freeOnUnref(function(){var e=i.videoWrapper.audioTracks;if(null==e)return null;for(var t=null,n=0;n<e.length;n++){var r=e[n];if(!0===r.enabled){t=r;break}}return i.createQualityLevelInfoForTrack("Audio",t)}),this.getVideoQualityInfo=freeOnUnref(function(){if(null==i.qualityMonitor)return null;var e=i.qualityMonitor.getCurrentQualityLevel();return null==e?null:{type:"Video",periodId:e.period.id,streamId:e.stream.id,qualityLevelId:e.qualityLevel.id,bitrateBitsPerSec:e.qualityLevel.bandwidth}}),this.getTimedTextQualityInfo=freeOnUnref(function(){for(var e=i.videoWrapper.textTracks,t=null,n=0;n<e.length;n++){var r=e[n];if("showing"===r.mode){t=r;break}}return i.createQualityLevelInfoForTrack("TimedText",t)}),this.videoWrapper=e,this.eventEmitter=t,this.getQualityLevelInfoMap=((n={}).Video=this.getVideoQualityInfo,n.Audio=this.getAudioQualityInfo,n.TimedText=this.getTimedTextQualityInfo,n),this.currentQualityLevel=((r={}).Video=null,r.Audio=null,r.TimedText=null,r)}return e.prototype.load=freeOnUnref(function(e){this.mediaRepresentation=e,this.qualityMonitor=new Eu.VideoQualityMonitor(this.mediaRepresentation,this.videoWrapper)}),e.prototype.unload=freeOnUnref(function(){var e;this.qualityMonitor=null,this.mediaRepresentation=null,this.currentQualityLevel=((e={}).Video=null,e.Audio=null,e.TimedText=null,e)}),e.prototype.getCurrentQualityInfo=freeOnUnref(function(e){return this.getQualityLevelInfoMap[e]()}),e.prototype.getVideoDecodePerformance=freeOnUnref(function(){return this.videoWrapper.videoPlaybackQuality}),e.prototype.getCurrentResolution=freeOnUnref(function(){if(!this.qualityMonitor)return null;var e=this.qualityMonitor.getCurrentQualityLevel();if(!e)return null;var t=e.qualityLevel;return null==t.width||null==t.height?null:{height:t.height,width:t.width}}),e.prototype.onPositionUpdate=freeOnUnref(function(){for(var e=0,t=Object.keys(this.getQualityLevelInfoMap);e<t.length;e++){var n=t[e],r=this.getQualityLevelInfoMap[n]();if(!this.areSameQualityLevelInfo(this.currentQualityLevel[n],r)){this.currentQualityLevel[n]=r;var i=this.qualityCallbacks[n];null!=i&&i.invoke(r)}}}),e.prototype.on=freeOnUnref(function(e,t,n){"qualityLevel"===t&&(null==this.qualityCallbacks[e]&&(this.qualityCallbacks[e]=new A.MulticastCallback),this.qualityCallbacks[e].add(n))}),e.prototype.off=freeOnUnref(function(e,t,n){"qualityLevel"===t&&null!=this.qualityCallbacks[e]&&this.qualityCallbacks[e].remove(n)}),e.prototype.offStreamGroupChange=freeOnUnref(function(e){}),e.prototype.onStreamGroupChange=freeOnUnref(function(e){}),e.prototype.createQualityLevelInfoForTrack=freeOnUnref(function(e,t){if(null==t||null==this.mediaRepresentation||0===this.mediaRepresentation.periods.contents.length)return null;for(var n=this.mediaRepresentation.periods.contents[0],r=0,i=n.streams;r<i.length;r++){var o=i[r];if(o.renditionName===t.label&&e===o.type)return{type:o.type,periodId:n.id,streamId:o.id,qualityLevelId:0<o.qualityLevels.length?o.qualityLevels[0].id:"",bitrateBitsPerSec:0<o.qualityLevels.length?o.qualityLevels[0].bandwidth:0}}return null}),e.prototype.areSameQualityLevelInfo=freeOnUnref(function(e,t){var n=null!=e?e:{},r=null!=t?t:{};return n.type===r.type&&n.periodId===r.periodId&&n.streamId===r.streamId&&n.qualityLevelId===r.qualityLevelId}),e})();t.SafariHlsPlaybackQualityProvider=n}));e(Tu);Tu.SafariHlsPlaybackQualityProvider;var wu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("DrmController"),f="com.apple.fps",n=freeOnUnref(function(){function e(e){this.onNeedKey=null,this.contentSource=null,this.cancelLicenseRequest=null,this.freeLicenseId=0,this.mediaKeySessions={},this.videoElement=e,this.eventEmitter=new A.EventEmitter}return e.prototype.load=freeOnUnref(function(t){var n=this;null!=t.drmCertificate?(this.contentSource=t,this.onNeedKey=freeOnUnref(function(e){return n.onWebKitMediaKeyNeeded(e,t.drmCertificate)}),this.videoElement.on("webkitneedkey",this.onNeedKey)):this.reportFatalError("drm.service_certificate","No FairPlay certificate present.")}),e.prototype.unload=freeOnUnref(function(){var t=this;this.contentSource=null,this.videoElement.setMediaKeys(null),Object.keys(this.mediaKeySessions).forEach(freeOnUnref(function(e){t.destroyMediaKeySession(e)})),null!=this.onNeedKey&&this.videoElement.off("webkitneedkey",this.onNeedKey),null!=this.cancelLicenseRequest&&this.cancelLicenseRequest(),this.cancelLicenseRequest=null}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.onWebKitMediaKeyNeeded=freeOnUnref(function(e,t){var n=this;l.info(">>> onWebKitMediaKeyNeeded");try{var r=this.getKeyIdString(e.initData),i=this.createKeySessionInitData(e.initData,r,t);if(null==this.videoElement.mediaKeys&&(l.info("No webkitKeys, setting them now."),this.videoElement.setMediaKeys(new WebKitMediaKeys(f))),null==this.videoElement.mediaKeys)return void this.reportFatalError("drm.media_keys","Unable to set webkit media keys on video element");var o=this.videoElement.mediaKeys.createSession("video/mp4",i);if(null==o)return void this.reportFatalError("drm.media_keys","Unable to create key session");var a=(this.freeLicenseId++).toString(),s={session:o,onKeyAdded:freeOnUnref(function(e){return n.onKeyAdded(e,a)}),onKeyMessage:freeOnUnref(function(e){return n.onKeyMessage(e,a)}),onKeyError:freeOnUnref(function(e){return n.onError(e)})};this.mediaKeySessions[a]=s,o.addEventListener("webkitkeyadded",s.onKeyAdded),o.addEventListener("webkitkeymessage",s.onKeyMessage),o.addEventListener("webkitkeyerror",s.onKeyError)}catch(e){this.reportFatalError("drm.webkit_need_key",void 0,e)}}),e.prototype.onError=freeOnUnref(function(e){event.srcElement.error.code,event.srcElement.error.systemCode;this.reportFatalError("drm.com.apple.fps",void 0,e)}),e.prototype.onKeyAdded=freeOnUnref(function(e,t){l.info("A key was added to the session."),this.destroyMediaKeySession(t)}),e.prototype.onKeyMessage=freeOnUnref(function(e,t){var n,r=this;if(null!=this.contentSource){var i=this.mediaKeySessions[t];if(null!=i){var o=lt.CancelToken.source(),a=o.token,s=o.cancel;this.cancelLicenseRequest=s,(n=this.contentSource.getLicense(f,e.message,a).then(freeOnUnref(function(e){a.throwIfRequested(),i.session.update(e.cdmLicenseData)}))).then.apply(n,lt.FINALLY(freeOnUnref(function(){r.cancelLicenseRequest=null})))}else this.reportFatalError("drm.com.apple.fps","No session found for licenseId: "+t+", failed to decode media.")}}),e.prototype.reportFatalError=freeOnUnref(function(e,t,n){var r=new ct.XpError(e,void 0,t);null!=n&&(r=ct.XpError.generatePrefixedError(n,e)),l.error(t),this.eventEmitter.emit("fatalError",r)}),e.prototype.createKeySessionInitData=freeOnUnref(function(e,t,n){var r=this.getKeyIdArray(t),i=this.getCertificateArray(n),o=new ArrayBuffer(e.byteLength+4+r.byteLength+4+i.byteLength),a=0;return a=this.insertBytes(o,a,e),a=this.insertUint32(o,a,r.byteLength),a=this.insertBytes(o,a,r),a=this.insertUint32(o,a,i.byteLength),this.insertBytes(o,a,i),new Uint8Array(o,0,o.byteLength)}),e.prototype.destroyMediaKeySession=freeOnUnref(function(e){var t=this.mediaKeySessions[e];if(null!=t){t.session.removeEventListener("webkitkeyadded",t.onKeyAdded),t.session.removeEventListener("webkitkeymessage",t.onKeyMessage),t.session.removeEventListener("webkitkeyerror",t.onKeyError);try{t.session.close()}catch(e){l.warn("MediaKeySession failed while closing.",e)}delete this.mediaKeySessions[e],l.info("MediaKeySession closed.")}}),e.prototype.getKeyIdString=freeOnUnref(function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer)).replace(/^.+?skd:/,"skd:")}),e.prototype.getKeyIdArray=freeOnUnref(function(e){for(var t=new Uint8Array(2*e.length),n=0;n<e.length;n++)t[2*n]=e.charCodeAt(n),t[2*n+1]=0;return t}),e.prototype.getCertificateArray=freeOnUnref(function(e){for(var t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}),e.prototype.insertBytes=freeOnUnref(function(e,t,n){return new Uint8Array(e,t,n.byteLength).set(n),t+n.byteLength}),e.prototype.insertUint32=freeOnUnref(function(e,t,n){return new DataView(e).setUint32(t,n,!0),t+4}),e})();t.DrmController=n}));e(wu);wu.DrmController;var Iu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.currentPositionMs=null,this.preSeekPositionMs=null,this.videoWrapper=e,this.playbackQualityProvider=t}return e.prototype.reset=freeOnUnref(function(){this.currentPositionMs=null,this.preSeekPositionMs=null}),e.prototype.getCurrentPositionMs=freeOnUnref(function(){return this.currentPositionMs}),e.prototype.getPreSeekPositionMs=freeOnUnref(function(){return this.preSeekPositionMs}),e.prototype.seek=freeOnUnref(function(e){this.preSeekPositionMs=this.currentPositionMs,this.currentPositionMs=e,this.videoWrapper.currentTime=e/1e3}),e.prototype.seeked=freeOnUnref(function(){this.preSeekPositionMs=null}),e.prototype.updatePosition=freeOnUnref(function(){this.playbackQualityProvider.onPositionUpdate(),2===this.videoWrapper.readyState&&(this.currentPositionMs=1e3*this.videoWrapper.currentTime)}),e})();t.PlaybackPositionTracker=n}));e(Iu);Iu.PlaybackPositionTracker;var ku=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var a=this;this.contentSource=null,this.onAudioStreamMatcherChange=freeOnUnref(function(){var e=a.videoWrapper.audioTracks;if(null!=e)for(var t=a.getMatchingStream("Audio"),n=0;n<e.length;n++){var r=e[n];null!=t&&r.label===t.renditionName?r.enabled=!0:r.enabled=!1}}),this.onTimedTextStreamMatcherChange=freeOnUnref(function(){for(var e=L.configurationStore.configuration,t=null==e||null==e.prs||!1!==e.prs.enableEmbeddedTimedTextForVod,n=a.videoWrapper.textTracks,r=a.getMatchingStream("TimedText"),i=0;i<n.length;i++){var o=n[i];null!=r&&o.label===r.renditionName&&t?o.mode="showing":o.mode="disabled"}}),this.videoWrapper=e}return e.prototype.load=freeOnUnref(function(e){this.contentSource=e,this.contentSource.streamSelector.onMatcherChange("Audio",this.onAudioStreamMatcherChange),this.contentSource.streamSelector.onMatcherChange("TimedText",this.onTimedTextStreamMatcherChange),null!=this.videoWrapper.audioTracks&&(this.videoWrapper.audioTracks.addEventListener("change",this.onAudioStreamMatcherChange),this.videoWrapper.audioTracks.addEventListener("addtrack",this.onAudioStreamMatcherChange)),this.videoWrapper.textTracks.addEventListener("change",this.onTimedTextStreamMatcherChange),this.videoWrapper.textTracks.addEventListener("addtrack",this.onTimedTextStreamMatcherChange)}),e.prototype.unload=freeOnUnref(function(){null!=this.contentSource&&(this.contentSource.streamSelector.offMatcherChange("Audio",this.onAudioStreamMatcherChange),this.contentSource.streamSelector.offMatcherChange("TimedText",this.onTimedTextStreamMatcherChange),this.contentSource=null),null!=this.videoWrapper.audioTracks&&(this.videoWrapper.audioTracks.removeEventListener("addtrack",this.onAudioStreamMatcherChange),this.videoWrapper.audioTracks.removeEventListener("change",this.onAudioStreamMatcherChange)),this.videoWrapper.textTracks.removeEventListener("change",this.onTimedTextStreamMatcherChange),this.videoWrapper.textTracks.removeEventListener("addtrack",this.onTimedTextStreamMatcherChange)}),e.prototype.getMatchingStream=freeOnUnref(function(e){if(null==this.contentSource||0===this.contentSource.mediaRepresentation.periods.contents.length)return null;var t=this.contentSource.mediaRepresentation.periods.contents[0],n=this.contentSource.streamSelector.selectStreams(t,e);return 0===n.length?null:n[0]}),e})();t.AudioTextStreamController=n}));e(ku);ku.AudioTextStreamController;var _u=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("MpPlayerSafariHls"),n=freeOnUnref(function(){function e(e,t){var n=this;this.contentState="unloaded",this.playbackState="paused",this.playbackRate=1,this.shouldPlay=!1,this.suggestedPictureMode="None",this.textTrack=new bu.NoOpTextTrack,this.contentSource=null,this.hasPendingPublicPause=!1,this.onTimeUpdate=freeOnUnref(function(){null!=n.contentSource?(n.positionTracker.updatePosition(),n.contentSource.bitstreamReporter.updateResolution(),n.eventEmitter.emit("timeupdate",n.playbackTime)):o.warn("Received 'timeupdate' while unloaded")}),this.video=new Mu.VideoElementWrapper(t),this.eventEmitter=new A.EventEmitter,this.videoEventTracker=new A.EventTracker(this.video),this.bufferInformationProvider=new Cu.SafariHlsBufferInformationProvider,this.playbackQualityProvider=new Tu.SafariHlsPlaybackQualityProvider(this.video,this.eventEmitter),this.positionTracker=new Iu.PlaybackPositionTracker(this.video,this.playbackQualityProvider),this.drmController=new wu.DrmController(this.video),this.streamController=new ku.AudioTextStreamController(this.video)}return Object.defineProperty(e.prototype,"currentTimeMs",{get:freeOnUnref(function(){return this.positionTracker.getCurrentPositionMs()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:freeOnUnref(function(){return this.video.ended}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackTime",{get:freeOnUnref(function(){if(null==this.contentSource)return null;var e=this.currentTimeMs-this.contentSource.utcMsAtZero,t=this.contentSource.getPeriodAt(e),n=null!=t?this.contentSource.getFragmentAt(t,e):null;return{positionMs:this.currentTimeMs,periodId:null!=t?t.id:null,manifestTimeMs:e,fragmentIndex:null!=n?n.index:void 0,mediaWallClockUtcTimeMs:this.contentSource.contentTimeToWallClockUtcTime(this.currentTimeMs),playheadTimeMs:this.currentTimeMs-this.contentSource.minimumPlayablePositionMs}}),enumerable:!0,configurable:!0}),e.prototype.destroy=freeOnUnref(function(){o.info(">> destroy"),this.video.destroy()}),e.prototype.getBufferInformationProvider=freeOnUnref(function(){return this.bufferInformationProvider}),e.prototype.getDisplayController=freeOnUnref(function(){return o.info(">> getDisplayController"),null}),e.prototype.getPictureInPictureFeature=freeOnUnref(function(){return o.info(">> getPictureInPictureFeature"),null}),e.prototype.getPlaybackQualityProvider=freeOnUnref(function(){return o.info(">> getPlaybackQualityProvider"),this.playbackQualityProvider}),e.prototype.getVolumeFeature=freeOnUnref(function(){return o.info(">> getVolumeFeature"),this.video.volume||null}),e.prototype.hide=freeOnUnref(function(){o.info(">> hide"),this.video.hide()}),e.prototype.isSupported=freeOnUnref(function(e){return!0}),e.prototype.load=freeOnUnref(function(e,t){o.info(">> load"),this.contentSource=e,this.contentSource.bitstreamReporter.load(this.video),this.streamController.load(e),this.playbackQualityProvider.load(e.mediaRepresentation),this.drmController.load(this.contentSource),this.addVideoPlaybackListeners();var n=e.getFilteredPlaylist();null!=n?(o.info("Using filtered HLS playlist with minimum bitrate: "+e.hlsMinimumBitrateKbps+" kbps"),this.video.source="data:application/x-mpegurl;charset=UTF-8,"+encodeURIComponent(n)):this.video.source=e.playbackUrl,this.video.load();var r="Feature"===e.videoMaterialType;this.video.setIgnorePdtForTimestampOffset(r),this.video.setFallbackEarliestPlayablePositionAnchorSec(e.minimumPlayablePositionMs/1e3);var i=null!=t?t:e.minimumPlayablePositionMs;this.seek(i),this.onTimeUpdate()}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.eventEmitter.once(e,t)}),e.prototype.pause=freeOnUnref(function(){o.info(">> pause"),this.hasPendingPublicPause=!this.video.paused,this.shouldPlay=!1,this.video.pause()}),e.prototype.play=freeOnUnref(function(){return o.info(">> play"),"ready"!==this.contentState?(this.shouldPlay=!0,Promise.resolve()):this.video.play()}),e.prototype.seek=freeOnUnref(function(e){null!=this.contentSource&&(o.info(">> seek to "+e+"ms"),this.positionTracker.seek(e),0===this.video.seekable.length&&this.eventEmitter.emit("seeking"))}),e.prototype.show=freeOnUnref(function(){o.info(">> show"),this.video.show()}),e.prototype.unload=freeOnUnref(function(){o.info(">> unload"),this.contentSource=null,this.shouldPlay=!1,this.removeVideoPlaybackListeners(),this.video.unload(),this.updateContentState("unloaded"),this.drmController.unload(),this.positionTracker.reset(),this.streamController.unload(),this.playbackQualityProvider.unload()}),e.prototype.getBufferedRanges=freeOnUnref(function(){for(var e=this.video.buffered,t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}),e.prototype.addVideoPlaybackListeners=freeOnUnref(function(){var t=this;this.videoEventTracker.on("error",freeOnUnref(function(){t.contentError=t.video.error,o.error("Native video error has occurred.",t.contentError),t.updateContentState("error")})),this.videoEventTracker.on("loadedmetadata",freeOnUnref(function(){o.info("<< loadedmetadata"),t.updateContentState("waiting")})),this.videoEventTracker.on("waiting",freeOnUnref(function(){var e={currentTime:t.video.currentTime,readyState:t.video.readyState,bufferedRanges:t.getBufferedRanges()};o.info("<< waiting, "+JSON.stringify(e)),t.updateContentState("waiting")})),this.videoEventTracker.on("canplay",freeOnUnref(function(){o.info("<< canplay"),t.updateContentState("ready"),t.shouldPlay&&(t.video.play(),t.shouldPlay=!1)})),this.videoEventTracker.on("pause",freeOnUnref(function(){o.info("<< pause"),t.updatePlaybackState("paused")})),this.videoEventTracker.on("playing",freeOnUnref(function(){o.info("<< playing"),t.updatePlaybackState("playing")})),this.videoEventTracker.on("seeked",freeOnUnref(function(){o.info("<< seeked"),t.positionTracker.seeked(),t.eventEmitter.emit("seeked")})),this.videoEventTracker.on("timeupdate",this.onTimeUpdate),this.videoEventTracker.on("ended",freeOnUnref(function(){t.eventEmitter.emit("ended",null!=t.currentTimeMs?t.currentTimeMs:0)})),this.videoEventTracker.on("seeking",freeOnUnref(function(){o.info("<< seeking"),t.eventEmitter.emit("seeking")}))}),e.prototype.updatePlaybackState=freeOnUnref(function(e){"paused"!==e||this.hasPendingPublicPause||o.info("platform triggered pause"),o.info(">> updatePlaybackState, contentState "+this.contentState+", playbackState "+e),this.playbackState=e,this.eventEmitter.emit("playbackStateChange",{playbackState:this.playbackState,playbackPositionMs:null!=this.currentTimeMs?this.currentTimeMs:1e3*this.video.currentTime,platformTriggered:!this.hasPendingPublicPause}),this.hasPendingPublicPause=!1}),e.prototype.updateContentState=freeOnUnref(function(e){var t=this.positionTracker.getPreSeekPositionMs(),n=null!=t?t:this.currentTimeMs;this.contentState!==e&&(o.info(">> updateContentState, contentState "+e+", playbackState "+this.playbackState),this.contentState=e,this.eventEmitter.emit("contentStateChange",{contentState:this.contentState,playbackPositionMs:null!=n?n:void 0}))}),e.prototype.removeVideoPlaybackListeners=freeOnUnref(function(){this.videoEventTracker.removeAllListeners()}),e})();t.MpPlayerSafariHls=n}));e(_u);_u.MpPlayerSafariHls;var Ru=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.videoHeight=null,this.videoWidth=null,this.currentBitrate=null,this.videoWrapper=null,this.qualityMonitor=null,this.eventEmitter=e,this.mediaRepresentation=t}return e.prototype.load=freeOnUnref(function(e){this.videoWrapper=e,this.qualityMonitor=new Eu.VideoQualityMonitor(this.mediaRepresentation,this.videoWrapper)}),e.prototype.updateResolution=freeOnUnref(function(){if(null!=this.qualityMonitor&&null!=this.videoWrapper){var e=this.qualityMonitor.getCurrentQualityLevel();this.videoWidth=this.videoWrapper.videoWidth,this.videoHeight=this.videoWrapper.videoHeight,null!=e&&e.qualityLevel.bandwidth!==this.currentBitrate&&(this.currentBitrate=e.qualityLevel.bandwidth,this.eventEmitter.emit("bitstreamChange"))}}),e.prototype.getBitstreamInfo=freeOnUnref(function(){return null==this.videoHeight||null==this.videoWidth||null==this.currentBitrate?null:{width:this.videoWidth,height:this.videoHeight,bitrate:this.currentBitrate,maxWidth:1/0,maxHeight:1/0,maxBitrate:1/0,pitcherGroup:null,pointOfPresence:null}}),e.prototype.getStatistics=freeOnUnref(function(){var e=0,t=0;if(null!=this.videoWrapper){var n=this.videoWrapper.videoPlaybackQuality;null!=n&&(t=(e=2*n.totalVideoFrames)-n.droppedVideoFrames)}return{numReceivedFrames:e,numDecryptedFrames:t,totalBitsPerSecond:0,currentRoundtripMillis:0,numDecodeFailures:0,numDamagedAudioFrames:0,audioDropoutMillis:0,numDamagedVideoFrames:0,videoDivergenceMillis:0,egressEndpoint:"",packetsReceived:0,packetsLost:0,packetsRetransmitReceived:0}}),e})();t.BitstreamReporter=n}));e(Ru);Ru.BitstreamReporter;var Au=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.seekPreviewState=null}return e.prototype.getTileAt=freeOnUnref(function(e){return null}),e.prototype.getTilesInRange=freeOnUnref(function(e,t){return[]}),e.prototype.off=freeOnUnref(function(e,t){}),e.prototype.on=freeOnUnref(function(e,t){}),e.prototype.seekPreviewExists=freeOnUnref(function(){return!1}),e})();t.NoOpSeekPreview=n}));e(Au);Au.NoOpSeekPreview;var Du=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.mediaRepresentation=e,this.utcMsAtZero=null!=e.utcMsAtZero?e.utcMsAtZero:0}return Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){return this.utcMsAtZero+this.mediaRepresentation.timeWindow.startMs+(isFinite(this.mediaRepresentation.durationMs)?0:1e4)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){return this.utcMsAtZero+this.mediaRepresentation.timeWindow.endMs-(isFinite(this.mediaRepresentation.durationMs)?0:2e4)}),enumerable:!0,configurable:!0}),e.prototype.isUpdating=freeOnUnref(function(){return this.mediaRepresentation.timeWindow.isUpdating()}),e})();t.ContentSourceTimeWindow=n}));e(Du);Du.ContentSourceTimeWindow;var xu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("filterHlsPlaylist");t.filterHlsPlaylist=function(e,t,n){var r=function(e,t){for(var n=1e3*t,r=e.split("\n"),i=[],o=[],a=0;a<r.length;a++){var s=r[a];if(0===s.indexOf("#AIV-STREAM-INF:")){var l=s.match(/NOMINAL_VIDEO_BITRATE=(\d+)/);if(null!=l&&0<l.length){var f=parseInt(l[1]);if(f<n){a+=2,o.push(f);continue}}}i.push(s)}return u.info("Removed "+o.length+" quality levels below "+t+" kbps: "+JSON.stringify(o)),i.some(freeOnUnref(function(e){return 0===e.indexOf("#EXT-X-STREAM-INF:")}))?i.join("\n"):(u.warn("HLS playlist filtering removed all quality levels, falling back to original playlist"),e)}(e,t);return r=function(e,t){var n=t.match(/(.*)\/.*\.m3u8/);if(null!=n){var r=n[1];return e.replace(/([^"\n]*m3u8)/g,freeOnUnref(function(e,t){return 0===t.indexOf("http")?e:r+"/"+t}))}return e}(r,n)}}));e(xu);xu.filterHlsPlaylist;var Fu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l){var f;this.mediaRepresentation=e,this.sourceUrlGetter=t,this.playbackUrl=t.get().url,this.getLicense=n,this.videoMaterialType=r,this.drmCertificate=s,this.availabilityTimeWindow=new Du.ContentSourceTimeWindow(e),this.staticTimedTextStreams=i.map(freeOnUnref(function(e){return{language:(t=e).language,textType:"Mandatory"===t.type?"Mandatory":"Subtitle",type:"TimedText"};var t}));var u=a;null!=u&&null!=u.TimedText&&this.shouldIgnoreTimedTextMatchers(u.TimedText)&&((f={}).Audio=u.Audio,f.Video=u.Video,u=f),null!=l&&(this.hlsMinimumBitrateKbps=l.hlsMinimumBitrateKbps),this.streamSelector=new vu.StreamSelector(u,o),this.utcMsAtZero=null!=this.mediaRepresentation.utcMsAtZero?this.mediaRepresentation.utcMsAtZero:0,this.minimumPlayablePositionMs=this.utcMsAtZero+e.timeWindow.startMs,this.seekPreview=new Au.NoOpSeekPreview,this.eventEmitter=new A.EventEmitter,this.bitstreamReporter=new Ru.BitstreamReporter(this.eventEmitter,this.mediaRepresentation)}return e.prototype.getStatistics=freeOnUnref(function(){return this.bitstreamReporter.getStatistics()}),e.prototype.getBitstreamInfo=freeOnUnref(function(){return this.bitstreamReporter.getBitstreamInfo()}),e.prototype.flush=freeOnUnref(function(){}),e.prototype.isEncrypted=freeOnUnref(function(){return lt.Promise.resolve("Trailer"!==this.videoMaterialType)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.setFrontBufferSize=freeOnUnref(function(e){}),e.prototype.setMaxBitrateThreshold=freeOnUnref(function(e,t,n){}),e.prototype.setMaxResolution=freeOnUnref(function(e,t){}),e.prototype.setStreamMatchers=freeOnUnref(function(e,t){"TimedText"===e&&this.shouldIgnoreTimedTextMatchers(t)||this.streamSelector.setMatchers(e,t)}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(e,t){}),e.prototype.start=freeOnUnref(function(e){}),e.prototype.stop=freeOnUnref(function(){}),e.prototype.contentTimeToWallClockUtcTime=freeOnUnref(function(e){return 0===this.utcMsAtZero?null:e}),e.prototype.wallClockUtcTimeToContentTime=freeOnUnref(function(e){return 0===this.utcMsAtZero?null:e}),e.prototype.getPeriodAt=freeOnUnref(function(t){return x.find(this.mediaRepresentation.periods.contents,freeOnUnref(function(e){return t<e.endMs}))}),e.prototype.getFragmentAt=freeOnUnref(function(e,t){for(var n=0,r=e.streams;n<r.length;n++)for(var i=0,o=r[n].qualityLevels;i<o.length;i++){var a=o[i];if(a.playlistAcquired){var s=a.segmentTimeline.getSegmentAt(t);if("WellKnown"===s.type)return s.segment}}return null}),e.prototype.getFilteredPlaylist=freeOnUnref(function(){if(null==this.hlsMinimumBitrateKbps)return null;var e=this.mediaRepresentation.getRawMasterPlaylist();return null==e?null:xu.filterHlsPlaylist(e,this.hlsMinimumBitrateKbps,this.playbackUrl)}),e.prototype.shouldIgnoreTimedTextMatchers=freeOnUnref(function(e){var t=L.configurationStore.configuration;return!(null==t||null==t.prs||!1!==t.prs.enableEmbeddedTimedTextForVod)&&null!=Jl.selectStream(this.staticTimedTextStreams,e)}),e})();t.SafariHlsContentSource=n}));e(Fu);Fu.SafariHlsContentSource;var Bu=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(){function e(e,t){this.sourceUrlStore=e,this.mediaPlaylistUri=t,this.currentSourceUrl=""}return e.prototype.resolveSourceUrl=freeOnUnref(function(e){return n({},this.sourceUrlStore.get(),{url:this.resolve(e)})}),e.prototype.resolve=freeOnUnref(function(e){var t=this.getBaseUrl();return null!=e?new mt.URL(e,t).toString():t}),e.prototype.getBaseUrl=freeOnUnref(function(){var e=this.sourceUrlStore.get().url;return null!=this.baseUrl&&e===this.currentSourceUrl||(this.baseUrl=new mt.URL(this.mediaPlaylistUri,e).toString(),this.currentSourceUrl=e),this.baseUrl}),e})();t.UrlResolver=r}));e(Bu);Bu.UrlResolver;var Lu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i){this.segmentStartTimes=[],this.presentationTimeOffsetMs=0,this.hlsMediaSegments=null!=i?e.segments.slice(i.start,i.end+1):e.segments;for(var o=0,a=this.hlsMediaSegments;o<a.length;o++){var s=a[o];s.estimatedStartPositionMs=s.estimatedStartPositionMs+r,this.segmentStartTimes.push(s.estimatedStartPositionMs)}var l=x.find(this.hlsMediaSegments,freeOnUnref(function(e){return null!=e.initSegment}));this.hlsInitSegment=null!=l?l.initSegment:void 0,this.urlResolver=new Bu.UrlResolver(t,n)}return e.prototype.getInitSegment=freeOnUnref(function(){return null==this.hlsInitSegment?{type:"Unavailable",reason:"There is no Initialization Segment in HLS Media Playlist."}:{type:"WellKnown",segment:this.getInitSegmentInfo(this.hlsInitSegment)}}),e.prototype.getNext=freeOnUnref(function(e){return e.index+1>=this.hlsMediaSegments.length?{type:"Unavailable",reason:"There is no next MediaSegment in HLS Media Playlist."}:{type:"WellKnown",segment:this.getMediaSegmentInfo(this.hlsMediaSegments[e.index+1])}}),e.prototype.getSegmentAt=freeOnUnref(function(t,e){var n=Pn.binarySearchIndexOfClosestBelow(this.segmentStartTimes,freeOnUnref(function(e){return t-e}));return{type:"WellKnown",segment:this.getMediaSegmentInfo(this.hlsMediaSegments[n])}}),e.prototype.getEquivalentSegment=freeOnUnref(function(e){return{type:"WellKnown",segment:this.getMediaSegmentInfo(this.hlsMediaSegments[e.index])}}),e.prototype.getMediaSegmentInfo=freeOnUnref(function(e){var t=this.urlResolver.resolveSourceUrl(e.uri);return{isInitSegment:!1,index:e.sequence,isFinalSegment:e.sequence+1===this.hlsMediaSegments.length,position:{startTimeMs:e.estimatedStartPositionMs,durationMs:e.durationMs,endTimeMs:e.estimatedStartPositionMs+e.durationMs},sourceUrl:t,byteRange:e.byteRange}}),e.prototype.getSequenceFromPosition=freeOnUnref(function(e){return null}),e.prototype.getSequenceRange=freeOnUnref(function(){return null}),e.prototype.getSegmentFromSequence=freeOnUnref(function(e){return null}),e.prototype.getInitSegmentInfo=freeOnUnref(function(e){return{isInitSegment:!0,sourceUrl:this.urlResolver.resolveSourceUrl(e.uri),byteRange:e.byteRange}}),e})();t.HlsSegmentTimeline=n}));e(Lu);Lu.HlsSegmentTimeline;var Nu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.presentationTimeOffsetMs=0,this.segmentDurationMs=void 0}return e.prototype.getInitSegment=freeOnUnref(function(){return{type:"Unavailable",reason:"There is no HLS playlist available."}}),e.prototype.getNext=freeOnUnref(function(e){return{type:"Unavailable",reason:"There is no HLS playlist available."}}),e.prototype.getSegmentAt=freeOnUnref(function(e,t){return{type:"Unavailable",reason:"There is no HLS playlist available."}}),e.prototype.getEquivalentSegment=freeOnUnref(function(e){return{type:"Unavailable",reason:"There is no HLS playlist available."}}),e.prototype.getSequenceFromPosition=freeOnUnref(function(e){return null}),e.prototype.getSequenceRange=freeOnUnref(function(){return null}),e.prototype.getSegmentFromSequence=freeOnUnref(function(e){return null}),e})();t.NoOpSegmentTimeline=n}));e(Nu);Nu.NoOpSegmentTimeline;var Vu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("HlsQualityLevel"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s){this.bandwidth=t,this.codecs=n,this.id=e,this.playlistAcquired=null!=a,this.playlistAcquired?this.segmentTimeline=new Lu.HlsSegmentTimeline(a,r,i,o,s):this.segmentTimeline=new Nu.NoOpSegmentTimeline}return e.selectCodecs=freeOnUnref(function(e,n,t,r){var i=x.find(e.codecs,freeOnUnref(function(t){return x.some(n,freeOnUnref(function(e){return 0===t.indexOf(e)}))}));return null!=i?i:(o.warn("Could not find a matching codec for rendition "+r+"."),t)}),e})();t.HlsQualityLevel=n}));e(Vu);Vu.HlsQualityLevel;var ju=t(freeOnUnref(function(e,t){var n,r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("HlsAudioQualityLevel"),u=["mp4a."],o=((n={}).AACL="AAC_LC",n.EAC3="EC3",n.AC3="AC3",n),a=freeOnUnref(function(l){function f(e,t,n,r,i,o,a){var s=l.call(this,t,f.getAudioBandwidth(e,t),Vu.HlsQualityLevel.selectCodecs(e,u,"mp4a.40.2",t),n,r,i,o,a)||this;return s.samplingRate=44100,s.audioCodec=f.getCodec(s.codecs),s.audioFormat="Stereo",s}return r(f,l),f.getAudioBandwidth=freeOnUnref(function(e,t){var n=0;if(null!=e.nominalAudioBitrate)n=e.nominalAudioBitrate;else{var r=t.match(/audio-([^-]*)-([0-9]*)/);if(null!=r){var i=r[2];if(!x.isEmpty(i))n=1e3*parseInt(i)}}return n}),f.getCodec=freeOnUnref(function(e){var t=ci.CodecParser.parseAudioCodec(e);return null!=t?o[t.codec]:(i.warn("Could not resolve to any available audio codec"),null)}),f})(Vu.HlsQualityLevel);t.HlsAudioQualityLevel=a}));e(ju);ju.HlsAudioQualityLevel;var qu=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(l){function e(e,t,n,r,i,o,a){var s=l.call(this,t,0,"wvtt",n,r,i,o,a)||this;if(e.subtitles!==t)throw new Error("VariantStream does not match RenditionGroup.");return s}return n(e,l),e})(Vu.HlsQualityLevel);t.HlsTimedTextQualityLevel=r}));e(qu);qu.HlsTimedTextQualityLevel;var Hu=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var u=["hvc1.","avc1."],r=freeOnUnref(function(l){function f(e,t,n,r,i,o,a){var s=l.call(this,t,f.getVideoBandwidth(e),Vu.HlsQualityLevel.selectCodecs(e,u,"avc1.4D401E",t),n,r,i,o,a)||this;if(e.video!==t)throw new Error("VariantStream does not match RenditionGroup.");return s.frameRate=null!=e.frameRate?e.frameRate.toString():void 0,s.height=null!=e.resolution?e.resolution.height:void 0,s.width=null!=e.resolution?e.resolution.width:void 0,s}return n(f,l),f.getVideoBandwidth=freeOnUnref(function(e){return null!=e.nominalVideoBitrate?e.nominalVideoBitrate:null!=e.averageBandwidth?e.averageBandwidth:e.bandwidth}),f})(Vu.HlsQualityLevel);t.HlsVideoQualityLevel=r}));e(Hu);Hu.HlsVideoQualityLevel;var zu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.create=freeOnUnref(function(e,t,n,r,i,o,a,s){if("Audio"===t)return new ju.HlsAudioQualityLevel(e,n,r,i,o,a,s);if("TimedText"===t)return new qu.HlsTimedTextQualityLevel(e,n,r,i,o,a,s);if("Video"===t)return new Hu.HlsVideoQualityLevel(e,n,r,i,o,a,s);throw new Error("Rendition is not a valid type.")}),e})();t.HlsQualityLevelFactory=n}));e(zu);zu.HlsQualityLevelFactory;var Wu=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={}).Video="video/mp2t",n.Audio="audio/aac",n.TimedText="application/x-amz-segment",n),i=freeOnUnref(function(){function e(e,t){this.type=e,this.renditionName=t.name,this.qualityLevels=t.qualityLevels,this.language=Wl.toExpectedIso639_1LanguageCode(t.language),this.baseId=this.getBaseId(t),this.id=this.getId(),this.segmentAlignment=!0,this.mimeType=r[e]}return e.prototype.getBaseId=freeOnUnref(function(e){return null!=e.audioTrackType?e.audioTrackType:null!=this.language?this.language+"_dialog_0":""}),e.prototype.getId=freeOnUnref(function(){var e=0<this.qualityLevels.length?"_"+this.qualityLevels[0].codecs:"";return""+this.baseId+e}),e})();t.HlsStream=i}));e(Wu);Wu.HlsStream;var Ku=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(o){function e(e,t){var n=o.call(this,"Audio",e)||this;n.subtype="Dialog",n.audioTrackId=e.audioTrackType;var r=1===Object.keys(t).length?Object.keys(t)[0]:n.baseId;if(null!=t[r]){var i=t[r];n.language=i.languageCode,n.subtype=i.subtype,n.label=i.label}return n}return n(e,o),e})(Wu.HlsStream);t.HlsAudioStream=r}));e(Ku);Ku.HlsAudioStream;var Gu=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this,"TimedText",e)||this;return t.label=e.name,t.textType=!0===e.forced?"Mandatory":"Subtitle",t.subtype="Dialog",t.baseId=t.language+"_"+e.name+"_"+t.textType,t.id=t.getId(),t}return r(e,n),e})(Wu.HlsStream);t.HlsTimedTextStream=n}));e(Gu);Gu.HlsTimedTextStream;var Qu=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(e){return t.call(this,"Video",e)||this}return n(e,t),e})(Wu.HlsStream);t.HlsVideoStream=r}));e(Qu);Qu.HlsVideoStream;var Xu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.create=freeOnUnref(function(e,t,n){if("Audio"===e)return new Ku.HlsAudioStream(t,n);if("TimedText"===e)return new Gu.HlsTimedTextStream(t);if("Video"===e)return new Qu.HlsVideoStream(t);throw new Error("Rendition is not a valid type.")}),e})();t.HlsStreamFactory=n}));e(Xu);Xu.HlsStreamFactory;var Yu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s){this.id=e,this.startMs=t,this.endMs=n,this.isFinalPeriod=r,this.streams=i,this.isResolved=!0,this.contentType=o,this.contentSubtype=a,this.contentId=s}return e.prototype.resolve=freeOnUnref(function(){return lt.Promise.resolve(this)}),e.prototype.awaitForwardAccess=freeOnUnref(function(){return lt.Promise.resolve(this)}),e})();t.HlsPeriod=n}));e(Yu);Yu.HlsPeriod;var Ju=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="com.apple.streamingkeydelivery",r=freeOnUnref(function(){function e(){}return e.compareKeys=freeOnUnref(function(e,t){return e.keyMethod===t.keyMethod&&(null==e.keyInfos[n]||null==t.keyInfos[n]?null==e.keyInfos[n]&&null==t.keyInfos[n]:e.keyInfos[n].uri===t.keyInfos[n].uri)}),e})();t.KeyInfoUtils=r}));e(Ju);Ju.KeyInfoUtils;var Zu=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.playlist=e,this.continuities=[];for(var t=0,n=0;n<e.segments.length;n++){var r=e.segments[n],i=n<this.playlist.segments.length-1?this.playlist.segments[n+1]:null;null!=i&&!i.discontinuity&&Ju.KeyInfoUtils.compareKeys(r,i)||(this.continuities.push({start:t,end:n}),t=n+1)}}return e.prototype.getPlaylist=freeOnUnref(function(){return this.playlist}),e.prototype.getContinuities=freeOnUnref(function(){return this.continuities}),e.prototype.length=freeOnUnref(function(){return this.continuities.length}),e.prototype.getFirstSegmentOfContinuity=freeOnUnref(function(e){return this.playlist.segments[this.continuities[e].start]}),e.prototype.getLastSegmentOfContinuity=freeOnUnref(function(e){return this.playlist.segments[this.continuities[e].end]}),e.prototype.forEachSegmentOfContinuity=freeOnUnref(function(e,t){for(var n=this.continuities[e],r=n.start;r<=n.end;r++)t(this.playlist.segments[r],r-n.start)}),e.prototype.find=freeOnUnref(function(e,t){for(var n=this.continuities[e],r=n.start;r<=n.end;r++)if(t(this.playlist.segments[r]))return this.playlist.segments[r];return null}),e.prototype.isClosedPlaylist=freeOnUnref(function(e){return"VOD"===this.playlist.playlistType||this.playlist.containsEndOfPlaylist||e<this.continuities.length-1}),e.prototype.mediaPlaylist=freeOnUnref(function(){return this.playlist}),e})();t.SplitPlaylist=n}));e(Zu);Zu.SplitPlaylist;var $u=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var p=de.get("HlsPlaylistTimelineInfo"),n=freeOnUnref(function(){function e(e){this.windowStartMs=0,this.windowEndMs=0,this.lastSeenSegments={},this.mediaPlaylistOffsetsMs={},this.update(e)}return Object.defineProperty(e.prototype,"utcMsAtZero",{get:freeOnUnref(function(){return this.initUtcMsAtZero}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){return this.windowStartMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){return this.windowEndMs}),enumerable:!0,configurable:!0}),e.prototype.isUpdating=freeOnUnref(function(){return null!=this.minimumUpdatePeriodMs}),e.prototype.getMediaPlaylistOffsetMs=freeOnUnref(function(e){var t=this.mediaPlaylistOffsetsMs[e];return null==t?0:t}),e.prototype.update=freeOnUnref(function(e){this.minimumUpdatePeriodMs=e.minimumUpdatePeriodMs;for(var l=e.mediaPlaylists,f=0,u=0,c={},t=freeOnUnref(function(e){var t=l[e];if(0===t.segments.length)return p.warn("Media playlist from "+e+" has no segments."),"continue";var n=0,r=d.lastSeenSegments[e];if(null!=r){var i=Pn.binarySearchIndexOf(t.segments,freeOnUnref(function(e){return r.sequence-e.sequence}));if(-1!==i){var o=t.segments[i];n=r.estimatedAdjustedStartPositionMs-o.estimatedStartPositionMs}}d.mediaPlaylistOffsetsMs[e]=n;var a=x.first(t.segments),s=x.last(t.segments);c[e]={sequence:s.sequence,estimatedAdjustedStartPositionMs:s.estimatedStartPositionMs+n},f=Math.max(f,a.estimatedStartPositionMs+n),u=Math.max(u,s.estimatedStartPositionMs+s.durationMs+n),null==d.initUtcMsAtZero&&null!=a.programDateTimeMs&&(d.initUtcMsAtZero=a.programDateTimeMs-(a.estimatedStartPositionMs+n))}),d=this,n=0,r=Object.keys(l);n<r.length;n++){t(r[n])}this.windowStartMs=f,this.windowEndMs=u,this.lastSeenSegments=c}),e})();t.HlsPlaylistTimelineInfoTracker=n}));e($u);$u.HlsPlaylistTimelineInfoTracker;var ec=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.durationMs=e}return Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){return 0}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){return this.durationMs}),enumerable:!0,configurable:!0}),e.prototype.isUpdating=freeOnUnref(function(){return!1}),e})();t.StaticTimeWindow=n}));e(ec);ec.StaticTimeWindow;var tc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var ee=["Audio","TimedText","Video"],n=freeOnUnref(function(){function e(e,t,n,r,i,o){void 0===o&&(o=null);var a=this;this.reset=freeOnUnref(function(e){a.playlistTimelineInfoTracker.update(e),a.isDynamic=null!=e.minimumUpdatePeriodMs;var t=a.createPeriods(e),n=a.hlsPeriods.contents;n.splice.apply(n,[0,n.length].concat(t))}),this.audioTrackMetadata=t,this.sourceUrlStore=r,this.rawMasterPlaylistText=e.masterPlaylistText,this.isDynamic=null!=e.minimumUpdatePeriodMs,this.playlistAcquirer=new gf.ManifestAcquirer(i,this.reset),this.playlistRefresher=new gf.ManifestRefresher(e,this.playlistAcquirer,o),this.playlistTimelineInfoTracker=new $u.HlsPlaylistTimelineInfoTracker(e),"Feature"!==n||this.isDynamic?(this.timeWindow=this.playlistTimelineInfoTracker,this.utcMsAtZero=this.playlistTimelineInfoTracker.utcMsAtZero):this.timeWindow=new ec.StaticTimeWindow(this.playlistTimelineInfoTracker.endMs-this.playlistTimelineInfoTracker.startMs),this.hlsPeriods={contents:this.createPeriods(e),onChange:freeOnUnref(function(){}),offChange:freeOnUnref(function(){})}}return Object.defineProperty(e.prototype,"periods",{get:freeOnUnref(function(){return this.hlsPeriods}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationMs",{get:freeOnUnref(function(){return this.isDynamic?1/0:this.timeWindow.endMs-this.timeWindow.startMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suggestedPresentationDelayMs",{get:freeOnUnref(function(){throw new Error("[HlsMediaRepresentation] Method not implemented: suggestedPresentationDelayMs")}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updatePeriodMs",{get:freeOnUnref(function(){return this.playlistRefresher.updatePeriodMs}),enumerable:!0,configurable:!0}),e.prototype.start=freeOnUnref(function(e){this.isDynamic&&this.playlistRefresher.start(e)}),e.prototype.stop=freeOnUnref(function(){this.playlistAcquirer.stop(),this.playlistRefresher.stop()}),e.prototype.applyFilters=freeOnUnref(function(e){}),e.prototype.getRawMasterPlaylist=freeOnUnref(function(){return this.rawMasterPlaylistText}),e.prototype.createPeriods=freeOnUnref(function(e){for(var t,n=e.masterPlaylist,r=e.mediaPlaylists,i={},o=0,a=n.renditionGroups;o<a.length;o++){i[(S=a[o]).groupId]=S}for(var s=n.variantStreams,l=[],f=null,u=0,c=Object.keys(r);u<c.length;u++){if(null!=(M=r[c[u]])){f=new Zu.SplitPlaylist(M);break}}if(null==f)throw new Error("There were no media playlists acquired.");for(var d={},p=0,h=s;p<h.length;p++)for(var m=h[p],y=0,g=ee;y<g.length;y++){var v=g[y],O=this.getGroupIdByType(m,v);if(null!=O&&!0!==d[O]){var S;if(null==(S=i[O]))throw new Error("There is a Variant Stream that refers to a non-existent Rendition Group: "+O);for(var U=0,b=S.renditions;U<b.length;U++)for(var P=b[U],M=r[P.uri],C=0,E=0,T=f.getContinuities();E<T.length;E++){var w=T[E],I=void 0,k=void 0,_=void 0,R=void 0;if(null!=M){I=M.segments.slice(w.start,w.end+1).reduce(freeOnUnref(function(e,t){return e+t.durationMs}),0);var A=M.segments[w.start];k=A.contentType,_=A.contentSubtype,R=A.contentId}var D=zu.HlsQualityLevelFactory.create(m,v,P.groupId,this.sourceUrlStore,P.uri,this.playlistTimelineInfoTracker.getMediaPlaylistOffsetMs(P.uri),M,w);C>=l.length&&l.push(((t={}).Audio=[],t.TimedText=[],t.Video=[],t)),l[C][v].push({qualityLevels:[D],durationMs:I,contentType:k,contentSubtype:_,contentId:R,language:P.language,name:P.name,audioTrackType:P.audioTrackType,forced:P.forced}),C++}d[O]=!0}}for(var x=[],F=0;F<l.length;F++){x.push([]);for(var B=0,L=ee;B<L.length;B++){if("Video"===(v=L[B])){var N=l[F][v],V=(I=Math.max.apply(Math,N.map(freeOnUnref(function(e){return null!=e.durationMs?e.durationMs:0}))),l[F][v].map(freeOnUnref(function(e){return e.qualityLevels[0]})));x[F].push({stream:new Qu.HlsVideoStream({name:"video-stream-period-"+F,qualityLevels:V,durationMs:I}),durationMs:I})}else for(var j=0,q=l[F][v];j<q.length;j++){var H=q[j];x[F].push({stream:Xu.HlsStreamFactory.create(v,H,this.audioTrackMetadata),durationMs:H.durationMs})}}}for(var z=[],W=this.timeWindow.startMs,K=0,G=0,Q=x;G<Q.length;G++){var X=Q[G],Y=(I=Math.max.apply(Math,X.map(freeOnUnref(function(e){return null!=e.durationMs?e.durationMs:0}))),X.map(freeOnUnref(function(e){return e.stream}))),J=W+I,Z=K===x.length-1,$=l[K].Video[0];k=$.contentType,_=$.contentSubtype,R=$.contentId;z.push(new Yu.HlsPeriod("period-"+K,W,J,Z,Y,k,_,R)),W=J,K++}return z}),e.prototype.getGroupIdByType=freeOnUnref(function(e,t){if("Audio"===t)return e.audio;if("TimedText"===t)return e.subtitles;if("Video"===t)return e.video;throw new Error("Unexpected stream type")}),e})();t.HlsMediaRepresentation=n}));e(tc);tc.HlsMediaRepresentation;var nc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=new RegExp("^\\s*$"),n=freeOnUnref(function(){function e(){}return e.prototype.parse=freeOnUnref(function(e,t){if(!Qe.exists(t))return null;if("#"===t[0]){if(this.startsWith(t,"#EXT")||this.startsWith(t,"#AIV")){var n=t.indexOf(":"),r=void 0,i=void 0;return-1===n?(r=t.substr(1),i=""):(r=t.substr(1,n-1),i=t.substr(n+1)),{type:1,lineNum:e,tagName:r,tagArguments:i}}return{type:0,lineNum:e}}return o.test(t)?{type:0,lineNum:e}:{type:2,lineNum:e,uri:t}}),e.prototype.startsWith=freeOnUnref(function(e,t){if(e.length<t.length)return!1;for(var n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0}),e})();t.LineParser=n}));e(nc);nc.LineParser;var rc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=f.of("BasePlaylistParser"),r=freeOnUnref(function(){function r(e,t){this.lines=[],this.currentLine=null,this.onTag=n(e,"onTag").exists(),this.onUri=n(t,"onUri").exists(),this.lineParser=new nc.LineParser}return r.prototype.run=freeOnUnref(function(e,t){for(this.lines=e.split(r.LINE_REGEX),this.currentLine=0,this.match(1,"EXTM3U");!this.isEOF();){var n=this.nextLine();1===n.type?this.onTag(n,t):2===n.type&&this.onUri(n,t)}}),r.prototype.nextLine=freeOnUnref(function(){if(null===this.currentLine||this.currentLine>=this.lines.length)return null;for(var e;e=this.lineParser.parse(this.currentLine,this.lines[this.currentLine++]),!this.isEOF()&&null!==e&&0===e.type;);return e}),r.prototype.match=freeOnUnref(function(e,t){void 0===t&&(t=null);var n=this.nextLine();if(null===n)throw new Error("Reached end of file without finding a "+e);if(n.type!==e)throw new Error("Parse error: expected line of type "+e+", but got "+n.type+" at line "+(this.currentLine-1));if(1===n.type&&null!==t&&n.tagName!==t)throw new Error("Parse error: expected tag "+t+", but got "+n.tagName+" at line "+this.currentLine);return n}),r.prototype.isEOF=freeOnUnref(function(){return this.lines.length-1<this.currentLine}),r.LINE_REGEX=new RegExp("\\r?\\n"),r})();t.BasePlaylistParser=r}));e(rc);rc.BasePlaylistParser;var ic=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.Audio="AUDIO",e.Video="VIDEO",e.Subtitles="SUBTITLES"})(n||(n={})),t.RenditionType=n}));e(ic);ic.RenditionType;var oc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RenditionType=ic.RenditionType}));e(oc);oc.RenditionType;var ac=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=f.of("AttributeExtractor"),n=freeOnUnref(function(){function e(){}return e.extractString=freeOnUnref(function(e,t,n){return r(t,"name").exists(),n&&r(e[t],"attributes["+t+"]").exists(),Qe.withDefault(e[t],null)}),e.extractNumber=freeOnUnref(function(e,t,n){var r=this.extractString(e,t,n);if(Qe.exists(r)){var i=Number(r);if(x.isNaN(i))throw new Error('Value "'+r+'" is not a number');return i}return null}),e.extractResolution=freeOnUnref(function(e,t,n){var r=this.extractString(e,t,n);if(Qe.exists(r)){var i=r.split("x"),o=i[0],a=i[1],s={width:Number(o),height:Number(a)};if(x.isNaN(s.width)||x.isNaN(s.height))throw new Error('Value "'+r+'" is not a valid resolution');return s}return null}),e})();t.AttributeExtractor=n}));e(ac);ac.AttributeExtractor;var sc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=f.of("AttributesParser"),r=freeOnUnref(function(){function e(){}return e.prototype.parse=freeOnUnref(function(e){n(e,"attrLine").exists();var t={attrLine:e,nameStartIndex:null,index:0,currentName:"",currentValue:"",attrObject:{},error:null};return this.parseAttrObject(t),t.attrObject}),e.prototype.parseAttrObject=freeOnUnref(function(e){for(var t=0;e.index<e.attrLine.length;)switch(t){case 0:t=1;break;case 1:t=this.handleParsingName(e);break;case 2:t=this.handleStartParsingValue(e);break;case 3:t=this.handleParsingQuotedValue(e);break;case 5:t=this.handleQuotedValueParsingComplete(e);break;case 4:t=this.handleParsingUnquotedValue(e)}this.handleParsingEnded(e,t)}),e.prototype.handleParsingName=freeOnUnref(function(e){var t=e.attrLine[e.index];return null===e.nameStartIndex&&(e.nameStartIndex=e.index),"="===t?(e.currentName=e.attrLine.substring(e.nameStartIndex,e.index),e.nameStartIndex=null,e.index++,2):(e.index++,1)}),e.prototype.handleStartParsingValue=freeOnUnref(function(e){var t=e.attrLine[e.index];if('"'===t)return e.index++,3;if(","===t)throw new Error("Encountered empty attribute value while parsing "+e.attrLine.substring(e.index));return 4}),e.prototype.handleParsingQuotedValue=freeOnUnref(function(e){var t=e.attrLine[e.index];return'"'===t?(this.setNameValuePair(e),e.index++,5):(e.currentValue+=t,e.index++,3)}),e.prototype.handleQuotedValueParsingComplete=freeOnUnref(function(e){var t=e.attrLine[e.index];if(","===t)return e.index++,1;throw new Error('Expected character: "," but encountered: '+t+", when completing parsing of a quoted value.")}),e.prototype.handleParsingUnquotedValue=freeOnUnref(function(e){var t=e.attrLine[e.index];return","===t?(this.setNameValuePair(e),e.index++,1):(e.currentValue+=t,e.index++,4)}),e.prototype.handleParsingEnded=freeOnUnref(function(e,t){if(4===t){if(""!==e.currentValue)return void this.setNameValuePair(e);throw new Error("Invalid end state. Ended with an empty attribute value, when parsing attribute line: "+e.attrLine+".")}if(5!==t&&0!==t)throw new Error("Ended in an invalid state: "+t+", when parsing attribute line: "+e.attrLine+".")}),e.prototype.setNameValuePair=freeOnUnref(function(e){e.attrObject[e.currentName]=e.currentValue,e.currentName="",e.currentValue=""}),e})();t.AttributesParser=r}));e(sc);sc.AttributesParser;var lc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("MasterPlaylistTagParsers");var n=freeOnUnref(function(){function e(){var n=this;this.attributesParser=new sc.AttributesParser,this.tagParsersMap={"AIV-STREAM-INF":freeOnUnref(function(e,t){return n.parseAIVStreamInf(e,t)}),"EXT-X-STREAM-INF":freeOnUnref(function(e,t){return n.parseStreamInf(e,t)}),"EXT-X-MEDIA":freeOnUnref(function(e,t){return n.parseXMedia(e,t)})}}return e.prototype.createVariantStream=freeOnUnref(function(e){null==e.currentVariantStream&&(e.currentVariantStream={bandwidth:0,codecs:[]})}),e.prototype.parseAIVStreamInf=freeOnUnref(function(e,t){this.createVariantStream(e);var n=this.attributesParser.parse(t.tagArguments),r=ac.AttributeExtractor.extractNumber(n,"NOMINAL_VIDEO_BITRATE",!1),i=ac.AttributeExtractor.extractNumber(n,"NOMINAL_AUDIO_BITRATE",!1);e.currentVariantStream.nominalVideoBitrate=r||void 0,e.currentVariantStream.nominalAudioBitrate=i||void 0}),e.prototype.parseStreamInf=freeOnUnref(function(e,t){t.tagArguments,this.createVariantStream(e);var n=this.attributesParser.parse(t.tagArguments);x.extend(e.currentVariantStream,{bandwidth:ac.AttributeExtractor.extractNumber(n,"BANDWIDTH",!0),averageBandwidth:ac.AttributeExtractor.extractNumber(n,"AVERAGE-BANDWIDTH",!1),codecs:ac.AttributeExtractor.extractString(n,"CODECS",!0).split(","),resolution:ac.AttributeExtractor.extractResolution(n,"RESOLUTION",!1),frameRate:ac.AttributeExtractor.extractNumber(n,"FRAME-RATE",!1),hdcpLevel:ac.AttributeExtractor.extractString(n,"HDCP-LEVEL",!1),audio:ac.AttributeExtractor.extractString(n,"AUDIO",!1),video:ac.AttributeExtractor.extractString(n,"VIDEO",!1),closedCaptions:ac.AttributeExtractor.extractString(n,"CLOSED-CAPTIONS",!1),subtitles:ac.AttributeExtractor.extractString(n,"SUBTITLES",!1)})}),e.prototype.parseXMedia=freeOnUnref(function(e,t){var n=this.attributesParser.parse(t.tagArguments),r=ac.AttributeExtractor.extractString(n,"TYPE",!0),i={type:r,uri:"CLOSED-CAPTIONS"!==r?ac.AttributeExtractor.extractString(n,"URI",!1):null,groupId:ac.AttributeExtractor.extractString(n,"GROUP-ID",!0),language:ac.AttributeExtractor.extractString(n,"LANGUAGE",!1),assocLanguage:ac.AttributeExtractor.extractString(n,"ASSOC-LANGUAGE",!1),name:ac.AttributeExtractor.extractString(n,"NAME",!1),isDefault:"YES"===ac.AttributeExtractor.extractString(n,"DEFAULT",!1),forced:"YES"===ac.AttributeExtractor.extractString(n,"FORCED",!1),autoSelect:"YES"===ac.AttributeExtractor.extractString(n,"AUTOSELECT",!1),audioTrackType:ac.AttributeExtractor.extractString(n,"AUDIO-TRACK-TYPE",!1)};e.renditions.push(i)}),e})();t.MasterPlaylistTagParsers=n}));e(lc);lc.MasterPlaylistTagParsers;var fc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("MasterPlaylistParser");var n=freeOnUnref(function(){function e(e,t){void 0===e&&(e=rc.BasePlaylistParser),void 0===t&&(t=new lc.MasterPlaylistTagParsers);var r=this;this.processTag=freeOnUnref(function(e,t){var n=r.tagParsers.tagParsersMap[e.tagName];Qe.exists(n)&&n(t,e)}),this.processURI=freeOnUnref(function(e,t){var n="@@GroupId:VIDEO-"+ ++t.lastVideoRenditionId;t.currentVariantStream.video=n;var r={type:oc.RenditionType.Video,uri:e.uri,groupId:n,name:"@@UNNAMED-VIDEO"};t.variantStreams.push(t.currentVariantStream),t.renditions.push(r),t.currentVariantStream=null}),this.tagParsers=t,this.basePlaylistParser=new e(this.processTag,this.processURI)}return e.prototype.parse=freeOnUnref(function(e){var t={lastVideoRenditionId:0,renditions:[],currentVariantStream:null,variantStreams:[]};return this.basePlaylistParser.run(e,t),this.postProcess(t)}),e.prototype.postProcess=freeOnUnref(function(e){for(var t={},n=0,r=e.renditions;n<r.length;n++){var i=r[n],o=i.type+"##"+i.groupId;Qe.exists(t[o])||(t[o]={type:i.type,groupId:i.groupId,renditions:[]}),t[o].renditions.push(i)}return{renditionGroups:x.values(t),variantStreams:e.variantStreams}}),e})();t.MasterPlaylistParser=n}));e(fc);fc.MasterPlaylistParser;var uc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("MediaPlaylistParser");var n=freeOnUnref(function(){function a(){this.tagParsersMap={EXTINF:a.parseExtInf,"EXT-X-BYTERANGE":a.parseByteRange,"EXT-X-KEY":a.parseKey,"EXT-X-MAP":a.parseInitSegmentInfo,"EXT-X-PROGRAM-DATE-TIME":a.parseProgramDateTime,"EXT-X-MEDIA-SEQUENCE":a.parseMediaSequence,"EXT-X-TARGETDURATION":a.parseTargetDuration,"EXT-X-ENDLIST":a.parseEndList,"EXT-X-PLAYLIST-TYPE":a.parsePlaylistType,"EXT-X-DISCONTINUITY":a.parseDiscontinuity,"EXT-X-DISCONTINUITY-SEQUENCE":a.parseDiscontinuitySequence,"AIV-CONTENT":a.parseContentInfo}}return a.createMediaSegment=freeOnUnref(function(e){Qe.exists(e.currentSegment)||(e.currentSegment={sequence:e.startingSequenceNumber++,discontinuitySequence:null,estimatedStartPositionMs:0,durationMs:0,keyMethod:"NONE",keyInfos:{},uri:null,discontinuity:!1})}),a.extractByteRange=freeOnUnref(function(e,t){var n=t.split("@"),r=n[0],i=n[1],o=parseInt(r),a=null;if(Qe.exists(i))a=parseInt(i);else{if(0===e.segments.length)throw new Error("No start offset informed and no previous segment");a=e.segments[e.segments.length-1].byteRange.end+1}return{start:a,end:a+o-1}}),a.parseByteRange=freeOnUnref(function(e,t){a.createMediaSegment(e),e.currentSegment.byteRange=a.extractByteRange(e,t.tagArguments)}),a.parseExtInf=freeOnUnref(function(e,t){var n=t.tagArguments.split(","),r=n[0],i=n[1],o=void 0===i?null:i;a.createMediaSegment(e),e.currentSegment.durationMs=1e3*parseFloat(r),e.currentSegment.title=o}),a.parseKey=freeOnUnref(function(e,t){var n=a.attributesParser.parse(t.tagArguments),r=ac.AttributeExtractor.extractString(n,"METHOD",!0),i={uri:ac.AttributeExtractor.extractString(n,"URI","NONE"!==r),iv:null,keyFormat:Qe.withDefault(ac.AttributeExtractor.extractString(n,"KEYFORMAT",!1),"identity"),keyFormatVersions:Qe.withDefault(ac.AttributeExtractor.extractString(n,"KEYFORMATVERSIONS",!1),"1").split("/")};e.keyMethod!==r&&(e.keysByFormat={},e.keyMethod=r),Qe.exists(e.keysByFormat[i.keyFormat])&&x.isEqual(e.keysByFormat[i.keyFormat],i)||(e.keysByFormat=x.clone(e.keysByFormat),e.keysByFormat[i.keyFormat]=i)}),a.parseDiscontinuity=freeOnUnref(function(e,t){a.createMediaSegment(e),e.currentSegment.discontinuity=!0,Qe.exists(e.discontinuitySequence)&&e.discontinuitySequence++}),a.parseDiscontinuitySequence=freeOnUnref(function(e,t){e.discontinuitySequence=parseInt(t.tagArguments)}),a.parseInitSegmentInfo=freeOnUnref(function(e,t){var n=a.attributesParser.parse(t.tagArguments);e.initSegment={uri:ac.AttributeExtractor.extractString(n,"URI",!0)};var r=ac.AttributeExtractor.extractString(n,"BYTERANGE",!1);Qe.exists(r)&&(e.initSegment.byteRange=a.extractByteRange(e,r))}),a.parseProgramDateTime=freeOnUnref(function(e,t){a.createMediaSegment(e);var n=t.tagArguments,r=n.indexOf("T");-1!==r&&-1===n.indexOf("Z",r)&&-1===n.indexOf("-",r)&&-1===n.indexOf("+",r)&&(n+="Z"),e.currentSegment.programDateTimeMs=new Date(n).getTime()}),a.parseMediaSequence=freeOnUnref(function(e,t){e.startingSequenceNumber=parseInt(t.tagArguments),null!==e.targetDurationMs&&(e.estimatedStartPositionMs=e.startingSequenceNumber*e.targetDurationMs)}),a.parseTargetDuration=freeOnUnref(function(e,t){e.targetDurationMs=1e3*parseInt(t.tagArguments),e.estimatedStartPositionMs=e.startingSequenceNumber*e.targetDurationMs}),a.parseEndList=freeOnUnref(function(e,t){e.containsEndOfPlaylist=!0}),a.parsePlaylistType=freeOnUnref(function(e,t){e.playlistType=t.tagArguments}),a.parseContentInfo=freeOnUnref(function(e,t){var n=a.attributesParser.parse(t.tagArguments),r=ac.AttributeExtractor.extractString(n,"CONTENT-TYPE",!0),i=ac.AttributeExtractor.extractString(n,"CONTENT-SUBTYPE",!1),o=ac.AttributeExtractor.extractString(n,"CONTENT-ID",!1);a.createMediaSegment(e),e.currentSegment.contentType=r,e.currentSegment.contentSubtype=i,e.currentSegment.contentId=o}),a.attributesParser=new sc.AttributesParser,a})();t.MediaPlaylistTagParsers=n}));e(uc);uc.MediaPlaylistTagParsers;var cc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("MediaPlaylistParser");var a="/range/",n=freeOnUnref(function(){function e(e,t){void 0===e&&(e=rc.BasePlaylistParser),void 0===t&&(t=new uc.MediaPlaylistTagParsers);var s=this;this.processTag=freeOnUnref(function(e,t){var n=s.tagParsers.tagParsersMap[e.tagName];void 0!==n&&n(t,e)}),this.processURI=freeOnUnref(function(e,t){t.currentSegment,t.currentSegment.keyMethod=t.keyMethod,t.currentSegment.keyInfos=t.keysByFormat;var n=s.extractByteRange(e.uri),r=n.uri,i=n.start,o=n.end;if(t.currentSegment.uri=r,null!==i&&null!==o&&(t.currentSegment.byteRange={start:parseInt(i),end:parseInt(o)}),t.currentSegment.estimatedStartPositionMs=t.estimatedStartPositionMs,t.estimatedStartPositionMs+=t.currentSegment.durationMs,t.currentSegment.discontinuitySequence=t.discontinuitySequence,-1===t.currentSegment.uri.indexOf(".vtt")&&0===t.currentSegment.uri.indexOf("https://")){var a=t.currentSegment.uri.lastIndexOf("/");-1!==a&&(t.currentSegment.uri=t.currentSegment.uri.substring(a+1))}null!=t.initSegment&&(t.initSegment.keyMethod=t.keyMethod,t.initSegment.keyInfos=t.keysByFormat,t.currentSegment.initSegment=t.initSegment),t.segments.push(t.currentSegment),t.currentSegment=null}),this.tagParsers=t,this.basePlaylistParser=new e(this.processTag,this.processURI)}return e.prototype.parse=freeOnUnref(function(e){var t={playlistType:"LIVE",targetDurationMs:null,discontinuitySequence:null,startingSequenceNumber:0,estimatedStartPositionMs:0,containsEndOfPlaylist:!1,currentSegment:null,keyMethod:"NONE",keysByFormat:{},segments:[]};return this.basePlaylistParser.run(e,t),this.postProcess(t)}),e.prototype.extractByteRange=freeOnUnref(function(e){for(var t,n,r=e.length-1;0<=r&&"0"<=e[r]&&e[r]<="9";)r--;if("-"!==e[r])return{uri:e,start:null,end:null};for(n=r+1,r--;0<=r&&"0"<=e[r]&&e[r]<="9";)r--;if("/"!==e[r])return{uri:e,start:null,end:null};t=r+1;for(var i=r-a.length+1,o=0;o<a.length;o++)if(e[i+o]!==a[o])return{uri:e,start:null,end:null};return{uri:e.substr(0,i),start:e.substr(t,n-t),end:e.substr(n)}}),e.prototype.postProcess=freeOnUnref(function(e){return{playlistType:e.playlistType,containsEndOfPlaylist:e.containsEndOfPlaylist,targetDurationMs:e.targetDurationMs,segments:e.segments}}),e})();t.MediaPlaylistParser=n}));e(cc);cc.MediaPlaylistParser;var dc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BasePlaylistParser=rc.BasePlaylistParser,t.MasterPlaylistParser=fc.MasterPlaylistParser,t.MediaPlaylistParser=cc.MediaPlaylistParser}));e(dc);dc.BasePlaylistParser,dc.MasterPlaylistParser,dc.MediaPlaylistParser;var pc=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.Manifest=0]="Manifest",e[e.Fragment=1]="Fragment"})(n||(n={})),t.AcquisitionResourceType=n}));e(pc);pc.AcquisitionResourceType;var hc=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(e,t){var n=this.constructor,r=i.call(this,"Access token has expired")||this;return r.name="AccessTokenExpired",r.accessToken=e,r.refreshPromise=t,Object.setPrototypeOf(r,n.prototype),r}return n(e,i),e})(Error);t.AccessTokenExpired=r}));e(hc);hc.AccessTokenExpired;var mc=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(o){function e(e){var t,n,r=this.constructor,i=o.call(this,"HttpError"===(t=e).type?"statusCode:"+t.statusCode:"ParseError"===t.type||"UnknownError"===t.type||"SourceError"===t.type?t.cause.toString():"")||this;return i.name="ParseError"===(n=e).type?"Acquisition-Parse-"+n.cause.name:"Acquisition-"+n.type,Object.setPrototypeOf(i,r.prototype),i.reason=e,i}return n(e,o),e})(Error);t.AcquisitionError=r}));e(mc);mc.AcquisitionError;var yc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("QueuedRequestPool"),n=freeOnUnref(function(){function e(){this.diagnostics=nn.Diagnostics.create("NetworkRequestManager.QueuedRequestPool"),this.requestsQueue=new In.PriorityQueue(freeOnUnref(function(e,t){return e.request.getPriority()<t.request.getPriority()}))}return e.prototype.enqueue=freeOnUnref(function(e,t){var n=this;t.requested&&o.warn("Enqueuing already canceled request ("+e.description+")");var r=new lt.Deferred,i={request:e,onCompleted:freeOnUnref(function(e){n.reportDiagnostics(),r.resolve(e)}),onFailed:freeOnUnref(function(e){n.reportDiagnostics(),r.reject(e)}),cancelToken:t};return this.requestsQueue.push(i),t.promise.then(freeOnUnref(function(e){n.requestsQueue.remove(i),i.onFailed(e)})),this.reportDiagnostics(),r.promise}),e.prototype.getRequest=freeOnUnref(function(){var e=this.requestsQueue.pop();return this.reportDiagnostics(),e}),e.prototype.size=freeOnUnref(function(){return this.requestsQueue.size()}),e.prototype.reportDiagnostics=freeOnUnref(function(){var e={requests:this.requestsQueue.getItems().map(freeOnUnref(function(e){return e.cancelToken.requested?{status:"pending cancellation",description:e.request.description}:{priority:e.request.getPriority(),description:e.request.description}})),timestamp:Date.now()};this.diagnostics.report("state",e)}),e})();t.QueuedRequestPool=n}));e(yc);yc.QueuedRequestPool;var gc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("StatisticsTrackingExecutor");var n=freeOnUnref(function(){function e(e,t){this.statisticsStore=e,this.timeoutTransferSizeCalculator=t}return e.prototype.execute=freeOnUnref(function(i,e,o,a){var s=this;return o.requested?o.promise.then(freeOnUnref(function(e){throw e})):new lt.Promise(freeOnUnref(function(t,r){if(null==e)throw new lt.CancelError;var n=e.build().onLoad(freeOnUnref(function(e){s.statisticsStore.addLatencySample(e.getLatencyMs(),a),s.statisticsStore.addContentTransferSample(e.getMetrics().downloadMs,e.getMetrics().loadedBytes,a),t(e)})).onError(freeOnUnref(function(e,t){null!=t&&s.statisticsStore.addLatencySample(t.getLatencyMs(),a);var n=s.createAcquisitionError(e,t);r(n)})).onTimeout(freeOnUnref(function(e){s.handleTimeoutStatistics(i,e,a);var t=new mc.AcquisitionError({type:"Timeout",statusCode:e.statusCode,headers:e.headers,timing:{downloadMs:e.downloadMs,latencyMs:e.latencyMs,totalMs:e.timeoutMs}});r(t)})).onAbort(freeOnUnref(function(e){var t=new mc.AcquisitionError({type:"UnknownError",cause:new Error("Unexpected network abort")});r(t)}));o.promise.then(freeOnUnref(function(e){n.abort(),r(e)})),n.send()}))}),e.prototype.createAcquisitionError=freeOnUnref(function(e,t){return null!=t?new mc.AcquisitionError({type:"HttpError",body:"",headers:t.getHeaders(),statusCode:t.getStatus(),timing:{latencyMs:t.getLatencyMs(),downloadMs:t.getDownloadMs(),totalMs:t.getTotalMs(),parseMs:null},cause:e}):new mc.AcquisitionError({type:"UnknownNetworkError",error:e})}),e.prototype.handleTimeoutStatistics=freeOnUnref(function(e,t,n){if(0<t.latencyMs&&this.statisticsStore.addLatencySample(t.latencyMs,n),0<t.downloadMs)this.statisticsStore.addContentTransferSample(t.downloadMs,t.loadedBytes,n);else{var r=this.timeoutTransferSizeCalculator.getTransferSize(e,t,n);null!=r&&this.statisticsStore.addContentTransferSample(t.timeoutMs,r,n)}}),e})();t.StatisticsTrackingExecutor=n}));e(gc);gc.StatisticsTrackingExecutor;var vc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.getTransferSize=freeOnUnref(function(e,t,n){return null}),e})();t.NullTransferSizeCalculator=n}));e(vc);vc.NullTransferSizeCalculator;var Oc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.statisticsStore=e,null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.networkRequestManager&&null!=L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator&&null!=L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator.bandwidthPercentage&&null!=L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator.bandwidthPercentage.factor?this.factor=L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator.bandwidthPercentage.factor:this.factor=null}return e.prototype.getTransferSize=freeOnUnref(function(e,t,n){if(null==this.factor||this.factor<0||1<this.factor)return null;var r=this.statisticsStore.getBandwidthAverageKbps();return null==r?null:t.timeoutMs*this.factor*r/8}),e})();t.BandwidthBasedTimeoutTransferSizeCalculator=n}));e(Oc);Oc.BandwidthBasedTimeoutTransferSizeCalculator;var Sc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.networkRequestManager&&null!=L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator&&null!=L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator.estimatedTotalSize&&null!=L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator.estimatedTotalSize.factor?this.factor=L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator.estimatedTotalSize.factor:this.factor=null}return e.prototype.getTransferSize=freeOnUnref(function(e,t,n){if(null==this.factor||this.factor<=0||1<this.factor)return null;var r=null==e.getApproximateResponseSizeBytes?null:e.getApproximateResponseSizeBytes();return null==r?null:this.factor*r}),e})();t.EstimatedTotalSizeTransferSizeCalculator=n}));e(Sc);Sc.EstimatedTotalSizeTransferSizeCalculator;var Uc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.componentStrategies=[new Sc.EstimatedTotalSizeTransferSizeCalculator,new Oc.BandwidthBasedTimeoutTransferSizeCalculator(e)]}return e.prototype.getTransferSize=freeOnUnref(function(t,n,r){return this.componentStrategies.map(freeOnUnref(function(e){return e.getTransferSize(t,n,r)})).reduce(freeOnUnref(function(e,t){return null==e?t:null==t?e:Math.min(e,t)}),null)}),e})();t.CompositeTransferSizeCalculator=n}));e(Uc);Uc.CompositeTransferSizeCalculator;var bc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.statisticsStore=e}return e.prototype.getNetworkStatistics=freeOnUnref(function(e){return this.statisticsStore.getStatistics()}),e})();t.AggregateRequesterReturnedStatisticsStrategy=n}));e(bc);bc.AggregateRequesterReturnedStatisticsStrategy;var Pc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.statisticsStore=e}return e.prototype.estimateTotalDownloadDurationMs=freeOnUnref(function(e,t){var n=this.statisticsStore.getLatencyAverageMs();if(null==n)return 1/0;if(null==t)return 1/0;var r=this.statisticsStore.getBandwidthAverageKbps();return null==r?1/0:n+8*t/r}),e})();t.BasicDownloadDurationCalculationStrategy=n}));e(Pc);Pc.BasicDownloadDurationCalculationStrategy;var Mc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.statisticsStore=e}return e.prototype.getScheduleDelayMs=freeOnUnref(function(e){if(0===e.length)return 0;var t=e[e.length-1].expectedCompletionTimeMs;if(Date.now()>t)return null;var n=this.statisticsStore.getLatencyAverageMs();return null==n&&(n=0),Math.max(t-Date.now()-n,0)}),e})();t.BasicLinearizationScheduleStrategy=n}));e(Mc);Mc.BasicLinearizationScheduleStrategy;var Cc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.statisticsStore=e}return e.prototype.getNetworkStatistics=freeOnUnref(function(e){return this.statisticsStore.getStatistics(e)}),e})();t.PerAssetRequesterReturnedStatisticsStrategy=n}));e(Cc);Cc.PerAssetRequesterReturnedStatisticsStrategy;var Ec=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("LinearizationChannel"),n=freeOnUnref(function(){function f(e,t,n,r,i){if(this.inflightRequests=[],e<=0)throw new Error('Cannot create LinearizationChannel with non-positive LinearizationPotential of "'+e+'".');this.linearizationPotential=e,this.getQueuedRequest=n,this.onIdle=r,this.onStateChanged=i,this.id=""+f.channelCounter++;var o=t.getRawStatisticsStore();null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.networkRequestManager?("perAsset"===L.configurationStore.configuration.networkRequestManager.requesterReturnedStatisticsStrategy?this.requesterReturnedStatisticsStrategy=new Cc.PerAssetRequesterReturnedStatisticsStrategy(t):this.requesterReturnedStatisticsStrategy=new bc.AggregateRequesterReturnedStatisticsStrategy(t),null!=L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator?"estimatedTotalSize"===L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator.strategy?this.timeoutTransferSizeCalculator=new Sc.EstimatedTotalSizeTransferSizeCalculator:"bandwidthPercentage"===L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator.strategy?this.timeoutTransferSizeCalculator=new Oc.BandwidthBasedTimeoutTransferSizeCalculator(o):"composite"===L.configurationStore.configuration.networkRequestManager.timeoutTransferSizeCalculator.strategy?this.timeoutTransferSizeCalculator=new Uc.CompositeTransferSizeCalculator(o):this.timeoutTransferSizeCalculator=new vc.NullTransferSizeCalculator:this.timeoutTransferSizeCalculator=new vc.NullTransferSizeCalculator):(this.requesterReturnedStatisticsStrategy=new bc.AggregateRequesterReturnedStatisticsStrategy(t),this.timeoutTransferSizeCalculator=new vc.NullTransferSizeCalculator),this.schedulerStrategy=new Mc.BasicLinearizationScheduleStrategy(o),this.downloadDurationCalculator=new Pc.BasicDownloadDurationCalculationStrategy(o),this.statisticsTrackingExecutor=new gc.StatisticsTrackingExecutor(t,this.timeoutTransferSizeCalculator),this.diagnostics=nn.Diagnostics.create("NetworkRequestManager.LinearizationChannel."+this.id)}return f.prototype.updateLinearizationPotential=freeOnUnref(function(e){this.linearizationPotential=e}),f.prototype.inflightCount=freeOnUnref(function(){return this.inflightRequests.length}),f.prototype.availability=freeOnUnref(function(){return Math.max(this.linearizationPotential-this.inflightRequests.length,0)}),f.prototype.notifyRequestAvailable=freeOnUnref(function(){this.scheduleNextRequest()}),f.prototype.getInflightDiagnosticMetadata=freeOnUnref(function(){return this.inflightRequests.map(freeOnUnref(function(e){return e.request.cancelToken.requested?{status:"pending cancellation",description:e.request.request.description}:{priority:e.request.request.getPriority(),description:e.request.request.description}}))}),f.prototype.scheduleNextRequest=freeOnUnref(function(){var e=this;if(!(this.availability()<=0))if(0!==this.inflightRequests.length){var t=this.inflightRequests[this.inflightRequests.length-1];if(null==t.nextRequestTimeoutId){var n=this.schedulerStrategy.getScheduleDelayMs(this.inflightRequests);null!=n&&isFinite(n)&&(t.nextRequestTimeoutId=oe.timer.setTimeout(freeOnUnref(function(){t.nextRequestTimeoutId=null,e.tryTriggerNetworkRequest()}),n))}}else this.tryTriggerNetworkRequest()}),f.prototype.tryTriggerNetworkRequest=freeOnUnref(function(){var t=this,n=this.getQueuedRequest();if(null!==n)if(n.cancelToken.requested)u.info(">> tryTriggerNetworkRequest with canceled request");else try{var e=n.request,r=e.assetType,i=e.getRequestBuilder(this.requesterReturnedStatisticsStrategy.getNetworkStatistics(r)),o=null!=e.getApproximateResponseSizeBytes?e.getApproximateResponseSizeBytes():null,a=this.downloadDurationCalculator.estimateTotalDownloadDurationMs(r,o),s={request:n,startTimeMs:Date.now(),expectedCompletionTimeMs:Date.now()+a},l=null==n.request.id?"NetworkRequestManager-"+f.requestCounter++:n.request.id;this.diagnostics.report("network.scheduled",{id:l,channelId:this.id,timestamp:Date.now()}),this.inflightRequests.push(s),this.onStateChanged();(null==i?lt.Promise.resolve():this.statisticsTrackingExecutor.execute(n.request,i,n.cancelToken,r).then(n.onCompleted).catch(n.onFailed)).then(freeOnUnref(function(){var e=t.inflightRequests.indexOf(s);t.inflightRequests.splice(e,1),t.onStateChanged(),t.onRequestCompletion(s,e)})).catch(freeOnUnref(function(e){u.error("Unexpected error while triggering request completion:",e,e.stack)})),this.scheduleNextRequest()}catch(e){u.error("Unexpected error in request generation:",e,e.stack),n.onFailed(e),this.scheduleNextRequest(),0===this.inflightCount()&&oe.timer.setImmediate(freeOnUnref(function(){t.onIdle()}))}}),f.prototype.onRequestCompletion=freeOnUnref(function(e,t){if(0===t&&0<this.linearizationPotential)null!=e.nextRequestTimeoutId&&oe.timer.clearTimeout(e.nextRequestTimeoutId),this.tryTriggerNetworkRequest();else{for(var n=0;n<t;n++)this.inflightRequests[n].expectedCompletionTimeMs=1/0;this.scheduleNextRequest()}0===this.inflightCount()&&this.onIdle()}),f.channelCounter=0,f.requestCounter=0,f})();t.LinearizationChannel=n}));e(Ec);Ec.LinearizationChannel;var Tc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("RequestScheduler");function n(e){return{id:e.id,linearizationPotential:e.linearizationPotential,inflightCount:e.inflightCount(),inflightRequests:e.getInflightDiagnosticMetadata()}}var r=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.pendingRemovalChannels=[],this.activeLinearizationChannels=[],this.idleLinearizationChannels=[],this.getQueuedRequest=freeOnUnref(function(){return i.requestPool.getRequest()}),this.updateDiagnostics=freeOnUnref(function(){try{i.reportDiagnostics()}catch(e){o.error("Unable to update diagnostics:",e)}}),this.diagnostics=nn.Diagnostics.create("NetworkRequestManager.RequestScheduler"),this.requestPool=e,this.linearizationChannelCount=n,this.statisticsStore=t,this.linearizationPotential=r,this.createNewChannels(this.linearizationChannelCount),this.reportDiagnostics()}return e.prototype.setConcurrentChannelCount=freeOnUnref(function(e){e>this.linearizationChannelCount?this.createNewChannels(e-this.linearizationChannelCount):e<this.linearizationChannelCount&&this.removeChannels(this.linearizationChannelCount-e),this.linearizationChannelCount=e,this.reportDiagnostics()}),e.prototype.notifyItemEnqueued=freeOnUnref(function(){if(0!==this.requestPool.size()){if(0<this.idleLinearizationChannels.length){var e=this.idleLinearizationChannels.pop();e.notifyRequestAvailable(),0<e.inflightCount()?this.activeLinearizationChannels.push(e):(o.info("Previously idle channel ("+e.id+") still idle after item enqueued. Returning channel to idle set."),this.idleLinearizationChannels.push(e))}this.reportDiagnostics()}else o.warn("Request pool is empty after new item is enqueued.")}),e.prototype.updateLinearizationPotential=freeOnUnref(function(e){this.linearizationPotential=e;var t=this.activeLinearizationChannels.concat(this.idleLinearizationChannels);this.updateChannelLinearizationPotential(e,t)}),e.prototype.updateChannelLinearizationPotential=freeOnUnref(function(e,t){for(var n=0,r=t;n<r.length;n++){r[n].updateLinearizationPotential(e)}}),e.prototype.createNewChannels=freeOnUnref(function(e){for(var r=this,t=freeOnUnref(function(e){var n=new Ec.LinearizationChannel(i.linearizationPotential,i.statisticsStore,i.getQueuedRequest,freeOnUnref(function(){var e=r.pendingRemovalChannels.indexOf(n);if(0<=e)return r.pendingRemovalChannels.splice(e,1),void r.reportDiagnostics();var t=r.activeLinearizationChannels.indexOf(n);-1!==t?(r.activeLinearizationChannels.splice(t,1),r.idleLinearizationChannels.push(n),r.reportDiagnostics()):o.warn("LinearizationChannel '"+n.id+"' became idle while not active")}),i.updateDiagnostics);i.idleLinearizationChannels.push(n)}),i=this,n=0;n<e;n++)t()}),e.prototype.removeChannels=freeOnUnref(function(e){for(var t=0;t<e;t++){var n=(0<this.idleLinearizationChannels.length?this.idleLinearizationChannels:this.activeLinearizationChannels).pop();null!=n&&(n.updateLinearizationPotential(0),0<n.inflightCount()&&this.pendingRemovalChannels.push(n))}}),e.prototype.reportDiagnostics=freeOnUnref(function(){var e={idleChannels:this.idleLinearizationChannels.map(n),activeChannels:this.activeLinearizationChannels.map(n),linearizationPoolSize:this.linearizationChannelCount,timestamp:Date.now()};0<this.pendingRemovalChannels.length&&(e.pendingRemovalChannels=this.pendingRemovalChannels.map(n)),this.diagnostics.report("state",e)}),e})();t.RequestScheduler=r}));e(Tc);Tc.RequestScheduler;var wc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("NetworkStatisticsStore"),n=freeOnUnref(function(){function e(e,t,n,r){this.diagnostics=nn.Diagnostics.create("NetworkRequestManager.NetworkStatisticsStore."+r),this.statisticWindows=e,this.transferTimeMsTracker=new In.WindowSampleTracker(n),this.contentSizeBytesTracker=new In.WindowSampleTracker(n),this.latencyMsAggregator=new In.SampleAggregator(t),this.bandwidthKbpsAggregator=new In.SampleAggregator(t)}return e.prototype.addLatencySample=freeOnUnref(function(e){this.latencyMsAggregator.addSample(e),this.reportDiagnostics()}),e.prototype.addContentTransferSample=freeOnUnref(function(e,t){this.transferTimeMsTracker.addSample(e),this.contentSizeBytesTracker.addSample(t);var n=this.transferTimeMsTracker.sum(),r=this.contentSizeBytesTracker.sum();this.bandwidthKbpsAggregator.addSample(8*r/n),this.reportDiagnostics()}),e.prototype.getLatencyAverageMs=freeOnUnref(function(e){return void 0===e&&(e=this.statisticWindows.latencyAvgWindow),this.latencyMsAggregator.getAverage(e)}),e.prototype.getLatencyStdDevMs=freeOnUnref(function(e){return void 0===e&&(e=this.statisticWindows.latencyStdDevWindow),this.latencyMsAggregator.getStdDev(e)}),e.prototype.getBandwidthAverageKbps=freeOnUnref(function(e){return void 0===e&&(e=this.statisticWindows.bandwidthAverageWindow),this.bandwidthKbpsAggregator.getAverage(e)}),e.prototype.getBandwidthStdDevKbps=freeOnUnref(function(e){return void 0===e&&(e=this.statisticWindows.bandwidthStdDevWindow),this.bandwidthKbpsAggregator.getStdDev(e)}),e.prototype.getStatistics=freeOnUnref(function(e){return null!=e?{bandwidthAvgKbps:this.getBandwidthAverageKbps(e.bandwidthAverageWindow),bandwidthStdDevKbps:this.getBandwidthStdDevKbps(e.bandwidthStdDevWindow),latencyAvgMs:this.getLatencyAverageMs(e.latencyAvgWindow),latencyStdDevMs:this.getLatencyStdDevMs(e.latencyStdDevWindow)}:{bandwidthAvgKbps:this.getBandwidthAverageKbps(),bandwidthStdDevKbps:this.getBandwidthStdDevKbps(),latencyAvgMs:this.getLatencyAverageMs(),latencyStdDevMs:this.getLatencyStdDevMs()}}),e.prototype.setNetworkStatisticsWindows=freeOnUnref(function(e){this.statisticWindows=e}),e.prototype.setEventStorageToRetain=freeOnUnref(function(e){this.latencyMsAggregator.updateMaxSamples(e),this.bandwidthKbpsAggregator.updateMaxSamples(e)}),e.prototype.serialize=freeOnUnref(function(){var e={version:1,transferTimeAggregator:this.transferTimeMsTracker.getSamples(),latencyAggregator:this.latencyMsAggregator.getSamplesInWindow(1/0),contentSizeAggregator:this.contentSizeBytesTracker.getSamples(),bandwidthAggregator:this.bandwidthKbpsAggregator.getSamplesInWindow(1/0)};return JSON.stringify(e)}),e.prototype.deserialize=freeOnUnref(function(t){var e;try{var n=JSON.parse(t),r=n.version;if(1!==r)return o.warn("The version of the last known state ["+r+"] does not match the current version [1]"),!1;e=n}catch(e){return o.warn("Failed to parse last known state: "+t,e),!1}function i(e,t){t.reset();for(var n=0,r=e;n<r.length;n++){var i=r[n];if(null==i)throw new Error("Sample invalid");t.addSample(i)}}try{i(e.transferTimeAggregator,this.transferTimeMsTracker),i(e.latencyAggregator,this.latencyMsAggregator),i(e.contentSizeAggregator,this.contentSizeBytesTracker),i(e.bandwidthAggregator,this.bandwidthKbpsAggregator),this.reportDiagnostics()}catch(e){return o.error("Failed to reconstruct the last known bandwidth estimate state: "+t,e),this.reportDiagnostics(),!1}return!0}),e.prototype.reportDiagnostics=freeOnUnref(function(){var e={statistics:this.getStatistics(),timestamp:Date.now()};this.diagnostics.report("state",e)}),e})();t.NetworkStatisticsStore=n}));e(wc);wc.NetworkStatisticsStore;var Ic=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.stores={},this.statisticWindows=e,this.eventStorageToRetain=t,this.bandwidthAggregationWindow=n,this.holisticStore=new wc.NetworkStatisticsStore(this.statisticWindows,this.eventStorageToRetain,this.bandwidthAggregationWindow,"holistic")}return e.prototype.getRawStatisticsStore=freeOnUnref(function(e){return null!=e&&null!=this.stores[e]?this.stores[e]:this.holisticStore}),e.prototype.addLatencySample=freeOnUnref(function(e,t){this.holisticStore.addLatencySample(e),null!=t&&this.getStore(t).addLatencySample(e)}),e.prototype.addContentTransferSample=freeOnUnref(function(e,t,n){this.holisticStore.addContentTransferSample(e,t),null!=n&&this.getStore(n).addContentTransferSample(e,t)}),e.prototype.getStatistics=freeOnUnref(function(e,t){return this.getRawStatisticsStore(e).getStatistics(t)}),e.prototype.setNetworkStatisticsWindows=freeOnUnref(function(e){this.statisticWindows=e,this.holisticStore.setNetworkStatisticsWindows(e);for(var t=0,n=Object.keys(this.stores);t<n.length;t++){var r=n[t];this.stores[r].setNetworkStatisticsWindows(e)}}),e.prototype.setEventStorageToRetain=freeOnUnref(function(e){this.eventStorageToRetain=e,this.holisticStore.setEventStorageToRetain(e);for(var t=0,n=Object.keys(this.stores);t<n.length;t++){var r=n[t];this.getStore(r).setEventStorageToRetain(e)}}),e.prototype.serialize=freeOnUnref(function(){return this.holisticStore.serialize()}),e.prototype.deserialize=freeOnUnref(function(e){return this.holisticStore.deserialize(e)}),e.prototype.getStore=freeOnUnref(function(e){return null==this.stores[e]&&(this.stores[e]=new wc.NetworkStatisticsStore(this.statisticWindows,this.eventStorageToRetain,this.bandwidthAggregationWindow,e)),this.stores[e]}),e})();t.AggregateNetworkStatisticsStore=n}));e(Ic);Ic.AggregateNetworkStatisticsStore;var kc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("NetworkRequestManager"),a="NetworkRequestManagerState",n={networkStatisticsWindows:{bandwidthAverageWindow:4,bandwidthStdDevWindow:4,latencyAvgWindow:4,latencyStdDevWindow:4},eventStorageToRetain:4,bandwidthAggregationWindow:4,maxConcurrentRequests:3,linearizationPotential:1},r=freeOnUnref(function(){function e(){this.config=n,this.diagnostics=nn.Diagnostics.create("NetworkRequestManager"),this.requestPool=new yc.QueuedRequestPool,this.statisticsStore=new Ic.AggregateNetworkStatisticsStore(this.config.networkStatisticsWindows,this.config.eventStorageToRetain,this.config.bandwidthAggregationWindow);var e=1;null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.networkRequestManager&&(e=L.configurationStore.configuration.networkRequestManager.linearizationPotential),this.scheduler=new Tc.RequestScheduler(this.requestPool,this.statisticsStore,this.config.maxConcurrentRequests,e),this.loadState().catch(freeOnUnref(function(e){o.info("loadState failed with reason:",e)}))}return e.prototype.updateConfig=freeOnUnref(function(e){Qe.sanitize(e),this.config=Qe.deepExtend(this.config,e),this.scheduler.setConcurrentChannelCount(this.config.maxConcurrentRequests),this.scheduler.updateLinearizationPotential(this.config.linearizationPotential),this.statisticsStore.setNetworkStatisticsWindows(this.config.networkStatisticsWindows),this.statisticsStore.setEventStorageToRetain(this.config.eventStorageToRetain),this.reportDiagnostics()}),e.prototype.requestDownload=freeOnUnref(function(e,t){var n=this.requestPool.enqueue(e,t);return de.enabledFor(de.DEBUG)&&n.then(freeOnUnref(function(e){})).catch(freeOnUnref(function(e){})),this.scheduler.notifyItemEnqueued(),n}),e.prototype.getNetworkStatistics=freeOnUnref(function(e){return this.statisticsStore.getStatistics(void 0,e)}),e.prototype.storeState=freeOnUnref(function(){var r=this.statisticsStore.serialize();return new lt.Promise(freeOnUnref(function(t,n){Tt.keyValueStore.set(a,r,freeOnUnref(function(e){null!=e?(o.warn("Failed to store the current state, reason:",e),n(e)):(o.info("Successfully stored the current state:",r),t())}))}))}),e.prototype.loadState=freeOnUnref(function(){var i=this;return new lt.Promise(freeOnUnref(function(n,r){Tt.keyValueStore.get(a,freeOnUnref(function(e,t){if(null!=e)o.warn("Failed to retrieve the last known state, reason:",e),r(e);else{if(null!=t){if(o.info("Successfully retrieved last known state:",t),!i.statisticsStore.deserialize(t))return void i.removeState().then(n).catch(r)}else o.info("Last state was never stored under key:",a);n()}}))}))}),e.prototype.removeState=freeOnUnref(function(){return new lt.Promise(freeOnUnref(function(t,n){Tt.keyValueStore.set(a,void 0,freeOnUnref(function(e){null!=e?(o.warn("Failed to remove existing stored state, reason:",e),n(e)):t()}))}))}),e.prototype.reportDiagnostics=freeOnUnref(function(){var e={config:this.config,timestamp:Date.now()};this.diagnostics.report("state",e)}),e})();t.NetworkRequestManager=r}));e(kc);kc.NetworkRequestManager;var _c=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AccessTokenExpired=hc.AccessTokenExpired,t.AcquisitionError=mc.AcquisitionError;var n=null;t.getInstance=function(){return null===n&&(n=new kc.NetworkRequestManager),n}}));e(_c);_c.AccessTokenExpired,_c.AcquisitionError,_c.getInstance;var Rc=t(freeOnUnref(function(e,t){var a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=_c,d=de.get("ResourceAcquirer"),r=freeOnUnref(function(){function e(){this.networkRequestManager=n.getInstance()}return e.prototype.acquire=freeOnUnref(function(a,s,n,t,r,l,f,i,o){var u,c=this,e={getRequestBuilder:freeOnUnref(function(e){if(l.requested)return null;var t=new mt.URL(s.url);return r||(f=c.addAccessTokenToQueryParams(s,f,i)),null!=f&&mt.URLUtils.appendQueryParams(t,f),u=t.toString(),new pn.HttpRequestBuilder("GET",u).responseType("text"===a?"text":"arraybuffer").timeout(n).headers(s.headers)}),getPriority:freeOnUnref(function(){return t}),onCancelled:freeOnUnref(function(e){}),description:o};return this.networkRequestManager.requestDownload(e,l).then(freeOnUnref(function(e){l.throwIfRequested();var t="text"===a?e.getText():e.getArrayBuffer(),n=new mt.URL(e.getResponseUrl()),r=n.toString();null!=f&&mt.URLUtils.removeQueryParams(n,f);var i=n.toString(),o=0===s.url.indexOf("https:");return{sourceUrl:s,body:t,headers:e.getHeaders(),timing:{latencyMs:e.getLatencyMs(),downloadMs:e.getDownloadMs(),totalMs:e.getTotalMs(),parseMs:null},status:e.getStatus(),totalBytes:e.getMetrics().totalBytes,redirectedUrl:r!==u&&o?i:void 0}})).catch(freeOnUnref(function(e){if(l.throwIfRequested(),e instanceof _c.AccessTokenExpired&&null!=e.refreshPromise)return e.refreshPromise.then(freeOnUnref(function(e){return d.warn("Access token expired, retrying request with refreshed token"),c.acquire(a,s,n,t,r,l,f,e,o)}));throw e}))}),e.prototype.addAccessTokenToQueryParams=freeOnUnref(function(e,t,n){var r,i;if(null!=n)t=a({},t,((r={}).token=n,r));else{var o=e.getAccessToken();if("ExpiredToken"===o.type&&null!=o.refreshPromise)throw new _c.AccessTokenExpired(o.token,o.refreshPromise);"NoToken"!==o.type&&(t=a({},t,((i={}).token=o.token,i)))}return t}),e})();t.ResourceAcquirer=r}));e(Rc);Rc.ResourceAcquirer;var Ac=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AcquisitionResourceType=pc.AcquisitionResourceType,t.ResourceAcquirer=Rc.ResourceAcquirer}));e(Ac);Ac.AcquisitionResourceType,Ac.ResourceAcquirer;var Dc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.refreshImpl=e,this.changeCallback=new A.MulticastCallback}return Object.defineProperty(e.prototype,"valid",{get:freeOnUnref(function(){return null!=this.value}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contents",{get:freeOnUnref(function(){if(null==this.value)throw new Error("Attempted to read contents of a stale element!");return this.value}),enumerable:!0,configurable:!0}),e.prototype.onChange=freeOnUnref(function(e){this.changeCallback.add(e)}),e.prototype.offChange=freeOnUnref(function(e){this.changeCallback.remove(e)}),e.prototype.refresh=freeOnUnref(function(){return this.refreshImpl()}),e.prototype.setValue=freeOnUnref(function(e){this.value=e,this.changeCallback.invoke()}),e.prototype.clear=freeOnUnref(function(){delete this.value}),e})();t.DynamicElementImpl=n}));e(Dc);Dc.DynamicElementImpl;var xc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.selectRenditions=freeOnUnref(function(e){for(var t=[],n=0,r=e.renditionGroups;n<r.length;n++){var i=r[n];if(i.type===oc.RenditionType.Video){for(var o=0,a=i.renditions;o<a.length;o++){var s=a[o];if(s.type===oc.RenditionType.Video){t.push(s);break}}if(0<t.length)break}}return t}),e})();t.MinimalRenditionSelector=n}));e(xc);xc.MinimalRenditionSelector;var Fc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("HlsMediaRepresentationSource"),c="manifest.acquisition",n=freeOnUnref(function(){function e(e,t,n,r){void 0===n&&(n=null),void 0===r&&(r=null);var i=this;this.eventEmitter=new A.EventEmitter,this.masterPlaylistParser=new dc.MasterPlaylistParser,this.mediaPlaylistParser=new dc.MediaPlaylistParser,this.renditionSelector=new xc.MinimalRenditionSelector,this.schedulerSettings=null,this.masterPlaylist=null,this.masterPlaylistText=null,this.doRefresh=freeOnUnref(function(){var e=lt.CancelToken.source(),n=e.token,t=e.cancel;return i.cancel=t,i.eventEmitter.emit("start"),i.acquireRepresentation(n).then(freeOnUnref(function(e){n.throwIfRequested();var t=new tc.HlsMediaRepresentation(e,i.audioTrackMetadata,i.videoMaterialType,i.sourceUrlStore,i.refreshAndUpdatePlaylists,i.schedulerSettings);return i.holder.setValue(t),i.masterPlaylist=e.masterPlaylist,i.masterPlaylistText=e.masterPlaylistText,i.eventEmitter.emit("complete",t),t}))}),this.refreshAndUpdatePlaylists=freeOnUnref(function(){var e;null!=i.acquireRepresentationPromise&&null!=i.cancel&&i.cancel();var t=lt.CancelToken.source(),n=t.token,r=t.cancel;return i.cancel=r,i.acquireRepresentationPromise=(e=i.acquireRepresentation(n).then(freeOnUnref(function(e){return n.throwIfRequested(),i.eventEmitter.emit("complete",i.holder.contents),e}))).then.apply(e,lt.FINALLY(freeOnUnref(function(){n.requested||delete i.acquireRepresentationPromise}))),i.acquireRepresentationPromise}),this.resourceAcquirer=e,this.videoMaterialType=t,this.audioTrackMetadata=null!=n?n:{},this.schedulerSettings=r,this.holder=new Dc.DynamicElementImpl(this.doRefresh),this.lastParseStatus="Healty"}return Object.defineProperty(e.prototype,"mediaRepresentation",{get:freeOnUnref(function(){return this.holder}),enumerable:!0,configurable:!0}),e.prototype.prepare=freeOnUnref(function(e,t){this.sourceUrlStore=e,this.timeoutMs=t}),e.prototype.stop=freeOnUnref(function(){this.internalStop(),delete this.sourceUrlStore,this.lastParseStatus="Healty"}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.internalStop=freeOnUnref(function(){null!=this.cancel&&this.cancel(),this.holder.clear(),delete this.cancel,delete this.timeoutMs,this.masterPlaylist=null,this.masterPlaylistText=null}),e.prototype.acquireRepresentation=freeOnUnref(function(r){var f=this;return new lt.Promise(freeOnUnref(function(e,a){var s=null,l={},t=freeOnUnref(function(e,t,n,r){var i,o;i=lt.CancelToken.source(),o=i.token,s=i.cancel,f.acquirePlaylistsAndParse(o,l).then(n).catch(freeOnUnref(function(e){if(o.throwIfRequested(),q.metrics.putMetric("Manifest.HLS.Error"),u.warn("Manifest.HLS.Error:",e),e instanceof _c.AcquisitionError&&"UnknownError"!==e.reason.type){if(f.shouldRetryAcquisition(e,l.sourceUrl))return void t();throw f.internalStop(),new lt.CancelError}throw f.internalStop(),ct.XpError.generatePrefixedError(e,c)})).catch(a)}),n=(new _n.ExponentialBackoffRetry).withInitialIntervalMs(500).withExponentialFactor(2).withMaxDelayMs(2e3).onAttempt(t).onSuccess(e).execute();r.promise.then(freeOnUnref(function(){n.abort(),null!=s&&(s(),s=null)}))}))}),e.prototype.acquirePlaylistsAndParse=freeOnUnref(function(u,t){var c=this;return null==this.timeoutMs||u.requested?lt.Promise.reject(new Error("Attempting to acquire manifest on stopped acquirer")):lt.Promise.resolve(null).then(freeOnUnref(function(e){return u.throwIfRequested(),null!=e?lt.Promise.resolve(e):c.acquireMasterPlaylistAndParse(u,t).then(freeOnUnref(function(e){for(var o=e.masterPlaylist,a=e.masterPlaylistText,s=c.renditionSelector.selectRenditions(o),t=c.sourceUrlStore.get(),n=[],r=0,i=s;r<i.length;r++){var l=i[r].uri,f={url:new mt.URL(l,t.url).toString(),urlId:t.urlId,headers:{},getAccessToken:freeOnUnref(function(){return{type:"NoToken"}})};n.push(c.acquireMediaPlaylistAndParse(f,u))}return lt.Promise.all(n).then(freeOnUnref(function(e){for(var t={},n=0,r=0,i=s;r<i.length;r++){t[i[r].uri]=e[n++]}return{masterPlaylist:o,masterPlaylistText:a,mediaPlaylists:t,minimumUpdatePeriodMs:c.getMinimumUpdatePeriodMs(e)}}))}))}))}),e.prototype.acquireMediaPlaylistAndParse=freeOnUnref(function(e,t){var n=this;return null==this.timeoutMs||t.requested?lt.Promise.reject(new Error("Attempting to acquire manifest on stopped acquirer")):this.makePlaylistRequest(t,e).then(freeOnUnref(function(e){return n.parseToMediaPlaylist(e.body,t)}))}),e.prototype.shouldRetryAcquisition=freeOnUnref(function(e,t){if("ParseError"===e.reason.type){if("ParseError"===this.lastParseStatus)return this.lastParseStatus="SourceError",this.sourceUrlStore.resourceAcquisitionFailed({type:"SourceError",cause:e},Ac.AcquisitionResourceType.Manifest,t.url,t.urlId);if("SourceError"===this.lastParseStatus)throw ct.XpError.generatePrefixedError(e,c);return this.lastParseStatus="ParseError",this.sourceUrlStore.resourceAcquisitionFailed(e.reason,Ac.AcquisitionResourceType.Manifest,t.url,t.urlId)}return this.sourceUrlStore.resourceAcquisitionFailed(e.reason,Ac.AcquisitionResourceType.Manifest,t.url,t.urlId)}),e.prototype.acquireMasterPlaylistAndParse=freeOnUnref(function(n,e){var r=this;if(null==this.sourceUrlStore||null==this.timeoutMs||n.requested)return lt.Promise.reject(new Error("Attempting to acquire manifest on stopped acquirer"));var t=this.sourceUrlStore.get();return e.sourceUrl=t,null!=this.masterPlaylist&&null!=this.masterPlaylistText?lt.Promise.resolve({masterPlaylist:this.masterPlaylist,masterPlaylistText:this.masterPlaylistText}):this.makePlaylistRequest(n,t).then(freeOnUnref(function(t){return n.throwIfRequested(),r.parseToMasterPlaylist(t.body,n).then(freeOnUnref(function(e){return n.throwIfRequested(),{masterPlaylist:e,masterPlaylistText:t.body}}))}))}),e.prototype.makePlaylistRequest=freeOnUnref(function(t,n){var r=this;if(null==this.sourceUrlStore||null==this.timeoutMs||t.requested)return lt.Promise.reject(new Error("Attempting to acquire manifest on stopped acquirer"));this.eventEmitter.emit("downloadStart",n);return this.resourceAcquirer.acquire("text",n,this.timeoutMs,0,!0,t).then(freeOnUnref(function(e){if(t.throwIfRequested(),r.sourceUrlStore.resourceAcquired(e),x.isEmpty(e.body))throw new _c.AcquisitionError({type:"ParseError",cause:new Error("Response body is empty")});return r.eventEmitter.emit("downloadComplete",x.omit(e,"body")),q.metrics.putMetric("Manifest.HLS.Download.TransferTime",e.timing.downloadMs,"ms"),q.metrics.putMetric("Manifest.HLS.Download.Latency",e.timing.latencyMs,"ms"),null!=e.totalBytes&&q.metrics.putMetric("Manifest.HLS.Download.Throughput",8*e.totalBytes/e.timing.totalMs*1e3),e})).catch(freeOnUnref(function(e){throw t.throwIfRequested(),u.error("An error happened when acquiring manifest: "+e),e instanceof _c.AcquisitionError&&r.eventEmitter.emit("failure",{sourceUrl:n,error:e}),e}))}),e.prototype.parseToMasterPlaylist=freeOnUnref(function(r,i){var o=this;return lt.Promise.resolve().then(freeOnUnref(function(){i.throwIfRequested();var e=Date.now(),t=o.masterPlaylistParser.parse(r),n=Date.now()-e;return q.metrics.putMetric("Manifest.HLS.Parse.Time",n,"ms"),o.lastParseStatus="Healty",t})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;throw q.metrics.putMetric("Manifest.HLS.Parse.Error"),new _c.AcquisitionError({type:"ParseError",cause:e})}))}),e.prototype.parseToMediaPlaylist=freeOnUnref(function(r,i){var o=this;return lt.Promise.resolve().then(freeOnUnref(function(){i.throwIfRequested();var e=Date.now(),t=o.mediaPlaylistParser.parse(r),n=Date.now()-e;return q.metrics.putMetric("Manifest.HLS.Parse.Time",n,"ms"),t})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelToken)throw e;throw q.metrics.putMetric("Manifest.HLS.Parse.Error"),new _c.AcquisitionError({type:"ParseError",cause:e})}))}),e.prototype.getMinimumUpdatePeriodMs=freeOnUnref(function(e){for(var t=1/0,n=!1,r=0,i=e;r<i.length;r++){var o=i[r];t=Math.min(o.targetDurationMs,t),n=n||o.containsEndOfPlaylist}return t===1/0||n?void 0:t}),e})();t.HlsMediaRepresentationSource=n}));e(Fc);Fc.HlsMediaRepresentationSource;var Bc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HlsMediaRepresentation=tc.HlsMediaRepresentation,t.HlsMediaRepresentationSource=Fc.HlsMediaRepresentationSource,t.HlsPeriod=Yu.HlsPeriod,t.HlsStream=Wu.HlsStream}));e(Bc);Bc.HlsMediaRepresentation,Bc.HlsMediaRepresentationSource,Bc.HlsPeriod,Bc.HlsStream;var Lc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.resourceAcquirer=new Ac.ResourceAcquirer}return e.prototype.create=freeOnUnref(function(n,r,e,i,t,o,a,s,l,f,u,c){var d=lt.CancelToken.source(),p=d.token,h=d.cancel,m=new Bc.HlsMediaRepresentationSource(this.resourceAcquirer,o,t,null!=e?e.scheduler:null);m.prepare(r,1e4),null!=f&&f(m);var y=m.mediaRepresentation,g=(!0===y.valid?lt.Promise.resolve(y.contents):y.refresh()).then(freeOnUnref(function(e){p.throwIfRequested(),e.start(i);var t=new Fu.SafariHlsContentSource(e,r,n,o,a,s,l,u,c);return{representationSource:m,mediaRepresentation:e,contentSource:t}}));return{cancel:freeOnUnref(function(){m.stop(),h()}),contentSourceContextPromise:g}}),e})();t.SafariHlsContentSourceFactory=n}));e(Lc);Lc.SafariHlsContentSourceFactory;var Nc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MpPlayerSafariHls=_u.MpPlayerSafariHls,t.SafariHlsContentSource=Fu.SafariHlsContentSource,t.SafariHlsContentSourceFactory=Lc.SafariHlsContentSourceFactory}));e(Nc);Nc.MpPlayerSafariHls,Nc.SafariHlsContentSource,Nc.SafariHlsContentSourceFactory;var Vc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.urlResolver=e,this.segmentBases=null,this.indexElement=null,this.byteRangeOffsetValue=0}return e.prototype.reset=freeOnUnref(function(e){this.segmentBases=e,this.indexElement=null,this.byteRangeOffsetValue=0}),Object.defineProperty(e.prototype,"index",{get:freeOnUnref(function(){return null===this.indexElement&&this.rebuildSegmentBaseInformation(),this.indexElement}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteRangeOffset",{get:freeOnUnref(function(){return null===this.indexElement&&this.rebuildSegmentBaseInformation(),this.byteRangeOffsetValue}),enumerable:!0,configurable:!0}),e.prototype.rebuildSegmentBaseInformation=freeOnUnref(function(){if(null===this.segmentBases)throw new Error("No SegmentBases have been provided yet");for(var e=0,t=this.segmentBases;e<t.length;e++){var n=t[e];if(null!=n.representationIndex){this.indexElement=n.representationIndex,this.byteRangeOffsetValue=0,this.urlResolver.resolve(n.representationIndex.sourceUrl)===this.urlResolver.resolve()&&(this.byteRangeOffsetValue=this.indexElement.range.end+1);break}if(null!=n.indexRange){this.indexElement={range:n.indexRange},this.byteRangeOffsetValue=this.indexElement.range.end+1;break}}if(null==this.indexElement)throw new Error("Cannot use a SegmentBase without an index!")}),e})();t.SegmentBaseInformation=n}));e(Vc);Vc.SegmentBaseInformation;var jc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createDownloadOperationStoragePrefixKey=function(e){return e+"/segment_data/"},t.createDownloadOperationChunkIndexKey=function(e){return e+"/chunk_index"},t.createDownloadProgressMetadataKey=function(e){return"download_progress_metadata_"+e},t.createPersistentLicenseMetadataKey=function(e){return"persistent_license_metadata_"+e},t.createQualityLevelProgressMetadataKey=function(e,t,n,r){return"progress_metadata_"+e+"_"+t+"_"+n+"_"+r},t.createSelectionContextKey=function(e){return"selection_context_"+e}}));e(jc);jc.createDownloadOperationStoragePrefixKey,jc.createDownloadOperationChunkIndexKey,jc.createDownloadProgressMetadataKey,jc.createPersistentLicenseMetadataKey,jc.createQualityLevelProgressMetadataKey,jc.createSelectionContextKey;var qc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=freeOnUnref(function(){function e(e){var n=this;this.onUpdate=freeOnUnref(function(e){if(null!=n.onUpdateCallback){var t={downloadedSizeBytes:e.downloadedSizeBytes-n.recentDownloadProgressPayload.downloadedSizeBytes,estimatedTotalSizeBytes:e.estimatedTotalSizeBytes-n.recentDownloadProgressPayload.estimatedTotalSizeBytes};n.recentDownloadProgressPayload=e,n.onUpdateCallback(t)}}),this.downloadProgress=e,this.recentDownloadProgressPayload={downloadedSizeBytes:e.downloadedBytes(),estimatedTotalSizeBytes:e.estimatedTotalBytes()}}return e.prototype.getDownloadProgress=freeOnUnref(function(){return this.downloadProgress}),e.prototype.getRecentDownloadProgressPayload=freeOnUnref(function(){return this.recentDownloadProgressPayload}),e.prototype.subscribe=freeOnUnref(function(e){null==this.onUpdateCallback&&(this.recentDownloadProgressPayload={downloadedSizeBytes:this.downloadProgress.downloadedBytes(),estimatedTotalSizeBytes:this.downloadProgress.estimatedTotalBytes()},this.downloadProgress.onUpdate(this.onUpdate)),this.onUpdateCallback=e}),e.prototype.unsubscribe=freeOnUnref(function(){this.onUpdateCallback=void 0,this.downloadProgress.offUpdate(this.onUpdate)}),e})(),n=freeOnUnref(function(){function e(){var t=this;this.downloadProgressRecords=[],this.onUpdateSubscribers=new A.MulticastCallback,this.totalDownloadedBytes=0,this.totalEstimatedTotalBytes=0,this.onDownloadProgressRecordUpdate=freeOnUnref(function(e){0===e.downloadedSizeBytes&&0===e.estimatedTotalSizeBytes||(t.totalDownloadedBytes+=e.downloadedSizeBytes,t.totalEstimatedTotalBytes+=e.estimatedTotalSizeBytes,t.notifySubscribers())})}return e.prototype.downloadedBytes=freeOnUnref(function(){return this.totalDownloadedBytes}),e.prototype.estimatedTotalBytes=freeOnUnref(function(){return this.totalEstimatedTotalBytes}),e.prototype.onUpdate=freeOnUnref(function(e){this.onUpdateSubscribers.add(e)}),e.prototype.offUpdate=freeOnUnref(function(e){this.onUpdateSubscribers.remove(e)}),e.prototype.addDownloadProgress=freeOnUnref(function(t){if(!this.downloadProgressRecords.some(freeOnUnref(function(e){return e.getDownloadProgress()===t}))){var e=new i(t);this.downloadProgressRecords.push(e),e.subscribe(this.onDownloadProgressRecordUpdate);var n=t.downloadedBytes(),r=t.estimatedTotalBytes();0===n&&0===r||(this.totalDownloadedBytes+=n,this.totalEstimatedTotalBytes+=r,this.notifySubscribers())}}),e.prototype.removeDownloadProgress=freeOnUnref(function(n){var r=this;if(this.downloadProgressRecords.some(freeOnUnref(function(e){return e.getDownloadProgress()===n}))){var i=!1;this.downloadProgressRecords=this.downloadProgressRecords.filter(freeOnUnref(function(e){if(e.getDownloadProgress()===n){var t=e.getRecentDownloadProgressPayload();return e.unsubscribe(),0===t.downloadedSizeBytes&&0===t.estimatedTotalSizeBytes||(i=!0,r.totalDownloadedBytes-=t.downloadedSizeBytes,r.totalEstimatedTotalBytes-=t.estimatedTotalSizeBytes),!1}return!0})),i&&this.notifySubscribers()}}),e.prototype.removeAllDownloadProgress=freeOnUnref(function(){this.downloadProgressRecords.forEach(freeOnUnref(function(e){e.unsubscribe()})),this.downloadProgressRecords=[],0===this.totalDownloadedBytes&&0===this.totalEstimatedTotalBytes||(this.totalDownloadedBytes=0,this.totalEstimatedTotalBytes=0,this.notifySubscribers())}),e.prototype.notifySubscribers=freeOnUnref(function(){this.onUpdateSubscribers.invoke({downloadedSizeBytes:this.downloadedBytes(),estimatedTotalSizeBytes:this.estimatedTotalBytes()})}),e})();t.AggregateDownloadProgress=n}));e(qc);qc.AggregateDownloadProgress;var Hc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.streamAlternators={},this.mediaRepresentation=e,this.streamSelector=new vu.StreamSelector,this.streamTypes=this.extractStreamTypes();for(var t=0,n=this.streamTypes;t<n.length;t++){var r=n[t];this.streamAlternators[r]=new vu.streamAlternatorTypeMap[r]}}return e.prototype.selectDownloadableStreams=freeOnUnref(function(e,t,n){var r={selectionContext:{},availableTracks:{audioTracks:{}}};this.extractAvailableAudioTracks(this.mediaRepresentation.periods.contents,r.availableTracks.audioTracks);for(var i=0,o=this.streamTypes;i<o.length;i++){var a=o[i],s=[];"Audio"===a?s=t:"TimedText"===a&&(s=n),this.selectMultipleStreamsForType(a,r,s,e)}return r}),e.prototype.selectMultipleStreamsForType=freeOnUnref(function(e,t,n,r){if(0===n.length)this.streamSelector.setMatchers(e,[]),this.streamAlternators[e].uninitialize(),this.initializeStreamAlternator(e),this.addSelectionContextForMatcher(e,t,r);else for(var i=0,o=n;i<o.length;i++){var a=o[i];this.streamSelector.setMatchers(e,a),this.streamAlternators[e].uninitialize(),this.initializeStreamAlternator(e),this.addSelectionContextForMatcher(e,t,r)}}),e.prototype.addSelectionContextForMatcher=freeOnUnref(function(e,t,n){for(var r=t.selectionContext,i=0,o=this.mediaRepresentation.periods.contents;i<o.length;i++){var a=o[i];null==r[a.id]&&(r[a.id]={});var s=this.streamSelector.selectStreams(a,e),l=this.streamAlternators[e].selectStream(s);if("Audio"===e&&null!=l&&this.updateSelectedAudioTrack(l,t.availableTracks.audioTracks),null!=l&&0!==l.qualityLevels.length){var f=l.qualityLevels[0];if("Video"===e)for(var u=l.qualityLevels.length-1;0<=u;u--){var c=l.qualityLevels[u];if(c.bandwidth<=n){f=c;break}}else f=l.qualityLevels[l.qualityLevels.length-1];null==r[a.id][e]&&(r[a.id][e]=[]),r[a.id][e].push({qualityLevelId:f.id,streamId:l.id})}}}),e.prototype.extractStreamTypes=freeOnUnref(function(){for(var e={},t=0,n=this.mediaRepresentation.periods.contents;t<n.length;t++)for(var r=0,i=n[t].streams;r<i.length;r++){var o=i[r];"Image"!==o.type&&(e[o.type]=!0)}return Object.keys(e)}),e.prototype.initializeStreamAlternator=freeOnUnref(function(t){var n=this,e=this.mediaRepresentation.periods.contents.map(freeOnUnref(function(e){return n.streamSelector.selectStreams(e,t)}));this.streamAlternators[t].initialize(e)}),e.prototype.extractAvailableAudioTracks=freeOnUnref(function(e,t){for(var n=0,r=e;n<r.length;n++)for(var i=0,o=r[n].streams;i<o.length;i++){var a=o[i];if("Audio"===a.type){var s=a;if(null!=s.language){var l=this.getAudioTrackIdentifier(s);null==t[l]&&(t[l]={language:s.language,type:s.subtype,isScheduled:!1})}}}}),e.prototype.updateSelectedAudioTrack=freeOnUnref(function(e,t){null!=e.language&&(t[this.getAudioTrackIdentifier(e)]={language:e.language,type:e.subtype,isScheduled:!0})}),e.prototype.getAudioTrackIdentifier=freeOnUnref(function(e){return e.language+"_"+e.subtype}),e})();t.DownloadableStreamsSelector=n}));e(Hc);Hc.DownloadableStreamsSelector;var zc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.Constants={CIRCA_ONE_FRAME_MS:50,SEGMENT_POSITION_EPSILON_MS:.1}}));e(zc);zc.Constants;var Wc=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={}).Video=3*zc.Constants.CIRCA_ONE_FRAME_MS,n.Audio=0,n.TimedText=0,n);t.STREAM_TYPE_TO_ACCEPTABLE_SEGMENT_POSITION_ERROR_MS=r}));e(Wc);Wc.STREAM_TYPE_TO_ACCEPTABLE_SEGMENT_POSITION_ERROR_MS;var Kc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("ContentSizeCalculator");var n=freeOnUnref(function(){function e(e,t,n){this.computationStartTime=null,this.period=e,this.qualityLevel=n,this.streamType=t}return e.prototype.estimateTotalMediaSize=freeOnUnref(function(){var e=this.getPeriodDurationMs();if(!isFinite(e))return lt.Promise.reject(new Error("Unable to estimate total size, period duration is unknown."));var t=this.qualityLevel.segmentTimeline.getSegmentAt(Wc.STREAM_TYPE_TO_ACCEPTABLE_SEGMENT_POSITION_ERROR_MS[this.streamType]);return this.computationStartTime=Date.now(),this.accumulateSizeSinceSegment(t,0)}),e.prototype.accumulateSizeSinceSegment=freeOnUnref(function(e,t){for(var n=this;;){if("RefreshMe"===e.type)return e.load().then(freeOnUnref(function(e){return n.accumulateSizeSinceSegment(e,t)}));if("Unavailable"===e.type)return this.estimateSizeWithDuration();var r=e.segment;if(null==r.byteRange)return this.estimateSizeWithDuration();if(t+=this.getByteRangeSize(r.byteRange),r.isFinalSegment)return lt.Promise.resolve(t);e=this.qualityLevel.segmentTimeline.getNext(r)}}),e.prototype.estimateSizeWithDuration=freeOnUnref(function(){var e=this.getPeriodDurationMs();return isFinite(e)?lt.Promise.resolve(this.qualityLevel.bandwidth/8*e/1e3):lt.Promise.reject(new Error("Unable to estimate total size, period duration is unknown."))}),e.prototype.getPeriodDurationMs=freeOnUnref(function(){return this.period.endMs-this.period.startMs}),e.prototype.getByteRangeSize=freeOnUnref(function(e){return e.end-e.start+1}),e})();t.ContentSizeCalculator=n}));e(Kc);Kc.ContentSizeCalculator;var Gc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.internalDownloadedBytes=0,this.internalEstimatedTotalBytes=0,this.onUpdateSubscribers=new A.MulticastCallback}return e.prototype.downloadedBytes=freeOnUnref(function(){return this.internalDownloadedBytes}),e.prototype.estimatedTotalBytes=freeOnUnref(function(){return this.internalEstimatedTotalBytes}),e.prototype.onUpdate=freeOnUnref(function(e){this.onUpdateSubscribers.add(e)}),e.prototype.offUpdate=freeOnUnref(function(e){this.onUpdateSubscribers.remove(e)}),e.prototype.updateBytes=freeOnUnref(function(e,t){if(Math.round(e)!==e)throw new TypeError("Downloaded bytes must be an integer");if(Math.round(t)!==t)throw new TypeError("Estimated bytes must be an integer");if(t<e)throw new RangeError("Downloaded bytes cannot be greater than total estimated bytes");if(e<0)throw new RangeError("Downloaded bytes cannot be less than zero");e===this.internalDownloadedBytes&&t===this.internalEstimatedTotalBytes||(this.internalDownloadedBytes=e,this.internalEstimatedTotalBytes=t,this.notifySubscribers())}),e.prototype.updateDownloadedBytes=freeOnUnref(function(e){if(Math.round(e)!==e)throw new TypeError("Downloaded bytes must be an integer");if(e>this.estimatedTotalBytes())throw new RangeError("Downloaded bytes cannot be greater than total estimated bytes");if(e<0)throw new RangeError("Downloaded bytes cannot be less than zero");e!==this.internalDownloadedBytes&&(this.internalDownloadedBytes=e,this.notifySubscribers())}),e.prototype.updateEstimatedTotalBytes=freeOnUnref(function(e){if(Math.round(e)!==e)throw new TypeError("Estimated bytes must be an integer");if(e<this.downloadedBytes())throw new RangeError("Estimated total bytes cannot be less than downloaded bytes");e!==this.internalEstimatedTotalBytes&&(this.internalEstimatedTotalBytes=e,this.notifySubscribers())}),e.prototype.notifySubscribers=freeOnUnref(function(){this.onUpdateSubscribers.invoke({downloadedSizeBytes:this.downloadedBytes(),estimatedTotalSizeBytes:this.estimatedTotalBytes()})}),e})();t.DatumDownloadProgress=n}));e(Gc);Gc.DatumDownloadProgress;var Qc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var d=de.get("IsoBmffValidation"),n=new Ao.BmffParser;t.validateBasicIsoBmffStructure=function(e){try{n.parseFragment(e,[])}catch(e){var t={type:"ParseError",cause:new Error("Top level boxes parsing error: "+e.message)};throw new _c.AcquisitionError(t)}},t.validateExpectedStructureForSegmentType=function(e,t){var n=t.isInitSegment?"moov":"moof";if(null==Ao.Boxes.find(e,Ao.Boxes.ofType(n))){var r=t.isInitSegment?"init":"media";throw new Error("Expected "+r+" segment to contain '"+n+"' box")}},t.validateExpectedPosition=function(e,t){if(t.isInitSegment)return 0;if(null==t.rawData||"dash-raw"!==t.rawData.type)return 0;var n=Ao.Boxes.find(e,Ao.Boxes.ofType("moof"));if(null==n)return 0;var r=Ao.Boxes.find(n,Ao.Boxes.ofType("traf"));if(null==r)return 0;var i=Ao.Boxes.find(r,Ao.Boxes.ofType("trun"));if(null==i)return 0;var o=Ao.Boxes.find(r,Ao.Boxes.ofType("tfdt"));if(null==o)throw new Error("Missing tfdt box!");var a=o.baseMediaDecodeTime,s=i.samples[0].compositionTimeOffset,l=a+(null!=s?s:0),f=t.rawData.timescale,u=t.rawData.startTicks,c=(l-u)/f;return l===u?0:a===u?1:.15<Math.abs(c)?(d.error("Expected segment position: "+u+"ticks ("+u/f+"sec). Actual position: "+l+"ticks ("+l/f+"sec). Offset: "+c+"sec"),3):2}}));e(Qc);Qc.validateBasicIsoBmffStructure,Qc.validateExpectedStructureForSegmentType,Qc.validateExpectedPosition;var Xc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function r(){}return r.getSegmentSizeBytes=freeOnUnref(function(e,t){var n=r.getSegmentSizeFromByteRange(t.byteRange);return null!=n?n:Math.max(e.bandwidth/8*(t.position.durationMs/1e3),1)}),r.getSegmentSizeFromByteRange=freeOnUnref(function(e){return null==e?null:e.end-e.start+1}),r.validateDownloadedSegmentData=freeOnUnref(function(e,t){Yc.validateNonemptyData(e),Yc.validateExpectedSize(e,t),Qc.validateBasicIsoBmffStructure(e)}),r})();t.FragmentUtilities=n}));e(Xc);Xc.FragmentUtilities;var Yc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateNonemptyData=function(e){if(0===e.byteLength){var t={type:"ParseError",cause:new Error("Response buffer is empty")};throw new _c.AcquisitionError(t)}},t.validateExpectedSize=function(e,t){var n=Xc.FragmentUtilities.getSegmentSizeFromByteRange(t.byteRange);if(null!=n&&e.byteLength!==n){var r={type:"ParseError",cause:new Error("Expected response buffer to contain "+n+" bytes, but actual response buffer contains "+e.byteLength+" bytes instead")};throw new _c.AcquisitionError(r)}}}));e(Yc);Yc.validateNonemptyData,Yc.validateExpectedSize;var Jc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.process=freeOnUnref(function(e,t){Yc.validateNonemptyData(e),Yc.validateExpectedSize(e,t)}),e})();t.BasicFragmentProcessor=n}));e(Jc);Jc.BasicFragmentProcessor;var Zc=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.trunv1ify=function(e,t,n){var r=Yi.BinaryUtils.convertBufferSourceToUint8Array(e);null==n&&(n=(new Ao.BmffParser).parseFragment(r));var i=Ao.Boxes.find(n,Ao.Boxes.ofType("moof"));if(null!=i){var o=Ao.Boxes.find(i,Ao.Boxes.ofType("traf"));if(null!=o){var a=Ao.Boxes.find(o,Ao.Boxes.ofType("trun"));if(null!=a){var s=a.samples[0].compositionTimeOffset;if(null!=s&&0!==s){var l=new DataView(r.buffer),f=l.getUint32(a.absoluteStartPosition+8);l.setUint8(a.absoluteStartPosition+8,1);var u=a.absoluteStartPosition+16;0!=(1&f)&&(u+=4),0!=(4&f)&&(u+=4);var c=0;if(0!=(256&f)&&(c+=4),0!=(512&f)&&(c+=4),0!=(1024&f)&&(c+=4),0==(2048&f))throw new Error("composition time was present in the parsed entry but not in the box data!");c+=4;for(var d=0;d<a.samples.length;d++){var p=u+c-4;l.setInt32(p,l.getUint32(p)-s),u+=c}if(t){var h=Ao.Boxes.find(o,Ao.Boxes.ofType("tfdt"));if(null==h)throw new Error("Missing tfdt box!");var m=l.getUint8(h.absoluteStartPosition+8),y=h.absoluteStartPosition+12;if(0===m)l.setUint32(y,l.getUint32(y)+s);else{var g=l.getUint32(y),v=l.getUint32(y+4);g+=(v+=s)/4294967296|0,v&=4294967295,l.setUint32(y,g),l.setUint32(y+4,v)}}}}}}}}));e(Zc);Zc.trunv1ify;var $c=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var a=new Ao.BmffParser,r=freeOnUnref(function(o){function e(){var e=o.call(this)||this;return e.useDtsToMatchManifest=!0===Qe.nestedValue(L.configurationStore,"fragmentTransforms.useDtsToMatchManifest",!1),e}return n(e,o),e.prototype.process=freeOnUnref(function(e,t){o.prototype.process.call(this,e,t);try{var n=a.parseFragment(e);Qc.validateExpectedStructureForSegmentType(n,t);var r=1!==Qc.validateExpectedPosition(n,t)||!this.useDtsToMatchManifest;Zc.trunv1ify(e,r,n)}catch(e){var i={type:"ParseError",cause:new Error("Full box parsing error: "+e.message)};throw new _c.AcquisitionError(i)}}),e})(Jc.BasicFragmentProcessor);t.IsoBmffFragmentProcessor=r}));e($c);$c.IsoBmffFragmentProcessor;var ed=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.FragmentRequestConstants={SEGMENT_TIMEOUT_MS:4e3}}));e(ed);ed.FragmentRequestConstants;var td=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.createInitFragmentRequestBuilder=freeOnUnref(function(e,t,n){return this.createRequestBuilder(e.sourceUrl,t,!1,e.byteRange,n)}),e.prototype.createMediaFragmentRequestBuilder=freeOnUnref(function(e,t,n,r){return void 0===n&&(n=!1),this.createRequestBuilder(e.sourceUrl,t,n,e.byteRange,r)}),e.prototype.createRequestBuilder=freeOnUnref(function(e,t,n,r,i){var o,a,s,l=new mt.URL(e.url);if(mt.URLUtils.appendQueryParams(l,((o={}).amznDtid=zt.deviceInformation.hardware.deviceTypeId,o)),null!=i)mt.URLUtils.appendQueryParams(l,((a={}).token=i,a));else{var f=e.getAccessToken();if("ExpiredToken"===f.type&&null!=f.refreshPromise)throw new _c.AccessTokenExpired(f.token,f.refreshPromise);"NoToken"!==f.type&&mt.URLUtils.appendQueryParams(l,((s={}).token=f.token,s))}var u=l.toString(),c=new pn.HttpRequestBuilder("GET",u).responseType(n?"datalocator":"arraybuffer");return null!=r&&c.header("Range","bytes="+r.start+"-"+r.end),null!=t&&c.timeout(t),c}),e})();t.FragmentRequestFactory=n}));e(td);td.FragmentRequestFactory;var nd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.queuedTime=null,this.priorityWhenQueued=null,this.requestStartedTime=null,this.priorityWhenRequested=null,this.initialQueuedTime=Date.now(),this.failureCount=0}return e.prototype.queued=freeOnUnref(function(e){this.queuedTime=Date.now(),this.priorityWhenQueued=e}),e.prototype.requestStarted=freeOnUnref(function(e,t){this.requestStartedTime=Date.now(),this.priorityWhenRequested=e,this.timeoutMs=t}),e.prototype.failed=freeOnUnref(function(e){this.lastFailedTime=Date.now(),this.lastFailureReason=e,this.failureCount++}),e})();t.PendingFragmentDiagnosticsTracker=n}));e(nd);nd.PendingFragmentDiagnosticsTracker;var rd=t(freeOnUnref(function(e,t){function i(e,t){return e+"_"+t}Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.completedRequestsWithFailure=[],this.pendingFragments={},this.failedRequestDiagnosticsRetentionLimit=e}return e.prototype.reset=freeOnUnref(function(){this.completedRequestsWithFailure=[],this.pendingFragments={}}),e.prototype.has=freeOnUnref(function(e,t){return null!=this.pendingFragments[i(e.id,t.id)]}),e.prototype.trackFor=freeOnUnref(function(e,t,n){var r=i(e.id,n.id);return null==this.pendingFragments[r]&&(this.pendingFragments[r]={periodId:e.id,streamId:t.id,qualityLevelId:n.id,diagnosticsTracker:new nd.PendingFragmentDiagnosticsTracker}),this.pendingFragments[r]}),e.prototype.downloaded=freeOnUnref(function(e){this.recordCompletedFailures(e.diagnosticsTracker)}),e.prototype.delete=freeOnUnref(function(e){var t=i(e.periodId,e.qualityLevelId);delete this.pendingFragments[t]}),e.prototype.isPendingThat=freeOnUnref(function(e){var t=this;return Object.keys(this.pendingFragments).map(freeOnUnref(function(e){return t.pendingFragments[e]})).some(e)}),e.prototype.getDiagnostics=freeOnUnref(function(){var t=this;return{completedInitFragmentsWithFailure:this.completedRequestsWithFailure,initFragments:Object.keys(this.pendingFragments).map(freeOnUnref(function(e){return t.pendingFragments[e].diagnosticsTracker}))}}),e.prototype.recordCompletedFailures=freeOnUnref(function(e){0!==e.failureCount&&(this.completedRequestsWithFailure.length>=this.failedRequestDiagnosticsRetentionLimit&&this.completedRequestsWithFailure.shift(),this.completedRequestsWithFailure.push(e))}),e})();t.PendingInitFragmentStore=n}));e(rd);rd.PendingInitFragmentStore;var id=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var p=de.get("InitFragmentAcquirer"),n=freeOnUnref(function(){function e(e,t){this.networkRequestManager=_c.getInstance(),this.reportStateChangeCallback=e,this.fragmentRequestFactory=new td.FragmentRequestFactory,this.pendingFragmentStore=new rd.PendingInitFragmentStore(t)}return e.prototype.getDiagnostics=freeOnUnref(function(){return this.pendingFragmentStore.getDiagnostics()}),e.prototype.isInitFragmentPendingThat=freeOnUnref(function(t){return this.pendingFragmentStore.isPendingThat(freeOnUnref(function(e){return t(e.periodId,e.streamId)}))}),e.prototype.getInitSegmentInfo=freeOnUnref(function(t,n,r,i){var e=i.segmentTimeline.getInitSegment();return"Unavailable"===e.type?(p.warn(t+" init segment for quality "+i.id+" of period "+r.id+" is no longer available! Ignoring it."),lt.Promise.resolve(null)):("RefreshMe"===e.type?e.load():lt.Promise.resolve(e)).then(freeOnUnref(function(e){return n.requested?(p.info("Request for "+t+" init segment for quality "+i.id+" of period "+r.id+" was cancelled."),null):"Unavailable"===e.type?(p.warn(t+" init segment for quality "+i.id+" of period "+r.id+" is not available! Ignoring request"),null):e}))}),e.prototype.downloadInitFragment=freeOnUnref(function(n,r,i,o,e,a,t,s){var l=this,f=n+"|"+o.id+"|"+e.id+"|"+a.id+"|init",u=this.pendingFragmentStore.trackFor(o,e,a),c=u.diagnosticsTracker;c.queued(t()),this.reportStateChangeCallback();var d={getRequestBuilder:freeOnUnref(function(e){return c.requestStarted(t(),ed.FragmentRequestConstants.SEGMENT_TIMEOUT_MS),l.reportStateChangeCallback(),l.fragmentRequestFactory.createInitFragmentRequestBuilder(i.segment,ed.FragmentRequestConstants.SEGMENT_TIMEOUT_MS,s)}),getPriority:t,onCancelled:freeOnUnref(function(e){}),description:f};return this.networkRequestManager.requestDownload(d,r).then(freeOnUnref(function(e){r.throwIfRequested();var t=e.getArrayBuffer();return Xc.FragmentUtilities.validateDownloadedSegmentData(t,i.segment),l.pendingFragmentStore.downloaded(u),l.pendingFragmentStore.delete(u),e})).catch(freeOnUnref(function(e){var t="["+n+"] Init fragment failed to acquire for quality "+a.id+" on period "+o.id+": "+e;if(p.error(t),e instanceof lt.CancelError&&(p.info("["+n+"] Init fragment acquisition canceled for quality "+a.id),r.requested))return l.pendingFragmentStore.delete(u),l.reportStateChangeCallback(),null;throw c.failed(t),l.reportStateChangeCallback(),e}))}),e.prototype.stop=freeOnUnref(function(){this.pendingFragmentStore.reset()}),e})();t.InitFragmentAcquirer=n}));e(id);id.InitFragmentAcquirer;var od=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.IsoBmffFragmentProcessor=$c.IsoBmffFragmentProcessor,t.FragmentRequestConstants=ed.FragmentRequestConstants,t.FragmentRequestFactory=td.FragmentRequestFactory,t.FragmentUtilities=Xc.FragmentUtilities,t.InitFragmentAcquirer=id.InitFragmentAcquirer,t.PendingFragmentDiagnosticsTracker=nd.PendingFragmentDiagnosticsTracker}));e(od);od.IsoBmffFragmentProcessor,od.FragmentRequestConstants,od.FragmentRequestFactory,od.FragmentUtilities,od.InitFragmentAcquirer,od.PendingFragmentDiagnosticsTracker;var ad=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){if(this.storagePromises={},!Pt.localStorage.capabilities.isSupported)throw new ct.XpError("storage_queue.not_supported",void 0,"Local storage is not supported")}return e.prototype.addFragment=freeOnUnref(function(e,t){var n,r=this,i=(n=Pt.localStorage.put(e,t)).then.apply(n,lt.FINALLY(freeOnUnref(function(){delete r.storagePromises[e]})));return this.storagePromises[e]=i}),e.prototype.flush=freeOnUnref(function(){var t=this,e=Object.keys(this.storagePromises).map(freeOnUnref(function(e){return t.storagePromises[e]}));return lt.Promise.all(e).catch(freeOnUnref(function(e){}))}),e})();t.DiskStorageQueue=n}));e(ad);ad.DiskStorageQueue;var sd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("MediaChunkProducer"),n=freeOnUnref(function(){function e(e,t){this.segmentTimeline=e,this.streamType=t.streamType,this.downloadContext=t}return e.prototype.getMediaChunkAt=freeOnUnref(function(e,t){var n=this.segmentTimeline.getSegmentAt(e,Wc.STREAM_TYPE_TO_ACCEPTABLE_SEGMENT_POSITION_ERROR_MS[this.streamType]);return this.buildChunks(n,t)}),e.prototype.buildChunks=freeOnUnref(function(e,r){for(var i=this,t=[this.getMediaSegmentInfoOnly(r,e)],n=1;n<16;n++)t[n]=t[n-1].then(freeOnUnref(function(t){if(null==t)return null;var n=t.byteRange;return t.isFinalSegment||null==n?null:i.getMediaSegmentInfoOnly(r,i.segmentTimeline.getNext(t)).then(freeOnUnref(function(e){return null==e?null:null==e.byteRange||e.byteRange.start!==n.end+1||t.sourceUrl.url!==e.sourceUrl.url?null:e}))}));return lt.Promise.all(t).then(freeOnUnref(function(e){var t=e.filter(freeOnUnref(function(e){return null!=e}));if(0===t.length)return null;var n=t[0],r=t[t.length-1],i=null==n.byteRange||null==r.byteRange?void 0:{start:n.byteRange.start,end:r.byteRange.end},o={startTimeMs:n.position.startTimeMs,endTimeMs:r.position.endTimeMs,durationMs:r.position.endTimeMs-n.position.startTimeMs};return{id:n.index+"-"+r.index,sourceUrl:n.sourceUrl,byteRange:i,positionMs:o,isFinalChunk:r.isFinalSegment,originalMediaSegments:t}}))}),e.prototype.getMediaSegmentInfo=freeOnUnref(function(t,e){var n=this.downloadContext.period,r=this.downloadContext.qualityLevel,i=this.downloadContext.streamType;return"Unavailable"===e.type?(o.warn(i+" media segment for quality "+r.id+" of period "+n.id+" is no longer available with reason: "+e.reason+". Ignoring it."),lt.Promise.resolve(null)):("RefreshMe"===e.type?e.load():lt.Promise.resolve(e)).then(freeOnUnref(function(e){return t.throwIfRequested(),"Unavailable"===e.type?(o.warn(i+" media segment for quality "+r.id+" of period "+n.id+" with reason: "+e.reason+". Ignoring request"),null):e}))}),e.prototype.getMediaSegmentInfoOnly=freeOnUnref(function(e,t){return this.getMediaSegmentInfo(e,t).then(freeOnUnref(function(e){return null==e?null:e.segment}))}),e})();t.MediaChunkProducer=n}));e(sd);sd.MediaChunkProducer;var ld=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("MediaChunkQueue"),r=freeOnUnref(function(){function e(e,t,n){this.lastProducedMediaChunk=lt.Promise.resolve(null),this.finalChunkProduced=!1,this.mediaChunkProducer=e,this.producedRangesMs=new In.NumberLine(zc.Constants.SEGMENT_POSITION_EPSILON_MS),this.streamType=n,this.setProducedRangesMs(t)}return e.prototype.getNext=freeOnUnref(function(r){var i=this;return this.lastProducedMediaChunk=this.lastProducedMediaChunk.then(freeOnUnref(function(e){if(null!=e&&(i.producedRangesMs.add({start:e.positionMs.startTimeMs,end:e.positionMs.endTimeMs}),e.isFinalChunk&&(i.finalChunkProduced=!0)),i.finalChunkProduced)return null;var t=i.producedRangesMs.getIntervals(),n=0<t.length&&i.isPositionAtStart(t[0].start)?t[0].end:0;return i.mediaChunkProducer.getMediaChunkAt(n,r)})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;return n.error("Failed to produce next segment:",e),null})),this.lastProducedMediaChunk}),e.prototype.setProducedRangesMs=freeOnUnref(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.producedRangesMs.add(r)}}),e.prototype.isPositionAtStart=freeOnUnref(function(e){return e<=Wc.STREAM_TYPE_TO_ACCEPTABLE_SEGMENT_POSITION_ERROR_MS[this.streamType]}),e})();t.MediaChunkQueue=r}));e(ld);ld.MediaChunkQueue;var fd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var p=_c,h=de.get("StreamDownloader");var n=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.startupCancel=null,this.completedMediaChunksWithFailure=[],this.downloadContext=null,this.finalChunkDownloaded=!1,this.networkRequestManager=_c.getInstance(),this.pendingMediaChunks={},this.initFragmentCancelCallbacks={},this.mediaChunkCancelCallbacks={},this.reportStateChange=freeOnUnref(function(){var e=i.initFragmentAcquirer.getDiagnostics();i.diagnostics.report("state",{pendingMediaChunks:Object.keys(i.pendingMediaChunks).map(freeOnUnref(function(e){return i.convertMediaChunk(i.pendingMediaChunks[e])})),initFragment:e.initFragments,completedInitFragmentsWithFailure:e.completedInitFragmentsWithFailure,completedMediaChunksWithFailure:i.completedMediaChunksWithFailure.map(i.convertMediaChunk),timestamp:Date.now()})}),this.convertMediaChunk=freeOnUnref(function(e){return{chunk:{periodId:e.periodId,streamId:e.streamId,id:e.mediaChunk.id,byteRange:e.mediaChunk.byteRange},qualityLevelId:e.qualityLevelId,initialQueuedTime:e.initialQueuedTime,queuedTime:e.queuedTime,failureCount:e.failureCount,requestStartedTime:e.requestStartedTime,timeoutMs:e.timeoutMs,lastFailureReason:e.lastFailureReason,lastFailedTime:e.lastFailedTime}}),this.priorityFunction=freeOnUnref(function(){return 1/0}),this.mediaChunkIndex=e,this.sourceUrlStore=t,this.updateProgressCallback=n,this.errorCallback=r,this.downloadedRangesMs=new In.NumberLine(zc.Constants.SEGMENT_POSITION_EPSILON_MS),this.diagnostics=nn.Diagnostics.create("StreamDownloader"),this.diskStorageQueue=new ad.DiskStorageQueue,this.fragmentRequestFactory=new od.FragmentRequestFactory,this.initFragmentAcquirer=new od.InitFragmentAcquirer(this.reportStateChange,4),this.progressMetadata={isInitSegmentStored:!1,allSegmentsStored:!1,downloadedBytes:0,storedIntervalsMs:[]}}return e.prototype.start=freeOnUnref(function(n){var i=this,r=(this.downloadContext=n).qualityLevel.segmentTimeline,o=new sd.MediaChunkProducer(r,n),e=lt.CancelToken.source(),a=e.token,t=e.cancel;this.startupCancel=t,this.finalChunkDownloaded=!1,this.getStoredProgressMetadataOrDefault(a).then(freeOnUnref(function(e){a.throwIfRequested();var t=!(i.progressMetadata=e).isInitSegmentStored&&"Unavailable"!==r.getInitSegment().type;if(!e.allSegmentsStored||t)return i.setDownloadedRanges(i.progressMetadata.storedIntervalsMs),i.mediaChunkQueue=new ld.MediaChunkQueue(o,i.progressMetadata.storedIntervalsMs,n.streamType),(t?i.registerInitFragmentRequest(n.streamType):lt.Promise.resolve()).then(freeOnUnref(function(){a.throwIfRequested();for(var e=[i.mediaChunkQueue.getNext(a)],t=1;t<2;t++)e.push(i.mediaChunkQueue.getNext(a));return lt.Promise.all(e)})).then(freeOnUnref(function(e){a.throwIfRequested();for(var t=0,n=e;t<n.length;t++){var r=n[t];if(null==r)break;i.registerMediaChunkWithRetry(r)}}));h.warn("This task has been completed, should not have been scheduled.")})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||h.error("StreamDownloader failed with error:",e)}))}),e.prototype.stop=freeOnUnref(function(){null!=this.startupCancel&&(this.startupCancel(),this.startupCancel=null);for(var e=0,t=Object.keys(this.initFragmentCancelCallbacks);e<t.length;e++){var n=t[e];this.initFragmentCancelCallbacks[n]()}for(var r=0,i=Object.keys(this.mediaChunkCancelCallbacks);r<i.length;r++){var o=i[r];this.mediaChunkCancelCallbacks[o]()}return this.initFragmentAcquirer.stop(),this.startupCancel=null,this.completedMediaChunksWithFailure=[],this.downloadContext=null,this.pendingMediaChunks={},lt.Promise.all([this.diskStorageQueue.flush(),this.mediaChunkIndex.flush()]).then(freeOnUnref(function(){}))}),e.prototype.registerMediaChunkWithRetry=freeOnUnref(function(t){var n=this;if(null!=this.downloadContext){var e=this.downloadContext.streamType,r=lt.CancelToken.source(),i=r.token,o=r.cancel;this.mediaChunkCancelCallbacks[t.id]=o,this.registerMediaChunk(e,i,t).then(freeOnUnref(function(){delete n.mediaChunkCancelCallbacks[t.id]})).catch(freeOnUnref(function(e){i.requested||(h.warn("Failed to acquire media chunk, retrying:",e),n.registerMediaChunkWithRetry(t))}))}}),e.prototype.registerMediaChunk=freeOnUnref(function(f,u,c){var d=this;return this.downloadMediaChunk(u,c).then(freeOnUnref(function(e){if(u.throwIfRequested(),null==e)return null;var t=e.getArrayBuffer(),n=d.downloadContext,r=[];if(null==c.byteRange){1!==c.originalMediaSegments.length&&h.error("Expected chunk to have a single fragment if there's no byte range, but found "+c.originalMediaSegments.length+" fragments instead.");var i=c.originalMediaSegments[0],o=d.createSegmentId(i);r.push(d.diskStorageQueue.addFragment(o,t))}else{var a=c.byteRange,s=a.end-a.start+1;t.byteLength!==s&&h.error("Expected byte range: "+a.start+"-"+a.end+", size="+s+" !== Response Size ("+t.byteLength+")"),r.push(d.mediaChunkIndex.updateIndex(n.period.id,n.stream.id,n.qualityLevel.id,c.byteRange));o=d.createChunkId(c);r.push(d.diskStorageQueue.addFragment(o,t))}d.onRequestSucceed(e,c.sourceUrl),d.reportStateChange(),c.isFinalChunk&&(d.finalChunkDownloaded=!0);var l=t.byteLength;c.originalMediaSegments[c.originalMediaSegments.length-1];return lt.Promise.all(r).then(freeOnUnref(function(){d.updateProgress(n,f,l,c)})).catch(freeOnUnref(function(e){h.error("Fragment storage failed with error: "+e),d.errorCallback(e)})),d.mediaChunkQueue.getNext(u)})).then(freeOnUnref(function(e){u.throwIfRequested(),null!=e&&d.registerMediaChunkWithRetry(e)})).catch(freeOnUnref(function(e){throw e instanceof p.AcquisitionError&&d.onRequestFailed(e,c.sourceUrl),e}))}),e.prototype.updateProgress=freeOnUnref(function(e,t,n,r){var i=this.progressMetadata.downloadedBytes+n,o=this.finalChunkDownloaded&&0===Object.keys(this.pendingMediaChunks).length;null!=r&&this.downloadedRangesMs.add({start:r.positionMs.startTimeMs,end:r.positionMs.endTimeMs});var a={isInitSegmentStored:!0,allSegmentsStored:o,downloadedBytes:i,storedIntervalsMs:this.downloadedRangesMs.clone().getIntervals()};this.updateQualityLevelProgress(a,e);var s=e.period,l=e.qualityLevel,f=e.stream;o&&h.info(t+" Stream with qualityLevel: "+l.id+" has completed download for period "+s.id),this.updateProgressCallback({period:s,qualityLevel:l,stream:f,metadata:a})}),e.prototype.downloadMediaChunk=freeOnUnref(function(n,r){var i=this;if(null==this.downloadContext)return lt.Promise.resolve(null);var o=this.downloadContext.period,a=this.downloadContext.qualityLevel,e=this.downloadContext.stream,s=this.downloadContext.streamType,t=s+"|"+o.id+"|"+e.id+"|"+a.id+"|"+r.id,l=null!=this.pendingMediaChunks[r.id]?this.pendingMediaChunks[r.id]:{periodId:o.id,streamId:e.id,qualityLevelId:a.id,mediaChunk:r,initialQueuedTime:null,queuedTime:null,requestStartedTime:null,failureCount:0};this.pendingMediaChunks[r.id]=l;var f={getRequestBuilder:freeOnUnref(function(e){var t=12e4*r.originalMediaSegments.length;return l.timeoutMs=t,l.requestStartedTime=Date.now(),i.reportStateChange(),i.fragmentRequestFactory.createRequestBuilder(r.sourceUrl,t,!1,r.byteRange)}),getPriority:this.priorityFunction,onCancelled:freeOnUnref(function(e){}),description:t},u=Date.now();return 0===l.failureCount&&(l.initialQueuedTime=u),l.queuedTime=u,this.reportStateChange(),this.networkRequestManager.requestDownload(f,n).then(freeOnUnref(function(e){n.throwIfRequested();var t=e.getArrayBuffer();return od.FragmentUtilities.validateDownloadedSegmentData(t,r),0<l.failureCount&&(4<=i.completedMediaChunksWithFailure.length&&i.completedMediaChunksWithFailure.shift(),i.completedMediaChunksWithFailure.push(l)),delete i.pendingMediaChunks[r.id],e})).catch(freeOnUnref(function(e){var t="Failed to acquire "+s+" init fragment for quality "+a.id+" on period "+o.id+": "+e;if(e instanceof lt.CancelError&&(h.info("Acquisition canceled for "+s+" init fragment for quality "+a.id),n.requested))return delete i.pendingMediaChunks[r.id],i.reportStateChange(),null;throw h.error(t),l.lastFailedTime=Date.now(),l.lastFailureReason=t,l.failureCount++,i.reportStateChange(),e}))}),e.prototype.registerInitFragmentRequest=freeOnUnref(function(i){var o=this,e=this.downloadContext.period,t=this.downloadContext.qualityLevel,n=this.downloadContext.stream,r=lt.CancelToken.source(),a=r.cancel,s=r.token,l=[e.id,t.id].join("_");return this.initFragmentCancelCallbacks[l]=a,this.initFragmentAcquirer.getInitSegmentInfo(i,s,e,t).then(freeOnUnref(function(r){if(s.throwIfRequested(),null!=r)return o.initFragmentAcquirer.downloadInitFragment(i,s,r,e,n,t,o.priorityFunction).then(freeOnUnref(function(e){if(s.throwIfRequested(),null!=e){var t=e.getArrayBuffer(),n=o.downloadContext;o.diskStorageQueue.addFragment(o.createSegmentId(r.segment),t).then(freeOnUnref(function(){o.updateProgress(n,i,t.byteLength)})).catch(freeOnUnref(function(e){h.error("Init fragment storage failed with error: "+e),o.errorCallback(e)})),o.onRequestSucceed(e,r.segment.sourceUrl),delete o.initFragmentCancelCallbacks[l],o.reportStateChange()}})).catch(freeOnUnref(function(e){if(!(e instanceof lt.CancelError))return e instanceof p.AcquisitionError&&o.onRequestFailed(e,r.segment.sourceUrl),o.delay(500,s).then(freeOnUnref(function(){return s.throwIfRequested(),o.registerInitFragmentRequest(i)}))}));h.warn("Init segment info was not found")}))}),e.prototype.onRequestFailed=freeOnUnref(function(e,t){"UnknownError"!==e.reason.type&&this.sourceUrlStore.resourceAcquisitionFailed(e.reason,Ac.AcquisitionResourceType.Fragment,t.url,t.urlId)}),e.prototype.onRequestSucceed=freeOnUnref(function(e,t){var n={body:"",headers:e.getHeaders(),timing:{latencyMs:e.getLatencyMs(),downloadMs:e.getDownloadMs(),totalMs:e.getTotalMs(),parseMs:null},status:e.getStatus(),sourceUrl:t};this.sourceUrlStore.resourceAcquired(n)}),e.prototype.getStoredProgressMetadataOrDefault=freeOnUnref(function(e){return this.getStoredProgressMetadata(e).then(freeOnUnref(function(e){return null!=e?e:{isInitSegmentStored:!1,allSegmentsStored:!1,downloadedBytes:0,storedIntervalsMs:[]}}))}),e.prototype.getStoredProgressMetadata=freeOnUnref(function(t){return Jo.metadataStorage.get(this.createQualityLevelKey(this.downloadContext)).then(freeOnUnref(function(e){return t.throwIfRequested(),e}))}),e.prototype.updateQualityLevelProgress=freeOnUnref(function(e,t){return this.progressMetadata=e,Jo.metadataStorage.put(this.createQualityLevelKey(t),e)}),e.prototype.createQualityLevelKey=freeOnUnref(function(e){var t=e.downloadOperationId,n=e.period.id,r=e.stream.id,i=e.qualityLevel.id;return jc.createQualityLevelProgressMetadataKey(t,n,r,i)}),e.prototype.createSegmentId=freeOnUnref(function(e){var t=this.downloadContext.downloadOperationId,n=this.downloadContext.period.id,r=this.downloadContext.stream.id,i=this.downloadContext.qualityLevel.id;return gf.createLocalStorageSegmentId(t,n,r,i,e)}),e.prototype.createChunkId=freeOnUnref(function(e){var t=this.downloadContext.downloadOperationId,n=this.downloadContext.period.id,r=this.downloadContext.stream.id,i=this.downloadContext.qualityLevel.id;return gf.createLocalStorageSegmentIdWithByteOffset(t,n,r,i,e.byteRange.start)}),e.prototype.delay=freeOnUnref(function(r,i){return new lt.Promise(freeOnUnref(function(e,t){var n=oe.timer.setTimeout(e,r);i.promise.then(freeOnUnref(function(e){oe.timer.clearTimeout(n),t(e)}))}))}),e.prototype.setDownloadedRanges=freeOnUnref(function(e){this.downloadedRangesMs=new In.NumberLine(zc.Constants.SEGMENT_POSITION_EPSILON_MS);for(var t=0,n=e;t<n.length;t++){var r=n[t];this.downloadedRangesMs.add(r)}}),e})();t.StreamDownloader=n}));e(fd);fd.StreamDownloader;var ud=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.mediaRepresentation=e,this.mediaRepresentationQuerier=gf.MediaRepresentationQuerier.for(e)}return e.prototype.orderStreams=freeOnUnref(function(e,t){for(var n=[],r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];if(null==(c=this.mediaRepresentationQuerier.itemById(o).value()))throw new Error("Period "+o+" does not exist within MediaRepresentation")}for(;0!==Object.keys(t).length;)for(var a=0,s=e;a<s.length;a++)for(var l=s[a],f=0,u=this.mediaRepresentation.periods.contents;f<u.length;f++){var c;if(null!=t[(c=u[f]).id]){var d=t[c.id][l];if(null!=d){var p=d.shift();if(null!=p){var h=this.mediaRepresentationQuerier.itemById(c.id).streamById(p.streamId),m=h.value(),y=h.qualityLevelById(p.qualityLevelId).value();if(null!=m&&null!=y&&(n.push({periodId:c.id,qualityLevel:y,stream:m,type:l}),0===t[c.id][l].length&&delete t[c.id][l],0===Object.keys(t[c.id]).length)){delete t[c.id];break}}else 0===d.length&&delete t[c.id][l],0===Object.keys(t[c.id]).length&&delete t[c.id]}}else delete t[c.id]}return n}),e})();t.CompleteStreamDownloadOrderStrategy=n}));e(ud);ud.CompleteStreamDownloadOrderStrategy;var cd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var d=de.get("DownloadScheduler"),n=freeOnUnref(function(){function e(e,t,n,r,i,o){var a=this;this.availableStreamDownloaders=[],this.downloadProgressMetadata=null,this.remainingStreamsToDownload=[],this.segmentToDownloadProgressMap={},this.streamTypes=["Video","Audio"],this.usedStreamDownloaders={},this.updateProgress=freeOnUnref(function(e){var t=jc.createQualityLevelProgressMetadataKey(a.downloadOperationId,e.period.id,e.stream.id,e.qualityLevel.id),n=a.segmentToDownloadProgressMap[t];if(null!=n)if(e.metadata.allSegmentsStored)n.updateBytes(e.metadata.downloadedBytes,e.metadata.downloadedBytes);else{var r=Math.max(n.estimatedTotalBytes(),e.metadata.downloadedBytes+1);n.updateBytes(e.metadata.downloadedBytes,r)}if(e.metadata.allSegmentsStored){if(null==a.usedStreamDownloaders[t])return;a.availableStreamDownloaders.push(a.usedStreamDownloaders[t]),delete a.usedStreamDownloaders[t],a.queueTasksForDownload(),0===a.remainingStreamsToDownload.length&&0===Object.keys(a.usedStreamDownloaders).length&&a.completionCallback()}else null==a.downloadProgressMetadata||x.contains(a.downloadProgressMetadata.qualityLevelKeys,t)||(a.downloadProgressMetadata.qualityLevelKeys.push(t),a.storeDownloadProgressMetadata(a.downloadProgressMetadata))}),this.contentConfig=e,this.downloadOperationId=t,this.mediaRepresentation=n,this.sourceUrlStore=r,this.completionCallback=i,this.errorCallback=o,this.downloadProgress=new qc.AggregateDownloadProgress,this.streamDownloadOrderStrategy=new ud.CompleteStreamDownloadOrderStrategy(n)}return e.prototype.initialize=freeOnUnref(function(e,t){var a=this;d.info(">> initialize");for(var n=0;n<2;n++)this.availableStreamDownloaders.push(new fd.StreamDownloader(e,this.sourceUrlStore,this.updateProgress,this.errorCallback));return this.acquireDownloadProgressMetadata().then(freeOnUnref(function(){return a.filterSelectionContext(t)})).then(freeOnUnref(function(e){return d.info(">>> filtered selection context:",JSON.stringify(e)),a.remainingStreamsToDownload=a.streamDownloadOrderStrategy.orderStreams(a.streamTypes,e),d.info(">>> ordered remaining streams to download:",JSON.stringify(a.remainingStreamsToDownload)),a.downloadProgress.removeAllDownloadProgress(),lt.Promise.all(a.remainingStreamsToDownload.map(freeOnUnref(function(e){var t=jc.createQualityLevelProgressMetadataKey(a.downloadOperationId,e.periodId,e.stream.id,e.qualityLevel.id),r=new Gc.DatumDownloadProgress;a.downloadProgress.addDownloadProgress(r),a.segmentToDownloadProgressMap[t]=r;var n=a.periodIdToPeriod(e.periodId),i=lt.Promise.resolve();null!=n&&(i=new Kc.ContentSizeCalculator(n,e.type,e.qualityLevel).estimateTotalMediaSize().then(freeOnUnref(function(e){e=Math.max(e,r.estimatedTotalBytes()),r.updateEstimatedTotalBytes(e)})));var o=Jo.metadataStorage.get(t).then(freeOnUnref(function(e){if(null!=e&&null!=e.downloadedBytes){var t=Math.max(e.downloadedBytes,r.downloadedBytes()),n=Math.max(r.estimatedTotalBytes(),t+1);r.updateBytes(t,n)}}));return lt.Promise.all([i,o]).then(freeOnUnref(function(){}))})))})).then(freeOnUnref(function(){}))}),e.prototype.start=freeOnUnref(function(){if(0===this.remainingStreamsToDownload.length)return d.error("There are not streams to be downloaded"),void this.completionCallback();this.queueTasksForDownload()}),e.prototype.stop=freeOnUnref(function(){for(var e=[],t=0,n=Object.keys(this.usedStreamDownloaders);t<n.length;t++){var r=n[t];e.push(this.usedStreamDownloaders[r].stop()),delete this.usedStreamDownloaders[r]}return null!=this.downloadProgressMetadata&&e.push(this.storeDownloadProgressMetadata(this.downloadProgressMetadata)),this.availableStreamDownloaders=[],this.streamTypes=["Video","Audio"],this.downloadProgressMetadata=null,this.remainingStreamsToDownload=[],this.segmentToDownloadProgressMap={},lt.Promise.all(e).then(freeOnUnref(function(){}))}),e.prototype.getDownloadProgress=freeOnUnref(function(){return this.downloadProgress}),e.prototype.acquireDownloadProgressMetadata=freeOnUnref(function(){var t=this;return Jo.metadataStorage.get(jc.createDownloadProgressMetadataKey(this.downloadOperationId)).then(freeOnUnref(function(e){t.downloadProgressMetadata=null==e?{qualityLevelKeys:[]}:e}))}),e.prototype.filterSelectionContext=freeOnUnref(function(l){for(var f=[],u=!1,e=freeOnUnref(function(o){if(null==l[o.id])return d.error("Period "+o.id+" doesn't have streams to download"),{value:lt.Promise.reject(new ct.XpError("download_scheduler.no_period_streams",void 0,"Unable to find a streams to download for period "+o.id))};for(var a=l[o.id],e=0,t=vu.CRITICAL_STREAM_TYPES;e<t.length;e++){var n=t[e];if(null==a[n])return{value:lt.Promise.reject(new ct.XpError("download_scheduler.no_critical_stream_download",void 0,"Unable to find a critical stream to download for type "+n))}}for(var r=freeOnUnref(function(r){"TimedText"===r&&(u=!0);for(var e=a[r],t=freeOnUnref(function(t){var n=jc.createQualityLevelProgressMetadataKey(c.downloadOperationId,o.id,t.streamId,t.qualityLevelId),e=Jo.metadataStorage.get(n).then(freeOnUnref(function(e){d.info("Retrieved persistent single task progress metadata:",n,JSON.stringify(e));return{completedDownload:null!=e&&e.allSegmentsStored,periodId:o.id,qualityLevelId:t.qualityLevelId,streamId:t.streamId,streamType:r}}));f.push(e)}),n=0,i=e;n<i.length;n++){t(i[n])}}),i=0,s=Object.keys(a);i<s.length;i++){r(n=s[i])}}),c=this,t=0,n=this.mediaRepresentation.periods.contents;t<n.length;t++){var r=e(n[t]);if("object"==typeof r)return r.value}return u&&this.streamTypes.push("TimedText"),lt.Promise.all(f).then(freeOnUnref(function(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n],o=i.completedDownload,a=i.periodId,s=i.qualityLevelId,l=i.streamId,f=i.streamType;null==t[a]&&(t[a]={}),null==t[a][f]&&(t[a][f]=[]),o?t[a][f].push(null):t[a][f].push({qualityLevelId:s,streamId:l})}return t}))}),e.prototype.periodIdToPeriod=freeOnUnref(function(e){for(var t=0,n=this.mediaRepresentation.periods.contents;t<n.length;t++){var r=n[t];if(r.id===e)return r}return null}),e.prototype.queueTasksForDownload=freeOnUnref(function(){for(;0!==this.availableStreamDownloaders.length&&0!==this.remainingStreamsToDownload.length;){var e=this.remainingStreamsToDownload.shift(),t=this.availableStreamDownloaders.shift(),n=jc.createQualityLevelProgressMetadataKey(this.downloadOperationId,e.periodId,e.stream.id,e.qualityLevel.id);this.usedStreamDownloaders[n]=t;var r=gf.MediaRepresentationQuerier.for(this.mediaRepresentation).itemById(e.periodId).value();if(null==r)throw d.error("Period "+e.periodId+" doesn't exist within the media representation"),new ct.XpError("download_scheduler.no_period",void 0,"Unable to find a matching period in representation for period "+e.periodId);t.start({downloadOperationId:this.downloadOperationId,period:r,qualityLevel:e.qualityLevel,stream:e.stream,streamType:e.type})}}),e.prototype.storeDownloadProgressMetadata=freeOnUnref(function(e){return Jo.metadataStorage.put(jc.createDownloadProgressMetadataKey(this.downloadOperationId),e)}),e})();t.DownloadScheduler=n}));e(cd);cd.DownloadScheduler;var dd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("LicenseManager"),n=freeOnUnref(function(){function e(e,t,n,r,i){var o=this;this.cancelTokenPair=null,this.deferredLicenseRequests=null,this.expectedLicenseRefreshRequests=0,this.licenseRefreshRequestCount=0,this.onLicenseAcquired=freeOnUnref(function(e){if(u.info("Successfully acquired license for "+e.keyId+", placing in storage"),o.updateLicenseMetadataItems(e.keyId,e.keyMetadata)){var t=o.createPersistentLicenseMetadata();null!=t&&Jo.metadataStorage.put(jc.createPersistentLicenseMetadataKey(o.downloadOperationId),t)}}),this.onMediaKeysManagerError=freeOnUnref(function(e){o.handleFatalError(e)}),this.onRefreshLicenseAcquired=freeOnUnref(function(e){o.licenseRefreshRequestCount++,u.info("Successfully refreshed license for key: "+e.keyId+", licenseRefreshRequestCount: "+o.licenseRefreshRequestCount+", expectedLicenseRefreshRequests: "+o.expectedLicenseRefreshRequests),o.updateLicenseMetadataItems(e.keyId,e.keyMetadata),null!=o.deferredLicenseRequests&&o.licenseRefreshRequestCount===o.expectedLicenseRefreshRequests&&(o.deferredLicenseRequests.resolve(),o.deferredLicenseRequests=null)}),this.onRefreshLicenseError=freeOnUnref(function(e){u.warn("Failed to refreshed license for "+o.downloadOperationId+": "+e);var t=o.convertError(e);null!=o.deferredLicenseRequests&&(o.deferredLicenseRequests.reject(t),o.deferredLicenseRequests=null),o.unload()}),this.getLicense=e,this.onError=t,this.mediaKeysManager=n,this.deferredLoad=new lt.Deferred,this.initializationDataGenerator=new vu.InitializationDataGenerator(r),this.licenseMetadataItems=[],this.downloadOperationId=i}return e.prototype.load=freeOnUnref(function(){var e=this;if(!Jo.metadataStorage.capabilities.isSupported)return lt.Promise.reject(new ct.XpError("download.drm.not_supported"));if(null!=this.cancelTokenPair)return u.info("Another load already initiated, ignore."),lt.Promise.resolve();this.cancelTokenPair=lt.CancelToken.source();var t=this.cancelTokenPair.token;this.mediaKeysManager.on("licenseAcquired",this.onLicenseAcquired),this.mediaKeysManager.on("error",this.onMediaKeysManagerError);var n=this.deferredLoad;return this.loadPersistentLicenseMetadata(t).then(freeOnUnref(function(){return t.throwIfRequested(),u.info("Loading licenses for Download "+e.downloadOperationId),e.createMediaKeySessions(t)})).then(freeOnUnref(function(){t.throwIfRequested(),n.resolve()})).catch(freeOnUnref(function(e){return n.reject(e)})),n.promise}),e.prototype.refresh=freeOnUnref(function(){var t=this;if(!Jo.metadataStorage.capabilities.isSupported)return lt.Promise.reject(new ct.XpError("download.drm.not_supported"));null!=this.cancelTokenPair&&(this.cancelTokenPair.cancel(),null!=this.deferredLicenseRequests&&this.deferredLicenseRequests.reject(new lt.CancelError),this.cancelTokenPair=null),this.cancelTokenPair=lt.CancelToken.source();var n=this.cancelTokenPair.token;return this.deferredLicenseRequests=new lt.Deferred,this.mediaKeysManager.on("licenseAcquired",this.onRefreshLicenseAcquired),this.mediaKeysManager.on("error",this.onRefreshLicenseError),this.loadPersistentLicenseMetadata(n).then(freeOnUnref(function(){return n.throwIfRequested(),u.info("Refreshing licenses for Download "+t.downloadOperationId),t.createMediaKeySessions(n,!0)})).then(freeOnUnref(function(){n.throwIfRequested();var e=t.getOldDuplicateLicenseMetadata();return u.info("All licenses refreshed for "+t.downloadOperationId+", removing "+e.length+" duplicates"),0===e.length?t.deferredLicenseRequests.resolve():t.expectedLicenseRefreshRequests=e.length,t.deferredLicenseRequests.promise.then(freeOnUnref(function(){return e}))})).then(freeOnUnref(function(e){return u.info("Will remove "+e.length+" old licenses"),n.throwIfRequested(),t.mediaKeysManager.off("licenseAcquired",t.onRefreshLicenseAcquired),t.mediaKeysManager.off("error",t.onRefreshLicenseError),t.removeTrackedOldLicenses(e)}))}),e.prototype.unload=freeOnUnref(function(){null!=this.cancelTokenPair&&(this.cancelTokenPair.cancel(),this.cancelTokenPair=null),this.deferredLoad=new lt.Deferred,this.mediaKeysManager.off("licenseAcquired",this.onLicenseAcquired),this.mediaKeysManager.off("error",this.onMediaKeysManagerError);for(var e=0,t=this.licenseMetadataItems;e<t.length;e++){var n=t[e];null!=n.sessionId&&this.mediaKeysManager.removeCachedSession(n.sessionId)}this.licenseMetadataItems=[]}),e.prototype.applyInitData=freeOnUnref(function(e,t,n){var r=this,i=freeOnUnref(function(e,t){return n.requested?lt.Promise.reject(new lt.CancelError):r.getLicense(e,t,n)}),o=[this.mediaKeysManager.applyInitData(e,t,i,ea.MediaKeysPurpose.Download,!0),this.mediaKeysManager.extractKeyId(t)];return lt.Promise.all(o).then(freeOnUnref(function(e){var t=e[0],n=e[1];null!=t&&null!=n?r.licenseMetadataItems.push({sessionId:t,keyId:n}):u.error("Failed to create sessionId or keyId")})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw u.info("applyInitData was cancelled"),e;u.error("Failed to apply initialization data",e),r.handleFatalError(e)}))}),e.prototype.convertError=freeOnUnref(function(e){return e instanceof ct.XpError&&-1!==e.code.indexOf("xp.system")?e:ct.XpError.generatePrefixedError(e,"download.drm")}),e.prototype.createMediaKeySessions=freeOnUnref(function(n,r){var i=this;void 0===r&&(r=!1);var o=[],e=this.getInitializationData();u.info("Creating "+e.length+" MediaKey sessions");for(var t=freeOnUnref(function(t){if(null!=a.mediaKeysManager.getKeyMetadata(t.data)&&!r)return"continue";var e=(r?lt.Promise.resolve(!0):a.shouldApplyInitData(t.data,n)).then(freeOnUnref(function(e){if(n.throwIfRequested(),e)return i.applyInitData(t.type,t.data,n)}));o.push(e)}),a=this,s=0,l=e;s<l.length;s++){t(l[s])}return lt.Promise.all(o)}),e.prototype.getInitializationData=freeOnUnref(function(){return this.initializationDataGenerator.getInitializationData().map(freeOnUnref(function(e){return{type:"cenc",data:e}}))}),e.prototype.getOldDuplicateLicenseMetadata=freeOnUnref(function(){for(var n=[],e=freeOnUnref(function(e){var t=r.licenseMetadataItems[e];e!==x.findLastIndex(r.licenseMetadataItems,freeOnUnref(function(e){return e.keyId===t.keyId}))&&null!=t.sessionId&&n.push(t)}),r=this,t=0;t<this.licenseMetadataItems.length;t++)e(t);return n}),e.prototype.handleFatalError=freeOnUnref(function(e){u.warn("Download "+this.downloadOperationId+" encountered a fatal error: "+e);var t=this.convertError(e);this.deferredLoad.reject(t),this.onError(t),this.unload()}),e.prototype.loadPersistentLicenseMetadata=freeOnUnref(function(n){var r=this;return Jo.metadataStorage.get(jc.createPersistentLicenseMetadataKey(this.downloadOperationId)).then(freeOnUnref(function(e){if(n.throwIfRequested(),null!=e){var t=e;r.licenseMetadataItems=t.metadataList,u.info("Loaded license metadata list: "+JSON.stringify(r.licenseMetadataItems))}})).catch(freeOnUnref(function(e){if(!(e instanceof lt.CancelError))throw u.error("Failed to load persistent license metadata",e),e}))}),e.prototype.removeTrackedOldLicenses=freeOnUnref(function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];t.push(this.mediaKeysManager.removePersistentLicense(i.sessionId))}for(var o=[],a=freeOnUnref(function(t){-1===x.findIndex(e,freeOnUnref(function(e){return e.sessionId===t.sessionId}))&&o.push(t)}),s=0,l=this.licenseMetadataItems;s<l.length;s++){a(l[s])}u.info("Removing "+e.length+" old licenses, count of licenseMetadataItems changed from "+this.licenseMetadataItems.length+" to "+o.length),this.licenseMetadataItems=o;var f=this.createPersistentLicenseMetadata();return null!=f&&t.push(Jo.metadataStorage.put(jc.createPersistentLicenseMetadataKey(this.downloadOperationId),f)),lt.Promise.all(t).then(freeOnUnref(function(){}))}),e.prototype.shouldApplyInitData=freeOnUnref(function(e,n){var r=this;return this.mediaKeysManager.extractKeyId(e).then(freeOnUnref(function(t){return n.throwIfRequested(),x.findIndex(r.licenseMetadataItems,freeOnUnref(function(e){return e.keyId===t}))<0})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;return!0}))}),e.prototype.updateLicenseMetadataItems=freeOnUnref(function(t,e){var n=x.findLastIndex(this.licenseMetadataItems,freeOnUnref(function(e){return e.keyId===t}));return n<0?(u.info("None of existing license metadata items match the keyId:",t),!1):!!e.some(freeOnUnref(function(e){return"CONTENT"===e.keyType}))&&(u.info("Updating license metadata for keyId: "+t+": "+JSON.stringify(e)),this.licenseMetadataItems[n].keyMetadata=e,!0)}),e.prototype.createPersistentLicenseMetadata=freeOnUnref(function(){for(var e={metadataList:[]},t=0,n=this.licenseMetadataItems;t<n.length;t++){var r=n[t];null!=r.keyMetadata&&e.metadataList.push(r)}return 0===e.metadataList.length?null:e}),e})();t.LicenseManager=n}));e(dd);dd.LicenseManager;var pd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.primaryChunkIndex={},this.fallbackChunkIndexPromise=null,this.storagePromise=lt.Promise.resolve(),this.downloadOperationId=e}return e.prototype.initialize=freeOnUnref(function(){var t=this;return Pt.localStorage.getText(jc.createDownloadOperationChunkIndexKey(this.downloadOperationId)).then(freeOnUnref(function(e){null!=e&&(t.primaryChunkIndex=JSON.parse(e))})).catch(freeOnUnref(function(e){throw new Error("Failed to retrieve chunk index file: "+e)}))}),e.prototype.uninitialize=freeOnUnref(function(){this.primaryChunkIndex={},this.fallbackChunkIndexPromise=null,this.storagePromise=lt.Promise.resolve()}),e.prototype.flush=freeOnUnref(function(){return this.storagePromise}),e.prototype.updateIndex=freeOnUnref(function(e,t,n,r){var i=this;return this.addByteOffset(this.primaryChunkIndex,e,t,n,r.start)?this.storagePromise=this.storagePromise.then(freeOnUnref(function(){return Pt.localStorage.put(jc.createDownloadOperationChunkIndexKey(i.downloadOperationId),JSON.stringify(i.primaryChunkIndex))})):lt.Promise.resolve()}),e.prototype.getSegmentFromChunk=freeOnUnref(function(t,n,r,i){var o=this,e=this.getSegmentLocation(this.primaryChunkIndex,t,n,r,i);return null==e?this.getSegmentFromFallbackIndex(t,n,r,i):Pt.localStorage.getArrayBuffer(e.chunkKey,e.byteRangeInChunk).then(freeOnUnref(function(e){return null!=e&&0<e.byteLength?e:o.getSegmentFromFallbackIndex(t,n,r,i)}))}),e.prototype.getSegmentFromFallbackIndex=freeOnUnref(function(n,r,i,o){var a=this;return this.getFallbackChunkIndex().then(freeOnUnref(function(e){var t=a.getSegmentLocation(e,n,r,i,o);return null==t?null:Pt.localStorage.getArrayBuffer(t.chunkKey,t.byteRangeInChunk)}))}),e.prototype.getFallbackChunkIndex=freeOnUnref(function(){var a=this;return null!=this.fallbackChunkIndexPromise||(this.fallbackChunkIndexPromise=Pt.localStorage.listKeys(jc.createDownloadOperationStoragePrefixKey(this.downloadOperationId)).then(freeOnUnref(function(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n],o=gf.getKeyPartsFromLocalStorageSegmentIdWithByteOffset(i);null!=o&&a.addByteOffset(t,o.periodId,o.streamId,o.qualityLevelId,o.byteOffset)}return t}))),this.fallbackChunkIndexPromise}),e.prototype.getSegmentLocation=freeOnUnref(function(e,t,n,r,i){var o=e[t];if(null==o)return null;var a=o[n];if(null==a)return null;var s=a[r];if(null==s||0===s.length||i.start<s[0])return null;var l=s[Pn.binarySearchIndexOfClosestBelow(s,freeOnUnref(function(e){return i.start-e}))];return{chunkKey:gf.createLocalStorageSegmentIdWithByteOffset(this.downloadOperationId,t,n,r,l),byteRangeInChunk:{start:i.start-l,end:i.end-l}}}),e.delete=freeOnUnref(function(e){return Pt.localStorage.remove(jc.createDownloadOperationChunkIndexKey(e))}),e.prototype.addByteOffset=freeOnUnref(function(e,t,n,r,i){null==e[t]&&(e[t]={});var o=e[t];null==o[n]&&(o[n]={});var a=o[n];null==a[r]&&(a[r]=[]);var s=a[r];if(0===s.length||i<s[0])return s.unshift(i),!0;var l=Pn.binarySearchIndexOfClosestBelow(s,freeOnUnref(function(e){return i-e}));return s[l]!==i&&(s.splice(l+1,0,i),!0)}),e})();t.MediaChunkIndex=n}));e(pd);pd.MediaChunkIndex;var hd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.chunkIndices={}}return e.getInstance=freeOnUnref(function(){return null==e.instance&&(e.instance=new e),e.instance}),e.prototype.getChunkIndex=freeOnUnref(function(e){if(null==this.chunkIndices[e]){var t=new pd.MediaChunkIndex(e);this.chunkIndices[e]={claimCount:0,chunkIndexPromise:t.initialize().then(freeOnUnref(function(){return t}))}}var n=this.chunkIndices[e];return n.claimCount++,n.chunkIndexPromise}),e.prototype.releaseChunkIndex=freeOnUnref(function(e){if(null!=this.chunkIndices[e]){var t=this.chunkIndices[e];t.claimCount--,0===t.claimCount&&this.removeEntry(e)}}),e.prototype.delete=freeOnUnref(function(e){return this.removeEntry(e),pd.MediaChunkIndex.delete(e)}),e.prototype.removeEntry=freeOnUnref(function(e){var t=this.chunkIndices[e];null!=t&&(t.chunkIndexPromise.then(freeOnUnref(function(e){return e.uninitialize()})),delete this.chunkIndices[e])}),e.instance=null,e})();t.MediaChunkIndexManager=n}));e(hd);hd.MediaChunkIndexManager;var md=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("ContentDownloaderFragment"),n=freeOnUnref(function(){function a(e,t,n,r,i,o,a,s,l){var f=this;this.onDownloadCompleted=freeOnUnref(function(){f.eventEmitter.emit("Completed")}),this.onDownloadError=freeOnUnref(function(e){f.eventEmitter.emit("Error",e)}),this.downloadOperationId=t,this.maxVideoBitrate=o,this.audioStreamMatchers=s,this.timedTextStreamMatchers=l,this.downloadProgress=new qc.AggregateDownloadProgress,this.downloadScheduler=new cd.DownloadScheduler(e,t,i,a,this.onDownloadCompleted,this.onDownloadError),this.downloadProgress.addDownloadProgress(this.downloadScheduler.getDownloadProgress()),this.downloadableStreamsSelector=new Hc.DownloadableStreamsSelector(i),this.eventEmitter=new A.EventEmitter,this.licenseManager=new dd.LicenseManager(n,this.onDownloadError,r,i,t),this.mediaChunkIndexManager=hd.MediaChunkIndexManager.getInstance(),this.selectionContextMetadataKey=jc.createSelectionContextKey(t)}return a.delete=freeOnUnref(function(t){return s.info(">> delete: removePrefix("+jc.createDownloadOperationStoragePrefixKey(t)+")"),Pt.localStorage.removePrefix(jc.createDownloadOperationStoragePrefixKey(t)).then(freeOnUnref(function(){return hd.MediaChunkIndexManager.getInstance().delete(t)})).then(freeOnUnref(function(){return a.deleteSelectionContext(t)})).then(freeOnUnref(function(){return Jo.metadataStorage.get(jc.createDownloadProgressMetadataKey(t))})).then(freeOnUnref(function(e){if(null!=e)return a.deleteProgressMetadata(t,e);s.warn("No progress metadata found for downloadOperationId",t)})).then(freeOnUnref(function(){return a.removeLicense(t)}))}),a.prototype.refresh=freeOnUnref(function(){return s.info(">> refresh"),this.licenseManager.refresh()}),a.prototype.start=freeOnUnref(function(){return s.info(">> start"),this.internalStart()}),a.prototype.stop=freeOnUnref(function(){return s.info(">> stop"),this.internalStop()}),a.prototype.getDownloadProgress=freeOnUnref(function(){return this.downloadProgress}),a.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),a.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),a.deleteProgressMetadata=freeOnUnref(function(e,t){s.info("Deleting quality level progress metadata",JSON.stringify(t.qualityLevelKeys));var n=t.qualityLevelKeys.map(freeOnUnref(function(e){return Jo.metadataStorage.remove(e)}));return lt.Promise.all(n).then(freeOnUnref(function(){return Jo.metadataStorage.remove(jc.createDownloadProgressMetadataKey(e))}))}),a.deleteSelectionContext=freeOnUnref(function(e){return Jo.metadataStorage.remove(jc.createSelectionContextKey(e))}),a.prototype.internalStart=freeOnUnref(function(){var t=this,e=this.downloadableStreamsSelector.selectDownloadableStreams(this.maxVideoBitrate,this.audioStreamMatchers,this.timedTextStreamMatchers);this.eventEmitter.emit("DownloadableTracksAvailable",e.availableTracks);var n=e.selectionContext;return this.storeSelectionContext(n).then(freeOnUnref(function(){return t.mediaChunkIndexManager.getChunkIndex(t.downloadOperationId)})).then(freeOnUnref(function(e){return t.downloadScheduler.initialize(e,n)})).then(freeOnUnref(function(){return t.licenseManager.load()})).then(freeOnUnref(function(){t.downloadScheduler.start()}))}),a.prototype.internalStop=freeOnUnref(function(){var e=this;return this.licenseManager.unload(),this.downloadScheduler.stop().then(freeOnUnref(function(){return e.mediaChunkIndexManager.releaseChunkIndex(e.downloadOperationId)}))}),a.removeLicense=freeOnUnref(function(t){var o=jc.createPersistentLicenseMetadataKey(t);return Jo.metadataStorage.get(o).then(freeOnUnref(function(e){if(null!=e&&null!=a.mediaKeysManager){var t=e;s.info("Removing "+t.metadataList.length+" persistent sessions");for(var n=freeOnUnref(function(e){var t=e.sessionId;a.licenseRemovalPromise=a.licenseRemovalPromise.then(freeOnUnref(function(){return a.mediaKeysManager.removePersistentLicense(t)}))}),r=0,i=t.metadataList;r<i.length;r++){n(i[r])}return a.licenseRemovalPromise.then(freeOnUnref(function(){return Jo.metadataStorage.remove(o)}))}})).catch(freeOnUnref(function(e){s.error("Fail to remove license of "+t,e)}))}),a.prototype.storeSelectionContext=freeOnUnref(function(e){return Jo.metadataStorage.put(this.selectionContextMetadataKey,e)}),a.mediaKeysManager=null,a.licenseRemovalPromise=lt.Promise.resolve(),a})();t.ContentDownloaderFragment=n}));e(md);md.ContentDownloaderFragment;var yd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ContentDownloaderFragment=md.ContentDownloaderFragment,t.createDownloadOperationStoragePrefixKey=jc.createDownloadOperationStoragePrefixKey,t.createDownloadProgressMetadataKey=jc.createDownloadProgressMetadataKey,t.createPersistentLicenseMetadataKey=jc.createPersistentLicenseMetadataKey,t.createQualityLevelProgressMetadataKey=jc.createQualityLevelProgressMetadataKey,t.createSelectionContextKey=jc.createSelectionContextKey,t.DownloadableStreamsSelector=Hc.DownloadableStreamsSelector,t.MediaChunkIndex=pd.MediaChunkIndex,t.MediaChunkIndexManager=hd.MediaChunkIndexManager}));e(yd);yd.ContentDownloaderFragment,yd.createDownloadOperationStoragePrefixKey,yd.createDownloadProgressMetadataKey,yd.createPersistentLicenseMetadataKey,yd.createQualityLevelProgressMetadataKey,yd.createSelectionContextKey,yd.DownloadableStreamsSelector,yd.MediaChunkIndex,yd.MediaChunkIndexManager;var gd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("LocalSegmentIndexAccessor"),n=freeOnUnref(function(){function e(e,t,n){this.representationInfo=e,this.storageContext=t,this.parseSIDXCallback=n;var r=Pt.localStorage.capabilities.isSupported&&Jo.metadataStorage.capabilities.isSupported;this.shouldReadStorage=1==(1&t.storageAccess)&&r,this.shouldWriteStorage=2==(2&t.storageAccess)&&r}return e.prototype.retrieveLocalSegmentIndex=freeOnUnref(function(e,t){var n=this;if(!this.shouldReadStorage||null==this.storageContext.downloadOperationId)return lt.Promise.resolve(null);var r=this.storageContext.downloadOperationId,i=this.convertToMediaRepresentationByteRange(t),o=gf.createLocalStorageSegmentIdWithByteOffset(r,this.representationInfo.periodId,this.representationInfo.adaptationSetId,this.representationInfo.representation.id,null!=i?i.start:void 0,"sidx");return this.checkForCacheFeatureDataAvailability(r).then(freeOnUnref(function(e){return!!e||n.checkForDownloadDataAvailability(r)})).then(freeOnUnref(function(e){return e?(a.info("LocalStorage: Retrieve sidx, segmentId: "+o+", downloadOperationId: "+n.storageContext.downloadOperationId),Pt.localStorage.getArrayBuffer(o)):null})).then(freeOnUnref(function(e){if(null==e)return a.info("LocalStorage: Retrieve sidx invalid (missing or failed fetch), segmentId: "+o+", downloadOperationId: "+n.storageContext.downloadOperationId),null;var t=n.parseSIDXCallback(e);return a.info("LocalStorage: Retrieve sidx success, segmentId: "+o+", size: "+t.size+", downloadOperationId: "+n.storageContext.downloadOperationId),t})).catch(freeOnUnref(function(e){return a.error("LocalStorage: Retrieve sidx failed, segmentId: "+o+", error: "+e.message+", downloadOperationId: "+n.storageContext.downloadOperationId),null}))}),e.prototype.checkForCacheFeatureDataAvailability=freeOnUnref(function(e){var t=this,n=vu.createCachedSelectionContextKey(e);return Jo.metadataStorage.get(n).then(freeOnUnref(function(e){if(null==e)return a.info("LocalStorage: No CacheFeature metadata found during sidx validation, key: "+n),!1;return null!=e&&null!=e[t.representationInfo.periodId]||(a.info("LocalStorage: No CacheFeature metadata found for period during sidx validation, key: "+n+", period: "+t.representationInfo.periodId),!1)})).catch(freeOnUnref(function(e){return a.error("LocalStorage: error validating metadata, key: "+n+", error: "+e.message),!1}))}),e.prototype.checkForDownloadDataAvailability=freeOnUnref(function(e){var t=yd.createQualityLevelProgressMetadataKey(e,this.representationInfo.periodId,this.representationInfo.adaptationSetId,this.representationInfo.representation.id);return Jo.metadataStorage.get(t).then(freeOnUnref(function(e){return null!=e})).catch(freeOnUnref(function(e){return a.error("Fail to retrieve quality level metadata "+t+", with error:",e),!1}))}),e.prototype.storeLocalSegmentIndexBinary=freeOnUnref(function(e,t,n){var r=this;if(!this.shouldWriteStorage||null==this.storageContext.downloadOperationId)return lt.Promise.resolve();var i=this.convertToMediaRepresentationByteRange(n),o=gf.createLocalStorageSegmentIdWithByteOffset(this.storageContext.downloadOperationId,this.representationInfo.periodId,this.representationInfo.adaptationSetId,this.representationInfo.representation.id,null!=i?i.start:void 0,"sidx");return a.info("LocalStorage: Store sidx, size: "+e.byteLength+", segmentId: "+o+", downloadOperationId: "+this.storageContext.downloadOperationId),Pt.localStorage.put(o,e).catch(freeOnUnref(function(e){var t="Fail to store segment index binary data "+o;throw a.error("LocalStorage: Store sidx failed, error: "+e.message+", segmentId: "+o+", downloadOperationId: "+r.storageContext.downloadOperationId),new ct.XpError("storage.manifest.sidx",void 0,t,!1,e)}))}),e.prototype.reset=freeOnUnref(function(e){this.representationInfo=e}),e.prototype.convertToMediaRepresentationByteRange=freeOnUnref(function(e){return null!=e?{start:e.start,end:null!=e.end?e.end:1/0}:void 0}),e})();t.LocalSegmentIndexAccessor=n}));e(gd);gd.LocalSegmentIndexAccessor;var vd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("SegmentIndexTimeoutCalculator"),n=freeOnUnref(function(){function e(){this.networkRequestManager=_c.getInstance()}return e.prototype.calculateTimeoutMs=freeOnUnref(function(e){if(null==e)return 6e3;if(null==e.start||null==e.end)return 6e3;var t=this.networkRequestManager.getNetworkStatistics(),n=t.bandwidthAvgKbps,r=t.latencyAvgMs;if(null===n||null===r)return o.info("Empty network statistics: bandwidthAvgKbps="+n+", latencyAvgMs="+r+". Using SIDX default timeout"),6e3;if(0===n)return o.info("bandwidthAvgKbps=0, Using SIDX default timeout"),6e3;var i=e.end-e.start+1;return Math.round(8*i/n)+r+2e3}),e})();t.SegmentIndexTimeoutCalculator=n}));e(vd);vd.SegmentIndexTimeoutCalculator;var Od=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.delay=function(r,i){return new lt.Promise(freeOnUnref(function(e,t){var n=oe.timer.setTimeout(e,r);i.promise.then(freeOnUnref(function(e){oe.timer.clearTimeout(n),t(e)}))}))}}));e(Od);Od.delay;var Sd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("SegmentIndexAcquirer"),n=freeOnUnref(function(){function e(e,t,n,r){var f=this;this.refreshIndex=freeOnUnref(function(){if(null!=f.acquisitionPromise)return f.acquisitionPromise;var e=lt.CancelToken.source(),t=e.token,n=e.cancel;return f.acquisitionPromise=f.acquireIndexWithRetries(t),f.acquisitionCancel=n,f.acquisitionPromise}),this.acquireIndexWithRetries=freeOnUnref(function(t){return new lt.Promise(freeOnUnref(function(o,a){var s=null;t.promise.then(freeOnUnref(function(){null!=s&&(s(),s=null)}));var l=freeOnUnref(function(){var e,t;e=lt.CancelToken.source(),t=e.token,s=e.cancel;var n=f.segmentBaseInformation.index,r=f.urlResolver.resolveSourceUrl(n.sourceUrl),i=n.range;null!=i&&(r.headers.Range="bytes="+i.start+"-"+i.end),f.acquireSegmentIndex(t,r,i).then(o).catch(freeOnUnref(function(e){return t.throwIfRequested(),e instanceof _c.AcquisitionError?f.sourceUrlStore.resourceAcquisitionFailed(e.reason,Ac.AcquisitionResourceType.Manifest,r.url,r.urlId):u.warn("Manifest.DASH.SIDX.Error:",e),Od.delay(500,t).then(freeOnUnref(function(){t.throwIfRequested(),l()}))})).catch(a)});l()})).then(freeOnUnref(function(e){return t.throwIfRequested(),f.element={valid:!0,onChange:freeOnUnref(function(){}),contents:e},f.acquisitionPromise=null,e}))}),this.parseSIDX=freeOnUnref(function(e){var t,n=new Ao.BmffParser,r=Date.now();try{t=n.parseFragment(e)}catch(e){throw new _c.AcquisitionError({type:"ParseError",cause:e})}var i=Ao.Boxes.find(t,Ao.Boxes.ofType("sidx"));if(null==i)throw new _c.AcquisitionError({type:"ParseError",cause:new Error("Acquired data does not contain an SIDX box")});return q.metrics.putMetric("Manifest.DASH.SIDX.Parse",Date.now()-r,"ms"),i}),this.resourceAcquirer=e.resourceAcquirer,this.sourceUrlStore=e.sourceUrlStore,this.urlResolver=t,this.segmentBaseInformation=n,this.representationInfo=r,this.acquisitionPromise=null,this.acquisitionCancel=null,this.localSegmentIndexAccessor=new gd.LocalSegmentIndexAccessor(r,e.storageContext,this.parseSIDX),this.element={valid:!1,onChange:freeOnUnref(function(){}),refresh:this.refreshIndex},this.segmentIndexTimeoutCalculator=new vd.SegmentIndexTimeoutCalculator}return e.prototype.get=freeOnUnref(function(){return this.element}),e.prototype.clear=freeOnUnref(function(){null!=this.acquisitionCancel&&this.acquisitionCancel(),this.element={valid:!1,onChange:freeOnUnref(function(){}),refresh:this.refreshIndex},this.acquisitionPromise=null,this.acquisitionCancel=null}),e.prototype.acquireSegmentIndex=freeOnUnref(function(t,n,r){var i=this;return this.localSegmentIndexAccessor.retrieveLocalSegmentIndex(t,r).then(freeOnUnref(function(e){return t.throwIfRequested(),null!=e?e:i.acquireRemoteSegmentIndexAndProcess(n,t,r)}))}),e.prototype.acquireRemoteSegmentIndexAndProcess=freeOnUnref(function(e,o,a){var t,s,l=this,n=this.segmentIndexTimeoutCalculator.calculateTimeoutMs(a),r=((t={}).amznDtid=zt.deviceInformation.hardware.deviceTypeId,t),f=this.representationInfo,i=f.periodId+"."+f.adaptationSetId+"."+f.representation.id+".sidx";return this.resourceAcquirer.acquire("binary",e,n,0,!1,o,r,void 0,i).then(freeOnUnref(function(e){if(o.throwIfRequested(),q.metrics.putMetric("Manifest.DASH.SIDX.Download.TransferTime",e.timing.downloadMs,"ms"),q.metrics.putMetric("Manifest.DASH.SIDX.Download.Latency",e.timing.latencyMs,"ms"),u.enabledFor(de.DEBUG)){var t=new Date,n={type:f.streamType+": SIDX",startTime:new Date(t.getTime()-e.timing.totalMs).toISOString(),loadTime:new Date(t.getTime()-e.timing.latencyMs).toISOString(),endTime:t.toISOString(),latencyMs:e.timing.latencyMs,index:"SIDX",sizeBytes:e.totalBytes,bitrate:f.representation.bandwidth,url:e.sourceUrl.url};u.info(JSON.stringify(n))}var r=e.body,i=l.parseSIDXResource(e);return s=i.body,l.sourceUrlStore.resourceAcquired(i),l.localSegmentIndexAccessor.storeLocalSegmentIndexBinary(r,o,a)})).then(freeOnUnref(function(){return s}))}),e.prototype.parseSIDXResource=freeOnUnref(function(e){var t=this.parseSIDX(e.body),n=e;return n.body=t,n}),e})();t.SegmentIndexAcquirer=n}));e(Sd);Sd.SegmentIndexAcquirer;var Ud=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.waitForSegmentInTimeline=freeOnUnref(function(e){var n=this;return freeOnUnref(function(){return e.load().then(function(e){if("RefreshMe"===e.type)return{type:"Unavailable",reason:"Loop of refreshes found!"};var t=n.resolveSegment(e);return"RefreshMe"!==t.type?t:{type:"Unavailable",reason:"Pending on MPD update"}})})}),e})();t.SegmentResponder=n}));e(Ud);Ud.SegmentResponder;var bd=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(o){function e(e,t,n,r){var i=o.call(this)||this;return i.type="SegmentBase",i.segmentBases=[],i.segmentBaseInformation=new Vc.SegmentBaseInformation(n),i.segmentIndexAcquirer=new Sd.SegmentIndexAcquirer(t,n,i.segmentBaseInformation,r),i.parentSegmentTimeline=e,i.urlResolver=n,i.representationInfo=r,i.reset(r),i}return n(e,o),e.prototype.destroy=freeOnUnref(function(){this.segmentIndexAcquirer.clear()}),e.prototype.getInitSegment=freeOnUnref(function(){for(var e=void 0,t=0,n=this.segmentBases;t<n.length;t++){var r=n[t];if(null!=r.initialization){e=r.initialization;break}}return null==e?{type:"Unavailable",reason:"No SegmentList had any Initialization element"}:{type:"WellKnown",segment:{isInitSegment:!0,sourceUrl:this.urlResolver.resolveSourceUrl(e.sourceUrl),byteRange:e.range}}}),e.prototype.resolveSegment=freeOnUnref(function(e){if("Unavailable"===e.type)return{type:"Unavailable",reason:"No segment found in index!"};if("RefreshMe"===e.type)return{type:"RefreshMe",load:this.waitForSegmentInTimeline(e)};var t=this.segmentIndexAcquirer.get();if(!t.valid)throw new Error("Segment index disappeared!");var n=t.contents,r=n.references[e.index],i={isInitSegment:!1,index:e.segmentNumber,isFinalSegment:e.isFinalSegment,position:{startTimeMs:e.startMs,durationMs:e.durationMs,endTimeMs:e.endMs},sourceUrl:this.urlResolver.resolveSourceUrl(),byteRange:{start:this.segmentBaseInformation.byteRangeOffset+n.firstOffset+r.referencedOffset,end:this.segmentBaseInformation.byteRangeOffset+n.firstOffset+r.referencedOffset+r.referencedSize-1},rawData:{type:"dash-raw",timescale:e.timescale,startTicks:e.startTicks},origin:this.parentSegmentTimeline};return{type:e.type,segment:i}}),e.prototype.reset=freeOnUnref(function(e){this.representationInfo=e,this.segmentBases=[];for(var t=0,n=[e.period,e.adaptationSet,e.representation];t<n.length;t++){var r=n[t];null!=r.segmentBase&&this.segmentBases.unshift(r.segmentBase)}this.segmentBaseInformation.reset(this.segmentBases),this.segmentIndexAcquirer.clear()}),e})(Ud.SegmentResponder);t.SegmentBaseSegmentResponder=r}));e(bd);bd.SegmentBaseSegmentResponder;var Pd=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(e,t,n){var r=i.call(this)||this;return r.type="SegmentList",r.segmentLists=[],r.parentSegmentTimeline=e,r.urlResolver=t,r.representationInfo=n,r.reset(n),r}return n(e,i),e.prototype.destroy=freeOnUnref(function(){}),e.prototype.reset=freeOnUnref(function(e){this.representationInfo=e,this.segmentLists=[];for(var t=0,n=[e.period,e.adaptationSet,e.representation];t<n.length;t++){var r=n[t];null!=r.segmentList&&this.segmentLists.push(r.segmentList)}}),e.prototype.getInitSegment=freeOnUnref(function(){for(var e=void 0,t=0,n=this.segmentLists;t<n.length;t++){var r=n[t];null!=r.initialization&&(e=r.initialization)}return null==e?{type:"Unavailable",reason:"No SegmentList had any Initialization element"}:{type:"WellKnown",segment:{isInitSegment:!0,sourceUrl:this.urlResolver.resolveSourceUrl(e.sourceUrl),byteRange:e.range}}}),e.prototype.resolveSegment=freeOnUnref(function(e){if("Unavailable"===e.type)return{type:"Unavailable",reason:"No segment found in timeline!"};if("RefreshMe"===e.type)return{type:"RefreshMe",load:this.waitForSegmentInTimeline(e)};for(var t=void 0,n=0,r=this.segmentLists;n<r.length;n++){var i=r[n];0<i.segmentURLs.length&&(t=i.segmentURLs)}if(null==t)return{type:"Unavailable",reason:"No SegmentList had any SegmentURL elements"};var o=t[e.index],a={isInitSegment:!1,index:e.segmentNumber,isFinalSegment:e.isFinalSegment,position:{startTimeMs:e.startMs,durationMs:e.durationMs,endTimeMs:e.endMs},sourceUrl:this.urlResolver.resolveSourceUrl(o.media),byteRange:o.mediaRange,origin:this.parentSegmentTimeline};return{type:e.type,segment:a}}),e})(Ud.SegmentResponder);t.SegmentListSegmentResponder=r}));e(Pd);Pd.SegmentListSegmentResponder;var Md=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.isInitSegment=!1,this.index=e.segmentNumber,this.isFinalSegment=e.isFinalSegment,this.position={startTimeMs:e.startMs,durationMs:e.durationMs,endTimeMs:e.endMs},this.origin=t,this.resolveSourceUrl=n,this.cachedSourceUrl=null,this.rawData={type:"dash-raw",timescale:e.timescale,startTicks:e.startTicks}}return Object.defineProperty(e.prototype,"sourceUrl",{get:freeOnUnref(function(){return null==this.cachedSourceUrl&&(this.cachedSourceUrl=this.resolveSourceUrl()),this.cachedSourceUrl}),enumerable:!0,configurable:!0}),e})();t.DashMediaSegmentInfoDeferredSourceUrl=n}));e(Md);Md.DashMediaSegmentInfoDeferredSourceUrl;var Cd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function f(){}return f.resolve=freeOnUnref(function(e,t){for(var n=[],r=0;;){var i=e.indexOf("$",r);if(-1===i){n.push(e.substring(r));break}n.push(e.substring(r,i));var o=e.indexOf("$",i+1),a=e.substring(i+1,o),s=0,l=a.indexOf("%");-1!==l&&(s=parseInt(a.substring(l+2,a.length-1)),a=a.substring(0,l)),""===a?n.push("$"):n.push(f.leftPadWithZero(""+t[a],s)),r=o+1}return n.join("")}),f.leftPadWithZero=freeOnUnref(function(e,t){var n=t-e.length;if(n<=0)return e;for(var r=[];0<n;n--)r.push("0");return r.push(e),r.join("")}),f})();t.TemplateUrlResolver=n}));e(Cd);Cd.TemplateUrlResolver;var Ed=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(o){function e(e,t,n,r){var i=o.call(this)||this;return i.type="SegmentTemplate",i.segmentTemplates=[],i.parentSegmentTimeline=e,i.urlResolver=t,i.mpdAcquirer=n,i.representationInfo=r,i.reset(r),i}return n(e,o),e.prototype.destroy=freeOnUnref(function(){}),e.prototype.reset=freeOnUnref(function(e){this.representationInfo=e,this.segmentTemplates=[];for(var t=0,n=[e.period,e.adaptationSet,e.representation];t<n.length;t++){var r=n[t];null!=r.segmentTemplate&&this.segmentTemplates.push(r.segmentTemplate)}}),e.prototype.getInitSegment=freeOnUnref(function(){for(var e=this,t=void 0,n=0,r=this.segmentTemplates;n<r.length;n++){var i=r[n];null!=i.initializationTemplate&&(t=i.initializationTemplate)}if(null==t)return{type:"Unavailable",reason:"No SegmentTemplate had an init template attribute"};if(this.mpdAcquirer.shouldSuspendSegmentQuery())return{type:"RefreshMe",load:this.waitForMpdUpdate(freeOnUnref(function(){return e.getInitSegment()}))};var o=Cd.TemplateUrlResolver.resolve(t,{RepresentationID:this.representationInfo.representation.id,Bandwidth:this.representationInfo.representation.bandwidth});return{type:"WellKnown",segment:{isInitSegment:!0,sourceUrl:this.urlResolver.resolveSourceUrl(o)}}}),e.prototype.resolveSegment=freeOnUnref(function(e){var t=this;if("Unavailable"===e.type)return{type:"Unavailable",reason:Qe.withDefault(e.reason,"No segment found in timeline!"),etaMs:e.etaMs};if("RefreshMe"===e.type)return{type:"RefreshMe",load:this.waitForSegmentInTimeline(e)};if(this.mpdAcquirer.shouldSuspendSegmentQuery())return{type:"RefreshMe",load:this.waitForMpdUpdate(freeOnUnref(function(){return t.resolveSegment(e)}))};for(var n=void 0,r=0,i=this.segmentTemplates;r<i.length;r++){var o=i[r];null!=o.mediaTemplate&&(n=o.mediaTemplate)}if(null==n)return{type:"Unavailable",reason:"No SegmentTemplate had a media template attribute"};var a=Cd.TemplateUrlResolver.resolve(n,{Number:e.segmentNumber,RepresentationID:this.representationInfo.representation.id,Bandwidth:this.representationInfo.representation.bandwidth,Time:e.startTicks}),s=this.urlResolver,l=new Md.DashMediaSegmentInfoDeferredSourceUrl(e,this.parentSegmentTimeline,freeOnUnref(function(){return s.resolveSourceUrl(a)}));return{type:e.type,segment:l}}),e.prototype.waitForMpdUpdate=freeOnUnref(function(t){var e=this;return freeOnUnref(function(){return e.mpdAcquirer.waitUpdate().then(function(){var e=t();return"RefreshMe"!==e.type?e:{type:"Unavailable",reason:"Loop of MPD update found!"}})})}),e})(Ud.SegmentResponder);t.SegmentTemplateSegmentResponder=r}));e(Ed);Ed.SegmentTemplateSegmentResponder;var Td=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.create=freeOnUnref(function(e,t,n,r){for(var i=0,o=[r.period,r.adaptationSet,r.representation];i<o.length;i++){var a=o[i];if(null!=a.segmentList)return new Pd.SegmentListSegmentResponder(e,n,r);if(null!=a.segmentTemplate)return new Ed.SegmentTemplateSegmentResponder(e,n,t.mpdAcquirer,r);if(null!=a.segmentBase)return new bd.SegmentBaseSegmentResponder(e,t,n,r)}throw new Error("Invalid MPD found. Does not contain SegmentBase, SegmentList or SegmentTemplate at any level")}),e})();t.SegmentResponderFactory=n}));e(Td);Td.SegmentResponderFactory;var wd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.extractSegmentInfos=function(e){for(var t=[],n=0,r=[e.period,e.adaptationSet,e.representation];n<r.length;n++){var i=r[n];null!=i.segmentList?t.push(i.segmentList):null!=i.segmentTemplate&&t.push(i.segmentTemplate)}return t}}));e(wd);wd.extractSegmentInfos;var Id=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.segmentInfos=[],this.availabilityTimeOffsetMs=0,this.presentationTimeOffsetTicks=0,this.segmentDurationTicks=0,this.timescale=1,this.startNumber=1,this.timeWindow=t,this.mpdRefresher=e,this.representationInfo=n,this.reset(n)}return Object.defineProperty(e.prototype,"presentationTimeOffsetMs",{get:freeOnUnref(function(){return this.presentationTimeOffsetTicks/this.timescale*1e3}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentDurationMs",{get:freeOnUnref(function(){if(0!==this.segmentDurationTicks&&isFinite(this.segmentDurationTicks))return 1e3*this.segmentDurationTicks/this.timescale}),enumerable:!0,configurable:!0}),e.prototype.reset=freeOnUnref(function(e){this.representationInfo=e,this.segmentInfos=wd.extractSegmentInfos(e),this.timescale=1,this.presentationTimeOffsetTicks=0,this.startNumber=1;for(var t=0,n=this.segmentInfos;t<n.length;t++){var r=n[t];null!=r.availabilityTimeOffsetMs&&(this.availabilityTimeOffsetMs=r.availabilityTimeOffsetMs),null!=r.presentationTimeOffset&&(this.presentationTimeOffsetTicks=r.presentationTimeOffset),null!=r.timescale&&(this.timescale=r.timescale),null!=r.startNumber&&(this.startNumber=r.startNumber),null!=r.duration&&(this.segmentDurationTicks=r.duration)}}),e.prototype.querySegment=freeOnUnref(function(e){return this.resolveSegment(this.getIndexFromPosition(e))}),e.prototype.getSequenceNumberFromPosition=freeOnUnref(function(e){return this.startNumber+this.getIndexFromPosition(e)}),e.prototype.querySegmentBySequence=freeOnUnref(function(e){return this.resolveSegment(e-this.startNumber)}),e.prototype.queryNextSegment=freeOnUnref(function(e){if(e.isFinalSegment)return{type:"Unavailable",reason:"Segment "+e.index+" is the final segment of period "+this.representationInfo.periodId};var t=e.index-this.startNumber;return this.resolveSegment(t+1)}),e.prototype.getSequenceRange=freeOnUnref(function(){if(null==this.representationInfo.period.durationMs)return null;var e=this.getSequenceNumberFromPosition(this.representationInfo.period.durationMs);return{startSequence:this.startNumber,endSequence:e}}),e.prototype.getIndexFromPosition=freeOnUnref(function(e){return Math.floor((e/1e3*this.timescale+this.presentationTimeOffsetTicks)/this.segmentDurationTicks)}),e.prototype.resolveSegment=freeOnUnref(function(e){var t=this;if(0===this.segmentDurationTicks||!isFinite(this.segmentDurationTicks))return{type:"Unavailable",reason:"The segment duration "+this.segmentDurationTicks+"ms is unable to be used for interpolation."};if(e<0)return{type:"Unavailable",reason:"Segment "+(e+this.startNumber)+" is prior to the range of available sequences (["+this.startNumber+", ...]) in period "+this.representationInfo.period.id};var n=e*this.segmentDurationTicks-this.presentationTimeOffsetTicks,r=1e3*n/this.timescale,i=1e3*(n+this.segmentDurationTicks)/this.timescale,o=this.representationInfo.period.durationMs;if(i<=1||null!=o&&o<=r+1)return{type:"Unavailable",reason:"Position ["+r+","+i+"]ms is out of bounds for period "+this.representationInfo.periodId+": [0,"+o+"]"};var a=this.representationInfo.period.startMs+i-this.availabilityTimeOffsetMs;if(a<this.timeWindow.startMs||a>this.timeWindow.endMs){var s=this.representationInfo.period.startMs+r-this.availabilityTimeOffsetMs,l=a>this.timeWindow.endMs?this.timeWindow.getSegmentEtaMs(s,1e3*this.segmentDurationTicks/this.timescale):void 0;return 0===l?{type:"RefreshMe",load:freeOnUnref(function(){return t.mpdRefresher.waitRefresh().then(freeOnUnref(function(){return t.resolveSegment(e)}))})}:{type:"Unavailable",etaMs:l,reason:"MPD position ["+(this.representationInfo.period.startMs+r)+", "+(this.representationInfo.period.startMs+i)+"]ms (for period-relative position ["+r+", "+i+"]ms on period "+this.representationInfo.periodId+") is outside of the time window ["+this.timeWindow.startMs+", "+this.timeWindow.endMs+"], with availabilityOffset: "+this.availabilityTimeOffsetMs+"ms"}}return{type:"Inferred",segmentNumber:this.startNumber+e,startMs:r,durationMs:1e3*this.segmentDurationTicks/this.timescale,endMs:i,isFinalSegment:null!=o&&o-1<=i,startTicks:n,timescale:this.timescale,index:e}}),e})();t.InterpolatedTimelineResponder=n}));e(Id);Id.InterpolatedTimelineResponder;var kd=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var s=((n={}).Audio=1,n.Image=1,n.TimedText=1,n.Video=15,n),l=de.get("SegmentBaseTimelineResponder"),r=freeOnUnref(function(){function e(e,t){this.presentationTimeOffsetTicks=0,this.timescale=1,this.indexAcquirer=e,this.representationInfo=t,this.reset(t)}return Object.defineProperty(e.prototype,"presentationTimeOffsetMs",{get:freeOnUnref(function(){return this.presentationTimeOffsetTicks/this.timescale*1e3}),enumerable:!0,configurable:!0}),e.prototype.querySegment=freeOnUnref(function(t,n){var r=this;if(void 0===n&&(n=0),t<0||t>this.representationInfo.period.durationMs)return{type:"Unavailable"};var e=this.indexAcquirer.get();return e.valid?this.querySegmentOnIndex(e.contents,t,n):{type:"RefreshMe",load:freeOnUnref(function(){return e.refresh().then(freeOnUnref(function(e){return r.querySegmentOnIndex(e,t,n)}))})}}),e.prototype.querySegmentBySequence=freeOnUnref(function(t){var n=this;if(t<0)return{type:"Unavailable"};var e=this.indexAcquirer.get();return e.valid?this.querySegmentBySequenceOnIndex(e.contents,t):{type:"RefreshMe",load:freeOnUnref(function(){return e.refresh().then(freeOnUnref(function(e){return n.querySegmentBySequenceOnIndex(e,t)}))})}}),e.prototype.queryNextSegment=freeOnUnref(function(t){var n=this,e=this.indexAcquirer.get();return e.valid?this.queryNextSegmentOnIndex(e.contents,t):{type:"RefreshMe",load:freeOnUnref(function(){return e.refresh().then(freeOnUnref(function(e){return n.queryNextSegmentOnIndex(e,t)}))})}}),e.prototype.getSequenceRange=freeOnUnref(function(){return null}),e.prototype.getSequenceNumberFromPosition=freeOnUnref(function(e){return null}),e.prototype.querySegmentBySequenceOnIndex=freeOnUnref(function(e,t){return t>=e.references.length?{type:"Unavailable"}:this.convertReference(e,t)}),e.prototype.querySegmentOnIndex=freeOnUnref(function(e,t,n){n=Math.max(1,Math.min(n,this.representationInfo.period.durationMs-t));var r=Math.floor(t*this.timescale/1e3+this.presentationTimeOffsetTicks-e.earliestPresentationTime),i=Math.floor((t+n)*this.timescale/1e3+this.presentationTimeOffsetTicks-e.earliestPresentationTime),o=Pn.binarySearchIndexOf(e.references,freeOnUnref(function(e){return e.subsegmentPosition>i?-1:e.subsegmentPosition+e.subsegmentDuration<=i?1:0}));if(0<=o)return this.convertReference(e,o);var a=e.references.length-1,s=e.references[a];return r<=s.subsegmentPosition+s.subsegmentDuration?this.convertReference(e,a):{type:"Unavailable"}}),e.prototype.queryNextSegmentOnIndex=freeOnUnref(function(e,t){return t.index+1>=e.referenceCount?{type:"Unavailable"}:this.convertReference(e,t.index+1)}),e.prototype.convertReference=freeOnUnref(function(e,t){var n=e.references[t],r=e.earliestPresentationTime+n.subsegmentPosition,i=1e3*(r-this.presentationTimeOffsetTicks)/this.timescale,o=1e3*(r+n.subsegmentDuration-this.presentationTimeOffsetTicks)/this.timescale;if(o<=s[this.representationInfo.streamType]||i>=this.representationInfo.period.durationMs-s[this.representationInfo.streamType])return l.enabledFor(de.DEBUG)&&l.info("Segment "+t+": startTicks="+r+", endTicks="+(r+n.subsegmentDuration)+" for period "+this.representationInfo.periodId+" (duration="+this.representationInfo.period.durationMs+", presentationTimeOffset="+this.presentationTimeOffsetTicks+") has startMs="+i+" and endMs="+o+": Not available"),{type:"Unavailable"};var a={type:"WellKnown",segmentNumber:t,startMs:i,durationMs:1e3*n.subsegmentDuration/this.timescale,endMs:o,isFinalSegment:t===e.referenceCount-1||o>=this.representationInfo.period.durationMs-s[this.representationInfo.streamType],startTicks:r,timescale:this.timescale,index:t};return l.enabledFor(de.DEBUG)&&l.info("Segment "+t+": startTicks="+r+", endTicks="+(r+n.subsegmentDuration)+" for period "+this.representationInfo.periodId+" (duration="+this.representationInfo.period.durationMs+", presentationTimeOffset="+this.presentationTimeOffsetTicks+") has startMs="+i+" and endMs="+o+": is "+(a.isFinalSegment?"":"not ")+"final segment"),a}),e.prototype.reset=freeOnUnref(function(e){for(var t=0,n=[(this.representationInfo=e).period,e.adaptationSet,e.representation];t<n.length;t++){var r=n[t];if(null!=r.segmentBase){var i=r.segmentBase;null!=i.presentationTimeOffset&&(this.presentationTimeOffsetTicks=i.presentationTimeOffset),null!=i.timescale&&(this.timescale=i.timescale)}}}),e})();t.SegmentBaseTimelineResponder=r}));e(kd);kd.SegmentBaseTimelineResponder;var _d=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var b=de.get("SegmentTimelineTimelineResponder"),n=freeOnUnref(function(){function e(e,t,n){this.segmentTimelines=[],this.segmentInfos=[],this.presentationTimeOffsetTicks=0,this.timescale=1,this.startNumber=1,this.lastSegmentSequence=-1,this.earliestSegmentStartTicks=-1,this.lastSegmentEndTicks=-1,this.maxSegmentDurationMs=2e3,this.timeWindow=t,this.representationInfo=n,this.mpdRefresher=e,this.reset(n)}return Object.defineProperty(e.prototype,"presentationTimeOffsetMs",{get:freeOnUnref(function(){return this.presentationTimeOffsetTicks/this.timescale*1e3}),enumerable:!0,configurable:!0}),e.prototype.reset=freeOnUnref(function(e){this.representationInfo=e,this.segmentInfos=wd.extractSegmentInfos(e),this.segmentTimelines=[],this.timescale=1,this.presentationTimeOffsetTicks=0,this.startNumber=1;for(var t=0,n=this.segmentInfos;t<n.length;t++){var r=n[t];null!=r.segmentTimeline&&this.segmentTimelines.unshift(r.segmentTimeline),null!=r.presentationTimeOffset&&(this.presentationTimeOffsetTicks=r.presentationTimeOffset),null!=r.timescale&&(this.timescale=r.timescale),null!=r.startNumber&&(this.startNumber=r.startNumber)}var i=this.segmentTimelines[0].entries[0],o=this.segmentTimelines[0].entries[this.segmentTimelines[0].entries.length-1];this.lastSegmentSequence=this.startNumber+o.seq+("Pattern"===o.type?o.numSegments:1)*(o.r+1)-1,this.earliestSegmentStartTicks=i.t,this.lastSegmentEndTicks=o.t+(o.r+1)*o.d}),e.prototype.queryNextSegment=freeOnUnref(function(e){if(e.isFinalSegment){var t={type:"Unavailable",reason:"Segment "+e.index+" is the final segment of period "+this.representationInfo.period.id};return b.warn("["+this.representationInfo.period.id+"]["+this.representationInfo.adaptationSet.id+"]["+this.representationInfo.representation.id+"] queryNextSegment(): "+JSON.stringify(t)),t}var n=e.index+1;return this.querySegmentBySequence(n)}),e.prototype.querySegmentBySequence=freeOnUnref(function(e){var t=this,n=this.segmentTimelines[0];if(e<this.startNumber){var r={type:"Unavailable",reason:"Segment "+e+" is outside the range of available sequences (["+this.startNumber+", "+this.lastSegmentSequence+"]) in period "+this.representationInfo.period.id};return b.warn("["+this.representationInfo.period.id+"]["+this.representationInfo.adaptationSet.id+"]["+this.representationInfo.representation.id+"] querySegmentBySequence("+e+"): "+JSON.stringify(r)),r}if(e>this.lastSegmentSequence){var i=(this.lastSegmentEndTicks-this.presentationTimeOffsetTicks)/this.timescale*1e3+(e-this.lastSegmentSequence-1)*this.maxSegmentDurationMs,o=null!=this.representationInfo.period.durationMs&&isFinite(this.representationInfo.period.durationMs)?void 0:this.timeWindow.getSegmentEtaMs(this.representationInfo.period.startMs+i,this.maxSegmentDurationMs);if(0===o)return{type:"RefreshMe",load:freeOnUnref(function(){return t.mpdRefresher.waitRefresh().then(freeOnUnref(function(){return t.querySegmentBySequence(e)}))})};r={type:"Unavailable",etaMs:o,reason:"Segment "+e+" is outside the range of available sequences (["+this.startNumber+", "+this.lastSegmentSequence+"]) in period "+this.representationInfo.period.id};return null==o&&b.warn("["+this.representationInfo.period.id+"]["+this.representationInfo.adaptationSet.id+"]["+this.representationInfo.representation.id+"] querySegmentBySequence("+e+"): "+JSON.stringify(r)),r}var a,s=e-this.startNumber,l=Pn.binarySearchIndexOfClosestBelow(n.entries,freeOnUnref(function(e){return s-e.seq})),f=n.entries[l],u=0,c=0;if("S"===f.type)a=f;else{var d=Math.floor((s-f.seq)/f.numSegments);u=f.seq+d*f.numSegments,c=f.t+d*f.d;var p=s-u,h=Pn.binarySearchIndexOfClosestBelow(f.S,freeOnUnref(function(e){return p-e.seq}));a=f.S[h]}var m=s-(u+a.seq),y=c+a.t+m*a.d,g=y-this.presentationTimeOffsetTicks;return{type:"WellKnown",index:e-this.startNumber,segmentNumber:e,startTicks:y,startMs:g/this.timescale*1e3,durationMs:a.d/this.timescale*1e3,endMs:(g+a.d)/this.timescale*1e3,timescale:this.timescale,isFinalSegment:e===this.lastSegmentSequence&&null!=this.representationInfo.period.durationMs&&isFinite(this.representationInfo.period.durationMs)}}),e.prototype.querySegment=freeOnUnref(function(e,t){var n=this;void 0===t&&(t=0);var r=this.segmentTimelines[0];if(e<0||e>this.representationInfo.period.durationMs){var i={type:"Unavailable",reason:"Position "+e+"ms is out of bounds for period "+this.representationInfo.period.id+": [0,"+this.representationInfo.period.durationMs+"]"};return b.warn("["+this.representationInfo.period.id+"]["+this.representationInfo.adaptationSet.id+"]["+this.representationInfo.representation.id+"] querySegment("+e+", "+t+"): "+JSON.stringify(i)),i}var o=this.representationInfo.period.startMs+e;if(o<this.timeWindow.startMs||o>this.timeWindow.endMs){if(0===(l=o>this.timeWindow.endMs?this.timeWindow.getSegmentEtaMs(this.representationInfo.period.startMs+e,this.maxSegmentDurationMs):void 0))return{type:"RefreshMe",load:freeOnUnref(function(){return n.mpdRefresher.waitRefresh().then(freeOnUnref(function(){return n.querySegment(e,t)}))})};i={type:"Unavailable",etaMs:l,reason:"MPD position "+o+"ms (for period-relative position "+e+"ms on period "+this.representationInfo.period.id+") is outside of the time window ["+this.timeWindow.startMs+", "+this.timeWindow.endMs+"] (TimeWindow debug: "+this.timeWindow.debug()+")"};return null==l&&b.warn("["+this.representationInfo.period.id+"]["+this.representationInfo.adaptationSet.id+"]["+this.representationInfo.representation.id+"] querySegment("+e+", "+t+"): "+JSON.stringify(i)),i}var a=Math.floor(this.presentationTimeOffsetTicks+e*this.timescale/1e3),s=Math.floor(this.presentationTimeOffsetTicks+(e+t)*this.timescale/1e3);if(a>this.lastSegmentEndTicks){var l;if(0===(l=isFinite(this.representationInfo.period.durationMs)?void 0:this.timeWindow.getSegmentEtaMs(this.representationInfo.period.startMs+e,this.maxSegmentDurationMs)))return{type:"RefreshMe",load:freeOnUnref(function(){return n.mpdRefresher.waitRefresh().then(freeOnUnref(function(){return n.querySegment(e,t)}))})};i={type:"Unavailable",etaMs:l,reason:"Position "+e+"ms ("+a+" ticks) is outside of the segment timeline in period "+this.representationInfo.period.id+". Available times: ["+this.earliestSegmentStartTicks+", "+this.lastSegmentEndTicks+"] ticks"};return b.warn("["+this.representationInfo.period.id+"]["+this.representationInfo.adaptationSet.id+"]["+this.representationInfo.representation.id+"] querySegment("+e+", "+t+"): "+JSON.stringify(i)),i}var f,u=Pn.binarySearchIndexOfClosestBelow(r.entries,freeOnUnref(function(e){return s-e.t})),c=r.entries[u],d=c.t+(1+c.r)*c.d<s?a:s,p=0,h=0;if("S"===c.type)f=c;else{var m=Math.floor((d-c.t)/c.d);p=c.seq+m*c.numSegments;var y=d-(h=c.t+m*c.d),g=Pn.binarySearchIndexOfClosestBelow(c.S,freeOnUnref(function(e){return y-e.t}));f=c.S[g]}var v=Math.floor((d-h-f.t)/f.d),O=h+f.t+v*f.d,S=O-this.presentationTimeOffsetTicks,U=this.startNumber+p+f.seq+v;return{type:"WellKnown",index:U-this.startNumber,segmentNumber:U,startTicks:O,startMs:S/this.timescale*1e3,durationMs:f.d/this.timescale*1e3,endMs:(S+f.d)/this.timescale*1e3,timescale:this.timescale,isFinalSegment:U===this.lastSegmentSequence&&null!=this.representationInfo.period.durationMs&&isFinite(this.representationInfo.period.durationMs)}}),e.prototype.getSequenceRange=freeOnUnref(function(){return null}),e.prototype.getSequenceNumberFromPosition=freeOnUnref(function(e){return null}),e})();t.SegmentTimelineTimelineResponder=n}));e(_d);_d.SegmentTimelineTimelineResponder;var Rd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function o(){}return o.create=freeOnUnref(function(e,t,n,r){if("SegmentList"===t.type||"SegmentTemplate"===t.type){if(o.hasSegmentTimeline(r))return new _d.SegmentTimelineTimelineResponder(n,e,r)}else if("SegmentBase"===t.type){var i=t;return new kd.SegmentBaseTimelineResponder(i.segmentIndexAcquirer,r)}return new Id.InterpolatedTimelineResponder(n,e,r)}),o.hasSegmentTimeline=freeOnUnref(function(e){for(var t=0,n=[e.representation,e.adaptationSet,e.period];t<n.length;t++){var r=n[t];if(null!=r)for(var i=0,o=[r.segmentList,r.segmentTemplate];i<o.length;i++){var a=o[i];if(null!=a&&null!=a.segmentTimeline)return!0}}return!1}),o})();t.TimelineResponderFactory=n}));e(Rd);Rd.TimelineResponderFactory;var Ad=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r){this.backingTimelineResponder=null,this.timeWindow=e,this.segmentResponder=t,this.mpdRefresher=n,this.representationInfo=r}return e.prototype.getTimelineResponder=freeOnUnref(function(){return null==this.backingTimelineResponder&&(this.backingTimelineResponder=Rd.TimelineResponderFactory.create(this.timeWindow,this.segmentResponder,this.mpdRefresher,this.representationInfo)),this.backingTimelineResponder}),Object.defineProperty(e.prototype,"presentationTimeOffsetMs",{get:freeOnUnref(function(){return this.getTimelineResponder().presentationTimeOffsetMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentDurationMs",{get:freeOnUnref(function(){return this.getTimelineResponder().segmentDurationMs}),enumerable:!0,configurable:!0}),e.prototype.querySegment=freeOnUnref(function(e,t){return this.getTimelineResponder().querySegment(e,t)}),e.prototype.querySegmentBySequence=freeOnUnref(function(e){return this.getTimelineResponder().querySegmentBySequence(e)}),e.prototype.getSequenceNumberFromPosition=freeOnUnref(function(e){return this.getTimelineResponder().getSequenceNumberFromPosition(e)}),e.prototype.queryNextSegment=freeOnUnref(function(e){return this.getTimelineResponder().queryNextSegment(e)}),e.prototype.getSequenceRange=freeOnUnref(function(){return this.getTimelineResponder().getSequenceRange()}),e.prototype.reset=freeOnUnref(function(e){this.representationInfo=e,null!=this.backingTimelineResponder&&this.backingTimelineResponder.reset(e)}),e})();t.OnDemandTimelineResponder=n}));e(Ad);Ad.OnDemandTimelineResponder;var Dd=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(){function e(e,t){this.sourceUrlStore=e,this.representationInfo=t,this.currentSourceUrl="",this.baseUrl=null}return e.prototype.reset=freeOnUnref(function(e){this.representationInfo=e,this.baseUrl=null}),e.prototype.resolveSourceUrl=freeOnUnref(function(e){var t=this.resolve(e);return n({},this.sourceUrlStore.get(),{url:t})}),e.prototype.resolve=freeOnUnref(function(e){var t=this.getBaseUrl();return null!=e?new mt.URL(e,t).toString():this.baseUrl}),e.prototype.getBaseUrl=freeOnUnref(function(){var e=this.sourceUrlStore.get().url;if(null===this.baseUrl||e!==this.currentSourceUrl){var t=new mt.URL(e);this.currentSourceUrl=e;for(var n=0,r=[this.representationInfo.representation,this.representationInfo.adaptationSet,this.representationInfo.period,this.representationInfo.mpd];n<r.length;n++){var i=r[n];if(null!=i.baseUrl&&0<i.baseUrl.length){t=new mt.URL(i.baseUrl[0].baseUrl,t);break}}this.baseUrl=t.toString()}return this.baseUrl}),e})();t.UrlResolver=r}));e(Dd);Dd.UrlResolver;var xd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.representationInfo=n,this.urlResolver=new Dd.UrlResolver(e.sourceUrlStore,n),this.segmentResponder=Td.SegmentResponderFactory.create(this,e,this.urlResolver,n),this.timelineResponder=new Ad.OnDemandTimelineResponder(t,this.segmentResponder,e.mpdRefresher,n)}return e.prototype.destroy=freeOnUnref(function(){this.segmentResponder.destroy()}),e.prototype.reset=freeOnUnref(function(e){this.representationInfo=e,this.urlResolver.reset(e),this.segmentResponder.reset(e),this.timelineResponder.reset(e)}),Object.defineProperty(e.prototype,"presentationTimeOffsetMs",{get:freeOnUnref(function(){return this.timelineResponder.presentationTimeOffsetMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentDurationMs",{get:freeOnUnref(function(){return this.timelineResponder.segmentDurationMs}),enumerable:!0,configurable:!0}),e.prototype.getNext=freeOnUnref(function(e){var t=e;if(null==t.origin||null==t.origin.representationInfo)return{type:"Unavailable",reason:"Reference segment does not come from a valid segment timeline"};var n=this.timelineResponder.queryNextSegment(t);return this.segmentResponder.resolveSegment(n)}),e.prototype.getEquivalentSegment=freeOnUnref(function(e){var t=e;if(null==t.origin||null==t.origin.representationInfo)return{type:"Unavailable",reason:"Reference segment does not come from a valid segment timeline"};var n,r=t.origin.representationInfo;return r.period.id!==this.representationInfo.period.id?{type:"Unavailable",reason:"Reference segment does not come from the same period of the same content"}:(n=r.adaptationSetId!==this.representationInfo.adaptationSetId||!1===this.representationInfo.adaptationSet.segmentAlignment&&!1===this.representationInfo.adaptationSet.subsegmentAlignment&&r.representation.id!==this.representationInfo.representation.id?this.timelineResponder.querySegment(t.position.startTimeMs):this.timelineResponder.querySegmentBySequence(t.index),this.segmentResponder.resolveSegment(n))}),e.prototype.getInitSegment=freeOnUnref(function(){return this.segmentResponder.getInitSegment()}),e.prototype.getSegmentAt=freeOnUnref(function(e,t){var n=this.timelineResponder.querySegment(e,t);return this.segmentResponder.resolveSegment(n)}),e.prototype.getSequenceFromPosition=freeOnUnref(function(e){return this.timelineResponder.getSequenceNumberFromPosition(e)}),e.prototype.getSequenceRange=freeOnUnref(function(){return this.timelineResponder.getSequenceRange()}),e.prototype.getSegmentFromSequence=freeOnUnref(function(e){var t=this.timelineResponder.querySegmentBySequence(e);return this.segmentResponder.resolveSegment(t)}),e.prototype.toJSON=freeOnUnref(function(){return{}}),e})();t.DashSegmentTimeline=n}));e(xd);xd.DashSegmentTimeline;var Fd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l){var f;this.adaptationSet=o,this.adaptationSetId=a,this.mpd=n,this.period=r,this.periodId=i,this.representation=l,this.bandwidth=l.bandwidth,this.codecPrivateData="",this.supported=!0,f=null!=l.codecs?l.codecs:null!=o.codecs?o.codecs:[""],this.codecs=f.join(","),this.id=l.id,this.segmentTimeline=new xd.DashSegmentTimeline(e,t,{mpd:this.mpd,period:this.period,periodId:this.periodId,adaptationSet:this.adaptationSet,adaptationSetId:this.adaptationSetId,streamType:s,representation:this.representation})}return e.prototype.destroy=freeOnUnref(function(){this.segmentTimeline.destroy()}),e.prototype.reset=freeOnUnref(function(e){this.segmentTimeline.reset(e),this.mpd=e.mpd,this.period=e.period,this.periodId=e.periodId,this.adaptationSet=e.adaptationSet,this.adaptationSetId=e.adaptationSetId,this.representation=e.representation}),e.prototype.toJSON=freeOnUnref(function(){return x.omit(this,["adaptationSet","mpd","period","representation"])}),e})();t.DashQualityLevel=n}));e(Fd);Fd.DashQualityLevel;var Bd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("DashAudioFormatResolver"),a={"urn:mpeg:mpegB:cicp:ChannelConfiguration":{2:"Stereo",6:"5.1 Surround"},"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":{2:"Stereo"},"urn:dolby:dash:audio_channel_configuration:2011":{F801:"5.1 Surround"},"tag:dolby.com,2014:dash:audio_channel_configuration:2011":{A000:"Stereo",F801:"5.1 Surround"}},n=freeOnUnref(function(){function e(){}return e.getFormat=freeOnUnref(function(e){if(null!=e.audioChannelConfiguration){var t=e.audioChannelConfiguration[0].schemeIdUri,n=e.audioChannelConfiguration[0].value;if(null!=n){var r=a[t];if(null!=r){var i=r[n];if(null!=i)return i}}}return o.warn("Could not resolve to any available audio format"),null}),e})();t.DashAudioFormatResolver=n}));e(Bd);Bd.DashAudioFormatResolver;var Ld=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("DashAudioCodecResolver"),o=((n={}).AACL="AAC_LC",n.EAC3="EC3",n.AC3="AC3",n),r=freeOnUnref(function(){function e(){}return e.getCodec=freeOnUnref(function(e,t){if(this.isDolbyAtmos(e,t))return"EC3_ATMOS";var n=ci.CodecParser.parseAudioCodec(e);if(null!=n){var r=o[n.codec];if(null!=r)return r}return i.warn("Could not resolve to any available audio codec"),null}),e.isDolbyAtmos=freeOnUnref(function(e,t){var n=null!=t.supplementalProperty&&t.supplementalProperty.some(freeOnUnref(function(e){return"tag:dolby.com,2014:dash:DolbyDigitalPlusExtensionType:2014"===e.schemeIdUri&&"ec+3"===e.value||"tag:dolby.com,2018:dash:EC3_ExtensionType:2018"===e.schemeIdUri&&"JOC"===e.value}));return"ec-3"===e&&n}),e})();t.DashAudioCodecResolver=r}));e(Ld);Ld.DashAudioCodecResolver;var Nd=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(d){function e(e,t,n,r,i,o,a,s){for(var l=d.call(this,e,t,n,r,i,o,a,"Audio",s)||this,f=0,u=[s,o];f<u.length;f++){var c=u[f];if(null!=c.audioSamplingRate){l.samplingRate=x.isNumber(c.audioSamplingRate)?c.audioSamplingRate:c.audioSamplingRate.max;break}}return l.audioCodec=Ld.DashAudioCodecResolver.getCodec(l.codecs,s),l.audioFormat=Bd.DashAudioFormatResolver.getFormat(s),l}return n(e,d),e})(Fd.DashQualityLevel);t.DashAudioQualityLevel=r}));e(Nd);Nd.DashAudioQualityLevel;var Vd=t(freeOnUnref(function(e,t){function l(e,t){return{schemeIdUri:t.schemeIdUri,value:null!=t.value?t.value:e.value,id:null!=t.id?t.id:e.id,defaultKID:null!=t.defaultKID?t.defaultKID:e.defaultKID,robustness:null!=t.robustness?t.robustness:e.robustness,pssh:null!=t.pssh?t.pssh:e.pssh}}Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("ContentProtectionResolver"),n=freeOnUnref(function(){function e(e){this.mpd=e,this.contentProtectionRefCache={}}return e.prototype.reset=freeOnUnref(function(e){this.mpd=e,this.contentProtectionRefCache={}}),e.getContentProtectionsForAdaptationSet=freeOnUnref(function(e){for(var t=0,n=e.representation;t<n.length;t++){var r=n[t];if(null!=r.contentProtection)return r.contentProtection}return e.contentProtection}),e.prototype.tryResolvingReferencingContentProtections=freeOnUnref(function(e,t){for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r],a=o,s=null!=a.ref?this.resolveReferencingContentProtectionAgainstWholeMpd(a,t):o;null!=s&&n.push(s)}return n}),e.prototype.resolveReferencingContentProtectionAgainstWholeMpd=freeOnUnref(function(e,t){var n=this.contentProtectionRefCache[e.ref];if(null!=n)return l(n,e);var r=this.resolveReferencingContentProtection(e,this.mpd.contentProtection);if(null!=r)return r;for(var i=0,o=this.mpd.period;i<o.length;i++){var a=o[i],s=this.resolveReferencingContentProtection(e,a.contentProtection);if(null!=s)return s;if(a===t)break}return f.warn("Failed to resolve ContentProtection@ref="+e.ref+" in Period@id="+t.id),null}),e.prototype.resolveReferencingContentProtection=freeOnUnref(function(t,e){if(null==e)return null;var n=x.find(e,freeOnUnref(function(e){return e.refId===t.ref}));return null==n?null:l(this.contentProtectionRefCache[t.ref]=n,t)}),e})();t.ContentProtectionResolver=n}));e(Vd);Vd.ContentProtectionResolver;var jd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("DashBaseStream");var l={"urn:mpeg:dash:mp4protection:2011":0,"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":3,"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":4},n=freeOnUnref(function(){function s(e,t,n,r,i,o){this.mediaRepresentationFilters=[],this.adaptationSet=o,this.mpd=n,this.period=r,this.context=e,this.baseId=s.getStreamBaseId(o),this.id=s.getStreamId(o);var a=s.getMimeType(o);if(null==a)throw new Error("Unable to extract mime type for AdaptationSet");this.mimeType=a,this.type=s.getStreamType(o),this.segmentAlignment=!1!==o.segmentAlignment,this.supported=!0,this.contentProtections=this.transformContentProtection(),this.originalQualityLevels=x.sortBy(this.createQualityLevels(t,i),freeOnUnref(function(e){return e.bandwidth})),this.qualityLevels=this.originalQualityLevels}return s.prototype.destroy=freeOnUnref(function(){for(var e=0,t=this.originalQualityLevels;e<t.length;e++){t[e].destroy()}}),s.prototype.reset=freeOnUnref(function(n,r,i,o){this.mpd=n,this.period=r,this.adaptationSet=o;for(var e=freeOnUnref(function(t){var e=x.find(o.representation,freeOnUnref(function(e){return e.id===t.id}));if(null==e)throw new Error("IncompatibleManifest - "+a.type+"Stream@id="+a.id+" did not find quality "+t.id+" on compatible representations?!?");t.reset({mpd:n,period:r,periodId:i,adaptationSet:o,adaptationSetId:a.id,streamType:a.type,representation:e})}),a=this,t=0,s=this.originalQualityLevels;t<s.length;t++){e(s[t])}this.filterQualityLevels()}),s.prototype.applyFilters=freeOnUnref(function(e){this.mediaRepresentationFilters=e,this.filterQualityLevels()}),s.getStreamId=freeOnUnref(function(e){var t=e.representation[0].codecs,n=s.getStreamBaseId(e)+"_"+t,r=e.representation[0].audioSamplingRate;return null!=r&&(n+="_"+r),n}),s.getStreamBaseId=freeOnUnref(function(e){return null!=e.audioTrackId?""+e.audioTrackId:null!=e.lang?e.lang+"_dialog_0":null!=e.id?""+e.id:""}),s.getStreamType=freeOnUnref(function(e){if(null!=e.contentType){if("audio"===e.contentType)return"Audio";if("application"===e.contentType||"text"===e.contentType)return"TimedText";if("video"===e.contentType)return"Video";if("image"===e.contentType)return"Image";throw new Error("Unrecognized content type "+e.contentType)}var t=s.getMimeType(e);if("audio/mp4"===t)return"Audio";if("application/mp4"===t)return"TimedText";if("video/mp4"===t)return"Video";if(null!=t&&0===t.indexOf("image/"))return"Image";throw new Error("Unrecognized mimeType "+t)}),s.getMimeType=freeOnUnref(function(e){return Qe.withDefault(e.representation[0].mimeType,e.mimeType)}),s.prototype.transformContentProtection=freeOnUnref(function(){var e=Vd.ContentProtectionResolver.getContentProtectionsForAdaptationSet(this.adaptationSet);if(null!=e&&0!==e.length){for(var t=[],n=0,r=this.context.contentProtectionResolver.tryResolvingReferencingContentProtections(e,this.period);n<r.length;n++){var i=r[n],o=l[i.schemeIdUri];if(null!=o){var a={scheme:o};if(0===o)a.keyId=i.defaultKID;else if(3===o||4===o){var s=i;null!=s.pssh&&(a.pssh=s.pssh[0])}t.push(a)}}return t}}),s.prototype.filterQualityLevels=freeOnUnref(function(){var i=this;0===this.mediaRepresentationFilters.length?this.qualityLevels=this.originalQualityLevels:this.qualityLevels=this.originalQualityLevels.filter(freeOnUnref(function(e){for(var t=!0,n=0,r=i.mediaRepresentationFilters;n<r.length;n++){if(!r[n].isQualityLevelSupported(i,e)){t=!1;break}}return e.supported=t}))}),s.prototype.toJSON=freeOnUnref(function(){return x.omit(this,["adaptationSet","contentProtections","context","mediaRepresentationFilters","mpd","period","qualityLevels","representation"])}),s})();t.DashBaseStream=n}));e(jd);jd.DashBaseStream;var qd=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(s){function e(e,t,n,r,i,o){var a=s.call(this,e,t,n,r,i,o)||this;return a.language=Wl.toExpectedIso639_1LanguageCode(o.lang),a.subtype=a.getAudioSubtype(e.audioTrackMetadata),a.label=a.getAudioLabel(e.audioTrackMetadata),a.audioTrackId=o.audioTrackId,a}return n(e,s),e.prototype.createQualityLevels=freeOnUnref(function(t,n){var r=this;return this.adaptationSet.representation.map(freeOnUnref(function(e){return new Nd.DashAudioQualityLevel(r.context,t,r.mpd,r.period,n,r.adaptationSet,r.id,e)}))}),e.prototype.getAudioSubtype=freeOnUnref(function(e){var t="Dialog";1===Object.keys(e).length&&(t=e[Object.keys(e)[0]].subtype);var n=t;return null!=e[this.baseId]&&(n=e[this.baseId].subtype),n}),e.prototype.getAudioLabel=freeOnUnref(function(e){return 1===Object.keys(e).length?e[Object.keys(e)[0]].label:null!=e[this.baseId]?e[this.baseId].label:void 0}),e})(jd.DashBaseStream);t.DashAudioStream=r}));e(qd);qd.DashAudioStream;var Hd=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("DashImageQualityLevel"),r=freeOnUnref(function(d){function e(e,t,n,r,i,o,a,s){var l=d.call(this,e,t,n,r,i,o,a,"Image",s)||this;l.representation=s;var f=l.getEssentialPropertyValue(s,"http://dashif.org/guidelines/thumbnail_tile"),u=l.parseTileResolution(f);if(l.tileWidth=u.width,l.tileHeight=u.height,l.thumbnailWidth=null!=s.width?s.width/l.tileWidth:NaN,l.thumbnailHeight=null!=s.height?s.height/l.tileHeight:NaN,!(isFinite(l.tileWidth)&&isFinite(l.tileHeight)&&isFinite(l.thumbnailHeight)&&isFinite(l.thumbnailWidth)&&0<l.tileWidth&&0<l.tileHeight&&0<l.thumbnailHeight&&0<l.thumbnailWidth)){var c="Invalid thumbnail or tile resolution. thumbnail:{width:"+l.thumbnailWidth+",height:"+l.thumbnailHeight+"}, tile:{width:"+l.tileWidth+",height:"+l.tileHeight+"}";throw new ct.XpError("manifest.parse.image_stream",void 0,c)}return l}return n(e,d),e.prototype.getEssentialPropertyValue=freeOnUnref(function(e,t){var n;if(null==e.essentialProperty)throw n="Nonexistent essentialProperty for "+e.id+" to find "+t,a.warn(n),new ct.XpError("manifest.parse.image_stream",void 0,n);for(var r=0,i=e.essentialProperty;r<i.length;r++){var o=i[r];if(o.schemeIdUri===t&&null!=o.value)return o.value}throw n="Fail to find essential property: "+t,a.warn(n),new ct.XpError("manifest.parse.image_stream",void 0,n)}),e.prototype.parseTileResolution=freeOnUnref(function(e){var t=e.split("x");if(2!==t.length){var n="Malformed thumbnail_tile property: "+e;throw a.warn(n),new ct.XpError("manifest.parse.image_stream",void 0,n)}return{width:parseInt(t[0]),height:parseInt(t[1])}}),e})(Fd.DashQualityLevel);t.DashImageQualityLevel=r}));e(Hd);Hd.DashImageQualityLevel;var zd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function m(){}return m.extractEarliestAvailableMPDTime=freeOnUnref(function(e){for(var t=e.period[0],n=0,r=0,i=t.adaptationSet;r<i.length;r++)for(var o=i[r],a=0,s=o.representation;a<s.length;a++){var l=s[a],f=m.getSegmentTemplateMetadata(t,o,l),u=f.presentationTimeOffset,c=f.timescale,d=f.segmentTimeline;if(null!=d){var p=1e3*(d.entries[0].t-u)/c;n<p&&(n=p)}}return t.startMs+n}),m.extractLatestExplicitSegmentMPDTime=freeOnUnref(function(e){for(var t=e.period[e.period.length-1],n=1/0,r=0,i=t.adaptationSet;r<i.length;r++)for(var o=i[r],a=0,s=o.representation;a<s.length;a++){var l=s[a],f=m.getSegmentTemplateMetadata(t,o,l),u=f.presentationTimeOffset,c=f.timescale,d=f.segmentTimeline;if(null!=d){var p=d.entries[d.entries.length-1],h=1e3*(p.t+(p.r+1)*p.d-u)/c;h<n&&(n=h)}}return t.startMs+n}),m.extractLatestAvailableMPDTime=freeOnUnref(function(e,t,n){var r=m.extractLatestExplicitSegmentMPDTime(e);return isFinite(r)?r:t-n}),m.getSegmentTemplateMetadata=freeOnUnref(function(e,t,n){for(var r={timescale:1,presentationTimeOffset:0},i=0,o=[e.segmentTemplate,t.segmentTemplate,n.segmentTemplate];i<o.length;i++){var a=o[i];null!=a&&(null!=a.duration&&(r.duration=a.duration),null!=a.timescale&&(r.timescale=a.timescale),null!=a.presentationTimeOffset&&(r.presentationTimeOffset=a.presentationTimeOffset),null!=a.segmentTimeline&&(r.segmentTimeline=a.segmentTimeline))}return r}),m})();t.DashManifestUtility=n}));e(zd);zd.DashManifestUtility;var Wd=t(freeOnUnref(function(e,t){var s=ce&&ce.__assign||freeOnUnref(function(){return(s=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("DurationExtending1x1TileSegmentTimeline"),n=freeOnUnref(function(){function e(e,t,n,r){if(this.sourceStartNumber=1,this.startNumber=1,null==e.segmentDurationMs)throw new Error("Cannot extend segments without duration");e.segmentDurationMs>t&&i.warn("SegmentTimeline source has longer segment duration "+e.segmentDurationMs+" than target "+t),this.sourceTimeline=e,this.targetSegmentDurationMs=t,this.durationExtendingFactor=t/e.segmentDurationMs,this.timeWindow=n,this.representationInfo=r,this.reset(r)}return e.prototype.reset=freeOnUnref(function(e){this.representationInfo=e;var t=wd.extractSegmentInfos(e);this.startNumber=1;for(var n=0,r=t;n<r.length;n++){var i=r[n];null!=i.startNumber&&(this.sourceStartNumber=i.startNumber,this.startNumber=Math.floor((i.startNumber-1)/this.durationExtendingFactor)+1)}}),Object.defineProperty(e.prototype,"segmentDurationMs",{get:freeOnUnref(function(){return this.targetSegmentDurationMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"presentationTimeOffsetMs",{get:freeOnUnref(function(){return this.sourceTimeline.presentationTimeOffsetMs%this.targetSegmentDurationMs}),enumerable:!0,configurable:!0}),e.prototype.getInitSegment=freeOnUnref(function(){return this.sourceTimeline.getInitSegment()}),e.prototype.getNext=freeOnUnref(function(e){var t=this.getOriginalSequence(e.index+1),n=s({},e,{index:t-1}),r=this.sourceTimeline.getNext(n);return this.convertToPublicResponse(r)}),e.prototype.getSequenceFromPosition=freeOnUnref(function(e){var t=this.sourceTimeline.getSequenceFromPosition(e);return null==t?null:this.getExtendedSequence(t)}),e.prototype.getSequenceRange=freeOnUnref(function(){var e=this.sourceTimeline.getSequenceRange();return null==e?null:{startSequence:this.getExtendedSequence(e.startSequence),endSequence:this.getExtendedSequence(e.endSequence)}}),e.prototype.getSegmentFromSequence=freeOnUnref(function(e){var t=this.getOriginalSequence(e),n=this.sourceTimeline.getSegmentFromSequence(t);return null==n?null:this.convertToPublicResponse(n)}),e.prototype.getSegmentAt=freeOnUnref(function(e,t){var n=e-(e+this.presentationTimeOffsetMs)%this.targetSegmentDurationMs,r=this.timeWindow.startMs-this.representationInfo.period.startMs,i=Math.max(n,r),o=this.sourceTimeline.getSegmentAt(i,t);return this.convertToPublicResponse(o)}),e.prototype.getEquivalentSegment=freeOnUnref(function(e){var t,n=this.timeWindow.startMs-this.representationInfo.period.startMs;if(e.position.endTimeMs<n)return{type:"Unavailable",reason:"Segment "+e.index+" (["+e.position.startTimeMs+","+e.position.endTimeMs+"]) ends before the time window trailing edge ("+this.timeWindow.startMs+")"};if(e.position.startTimeMs<n)return this.getSegmentAt(n);var r=s({},e,{index:this.getOriginalSequence(e.index)});return t=this.sourceTimeline.getEquivalentSegment(r),this.convertToPublicResponse(t)}),e.prototype.getExtendedSequence=freeOnUnref(function(e){var t=Math.floor((e-this.sourceStartNumber)/this.durationExtendingFactor);return this.startNumber+t}),e.prototype.getOriginalSequence=freeOnUnref(function(e){return(e-this.startNumber)*this.durationExtendingFactor+this.sourceStartNumber}),e.prototype.convertToPublicResponse=freeOnUnref(function(e){if("Unavailable"===e.type||"RefreshMe"===e.type)return e;var t=e.segment,n=Math.floor((t.index-this.sourceStartNumber)/this.durationExtendingFactor),r=this.startNumber+n,i=n*this.targetSegmentDurationMs-this.presentationTimeOffsetMs,o=i+this.targetSegmentDurationMs,a=this.representationInfo.period.durationMs;return{type:e.type,segment:s({},t,{index:r,isFinalSegment:null!=a&&a-1<=o,position:{startTimeMs:i,durationMs:this.targetSegmentDurationMs,endTimeMs:o},get sourceUrl(){return t.sourceUrl}})}}),e})();t.DurationExtending1x1TileSegmentTimeline=n}));e(Wd);Wd.DurationExtending1x1TileSegmentTimeline;var Kd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s){this.dataSourceQualityLevel=e,this.segmentTimeline=new Wd.DurationExtending1x1TileSegmentTimeline(e.segmentTimeline,t,n,{mpd:r,period:i,periodId:o,adaptationSet:a,adaptationSetId:s,streamType:"Image",representation:e.representation}),this.bandwidth=this.dataSourceQualityLevel.bandwidth/this.segmentTimeline.durationExtendingFactor,this.tileHeight=1,this.tileWidth=1}return Object.defineProperty(e.prototype,"representation",{get:freeOnUnref(function(){return this.dataSourceQualityLevel.representation}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbnailHeight",{get:freeOnUnref(function(){return this.dataSourceQualityLevel.thumbnailHeight}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbnailWidth",{get:freeOnUnref(function(){return this.dataSourceQualityLevel.thumbnailWidth}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"codecs",{get:freeOnUnref(function(){return this.dataSourceQualityLevel.codecs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"codecPrivateData",{get:freeOnUnref(function(){return this.dataSourceQualityLevel.codecPrivateData}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:freeOnUnref(function(){return this.dataSourceQualityLevel.id}),enumerable:!0,configurable:!0}),e.prototype.reset=freeOnUnref(function(e){this.segmentTimeline.reset(e)}),e})();t.DurationExtending1x1TileQualityLevel=n}));e(Kd);Kd.DurationExtending1x1TileQualityLevel;var Gd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function p(e,t,n){this.qualityLevels=e,this.representativeSourceStream=t,this.supported=!0,this.thumbnailDurationMs=n}return Object.defineProperty(p.prototype,"segmentAlignment",{get:freeOnUnref(function(){return this.representativeSourceStream.segmentAlignment}),enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"mimeType",{get:freeOnUnref(function(){return this.representativeSourceStream.mimeType}),enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"type",{get:freeOnUnref(function(){return this.representativeSourceStream.type}),enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"contentProtections",{get:freeOnUnref(function(){return this.representativeSourceStream.contentProtections}),enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"id",{get:freeOnUnref(function(){return this.representativeSourceStream.baseId+"_"+this.thumbnailDurationMs+"_1x1"}),enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"baseId",{get:freeOnUnref(function(){return this.representativeSourceStream.baseId}),enumerable:!0,configurable:!0}),p.prototype.destroy=freeOnUnref(function(){}),p.prototype.applyFilters=freeOnUnref(function(e){}),p.prototype.reset=freeOnUnref(function(e,t,n,r){for(var i=0,o=this.qualityLevels;i<o.length;i++){var a=o[i];a.reset({mpd:e,period:t,periodId:n,adaptationSet:r,adaptationSetId:this.id,streamType:"Image",representation:a.representation})}}),p.createFake1x1ImageStream=freeOnUnref(function(e,t,n,r,i,o,a,s){if(t<=0)return null;for(var l=[],f=0,u=e.qualityLevels;f<u.length;f++){var c=u[f],d=new Kd.DurationExtending1x1TileQualityLevel(c,t,n,r,i,o,a,s);l.push(d)}return new p(l,e,t)}),p})();t.DurationExtending1x1TileStream=n}));e(Gd);Gd.DurationExtending1x1TileStream;var Qd=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})(),T=ce&&ce.__assign||freeOnUnref(function(){return(T=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var w=[2e4];function I(e){for(var t=0,n=e.qualityLevels;t<n.length;t++){var r=n[t];if(1===(i=r).tileHeight&&1===i.tileWidth)return!0}var i;return!1}var r=freeOnUnref(function(l){function E(e,t,n,r,i,o){var a=l.call(this,e,t,n,r,i,o)||this;a.adaptationSet=o;var s=E.getSegmentDurationMs(r,o,o.representation[0]);return a.baseId=E.getStreamBaseId(o),a.id=a.baseId+"_"+s,a}return n(E,l),E.getStreamBaseId=freeOnUnref(function(e){if(null!=e.id)return""+e.id;var t=jd.DashBaseStream.getMimeType(e);return null!=t?t:"image"}),E.createImageStreamsBySegmentDuration=freeOnUnref(function(e,t,n,r,i,o){for(var a={},s=0,l=o.representation;s<l.length;s++){var f=l[s];null!=(h=E.getSegmentDurationMs(r,o,f))&&(null==a[h]&&(a[h]=[]),a[h].push(f))}for(var u=[],c=0,d=Object.keys(a);c<d.length;c++){var p=d[c],h=parseInt(p),m=T({},o,{representation:a[h]});u.push(new E(e,t,n,r,i,m))}var y=w,g=L.configurationStore.configuration;null!=g&&null!=g.dashLiveTrickplay&&null!=g.dashLiveTrickplay.extendedThumbnailDurationsMsOverride&&(y=g.dashLiveTrickplay.extendedThumbnailDurationsMsOverride);for(var v=u.slice(),O=0,S=u;O<S.length;O++){var U=S[O];if(I(U)){for(var b=0,P=y;b<P.length;b++){var M=P[b],C=Gd.DurationExtending1x1TileStream.createFake1x1ImageStream(U,M,t,n,r,i,U.adaptationSet,U.id);null!=C&&v.push(C)}break}}return v}),E.prototype.createQualityLevels=freeOnUnref(function(t,n){var r=this;return this.adaptationSet.representation.map(freeOnUnref(function(e){return new Hd.DashImageQualityLevel(r.context,t,r.mpd,r.period,n,r.adaptationSet,r.id,e)}))}),E.getSegmentDurationMs=freeOnUnref(function(e,t,n){if(null==n)return null;var r=zd.DashManifestUtility.getSegmentTemplateMetadata(e,t,n),i=r.duration,o=r.timescale;return null==i?null:1e3*i/o}),E})(jd.DashBaseStream);t.DashImageStream=r}));e(Qd);Qd.DashImageStream;var Xd=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var a={subtitle:{"*":{timedTextType:"Subtitle",timedTextSubtype:"Dialog"},"filtered-content":{timedTextType:"Subtitle",timedTextSubtype:"FilteredContent"},"machine-generated":{timedTextType:"MachineGenerated",timedTextSubtype:"Dialog"}},commentary:{"*":{timedTextType:"Subtitle",timedTextSubtype:"Commentary"}},"forced-subtitle":{"*":{timedTextType:"Mandatory",timedTextSubtype:"Dialog"}},caption:{"*":{timedTextType:"Caption",timedTextSubtype:"Dialog"}},description:{"*":{timedTextType:"Subtitle",timedTextSubtype:"Descriptive"}},audio:{"*":{timedTextType:"Audio",timedTextSubtype:"Dialog"}}},r=freeOnUnref(function(u){function c(e,t,n,r,i,o){var a=u.call(this,e,t,n,r,i,o)||this;a.language=Wl.toExpectedIso639_1LanguageCode(o.lang);var s=c.extractTimedTextTypeInformation(o),l=s.timedTextType,f=s.timedTextSubtype;return a.textType=l,a.subtype=f,a.label=o.label,a.baseId=c.getStreamBaseId(o),a.id=c.getStreamId(o),a}return n(c,u),c.extractTimedTextTypeInformation=freeOnUnref(function(e){var t="subtitle",n="",r=e.role;if(null!=r&&null!=r[0]){var i=r[0].value;null!=i&&null!=a[i]&&(t=i)}if(null!=e.supplementalProperty){var o=x.find(e.supplementalProperty,freeOnUnref(function(e){return"urn:amazon:primevideo:timedTextSubtype"===e.schemeIdUri}));null!=o&&null!=o.value&&(n=o.value)}return null==a[t][n]?a[t]["*"]:a[t][n]}),c.getStreamBaseId=freeOnUnref(function(e){var t=c.extractTimedTextTypeInformation(e),n=t.timedTextType,r=t.timedTextSubtype;return e.lang+"_"+n+"_"+r}),c.getStreamId=freeOnUnref(function(e){return c.getStreamBaseId(e)+"_"+e.representation[0].codecs}),c.prototype.createQualityLevels=freeOnUnref(function(t,n){var r=this;return this.adaptationSet.representation.map(freeOnUnref(function(e){return new Fd.DashQualityLevel(r.context,t,r.mpd,r.period,n,r.adaptationSet,r.id,"TimedText",e)}))}),c})(jd.DashBaseStream);t.DashTimedTextStream=r}));e(Xd);Xd.DashTimedTextStream;var Yd=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("DashPerceptualQuality"),r=freeOnUnref(function(){function a(e,t){this.scoreModel=e,this.qualityScores=t}return a.parse=freeOnUnref(function(e){if(null!=e){for(var t=!1,n=[],r=0;r<e.value.length;r+=2){var i=e.value.slice(r,r+2),o=parseInt(i,16);this.isInvalidQualityScore(o)?t=!0:n.push(o)}if(!t)return new a(e.id,n)}}),a.isInvalidQualityScore=freeOnUnref(function(e){return isNaN(e)?(n.error("Unable to parse the provided quality score string, resulting in a NaN value"),!0):e<0?(n.error("Parsed quality score is below the minimum possible score 0"),!0):100<e&&(n.error("Parsed quality score is above the maximum possible score 100"),!0)}),a.prototype.getQualityScore=freeOnUnref(function(e){return e<0||e>=this.qualityScores.length?(n.error("Fragment index "+e+" is out of bounds for the available quality scores"),null):this.qualityScores[e]}),a})();t.DashPerceptualQuality=r}));e(Yd);Yd.DashPerceptualQuality;var Jd=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(f){function e(e,t,n,r,i,o,a,s){var l=f.call(this,e,t,n,r,i,o,a,"Video",s)||this;return l.frameRate=Qe.withDefault(s.frameRate,o.frameRate),l.height=s.height,l.width=s.width,l.sar=s.sar,l.perceptualQuality=Yd.DashPerceptualQuality.parse(s.md),l}return n(e,f),e})(Fd.DashQualityLevel);t.DashVideoQualityLevel=r}));e(Jd);Jd.DashVideoQualityLevel;var Zd=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(s){function e(e,t,n,r,i,o){var a=s.call(this,e,t,n,r,i,o)||this;return a.pictureAspectRatio=o.par,a}return n(e,s),e.prototype.createQualityLevels=freeOnUnref(function(t,n){var r=this;return this.adaptationSet.representation.map(freeOnUnref(function(e){return new Jd.DashVideoQualityLevel(r.context,t,r.mpd,r.period,n,r.adaptationSet,r.id,e)}))}),e})(jd.DashBaseStream);t.DashVideoStream=r}));e(Zd);Zd.DashVideoStream;var $d=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var v=de.get("DashPeriod"),n=freeOnUnref(function(){function g(e,t,n,r,i,o,a){this.mediaRepresentationFilters=[],this.isFirstOccurrenceOfStream=freeOnUnref(function(t,e,n){return x.findIndex(n,freeOnUnref(function(e){return t.id===e.id&&t.type===e.type}))===e}),this.context=e,this.mpd=n,this.period=r,this.isFinalPeriod=a,this.isResolved=!0,this.startMs=i,this.durationMs=o,this.contentId=this.getSupplementalPropertyValue(r,"urn:amazon:primevideo:contentId"),this.contentType=this.getSupplementalPropertyValue(r,"urn:amazon:primevideo:contentType"),this.contentSubType=this.getSupplementalPropertyValue(r,"urn:amazon:primevideo:contentSubtype"),this.primeVideoContentType=this.getSupplementalPropertyValue(r,"urn:amazon:primevideo:primeVideoContentType");var s=this.getSupplementalPropertyValue(r,"urn:scte:dash:utc-time");this.mediaWallClockUtcStartMs=null!=s?new Date(s).getTime():void 0,this.originalStreams=this.createStreams(t),this.streams=this.originalStreams}return g.prototype.destroy=freeOnUnref(function(){for(var e=0,t=this.originalStreams;e<t.length;e++){t[e].destroy()}}),g.prototype.reset=freeOnUnref(function(n,r,e,t){this.mpd=n,this.period=r,this.durationMs=e,this.isFinalPeriod=t;for(var i=this.originalStreams.filter(this.isFirstOccurrenceOfStream),o=freeOnUnref(function(t){var e=r.adaptationSet.filter(freeOnUnref(function(e){return g.isMatchingAdaptationSet(e,t)}));if(x.isEmpty(e))throw new Error("IncompatibleManifest - Period@id="+a.id+" did not find matching "+t.type+" AdaptationSets "+t.id+" on compatible representations?!?")}),a=this,s=0,l=i;s<l.length;s++){o(l[s])}for(var f=freeOnUnref(function(t){var e=x.find(r.adaptationSet,freeOnUnref(function(e){return g.isMatchingAdaptationSet(e,t)}));if(null==e)throw new Error("IncompatibleManifest - Period@id="+u.id+" did not find matching "+t.type+" AdaptationSets "+t.id+" on compatible representations?!?");t.reset(n,r,u.id,e)}),u=this,c=0,d=this.originalStreams;c<d.length;c++){f(d[c])}for(var p=freeOnUnref(function(t){var e=jd.DashBaseStream.getStreamType(t),n=jd.DashBaseStream.getStreamId(t);h.originalStreams.some(freeOnUnref(function(e){return g.isMatchingAdaptationSet(t,e)}))||v.warn("New adaptationSet added with streamType: "+e+", streamId: "+n+", periodId: "+r.id+".")}),h=this,m=0,y=r.adaptationSet;m<y.length;m++){p(y[m])}this.filterStreams()}),g.prototype.applyFilters=freeOnUnref(function(e){this.mediaRepresentationFilters=e;for(var t=0,n=this.originalStreams;t<n.length;t++){n[t].applyFilters(e)}this.filterStreams()}),Object.defineProperty(g.prototype,"id",{get:freeOnUnref(function(){return null!=this.period.id?this.period.id:"@@id@@"}),enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"endMs",{get:freeOnUnref(function(){return this.startMs+this.durationMs}),enumerable:!0,configurable:!0}),g.prototype.resolve=freeOnUnref(function(){return lt.Promise.resolve(this)}),g.prototype.awaitForwardAccess=freeOnUnref(function(){return lt.Promise.resolve(this)}),g.prototype.createStreams=freeOnUnref(function(e){for(var t=[],n=[],r=0,i=this.period.adaptationSet;r<i.length;r++){var o=i[r],a=void 0;try{a=jd.DashBaseStream.getStreamType(o)}catch(e){continue}switch(a){case"Audio":t.push(new qd.DashAudioStream(this.context,e,this.mpd,this.period,this.id,o));break;case"Image":try{n=n.concat(Qd.DashImageStream.createImageStreamsBySegmentDuration(this.context,e,this.mpd,this.period,this.id,o))}catch(e){v.warn("Fail to create Image stream.",e),q.metrics.putMetric("Manifest.DASH.Image.Error");continue}break;case"TimedText":t.push(new Xd.DashTimedTextStream(this.context,e,this.mpd,this.period,this.id,o));break;case"Video":t.push(new Zd.DashVideoStream(this.context,e,this.mpd,this.period,this.id,o));break;default:continue}}return n.sort(g.compareStreamSegmentDurations),t.concat(n)}),g.prototype.getSupplementalPropertyValue=freeOnUnref(function(e,t){if(null!=e.supplementalProperty)for(var n=0,r=e.supplementalProperty;n<r.length;n++){var i=r[n];if(i.schemeIdUri===t&&null!=i.value)return i.value}}),g.prototype.filterStreams=freeOnUnref(function(){0===this.mediaRepresentationFilters.length?this.streams=this.originalStreams:this.streams=this.originalStreams.filter(freeOnUnref(function(e){var t=0<e.qualityLevels.length;return e.supported=t}))}),g.compareStreamSegmentDurations=freeOnUnref(function(e,t){if("Image"!==e.type||"Image"!==t.type)return v.warn("Attempted to compare non-Image streams"),0;var n=0<e.qualityLevels.length?e.qualityLevels[0].segmentTimeline.segmentDurationMs:null,r=0<t.qualityLevels.length?t.qualityLevels[0].segmentTimeline.segmentDurationMs:null;return null==n&&null==r?0:null==n?1:null==r?-1:r-n}),g.isMatchingAdaptationSet=freeOnUnref(function(e,t){if(jd.DashBaseStream.getStreamType(e)!==t.type)return!1;switch(t.type){case"TimedText":return t.id===Xd.DashTimedTextStream.getStreamId(e);case"Image":return t.baseId===Qd.DashImageStream.getStreamBaseId(e);default:return t.id===jd.DashBaseStream.getStreamId(e)}}),g.prototype.toJSON=freeOnUnref(function(){return x.omit(this,["adaptationSet","context","mediaRepresentationFilters","mpd","period","representation","streams"])}),g})();t.DashPeriod=n}));e($d);$d.DashPeriod;var ep=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("DynamicTimeWindow"),r=freeOnUnref(function(){function e(){this.timeShiftBufferDepthMs=0,this.latestAvailableMPDTimeMs=0,this.earliestAvailableMPDTimeMs=0,this.fetchTime=0,this.availabilityStartTimeMs=null,this.updatePeriodMs=-1}return Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){return Math.max(this.endMs-this.timeShiftBufferDepthMs,this.earliestAvailableMPDTimeMs,0)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){return this.latestAvailableMPDTimeMs+(Date.now()-this.fetchTime)}),enumerable:!0,configurable:!0}),e.prototype.isUpdating=freeOnUnref(function(){return null!=this.updatePeriodMs}),e.prototype.reset=freeOnUnref(function(e){var t=e.mpd;null==t.minimumUpdatePeriodMs?this.updatePeriodMs=null:-1===this.updatePeriodMs&&(this.updatePeriodMs=Qe.withDefault(t.minimumUpdatePeriodMs,0)),this.timeShiftBufferDepthMs=Qe.withDefault(t.timeShiftBufferDepthMs,1/0),null!=this.availabilityStartTimeMs&&null!=t.availabilityStartTimeMs&&this.availabilityStartTimeMs!==t.availabilityStartTimeMs&&n.warn("MPD@AST changed: "+new Date(this.availabilityStartTimeMs).toISOString()+" -> "+new Date(t.availabilityStartTimeMs).toISOString()),this.availabilityStartTimeMs=t.availabilityStartTimeMs,this.fetchTime=Date.now(),this.latestAvailableMPDTimeMs=e.latestAvailableMPDTimeMs,this.earliestAvailableMPDTimeMs=e.earliestAvailableMPDTimeMs}),e.prototype.getSegmentEtaMs=freeOnUnref(function(e,t){if(!(e+t<this.startMs))return null===this.updatePeriodMs?0:Math.max(0,e+t-this.endMs)}),e.prototype.setUpdatePeriod=freeOnUnref(function(e){this.updatePeriodMs=e}),e.prototype.debug=freeOnUnref(function(){return JSON.stringify({type:"DynamicTimeWindow",availabilityStartTimeMs:this.availabilityStartTimeMs,timeShiftBufferDepthMs:this.timeShiftBufferDepthMs,updatePeriodMs:this.updatePeriodMs,fetchTime:this.fetchTime,now:Date.now(),latestAvailableMPDTimeMs:this.latestAvailableMPDTimeMs,earliestAvailableMPDTimeMs:this.earliestAvailableMPDTimeMs})}),e})();t.DynamicTimeWindow=r}));e(ep);ep.DynamicTimeWindow;var tp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.durationMs=0,this.earliestAvailableMPDTimeMs=0}return Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){return Math.max(this.earliestAvailableMPDTimeMs,0)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){return this.durationMs}),enumerable:!0,configurable:!0}),e.prototype.isUpdating=freeOnUnref(function(){return!1}),e.prototype.reset=freeOnUnref(function(e){var t=e.mpd;this.durationMs=Qe.withDefault(t.mediaPresentationDurationMs,1/0),this.earliestAvailableMPDTimeMs=e.earliestAvailableMPDTimeMs}),e.prototype.getSegmentEtaMs=freeOnUnref(function(e,t){return 0<=e&&e<this.endMs?0:void 0}),e.prototype.setUpdatePeriod=freeOnUnref(function(e){}),e.prototype.debug=freeOnUnref(function(){return JSON.stringify({type:"StaticTimeWindow",earliestAvailableMPDTimeMs:this.earliestAvailableMPDTimeMs,durationMs:this.durationMs})}),e})();t.StaticTimeWindow=n}));e(tp);tp.StaticTimeWindow;var np=t(freeOnUnref(function(e,t){var o=ce&&ce.__assign||freeOnUnref(function(){return(o=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});de.get("DashMediaRepresentation");var n=freeOnUnref(function(){function e(e,t,n,r){void 0===r&&(r=null);var i=this;this.mediaRepresentationFilters=[],this.reset=freeOnUnref(function(e){i.mpdContext=e,i.timeWindow.reset(e),i.contentProtectionResolver.reset(e.mpd),null!=i.mpdRefresher.updatePeriodMs&&i.timeWindow.setUpdatePeriod(i.mpdRefresher.updatePeriodMs),i.updateDashPeriods(i.dashPeriods.contents),i.periodChangedCallback.invoke()}),this.onSourceUrlChange=freeOnUnref(function(t){"manifest"===t.failoverMode&&i.mpdAcquirer.update(!0).catch(freeOnUnref(function(e){e instanceof lt.CancelError||i.dashMediaRepresentationContext.sourceUrlStore.resourceAcquisitionFailed({type:"ParseError",cause:e},Ac.AcquisitionResourceType.Manifest,t.newSourceUrl.url,t.newSourceUrl.urlId)}))}),this.mpdContext=e,this.contentProtectionResolver=new Vd.ContentProtectionResolver(e.mpd),this.mpdAcquirer=new gf.ManifestAcquirer(n,this.reset),this.mpdRefresher=new gf.ManifestRefresher(e,this.mpdAcquirer,r),this.dashMediaRepresentationContext=o({},t,{mpdAcquirer:this.mpdAcquirer,mpdRefresher:this.mpdRefresher,contentProtectionResolver:this.contentProtectionResolver}),"static"===this.mpdContext.mpd.type?this.timeWindow=new tp.StaticTimeWindow:this.timeWindow=new ep.DynamicTimeWindow,this.timeWindow.reset(e),this.dashPeriods={contents:this.updateDashPeriods([]),onChange:freeOnUnref(function(e){return i.periodChangedCallback.add(e)}),offChange:freeOnUnref(function(e){return i.periodChangedCallback.remove(e)})},this.periodChangedCallback=new A.MulticastCallback}return Object.defineProperty(e.prototype,"periods",{get:freeOnUnref(function(){return this.dashPeriods}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationMs",{get:freeOnUnref(function(){var e=this.mpdContext.mpd,t=e.period,n=t[t.length-1];return null==n.durationMs||"static"!==e.type&&null!=e.minimumUpdatePeriodMs?Qe.withDefault(e.mediaPresentationDurationMs,1/0):n.startMs+n.durationMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suggestedPresentationDelayMs",{get:freeOnUnref(function(){return this.mpdContext.mpd.suggestedPresentationDelayMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updatePeriodMs",{get:freeOnUnref(function(){return this.mpdRefresher.updatePeriodMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"utcMsAtZero",{get:freeOnUnref(function(){return this.mpdContext.mpd.availabilityStartTimeMs}),enumerable:!0,configurable:!0}),e.prototype.start=freeOnUnref(function(e){this.dashMediaRepresentationContext.sourceUrlStore.on("SourceUrlChange",this.onSourceUrlChange),"dynamic"===this.mpdContext.mpd.type&&this.mpdRefresher.start(e),null!=this.mpdRefresher.updatePeriodMs&&this.timeWindow.setUpdatePeriod(this.mpdRefresher.updatePeriodMs)}),e.prototype.stop=freeOnUnref(function(){this.dashMediaRepresentationContext.sourceUrlStore.off("SourceUrlChange",this.onSourceUrlChange),this.mpdAcquirer.stop(),this.mpdRefresher.stop();for(var e=0,t=this.dashPeriods.contents;e<t.length;e++){t[e].destroy()}}),e.prototype.applyFilters=freeOnUnref(function(e){this.mediaRepresentationFilters=e;for(var t=0,n=this.dashPeriods.contents;t<n.length;t++){n[t].applyFilters(e)}}),e.prototype.isFiniteMPD=freeOnUnref(function(){return"static"===this.mpdContext.mpd.type||null==this.mpdContext.minimumUpdatePeriodMs}),e.prototype.updateDashPeriods=freeOnUnref(function(e){for(var t=this.mpdContext.mpd;0!==e.length&&e[0].id!==t.period[0].id;)e.splice(0,1);if(e.length>t.period.length)throw new Error("New MediaRepresentation has removed periods from the leading edge!");for(var n=0,r=!1;n<e.length&&n<t.period.length&&e[n].id===t.period[n].id;){var i=this.isFiniteMPD()&&n===t.period.length-1,o=t.period[n];try{e[n].reset(t,o,o.durationMs,i)}catch(e){var a=o.startMs+o.durationMs-this.timeWindow.startMs;if(!(0===n&&a<100))throw e;r=!0}n++}if(n<e.length)throw new Error("New MediaRepresentation has replaced period "+e[n].id+" with "+t.period[n].id);for(;n<t.period.length;){i=this.isFiniteMPD()&&n===t.period.length-1;var s=new $d.DashPeriod(this.dashMediaRepresentationContext,this.timeWindow,t,t.period[n],t.period[n].startMs,t.period[n].durationMs,i);e.push(s),0!==this.mediaRepresentationFilters.length&&s.applyFilters(this.mediaRepresentationFilters),n++}return r&&e.splice(0,1),e}),e.prototype.toJSON=freeOnUnref(function(){return x.omit(this,["adaptationSet","dashMediaRepresentationContext","mediaRepresentationFilters","mpd","period","representation"])}),e})();t.DashMediaRepresentation=n}));e(np);np.DashMediaRepresentation;var rp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=["Prs","Manifest","Drm","Fragment"],r=de.get("CacheStatusTracker"),i=new(freeOnUnref(function(){function e(){this.cacheComponentReported=[]}return e.prototype.reset=freeOnUnref(function(){r.info("Tracker reset"),this.cacheComponentReported=[]}),e.prototype.reportCacheHit=freeOnUnref(function(t){this.cacheComponentReported.some(freeOnUnref(function(e){return e===t}))||(this.cacheComponentReported.push(t),r.info("Reported cache hit for component: "+t+". Cache hit components: "+this.cacheComponentReported.join(", ")+". Cache status: "+this.getCacheStatus()))}),e.prototype.getCacheStatus=freeOnUnref(function(){return 0===this.cacheComponentReported.length?"Miss":this.cacheComponentReported.length===n.length?"Full":"Partial"}),e})());t.CacheStatusTracker=i}));e(rp);rp.CacheStatusTracker;var ip=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CacheStatusTracker=rp.CacheStatusTracker}));e(ip);ip.CacheStatusTracker;var op=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.refreshImpl=e,this.changeCallback=new A.MulticastCallback}return Object.defineProperty(e.prototype,"valid",{get:freeOnUnref(function(){return null!=this.value}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contents",{get:freeOnUnref(function(){if(null==this.value)throw new Error("Attempted to read contents of a stale element!");return this.value}),enumerable:!0,configurable:!0}),e.prototype.onChange=freeOnUnref(function(e){this.changeCallback.add(e)}),e.prototype.offChange=freeOnUnref(function(e){this.changeCallback.remove(e)}),e.prototype.refresh=freeOnUnref(function(){return this.refreshImpl()}),e.prototype.setValue=freeOnUnref(function(e){this.value=e,this.changeCallback.invoke()}),e.prototype.clear=freeOnUnref(function(){delete this.value}),e})();t.DynamicElementImpl=n}));e(op);op.DynamicElementImpl;var ap=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createManifestKey=function(e,t){return void 0===t&&(t=null),null!=t?"manifest_"+e+"_"+t:"manifest_"+e}}));e(ap);ap.createManifestKey;var sp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("MPDStorage"),n=freeOnUnref(function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=Pt.localStorage.capabilities.isSupported;this.manifestIdentifier=n,this.manifestStorageKey=null!=t?ap.createManifestKey(t,n):null,this.storageContext={downloadOperationId:t,storageAccess:e},this.shouldReadStorage=1==(1&e)&&r,this.shouldWriteStorage=2==(2&e)&&r}return e.prototype.tryRetrieveMpdFromStorage=freeOnUnref(function(i){return this.shouldReadStorage?this.tryRetrieveManifestTextFromStorage(i).then(freeOnUnref(function(e){if(i.throwIfRequested(),null==e)return null;var t=Date.now(),n=JSON.parse(e),r=Date.now()-t;return q.metrics.putMetric("Manifest.DASH.Parse.Storage.Time",r,"ms"),n})).catch(freeOnUnref(function(e){return i.throwIfRequested(),o.error("An error happened when parsing manifest from storage: "+e),q.metrics.putMetric("Manifest.DASH.Download.Storage.Read.Error"),null})):lt.Promise.resolve(null)}),e.prototype.tryStoreMpd=freeOnUnref(function(e){return"static"!==e.type&&(this.shouldReadStorage=!1,this.shouldWriteStorage=!1),this.shouldWriteStorage?this.storeMPDTextToStorage(JSON.stringify(e)):lt.Promise.resolve()}),e.prototype.tryRetrieveManifestTextFromStorage=freeOnUnref(function(t){var n=this,r=this.storageContext.downloadOperationId;return null==r||null==this.manifestStorageKey?(o.info("LocalStorage: Retrieve manifest skip, downloadOperationId: "+r+", manifestStorageKey: "+this.manifestStorageKey),lt.Promise.resolve(null)):Pt.localStorage.getText(this.manifestStorageKey).then(freeOnUnref(function(e){return t.throwIfRequested(),null==e?o.info("LocalStorage: Retrieve manifest miss, target not found or accessible, manifestStorageKey: "+n.manifestStorageKey+", downloadOperationId: "+r):o.info("LocalStorage: Retrieve manifest success, size: "+e.length+", manifestStorageKey: "+n.manifestStorageKey+", downloadOperationId: "+r),e})).catch(freeOnUnref(function(e){return o.warn("LocalStorage: Retrieve manifest invalid (missing or failed fetch), manifestStorageKey: "+n.manifestStorageKey+", error: "+e.message+", downloadOperationId: "+r),null}))}),e.prototype.storeMPDTextToStorage=freeOnUnref(function(e){var t=this,n=this.storageContext.downloadOperationId;return null==n||null==this.manifestStorageKey?(o.warn("Manifest is expected to be persistent, but there is no valid download operation id"),lt.Promise.resolve()):(o.info("LocalStorage: Store manifest, size: "+e.length+", manifestStorageKey: "+this.manifestStorageKey+", downloadOperationId: "+n),Pt.localStorage.put(this.manifestStorageKey,e).catch(freeOnUnref(function(e){throw o.error("LocalStorage: Store manifest failed, manifestStorageKey: "+t.manifestStorageKey+", error: "+e.message+", downloadOperationId: "+n),q.metrics.putMetric("Manifest.DASH.Download.Storage.Write.Error"),e})))}),e.delete=freeOnUnref(function(e,t){return void 0===t&&(t=null),Pt.localStorage.remove(ap.createManifestKey(e,t))}),e})();t.MPDStorage=n}));e(sp);sp.MPDStorage;var lp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("MpdValidator");function f(e,t,n){throw q.metrics.putMetric(t),r.warn(n),new ct.XpError(e,void 0,n)}var n=freeOnUnref(function(){function e(){}return e.validatePublishTimeUpdating=freeOnUnref(function(e,t){if(null!=e&&(null!=t.publishTimeMs&&null!=e.publishTimeMs&&null!=t.minimumUpdatePeriodMs))if(t.publishTimeMs===e.publishTimeMs)f("manifest.stale","Manifest.DASH.Refresh.PublishTime.Stale","Previous and new MPD have same publish time ("+new Date(e.publishTimeMs).toISOString()+")");else if(t.publishTimeMs<e.publishTimeMs){f("manifest.negative","Manifest.DASH.Refresh.PublishTime.TimeWarp","MPD@publishTime went backwards in time: "+new Date(e.publishTimeMs).toISOString()+" -> "+new Date(t.publishTimeMs).toISOString())}}),e.validatePeriodSequences=freeOnUnref(function(e,t){if(null!=e){for(var n=t.period,r=e.period,i={},o=0,a=n;o<a.length;o++){i[""+a[o].id]=!0}for(var s=0,l=0;s<r.length&&!i[""+r[s].id];s++);for(;s<r.length&&l<n.length&&r[s].id===n[l].id;)s++,l++;s!==r.length&&(l===n.length&&f("manifest.incompatible.missing_periods","Manifest.DASH.Refresh.MissingPeriods","New MPD is missing periods at the leading edge. Old periods: "+r.map(freeOnUnref(function(e){return e.id}))+", New periods: "+n.map(freeOnUnref(function(e){return e.id}))),f("manifest.incompatible.replaced_periods","Manifest.DASH.Refresh.ReplacedPeriods","New MPD has replaced previously valid periods. Old periods: "+r.map(freeOnUnref(function(e){return e.id}))+", New periods: "+n.map(freeOnUnref(function(e){return e.id}))))}}),e.validateExplicitSegmentTimelineUpdating=freeOnUnref(function(e,t){if(null!=e){var n=t.mpd.minimumUpdatePeriodMs,r=e.latestAvailableMPDTimeMs,i=t.latestAvailableMPDTimeMs;null!=n&&r===i?f("manifest.stale","Manifest.DASH.Refresh.LastSegment.Stale","Manifest.DASH.Refresh.LastSegment.Stale: Manifest is still updating, but the leading edge position ("+i+"ms) has not changed"):i<r&&f("manifest.negative","Manifest.DASH.Refresh.LastSegment.TimeWarp","Manifest.DASH.Refresh.LastSegment.TimeWarp: leading edge position ("+r+"ms) went backwards -> "+i+"ms")}}),e})();t.MpdValidator=n}));e(lp);lp.MpdValidator;var fp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("PeriodDenormalizer"),n=freeOnUnref(function(){function i(){}return i.denormalize=freeOnUnref(function(e){for(var t="static"===e.type?0:NaN,n=e.period,r=0;r<n.length;r++)i.denormalizePeriod(e,t,n[r],n[r+1]),t=n[r].startMs+n[r].durationMs}),i.denormalizePeriod=freeOnUnref(function(e,t,n,r){if(null!=n.startMs&&(t=n.startMs),isNaN(t))throw new Error("Early Available Periods are not supported!");var i=NaN;if(null!=n.durationMs)i=n.durationMs;else if(null!=r){if(null==r.startMs)throw new Error("Unable to determine duration of period "+n.id);i=r.startMs-t}else i=Qe.withDefault(e.mediaPresentationDurationMs,1/0)-t;if(null!=r&&null!=r.startMs){var o=r.startMs-t-i;.1<Math.abs(o)&&(a.warn("Found a "+o+"ms gap between periods "+n.id+" and "+r.id),i=r.startMs-t)}return n.startMs=t,n.durationMs=i,n}),i})();t.PeriodDenormalizer=n}));e(fp);fp.PeriodDenormalizer;var up=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function i(e){this.elementName=e,this.elementNode={type:"Element",name:this.elementName,attributes:{},children:[]}}return i.prototype.getElementName=freeOnUnref(function(){return this.elementName}),i.prototype.onElementStart=freeOnUnref(function(e,t,n){this.elementNode.attributes=e(),this.parseContext=n}),i.prototype.onChildElementStart=freeOnUnref(function(e,t,n){var r=new i(e);return r.onElementStart(t,n,this.parseContext),r}),i.prototype.onChildElementEnd=freeOnUnref(function(e){this.elementNode.children.push(e.onElementEnd())}),i.prototype.onElementEnd=freeOnUnref(function(){return this.elementNode}),i.prototype.onText=freeOnUnref(function(e){this.elementNode.children.push({type:"Text",text:e()})}),i.prototype.onCData=freeOnUnref(function(e){this.onText(e)}),i})();t.ElementNodeHandler=n}));e(up);up.ElementNodeHandler;var cp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.onElementStart=freeOnUnref(function(e,t,n){this.parseContext=n}),e.prototype.onChildElementStart=freeOnUnref(function(e,t,n){return null}),e.prototype.onChildElementEnd=freeOnUnref(function(e){}),e})();t.LeafElementHandler=n}));e(cp);cp.LeafElementHandler;var dp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=[]),this.childHandlers={};for(var t=0,n=e;t<n.length;t++){var r=n[t];this.childHandlers[r.getElementName()]=r}}return e.prototype.addHandler=freeOnUnref(function(e){var t=e.getElementName();if(null!=this.childHandlers[t])throw new Error("Already have handler: "+t);this.childHandlers[t]=e}),e.prototype.removeHandler=freeOnUnref(function(e){var t=e.getElementName();this.childHandlers[t]===e&&(this.childHandlers[t]=null)}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){this.parseContext=n}),e.prototype.onChildElementStart=freeOnUnref(function(e,t,n){var r=this.childHandlers[e];return null!=r?(r.onElementStart(t,n,this.parseContext),r):null}),e.prototype.onChildElementEnd=freeOnUnref(function(e){}),e})();t.ParentElementHandler=n}));e(dp);var pp;dp.ParentElementHandler;freeOnUnref(function(e){e[e.ELEMENT=0]="ELEMENT",e[e.CLOSE_ELEMENT=1]="CLOSE_ELEMENT",e[e.COMMENT=2]="COMMENT",e[e.CDATA=3]="CDATA"})(pp||(pp={}));var hp="[:A-Z_a-z][:A-Z_a-z.0-9-]*",mp="[ \\r\\n\\t]*",yp=freeOnUnref(function(){});function gp(e,t,n){return e.startsWith?e.startsWith(n,t):e.substr(t,n.length)===n}var vp=freeOnUnref(function(){function y(){this.nameRegExp=new RegExp("("+hp+")","gm"),this.attributeRegExp=new RegExp("[ \\r\\n\\t]*([:A-Z_a-z][:A-Z_a-z.0-9-]*)[ \\r\\n\\t]*=[ \\r\\n\\t]*[\"']([^\"']*)[\"'][ \\r\\n\\t]*","gm"),this.onText=yp,this.onElementStart=yp,this.onElementEnd=yp,this.onCData=yp,this.onComment=yp}return y.prototype.parse=freeOnUnref(function(r){for(var e=this,t=null,n="\ufeff"===r.charAt(0)?1:0,i=n,o=this.onText,a=this.onElementStart,s=this.onElementEnd,l=this.nameRegExp,f=n;f<r.length;f++)if(null!==t){if(t===pp.ELEMENT){if(-1===(p=r.indexOf(y.ELEMENT_SUFFIX,f)))break;var u=null;l.lastIndex=f;var c=l.exec(r);if(null!==c&&(u=c[1],f=l.lastIndex),null===u&&(u=r.substring(f,p)),u){var d=r[p-1]===y.FORWARD_SLASH;a(u,freeOnUnref(function(){return e.extractAttributes(r,f,p)}),freeOnUnref(function(){if(d)return null;var e=new RegExp("</"+u+mp+">","gm");e.lastIndex=p;var t=e.exec(r);if(null!==t){var n=r.substring(p+1,t.index);return p=t.index-1,n}return null})),d&&s(u)}f=p}else if(t===pp.CLOSE_ELEMENT){if(-1===(p=r.indexOf(y.ELEMENT_SUFFIX,f)))break;s(r.substring(f,p)),f=p}else if(t===pp.CDATA){if(-1===(p=r.indexOf(y.CDATA_SUFFIX,f)))break;this.onCData(freeOnUnref(function(){return r.substring(f,p)})),f=p+2}else if(t===pp.COMMENT){var p;if(-1===(p=r.indexOf(y.COMMENT_SUFFIX,f)))break;this.onComment(freeOnUnref(function(){return r.substring(f,p)})),f=p+2}i=f+1,t=null}else if(r[f]===y.OPEN_BRACKET){0<f-i&&o(freeOnUnref(function(){return r.substring(i,f)}));var h=r[f+1];h===y.FORWARD_SLASH?(t=pp.CLOSE_ELEMENT,f+=1):h===y.EXCLAMATION_POINT?gp(r,f+2,y.CDATA_PREFIX)?(t=pp.CDATA,f+=8):gp(r,f+2,y.COMMENT_PREFIX)&&(t=pp.COMMENT,f+=3):t=pp.ELEMENT}else{var m=r.indexOf(y.OPEN_BRACKET,f);f=0<m?m-1:r.length-1}}),y.prototype.extractAttributes=freeOnUnref(function(e,t,n){var r=e.substring(t,n);t=0,n=r.length;var i={},o=this.attributeRegExp;for(o.lastIndex=t;o.lastIndex<n;){var a=o.exec(r);if(null===a)break;var s=a[1],l=a[2];i[s]=l}return i}),y.OPEN_BRACKET="<",y.FORWARD_SLASH="/",y.EXCLAMATION_POINT="!",y.CDATA_PREFIX="[CDATA[",y.CDATA_SUFFIX="]]>",y.ELEMENT_SUFFIX=">",y.COMMENT_PREFIX="--",y.COMMENT_SUFFIX="--\x3e",y})(),Op=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.optionallyCopyNumber=freeOnUnref(function(e,t,n){"string"==typeof e[n]&&(t[n]=Number(e[n]))}),e.optionallyCopyBoolean=freeOnUnref(function(e,t,n){if("string"==typeof e[n]){var r=e[n].toLowerCase();"true"===r?t[n]=!0:"false"===r&&(t[n]=!1)}}),e.optionallyCopyString=freeOnUnref(function(e,t,n){"string"==typeof e[n]&&(t[n]=e[n])}),e.textSnippet=freeOnUnref(function(e,t){return e.length<=t?e:e.substr(0,t)+"..."}),e})();t.Utilities=n}));e(Op);Op.Utilities;var Sp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=new vp);var a=this;this.parseContext=null,this.handlerStack=[],this.result=null,this.onElementStart=freeOnUnref(function(e,t,n){var r=a.handlerStack[a.handlerStack.length-1];if(null!=r){var i=r.onChildElementStart(e,t,n);null!=i&&a.handlerStack.push(i)}else if(e===a.rootHandler.getElementName()){var o=null!=a.parseContext?a.parseContext:{};a.rootHandler.onElementStart(t,n,o),a.handlerStack.push(a.rootHandler)}}),this.onElementEnd=freeOnUnref(function(e){var t=a.handlerStack[a.handlerStack.length-1];if(null!=t&&t.getElementName()===e){a.handlerStack.pop();var n=a.handlerStack[a.handlerStack.length-1];null!=n?n.onChildElementEnd(t):a.result=t.onElementEnd()}}),this.onText=freeOnUnref(function(e){var t=a.handlerStack[a.handlerStack.length-1];null!=t&&null!=t.onText&&t.onText(e)}),this.onCData=freeOnUnref(function(e){var t=a.handlerStack[a.handlerStack.length-1];null!=t&&null!=t.onCData&&t.onCData(e)}),this.fastSaxParser=e}return e.prototype.parse=freeOnUnref(function(e,t,n){this.rootHandler=e,this.parseContext=null!=n?n:null,this.fastSaxParser.onElementStart=this.onElementStart,this.fastSaxParser.onElementEnd=this.onElementEnd,this.fastSaxParser.onText=this.onText,this.fastSaxParser.onCData=this.onCData,this.fastSaxParser.parse(t);var r=this.result;if(this.result=null,(this.parseContext=null)==r&&null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.xmlParser&&!0===L.configurationStore.configuration.xmlParser.throwOnParseError)throw new Error("Failed to parse XML, expected root element name: "+e.getElementName()+". Input XML: "+Op.Utilities.textSnippet(t,100));return r}),e.prototype.parseContents=freeOnUnref(function(e,t){if(this.handlerStack.push(e),this.fastSaxParser.onElementStart=this.onElementStart,this.fastSaxParser.onElementEnd=this.onElementEnd,this.fastSaxParser.onText=this.onText,this.fastSaxParser.onCData=this.onCData,this.fastSaxParser.parse(t),1!==this.handlerStack.length)throw new Error("Unexpected final stack size: "+this.handlerStack.length);return this.handlerStack.pop(),e.onElementEnd()}),e})();t.Parser=n}));e(Sp);Sp.Parser;var Up=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.elementName=e}return e.prototype.getElementName=freeOnUnref(function(){return this.elementName}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){}),e.prototype.onChildElementStart=freeOnUnref(function(e,t,n){return null}),e.prototype.onChildElementEnd=freeOnUnref(function(e){}),e.prototype.onText=freeOnUnref(function(e){this.result=e()}),e.prototype.onElementEnd=freeOnUnref(function(){return this.result}),e})();t.TextOnlyLeafHandler=n}));e(Up);Up.TextOnlyLeafHandler;var bp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ElementNodeHandler=up.ElementNodeHandler,t.LeafElementHandler=cp.LeafElementHandler,t.ParentElementHandler=dp.ParentElementHandler,t.Parser=Sp.Parser,t.TextOnlyLeafHandler=Up.TextOnlyLeafHandler,t.Utilities=Op.Utilities}));e(bp);bp.ElementNodeHandler,bp.LeafElementHandler,bp.ParentElementHandler,bp.Parser,bp.TextOnlyLeafHandler,bp.Utilities;var Pp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.requiredStringList=freeOnUnref(function(e,t){if(t in e)return e[t].split(",").map(freeOnUnref(function(e){return e.trim()}));throw new Error('Missing "'+t+'" attribute!')}),e.optionalStringList=freeOnUnref(function(e,t,n){return t in e?e[t].split(",").map(freeOnUnref(function(e){return e.trim()})):n}),e.optionalDateTime=freeOnUnref(function(e,t,n){if(t in e){var r=e[t].indexOf("T");return-1!==r&&-1===e[t].indexOf("Z",r)&&-1===e[t].indexOf("-",r)&&-1===e[t].indexOf("+",r)&&(e[t]+="Z"),new Date(e[t]).getTime()}return n}),e.requiredISODuration=freeOnUnref(function(e,t){if(t in e)return jr.isoToMillis(e[t]);throw new Error('Missing "'+t+'" attribute!')}),e.optionalISODuration=freeOnUnref(function(e,t,n){return t in e?jr.isoToMillis(e[t]):n}),e.optionalBoolean=freeOnUnref(function(e,t,n){return t in e?"true"===e[t]:n}),e.requiredNumber=freeOnUnref(function(e,t){if(t in e)return parseFloat(e[t]);throw new Error('Missing "'+t+'" attribute!')}),e.optionalNumber=freeOnUnref(function(e,t,n){return t in e?parseFloat(e[t]):n}),e.optionalIntOrBoolean=freeOnUnref(function(e,t,n){return t in e?"true"===e[t]||"false"!==e[t]&&parseInt(e[t]):n}),e.optionalNumberOrRange=freeOnUnref(function(e,t,n){if(t in e){var r=e[t].trim();if(-1!==r.indexOf(" ")){var i=r.split(" ");return{min:parseInt(i[0]),max:parseInt(i[1])}}return parseInt(r)}return n}),e.optionalByteRange=freeOnUnref(function(e,t){if(t in e){var n=e[t].split("-");return{start:parseInt(n[0]),end:2===n.length?parseInt(n[1]):void 0}}}),e.extractXLink=freeOnUnref(function(e){if("xlink:href"in e)return{href:e["xlink:href"],actuate:"onLoad"===e["xlink:actuate"]?"onLoad":"onRequest"}}),e})();t.ParseUtils=n}));e(Pp);Pp.ParseUtils;var Mp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){var e=null!==i&&i.apply(this,arguments)||this;return e.baseUrl=null,e}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"BaseURL"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.baseUrl={serviceLocation:r.serviceLocation,byteRangeTemplate:r.byteRange,availabilityTimeOffsetMs:Pp.ParseUtils.optionalNumber(r,"availabilityTimeOffset"),availabilityTimeComplete:Pp.ParseUtils.optionalBoolean(r,"availabilityTimeComplete"),baseUrl:""}}),e.prototype.onText=freeOnUnref(function(e){this.baseUrl.baseUrl=e()}),e.prototype.onElementEnd=freeOnUnref(function(){return this.baseUrl}),e})(bp.LeafElementHandler);t.BaseURLHandler=r}));e(Mp);Mp.BaseURLHandler;var Cp=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this)||this;return t.text=null,t.elementName=e,t}return r(e,n),e.prototype.getElementName=freeOnUnref(function(){return this.elementName}),e.prototype.onText=freeOnUnref(function(e){this.text=e()}),e.prototype.onElementEnd=freeOnUnref(function(){return{name:this.elementName,text:this.text}}),e})(bp.LeafElementHandler);t.SimpleElementHandler=n}));e(Cp);Cp.SimpleElementHandler;var Ep=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.childHandlers=[new Cp.SimpleElementHandler("cenc:pssh")]}return e.prototype.processAttributes=freeOnUnref(function(e,t){var n=e;n.defaultKID=t["cenc:default_KID"],n.robustness=t.robustness,n.ref=t.ref,n.refId=t.refId}),e.prototype.childElementEnd=freeOnUnref(function(e,t){var n=e;"cenc:pssh"===t.getElementName()&&(null==n.pssh&&(n.pssh=[]),n.pssh.push(t.onElementEnd().text))}),e})();t.CencContentProtectionDescriptorHandler=n}));e(Ep);Ep.CencContentProtectionDescriptorHandler;var Tp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={"urn:mpeg:dash:mp4protection:2011":new Ep.CencContentProtectionDescriptorHandler,"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":new Ep.CencContentProtectionDescriptorHandler,"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":new Ep.CencContentProtectionDescriptorHandler};t.ContentProtectionDescriptors=n}));e(Tp);Tp.ContentProtectionDescriptors;var wp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(l){function e(e,t){void 0===t&&(t={});var n=l.call(this,[])||this;return n.descriptor=null,n.handlers=t,n.elementName=e,n}return n(e,l),e.prototype.getElementName=freeOnUnref(function(){return this.elementName}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){l.prototype.onElementStart.call(this,e,t,n);var r=e();this.descriptor={schemeIdUri:r.schemeIdUri,id:r.id,value:r.value};var i=this.descriptor.schemeIdUri.toLowerCase();if(0===i.indexOf("urn:uuid:")&&(this.descriptor.schemeIdUri=i),null!=this.handlers[this.descriptor.schemeIdUri]){this.handlers[this.descriptor.schemeIdUri].processAttributes(this.descriptor,r);for(var o=0,a=this.handlers[this.descriptor.schemeIdUri].childHandlers;o<a.length;o++){var s=a[o];this.addHandler(s)}}}),e.prototype.onChildElementEnd=freeOnUnref(function(e){null!=this.handlers[this.descriptor.schemeIdUri]&&this.handlers[this.descriptor.schemeIdUri].childElementEnd(this.descriptor,e)}),e.prototype.onElementEnd=freeOnUnref(function(){if(null!=this.handlers[this.descriptor.schemeIdUri])for(var e=0,t=this.handlers[this.descriptor.schemeIdUri].childHandlers;e<t.length;e++){var n=t[e];this.removeHandler(n)}return{name:this.elementName,descriptor:this.descriptor}}),e})(bp.ParentElementHandler);t.DescriptorHandler=r}));e(wp);wp.DescriptorHandler;var Ip=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){var e=null!==i&&i.apply(this,arguments)||this;return e.segmentDurations=null,e.segmentTimeline=null,e}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"EncodedSegmentDurations"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.segmentTimeline={entries:[]},this.segmentDurations={timescale:Pp.ParseUtils.requiredNumber(r,"timescale"),segmentTimeline:this.segmentTimeline,segmentURLs:[],indexRangeExact:!1}}),e.prototype.onText=freeOnUnref(function(e){for(var t,n=e(),r=n.length,i=0,o=0;o<r;){var a=this.readNumber(n,o);if(o+=9,null!=t&&t.d===a)t.r++,i+=a;else{var s={type:"S",seq:o,t:i,r:0,d:a};this.segmentTimeline.entries.push(s),i=s.t+(s.r+1)*s.d,t=s}}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.segmentDurations}),e.prototype.readNumber=freeOnUnref(function(e,t){for(var n=0,r=0;r<8;t++,r++)n=n<<4|parseInt(e[t],16);return n}),e})(bp.LeafElementHandler);t.EncodedSegmentDurationsHandler=r}));e(Ip);Ip.EncodedSegmentDurationsHandler;var kp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){var e=null!==i&&i.apply(this,arguments)||this;return e.segmentList=null,e}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"EncodedSegmentList"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.segmentList={segmentURLs:[],duration:Pp.ParseUtils.optionalNumber(r,"duration"),timescale:Pp.ParseUtils.optionalNumber(r,"timescale"),indexRangeExact:!1}}),e.prototype.onText=freeOnUnref(function(e){var t=this.segmentList.segmentURLs,n=e(),r=n.length,i=0,o=this.readNumber(n,i);i+=17;var a=this.readNumber(n,i);for(i+=17,this.segmentList.initialization={range:{start:o,end:a}};i<r;){var s=this.readNumber(n,i);i+=17;var l=this.readNumber(n,i);i+=17,t.push({mediaRange:{start:s,end:l}})}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.segmentList}),e.prototype.readNumber=freeOnUnref(function(e,t){for(var n=0,r=0;r<16;t++,r++)n=n<<4|parseInt(e[t],16);return n}),e})(bp.LeafElementHandler);t.EncodedSegmentListHandler=r}));e(kp);kp.EncodedSegmentListHandler;var _p=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(e){var t=i.call(this)||this;return t.url=null,t.elementName=e,t}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return this.elementName}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.url={sourceUrl:r.sourceURL,range:Pp.ParseUtils.optionalByteRange(r,"range")}}),e.prototype.onElementEnd=freeOnUnref(function(){return{name:this.elementName,url:this.url}}),e})(bp.LeafElementHandler);t.URLTypeHandler=r}));e(_p);_p.URLTypeHandler;var Rp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){var e=i.call(this,[new _p.URLTypeHandler("Initialization"),new _p.URLTypeHandler("RepresentationIndex")])||this;return e.segmentBase=null,e}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"SegmentBase"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.segmentBase={timescale:Pp.ParseUtils.optionalNumber(r,"timescale"),presentationTimeOffset:Pp.ParseUtils.optionalNumber(r,"presentationTimeOffset"),timeShiftBufferDepthMs:Pp.ParseUtils.optionalISODuration(r,"timeShiftBufferDepth"),indexRange:Pp.ParseUtils.optionalByteRange(r,"indexRange"),indexRangeExact:Pp.ParseUtils.optionalBoolean(r,"indexRangeExact",!1),availabilityTimeOffsetMs:Pp.ParseUtils.optionalNumber(r,"availabilityTimeOffset"),availabilityTimeComplete:Pp.ParseUtils.optionalBoolean(r,"availabilityTimeComplete")}}),e.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"Initialization":this.segmentBase.initialization=e.onElementEnd().url;break;case"RepresentationIndex":this.segmentBase.representationIndex=e.onElementEnd().url}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.segmentBase}),e})(bp.ParentElementHandler);t.SegmentBaseHandler=r}));e(Rp);Rp.SegmentBaseHandler;var Ap=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){var e=null!==i&&i.apply(this,arguments)||this;return e.element=null,e.nextT=0,e.nextSeq=0,e}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"Pattern"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.element={type:"Pattern",seq:-1,t:Pp.ParseUtils.optionalNumber(r,"t",-1),d:0,r:Pp.ParseUtils.optionalNumber(r,"r",0),numSegments:0,S:[]},this.nextSeq=0,this.nextT=0}),e.prototype.onChildElementStart=freeOnUnref(function(e,t){if("S"===e){var n=t(),r={type:"S",seq:this.nextSeq,t:this.nextT,d:Pp.ParseUtils.requiredNumber(n,"d"),r:Pp.ParseUtils.optionalNumber(n,"r",0)};this.element.S.push(r),this.nextSeq+=r.r+1,this.nextT+=(r.r+1)*r.d}return null}),e.prototype.onElementEnd=freeOnUnref(function(){return this.element.numSegments=this.nextSeq,this.element.d=this.nextT,this.element}),e})(bp.LeafElementHandler);t.PatternHandler=r}));e(Ap);Ap.PatternHandler;var Dp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(a){function e(){var e=a.call(this,[new Ap.PatternHandler])||this;return e.segmentTimeline=null,e.nextT=0,e.nextSeq=0,e}return n(e,a),e.prototype.getElementName=freeOnUnref(function(){return"SegmentTimeline"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){a.prototype.onElementStart.call(this,e,t,n);var r=n.segmentTemplateCache;if(null!=r&&r.segmentsAligned&&null!=r.segmentTimeline)return this.segmentTimeline=r.segmentTimeline,void t();this.segmentTimeline={entries:[]},this.nextT=0,this.nextSeq=0}),e.prototype.onChildElementStart=freeOnUnref(function(e,t,n){if("S"===e){var r=t(),i=Pp.ParseUtils.optionalNumber(r,"t",this.nextT),o={type:"S",seq:this.nextSeq,t:i,d:Pp.ParseUtils.requiredNumber(r,"d"),r:Pp.ParseUtils.optionalNumber(r,"r",0)};return this.segmentTimeline.entries.push(o),this.nextT=o.t+(o.r+1)*o.d,this.nextSeq+=o.r+1,null}return a.prototype.onChildElementStart.call(this,e,t,n)}),e.prototype.onChildElementEnd=freeOnUnref(function(e){if("Pattern"===e.getElementName()){var t=e.onElementEnd();-1===t.t&&(t.t=this.nextT),t.seq=this.nextSeq,this.nextT=t.t+t.d*(t.r+1),this.nextSeq+=t.numSegments*(t.r+1),this.segmentTimeline.entries.push(t)}}),e.prototype.onElementEnd=freeOnUnref(function(){var e=this.parseContext;return null!=e.segmentTemplateCache&&null==e.segmentTemplateCache.segmentTimeline&&(e.segmentTemplateCache.segmentTimeline=this.segmentTimeline),this.segmentTimeline}),e})(bp.ParentElementHandler);t.SegmentTimelineHandler=r}));e(Dp);Dp.SegmentTimelineHandler;var xp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){var e=i.call(this,[new Dp.SegmentTimelineHandler,new _p.URLTypeHandler("BitstreamSwitching"),new _p.URLTypeHandler("Initialization"),new _p.URLTypeHandler("RepresentationIndex")])||this;return e.segmentList=null,e}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"SegmentList"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.segmentList={xlink:Pp.ParseUtils.extractXLink(r),segmentURLs:[],duration:Pp.ParseUtils.optionalNumber(r,"duration"),startNumber:Pp.ParseUtils.optionalNumber(r,"startNumber"),timescale:Pp.ParseUtils.optionalNumber(r,"timescale"),presentationTimeOffset:Pp.ParseUtils.optionalNumber(r,"presentationTimeOffset"),timeShiftBufferDepthMs:Pp.ParseUtils.optionalISODuration(r,"timeShiftBufferDepth"),indexRange:Pp.ParseUtils.optionalByteRange(r,"indexRange"),indexRangeExact:Pp.ParseUtils.optionalBoolean(r,"indexRangeExact",!1),availabilityTimeOffsetMs:Pp.ParseUtils.optionalNumber(r,"availabilityTimeOffset"),availabilityTimeComplete:Pp.ParseUtils.optionalBoolean(r,"availabilityTimeComplete")}}),e.prototype.onChildElementStart=freeOnUnref(function(e,t,n){if("SegmentURL"===e){var r=t();return this.segmentList.segmentURLs.push({media:r.media,mediaRange:Pp.ParseUtils.optionalByteRange(r,"mediaRange"),index:r.index,indexRange:Pp.ParseUtils.optionalByteRange(r,"indexRange")}),null}return i.prototype.onChildElementStart.call(this,e,t,n)}),e.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"Initialization":this.segmentList.initialization=e.onElementEnd().url;break;case"RepresentationIndex":this.segmentList.representationIndex=e.onElementEnd().url;break;case"BitstreamSwitching":this.segmentList.bitstreamSwitching=e.onElementEnd().url;break;case"SegmentTimeline":this.segmentList.segmentTimeline=e.onElementEnd()}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.segmentList}),e})(bp.ParentElementHandler);t.SegmentListHandler=r}));e(xp);xp.SegmentListHandler;var Fp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(s){function e(){var e=s.call(this,[new Dp.SegmentTimelineHandler,new _p.URLTypeHandler("BitstreamSwitching"),new _p.URLTypeHandler("Initialization"),new _p.URLTypeHandler("RepresentationIndex")])||this;return e.segmentTemplate=null,e}return n(e,s),e.prototype.getElementName=freeOnUnref(function(){return"SegmentTemplate"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){s.prototype.onElementStart.call(this,e,t,n);var r=e(),i=n.segmentTemplateCache,o=Pp.ParseUtils.optionalNumber(r,"timescale"),a=Pp.ParseUtils.optionalNumber(r,"presentationTimeOffset");null!=i&&i.segmentsAligned&&(null!=i.timescale&&null!=i.presentationTimeOffset?(o=i.timescale,a=i.presentationTimeOffset):(i.timescale=o,i.presentationTimeOffset=a)),this.segmentTemplate={mediaTemplate:r.media,indexTemplate:r.index,initializationTemplate:r.initialization,bitstreamSwitchingTemplate:r.bitstreamSwitching,duration:Pp.ParseUtils.optionalNumber(r,"duration"),startNumber:Pp.ParseUtils.optionalNumber(r,"startNumber"),timescale:o,presentationTimeOffset:a,timeShiftBufferDepthMs:Pp.ParseUtils.optionalISODuration(r,"timeShiftBufferDepth"),indexRange:Pp.ParseUtils.optionalByteRange(r,"indexRange"),indexRangeExact:Pp.ParseUtils.optionalBoolean(r,"indexRangeExact",!1),availabilityTimeOffsetMs:Pp.ParseUtils.optionalNumber(r,"availabilityTimeOffset"),availabilityTimeComplete:Pp.ParseUtils.optionalBoolean(r,"availabilityTimeComplete")}}),e.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"Initialization":this.segmentTemplate.initialization=e.onElementEnd().url;break;case"RepresentationIndex":this.segmentTemplate.representationIndex=e.onElementEnd().url;break;case"BitstreamSwitching":this.segmentTemplate.bitstreamSwitching=e.onElementEnd().url;break;case"SegmentTimeline":this.segmentTemplate.segmentTimeline=e.onElementEnd()}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.segmentTemplate}),e})(bp.ParentElementHandler);t.SegmentTemplateHandler=r}));e(Fp);Fp.SegmentTemplateHandler;var Bp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){var e=null!==i&&i.apply(this,arguments)||this;return e.md=null,e}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"MD"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.md={id:r.id,value:""}}),e.prototype.onText=freeOnUnref(function(e){this.md.value=e()}),e.prototype.onElementEnd=freeOnUnref(function(){return this.md}),e})(bp.LeafElementHandler);t.MDHandler=r}));e(Bp);Bp.MDHandler;var Lp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("OnDemandSegmentTemplate");function n(){return null}var r=freeOnUnref(function(){function e(e,t){this.parsedSegmentTemplate=null,this.handler=e,this.elementParseInfo=t,this.elementParseInfo.parseContext={segmentTemplateCache:t.parseContext.segmentTemplateCache}}return e.prototype.getSegmentTemplate=freeOnUnref(function(){if(null==this.parsedSegmentTemplate){var e=null!==this.elementParseInfo.contents?this.elementParseInfo.contents:"";this.elementParseInfo.contents=null,this.handler.onElementStart(this.elementParseInfo.getAttributes,n,this.elementParseInfo.parseContext),this.parsedSegmentTemplate=(new bp.Parser).parseContents(this.handler,e)}return this.parsedSegmentTemplate}),Object.defineProperty(e.prototype,"mediaTemplate",{get:freeOnUnref(function(){return this.getSegmentTemplate().mediaTemplate}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexTemplate",{get:freeOnUnref(function(){return this.getSegmentTemplate().indexTemplate}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initializationTemplate",{get:freeOnUnref(function(){return this.getSegmentTemplate().initializationTemplate}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bitstreamSwitchingTemplate",{get:freeOnUnref(function(){return this.getSegmentTemplate().bitstreamSwitchingTemplate}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:freeOnUnref(function(){return this.getSegmentTemplate().duration}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startNumber",{get:freeOnUnref(function(){return this.getSegmentTemplate().startNumber}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timescale",{get:freeOnUnref(function(){return this.getSegmentTemplate().timescale}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"presentationTimeOffset",{get:freeOnUnref(function(){return this.getSegmentTemplate().presentationTimeOffset}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeShiftBufferDepthMs",{get:freeOnUnref(function(){return this.getSegmentTemplate().timeShiftBufferDepthMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexRange",{get:freeOnUnref(function(){return this.getSegmentTemplate().indexRange}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexRangeExact",{get:freeOnUnref(function(){return this.getSegmentTemplate().indexRangeExact}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availabilityTimeOffsetMs",{get:freeOnUnref(function(){return this.getSegmentTemplate().availabilityTimeOffsetMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availabilityTimeComplete",{get:freeOnUnref(function(){return this.getSegmentTemplate().availabilityTimeComplete}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initialization",{get:freeOnUnref(function(){return this.getSegmentTemplate().initialization}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"representationIndex",{get:freeOnUnref(function(){return this.getSegmentTemplate().representationIndex}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bitstreamSwitching",{get:freeOnUnref(function(){return this.getSegmentTemplate().bitstreamSwitching}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentTimeline",{get:freeOnUnref(function(){return this.getSegmentTemplate().segmentTimeline}),enumerable:!0,configurable:!0}),e})();t.OnDemandSegmentTemplate=r}));e(Lp);Lp.OnDemandSegmentTemplate;var Np=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.wrapAsClosure=function(e){return freeOnUnref(function(){return e})}}));e(Np);Np.wrapAsClosure;var Vp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,[])||this;return n.baseHandler=e,n.createOnDemandResult=t,n}return n(e,r),e.prototype.getElementName=freeOnUnref(function(){return this.baseHandler.getElementName()}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){var r=e(),i=t();this.elementParseInfo={getAttributes:Np.wrapAsClosure(r),parseContext:n,contents:i}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.createOnDemandResult(this.baseHandler,this.elementParseInfo)}),e})(bp.ParentElementHandler);t.OnDemandParseElementHandler=r}));e(Vp);Vp.OnDemandParseElementHandler;var jp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){var e=i.call(this,[new Mp.BaseURLHandler,new Rp.SegmentBaseHandler,new xp.SegmentListHandler,new Vp.OnDemandParseElementHandler(new Fp.SegmentTemplateHandler,freeOnUnref(function(e,t){return new Lp.OnDemandSegmentTemplate(e,t)})),new kp.EncodedSegmentListHandler,new Bp.MDHandler,new wp.DescriptorHandler("FramePacking"),new wp.DescriptorHandler("AudioChannelConfiguration"),new wp.DescriptorHandler("ContentProtection",Tp.ContentProtectionDescriptors),new wp.DescriptorHandler("EssentialProperty"),new wp.DescriptorHandler("SupplementalProperty"),new wp.DescriptorHandler("InbandEventStream")])||this;return e.representation=null,e}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"Representation"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.representation={id:r.id,bandwidth:Pp.ParseUtils.requiredNumber(r,"bandwidth"),qualityRanking:Pp.ParseUtils.optionalNumber(r,"qualityRanking"),dependencyId:Pp.ParseUtils.optionalStringList(r,"dependencyId"),mediaStreamStructureId:Pp.ParseUtils.optionalStringList(r,"mediaStreamStructureId"),profiles:Pp.ParseUtils.optionalStringList(r,"profiles",[]),width:Pp.ParseUtils.optionalNumber(r,"width"),height:Pp.ParseUtils.optionalNumber(r,"height"),sar:r.sar,frameRate:r.frameRate,audioSamplingRate:Pp.ParseUtils.optionalNumberOrRange(r,"audioSamplingRate"),mimeType:r.mimeType,segmentProfiles:Pp.ParseUtils.optionalStringList(r,"segmentProfiles"),codecs:Pp.ParseUtils.optionalStringList(r,"codecs"),maximumSAPPeriod:Pp.ParseUtils.optionalNumber(r,"maximumSAPPeriod"),startWithSAP:Pp.ParseUtils.optionalNumber(r,"startWithSAP"),maxPlayoutRate:Pp.ParseUtils.optionalNumber(r,"maxPlayoutRate"),codingDependency:Pp.ParseUtils.optionalBoolean(r,"codingDependency"),scanType:r.scanType}}),e.prototype.onChildElementEnd=freeOnUnref(function(e){var t=this.representation;switch(e.getElementName()){case"BaseURL":null==t.baseUrl&&(t.baseUrl=[]),t.baseUrl.push(e.onElementEnd());break;case"FramePacking":null==t.framePacking&&(t.framePacking=[]),t.framePacking.push(e.onElementEnd().descriptor);break;case"AudioChannelConfiguration":null==t.audioChannelConfiguration&&(t.audioChannelConfiguration=[]),t.audioChannelConfiguration.push(e.onElementEnd().descriptor);break;case"ContentProtection":null==t.contentProtection&&(t.contentProtection=[]),t.contentProtection.push(e.onElementEnd().descriptor);break;case"EssentialProperty":null==t.essentialProperty&&(t.essentialProperty=[]),t.essentialProperty.push(e.onElementEnd().descriptor);break;case"SupplementalProperty":null==t.supplementalProperty&&(t.supplementalProperty=[]),t.supplementalProperty.push(e.onElementEnd().descriptor);break;case"InbandEventStream":null==t.inbandEventStream&&(t.inbandEventStream=[]),t.inbandEventStream.push(e.onElementEnd().descriptor);break;case"SegmentBase":t.segmentBase=e.onElementEnd();break;case"SegmentTemplate":t.segmentTemplate=e.onElementEnd();break;case"EncodedSegmentList":case"SegmentList":t.segmentList=e.onElementEnd();break;case"MD":t.md=e.onElementEnd()}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.representation}),e})(bp.ParentElementHandler);t.RepresentationHandler=r}));e(jp);jp.RepresentationHandler;var qp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){var e=i.call(this,[])||this;return e.segmentDurations=null,e.segmentTimeline=null,e.nextT=0,e.nextSeq=0,e}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"SegmentDurations"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.segmentTimeline={entries:[]},this.segmentDurations={timescale:Pp.ParseUtils.requiredNumber(r,"timescale"),segmentTimeline:this.segmentTimeline,segmentURLs:[],indexRangeExact:!1},this.nextT=0,this.nextSeq=0}),e.prototype.onChildElementStart=freeOnUnref(function(e,t){if("S"===e){var n=t(),r=Pp.ParseUtils.requiredNumber(n,"d"),i=this.segmentTimeline.entries[this.segmentTimeline.entries.length-1];if(null!=i&&i.d===r)i.r++,this.nextT+=r;else{var o={type:"S",seq:this.nextSeq,t:this.nextT,r:0,d:r};this.segmentTimeline.entries.push(o),this.nextT=o.t+(o.r+1)*o.d}this.nextSeq++}return null}),e.prototype.onElementEnd=freeOnUnref(function(){return this.segmentDurations}),e})(bp.ParentElementHandler);t.SegmentDurationsHandler=r}));e(qp);qp.SegmentDurationsHandler;var Hp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(e){this.segmentsAligned=e}})();t.SegmentTemplateCache=n}));e(Hp);Hp.SegmentTemplateCache;var zp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(o){function e(){var e=o.call(this,[new wp.DescriptorHandler("Accessibility"),new wp.DescriptorHandler("Role"),new wp.DescriptorHandler("Rating"),new wp.DescriptorHandler("Viewpoint"),new Mp.BaseURLHandler,new Rp.SegmentBaseHandler,new xp.SegmentListHandler,new Fp.SegmentTemplateHandler,new qp.SegmentDurationsHandler,new Ip.EncodedSegmentDurationsHandler,new jp.RepresentationHandler,new Cp.SimpleElementHandler("Label"),new wp.DescriptorHandler("FramePacking"),new wp.DescriptorHandler("AudioChannelConfiguration"),new wp.DescriptorHandler("ContentProtection",Tp.ContentProtectionDescriptors),new wp.DescriptorHandler("EssentialProperty"),new wp.DescriptorHandler("SupplementalProperty"),new wp.DescriptorHandler("InbandEventStream")])||this;return e.adaptationSet=null,e}return n(e,o),e.prototype.getElementName=freeOnUnref(function(){return"AdaptationSet"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){o.prototype.onElementStart.call(this,e,t,n);var r=e();this.adaptationSet={xlink:Pp.ParseUtils.extractXLink(r),id:Pp.ParseUtils.optionalNumber(r,"id"),audioTrackId:r.audioTrackId,group:Pp.ParseUtils.optionalNumber(r,"group"),lang:r.lang,contentType:r.contentType,par:r.par,minBandwidth:Pp.ParseUtils.optionalNumber(r,"minBandwidth"),maxBandwidth:Pp.ParseUtils.optionalNumber(r,"maxBandwidth"),minWidth:Pp.ParseUtils.optionalNumber(r,"minWidth"),maxWidth:Pp.ParseUtils.optionalNumber(r,"maxWidth"),minHeight:Pp.ParseUtils.optionalNumber(r,"minHeight"),maxHeight:Pp.ParseUtils.optionalNumber(r,"maxHeight"),minFramerate:r.minFramerate,maxFramerate:r.maxFramerate,segmentAlignment:Pp.ParseUtils.optionalIntOrBoolean(r,"segmentAlignment",!1),bitstreamSwitching:Pp.ParseUtils.optionalBoolean(r,"bitstreamSwitching"),subsegmentAlignment:Pp.ParseUtils.optionalIntOrBoolean(r,"subsegmentAlignment",!1),subsegmentStartsWithSAP:Pp.ParseUtils.optionalNumber(r,"subsegmentStartsWithSAP",0),representation:[],profiles:Pp.ParseUtils.optionalStringList(r,"profiles",[]),width:Pp.ParseUtils.optionalNumber(r,"width"),height:Pp.ParseUtils.optionalNumber(r,"height"),sar:r.sar,frameRate:r.frameRate,audioSamplingRate:Pp.ParseUtils.optionalNumberOrRange(r,"audioSamplingRate"),mimeType:r.mimeType,segmentProfiles:Pp.ParseUtils.optionalStringList(r,"segmentProfiles"),codecs:Pp.ParseUtils.optionalStringList(r,"codecs"),maximumSAPPeriod:Pp.ParseUtils.optionalNumber(r,"maximumSAPPeriod"),startWithSAP:Pp.ParseUtils.optionalNumber(r,"startWithSAP"),maxPlayoutRate:Pp.ParseUtils.optionalNumber(r,"maxPlayoutRate"),codingDependency:Pp.ParseUtils.optionalBoolean(r,"codingDependency"),scanType:r.scanType};var i=!0===this.adaptationSet.segmentAlignment;n.segmentTemplateCache=new Hp.SegmentTemplateCache(i)}),e.prototype.onChildElementEnd=freeOnUnref(function(e){var t=this.adaptationSet;switch(e.getElementName()){case"BaseURL":null==t.baseUrl&&(t.baseUrl=[]),t.baseUrl.push(e.onElementEnd());break;case"Accessibility":null==t.accessibility&&(t.accessibility=[]),t.accessibility.push(e.onElementEnd().descriptor);break;case"Role":null==t.role&&(t.role=[]),t.role.push(e.onElementEnd().descriptor);break;case"Rating":null==t.rating&&(t.rating=[]),t.rating.push(e.onElementEnd().descriptor);break;case"Viewpoint":null==t.viewpoint&&(t.viewpoint=[]),t.viewpoint.push(e.onElementEnd().descriptor);break;case"FramePacking":null==t.framePacking&&(t.framePacking=[]),t.framePacking.push(e.onElementEnd().descriptor);break;case"AudioChannelConfiguration":null==t.audioChannelConfiguration&&(t.audioChannelConfiguration=[]),t.audioChannelConfiguration.push(e.onElementEnd().descriptor);break;case"ContentProtection":null==t.contentProtection&&(t.contentProtection=[]),t.contentProtection.push(e.onElementEnd().descriptor);break;case"EssentialProperty":null==t.essentialProperty&&(t.essentialProperty=[]),t.essentialProperty.push(e.onElementEnd().descriptor);break;case"SupplementalProperty":null==t.supplementalProperty&&(t.supplementalProperty=[]),t.supplementalProperty.push(e.onElementEnd().descriptor);break;case"InbandEventStream":null==t.inbandEventStream&&(t.inbandEventStream=[]),t.inbandEventStream.push(e.onElementEnd().descriptor);break;case"SegmentBase":t.segmentBase=e.onElementEnd();break;case"SegmentList":case"SegmentDurations":case"EncodedSegmentDurations":t.segmentList=e.onElementEnd();break;case"SegmentTemplate":t.segmentTemplate=e.onElementEnd();break;case"Representation":t.representation.push(e.onElementEnd());break;case"Label":t.label=e.onElementEnd().text}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.parseContext.segmentTemplateCache=null,this.adaptationSet}),e})(bp.ParentElementHandler);t.AdaptationSetHandler=r}));e(zp);zp.AdaptationSetHandler;var Wp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(o){function e(){var e=o.call(this)||this;return e.protocolVersion=0,e}return n(e,o),e.prototype.getElementName=freeOnUnref(function(){return"Event"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){o.prototype.onElementStart.call(this,e,t,n);var r=e();this.duration=Pp.ParseUtils.optionalNumber(r,"duration")}),e.prototype.onChildElementStart=freeOnUnref(function(e,t,n){if("scte35:SpliceInfoSection"===e){var r=t(),i=Pp.ParseUtils.optionalNumber(r,"protocolVersion");void 0!==i&&(this.protocolVersion=i),this.ptsAdjustment=Pp.ParseUtils.optionalNumber(r,"ptsAdjustment"),this.tier=Pp.ParseUtils.optionalNumber(r,"tier")}else if("scte35:SpliceTime"===e)this.splicePtsTime=Pp.ParseUtils.optionalNumber(t(),"ptsTime");else{if("scte35:SegmentationDescriptor"!==e)return o.prototype.onChildElementStart.call(this,e,t,n);this.segmentationTypeId=Pp.ParseUtils.optionalNumber(t(),"segmentationTypeId")}return null}),e.prototype.onElementEnd=freeOnUnref(function(){var e={duration:this.duration,scte35SpliceInfoSection:{protocolVersion:this.protocolVersion,ptsAdjustment:this.ptsAdjustment,splicePtsTime:this.splicePtsTime,tier:this.tier,segmentationTypeId:this.segmentationTypeId}};return this.duration=void 0,this.protocolVersion=0,this.ptsAdjustment=void 0,this.tier=void 0,this.splicePtsTime=void 0,this.segmentationTypeId=void 0,e}),e})(bp.ParentElementHandler);t.ScteEventHandler=r}));e(Wp);Wp.ScteEventHandler;var Kp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r="urn:scte:scte35:2013:xml",i=freeOnUnref(function(i){function e(e){void 0===e&&(e=new Wp.ScteEventHandler);var t=i.call(this,[])||this;return t.eventStream=null,t.scteEventHandler=e,t}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"EventStream"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.eventStream={schemeIdUri:r.schemeIdUri,timescale:Pp.ParseUtils.requiredNumber(r,"timescale"),events:[]}}),e.prototype.onChildElementStart=freeOnUnref(function(e,t,n){return"Event"===e&&this.eventStream.schemeIdUri===r?(this.scteEventHandler.onElementStart(t,n,this.parseContext),this.scteEventHandler):null}),e.prototype.onChildElementEnd=freeOnUnref(function(e){"Event"===e.getElementName()&&this.eventStream.schemeIdUri===r&&this.eventStream.events.push(e.onElementEnd())}),e.prototype.onElementEnd=freeOnUnref(function(){return this.eventStream}),e})(bp.ParentElementHandler);t.EventStreamHandler=i}));e(Kp);Kp.EventStreamHandler;var Gp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(s){function e(){var e=s.call(this,[new Mp.BaseURLHandler,new Rp.SegmentBaseHandler,new xp.SegmentListHandler,new Fp.SegmentTemplateHandler,new wp.DescriptorHandler("AssetIdentifier"),new wp.DescriptorHandler("ContentProtection",Tp.ContentProtectionDescriptors),new wp.DescriptorHandler("SupplementalProperty"),new Kp.EventStreamHandler,new zp.AdaptationSetHandler])||this;return e.period=null,e}return n(e,s),e.prototype.getElementName=freeOnUnref(function(){return"Period"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){s.prototype.onElementStart.call(this,e,t,n);var r=e();n.periodIndex=null==n.periodIndex?0:n.periodIndex+1;var i=r.id,o=n.previousParsedPeriods;if(null!=o){var a=function(e,t,n){if(0===e)return null;if(t===n[n.length-1].id)return null;var r=x.find(n,freeOnUnref(function(e){return e.id===t}));return null==r?null:r}(n.periodIndex,i,o);if(null!=a)return this.period=a,void t()}this.period={xlink:Pp.ParseUtils.extractXLink(r),id:i,startMs:Pp.ParseUtils.optionalISODuration(r,"start"),durationMs:Pp.ParseUtils.optionalISODuration(r,"duration"),bitstreamSwitching:Pp.ParseUtils.optionalBoolean(r,"bitstreamSwitching",!1),adaptationSet:[]}}),e.prototype.onChildElementEnd=freeOnUnref(function(e){var t=this.period;switch(e.getElementName()){case"AdaptationSet":t.adaptationSet.push(e.onElementEnd());break;case"BaseURL":null==t.baseUrl&&(t.baseUrl=[]),t.baseUrl.push(e.onElementEnd());break;case"SegmentBase":t.segmentBase=e.onElementEnd();break;case"SegmentList":t.segmentList=e.onElementEnd();break;case"SegmentTemplate":t.segmentTemplate=e.onElementEnd();break;case"AssetIdentifier":t.assetIdentifier=e.onElementEnd().descriptor;break;case"ContentProtection":null==t.contentProtection&&(t.contentProtection=[]),t.contentProtection.push(e.onElementEnd().descriptor);break;case"SupplementalProperty":null==t.supplementalProperty&&(t.supplementalProperty=[]),t.supplementalProperty.push(e.onElementEnd().descriptor);break;case"EventStream":null==t.eventStream&&(t.eventStream=[]),t.eventStream.push(e.onElementEnd())}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.period}),e})(bp.ParentElementHandler);t.PeriodHandler=r}));e(Gp);Gp.PeriodHandler;var Qp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){var e=i.call(this,[new Cp.SimpleElementHandler("Title"),new Cp.SimpleElementHandler("Source"),new Cp.SimpleElementHandler("Copyright")])||this;return e.programInformation=null,e}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"ProgramInformation"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.programInformation={lang:r.lang,moreInformationUrl:r.moreInformationURL}}),e.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"Title":this.programInformation.title=e.onElementEnd().text;break;case"Source":this.programInformation.source=e.onElementEnd().text;break;case"Copyright":this.programInformation.copyright=e.onElementEnd().text}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.programInformation}),e})(bp.ParentElementHandler);t.ProgramInformationHandler=r}));e(Qp);Qp.ProgramInformationHandler;var Xp=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){var e=i.call(this,[new Qp.ProgramInformationHandler,new Mp.BaseURLHandler,new wp.DescriptorHandler("ContentProtection",Tp.ContentProtectionDescriptors),new Cp.SimpleElementHandler("Location"),new Gp.PeriodHandler,new wp.DescriptorHandler("UTCTiming")])||this;return e.mpd=null,e}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"MPD"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.mpd={id:r.id,profiles:Pp.ParseUtils.requiredStringList(r,"profiles"),type:Qe.withDefault(r.type,"static"),availabilityStartTimeMs:Pp.ParseUtils.optionalDateTime(r,"availabilityStartTime"),availabilityEndTimeMs:Pp.ParseUtils.optionalDateTime(r,"availabilityEndTime"),publishTimeMs:Pp.ParseUtils.optionalDateTime(r,"publishTime"),mediaPresentationDurationMs:Pp.ParseUtils.optionalISODuration(r,"mediaPresentationDuration"),minimumUpdatePeriodMs:Pp.ParseUtils.optionalISODuration(r,"minimumUpdatePeriod"),minBufferTimeMs:Pp.ParseUtils.requiredISODuration(r,"minBufferTime"),timeShiftBufferDepthMs:Pp.ParseUtils.optionalISODuration(r,"timeShiftBufferDepth"),suggestedPresentationDelayMs:Pp.ParseUtils.optionalISODuration(r,"suggestedPresentationDelay"),maxSegmentDurationMs:Pp.ParseUtils.optionalISODuration(r,"maxSegmentDuration"),maxSubsegmentDurationMs:Pp.ParseUtils.optionalISODuration(r,"maxSubsegmentDuration"),period:[]}}),e.prototype.onChildElementEnd=freeOnUnref(function(e){var t=this.mpd;switch(e.getElementName()){case"BaseURL":null==t.baseUrl&&(t.baseUrl=[]),t.baseUrl.push(e.onElementEnd());break;case"ContentProtection":null==t.contentProtection&&(t.contentProtection=[]),t.contentProtection.push(e.onElementEnd().descriptor);break;case"Location":null==t.location&&(t.location=[]),t.location.push(e.onElementEnd().text);break;case"Period":t.period.push(e.onElementEnd());break;case"ProgramInformation":null==t.programInformation&&(t.programInformation=[]),t.programInformation.push(e.onElementEnd());break;case"UTCTiming":null==t.utcTiming&&(t.utcTiming=[]),t.utcTiming.push(e.onElementEnd().descriptor)}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.mpd}),e})(bp.ParentElementHandler);t.MPDElementHandler=r}));e(Xp);Xp.MPDElementHandler;var Yp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.xmlParser=new bp.Parser,this.mpdHandler=new Xp.MPDElementHandler}return e.prototype.parse=freeOnUnref(function(e){var t=this;return lt.Promise.resolve().then(freeOnUnref(function(){return t.parseSync(e)}))}),e.prototype.parseSync=freeOnUnref(function(e,t){var n={};null!=t&&null!=t.previousParsedPeriods&&(n.previousParsedPeriods=t.previousParsedPeriods);var r=this.xmlParser.parse(this.mpdHandler,e,n);if(null==r)throw new ct.XpError("manifest.parse",void 0,"null result. contents.length:"+e.length+", contentsPrefix:"+e.substring(0,1e4));return r}),e})();t.DashParser=n}));e(Yp);Yp.DashParser;var Jp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DashParser=Yp.DashParser}));e(Jp);Jp.DashParser;var Zp=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.dashParser=new Jp.DashParser,this.dashParseContext={}}return e.prototype.parseSync=freeOnUnref(function(e){var t=this.dashParser.parseSync(e,this.dashParseContext);return this.dashParseContext.previousParsedPeriods=t.period,t}),e.prototype.reset=freeOnUnref(function(){this.dashParseContext={}}),e})();t.StatefulDashParser=n}));e(Zp);Zp.StatefulDashParser;var $p=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var d=de.get("DashMediaRepresentationSource"),p="manifest.acquisition";function u(e){return{mpd:e,earliestAvailableMPDTimeMs:zd.DashManifestUtility.extractEarliestAvailableMPDTime(e),latestAvailableMPDTimeMs:zd.DashManifestUtility.extractLatestExplicitSegmentMPDTime(e),minimumUpdatePeriodMs:e.minimumUpdatePeriodMs}}var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f){var u;void 0===n&&(n=null),void 0===i&&(i=null),void 0===o&&(o=0),void 0===a&&(a=null),void 0===s&&(s=null);var c=this;this.eventEmitter=new A.EventEmitter,this.manifestParser=new Zp.StatefulDashParser,this.schedulerSettings=null,this.isStopped=!1,this.hasReportedTtffMetadata=!1,this.doRefresh=freeOnUnref(function(){var e=lt.CancelToken.source(),o=e.token,t=e.cancel;return c.cancel=t,c.eventEmitter.emit("start"),c.acquireMpdWithRetries(o).then(freeOnUnref(function(e){o.throwIfRequested(),c.manifestContext=e;var t=new Date,n=c.createMediaRepresentation(e),r=new Date;if(d.enabledFor(de.DEBUG)){var i={type:"Manifest CreateMediaRepresentation",startTime:t.toISOString(),endTime:r.toISOString(),latencyMs:r.getTime()-t.getTime()};d.info(JSON.stringify(i))}return c.holder.setValue(n),c.eventEmitter.emit("complete",n),c.reportMediaRepresentationCreated(t.getTime(),r.getTime()),n}))}),this.refreshAndUpdateMpd=freeOnUnref(function(){var e;null!=c.acquireMpdPromise&&null!=c.cancel&&c.cancel();var t=lt.CancelToken.source(),n=t.token,r=t.cancel;return c.cancel=r,c.acquireMpdPromise=(e=c.acquireMpdWithRetries(n).then(freeOnUnref(function(e){return n.throwIfRequested(),c.eventEmitter.emit("complete",c.holder.contents),c.manifestContext=e}))).then.apply(e,lt.FINALLY(freeOnUnref(function(){n.requested||delete c.acquireMpdPromise}))),c.acquireMpdPromise}),this.acquireMpdWithRetries=freeOnUnref(function(f){return new lt.Promise(freeOnUnref(function(e,a){var s=null,l={},t=freeOnUnref(function(e,r,t,n){var i,o;i=lt.CancelToken.source(),o=i.token,s=i.cancel,c.acquireMpd(f,l).then(t).catch(freeOnUnref(function(e){o.throwIfRequested(),q.metrics.putMetric("Manifest.DASH.Error"),d.warn("Manifest.DASH.Error:",e);var t,n=null!=l.sourceUrl?l.sourceUrl:c.sourceUrlStore.get();if(t=e instanceof _c.AcquisitionError?e:new _c.AcquisitionError({type:"UnknownError",cause:e}),c.eventEmitter.emit("failure",{sourceUrl:n,error:t}),e instanceof _c.AcquisitionError&&"UnknownError"!==e.reason.type){if(c.shouldRetryAcquisition(e,n))return void r();throw c.internalStop(),new lt.CancelError}throw c.internalStop(),ct.XpError.generatePrefixedError(e,p)})).catch(a)}),n=(new _n.ExponentialBackoffRetry).withInitialIntervalMs(500).withExponentialFactor(2).withMaxDelayMs(2e3).onAttempt(t).onSuccess(e).execute();f.promise.then(freeOnUnref(function(){n.abort(),null!=s&&(s(),s=null)}))}))}),this.maxManifestSizeBytes=6291456,null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.fragmentContentSource&&(null!=L.configurationStore.configuration.fragmentContentSource.manifestTimeoutMs&&(n=L.configurationStore.configuration.fragmentContentSource.manifestTimeoutMs),null!=L.configurationStore.configuration.fragmentContentSource.maxManifestSizeBytes&&(this.maxManifestSizeBytes=L.configurationStore.configuration.fragmentContentSource.maxManifestSizeBytes)),this.resourceAcquirer=e,this.sourceUrlStore=t,this.timeoutMs=null!=n?n:1e4,this.audioTrackMetadata=null!=i?i:{},this.holder=new op.DynamicElementImpl(this.doRefresh),this.mpdStorage=new sp.MPDStorage(o,a,f),this.queryParams=((u={}).amznDtid=zt.deviceInformation.hardware.deviceTypeId,u),null!=r&&(this.queryParams.encoding=r),this.lastParseStatus="Healthy",this.schedulerSettings=s,this.traceEventController=l,this.periodId=f,this.diagnostics=nn.Diagnostics.create("DashMediaRepresentationSource")}return e.delete=freeOnUnref(function(e,t){return sp.MPDStorage.delete(e,t)}),e.prototype.stop=freeOnUnref(function(){this.internalStop(),this.lastParseStatus="Healthy",this.manifestParser.reset(),this.hasReportedTtffMetadata=!1,delete this.manifestContext}),Object.defineProperty(e.prototype,"mediaRepresentation",{get:freeOnUnref(function(){return this.holder}),enumerable:!0,configurable:!0}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.acquireMpd=freeOnUnref(function(t,n){var r=this;return this.isStopped||t.requested?lt.Promise.reject(new Error("Attempting to acquire manifest on stopped acquirer")):(null!=this.traceEventController&&this.traceEventController.reportTraceStart("PlaybackStartup","ManifestAcquisition","ResourceLookup",{periodId:null!=this.periodId?this.periodId:""}),this.mpdStorage.tryRetrieveMpdFromStorage(t).then(freeOnUnref(function(e){return t.throwIfRequested(),null!=e?(fp.PeriodDenormalizer.denormalize(e),null!=r.traceEventController&&r.traceEventController.reportTraceStop("PlaybackStartup","ManifestAcquisition","Success","ResourceLookup",{periodId:null!=r.periodId?r.periodId:"",source:"cached",periodCount:e.period.length.toString()}),ip.CacheStatusTracker.reportCacheHit("Manifest"),lt.Promise.resolve(u(e))):r.retrieveMpdFromNetwork(t,n)})).catch(freeOnUnref(function(e){throw null!=r.traceEventController&&r.traceEventController.reportTraceStop("PlaybackStartup","ManifestAcquisition","Failure","ResourceLookup",{periodId:null!=r.periodId?r.periodId:"",errorMessage:e.message||"Unknown error"}),e})))}),e.prototype.retrieveMpdFromNetwork=freeOnUnref(function(l,e){var f=this;return this.makeManifestRequest(l,e).then(freeOnUnref(function(s){l.throwIfRequested();var e=null!=s.totalBytes?s.totalBytes:s.body.length;if(e>f.maxManifestSizeBytes)throw d.warn("Manifest size is too large. Size: "+e),new _c.AcquisitionError({type:"ParseError",cause:new Error("Manifest size is too large.")});return f.parseToMpd(s.body,l).then(freeOnUnref(function(e){l.throwIfRequested();var t=Date.now();fp.PeriodDenormalizer.denormalize(e);var n=u(e),r=Date.now()-t,i="static"===e.type?"Static":"Dynamic";q.metrics.putMetric("Manifest.DASH."+i+".PostProcess.Time",r,"ms");var o=null!=f.manifestContext?f.manifestContext.mpd:void 0;try{lp.MpdValidator.validatePublishTimeUpdating(o,e),lp.MpdValidator.validatePeriodSequences(o,e),lp.MpdValidator.validateExplicitSegmentTimelineUpdating(f.manifestContext,n)}catch(e){throw new _c.AcquisitionError({type:"ParseError",cause:e})}if(d.enabledFor(de.DEBUG)){var a={type:"Manifest Post Processing",startTime:new Date(t).toISOString(),endTime:(new Date).toISOString()};d.info(JSON.stringify(a))}return f.sourceUrlStore.resourceAcquired(s),n}))}))}),e.prototype.createMediaRepresentation=freeOnUnref(function(e){var t={resourceAcquirer:this.resourceAcquirer,sourceUrlStore:this.sourceUrlStore,storageContext:this.mpdStorage.storageContext,audioTrackMetadata:this.audioTrackMetadata};return new np.DashMediaRepresentation(e,t,this.refreshAndUpdateMpd,this.schedulerSettings)}),e.prototype.makeManifestRequest=freeOnUnref(function(t,e){var n=this;if(this.isStopped||t.requested)return lt.Promise.reject(new Error("Attempting to acquire manifest on stopped acquirer"));var r=this.sourceUrlStore.get();e.sourceUrl=r,this.eventEmitter.emit("downloadStart",r);return this.resourceAcquirer.acquire("text",r,this.timeoutMs,0,!0,t,this.queryParams,void 0,"manifest.dash").then(freeOnUnref(function(e){if(t.throwIfRequested(),x.isEmpty(e.body))throw new _c.AcquisitionError({type:"ParseError",cause:new Error("Response body is empty!")});return n.eventEmitter.emit("downloadComplete",x.omit(e,"body")),q.metrics.putMetric("Manifest.DASH.Download.TransferTime",e.timing.downloadMs,"ms"),q.metrics.putMetric("Manifest.DASH.Download.Latency",e.timing.latencyMs,"ms"),n.reportInitialManifestDownloadTimes(e.timing.downloadMs,e.timing.latencyMs),null!=e.totalBytes&&q.metrics.putMetric("Manifest.DASH.Download.Throughput",8*e.totalBytes/e.timing.totalMs*1e3),null!=n.traceEventController&&n.traceEventController.reportTraceStop("PlaybackStartup","ManifestAcquisition","Success","ResourceLookup",{periodId:null!=n.periodId?n.periodId:"",source:"network",downloadMs:e.timing.downloadMs.toString(),latencyMs:e.timing.latencyMs.toString(),sizeBytes:null!=e.totalBytes?e.totalBytes.toString():"N/A"}),e}))}),e.prototype.tryUpdateAudioTrackLanguages=freeOnUnref(function(e){var t=this.audioTrackMetadata,n=null;1===Object.keys(t).length&&(n=t[Object.keys(t)[0]].languageCode);for(var r=0,i=e.period;r<i.length;r++)for(var o=0,a=i[r].adaptationSet;o<a.length;o++){var s=a[o];if("Audio"===jd.DashBaseStream.getStreamType(s)){var l=s.lang;null!=s.audioTrackId&&null!=t[s.audioTrackId]?l=t[s.audioTrackId].languageCode:null!==n&&(l=n),null!=l&&(s.lang=l.toLowerCase())}}}),e.prototype.parseToMpd=freeOnUnref(function(o,a){var s=this;return lt.Promise.resolve().then(freeOnUnref(function(){a.throwIfRequested(),null!=s.traceEventController&&s.traceEventController.reportTraceStart("PlaybackStartup","ManifestParse","ResourceLookup",{periodId:null!=s.periodId?s.periodId:"",manifestSize:o.length.toString()});var e=Date.now(),t=s.manifestParser.parseSync(o),n=Date.now(),r=n-e;if(q.metrics.putMetric("Manifest.DASH.Parse.Time",r,"ms"),s.reportInitialManifestParseTime(e,n),d.enabledFor(de.DEBUG)){d.info("MPD parsing took "+r+"ms (periods: "+t.period.length+", size: "+o.length+")");var i={type:"MPD parsing took",startTime:new Date(e).toISOString(),endTime:new Date(n).toISOString(),latencyMs:r,sizeBytes:o.length};d.info(JSON.stringify(i))}return s.lastParseStatus="Healthy",s.tryUpdateAudioTrackLanguages(t),null!=s.traceEventController&&s.traceEventController.reportTraceStop("PlaybackStartup","ManifestParse","Success","ResourceLookup",{periodId:null!=s.periodId?s.periodId:"",parseTimeMs:r.toString(),periodCount:t.period.length.toString(),manifestSize:o.length.toString()}),s.mpdStorage.tryStoreMpd(t).then(freeOnUnref(function(){return t}))})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;throw null!=s.traceEventController&&s.traceEventController.reportTraceStop("PlaybackStartup","ManifestParse","Failure","ResourceLookup",{periodId:null!=s.periodId?s.periodId:"",errorMessage:e.message}),q.metrics.putMetric("Manifest.DASH.Parse.Error"),new _c.AcquisitionError({type:"ParseError",cause:e})}))}),e.prototype.shouldRetryAcquisition=freeOnUnref(function(e,t){if("ParseError"===e.reason.type){if("ParseError"===this.lastParseStatus)return this.lastParseStatus="SourceError",this.sourceUrlStore.resourceAcquisitionFailed({type:"SourceError",cause:e},Ac.AcquisitionResourceType.Manifest,t.url,t.urlId);if("SourceError"===this.lastParseStatus)throw ct.XpError.generatePrefixedError(e,p);return this.lastParseStatus="ParseError",this.sourceUrlStore.resourceAcquisitionFailed(e.reason,Ac.AcquisitionResourceType.Manifest,t.url,t.urlId)}return this.sourceUrlStore.resourceAcquisitionFailed(e.reason,Ac.AcquisitionResourceType.Manifest,t.url,t.urlId)}),e.prototype.internalStop=freeOnUnref(function(){null!=this.cancel&&this.cancel(),this.holder.clear(),delete this.cancel,this.isStopped=!0}),e.prototype.reportInitialManifestDownloadTimes=freeOnUnref(function(e,t){if(!this.hasReportedTtffMetadata){var n=Date.now(),r=n-e-t;this.diagnostics.report("ttff",{manifestDownloadStartTime:Math.round(r),manifestDownloadEndTime:n}),q.metrics.putMetric("Manifest.DASH.Initial.Download.TransferTime",e,"ms"),q.metrics.putMetric("Manifest.DASH.Initial.Download.Latency",t,"ms"),d.info("[TTFF] DASH manifest download transfer took "+e+" ms"),d.info("[TTFF] DASH manifest download latency took "+t+" ms")}}),e.prototype.reportInitialManifestParseTime=freeOnUnref(function(e,t){if(!this.hasReportedTtffMetadata){var n=t-e;this.diagnostics.report("ttff",{manifestParseStartTime:e,manifestParseEndTime:t}),q.metrics.putMetric("Manifest.DASH.Initial.Parse.Time",n,"ms"),d.info("[TTFF] DASH manifest parsing took "+n+" ms")}}),e.prototype.reportMediaRepresentationCreated=freeOnUnref(function(e,t){if(!this.hasReportedTtffMetadata){var n=t-e;this.diagnostics.report("ttff",{mediaRepresentationStartTime:e,mediaRepresentationEndTime:t}),q.metrics.putMetric("MediaRepresentation.Creation.Time",n),d.info("[TTFF] Media representation creation took "+n+" ms"),this.hasReportedTtffMetadata=!0}}),e})();t.DashMediaRepresentationSource=n}));e($p);$p.DashMediaRepresentationSource;var eh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("PlaylistedMediaRepresentation"),n=freeOnUnref(function(){function e(){var t=this;this.eventEmitter=new A.EventEmitter,this.periodEventCleanup={},this.playlistedPeriods={contents:[],onChange:freeOnUnref(function(e){return t.periodChangedCallback.add(e)}),offChange:freeOnUnref(function(e){return t.periodChangedCallback.remove(e)})};var e=this;this.playlistedTimeWindow={startMs:0,get endMs(){return e.durationMs},isUpdating:freeOnUnref(function(){return!1})},this.totalDurationMs=0,this.periodChangedCallback=new A.MulticastCallback}return e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),Object.defineProperty(e.prototype,"periods",{get:freeOnUnref(function(){return this.playlistedPeriods}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationMs",{get:freeOnUnref(function(){return this.totalDurationMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeWindow",{get:freeOnUnref(function(){return this.playlistedTimeWindow}),enumerable:!0,configurable:!0}),e.prototype.append=freeOnUnref(function(e){this.periodExists(e)?o.warn("Period "+e.id+" already exists. Skipping period insertion"):(this.setupPeriodEventListeners(e),this.playlistedPeriods.contents.push(e),this.updatePeriodStartAndEnd(),this.periodChangeOccurred(),o.info("Appending period "+e.id))}),e.prototype.insertAfter=freeOnUnref(function(e,t){var n,r=this;if(e.some(freeOnUnref(function(e){return r.periodExists(e)})))o.warn("One of the period already exists. Skipping period insertion");else{var i=-1;if(null!=t&&-1===(i=x.findIndex(this.playlistedPeriods.contents,freeOnUnref(function(e){return e.id===t}))))throw new Error("Period "+t+" not found");e.forEach(freeOnUnref(function(e){return r.setupPeriodEventListeners(e)})),(n=this.playlistedPeriods.contents).splice.apply(n,[i+1,0].concat(e)),this.updatePeriodStartAndEnd(),this.periodChangeOccurred(),o.info("Inserted "+e.length+" new periods at "+(i+1))}}),e.prototype.insertBefore=freeOnUnref(function(e,t){var n,r=this;if(e.some(freeOnUnref(function(e){return r.periodExists(e)})))o.warn("One of the periods already exists. Skipping period insertion");else{var i;if(null!=t){if(-1===(i=x.findIndex(this.playlistedPeriods.contents,freeOnUnref(function(e){return e.id===t}))))throw new Error("Period "+t+" not found")}else i=this.playlistedPeriods.contents.length;e.forEach(freeOnUnref(function(e){return r.setupPeriodEventListeners(e)})),(n=this.playlistedPeriods.contents).splice.apply(n,[i,0].concat(e)),this.updatePeriodStartAndEnd(),this.periodChangeOccurred(),o.info("Inserted "+e.length+" new periods at "+i)}}),e.prototype.remove=freeOnUnref(function(t){var e=x.findIndex(this.playlistedPeriods.contents,freeOnUnref(function(e){return e.id===t}));if(-1!==e){var n=this.periodEventCleanup[t];null!=n&&(n(),delete this.periodEventCleanup[t]),this.playlistedPeriods.contents.splice(e,1).forEach(freeOnUnref(function(e){return e.destroy()})),this.updatePeriodStartAndEnd(),this.periodChangeOccurred(),o.info("Removed period "+t+" at "+e)}else o.warn("Period "+t+" not found")}),e.prototype.start=freeOnUnref(function(e){}),e.prototype.stop=freeOnUnref(function(){for(var e=0,t=this.playlistedPeriods.contents;e<t.length;e++){t[e].destroy()}}),e.prototype.applyFilters=freeOnUnref(function(e){}),e.prototype.periodChangeOccurred=freeOnUnref(function(){this.updateTotalDurationMs(),this.periodChangedCallback.invokeSync()}),e.prototype.periodExists=freeOnUnref(function(t){return this.playlistedPeriods.contents.some(freeOnUnref(function(e){return e.id===t.id}))}),e.prototype.setupPeriodEventListeners=freeOnUnref(function(e){var t=this,n=freeOnUnref(function(){return t.eventEmitter.emit("start")}),r=freeOnUnref(function(e){return t.eventEmitter.emit("complete",e)}),i=freeOnUnref(function(e){return t.eventEmitter.emit("failure",e)}),o=freeOnUnref(function(e){return t.eventEmitter.emit("downloadStart",e)}),a=freeOnUnref(function(e){return t.eventEmitter.emit("downloadComplete",e)});e.on("start",n),e.on("complete",r),e.on("failure",i),e.on("downloadStart",o),e.on("downloadComplete",a),this.periodEventCleanup[e.id]=freeOnUnref(function(){e.off("start",n),e.off("complete",r),e.off("failure",i),e.off("downloadStart",o),e.off("downloadComplete",a)})}),e.prototype.updateTotalDurationMs=freeOnUnref(function(){this.totalDurationMs=this.playlistedPeriods.contents.reduce(freeOnUnref(function(e,t){return e+t.durationMs}),0)}),e.prototype.updatePeriodStartAndEnd=freeOnUnref(function(){for(var e=0,t=0,n=this.playlistedPeriods.contents;t<n.length;t++){var r=n[t];r.setStartAndEndMs(e),e+=r.durationMs}}),e})();t.PlaylistedMediaRepresentation=n}));e(eh);eh.PlaylistedMediaRepresentation;var th=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("AccessTokenManager"),r="x-pv-cdn-access-token",n=freeOnUnref(function(){function e(e,t,n){this.isStarted=!1,this.activeRefreshPromise=null,this.currentToken=t.initialAccessToken,this.currentTokenExpirationMs=1e3*t.initialAccessTokenSecondsOfValidity+e,this.accessTokenGetUrl=null==t.accessTokenGetUrl?null:t.accessTokenGetUrl,this.tokenRefreshTimer=null,this.isStarted=!1,this.tokenAcquisitionCallback=n}return e.prototype.start=freeOnUnref(function(){this.isStarted?l.warn("TokenManager already started"):(l.info("TokenManager started"),this.isStarted=!0,this.scheduleTokenRefresh())}),e.prototype.stop=freeOnUnref(function(){this.isStarted?(null!=this.tokenRefreshTimer&&(oe.timer.clearTimeout(this.tokenRefreshTimer),this.tokenRefreshTimer=null),this.isStarted=!1):l.warn("Attempt to stop when not started. Ignoring.")}),e.prototype.getAccessToken=freeOnUnref(function(){var e=Date.now(),t=e<this.currentTokenExpirationMs;return this.currentTokenExpirationMs-6e4<=e&&null!=this.accessTokenGetUrl&&this.fetchTokenWithRetries(this.accessTokenGetUrl),{token:this.currentToken,isValid:t,refreshPromise:this.activeRefreshPromise}}),e.prototype.scheduleTokenRefresh=freeOnUnref(function(){var e=this;if(null!=this.accessTokenGetUrl){var t=this.accessTokenGetUrl,n=Math.max(this.currentTokenExpirationMs-6e4-Date.now(),0);this.tokenRefreshTimer=oe.timer.setTimeout(freeOnUnref(function(){return e.fetchTokenWithRetries(t)}),n)}}),e.prototype.fetchTokenWithRetries=freeOnUnref(function(o){var a=this;if(null==this.activeRefreshPromise){var s=0;this.activeRefreshPromise=new lt.Promise(freeOnUnref(function(t,e){(new _n.ExponentialBackoffRetry).withExponentialFactor(2).withInitialIntervalMs(500).withMaxAttempts(3).withRandomizationFactor(200).onAttempt(freeOnUnref(function(n,r,i){s=n,pn.HttpRequest.get(o).timeout(5e3).accept("application/json").onLoad(freeOnUnref(function(e){var t=a.validateTokenResponse(e);if(t instanceof Error)return a.recordMetricsAndNotify(e,o,!1),void r(t);a.recordMetricsAndNotify(e,o,!0),i({accessToken:t.accessToken,expiresInSec:t.body.maxAgeSec})})).onError(freeOnUnref(function(e,t){l.error("Failed to refresh access token (attempt "+n+")",e),a.reportFailure(t),a.tokenAcquisitionCallback({url:o,success:!1}),r(e)})).send()})).onSuccess(freeOnUnref(function(e){a.activeRefreshPromise=null,a.currentToken=e.accessToken,a.currentTokenExpirationMs=Date.now()+1e3*e.expiresInSec,l.info("Request succeeded after "+s+" attempts."),q.metrics.putMetric("TokenAuth.Resolution",1),q.metrics.putMetric("TokenAuth.Resolution.Attempts",s),a.isStarted&&a.scheduleTokenRefresh(),t(e.accessToken)})).onError(freeOnUnref(function(e){a.activeRefreshPromise=null,l.error("All retry attempts failed for token fetch from "+o,e),q.metrics.putMetric("TokenAuth.Resolution",0),q.metrics.putMetric("TokenAuth.Resolution.Attempts",s),t(a.currentToken)})).execute()}))}}),e.prototype.reportFailure=freeOnUnref(function(e){if(null!=e){var t=e.getStatus();401!==t&&403!==t||q.metrics.putMetric("TokenAuth.TokenExchangeFailure."+t),400<=t&&t<500?q.metrics.putMetric("TokenAuth.TokenExchangeFailure.4xx"):500<=t&&t<600?q.metrics.putMetric("TokenAuth.TokenExchangeFailure.5xx"):q.metrics.putMetric("TokenAuth.TokenExchangeFailure.Non4xxNon5xx")}else q.metrics.putMetric("TokenAuth.TokenExchangeFailure.Unknown")}),e.prototype.recordMetricsAndNotify=freeOnUnref(function(e,t,n){var r=e.getStatus(),i=e.getLatencyMs();this.tokenAcquisitionCallback({url:t,headers:e.getHeaders(),status:r,totalMs:e.getTotalMs(),latencyMs:i,totalBytes:e.getMetrics().totalBytes,success:n}),l.info("TokenAuth latency: "+i+"ms"),q.metrics.putMetric("TokenAuth.RequestLatencyTime",i,"ms")}),e.prototype.validateTokenResponse=freeOnUnref(function(e){var t=e.getHeaders()[r];if(null==t)return 200===e.getStatus()&&(q.metrics.putMetric("TokenAuth.MissingAccessTokenHeader",1),l.error(r+" header not found in response")),new Error("Missing access token header");try{var n=JSON.parse(e.getText());return!x.isFinite(n.maxAgeSec)||n.maxAgeSec<=0?(q.metrics.putMetric("TokenAuth.InvalidMaxAgeSec",1),l.error("Invalid maxAgeSec value in token response",n.maxAgeSec),new Error("Invalid maxAgeSec value")):{accessToken:t,body:n}}catch(e){return q.metrics.putMetric("TokenAuth.JsonParsingError",1),l.error("JSON parsing error in token response",e),new Error("JSON parsing error in token response: "+e.toString())}}),e})();t.AccessTokenManager=n}));e(th);th.AccessTokenManager;var nh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("PlaylistedUrlSourceUrlStore");function s(e,t){return null!=e&&null!=t&&e.toLowerCase()===t.toLowerCase()}var n=freeOnUnref(function(){function e(e,t,n,r,i){var o=this;this.tokenManagers={},this.onSourceCdnChange=freeOnUnref(function(e){var t=o.activeUrlIndex;null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.extensiblePlaylisting&&"v2"===L.configurationStore.configuration.extensiblePlaylisting.cdnFailoverVersion?o.changeCdnV2(e.previousSourceCdn,e.newSourceCdn):o.changeCdnV1(e.previousSourceCdn,e.newSourceCdn),o.reportTAMetrics(t)}),this.periodId=e,this.sourceCdnStore=t,this.periodUrls=n,this.playbackResourcesTimestamp=r,this.tokenAcquisitionCallback=i;var a=this.sourceCdnStore.get();this.activeUrlIndex=this.findUrlIndex(0,freeOnUnref(function(e){return s(e.cdn,a)})),-1===this.activeUrlIndex&&(this.activeUrlIndex=0),this.initializeTokenManagers(),this.sourceCdnStore.on("SourceCdnChange",this.onSourceCdnChange)}return e.prototype.get=freeOnUnref(function(){return this.toSourceUrl(this.periodUrls[this.activeUrlIndex])}),e.prototype.resourceAcquired=freeOnUnref(function(e){this.sourceCdnStore.resourceAcquired(e)}),e.prototype.resourceAcquisitionFailed=freeOnUnref(function(e,t,n){return this.sourceCdnStore.resourceAcquisitionFailed(e,t,n)}),e.prototype.on=freeOnUnref(function(e,t){}),e.prototype.off=freeOnUnref(function(e,t){}),e.prototype.terminate=freeOnUnref(function(){this.sourceCdnStore.off("SourceCdnChange",this.onSourceCdnChange)}),e.prototype.changeCdnV1=freeOnUnref(function(e,t){var n=this.findUrlIndex(0,freeOnUnref(function(e){return s(e.cdn,t)}));-1!==n?this.activeUrlIndex=n:s(this.periodUrls[this.activeUrlIndex].cdn,e)?this.activeUrlIndex=(this.activeUrlIndex+1)%this.periodUrls.length:a.warn("Skipping CDN failover. No manifest URL found for active CDN: "+t+" and not part of affected CDN: "+e)}),e.prototype.changeCdnV2=freeOnUnref(function(t,n){var e=this.periodUrls[this.activeUrlIndex];a.info("Performing CDN switch from "+t+" to "+n+". Period: "+this.periodId+", period URLs:\n"+this.formatUrlsToTable());var r=this.findUrlIndex(0,freeOnUnref(function(e){return s(e.cdn,n)}));if(-1!==r){var i=this.periodUrls[r];return a.info("Switched from "+e.cdn+" / "+e.origin+" (index = "+this.activeUrlIndex+") to "+i.cdn+" / "+i.origin+" (index = "+r+"). Target CDN "+n+" in the URL list."),void(this.activeUrlIndex=r)}if(s(e.cdn,t)){var o=this.findUrlIndex(this.activeUrlIndex,freeOnUnref(function(e){return!s(e.cdn,t)}));if(-1!==o){i=this.periodUrls[o];return a.info("Switched from "+e.cdn+" / "+e.origin+" (index = "+this.activeUrlIndex+") to "+i.cdn+" / "+i.origin+" (index = "+o+"). Target CDN "+n+" NOT in the URL list. Selected next CDN in the list."),void(this.activeUrlIndex=o)}}a.warn("Skipping CDN failover. No URL found for current CDN "+n+" and not part of affected CDN "+t+".")}),e.prototype.formatUrlsToTable=freeOnUnref(function(){for(var e=new au.TableFormatterGeneric,t=0,n=0,r=this.periodUrls;n<r.length;n++){var i=r[n];e.addRow({index:(this.activeUrlIndex===t?"> ":"  ")+" "+t,cdn:i.cdn,origin:i.origin}),t++}return e.renderString()}),e.prototype.findUrlIndex=freeOnUnref(function(e,t){for(var n=this.periodUrls.length,r=0;r<n;r++){var i=(e+r)%n;if(t(this.periodUrls[i]))return i}return-1}),e.prototype.initializeTokenManagers=freeOnUnref(function(){if(null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.prs&&!0===L.configurationStore.configuration.prs.enableTokenAuth)for(var e=0,t=this.periodUrls;e<t.length;e++){var n=t[e],r=n.edgeDeliveryAuthorization;null!=r&&"PVExchangeV1"===r.authorizationScheme&&(this.tokenManagers[n.consumptionId]=new th.AccessTokenManager(this.playbackResourcesTimestamp,r.accessTokens,this.tokenAcquisitionCallback))}}),e.prototype.toSourceUrl=freeOnUnref(function(n){var r=this;return{url:n.url,urlId:n.consumptionId,assetConsumptionId:n.assetConsumptionId,headers:{},getAccessToken:freeOnUnref(function(){var e=r.tokenManagers[n.consumptionId];if(null!=e){var t=e.getAccessToken();return t.isValid?{type:"ValidToken",token:t.token}:{type:"ExpiredToken",token:t.token,refreshPromise:t.refreshPromise}}return{type:"NoToken"}})}}),e.prototype.isTokenAuthEnabled=freeOnUnref(function(e){return null!=this.tokenManagers[this.periodUrls[e].consumptionId]}),e.prototype.reportTAMetrics=freeOnUnref(function(e){if(e!==this.activeUrlIndex){var t=this.isTokenAuthEnabled(e)?"Enabled":"Disabled",n=this.isTokenAuthEnabled(this.activeUrlIndex)?"Enabled":"Disabled";q.metrics.putMetric("Failover.TokenAuth."+t+".To."+n,1)}}),e})();t.PlaylistedUrlSourceUrlStore=n}));e(nh);nh.PlaylistedUrlSourceUrlStore;var rh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var m=de.get("PlaylistedPeriod"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h){void 0===s&&(s=null),void 0===l&&(l="Main"),void 0===c&&(c=!0),void 0===d&&(d=!1),void 0===p&&(p=0),this._startMs=NaN,this._endMs=NaN,this.eventEmitter=new A.EventEmitter,this.id=e,this.durationMs=t,this.isFinalPeriod=r,this.resourceAcquirer=a,this.audioTrackMetadata=s,this.removeInBandSubtitles=d,this.periodType=l,this.hasForwardAccess=c,this.traceEventController=f,this.storageAccess=p,this.downloadOperationId=h,this.resolvedStreams=[],this.resolverPromise=null,this.hasBeenResolved=!1,this.forwardAccessDeferred=new lt.Deferred,m.enabledFor(de.DEBUG)&&m.info("Period "+this.id+" has been blocked"),this.hasForwardAccess&&this.allowForwardAccess(),this.sourceUrlStore=new nh.PlaylistedUrlSourceUrlStore(this.id,o,i,n,u)}return e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),Object.defineProperty(e.prototype,"isResolved",{get:freeOnUnref(function(){return this.hasBeenResolved}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"streams",{get:freeOnUnref(function(){return this.checkIfResolvedElseThrow(),this.resolvedStreams}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentId",{get:freeOnUnref(function(){return this.checkIfResolvedElseThrow(),this.resolvedContentId}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentType",{get:freeOnUnref(function(){return this.checkIfResolvedElseThrow(),this.resolvedContentType}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentSubType",{get:freeOnUnref(function(){return this.checkIfResolvedElseThrow(),this.resolvedContentSubType}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"consumptionId",{get:freeOnUnref(function(){return this.sourceUrlStore.get().urlId}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){if(isNaN(this._startMs))throw new Error("startMs timing not initialized for period "+this.id+". PlaylistedMediaRepresentation should call setStartAndEndMs() first.");return this._startMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){if(isNaN(this._endMs))throw new Error("endMs timing not initialized for period "+this.id+". PlaylistedMediaRepresentation should call setStartAndEndMs() first.");return this._endMs}),enumerable:!0,configurable:!0}),e.prototype.setStartAndEndMs=freeOnUnref(function(e){if(isNaN(e))throw new Error("Period startMs must be a number");this._startMs=e,this._endMs=e+this.durationMs}),e.prototype.destroy=freeOnUnref(function(){null!=this.cancel&&this.cancel(),null!=this.resolvedStreams&&this.resolvedStreams.forEach(freeOnUnref(function(e){e.destroy()})),this.resolverPromise=null,this.resolvedContentId=void 0,this.resolvedContentType=void 0,this.resolvedContentSubType=void 0,this.hasBeenResolved=!1,this.sourceUrlStore.terminate()}),e.prototype.awaitForwardAccess=freeOnUnref(function(){return m.info("Period "+this.id+" has forward access: "+this.hasForwardAccess),this.forwardAccessDeferred.promise}),e.prototype.allowForwardAccess=freeOnUnref(function(){m.info("Period "+this.id+" has been unblocked"),this.hasForwardAccess=!0,this.forwardAccessDeferred.resolve(this)}),e.prototype.resolve=freeOnUnref(function(){var n=this;if(null!==this.resolverPromise)return this.resolverPromise;var e=lt.CancelToken.source(),r=e.token,t=e.cancel;this.cancel=t,m.info("Resolving period "+this.id);var i=Date.now();return this.resolverPromise=this.createDashMediaRepresentation(r).then(freeOnUnref(function(t){if(r.throwIfRequested(),m.info("Period "+n.id+" manifest acquired and parsed"),1!==t.periods.contents.length)throw new Error("Period "+n.id+" manifest expected to have only one period");return n.applyMediaCapabilitiesFilter(t,r).then(freeOnUnref(function(){r.throwIfRequested();var e=t.periods.contents[0];return n.resolvedStreams=Object.freeze(e.streams.slice()),n.resolvedContentId=e.contentId,n.resolvedContentType=e.contentType,n.resolvedContentSubType=e.contentSubType,n.hasBeenResolved=!0,m.info("Period "+n.id+" resolved in "+(Date.now()-i)+"ms"),n}))})),this.resolverPromise}),e.prototype.createDashMediaRepresentation=freeOnUnref(function(t){var e,n=this;t.throwIfRequested();var r=new $p.DashMediaRepresentationSource(this.resourceAcquirer,this.sourceUrlStore,null,"segmentBase",this.audioTrackMetadata,this.storageAccess,this.downloadOperationId,null,this.traceEventController,this.id),i=freeOnUnref(function(){return n.eventEmitter.emit("start")}),o=freeOnUnref(function(e){return n.eventEmitter.emit("complete",e)}),a=freeOnUnref(function(e){return n.eventEmitter.emit("failure",e)}),s=freeOnUnref(function(e){return n.eventEmitter.emit("downloadStart",e)}),l=freeOnUnref(function(e){return n.eventEmitter.emit("downloadComplete",e)});r.on("start",i),r.on("complete",o),r.on("failure",a),r.on("downloadStart",s),r.on("downloadComplete",l);var f=r.mediaRepresentation;return(e=(!0===f.valid?lt.Promise.resolve(f.contents):f.refresh()).then(freeOnUnref(function(e){return t.throwIfRequested(),e}))).then.apply(e,lt.FINALLY(freeOnUnref(function(){r.off("start",i),r.off("complete",o),r.off("failure",a),r.off("downloadStart",s),r.off("downloadComplete",l)})))}),e.prototype.applyMediaCapabilitiesFilter=freeOnUnref(function(n,r){var i=this;return gf.MediaCapabilitiesFilter.create(n).then(freeOnUnref(function(e){r.throwIfRequested();var t=[];t.push(e),t.push(new gf.AudioQualityLevelFilter),i.removeInBandSubtitles&&t.push({isQualityLevelSupported:freeOnUnref(function(e){return"TimedText"!==e.type})}),n.applyFilters(t)}))}),e.prototype.checkIfResolvedElseThrow=freeOnUnref(function(){if(!this.isResolved)throw new Error("Cannot access properties before period is resolved")}),e})();t.PlaylistedPeriod=n}));e(rh);rh.PlaylistedPeriod;var ih=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DashMediaRepresentation=np.DashMediaRepresentation,t.DashMediaRepresentationSource=$p.DashMediaRepresentationSource,t.createManifestKey=ap.createManifestKey,t.PlaylistedMediaRepresentation=eh.PlaylistedMediaRepresentation,t.PlaylistedPeriod=rh.PlaylistedPeriod,t.PlaylistedUrlSourceUrlStore=nh.PlaylistedUrlSourceUrlStore,t.AccessTokenManager=th.AccessTokenManager}));e(ih);ih.DashMediaRepresentation,ih.DashMediaRepresentationSource,ih.createManifestKey,ih.PlaylistedMediaRepresentation,ih.PlaylistedPeriod,ih.PlaylistedUrlSourceUrlStore,ih.AccessTokenManager;var oh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.mediaRepresentation=e,this.requestedDelayBehindLiveHeadMs=t,this.utcMsAtZero=null==this.mediaRepresentation.utcMsAtZero?0:this.mediaRepresentation.utcMsAtZero}return Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){var e=this.mediaRepresentation;return this.utcMsAtZero+e.timeWindow.startMs+(isFinite(e.durationMs)?0:1e4)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){var e=this.mediaRepresentation;if(isFinite(e.durationMs))return this.utcMsAtZero+e.timeWindow.endMs;var t=null!=e.updatePeriodMs?e.updatePeriodMs+4e3:0,n=Math.max(t,this.requestedDelayBehindLiveHeadMs);return this.utcMsAtZero+e.timeWindow.endMs-n}),enumerable:!0,configurable:!0}),e.prototype.isUpdating=freeOnUnref(function(){return this.mediaRepresentation.timeWindow.isUpdating()}),e})();t.RefreshingRepresentationTimeWindow=n}));e(oh);oh.RefreshingRepresentationTimeWindow;var ah=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.MAX_FRONT_BUFFER_MS=12e4,e.MIN_FRONT_BUFFER_MS=1e4,e.MAX_BACK_BUFFER_MS=32e3,e})();t.BufferConstants=n}));e(ah);ah.BufferConstants;var sh=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.B=0]="B",e[e.KB=1]="KB",e[e.MB=2]="MB",e[e.GB=3]="GB",e[e.TB=4]="TB",e[e.KiB=5]="KiB",e[e.MiB=6]="MiB",e[e.GiB=7]="GiB",e[e.TiB=8]="TiB",e[e.bit=9]="bit",e[e.Kibit=10]="Kibit",e[e.Mibit=11]="Mibit",e[e.Gibit=12]="Gibit",e[e.Tibit=13]="Tibit"})(n||(n={})),t.MemoryUnits=n;var i={};i[n.B]={nominator:1,denominator:1},i[n.KB]={nominator:1e3,denominator:1},i[n.MB]={nominator:Math.pow(1e3,2),denominator:1},i[n.GB]={nominator:Math.pow(1e3,3),denominator:1},i[n.TB]={nominator:Math.pow(1e3,4),denominator:1},i[n.KiB]={nominator:1024,denominator:1},i[n.MiB]={nominator:Math.pow(1024,2),denominator:1},i[n.GiB]={nominator:Math.pow(1024,3),denominator:1},i[n.TiB]={nominator:Math.pow(1024,4),denominator:1},i[n.bit]={nominator:1,denominator:8},i[n.Kibit]={nominator:1024,denominator:8},i[n.Mibit]={nominator:Math.pow(1024,2),denominator:8},i[n.Gibit]={nominator:Math.pow(1024,3),denominator:8},i[n.Tibit]={nominator:Math.pow(1024,4),denominator:8};var r=freeOnUnref(function(){function r(e,t){this.size=e,this.units=t}return r.prototype.toUnits=freeOnUnref(function(e){var t=i[this.units],n=i[e];return new r(this.size*(t.nominator*n.denominator)/(t.denominator*n.nominator),e)}),r})();t.MemorySize=r}));e(sh);sh.MemoryUnits,sh.MemorySize;var lh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("PlayerBufferManager");var n=freeOnUnref(function(){function e(e){if(this.diagnostics=nn.Diagnostics.create("PlayerBufferManager"),this.errorState={},this.playheadPositionMs=0,this.reserveInPriorityOrder=!1,this.availableBytes=e.memorySize.toUnits(sh.MemoryUnits.B).size,this.availableBytes<=0)throw new Error("Expected this.availableBytes ["+this.availableBytes+"] > 0");this.maxAvailableBytes=this.availableBytes,this.allocated=[],this.deallocatedReservations={back:[],front:[]},this.pendingReservations=[],this.maxAllowedBps=8*this.availableBytes/(ah.BufferConstants.MIN_FRONT_BUFFER_MS/1e3);var t=e.memorySize.toUnits(sh.MemoryUnits.MiB).size;this.reserveInPriorityOrder=null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.fragmentBuffers&&!0===L.configurationStore.configuration.fragmentBuffers.reserveInPriorityOrder,r.info("PlayerBufferManager was initialized with bufferSize: "+t+"MiB, max allowed bitrate is "+this.maxAllowedBps+", reserveInPriorityOrder: "+this.reserveInPriorityOrder)}return e.prototype.reserve=freeOnUnref(function(e){if(e.sizeBytes<=0){var t=new Error("Expected request.sizeBytes ["+e.sizeBytes+"] > 0");throw this.emitState(t),t}var n=e.getPriority();if(n===1/0)return oe.timer.setImmediate(freeOnUnref(function(){null!=e.onRetry&&e.onRetry.retry(!0)})),{fulfilled:!1};if(!this.reserveInPriorityOrder||this.isHighestPriority(n)){if(this.availableBytes>=e.sizeBytes)return this.fulfillRequest(e);if(this.tryDeallocate(e))return this.fulfillRequest(e)}return this.reserveInPriorityOrder&&this.retryPendingReservations(),null!=e.onRetry&&(this.pendingReservations.push({getPriority:e.getPriority,cachedPriority:n,requestedSizeBytes:e.sizeBytes,cancelToken:e.onRetry.cancelToken,retry:e.onRetry.retry,timestamp:Date.now()}),this.emitState()),{fulfilled:!1}}),e.prototype.irrevocableReserve=freeOnUnref(function(e){return e<=0?(r.warn("Expected sizeBytes ["+e+"] > 0"),{fulfilled:!1}):this.availableBytes>=e?this.fulfillIrrevocableReservationRequest(e):(r.info("irrevocableReserve failed. Available buffer size: "+this.availableBytes/1024/1024+"MiB"),{fulfilled:!1})}),e.prototype.getMaxAllowedBps=freeOnUnref(function(){return this.maxAllowedBps}),e.prototype.onPosition=freeOnUnref(function(e){this.playheadPositionMs=e,this.updatePendingReservationCachedPriority(),this.retryPendingReservations()}),e.prototype.isHighestPriority=freeOnUnref(function(t){return!this.pendingReservations.some(freeOnUnref(function(e){return e.cachedPriority<t}))}),e.prototype.updatePendingReservationCachedPriority=freeOnUnref(function(){this.pendingReservations.forEach(freeOnUnref(function(e){return e.cachedPriority=e.getPriority()}))}),e.prototype.retryPendingReservations=freeOnUnref(function(){if(0!==this.pendingReservations.length){var e=this.pendingReservations.length,t=this.allocated.length;if(this.pendingReservations=this.pendingReservations.filter(freeOnUnref(function(e){var t=!e.cancelToken.requested&&isFinite(e.cachedPriority);return t||e.retry(!0),t})),0<this.pendingReservations.length)for(var n=this.pendingReservations.slice().sort(freeOnUnref(function(e,t){return e.cachedPriority-t.cachedPriority}));0<n.length;){var r=n[0];if(!(this.availableBytes>=r.requestedSizeBytes||this.tryDeallocateBackBuffer(r.requestedSizeBytes)))break;n.shift();var i=this.pendingReservations.indexOf(r);-1!==i&&this.pendingReservations.splice(i,1),r.retry(!1)}this.pendingReservations.length===e&&this.allocated.length===t||this.emitState()}}),e.prototype.fulfillRequest=freeOnUnref(function(e){var t=this;return this.availableBytes-=e.sizeBytes,this.allocated.push(e),this.emitState(),{fulfilled:!0,sizeBytes:e.sizeBytes,onFreed:freeOnUnref(function(){return t.onFreed(e)})}}),e.prototype.fulfillIrrevocableReservationRequest=freeOnUnref(function(e){var t=this,n=e/1024/1024;return r.info("Reserving irrevocable buffer of size "+n+" MB."),this.availableBytes-=e,this.emitState(),{fulfilled:!0,sizeBytes:e,onFreed:freeOnUnref(function(){r.info("Releasing the irrevocable buffer of size "+n+" MB."),t.freeBytes(e)})}}),e.prototype.onFreed=freeOnUnref(function(e){var t=this.allocated.indexOf(e);-1!==t&&(this.allocated.splice(t,1),this.freeBytes(e.sizeBytes))}),e.prototype.freeBytes=freeOnUnref(function(e){this.availableBytes+=e}),e.prototype.tryDeallocate=freeOnUnref(function(e){var t=e.sizeBytes;return!!this.tryDeallocateBackBuffer(t)||this.tryDeallocateFrontBuffer(t,e.getPriority())}),e.prototype.tryDeallocateBackBuffer=freeOnUnref(function(e){for(var t=this.allocated.map(freeOnUnref(function(e){return{request:e,priority:e.getPriority()}})).filter(freeOnUnref(function(e){return e.priority===1/0})).sort(freeOnUnref(function(e,t){return e.request.position-t.request.position}));0<t.length;){var n=t.shift();if(this.flushAllocation(n.request),this.recordDeallocation(this.deallocatedReservations.back,n),this.availableBytes>=e)return!0}return!1}),e.prototype.tryDeallocateFrontBuffer=freeOnUnref(function(e,t){for(var n=this.allocated.map(freeOnUnref(function(e){return{request:e,priority:e.getPriority()}})).filter(freeOnUnref(function(e){return isFinite(e.priority)&&e.priority>t+ah.BufferConstants.MIN_FRONT_BUFFER_MS})).sort(freeOnUnref(function(e,t){return e.priority-t.priority})).reverse();0<n.length;){var r=n.shift();if(this.flushAllocation(r.request),this.recordDeallocation(this.deallocatedReservations.front,r),this.availableBytes>=e)return!0}return!1}),e.prototype.flushAllocation=freeOnUnref(function(e){e.flush()||(r.warn("Flush call failed, releasing the request to sync with available buffer"),this.onFreed(e))}),e.prototype.emitState=freeOnUnref(function(e){var t=Date.now();null!=e&&(this.errorState.lastThrownError=e,this.errorState.lastThrownErrorTimestamp=t);for(var n={maxPosition:-1/0,minPosition:1/0,allocatedBytes:0},r=0,i=this.allocated;r<i.length;r++){var o=i[r];n.maxPosition=Math.max(o.position,n.maxPosition),n.minPosition=Math.min(o.position,n.minPosition),n.allocatedBytes=o.sizeBytes+n.allocatedBytes}var a={allocated:n,availableBytes:this.availableBytes,maxAllowedBps:this.maxAllowedBps,pendingReservations:this.pendingReservations.map(freeOnUnref(function(e){return{cachedPriority:e.cachedPriority,requestedSizeBytes:e.requestedSizeBytes,timestamp:e.timestamp}})),deallocatedReservations:{back:this.deallocatedReservations.back.map(freeOnUnref(function(e){return{availableBytes:e.availableBytes,freedBytes:e.freedBytes,playheadPositionMs:e.playheadPositionMs,priority:e.priority,timestamp:e.timestamp}})),front:this.deallocatedReservations.front.map(freeOnUnref(function(e){return{availableBytes:e.availableBytes,freedBytes:e.freedBytes,playheadPositionMs:e.playheadPositionMs,priority:e.priority,timestamp:e.timestamp}}))},playheadPositionMs:this.playheadPositionMs,timestamp:t};null!=this.errorState.lastThrownError&&(a.lastThrownError=this.errorState.lastThrownError,a.lastThrownErrorTimestamp=this.errorState.lastThrownErrorTimestamp),this.diagnostics.report("state",a)}),e.prototype.recordDeallocation=freeOnUnref(function(e,t){e.push({availableBytes:this.availableBytes,freedBytes:t.request.sizeBytes,playheadPositionMs:this.playheadPositionMs,priority:t.priority===1/0?t.request.position:t.priority,timestamp:Date.now()}),10<e.length&&e.shift()}),e.prototype.getMaxAvailableBytes=freeOnUnref(function(){return this.maxAvailableBytes}),e})();t.PlayerBufferManager=n}));e(lh);lh.PlayerBufferManager;var fh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BufferConstants=ah.BufferConstants,t.MemorySize=sh.MemorySize,t.MemoryUnits=sh.MemoryUnits,t.PlayerBufferManager=lh.PlayerBufferManager}));e(fh);fh.BufferConstants,fh.MemorySize,fh.MemoryUnits,fh.PlayerBufferManager;var uh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("DefaultFragmentSource"),a=de.get("DefaultFragmentSource.shouldReset"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f){this.lastLocatedPeriod=null,this.started=!1,this.type=e,this.maxAcceptableSegmentPositionErrorMs=t,this.periodTailor=n,this.fragmentBuffer=r,this.downloadQueue=i,this.acquirer=o,this.eventEmitter=a,this.getPreferredStream=s,this.flushConsumedFragments=l,this.segmentQualityLevelTracker=f}return e.prototype.fragmentConsumed=freeOnUnref(function(e){this.flushConsumedFragments&&this.fragmentBuffer.trim(e.position.endTimeMs-1e3)}),e.prototype.getBitrateSwitchFragment=freeOnUnref(function(e,t){return null}),e.prototype.getFragmentAt=freeOnUnref(function(t){var n=this;return this.started?(null!=this.lastLocatedPeriod&&t>=this.lastLocatedPeriod.startMs&&t<=this.lastLocatedPeriod.endMs?this.shouldReset(t)&&this.resetBuffer(t):this.periodTailor.getPeriodAt(t).then(freeOnUnref(function(e){null!=e&&(n.lastLocatedPeriod=e,n.shouldReset(t)&&n.resetBuffer(t))})),this.fragmentBuffer.getMediaFragmentAt(t)):null}),e.prototype.getInitFragment=freeOnUnref(function(e,t,n){return this.fragmentBuffer.getInitFragment(e,n)}),e.prototype.getNextFragment=freeOnUnref(function(e){return this.fragmentBuffer.getNextMediaFragment(e)}),e.prototype.getStitchingInformation=freeOnUnref(function(e,t,n){return this.periodTailor.getStitchingInformation(e,this.type,t,n)}),e.prototype.isDownloadingRange=freeOnUnref(function(e,t){if(t<=e)return!0;var n=this.downloadQueue.getQueuedRange();if(null===n)return!1;var r=new In.NumberLine;r.add({start:e,end:t});var i=this.fragmentBuffer.getBufferedRanges().clone();i.add({start:n.startMs,end:n.endMs});var o=i.intersection(r);return 1===o.getIntervals().length&&null!==o.find(e)&&null!==o.find(t)}),e.prototype.isFinalSegment=freeOnUnref(function(e){return this.fragmentBuffer.isFinalSegment(e)}),e.prototype.lockFragment=freeOnUnref(function(e){this.fragmentBuffer.lockFragment(e)}),e.prototype.onUpdate=freeOnUnref(function(e){this.fragmentBuffer.onUpdate(e)}),e.prototype.offUpdate=freeOnUnref(function(e){this.fragmentBuffer.offUpdate(e)}),e.prototype.stop=freeOnUnref(function(){this.started=!1,this.acquirer.stop(),this.fragmentBuffer.flush(!0),this.downloadQueue.stop(),null!=this.segmentQualityLevelTracker&&this.segmentQualityLevelTracker.flush()}),e.prototype.start=freeOnUnref(function(e){this.started=!0,this.resetBuffer(e)}),e.prototype.shouldReset=freeOnUnref(function(e){if(!this.started)return a.enabledFor(de.INFO)&&a.info("shouldReset("+this.type+", "+e+"): false (FragmentSource is stopped)"),!1;if(null!=this.lastLocatedPeriod&&null===this.getPreferredStream(this.type,this.lastLocatedPeriod))return a.enabledFor(de.INFO)&&a.info("shouldReset("+this.type+", "+e+"): false (lastLocatedPeriod != null && getPreferredStream(...) === null)"),!1;if(this.fragmentBuffer.isBuffered(e))return a.enabledFor(de.INFO)&&a.info("shouldReset("+this.type+", "+e+"): false (position is in buffered ranges "+JSON.stringify(this.fragmentBuffer.getBufferedRanges())+")"),!1;var t=this.downloadQueue.getQueuedRange();if(null!==t&&t.startMs<=e+1&&e<t.endMs&&((n=this.fragmentBuffer.getBufferedRanges().clone()).add({start:t.startMs,end:t.endMs}),1===n.getIntervals().length))return a.enabledFor(de.INFO)&&a.info("shouldReset("+this.type+", "+e+"): false (position is in download queue ranges "+JSON.stringify(t)+" and won't create eventual gap in buffered ranges "+JSON.stringify(this.fragmentBuffer.getBufferedRanges())+")"),!1;var n,r=e+this.maxAcceptableSegmentPositionErrorMs,i=this.fragmentBuffer.getBufferedRanges().find(r);if(null!=i)return a.enabledFor(de.INFO)&&a.info("shouldReset("+this.type+", "+e+"): false (nearby (forward) position "+r+" is in buffered ranges "+JSON.stringify(this.fragmentBuffer.getBufferedRanges())+")"),"Video"===this.type&&this.eventEmitter.emitSync("positionAdjusted",i.start),!1;if(null!==t&&t.startMs<=r+1&&r<t.endMs&&((n=this.fragmentBuffer.getBufferedRanges().clone()).add({start:t.startMs,end:t.endMs}),1===n.getIntervals().length))return a.enabledFor(de.INFO)&&a.info("shouldReset("+this.type+", "+e+"): false (nearby (forward) position "+r+" is in download queue ranges "+JSON.stringify(t)+" and won't create eventual gap in buffered ranges "+JSON.stringify(this.fragmentBuffer.getBufferedRanges())+")"),!1;return o.enabledFor(de.INFO)&&o.info("shouldReset("+this.type+", "+e+"): true\nbuffered ranges: "+JSON.stringify(this.fragmentBuffer.getBufferedRanges())+"\nqueued ranges: "+JSON.stringify(t)),!0}),e.prototype.resetBuffer=freeOnUnref(function(e){o.info("Resetting "+this.type+" at position "+e),this.started?(this.acquirer.stop(),this.downloadQueue.stop(),this.fragmentBuffer.flush(),null!=this.segmentQualityLevelTracker&&this.segmentQualityLevelTracker.flush(),this.downloadQueue.start(e),this.acquirer.start(e)):o.error("Attempted to reset "+this.type+" FragmentSource, but it is stopped!")}),e})();t.DefaultFragmentSource=n}));e(uh);uh.DefaultFragmentSource;var ch=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("DefaultPeriodGapHandler"),n=freeOnUnref(function(){function e(e){this.type=e,this.filledGapAtPeriodEnd={}}return e.prototype.createPeriodGapFill=freeOnUnref(function(e,t,n,r,i,o){var a=e.position.endTimeMs,s=t.position.startTimeMs,l=s-a;if(150<l?u.error("["+this.type+"] "+l+"ms gap between segment "+r+" of period "+n+" and "+o+" of period "+i+" too large to be collapsed"):l<-100&&u.warn("["+this.type+"] "+l+"ms overlap between segment "+r+" of period "+n+" and "+o+" of period "+i),0<l&&l<150){var f={start:a,end:s};return this.filledGapAtPeriodEnd[n]=f}return null}),e.prototype.isPositionInFilledGap=freeOnUnref(function(e,t){var n=this.filledGapAtPeriodEnd[t];return null!=n&&e>=n.start&&e<=n.end}),e.prototype.getFilledGapAtPeriodEnd=freeOnUnref(function(e){var t=this.filledGapAtPeriodEnd[e];return null!=t?t:null}),e.prototype.removeFilledGapAtPeriodEnd=freeOnUnref(function(e){var t=this.getFilledGapAtPeriodEnd(e);return delete this.filledGapAtPeriodEnd[e],t}),e})();t.DefaultPeriodGapHandler=n}));e(ch);ch.DefaultPeriodGapHandler;var dh=t(freeOnUnref(function(e,t){var f=ce&&ce.__assign||freeOnUnref(function(){return(f=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("FragmentBuffer"),n=freeOnUnref(function(){function e(e,t,n,r){this.type=e,this.bufferedRanges=new In.NumberLine(1),this.finalSegment=null,this.pendingPeriodBoundaries={},this.periods={},this.updateCallback=new A.MulticastCallback,this.periodGapHandler=null!=n?n:new ch.DefaultPeriodGapHandler(this.type),this.segmentCacheFactory=t,this.updateCachedSelectionContext=r;var i=L.configurationStore.configuration;this.disableSegmentDereferencingOnFlush=null!=i&&null!=i.fragmentBuffers&&!0===i.fragmentBuffers.disableSegmentDereferencingOnFlush}return e.prototype.isBuffered=freeOnUnref(function(e){return null!=this.bufferedRanges.find(e)}),e.prototype.getBufferedFinalFragment=freeOnUnref(function(){return null==this.finalSegment?null:this.getMediaFragment(this.finalSegment.periodId,this.finalSegment.segmentIndex)}),e.prototype.getBufferedRanges=freeOnUnref(function(){return this.bufferedRanges}),e.prototype.flush=freeOnUnref(function(e){void 0===e&&(e=!1);for(var t=0<this.bufferedRanges.getIntervals().length,n=0,r=Object.keys(this.periods);n<r.length;n++){var i=r[n];this.removePeriod(i,e)}t&&this.updateCallback.invoke(),this.bufferedRanges=new In.NumberLine(1),this.pendingPeriodBoundaries={}}),e.prototype.flushFragment=freeOnUnref(function(e,t){var n=this.periods[e];if(null==n)return u.warn("Trying to flush "+this.type+" segment from period "+e+", but we don't even know about this period."),!1;var r=n.mediaSegments,i=r.get(t);if(null==i)return u.warn("Trying to flush "+this.type+" segment "+t+" from period "+e+", but we don't have it."),!1;r.remove(t);var o=i.readySegment.position;return n.ranges.remove({start:o.startTimeMs,end:o.endTimeMs}),this.bufferedRanges.remove({start:o.startTimeMs,end:o.endTimeMs}),this.releaseSegment(i.readySegment),this.updateCallback.invoke(),!0}),e.prototype.partialFlush=freeOnUnref(function(e){for(var t=0<this.getBufferedRanges().getIntervals().length,n=0,r=Object.keys(this.periods);n<r.length;n++){var i=r[n],o=this.periods[i],a=o.mediaSegments.getAll();if(0!==a.length&&!e(a[0].readySegment)){a.sort(freeOnUnref(function(e,t){return e.readySegment.position.startTimeMs-t.readySegment.position.startTimeMs}));for(var s=0;s<a.length;s++){var l=a[s].readySegment,f=l.position;if(s%2==0&&s+1<a.length){var u=a[s+1].readySegment.position;f.endTimeMs=u.endTimeMs;var c={start:f.startTimeMs,end:f.endTimeMs};o.ranges.add(c),this.bufferedRanges.add(c)}else s%2==1&&(o.mediaSegments.remove(l.index),this.releaseSegment(l))}}}t&&this.updateCallback.invoke()}),e.prototype.addMediaFragment=freeOnUnref(function(e){null==this.periods[e.periodId]&&(this.periods[e.periodId]=f({},this.createCacheSegments(),{ranges:new In.NumberLine(1),streamId:e.streamId})),this.periods[e.periodId].streamId=e.streamId;var t=this.periods[e.periodId].mediaSegments,n=e.index,r=e.position,i=t.get(n);if(null===i||!i.locked&&e.bitrateBps>i.readySegment.bitrateBps){t.put(n,{readySegment:e,locked:!1}),this.updateCachedSelectionContextIfNeeded(n,e),this.periods[e.periodId].ranges.add({start:r.startTimeMs,end:r.endTimeMs}),this.bufferedRanges.add({start:r.startTimeMs,end:r.endTimeMs});var o=this.pendingPeriodBoundaries[e.periodId];null!=o&&n===o.fromSequence&&(this.handlePeriodGap(o.fromPeriodId,o.fromSequence,o.toPeriodId,o.toSequence),delete this.pendingPeriodBoundaries[e.periodId]),e.isFinalSegment?u.info("Buffering final "+this.type+" segment index "+n):null!=this.finalSegment&&e.periodId===this.finalSegment.periodId&&n===this.finalSegment.segmentIndex&&(u.info("Buffered "+this.type+" segment index "+n+" was detected as final segment, marking it."),e.isFinalSegment=!0);var a=this.findPreviousPeriod(e.periodId,n);if(null!==a&&null!=a.nextPeriod){var s=this.getMediaFragment(a.nextPeriod.fromPeriodId,a.nextPeriod.fromSequence);if(null!==s){var l=r.startTimeMs-s.position.endTimeMs;100<Math.abs(l)&&u.warn("Found a gap/overlap of "+l+"ms between "+this.type+" segment "+a.nextPeriod.fromSequence+" of period "+a.nextPeriod.fromPeriodId+" and "+n+" of period "+e.periodId)}}this.updateCallback.invoke()}}),e.prototype.containsMediaSegmentThat=freeOnUnref(function(t){for(var e=freeOnUnref(function(e){return t(e.readySegment)}),n=0,r=Object.keys(this.periods);n<r.length;n++){var i=r[n];if(null!==this.periods[i].mediaSegments.findValue(e))return!0}return!1}),e.prototype.setFinalSegment=freeOnUnref(function(e,t){var n={periodId:e,segmentIndex:t};null!=this.finalSegment&&u.warn("Final segment was already set, previous: "+JSON.stringify(this.finalSegment)+", current: "+JSON.stringify(n)),this.finalSegment=n;var r=this.getMediaFragment(e,t);null!=r&&(u.info("Final "+this.type+" segment "+t+" was already cached when final segment was reported, marking it as final segment"),r.isFinalSegment=!0)}),e.prototype.findPreviousPeriod=freeOnUnref(function(e,t){for(var n=0,r=Object.keys(this.periods);n<r.length;n++){var i=r[n],o=this.periods[i];if(null!=o.nextPeriod&&o.nextPeriod.toPeriodId===e)return o.nextPeriod.toSequence!==t?null:o}return null}),e.prototype.addInitFragment=freeOnUnref(function(e){null==this.periods[e.periodId]&&(this.periods[e.periodId]=f({},this.createCacheSegments(),{ranges:new In.NumberLine(1),streamId:e.streamId}));var t={readySegment:e,locked:!1};this.periods[e.periodId].streamId=e.streamId,this.periods[e.periodId].initSegments.put(e.qualityLevelId,t),this.updateCachedSelectionContextIfNeeded("init",e),this.updateCallback.invoke()}),e.prototype.containsInitFragment=freeOnUnref(function(e,t){return null!=this.periods[e]&&null!==this.periods[e].initSegments.get(t)}),e.prototype.getInitFragment=freeOnUnref(function(e,t){var n=this.periods[e];if(null==n)return null;var r=n.initSegments.get(t);return null!=r?r.readySegment:null}),e.prototype.getMediaFragmentAt=freeOnUnref(function(t){for(var e=0,n=Object.keys(this.periods);e<n.length;e++){var r=n[e],i=this.periods[r],o=i.ranges.bounds();if(null!==o&&(!In.isApprxEqual(o.end,t,1)&&!(t<o.start-1||t>=o.end))){var a=this.getMediaFragmentInCollapsedGap(t,r);if(null!=a)return a;var s=i.mediaSegments.findValue(freeOnUnref(function(e){return gf.SegmentPosition.contains(e.readySegment.position,t)||gf.SegmentPosition.contains(e.readySegment.position,t+1)}));return null!=s?s.readySegment:null}}return null}),e.prototype.getMediaFragmentsInRange=freeOnUnref(function(n,r){for(var e=[],t=0,i=Object.keys(this.periods);t<i.length;t++){var o=i[t],a=this.periods[o],s=a.ranges.bounds();if(null!==s&&!(r<=s.start+1||n>=s.end-1)){var l=a.mediaSegments.getAll().map(freeOnUnref(function(e){return e.readySegment}));e=e.concat(l.filter(freeOnUnref(function(e){var t=e.position;return t.startTimeMs<r&&t.endTimeMs>n})));var f=this.getMediaFragmentInCollapsedGap(n,o);null!=f&&e.push(f)}}return e}),e.prototype.getNextMediaFragment=freeOnUnref(function(e){var t=this.periods[e.periodId];return null==t?(u.warn("Received query for "+this.type+" segment after "+e.index+" of period "+e.periodId+", but we don't know this period!"),null):null!=t.nextPeriod&&t.nextPeriod.fromSequence===e.index?this.getMediaFragment(t.nextPeriod.toPeriodId,t.nextPeriod.toSequence):this.getMediaFragment(e.periodId,e.index+1)}),e.prototype.updateFragmentPosition=freeOnUnref(function(e,t){var n=this.periods[e.periodId];if(null!=n){var r=n.mediaSegments.get(e.index);null!=r&&(this.bufferedRanges.remove({start:r.readySegment.position.startTimeMs,end:r.readySegment.position.endTimeMs}),r.readySegment.position=t,this.bufferedRanges.add({start:t.startTimeMs,end:t.endTimeMs}))}}),e.prototype.linkSegment=freeOnUnref(function(e,t,n,r){null==this.periods[e]&&(this.periods[e]=f({},this.createCacheSegments(),{ranges:new In.NumberLine(1)})),this.periods[e].nextPeriod={fromPeriodId:e,fromSequence:t,toPeriodId:n,toSequence:r},this.handlePeriodGap(e,t,n,r)}),e.prototype.isFinalSegment=freeOnUnref(function(e){return null!=this.finalSegment&&(this.finalSegment.periodId===e.periodId&&this.finalSegment.segmentIndex===e.index)}),e.prototype.handlePeriodGap=freeOnUnref(function(e,t,n,r){var i=this.getMediaFragment(e,t),o=this.getMediaFragment(n,r);if(null!==i&&null!==o){var a=this.periodGapHandler.createPeriodGapFill(i,o,e,t,n,r);null!=a&&(this.periods[e].ranges.add(a),this.bufferedRanges.add(a))}else null===i&&(this.pendingPeriodBoundaries[e]=this.periods[e].nextPeriod)}),e.prototype.getMediaFragmentInCollapsedGap=freeOnUnref(function(e,t){var n=this.periods[t];if(this.periodGapHandler.isPositionInFilledGap(e,t)&&null!=n.nextPeriod){var r=n.nextPeriod.fromSequence;return this.getMediaFragment(t,r)}return null}),e.prototype.getMediaFragment=freeOnUnref(function(e,t){var n=this.periods[e];if(null==n)return null;var r=n.mediaSegments.get(t);return null!=r?r.readySegment:null}),e.prototype.lockFragment=freeOnUnref(function(e){var t=this.periods[e.periodId];if(null!=t){var n=t.mediaSegments.get(e.index);null!=n&&(n.locked=!0)}}),e.prototype.trim=freeOnUnref(function(t,e){void 0===e&&(e=!1);for(var n=0,r=Object.keys(this.periods);n<r.length;n++){var i=r[n],o=this.periods[i],a=o.ranges.bounds();if(null!==a){var s=this.periodGapHandler.getFilledGapAtPeriodEnd(i);if(null!=s&&(a={start:a.start,end:s.start}),a.end<=t)this.removePeriod(i,e);else if(a.start<t)for(var l=0,f=o.mediaSegments.trim(freeOnUnref(function(e){return e.readySegment.position.endTimeMs>t}));l<f.length;l++){var u=f[l],c=u.readySegment.position;o.ranges.remove({start:c.startTimeMs,end:c.endTimeMs}),this.bufferedRanges.remove({start:c.startTimeMs,end:c.endTimeMs}),this.releaseSegment(u.readySegment)}}}}),e.prototype.removePeriod=freeOnUnref(function(e,t){void 0===t&&(t=!1);var n=this.periods[e];if(null!=n){for(var r=n.mediaSegments,i=0,o=r.getAll();i<o.length;i++){var a=o[i];this.releaseSegment(a.readySegment)}r.clear();var s=n.ranges.bounds();null!==s&&this.bufferedRanges.remove(s);var l=this.periodGapHandler.removeFilledGapAtPeriodEnd(e);if(null!=l&&this.bufferedRanges.remove(l),null!=this.pendingPeriodBoundaries[e]&&delete this.pendingPeriodBoundaries[e],n.ranges=new In.NumberLine(1),t){for(var f=0,u=n.initSegments.getAll();f<u.length;f++){var c=u[f];this.releaseSegment(c.readySegment)}n.initSegments.clear(),delete this.periods[e]}}}),e.prototype.onUpdate=freeOnUnref(function(e){this.updateCallback.add(e)}),e.prototype.offUpdate=freeOnUnref(function(e){this.updateCallback.remove(e)}),e.prototype.getBufferedStreamMetadata=freeOnUnref(function(){for(var e=[],t=0,n=Object.keys(this.periods);t<n.length;t++){var r=n[t],i=this.periods[r];null!=i.streamId?e.push({periodId:r,streamId:i.streamId}):u.warn("Period "+r+" exists without a known streamId")}return e}),e.prototype.releaseSegment=freeOnUnref(function(e){this.disableSegmentDereferencingOnFlush||(e.data=null),e.onFreed()}),e.prototype.updateCachedSelectionContextIfNeeded=freeOnUnref(function(e,t){this.segmentCacheFactory.isDiskCaching&&null!=this.updateCachedSelectionContext&&this.isBaseStreamType(t.type)&&this.updateCachedSelectionContext(t.periodId,t.type,t.streamId,e,t.qualityLevelId)}),e.prototype.createCacheSegments=freeOnUnref(function(){return{initSegments:this.segmentCacheFactory.createSegmentCache(),mediaSegments:this.segmentCacheFactory.createSegmentCache()}}),e.prototype.isBaseStreamType=freeOnUnref(function(e){return"Video"===e||"Audio"===e||"TimedText"===e}),e})();t.FragmentBuffer=n}));e(dh);dh.FragmentBuffer;var ph=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.videoFragmentBuffer=e,this.videoStreamAcquirer=t,this.mediaRepresentation=n}return e.prototype.checkResolutionPixels=freeOnUnref(function(e){var t=this.createPredicates(e),n=t.isPendingSegmentAbovePixelConstraint,r=t.isCachedVideoSegmentAbovePixelConstraint;return!!this.videoStreamAcquirer.isMediaFragmentPendingThat(n)||this.videoFragmentBuffer.containsMediaSegmentThat(r)}),e.prototype.createPredicates=freeOnUnref(function(e){return{isPendingSegmentAbovePixelConstraint:this.createPendingSegmentPredicate(e),isCachedVideoSegmentAbovePixelConstraint:this.createCachedSegmentPredicate(e)}}),e.prototype.createCachedSegmentPredicate=freeOnUnref(function(a){var s=this,l={periodId:null,stream:null};return freeOnUnref(function(e){var t=e.periodId,n=e.streamId;if(!s.updatePredicateMetadata(l,t,n))return!0;if(!s.isStreamEncrypted(l.stream))return!1;for(var r=0,i=l.stream.qualityLevels;r<i.length;r++){var o=i[r];if(o.id===e.qualityLevelId)return s.isVideoQualityUnknownOrAbovePixelConstraint(o,a)}return!0})}),e.prototype.createPendingSegmentPredicate=freeOnUnref(function(o){var a=this,s={periodId:null,stream:null};return freeOnUnref(function(e,t){var n=e.segment.period.id,r=e.segment.stream.id;if(!a.updatePredicateMetadata(s,n,r))return!0;if(null===t||!a.isStreamEncrypted(e.segment.stream))return!1;var i=e.segment.stream.qualityLevels[t];return a.isVideoQualityUnknownOrAbovePixelConstraint(i,o)})}),e.prototype.updatePredicateMetadata=freeOnUnref(function(e,t,n){if(!(t===e.periodId&&null!=e.stream&&n===e.stream.id)){var r=x.find(this.mediaRepresentation.periods.contents,freeOnUnref(function(e){return e.id===t}));if(null==r)return!1;var i=x.find(r.streams,freeOnUnref(function(e){return"Video"===e.type&&e.id===n}));if(null==i)return!1;e.periodId=t,e.stream=i}return!0}),e.prototype.isStreamEncrypted=freeOnUnref(function(e){return null!=e.contentProtections&&0<e.contentProtections.length}),e.prototype.isVideoQualityUnknownOrAbovePixelConstraint=freeOnUnref(function(e,t){return null==e.height||null==e.width||e.height*e.width>t}),e})();t.VideoSegmentMonitor=n}));e(ph);ph.VideoSegmentMonitor;var hh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.Constants={CIRCA_ONE_FRAME_MS:50,CIRCA_ONE_AUDIO_FRAME_MS:25}}));e(hh);hh.Constants;var mh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.onChangeCallback=new A.MulticastCallback,this.getDistanceFromPlayhead=e,this.maxFrontBufferMs=t}return e.prototype.setFrontBufferSize=freeOnUnref(function(e){this.maxFrontBufferMs=e+3*hh.Constants.CIRCA_ONE_FRAME_MS,this.onChangeCallback.invoke()}),e.prototype.onPosition=freeOnUnref(function(e){this.onChangeCallback.invoke()}),e.prototype.canProduce=freeOnUnref(function(e){var t=this.getDistanceFromPlayhead(e.contentPosition);return t<this.maxFrontBufferMs?{canProduce:!0}:{canProduce:!1,reason:"Segment starting at "+e.contentPosition.startTimeMs+" is too far ahead of playhead ("+t+" >= "+this.maxFrontBufferMs+"ms)"}}),e.prototype.onChange=freeOnUnref(function(e){this.onChangeCallback.add(e)}),e.prototype.offChange=freeOnUnref(function(e){this.onChangeCallback.remove(e)}),e})();t.FrontBufferProductionBarrier=n}));e(mh);mh.FrontBufferProductionBarrier;var yh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.FAILED_LOAD_CONTEXT={isLoaded:!1,qualityLevel:null}}));e(yh);yh.FAILED_LOAD_CONTEXT;var gh=t(freeOnUnref(function(e,t){var d=ce&&ce.__rest||freeOnUnref(function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n});Object.defineProperty(t,"__esModule",{value:!0});var p=de.get("LocalSegmentLoader"),n=freeOnUnref(function(){function e(e,t,n,r){this.mediaChunkIndexPromise=null,this.type=e,this.fragmentBuffer=t,this.qualityLevelFilter=n,this.selectionLoader=r,this.storageAvailable=null!=r.downloadOperationId&&Pt.localStorage.capabilities.isSupported&&Jo.metadataStorage.capabilities.isSupported,this.mediaChunkIndexManager=yd.MediaChunkIndexManager.getInstance(),null!=this.selectionLoader.downloadOperationId&&(this.mediaChunkIndexPromise=this.mediaChunkIndexManager.getChunkIndex(this.selectionLoader.downloadOperationId)),this.selectionContext=null,this.cachedSelectionContext=null}return e.prototype.initialize=freeOnUnref(function(e,t){(null!=this.selectionContext&&null==e||null!=this.cachedSelectionContext&&null==t)&&p.warn("Explicitly resetting selection contexts"),this.selectionContext=e,this.cachedSelectionContext=t}),e.prototype.uninitialize=freeOnUnref(function(){this.selectionContext=null,this.cachedSelectionContext=null,(this.mediaChunkIndexPromise=null)!=this.selectionLoader.downloadOperationId&&this.mediaChunkIndexManager.releaseChunkIndex(this.selectionLoader.downloadOperationId)}),e.prototype.retrieveLocalMediaSegment=freeOnUnref(function(t,n){var r=this;if(!this.storageAvailable)return lt.Promise.resolve(yh.FAILED_LOAD_CONTEXT);var i=t.segment.segment,o=t.segment.stream,a=t.segment.period,e=i.index,s=this.qualityLevelFilter.filter(o.qualityLevels,o).validQualities,l=this.selectBitrateOffline(a,o,e,s),f=l.qualityLevelIndex,u=l.useIndexForKey;if(f<0)return lt.Promise.resolve(yh.FAILED_LOAD_CONTEXT);var c=s[f];return this.getMediaData(t,a,o,c,u).then(freeOnUnref(function(e){return n.throwIfRequested(),null==e?yh.FAILED_LOAD_CONTEXT:(u?od.FragmentUtilities.validateDownloadedSegmentData(e,{byteRange:void 0}):od.FragmentUtilities.validateDownloadedSegmentData(e,t.segment.segment),r.fragmentBuffer.addMediaFragment({isInitSegment:!1,type:r.type,index:t.segment.segment.index,isFinalSegment:t.segment.isFinalSegment,periodId:a.id,streamId:o.id,qualityLevelId:c.id,bitrateBps:c.bandwidth,position:t.segment.contentPosition,data:e,onFreed:freeOnUnref(function(){})}),null!=t.previousSegment&&t.previousSegment.periodId!==t.segment.period.id&&r.fragmentBuffer.linkSegment(t.previousSegment.periodId,t.previousSegment.index,a.id,t.segment.segment.index),p.info("LocalStorage: Retrieve segment success, index: "+i.index+", qualityLevel: "+c.id+", periodId: "+a.id+", streamId: "+o.id),{isLoaded:!0,qualityLevel:c})})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;return p.error("LocalStorage: Retrieve segment failed, index: "+i.index+", qualityLevel: "+c.id+", periodId: "+a.id+", streamId: "+o.id+", error: "+e.message),yh.FAILED_LOAD_CONTEXT}))}),e.prototype.getMediaData=freeOnUnref(function(e,t,n,r,i){var o=e.segment.segment,a=(o.byteRange,d(o,["byteRange"]));!0===i&&(o=a);var s=gf.createLocalStorageSegmentId(this.selectionLoader.downloadOperationId,t.id,n.id,r.id,o),l="periodId: "+t.id+", type: "+this.type+", streamId: "+n.id+", segmentKey: "+s+", downloadOperationId: "+this.selectionLoader.downloadOperationId;if(p.info("LocalStorage: Retrieve segment, "+l),null==o.byteRange)return Pt.localStorage.getArrayBuffer(s).then(freeOnUnref(function(e){return null==e?(p.info("LocalStorage: Retrieve segment (no byte range) invalid (missing or failed fetch), "+l),null):(p.info("LocalStorage: Retrieve segment (no byte range) success, "+l),e)}));var f=o.byteRange;return null==this.mediaChunkIndexPromise?(p.info("LocalStorage: Retrieve segment invalid (mediaChunkIndexPromise is null)"),lt.Promise.resolve(null)):this.mediaChunkIndexPromise.then(freeOnUnref(function(e){return e.getSegmentFromChunk(t.id,n.id,r.id,f)}))}),e.prototype.selectBitrateOffline=freeOnUnref(function(e,t,n,r){var i=[],o=!1;if(null!=this.selectionContext&&null!=this.selectionContext[e.id]&&null!=this.selectionContext[e.id][this.type]?i=this.selectionContext[e.id][this.type].filter(freeOnUnref(function(e){return e.streamId===t.id})).map(freeOnUnref(function(e){return e.qualityLevelId})):null!=this.cachedSelectionContext&&null!=this.cachedSelectionContext[e.id]&&null!=this.cachedSelectionContext[e.id][this.type]&&null!=this.cachedSelectionContext[e.id][this.type][t.id]&&(o=!0,i=this.cachedSelectionContext[e.id][this.type][t.id].filter(freeOnUnref(function(e){return e.index===n})).map(freeOnUnref(function(e){return e.qualityLevelId}))),0===i.length)return{qualityLevelIndex:-1};for(var a=r.length-1;0<=a;a--){var s=r[a].id;if(-1<i.indexOf(s))return{qualityLevelIndex:a,useIndexForKey:o}}return{qualityLevelIndex:-1}}),e.prototype.retrieveLocalInitSegment=freeOnUnref(function(t,n,r,i,o){var a=this;if(!this.storageAvailable||null==i)return lt.Promise.resolve(!1);var e=i.segment,s=(e.byteRange,d(e,["byteRange"])),l=yd.createQualityLevelProgressMetadataKey(this.selectionLoader.downloadOperationId,t.id,n.id,r.id),f=gf.createLocalStorageSegmentId(this.selectionLoader.downloadOperationId,t.id,n.id,r.id,i.segment),u=gf.createLocalStorageSegmentId(this.selectionLoader.downloadOperationId,t.id,n.id,r.id,s),c="periodId: "+t.id+", type: "+this.type+", streamId: "+n.id+", downloadOperationId: "+this.selectionLoader.downloadOperationId;return p.info("LocalStorage: Retrieve init segment fetch from progress key, progressKey: "+l+", "+c),Jo.metadataStorage.get(l).then(freeOnUnref(function(e){return o.throwIfRequested(),null==e?(p.info("LocalStorage: Retrieve init segment from progress key invalid (missing or failed fetch from metadata), fallback to segment key without byte range, progressKey: "+l+", segmentKeyWithoutByteRange: "+u+", "+c),null!=a.cachedSelectionContext&&null!=a.cachedSelectionContext[t.id]&&null!=a.cachedSelectionContext[t.id][a.type]&&null!=a.cachedSelectionContext[t.id][a.type][n.id]?Pt.localStorage.getArrayBuffer(u):(p.warn("LocalStorage: Retrieve init segment fetch failed, missing from cachedSelectionContext"),null)):e.isInitSegmentStored?(p.info("LocalStorage: Retrieve init segment fetch segment, segmentKey: "+f),Pt.localStorage.getArrayBuffer(f)):(p.warn("LocalStorage: Retrieve init segment fetch failed, init segment not stored"),null)})).then(freeOnUnref(function(e){return o.throwIfRequested(),null==e?(p.info("LocalStorage: Retrieve init segment invalid (missing or failed fetch), "+c),!1):(od.FragmentUtilities.validateDownloadedSegmentData(e,i.segment),a.fragmentBuffer.addInitFragment({isInitSegment:!0,type:a.type,periodId:t.id,streamId:n.id,qualityLevelId:r.id,bitrateBps:r.bandwidth,data:e,onFreed:freeOnUnref(function(){})}),p.info("LocalStorage: Retrieve init segment fetch success, "+c),!0)})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;return p.error("LocalStorage: Retrieve init segment fetch failed, error: "+e.message+", "+c),!1}))}),e})();t.LocalSegmentLoader=n}));e(gh);gh.LocalSegmentLoader;var vh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.selectTimeline=freeOnUnref(function(e,t){return(null!=t?t.filter(e.qualityLevels,e).validQualities:e.qualityLevels)[0].segmentTimeline}),e})();t.BaseQualitySegmentTimelineSelector=n}));e(vh);vh.BaseQualitySegmentTimelineSelector;var Oh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("CompositeSegmentTimelineSelector"),n=freeOnUnref(function(){function e(e,t,n){this.mainSelector=e,this.offlineSelector=n,null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.streamAcquirers&&null!=L.configurationStore.configuration.streamAcquirers.initialQuality&&!0===L.configurationStore.configuration.streamAcquirers.initialQuality.downloadBaseQualityIndex&&(this.baseQualitySelector=t)}return Object.defineProperty(e.prototype,"isBaseQualitySelectionSupported",{get:freeOnUnref(function(){return null!=this.baseQualitySelector}),enumerable:!0,configurable:!0}),e.prototype.selectTimeline=freeOnUnref(function(e,t,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=[]),null!=this.offlineSelector&&0<r.length)try{return this.offlineSelector.selectTimeline(e,t,r)}catch(e){i.error("Offline segment timeline selection failed. Fallback to online timeline. Error:",e)}return n&&null!=this.baseQualitySelector?this.baseQualitySelector.selectTimeline(e,t):this.mainSelector.selectTimeline(e,t)}),e})();t.CompositeSegmentTimelineSelector=n}));e(Oh);Oh.CompositeSegmentTimelineSelector;var Sh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.onRebuffer=freeOnUnref(function(){}),e.prototype.onSeek=freeOnUnref(function(){}),e.prototype.onDownloadComplete=freeOnUnref(function(e,t){}),e.prototype.onConfigUpdate=freeOnUnref(function(e){}),e})();t.BaseBitrateSelector=n}));e(Sh);Sh.BaseBitrateSelector;var Uh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.getSizesBytesForFragment=freeOnUnref(function(e){return e.fragmentQualities.map(freeOnUnref(function(e){return e.sizeBytes}))}),e.getBitratesBpsForFragment=freeOnUnref(function(e){return e.fragmentQualities.map(freeOnUnref(function(e){return e.bitrateBps}))}),e})();t.FragmentUtils=n}));e(Uh);Uh.FragmentUtils;var bh=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.selectBitrate=freeOnUnref(function(e,t,n){var r=Uh.FragmentUtils.getBitratesBpsForFragment(e.fragment);return Pn.indexOfMaximum(r,freeOnUnref(function(e,t){return e-t}))}),t})(Sh.BaseBitrateSelector);t.HighestBitrateSelector=r}));e(bh);bh.HighestBitrateSelector;var Ph=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e){var t=r.call(this)||this;t.bandwidthThrottleFactorFunction=null,t.retryBandwidthThrottleFactorFunction=null,t.initialize=freeOnUnref(function(e){t.bandwidthScaleFactorFunction=new In.PiecewiseLinearFunction(e.bandwidthPredictor.bufferFullnessSecondsToConfidenceFactorGraph),t.latencyScaleFactorFunction=new In.PiecewiseLinearFunction(e.latencyPredictor.bufferFullnessSecondsToConfidenceFactorGraph),null!=e.timeToDownloadPredictor.bufferFullnessSecondsToBandwidthThrottleFactorGraph?t.bandwidthThrottleFactorFunction=new In.PiecewiseLinearFunction(e.timeToDownloadPredictor.bufferFullnessSecondsToBandwidthThrottleFactorGraph):t.bandwidthThrottleFactorFunction=null,null!=e.timeToDownloadPredictor.bufferFullnessSecondsToRetryBandwidthThrottleFactorGraph?t.retryBandwidthThrottleFactorFunction=new In.PiecewiseLinearFunction(e.timeToDownloadPredictor.bufferFullnessSecondsToRetryBandwidthThrottleFactorGraph):t.retryBandwidthThrottleFactorFunction=null}),t.playbackSettingsProvider=e;var n=t.playbackSettingsProvider.playbackSettings;return t.initialize(n),t.playbackSettingsProvider.onUpdate(t.initialize),t}return n(e,r),e.prototype.selectBitrate=freeOnUnref(function(e,t,n){for(var r=this.playbackSettingsProvider.playbackSettings,i=r.timeToDownloadPredictor,o=r.scheduler,a=this.calculateBitratePenalty(e.fragment,e.futureFragments,i.bitrateVariationFactor),s=this.calculateBitrateVariationPenaltyFactor(a,i.minBitrateVariationPenaltyFactor,i.maxBitrateVariationPenaltyFactor),l=1e3*(null===n.bandwidthAvgKbps?0:n.bandwidthAvgKbps)*s,f=null===n.bandwidthStdDevKbps?0:n.bandwidthStdDevKbps,u=this.createConfidenceLevels(l,1e3*f,o.confidenceLevelsToCompute,this.bandwidthScaleFactorFunction.evaluate(t.currentDurationMs/1e3),1),c=null===n.latencyAvgMs?0:n.latencyAvgMs,d=null===n.latencyStdDevMs?0:n.latencyStdDevMs,p=this.createConfidenceLevels(c,d,o.confidenceLevelsToCompute,this.latencyScaleFactorFunction.evaluate(t.currentDurationMs/1e3),1),h=[],m=Uh.FragmentUtils.getSizesBytesForFragment(e.fragment),y=Uh.FragmentUtils.getBitratesBpsForFragment(e.fragment),g=this.calculateBandwidthThrottleFactor(r,e,t.currentDurationMs),v=0;v<y.length;v++){var O=8*m[v];h[v]=this.calculateMaxAcceptableConfidence(r,e,t.currentDurationMs,O,u,p,g)}var S=-1,U=0;for(v=0;v<y.length;v++)y[v]>S&&h[v]>=o.minConfidenceLevelSum&&(S=y[v],U=v);return null==this.retryBandwidthThrottleFactorFunction&&0<e.attempt&&(U=Math.max(0,U-2*(e.attempt-1))),U}),e.prototype.calculateBitratePenalty=freeOnUnref(function(e,t,n){for(var r=Uh.FragmentUtils.getSizesBytesForFragment(e),i=[e].concat(t).map(freeOnUnref(function(e){return Uh.FragmentUtils.getSizesBytesForFragment(e)})),o=0,a=0;a<r.length;a++){for(var s=-1,l=0;l<i.length;l++)s=Math.max(s,i[l][a]);o+=(r[a]-s)/r[a]}return o/(r.length*n)}),e.prototype.calculateBitrateVariationPenaltyFactor=freeOnUnref(function(e,t,n){return 1+Math.max(t,Math.min(n,e))}),e.prototype.createConfidenceLevels=freeOnUnref(function(e,t,n,r,i){for(var o=[],a=0;a<n;a++)o.push(Math.max(e+r*a*t,i));return o}),e.prototype.calculateMaxAcceptableConfidence=freeOnUnref(function(e,t,n,r,i,o,a){for(var s=-1,l=0;l<i.length;l++)for(var f=i[l]/1e3,u=0;u<o.length;u++){var c=l+u,d=o[u]-o[0]+r/f;(!e.legacyHeuristic.useBufferSizeRatio||d<e.legacyHeuristic.bufferSizeRatio*n)&&d<a*t.fragment.lengthMs&&s<c&&(s=c)}return s}),e.prototype.calculateBandwidthThrottleFactor=freeOnUnref(function(e,t,n){return null!=this.retryBandwidthThrottleFactorFunction&&0<t.attempt?this.retryBandwidthThrottleFactorFunction.evaluate(n/1e3):null!=this.bandwidthThrottleFactorFunction?this.bandwidthThrottleFactorFunction.evaluate(n/1e3):Math.pow(n/e.legacyHeuristic.targetBufferFullnessMs,e.legacyHeuristic.bufferFillFactor)}),e})(Sh.BaseBitrateSelector);t.ThroughputBasedBitrateSelector=r}));e(Ph);Ph.ThroughputBasedBitrateSelector;var Mh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){var n=this;this.initialize=freeOnUnref(function(e){n.upshiftLimitFunction=new In.PiecewiseLinearFunction(e.filters.bufferFullnessSecondsToBitrateUpshiftLimitFactorGraph),n.downshiftThresholdFunction=new In.PiecewiseLinearFunction(e.filters.bufferFullnessSecondsToBitrateDownshiftLimitFactorGraph),n.downshiftRetryThresholdFunction=new In.PiecewiseLinearFunction(e.filters.bufferFullnessSecondsToBitrateRetryDownshiftLimitFactorGraph)}),this.playbackSettingsProvider=e,this.fragmentHistory=t,this.initialize(this.playbackSettingsProvider.playbackSettings),this.playbackSettingsProvider.onUpdate(this.initialize)}return e.prototype.smoothBitrate=freeOnUnref(function(e,t,n,r){var i=0<t.attempt?this.downshiftRetryThresholdFunction:this.downshiftThresholdFunction,o=this.fragmentHistory.findEvent(t.index-1);if(null===o&&null==(o=this.fragmentHistory.getRecentEvents(1)[0]))return e;var a=Uh.FragmentUtils.getBitratesBpsForFragment(t.fragment),s=e,l=e-this.findIndexLessThanOrEqualTo(o.bitrateBps,a);if(0<l){var f=Math.floor(this.upshiftLimitFunction.evaluate(n/1e3)),u=Math.min(e,o.selectedBitrateIndex+f),c=t.fragment.fragmentQualities[u].bitrateBps;s=this.findIndexLessThanOrEqualTo(c,Uh.FragmentUtils.getBitratesBpsForFragment(t.fragment))}else if(l<0){var d=Math.ceil(i.evaluate(n/1e3)),p=Math.max(e,o.selectedBitrateIndex+d);p=Math.min(p,t.fragment.fragmentQualities.length-1);var h=t.fragment.fragmentQualities[p].bitrateBps;s=this.findIndexLessThanOrEqualTo(h,Uh.FragmentUtils.getBitratesBpsForFragment(t.fragment))}return s}),e.prototype.findIndexLessThanOrEqualTo=freeOnUnref(function(e,t){for(var n=0,r=t.length-1;0<=r;--r)if(t[r]<=e){n=r;break}return n}),e})();t.QualityLevelBitrateSmoother=n}));e(Mh);Mh.QualityLevelBitrateSmoother;var Ch=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.findHighestIndexLessThanOrEqualToBitrate=freeOnUnref(function(t,e){return Math.max(0,x.findLastIndex(e,freeOnUnref(function(e){return e<=t})))}),e})();t.BitrateSelectionUtils=n}));e(Ch);Ch.BitrateSelectionUtils;var Eh=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e,t){var r=n.call(this)||this;return r.initialize=freeOnUnref(function(e){var t=e.timeToDownloadPredictor,n=e.bandwidthPredictor;r.bandwidthAdjustmentFunction=new In.PiecewiseLinearFunction(t.bufferFullnessSecondsToLiveBandwidthThrottleFactorGraph),r.maxSteps=Math.ceil((n.maxBandwidthHeadroomFactor-n.minBandwidthHeadroomFactor)/n.bandwidthHeadroomStepFactor)}),r.playbackSettingsProvider=e,r.fragmentHistory=t,r.initialize(r.playbackSettingsProvider.playbackSettings),r.playbackSettingsProvider.onUpdate(r.initialize),r}return r(e,n),e.prototype.selectBitrate=freeOnUnref(function(t,e,n){for(var r=this.playbackSettingsProvider.playbackSettings.bandwidthPredictor,i=this.fragmentHistory.getRecentEvents(this.maxSteps),o=0,a=i.length-1;0<=a&&"Baseline"!==i[a].fragmentRequestType;a--)o++;var s=r.maxBandwidthHeadroomFactor-o*r.bandwidthHeadroomStepFactor;s=Math.max(s,r.minBandwidthHeadroomFactor);var l=1e3*(null===n.bandwidthAvgKbps?0:n.bandwidthAvgKbps)*(1-s)*this.bandwidthAdjustmentFunction.evaluate(e.currentDurationMs/1e3),f=Uh.FragmentUtils.getSizesBytesForFragment(t.fragment).map(freeOnUnref(function(e){return 8*e/(t.fragment.lengthMs/1e3)})),u=l;return"Baseline"===t.requestType?u=r.bandwidthBaselineFactor*l:"Upgrade"===t.requestType&&(u=(1-r.bandwidthBaselineFactor)*l),Ch.BitrateSelectionUtils.findHighestIndexLessThanOrEqualToBitrate(u,f)}),e})(Sh.BaseBitrateSelector);t.LiveStreamingBitrateSelector=n}));e(Eh);Eh.LiveStreamingBitrateSelector;var Th=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.smoothBitrate=freeOnUnref(function(e,t,n,r){return e}),e})();t.DefaultBitrateSmoother=n}));e(Th);Th.DefaultBitrateSmoother;var wh=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this)||this;return n.bitrateSelector=e,n.bitrateSmoother=null!=t?t:new Th.DefaultBitrateSmoother,n}return n(e,r),e.prototype.selectBitrate=freeOnUnref(function(e,t,n){var r=this.bitrateSelector.selectBitrate(e,t,n);return this.bitrateSmoother.smoothBitrate(r,e,t.currentDurationMs,n)}),e})(Sh.BaseBitrateSelector);t.SmoothingBitrateSelector=r}));e(wh);wh.SmoothingBitrateSelector;var Ih=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this)||this;return n.lowBufferBitrateSelector=e,n.higherBufferBitrateSelector=t,n}return n(e,r),e.prototype.selectBitrate=freeOnUnref(function(e,t,n){return t.currentDurationMs<2e4?this.lowBufferBitrateSelector.selectBitrate(e,t,n):this.higherBufferBitrateSelector.selectBitrate(e,t,n)}),e})(Sh.BaseBitrateSelector);t.DualModeHeuristicsBitrateSelector=r}));e(Ih);Ih.DualModeHeuristicsBitrateSelector;var kh=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.LowTransient=0]="LowTransient",e[e.BufferTransient=1]="BufferTransient",e[e.TransientState=2]="TransientState",e[e.SteadyState=3]="SteadyState"})(n||(n={})),t.States=n}));e(kh);kh.States;var _h=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("QualitySelector"),n=freeOnUnref(function(){function c(e){var u=this;this.previousBitrate=null,this.previousQualitySelectionState="",this.previousMaxBufferDurationSeconds=0,this.calcVParamAndGammaDynamic=freeOnUnref(function(e,t,n,r){var i=u.maxAvailableBufferDurationSeconds-(1+u.bolaConfig.bufferScaler)*n;u.bolaConfig.shouldAdjustBufferLowWatermarkForCVBR&&c.CBR_FRAGMENT_DURATION_SEC<e&&(i=u.maxAvailableBufferDurationSeconds-(1+u.bolaConfig.bufferScaler)*(n-e+c.CBR_FRAGMENT_DURATION_SEC));var o,a=r[0][0],s=r[r.length-1][0],l=1<r.length?r[1][0]:r[0][0];o=u.bolaConfig.shouldUseRelativeChangeBasedQualityRatio?1<r.length?a/(l-a):1:l/a;var f=i/(Math.log(s/a)+Math.log(l/a)*o);return[f,(u.maxAvailableBufferDurationSeconds+u.bolaConfig.bufferScaler*t)/f-Math.log(s/a)]}),this.calcVParamAndGammaStatic=freeOnUnref(function(e,t,n,r){var i=u.maxAvailableBufferDurationSeconds+u.bolaConfig.bufferScaler*t,o=r[0][0],a=r[r.length-1][0];return[i/(Math.log(a/o)+u.bolaConfig.tradeOffFactor),u.bolaConfig.tradeOffFactor]}),this.playbackSettingsProvider=e;var t=this.playbackSettingsProvider.playbackSettings;this.maxAvailableBufferDurationSeconds=t.buffer.forwardBufferLengthSeconds,"DYNAMIC_TRADE_OFF_FACTOR"===this.bolaConfig.bolaAlgorithm?this.calcVParamAndGamma=this.calcVParamAndGammaDynamic:this.calcVParamAndGamma=this.calcVParamAndGammaStatic}return c.prototype.setMaxAvailableBufferDurationSeconds=freeOnUnref(function(e){this.maxAvailableBufferDurationSeconds=e}),Object.defineProperty(c.prototype,"bolaConfig",{get:freeOnUnref(function(){return this.playbackSettingsProvider.playbackSettings.bola}),enumerable:!0,configurable:!0}),c.prototype.selectBitrate=freeOnUnref(function(e,t,n){for(var r,i,o,a=n.effectiveBufferDurationSeconds,s=n.effectiveBufferLowWatermarkSeconds,l=e.fragment.lengthMs/1e3,f=this.getBitrateFragmentSizeMap(e),u=f.length-1,c=this.calcVParamAndGamma(l,a,s,f),d=c[0],p=c[1],h=f[0][0],m=[],y=Number.NEGATIVE_INFINITY,g=0;g<f.length;g++){var v=f[g],O=v[0],S=v[1],U=d*(Math.log(O/h)+p)-(1+this.bolaConfig.bufferScaler)*a,b=this.bolaConfig.shouldUseBitrateInGoodnessValueCalculation?U/O:U/S;y<(m[g]=b)&&(y=b)}var P=f[u][0],M=u;return M=(r=this.selectQualityAboveIdealGoodnessValue(M,P,y,m,f))[0],P=r[1],M=(i=this.throttleRampUpQualityLevel(M,P,f))[0],P=i[1],n.shouldUseThroughputEstimateInGetBolaBitRate&&(M=(o=this.adjustInitialBitRateUsingThroughput(P,M,t,f,n.scalerThroughputEstimateInGetBolaBitRate))[0],P=o[1]),this.logCriticalStateChange(e,P,M,u,a,n,t),this.previousBitrate=P,M}),c.prototype.calculateTransientBufferDuration=freeOnUnref(function(e,t,n){for(var r=e/1e3,i=t.fragment.lengthMs/1e3,o=this.getBitrateFragmentSizeMap(t),a=o.length-1,s=this.calcVParamAndGamma(i,r,n,o),l=s[0],f=s[1],u=o[a][0],c=o[0][0],d=u*this.bolaConfig.startupBitratePercent,p=0,h=0;h<o.length;h++)o[h][0]<=d&&(p=h);if(0===p)return n;var m=o[p][0],y=o[Math.max(p-1,0)][0];return(l*m*(Math.log(y/c)+f)-l*y*(Math.log(m/c)+f))/(m-y)}),c.prototype.getBitrateFragmentSizeMap=freeOnUnref(function(e){var t=Uh.FragmentUtils.getBitratesBpsForFragment(e.fragment),n=Uh.FragmentUtils.getSizesBytesForFragment(e.fragment),r=t.map(freeOnUnref(function(e,t){return[e,n[t]]}));return r.sort(freeOnUnref(function(e,t){return e[0]-t[0]})),r}),c.prototype.selectQualityAboveIdealGoodnessValue=freeOnUnref(function(e,t,n,r,i){if(0<=n)for(var o=n*this.bolaConfig.rampUpGoodnessValueFactor,a=0;a<r.length&&!(r[a]>=o&&(t=i[a][0],e=a,this.bolaConfig.shouldSelectLowestQualityAboveIdealGoodnessValue));a++);return[e,t]}),c.prototype.throttleRampUpQualityLevel=freeOnUnref(function(e,t,n){if(null!==this.previousBitrate){for(var r=0,i=0;i<n.length&&!(n[i][0]>this.previousBitrate);i++)r=i;e>this.bolaConfig.maxRampUpQualityLevel+r&&(t=n[e=this.bolaConfig.maxRampUpQualityLevel+r][0])}return[e,t]}),c.prototype.adjustInitialBitRateUsingThroughput=freeOnUnref(function(e,t,n,r,i){var o=null==n.bandwidthAvgKbps?0:n.bandwidthAvgKbps*c.BITS_KILOBITS_CONVERSION,a=r[0][0],s=Math.max(i*o-this.bolaConfig.reservedBandwidthForAudioBitsPerSecond,a);if(0<o&&a<e&&s<=e)for(var l=0;l<r.length&&r[l][0]<=s;l++)e=r[t=l][0];return[t,e]}),c.prototype.logCriticalStateChange=freeOnUnref(function(e,t,n,r,i,o,a){var s=(Math.abs(this.previousMaxBufferDurationSeconds-this.maxAvailableBufferDurationSeconds)/this.maxAvailableBufferDurationSeconds).toFixed(1),l=o.algorithmState+"-"+s+"-"+c.convertBitsToMegaBits(t);this.previousQualitySelectionState!==l&&f.info("BolaQuality Frag: "+e.index+", selecting "+c.convertBitsToMegaBits(t)+" of index "+n+"/"+r+", bufferDuration "+i.toFixed(2)+"/"+this.maxAvailableBufferDurationSeconds.toFixed(2)+", state "+kh.States[o.algorithmState]+", BwMbps "+(a.bandwidthAvgKbps?(a.bandwidthAvgKbps/c.KILOBITS_MEGABITS_CONVERSION).toFixed(2):"NA")+", LatencyMs "+(a.latencyAvgMs?a.latencyAvgMs.toFixed(2):"NA")),this.previousQualitySelectionState=l,this.previousMaxBufferDurationSeconds=this.maxAvailableBufferDurationSeconds}),c.convertBitsToMegaBits=freeOnUnref(function(e){return(e/c.BITS_MEGABITS_CONVERSION).toFixed(2)+" Mbps"}),c.BITS_KILOBITS_CONVERSION=1e3,c.BITS_MEGABITS_CONVERSION=1e6,c.KILOBITS_MEGABITS_CONVERSION=1e3,c.CBR_FRAGMENT_DURATION_SEC=2,c})();t.QualitySelector=n}));e(_h);_h.QualitySelector;var Rh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("BolaTransientStateController");var n=freeOnUnref(function(){function e(e,t){var n=this;this.initialize=freeOnUnref(function(e){n.maxAvailableBufferDurationSeconds=e.buffer.forwardBufferLengthSeconds}),this.onStateChange=freeOnUnref(function(e){n.prevState=n.currentState,n.currentState=e}),this.playbackSettingsProvider=e,this.qualitySelector=t,this.stateMachine=new ml.FiniteStateMachine(kh.States.LowTransient),this.stateMachine.addTransition(kh.States.LowTransient,0,kh.States.BufferTransient),this.stateMachine.addTransition(kh.States.LowTransient,1,kh.States.LowTransient),this.stateMachine.addTransition(kh.States.TransientState,0,kh.States.BufferTransient),this.stateMachine.addTransition(kh.States.TransientState,1,kh.States.LowTransient),this.stateMachine.addTransition(kh.States.SteadyState,0,kh.States.BufferTransient),this.stateMachine.addTransition(kh.States.SteadyState,1,kh.States.LowTransient),this.stateMachine.addTransition(kh.States.BufferTransient,0,kh.States.BufferTransient),this.stateMachine.addTransition(kh.States.BufferTransient,1,kh.States.LowTransient),this.stateMachine.addTransition(kh.States.LowTransient,3,kh.States.TransientState),this.stateMachine.addTransition(kh.States.TransientState,2,kh.States.LowTransient),this.stateMachine.addTransition(kh.States.TransientState,4,kh.States.SteadyState),this.stateMachine.addTransition(kh.States.BufferTransient,3,kh.States.TransientState),this.transientBufferDurationSeconds=0,this.transientBufferLastUpdateTimeStampMillis=Date.now(),this.isInitialized=!1,this.initialize(e.playbackSettings),e.onUpdate(this.initialize),this.prevState=kh.States.LowTransient,this.currentState=kh.States.LowTransient,this.stateMachine.onStateChange(this.onStateChange)}return e.prototype.updateMaxAvailableBuffer=freeOnUnref(function(e){this.bolaConfig.recomputeVirtualBufferOnBufferCapacityChange&&(this.transientBufferDurationSeconds=e*(this.transientBufferDurationSeconds/this.maxAvailableBufferDurationSeconds)),this.maxAvailableBufferDurationSeconds=e}),e.prototype.calculateEffectiveBufferDurationSeconds=freeOnUnref(function(e,t){var n=0,r=e/1e3,i=this.dynamicTransientBufferThresholdSeconds(r);switch(this.currentState){case kh.States.LowTransient:case kh.States.BufferTransient:this.initializeTransientBufferDuration(e,t),this.updateTransientBufferDurationWithClip(),i<r&&this.stateMachine.actNow(3),n=this.transientBufferDurationSeconds;break;case kh.States.TransientState:this.updateTransientBufferDurationWithClip(),n=this.transientBufferDurationSeconds,r>this.transientBufferDurationSeconds?(this.stateMachine.actNow(4),n=r,this.resetStateVariables()):r<i&&this.stateMachine.actNow(2);break;case kh.States.SteadyState:default:n=r}return n}),e.prototype.onDownloadComplete=freeOnUnref(function(e,t){if(this.currentState!==kh.States.SteadyState){switch(this.currentState){case kh.States.LowTransient:case kh.States.BufferTransient:this.transientBufferDurationSeconds+=t*this.bolaConfig.lowTransientBufferDurationIncrementScaleFactor;break;case kh.States.TransientState:default:this.transientBufferDurationSeconds+=t*this.bolaConfig.transientBufferDurationIncrementScaleFactor}this.updateTransientBufferDurationWithClip()}}),e.prototype.getBufferLowWaterMarkSeconds=freeOnUnref(function(e){return this.bolaConfig.shouldAdjustBufferLowWatermarkForLowTransient&&this.isInLowTransientState()&&this.prevState!==kh.States.TransientState?this.dynamicBufferLowWatermarkSecondsForLowTransient(e):this.dynamicBufferLowWaterMarkSeconds(e)}),e.prototype.scaleMaxAvailableBufferDuration=freeOnUnref(function(e,t){var n=this.bolaConfig.maxAvailableBufferDurationScaleFactorHigh-this.bolaConfig.maxAvailableBufferDurationScaleFactorLow,r=t-this.bolaConfig.bufferLowWatermarkSeconds,i=e-this.bolaConfig.bufferLowWatermarkSeconds,o=this.bolaConfig.maxAvailableBufferDurationScaleFactorHigh-n*(r/i);return In.clamp(o,this.bolaConfig.maxAvailableBufferDurationScaleFactorLow,this.bolaConfig.maxAvailableBufferDurationScaleFactorHigh)*e}),e.prototype.shouldUseThroughputEstimateInGetBolaBitRate=freeOnUnref(function(){return this.bolaConfig.shouldSwitchHybridBolaOnTransientStates?this.isInLowTransientState():this.bolaConfig.shouldUseThroughputEstimateInGetBolaBitRate}),e.prototype.scalerThroughputEstimateInGetBolaBitRate=freeOnUnref(function(){return this.isInLowTransientState()?this.bolaConfig.scalerThroughputEstimateInGetBolaBitRateLowTransient:this.bolaConfig.scalerThroughputEstimateInGetBolaBitRate}),e.prototype.onSeek=freeOnUnref(function(){this.stateMachine.actNow(1),this.resetStateVariables()}),e.prototype.onRebuffer=freeOnUnref(function(){this.stateMachine.actNow(0),this.resetStateVariables()}),e.prototype.getAlgorithmState=freeOnUnref(function(){return this.currentState}),Object.defineProperty(e.prototype,"bolaConfig",{get:freeOnUnref(function(){return this.playbackSettingsProvider.playbackSettings.bola}),enumerable:!0,configurable:!0}),e.prototype.dynamicBufferLowWaterMarkSeconds=freeOnUnref(function(e){if(this.bolaConfig.shouldAdaptForGivenDeviceMaxBuffer){var t=this.playbackSettingsProvider.playbackSettings.buffer.forwardBufferLengthSeconds,n=this.scaleMaxAvailableBufferDuration(t,e)-this.bolaConfig.bufferLowWatermarkSeconds;return In.clamp(this.maxAvailableBufferDurationSeconds-n,this.bolaConfig.minBufferLowWatermarkSeconds,this.bolaConfig.bufferLowWatermarkSeconds)}return this.bolaConfig.bufferLowWatermarkSeconds}),e.prototype.dynamicTransientBufferThresholdSeconds=freeOnUnref(function(e){return Math.min(this.bolaConfig.transientStateBufferThresholdSeconds,this.dynamicBufferLowWaterMarkSeconds(e))}),e.prototype.dynamicBufferLowWatermarkSecondsForLowTransient=freeOnUnref(function(e){return this.bolaConfig.shouldAdaptForGivenDeviceMaxBuffer?(this.dynamicBufferLowWaterMarkSeconds(e)+this.maxAvailableBufferDurationSeconds)/2:this.bolaConfig.bufferLowWatermarkSecondsForLowTransient}),e.prototype.resetStateVariables=freeOnUnref(function(){this.transientBufferDurationSeconds=0,this.transientBufferLastUpdateTimeStampMillis=0,this.isInitialized=!1}),e.prototype.initializeTransientBufferDuration=freeOnUnref(function(e,t){if(!this.isInitialized){switch(this.currentState){case kh.States.BufferTransient:this.transientBufferDurationSeconds=this.bolaConfig.bufferLowWatermarkSeconds-.1;break;case kh.States.LowTransient:var n=e/1e3;this.transientBufferDurationSeconds=this.qualitySelector.calculateTransientBufferDuration(e,t,this.getBufferLowWaterMarkSeconds(n)),this.transientBufferDurationSeconds=Math.max(this.transientBufferDurationSeconds,n)}this.transientBufferLastUpdateTimeStampMillis=Date.now(),this.isInitialized=!0}}),e.prototype.updateTransientBufferDurationWithClip=freeOnUnref(function(){var e=Date.now(),t=(this.transientBufferLastUpdateTimeStampMillis-e)/1e3;t=Math.max(t,0);var n=this.transientBufferDurationSeconds-t;this.transientBufferLastUpdateTimeStampMillis=e,this.transientBufferDurationSeconds=Math.min(this.bolaConfig.transientClipMaxDurationFactor*this.maxAvailableBufferDurationSeconds,Math.max(n,0))}),e.prototype.isInLowTransientState=freeOnUnref(function(){return this.currentState===kh.States.LowTransient||this.currentState===kh.States.BufferTransient}),e})();t.TransientStateController=n}));e(Rh);Rh.TransientStateController;var Ah=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("PaddingBufferController");var n=freeOnUnref(function(){function e(){this.aggregatedFragmentAcquisitionDelaysMs=0,this.lastFragmentDownloadedTimeMs=Number.NEGATIVE_INFINITY}return e.prototype.onDownloadComplete=freeOnUnref(function(e){this.lastFragmentDownloadedTimeMs=Date.now();var t=Math.max(e.fragmentDurationMs,e.elapsedDurationMs);this.aggregatedFragmentAcquisitionDelaysMs=Math.max(0,this.aggregatedFragmentAcquisitionDelaysMs-t)}),e.prototype.getCompensatedBufferDurationSeconds=freeOnUnref(function(e,t){var n=1e3*e,r=this.getCurrentFragmentAcquisitionDelayMs(),i=n+r+this.aggregatedFragmentAcquisitionDelaysMs,o=In.clamp(i,n,1e3*t);return this.aggregatedFragmentAcquisitionDelaysMs+=r,this.aggregatedFragmentAcquisitionDelaysMs=Math.min(this.aggregatedFragmentAcquisitionDelaysMs,o),o/1e3}),e.prototype.onSeek=freeOnUnref(function(){this.resetState()}),e.prototype.onRebuffer=freeOnUnref(function(){this.resetState()}),e.prototype.getCurrentFragmentAcquisitionDelayMs=freeOnUnref(function(){return this.lastFragmentDownloadedTimeMs!==Number.NEGATIVE_INFINITY?Date.now()-this.lastFragmentDownloadedTimeMs:0}),e.prototype.resetState=freeOnUnref(function(){this.aggregatedFragmentAcquisitionDelaysMs=0,this.lastFragmentDownloadedTimeMs=Number.NEGATIVE_INFINITY}),e})();t.PaddingBufferController=n}));e(Ah);Ah.PaddingBufferController;var Dh=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});de.get("BolaBitrateSelector");var n=freeOnUnref(function(n){function e(e){var t=n.call(this)||this;return t.prevBufferDurationSeconds=null,t.playbackSettingsProvider=e,t.qualitySelector=new _h.QualitySelector(e),t.transientStateController=new Rh.TransientStateController(e,t.qualitySelector),t.paddingBufferController=new Ah.PaddingBufferController,t}return r(e,n),e.prototype.selectBitrate=freeOnUnref(function(e,t,n){var r,i=t.currentDurationMs/1e3,o=this.transientStateController.scaleMaxAvailableBufferDuration(t.maxAvailableDurationMs/1e3,i);return this.transientStateController.updateMaxAvailableBuffer(o),this.qualitySelector.setMaxAvailableBufferDurationSeconds(o),this.bolaConfig.shouldUseActualFragmentDurationToUpdateBuffer||this.transientStateController.onDownloadComplete(i,this.calculateDownloadedFragmentDuration(i)),r=this.bolaConfig.shouldCompensateForExternalFragmentAcquisitionDelay?this.paddingBufferController.getCompensatedBufferDurationSeconds(i,o):i,this.qualitySelector.selectBitrate(e,n,this.getQualitySelectionParameters(e,r))}),e.prototype.onSeek=freeOnUnref(function(){this.transientStateController.onSeek(),this.paddingBufferController.onSeek()}),e.prototype.onRebuffer=freeOnUnref(function(){this.transientStateController.onRebuffer(),this.paddingBufferController.onRebuffer()}),e.prototype.onDownloadComplete=freeOnUnref(function(e,t){var n=e.currentDurationMs/1e3,r=t.fragmentDurationMs/1e3;this.bolaConfig.shouldUseActualFragmentDurationToUpdateBuffer&&this.transientStateController.onDownloadComplete(n,r),this.paddingBufferController.onDownloadComplete(t)}),Object.defineProperty(e.prototype,"bolaConfig",{get:freeOnUnref(function(){return this.playbackSettingsProvider.playbackSettings.bola}),enumerable:!0,configurable:!0}),e.prototype.calculateDownloadedFragmentDuration=freeOnUnref(function(e){var t=null!==this.prevBufferDurationSeconds?e-this.prevBufferDurationSeconds:0;return this.prevBufferDurationSeconds=e,t}),e.getMaxBitrateForGivenSession=freeOnUnref(function(e){var t=Uh.FragmentUtils.getBitratesBpsForFragment(e.fragment).sort(freeOnUnref(function(e,t){return e-t}));return t[t.length-1]}),e.prototype.getQualitySelectionParameters=freeOnUnref(function(e,t){return{effectiveBufferDurationSeconds:this.transientStateController.calculateEffectiveBufferDurationSeconds(1e3*t,e),effectiveBufferLowWatermarkSeconds:this.transientStateController.getBufferLowWaterMarkSeconds(t),shouldUseThroughputEstimateInGetBolaBitRate:this.transientStateController.shouldUseThroughputEstimateInGetBolaBitRate(),scalerThroughputEstimateInGetBolaBitRate:this.transientStateController.scalerThroughputEstimateInGetBolaBitRate(),algorithmState:this.transientStateController.getAlgorithmState()}}),e})(Sh.BaseBitrateSelector);t.BolaBitrateSelector=n}));e(Dh);Dh.BolaBitrateSelector;var xh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function i(){}return i.prototype.getQualityScores=freeOnUnref(function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n].qualityScore;if(null==i)return null;t.push(i)}return t}),i.prototype.calculatePerceptualQualityObjectiveValue=freeOnUnref(function(e,t,n,r,i,o){return t[r]-e.rebufferingCostFactorForPerceptualQuality*i-e.switchingCostFactorForPerceptualQuality*Math.abs(t[n]-t[r])-this.getDeviationCost(e.deviationCostStrategy,t[r],o)}),i.prototype.getDeviationCost=freeOnUnref(function(e,t,n){switch(e){case"Symmetrical":return this.getSymmetricalDeviationCost(t,n);case"Asymmetrical":return this.getAsymmetricalDeviationCost(t,n);default:return this.getSymmetricalDeviationCost(t,n)}}),i.prototype.getSymmetricalDeviationCost=freeOnUnref(function(e,t){return 0===t?i.DEFAULT_DEVIATION_COST:Math.abs(1-e/t)}),i.prototype.getAsymmetricalDeviationCost=freeOnUnref(function(e,t){if(1===t)return i.DEFAULT_DEVIATION_COST;var n=Math.abs(e/t-1),r=Math.max(n,i.LOWEST_ASYMMETRICAL_COST);return Math.pow(r,2)}),i.DEFAULT_DEVIATION_COST=0,i.LOWEST_ASYMMETRICAL_COST=0,i})();t.MpcPerceptualQualityStrategyHandler=n}));e(xh);xh.MpcPerceptualQualityStrategyHandler;var Fh=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("MpcBitrateSelector"),n=freeOnUnref(function(n){function l(e){var t=n.call(this)||this;return t.lastBitrateIndex=0,t.previousQualitySelectionState="",t.previousMaxBufferDurationMs=0,t.playbackSettingsProvider=e,t.perceptualQualityStrategyHandler=new xh.MpcPerceptualQualityStrategyHandler,t.utilityFunction=freeOnUnref(function(e,t,n){return Math.log(Math.max(e,l.LOWEST_MIN_VALUE)/n)/Math.log(n/Math.max(t,l.LOWEST_MIN_VALUE))}),t}return r(l,n),l.prototype.selectBitrate=freeOnUnref(function(e,t,n){var r=this.playbackSettingsProvider.playbackSettings.mpc,i=r.predictionStrategy,o=r.lookAheadWindowSize,a=r.maxQualityLevelChange,s=t.currentDurationMs,l=this.createUtilityTable(r,i,e),f=e.fragment.fragmentQualities.map(freeOnUnref(function(e){return e.bitrateBps/1e3})),u=this.selectBitrateFromMonotonicSequences(r,e,t,n,l,o,a,s,this.lastBitrateIndex,-1),c=u[0],d=u[1];if(null==c){var p=(n.bandwidthAvgKbps||0)*r.estimatedBandwidthSafetyFactorForStartup;return this.lastBitrateIndex=Math.max(x.sortedIndex(f,p)-1,0)}var h=this.selectBitrateFromMonotonicSequences(r,e,t,n,l,o,a,s,this.lastBitrateIndex,1),m=h[0],y=h[1];if(null==m)return this.lastBitrateIndex=c;var g=d<y?m:c;return this.logCriticalStateChange(e,e.fragment.fragmentQualities[g].bitrateBps,g,f.length-1,t,n),this.lastBitrateIndex=g}),l.prototype.selectBitrateFromMonotonicSequences=freeOnUnref(function(t,e,n,r,i,o,a,s,l,f){for(var u=null,c=-1/0,d=freeOnUnref(function(e){return Math.pow(Math.max(1-e/t.targetBufferDurationMs,0),2)}),p=i.utilityTable,h=e.fragment.fragmentQualities.map(freeOnUnref(function(e){return e.bitrateBps/1e3})),m=e.fragment.lengthMs,y=e.fragment.fragmentQualities.map(freeOnUnref(function(e){return e.sizeBytes})),g=(r.bandwidthAvgKbps||0)*t.estimatedBandwidthSafetyFactor,v=-1===f?Math.max(l-a-1,-1):Math.min(l+a+1,p.length),O=l;O!==v;O+=f){var S=8*y[O]/g;t.useThroughputAvg&&null!=r.latencyAvgMs&&(S+=r.latencyAvgMs);var U="FragmentBased"===t.lookAheadType?s-S:s-m;if(!(U<0)){var b="FragmentBased"===t.lookAheadType?m:g*m/h[O],P="FragmentBased"===t.lookAheadType?p[O]:p[O]*b/m,M=d(U),C=0;if(C="PerceptualQuality"===i.predictionStrategy?this.perceptualQualityStrategyHandler.calculatePerceptualQualityObjectiveValue(t,p,l,O,M,i.targetUtilityValue):this.calculateObjectiveValue(t,P,p,l,O,M),U=Math.min(U+b,n.maxAvailableDurationMs),1<o){var E=-1===f?a-(l-O):a-(O-l),T=this.selectBitrateFromMonotonicSequences(t,e,n,r,i,o-1,E,U,O,f),w=T[0],I=T[1];if(null==w)continue;C+=I}c<C&&(u=O,c=C)}}return[u,c]}),l.prototype.calculateObjectiveValue=freeOnUnref(function(e,t,n,r,i,o){return t-e.rebufferingCostFactor*o-e.switchingCostFactor*Math.abs(n[r]-n[i])}),l.prototype.createUtilityTable=freeOnUnref(function(e,t,n){var r=this,i=[],o=0;if("PerceptualQuality"===t){var a=n.fragment.fragmentQualities,s=this.perceptualQualityStrategyHandler.getQualityScores(a);if(null!=s)return i=s.map(freeOnUnref(function(e){return r.utilityFunction(e,s[0],s[s.length-1])})),{predictionStrategy:"PerceptualQuality",targetUtilityValue:o=this.utilityFunction(e.targetQualityScore,s[0],s[s.length-1]),utilityTable:i}}var l=n.fragment.fragmentQualities.map(freeOnUnref(function(e){return e.bitrateBps/1e3}));return{predictionStrategy:"Bitrate",targetUtilityValue:o,utilityTable:i=l.map(freeOnUnref(function(e){return r.utilityFunction(e,l[0],l[l.length-1])}))}}),l.prototype.logCriticalStateChange=freeOnUnref(function(e,t,n,r,i,o){var a=(Math.abs(this.previousMaxBufferDurationMs-i.maxAvailableDurationMs)/i.maxAvailableDurationMs).toFixed(1),s=n+"-"+this.convertBitsToMegaBits(t)+"-"+a;this.previousQualitySelectionState!==s&&f.info("Frag: "+e.index+", selecting "+this.convertBitsToMegaBits(t)+" of index "+n+"/"+r+", bufferDuration "+i.currentDurationMs.toFixed(2)+"/"+i.maxAvailableDurationMs.toFixed(2)+", BwMbps "+(o.bandwidthAvgKbps?(o.bandwidthAvgKbps/l.KILOBITS_MEGABITS_CONVERSION).toFixed(2):"NA")+", LatencyMs "+(o.latencyAvgMs?o.latencyAvgMs.toFixed(2):"NA")),this.previousQualitySelectionState=s,this.previousMaxBufferDurationMs=i.maxAvailableDurationMs}),l.prototype.convertBitsToMegaBits=freeOnUnref(function(e){return(e/l.BITS_MEGABITS_CONVERSION).toFixed(2)+" Mbps"}),l.BITS_MEGABITS_CONVERSION=1e6,l.KILOBITS_MEGABITS_CONVERSION=1e3,l.LOWEST_MIN_VALUE=1,l})(Sh.BaseBitrateSelector);t.MpcBitrateSelector=n}));e(Fh);Fh.MpcBitrateSelector;var Bh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.playbackSettingsProvider=e}return e.prototype.createBitrateSelector=freeOnUnref(function(e,t){if("Video"!==e)return new bh.HighestBitrateSelector;switch(this.playbackSettingsProvider.playbackSettings.player.heuristicAlgorithm){case"BOLA_V1":return new Dh.BolaBitrateSelector(this.playbackSettingsProvider);case"MPC":return new Fh.MpcBitrateSelector(this.playbackSettingsProvider);case"DUAL_MODE_HEURISTICS":default:var n=new Eh.LiveStreamingBitrateSelector(this.playbackSettingsProvider,t),r=new Ph.ThroughputBasedBitrateSelector(this.playbackSettingsProvider),i=new Mh.QualityLevelBitrateSmoother(this.playbackSettingsProvider,t),o=new wh.SmoothingBitrateSelector(r,i);return new Ih.DualModeHeuristicsBitrateSelector(n,o)}}),e})();t.AggregatedBitrateSelectorFactory=n}));e(Bh);Bh.AggregatedBitrateSelectorFactory;var Lh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=40),this.maxEvents=e,this.fragments=[]}return e.prototype.addEvent=freeOnUnref(function(e){this.fragments.push(e),this.fragments.length>this.maxEvents&&this.fragments.shift()}),e.prototype.getRecentEvents=freeOnUnref(function(e){return x.last(this.fragments,e)}),e.prototype.findEvent=freeOnUnref(function(e,t){for(var n=this.fragments.length-1;0<=n;--n){var r=this.fragments[n];if(r.index===e&&(null==t||r.bitrateBps===t))return r}return null}),e})();t.FragmentHistory=n}));e(Lh);Lh.FragmentHistory;var Nh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AggregatedBitrateSelectorFactory=Bh.AggregatedBitrateSelectorFactory,t.FragmentHistory=Lh.FragmentHistory,t.BitrateSelectionUtils=Ch.BitrateSelectionUtils}));e(Nh);Nh.AggregatedBitrateSelectorFactory,Nh.FragmentHistory,Nh.BitrateSelectionUtils;var Vh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("InitialQualitySelector");var n=freeOnUnref(function(){function e(){}return e.prototype.selectTimeline=freeOnUnref(function(e,t){var n=_c.getInstance().getNetworkStatistics(),r=0,i=null!=t?t.filter(e.qualityLevels,e).validQualities:e.qualityLevels;return r=null===n.bandwidthAvgKbps||0===n.bandwidthAvgKbps?Math.floor(i.length/2):Nh.BitrateSelectionUtils.findHighestIndexLessThanOrEqualToBitrate(1e3*n.bandwidthAvgKbps,i.map(freeOnUnref(function(e){return e.bandwidth}))),i[r].segmentTimeline}),e})();t.InitialQualitySelector=n}));e(Vh);Vh.InitialQualitySelector;var jh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("OfflineSegmentTimelineSelector"),n=freeOnUnref(function(){function e(){}return e.prototype.selectTimeline=freeOnUnref(function(t,e,n){void 0===n&&(n=[]);var r=n.filter(freeOnUnref(function(e){return e.streamId===t.id})).map(freeOnUnref(function(e){return e.qualityLevelId}));if(0===r.length)throw a.warn("The specified stream does not match offline stream selection context."),new Error("The passed in stream mismatches the downloader selection. Attempt of local asset playback WILL FAIL!!!");for(var i=null!=e?e.filter(t.qualityLevels,t).validQualities:t.qualityLevels,o=i.length-1;0<=o;o--)if(-1!==r.indexOf(i[o].id))return i[o].segmentTimeline;throw new Error("Unable to find a stream's qualityLevel matching the downloader selection. Attempt of local asset playback WILL FAIL!!!")}),e})();t.OfflineSegmentTimelineSelector=n}));e(jh);jh.OfflineSegmentTimelineSelector;var qh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.toContentRelative=function(e,t,n){var r=e.startMs+t.startTimeMs;return"Image"!==n&&(r=Math.max(r,0)),{startTimeMs:r,durationMs:t.durationMs,endTimeMs:Math.max(e.startMs+t.endTimeMs,0)}},t.clampInPeriodBoundary=function(e,t){var n=Math.max(e.startMs,t.startTimeMs,0),r=Math.max(Math.min(e.endMs,t.endTimeMs),0);return{startTimeMs:n,durationMs:r-n,endTimeMs:r}}}));e(qh);qh.toContentRelative,qh.clampInPeriodBoundary;var Hh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.waitSegment=function t(n,r,i,o,a,s){void 0===s&&(s=!0);var e=n();return("RefreshMe"===e.type?e.load():lt.Promise.resolve(e)).then(freeOnUnref(function(e){return o.throwIfRequested(),"Unavailable"===e.type?null!=e.etaMs&&s?(null!=a&&a(),new lt.Delay(e.etaMs,o).promise.then(freeOnUnref(function(){return o.throwIfRequested(),t(n,r,i,o)}))):null:{segment:e.segment,period:r,stream:i,contentPosition:qh.toContentRelative(r,e.segment.position,i.type),isFinalSegment:e.segment.isFinalSegment&&r.isFinalPeriod}}))}}));e(Hh);Hh.waitSegment;var zh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a){this.log=new Ka.EphemeralJSLogger("PrimarySegmentInfoProducer"),this.waitingSegmentCallback=new A.MulticastCallback,this.finalSegmentProduced=!1,this.streamType=e,this.periodAccessor=t,this.streamSelector=n,this.streamAlternator=r,this.acceptableSegmentPositionErrorMs=i,this.qualityLevelFilter=o,this.timelineSelector=null!=a?a:new Oh.CompositeSegmentTimelineSelector(new Vh.InitialQualitySelector,new vh.BaseQualitySegmentTimelineSelector,new jh.OfflineSegmentTimelineSelector),this.selectionContext=null,this.log.setId(e),this.diagnostics=nn.Diagnostics.create("PrimarySegmentInfoProducer."+e),this.nextSegmentQuery=null,this.nextSegmentResult=null}return Object.defineProperty(e.prototype,"isFinalSegmentProduced",{get:freeOnUnref(function(){return this.finalSegmentProduced}),enumerable:!0,configurable:!0}),e.prototype.getSegmentAt=freeOnUnref(function(n,r){var i=this;return this.periodAccessor.getPeriodAt(n).then(freeOnUnref(function(t){return r.throwIfRequested(),null==t?(i.log.warn("No initial period at "+n),null):i.queryOnPeriod(lt.Promise.resolve(t),freeOnUnref(function(e,t){return t.getSegmentAt(Math.max(n-e.startMs,0),i.acceptableSegmentPositionErrorMs)}),r,!0).then(freeOnUnref(function(e){return null!=e?e:i.tryGetSegmentMultiPeriod(t,r)}))}))}),e.prototype.getNextSegment=freeOnUnref(function(r,i){var o=this,a=this.selectTimeline(r.stream,!1,this.getStreamSelectionContexts(r.period));return Hh.waitSegment(freeOnUnref(function(){return a.getEquivalentSegment(r.segment)}),r.period,r.stream,i).then(freeOnUnref(function(e){if(i.throwIfRequested(),null===e)return o.log.error("Previous segment could not be found in SegmentTimeline!!!"),null;if(e.segment.isFinalSegment)return r.period.isFinalPeriod?(o.finalSegmentProduced=!0,null):o.periodAccessor.getNextPeriod(r.period).then(freeOnUnref(function(t){return i.throwIfRequested(),null==t?null:o.queryOnPeriod(lt.Promise.resolve(t),freeOnUnref(function(e,t){return t.getSegmentAt(0,o.acceptableSegmentPositionErrorMs)}),i,!1,r).then(freeOnUnref(function(e){return null!=e?e:o.tryGetSegmentMultiPeriod(t,i,r)}))}));var t=a.getNext(e.segment),n=void 0;if("Unavailable"===t.type){if(o.updateNextSegmentQueryState(r,t.type,t.etaMs,t.reason),null==t.etaMs)return o.log.error("Next segment after "+r.segment.index+" on period "+r.period.id+" is unavailable and without eta!"),null;o.waitingSegmentCallback.invoke(r),n=new lt.Delay(t.etaMs,i).promise.then(freeOnUnref(function(){return t}))}else{if("RefreshMe"!==t.type)return o.updateNextSegmentQueryState(r,t.type),Hh.waitSegment(freeOnUnref(function(){return t}),r.period,r.stream,i);o.updateNextSegmentQueryState(r,t.type),n=t.load()}return n.then(freeOnUnref(function(){return o.getNextSegment(r,i)}))})).then(freeOnUnref(function(e){if(i.throwIfRequested(),null===e)return o.updateNextSegmentResultState(r),null;o.updateNextSegmentResultState(r,e);var t=e.contentPosition.startTimeMs-r.contentPosition.endTimeMs;if(.1<Math.abs(t)){var n=0<t?"gap":"overlap";o.log.warn(t+"ms "+n+" between periodId="+r.period.id+", index="+r.segment.index+" and periodId="+e.period.id+", index="+e.segment.index)}return e}))}),e.prototype.tryGetSegmentMultiPeriod=freeOnUnref(function(e,t,n){return x.contains(vu.CRITICAL_STREAM_TYPES,this.streamType)?(this.log.warn("First segment of the current period ["+e.id+"] not found for a critical stream type. This will cause playback to fail."),lt.Promise.resolve(null)):this.getSegmentMultiPeriod(e,t,n)}),e.prototype.setSelectionContext=freeOnUnref(function(e){null!=this.selectionContext&&null==e&&this.log.warn("Explicitly resetting selection context"),this.selectionContext=e}),e.prototype.onWaitingForSegment=freeOnUnref(function(e){this.waitingSegmentCallback.add(e)}),e.prototype.offWaitingForSegment=freeOnUnref(function(e){this.waitingSegmentCallback.remove(e)}),e.prototype.getSegmentMultiPeriod=freeOnUnref(function(e,n,r){var i=this;return void 0===r&&(r=null),this.periodAccessor.getNextPeriod(e).then(freeOnUnref(function(t){return n.throwIfRequested(),null==t?null:i.queryOnPeriod(lt.Promise.resolve(t),freeOnUnref(function(e,t){return t.getSegmentAt(0,i.acceptableSegmentPositionErrorMs)}),n,!1,r).then(freeOnUnref(function(e){return n.throwIfRequested(),null!=e?e:i.getSegmentMultiPeriod(t,n,r)}))}))}),e.prototype.queryOnPeriod=freeOnUnref(function(e,s,l,f,u){var c=this;return void 0===f&&(f=!1),void 0===u&&(u=null),e.then(freeOnUnref(function(e){if(l.throwIfRequested(),null===e)return null;var t=c.selectStream(e);if(null==t)return c.log.warn("Period "+e.id+" returned no streams for "+c.streamType),null;var n=c.getStreamSelectionContexts(e),r=c.selectTimeline(t,!1,n),i=Hh.waitSegment(freeOnUnref(function(){return s(e,r)}),e,t,l,freeOnUnref(function(){return c.waitingSegmentCallback.invoke(u)}));if(!f||!c.timelineSelector.isBaseQualitySelectionSupported)return i;var o=c.selectTimeline(t,!0,n);if(o===r)return i;var a=Hh.waitSegment(freeOnUnref(function(){return s(e,o)}),e,t,l);return lt.Promise.all([i,a]).then(freeOnUnref(function(e){var t=e[0];e[1];return t}))}))}),e.prototype.selectTimeline=freeOnUnref(function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=[]),this.timelineSelector.selectTimeline(e,this.qualityLevelFilter,t,n)}),e.prototype.selectStream=freeOnUnref(function(e){var t=this.streamSelector.selectStreams(e,this.streamType);return this.streamAlternator.selectStream(t)}),e.prototype.getStreamSelectionContexts=freeOnUnref(function(e){var t=[];return"Image"!==this.streamType&&null!=this.selectionContext&&null!=this.selectionContext[e.id]&&null!=this.selectionContext[e.id][this.streamType]&&(t=this.selectionContext[e.id][this.streamType]),t}),e.prototype.updateNextSegmentQueryState=freeOnUnref(function(e,t,n,r){null!=this.nextSegmentQuery&&e.segment.index===this.nextSegmentQuery.prevIndex&&t===this.nextSegmentQuery.type&&n===this.nextSegmentQuery.etaMs&&r===this.nextSegmentQuery.reason||(this.nextSegmentQuery={etaMs:n,type:t,prevIndex:e.segment.index,prevPeriodId:e.period.id,prevStreamId:e.stream.id,reason:r,timestamp:Date.now()},this.reportState())}),e.prototype.updateNextSegmentResultState=freeOnUnref(function(e,t){if(null==this.nextSegmentResult||null==this.nextSegmentResult.segment||null==t||e.segment.index!==this.nextSegmentResult.prevIndex||t.segment.index!==this.nextSegmentResult.segment.index){var n=null;null!=t&&(n={index:t.segment.index,periodId:t.period.id,streamId:t.stream.id,position:t.contentPosition}),this.nextSegmentResult={prevIndex:e.segment.index,prevPeriodId:e.period.id,prevStreamId:e.stream.id,segment:n,timestamp:Date.now()},this.reportState()}}),e.prototype.reportState=freeOnUnref(function(){this.diagnostics.report("state",{finalSegmentProduced:this.finalSegmentProduced,nextSegmentQuery:this.nextSegmentQuery,nextSegmentResult:this.nextSegmentResult,timestamp:Date.now()})}),e})();t.PrimarySegmentInfoProducer=n}));e(zh);zh.PrimarySegmentInfoProducer;var Wh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("BlockingSegmentInfoProducer"),r=freeOnUnref(function(){function e(e,t,n){var r=this;this.onBarrierStateChanged=freeOnUnref(function(){if(null!==r.heldSegmentInfo){if(r.heldSegmentInfo.token.requested)return r.heldSegmentInfo=null,void r.reportState();var e=r.canProduce(r.heldSegmentInfo.segmentInfo);if(e.canProduce){var t=r.heldSegmentInfo;r.heldSegmentInfo=null,t.deferred.resolve(t.segmentInfo)}else r.heldSegmentInfo.reason=e.reason;r.reportState()}}),this.producer=t,this.barriers=n,this.heldSegmentInfo=null,this.diagnostics=nn.Diagnostics.create("BlockingSegmentInfoProducer."+e);for(var i=0,o=n;i<o.length;i++){o[i].onChange(this.onBarrierStateChanged)}}return e.prototype.getSegmentAt=freeOnUnref(function(e,t){return null===this.heldSegmentInfo||this.heldSegmentInfo.token.requested||(n.warn("getSegmentAt("+e+") called, but we already had a segment on hold. Discarding it and querying again!"),this.heldSegmentInfo=null,this.reportState()),this.execute(this.producer.getSegmentAt(e,t),t)}),e.prototype.getNextSegment=freeOnUnref(function(e,t){return null===this.heldSegmentInfo||this.heldSegmentInfo.token.requested||(n.warn("getNextSegment() called, but we already had a segment on hold. Discarding it and querying again!"),this.heldSegmentInfo=null,this.reportState()),this.execute(this.producer.getNextSegment(e,t),t)}),Object.defineProperty(e.prototype,"isFinalSegmentProduced",{get:freeOnUnref(function(){return this.producer.isFinalSegmentProduced}),enumerable:!0,configurable:!0}),e.prototype.execute=freeOnUnref(function(e,r){var i=this;return e.then(freeOnUnref(function(e){if(null===e)return null;var t=i.canProduce(e);if(t.canProduce)return i.heldSegmentInfo=null,i.reportState(),e;var n=new lt.Deferred;return i.heldSegmentInfo={token:r,segmentInfo:e,deferred:n,reason:t.reason},r.promise.then(freeOnUnref(function(e){return n.reject(e)})),i.reportState(),i.heldSegmentInfo.deferred.promise}))}),e.prototype.reportState=freeOnUnref(function(){null==this.heldSegmentInfo?this.diagnostics.report("state",null):this.diagnostics.report("state",{periodId:this.heldSegmentInfo.segmentInfo.period.id,stream:this.heldSegmentInfo.segmentInfo.stream.id,index:this.heldSegmentInfo.segmentInfo.segment.index,startMs:this.heldSegmentInfo.segmentInfo.contentPosition.startTimeMs,endMs:this.heldSegmentInfo.segmentInfo.contentPosition.endTimeMs,reason:this.heldSegmentInfo.reason,timestamp:Date.now()})}),e.prototype.canProduce=freeOnUnref(function(e){for(var t=0,n=this.barriers;t<n.length;t++){var r=n[t].canProduce(e);if(!r.canProduce)return r}return{canProduce:!0}}),e})();t.BlockingSegmentInfoProducer=r}));e(Wh);Wh.BlockingSegmentInfoProducer;var Kh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.log=new Ka.EphemeralJSLogger("SegmentDownloadQueue"),this.hasProduced=!1,this.pendingQueryResult=null,this.positionMs=null,this.producedSegments=[],this.productionStoppedReason=null,this.started=!1,this.timer=oe.timer,this.unclaimedCount=0,this.waitingCallbacks=[],this.onNewPeriodsAvailable=freeOnUnref(function(){i.hasProduced||null==i.positionMs?i.hasProduced&&i.queueMoreSegments():i.queueInitialSegment(i.positionMs)}),this.onSegmentProduced=freeOnUnref(function(e,t,n){i.pendingQueryResult===t?t.token.requested?i.pendingQueryResult=null:(i.addToQueue(e,n),i.pendingQueryResult=null,e.isFinalSegment?(i.productionStoppedReason="Produced final segment. Stopping production",i.log.info(i.productionStoppedReason),i.finalSegmentCallback.invoke(e)):(i.productionStoppedReason=null,i.queueMoreSegments()),i.updateState()):i.log.warn("Segment produced at "+t.contentPositionMs+"ms but we are not waiting for it")}),this.type=e,this.periodAccessor=t,this.producer=n;var o=null!=r?"."+r:"";this.diagnostics=nn.Diagnostics.create("SegmentDownloadQueue."+e+o),this.finalSegmentCallback=new A.MulticastCallback,this.shouldAllowRequeuingDoneSegments=null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.segmentDownloadQueue&&"enabled"===L.configurationStore.configuration.segmentDownloadQueue.allowRequeuingDoneSegments,this.log.setId(e)}return e.prototype.start=freeOnUnref(function(e){this.started?this.log.warn("Queue already started. Ignoring."):(this.started=!0,this.positionMs=e,this.queueInitialSegment(e),this.periodAccessor.on("newPeriodsAvailable",this.onNewPeriodsAvailable))}),e.prototype.stop=freeOnUnref(function(){null!==this.pendingQueryResult&&(this.pendingQueryResult.cancel(),this.pendingQueryResult=null),this.positionMs=null,this.periodAccessor.off("newPeriodsAvailable",this.onNewPeriodsAvailable);for(var e=0,t=this.producedSegments;e<t.length;e++){t[e].cancel()}this.producedSegments=[],this.waitingCallbacks=[],this.productionStoppedReason=null,this.started=!1,this.hasProduced=!1,this.unclaimedCount=0,this.updateState()}),e.prototype.onPosition=freeOnUnref(function(e){this.positionMs=e;for(var t=!1,n=0,r=this.producedSegments;n<r.length;n++){var i=r[n];i.downloadRequest.segment.contentPosition.endTimeMs<=e&&!i.done&&(this.log.warn(">>> Dropping download request for segment "+i.downloadRequest.segment.segment.index+" -- it ends at "+i.downloadRequest.segment.contentPosition.endTimeMs+" but initial download position is at "+e),i.claimed||(this.unclaimedCount--,t=!0),i.cancel(),i.done=!0)}this.cleanDoneSegments(),null!=this.pendingQueryResult&&this.pendingQueryResult.contentPositionMs+this.pendingQueryResult.durationMs<=e&&(this.pendingQueryResult.cancel(),this.pendingQueryResult=null),t&&this.validateUnclaimedCount("onPosition")}),e.prototype.claim=freeOnUnref(function(){var e=x.find(this.producedSegments,freeOnUnref(function(e){return!e.claimed&&!e.done}));return null==e?null:(e.claimed=!0,this.unclaimedCount--,this.validateUnclaimedCount("claim"),this.queueMoreSegments(),this.updateState(),e.downloadRequest)}),e.prototype.release=freeOnUnref(function(t){var e=x.find(this.producedSegments,freeOnUnref(function(e){return e.downloadRequest===t}));null!=e&&(e.claimed||e.done?!e.done||this.shouldAllowRequeuingDoneSegments?(e.claimed=!1,e.done=!1,this.unclaimedCount++,this.validateUnclaimedCount("release"),this.invokeCallback(),this.updateState()):this.log.error("Attempted to release segment, but it is already done!"):this.log.error("Attempted to release segment, but it is not claimed!"))}),e.prototype.done=freeOnUnref(function(t){var e=x.find(this.producedSegments,freeOnUnref(function(e){return e.downloadRequest===t}));null!=e&&(e.claimed=!1,e.done=!0,this.validateUnclaimedCount("done"),this.cleanDoneSegments(),this.updateState())}),e.prototype.wait=freeOnUnref(function(e){this.waitingCallbacks.push(e),0<this.unclaimedCount&&this.invokeCallback()}),e.prototype.getQueuedRange=freeOnUnref(function(e){void 0===e&&(e=!0);for(var t={startMs:1/0,endMs:-1/0},n=0;n<this.producedSegments.length&&this.producedSegments[n].done;)n++;if(n<this.producedSegments.length){var r=this.producedSegments[n],i=x.last(this.producedSegments);t.startMs=r.downloadRequest.segment.contentPosition.startTimeMs,t.endMs=i.downloadRequest.segment.contentPosition.endTimeMs}return e&&null!==this.pendingQueryResult&&(t.startMs=Math.min(t.startMs,this.pendingQueryResult.contentPositionMs),t.endMs=Math.max(t.endMs,this.pendingQueryResult.contentPositionMs+this.pendingQueryResult.durationMs)),isFinite(t.startMs)?t:null}),e.prototype.onFinalSegment=freeOnUnref(function(e){this.finalSegmentCallback.add(e)}),e.prototype.offFinalSegment=freeOnUnref(function(e){this.finalSegmentCallback.remove(e)}),e.prototype.addToQueue=freeOnUnref(function(e,t){var n=lt.CancelToken.source(),r=n.token,i=n.cancel,o={downloadRequest:{segment:e,token:r,previousSegment:null!=t?{periodId:t.period.id,index:t.segment.index,contentPosition:t.contentPosition}:void 0},segmentInfo:e,cancel:i,claimed:!1,done:!1};this.producedSegments.push(o),this.unclaimedCount++,this.validateUnclaimedCount("addToQueue"),this.cleanDoneSegments(),this.invokeCallback(),this.updateState()}),e.prototype.queueInitialSegment=freeOnUnref(function(n){var r=this,e=lt.CancelToken.source(),t=e.token,i=e.cancel,o={contentPositionMs:n,durationMs:1e3,token:t,cancel:i,promise:this.producer.getSegmentAt(n,t).then(freeOnUnref(function(e){if(null!=e)r.hasProduced=!0,r.onSegmentProduced(e,o);else{var t="queueInitialSegment("+n+") failed";"Image"!==r.type&&x.contains(vu.CRITICAL_STREAM_TYPES,r.type)?r.log.error(t):r.log.info(t),r.detectFinalFragment(o)}})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||r.log.error("Failed to query segment at "+n+": ",e)}))};this.pendingQueryResult=o}),e.prototype.queueMoreSegments=freeOnUnref(function(){var t=this;if(2<=this.unclaimedCount)return this.productionStoppedReason="Too many unclaimed segments ("+this.unclaimedCount+" >= 2)",void this.updateState();if(null===this.pendingQueryResult){var n=x.last(this.producedSegments);if(n.segmentInfo.isFinalSegment)return this.productionStoppedReason="Segment "+n.segmentInfo.segment.index+" of period "+n.segmentInfo.period.id+" was the final segment",void this.updateState();var e=lt.CancelToken.source(),r=e.token,i=e.cancel,o={contentPositionMs:n.segmentInfo.contentPosition.startTimeMs+n.segmentInfo.contentPosition.durationMs,durationMs:1e3,token:r,cancel:i,promise:this.producer.getNextSegment(n.segmentInfo,r).then(freeOnUnref(function(e){null==e?t.detectFinalFragment(o,n.segmentInfo):t.onSegmentProduced(e,o,n.segmentInfo)})).catch(freeOnUnref(function(e){t.productionStoppedReason="Failed to query segment after "+n.segmentInfo.segment.index+" of period "+n.segmentInfo.period.id+": "+e,e instanceof lt.CancelError||t.log.error(t.productionStoppedReason,e),t.updateState()}))};this.pendingQueryResult=o}}),e.prototype.invokeCallback=freeOnUnref(function(){var t=this;this.timer.setImmediate(freeOnUnref(function(){var e=t.waitingCallbacks.shift();null!=e&&e()}))}),e.prototype.cleanDoneSegments=freeOnUnref(function(){for(;1<this.producedSegments.length&&this.producedSegments[0].done&&(!this.shouldAllowRequeuingDoneSegments||this.isSegmentBehindPlayhead(this.producedSegments[0]));)this.producedSegments.shift();this.updateState()}),e.prototype.isSegmentBehindPlayhead=freeOnUnref(function(e){return null!=this.positionMs&&e.segmentInfo.contentPosition.endTimeMs<=this.positionMs}),e.prototype.detectFinalFragment=freeOnUnref(function(e,t){this.producer.isFinalSegmentProduced?null!=t?(this.productionStoppedReason="Didn't get a segment because final segment was already produced",this.log.info(this.productionStoppedReason),this.finalSegmentCallback.invoke(t)):(this.productionStoppedReason="Didn't get a segment because final segment was already produced, but we don't have it!",this.log.error(this.productionStoppedReason)):(this.productionStoppedReason="Did not get a segment back for a query at "+e.contentPositionMs+"ms. Not adding anything else.",this.log.warn(this.productionStoppedReason)),this.pendingQueryResult=null,this.updateState()}),e.prototype.validateUnclaimedCount=freeOnUnref(function(e){var t=this.producedSegments.reduce(freeOnUnref(function(e,t){return e+(t.claimed||t.done?0:1)}),0);t!==this.unclaimedCount&&(this.log.error("When executing a "+e+", unclaimed count got out of sync. unclaimedCount="+this.unclaimedCount+" but actual count of unclaimed and not done segments is "+t),this.unclaimedCount=t)}),e.prototype.updateState=freeOnUnref(function(){var e={queue:this.producedSegments.map(freeOnUnref(function(e){return{periodId:e.segmentInfo.period.id,streamId:e.segmentInfo.stream.id,index:e.segmentInfo.segment.index,startMs:e.segmentInfo.contentPosition.startTimeMs,endMs:e.segmentInfo.contentPosition.endTimeMs,isFinalSegment:e.segmentInfo.isFinalSegment,claimed:e.claimed,done:e.done}})),pendingQueryPosition:null!=this.pendingQueryResult?this.pendingQueryResult.contentPositionMs:null,productionStoppedReason:this.productionStoppedReason,timestamp:Date.now()};this.diagnostics.report("state",e)}),e})();t.SegmentDownloadQueue=n}));e(Kh);Kh.SegmentDownloadQueue;var Gh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.producers=[],this.onChangeCallback=new A.MulticastCallback,this.maxDistanceToSlowestSegmentMs=e}return e.prototype.segmentDownloaded=freeOnUnref(function(){this.onChangeCallback.invoke()}),e.prototype.addProducer=freeOnUnref(function(e){this.producers.push(e)}),e.prototype.canProduce=freeOnUnref(function(e){for(var t,n=1/0,r=0,i=this.producers;r<i.length;r++){var o=i[r],a=o.getQueuedRange(!0);null!==a&&(a.startMs<n&&(n=a.startMs,t=o.type))}return e.contentPosition.startTimeMs<=n+this.maxDistanceToSlowestSegmentMs?{canProduce:!0}:{canProduce:!1,reason:"Segment starting at "+e.contentPosition.startTimeMs+" is "+this.maxDistanceToSlowestSegmentMs+"ms ahead of "+t+" segment at "+n+"ms"}}),e.prototype.onChange=freeOnUnref(function(e){this.onChangeCallback.add(e)}),e.prototype.offChange=freeOnUnref(function(e){this.onChangeCallback.remove(e)}),e})();t.SlowSegmentBarrier=n}));e(Gh);Gh.SlowSegmentBarrier;var Qh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var t=this;this.minTimeoutOverrideMs=null,this.initialize=freeOnUnref(function(e){t.timeoutFactorFunction=new In.PiecewiseLinearFunction(e.scheduler.bufferFullnessSecondsToTimeoutFactorGraph)}),this.playbackSettingsProvider=e,this.initialize(e.playbackSettings),e.onUpdate(this.initialize);var n=L.configurationStore.configuration;null!=n&&null!=n.streamAcquirers&&null!=n.streamAcquirers.minTimeoutOverrideMs&&(this.minTimeoutOverrideMs=n.streamAcquirers.minTimeoutOverrideMs)}return e.prototype.calculateTimeout=freeOnUnref(function(e,t,n){var r=null===n.latencyAvgMs?0:n.latencyAvgMs,i=Math.max(e.fragment.lengthMs,r)*this.timeoutFactorFunction.evaluate(t/1e3),o=null!=this.minTimeoutOverrideMs?this.minTimeoutOverrideMs:this.playbackSettingsProvider.playbackSettings.minTimeoutMs;return Math.max(o,i)}),e})();t.BufferSizeBasedTimeoutCalculator=n}));e(Qh);Qh.BufferSizeBasedTimeoutCalculator;var Xh=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.qualityLevelFilter=e,this.playbackSettingsProvider=t}return e.prototype.getFragmentInfos=freeOnUnref(function(e){var t=e.stream,n=this.qualityLevelFilter.filter(t.qualityLevels,t),r=n.validQualities,i=e.segment,o=this.playbackSettingsProvider.playbackSettings.timeToDownloadPredictor.bitrateVariationWindow,a=[],s={maxBitrateBitsPerSec:n.maxBitrateBitsPerSec,fragmentInfos:a};if(null!=s.maxBitrateBitsPerSec){var l=x.max(r,freeOnUnref(function(e){return e.bandwidth}));null!=l&&null!=l.height&&null!=l.width&&(s.maxCappedResolution={width:l.width,height:l.height})}var f=[i],u=[];u[0]=[];for(var c=0;c<o&&null!=f[c];c++){c<o-1&&(u[c+1]=[]);for(var d=0;d<r.length;d++){var p=r[d];if(null==u[c][d]){var h=p.segmentTimeline.getEquivalentSegment(f[c]);if("Unavailable"===h.type||"RefreshMe"===h.type)continue;u[c][d]=h.segment}var m=u[c][d];if(c<o-1&&null!=m&&!m.isFinalSegment){var y=p.segmentTimeline.getNext(m);"WellKnown"!==y.type&&"Inferred"!==y.type||(u[c+1][d]=y.segment,null==f[c+1]&&(f[c+1]=y.segment))}}}for(c=0;c<f.length;c++){var g=[],v=qh.toContentRelative(e.period,f[c].position,e.stream.type);a.push({startTimeMs:v.startTimeMs,lengthMs:v.durationMs,fragmentQualities:g});for(d=0;d<r.length;d++){var O={bitrateBps:r[d].bandwidth,sizeBytes:0,valid:!1,qualityScore:null};g.push(O);var S=r[d].perceptualQuality;if(null!=S&&(O.qualityScore=S.getQualityScore(f[c].index)),null!=(m=u[c][d])){O.valid=!0;var U=od.FragmentUtilities.getSegmentSizeFromByteRange(m.byteRange);if(null!=U){O.sizeBytes=U;continue}}O.sizeBytes=r[d].bandwidth/8*v.durationMs/1e3}}return s}),e})();t.FragmentInfosCalculator=n}));e(Xh);Xh.FragmentInfosCalculator;var Yh=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(){function t(){this.pendingMediaSegments=[],this.completedMediaFragmentsWithFailure=[]}return t.prototype.trackMediaSegmentDownloadRequest=freeOnUnref(function(t,e){var n=this,r=x.find(this.pendingMediaSegments,freeOnUnref(function(e){return e.downloadRequest===t}));if(null!=r)return r.cancelCallback=e,r;var i={downloadRequest:t,qualityLevelIndex:null,maxBitrateBitsPerSec:void 0,maxCappedResolution:void 0,cancelCallback:e,attempt:0,httpErrorCount:0,timerHandle:null,isBlockedByBufferManager:!1,isLocalStorageRetrievalOver:!1,diagnosticsTracker:new od.PendingFragmentDiagnosticsTracker};return this.pendingMediaSegments.push(i),t.token.promise.then(freeOnUnref(function(){var e=n.pendingMediaSegments.indexOf(i);-1!==e&&n.pendingMediaSegments.splice(e,1),i.cancelCallback()})),i}),t.prototype.terminate=freeOnUnref(function(){for(var e=0,t=this.pendingMediaSegments;e<t.length;e++){var n=t[e];n.cancelCallback(),null!=n.timerHandle&&(oe.timer.clearTimeout(n.timerHandle),n.timerHandle=null)}this.pendingMediaSegments=[],this.completedMediaFragmentsWithFailure=[]}),t.prototype.stopTrackingSegment=freeOnUnref(function(e){var t=this.pendingMediaSegments.indexOf(e);-1!==t&&this.pendingMediaSegments.splice(t,1)}),t.prototype.isSegmentPending=freeOnUnref(function(n){return this.pendingMediaSegments.some(freeOnUnref(function(e){var t=e.downloadRequest.segment.contentPosition;return n>=t.startTimeMs&&n<t.endTimeMs}))}),t.prototype.isMediaFragmentPendingThat=freeOnUnref(function(t){return this.pendingMediaSegments.some(freeOnUnref(function(e){return t(e.downloadRequest,e.qualityLevelIndex)}))}),t.prototype.collectPendingSegmentsDiagnosticsState=freeOnUnref(function(){return{pendingMediaFragments:this.pendingMediaSegments.map(t.convertToDiagnosticsState),completedMediaFragmentsWithFailure:this.completedMediaFragmentsWithFailure}}),t.prototype.trackSegmentSuccess=freeOnUnref(function(e){0!==e.diagnosticsTracker.failureCount&&(4<=this.completedMediaFragmentsWithFailure.length&&this.completedMediaFragmentsWithFailure.shift(),this.completedMediaFragmentsWithFailure.push(t.convertToDiagnosticsState(e)))}),t.prototype.trimPendingSegments=freeOnUnref(function(t){this.pendingMediaSegments=this.pendingMediaSegments.filter(freeOnUnref(function(e){return!(e.downloadRequest.segment.contentPosition.endTimeMs<=t)||(e.cancelCallback(),!1)}))}),t.convertToDiagnosticsState=freeOnUnref(function(e){var t=e.downloadRequest.segment;return n({segment:{periodId:t.period.id,streamId:t.stream.id,index:t.segment.index,startMs:t.contentPosition.startTimeMs,endMs:t.contentPosition.endTimeMs},qualityLevelIndex:e.qualityLevelIndex,isBlockedByBufferManager:e.isBlockedByBufferManager},e.diagnosticsTracker)}),t})();t.SegmentAcquisitionRequestTracker=r}));e(Yh);Yh.SegmentAcquisitionRequestTracker;var Jh=t(freeOnUnref(function(e,t){function f(e,t,n,r,i,o){var a=t.getMetrics(),s=od.FragmentUtilities.getSegmentSizeFromByteRange(r.byteRange);return{failed:!1,diagnosticsPayload:{type:e,initFragment:r.isInitSegment,bitrateBps:i.bandwidth,status:t.getStatus(),expectedBytes:s,totalBytes:a.totalBytes,latencyMs:t.getLatencyMs(),totalMs:t.getTotalMs(),pretransferMs:a.pretransferMs,sslConnectMs:a.sslConnectMs,tcpConnectMs:a.tcpConnectMs,dnsLookupMs:a.dnsLookupMs,redirectMs:a.redirectMs},eventEmitterPayload:{type:e,initFragment:r.isInitSegment,bitrateBps:i.bandwidth,maxBitrateBitsPerSec:null==n?void 0:n.maxBitrateBitsPerSec,maxCappedResolution:null==n?void 0:n.maxCappedResolution,expectedBytes:s,url:r.sourceUrl.url,urlId:r.sourceUrl.urlId,status:t.getStatus(),totalBytes:a.totalBytes,latencyMs:t.getLatencyMs(),totalMs:t.getTotalMs(),headers:t.getHeaders(),scoreModel:null==i.perceptualQuality?void 0:i.perceptualQuality.scoreModel,qualityScore:o},resource:{body:"",headers:t.getHeaders(),timing:{latencyMs:t.getLatencyMs(),downloadMs:t.getDownloadMs(),totalMs:t.getTotalMs(),parseMs:null},status:t.getStatus(),sourceUrl:r.sourceUrl}}}Object.defineProperty(t,"__esModule",{value:!0}),t.collectSuccessfulMediaSegmentPayloads=function(e,t,n,r,i,o){var a=null==n?void 0:n.segment.segment.index,s=null==o.perceptualQuality||null==a?null:o.perceptualQuality.getQualityScore(a),l=f(e,t,r,i,o,null==s?void 0:s);return l.diagnosticsPayload.fragmentIndex=n.segment.segment.index,l.diagnosticsPayload.qualityLevelIndex=r.qualityLevelIndex,l.eventEmitterPayload.fragmentIndex=i.index,l.eventEmitterPayload.fragmentDurationMs=i.position.durationMs,l},t.collectSuccessfulSegmentPayloads=f,t.collectFailedMediaSegmentPayload=function(e,t,n,r,i,o){var a,s,l="Failed to acquire "+e+" media fragment index "+n.segment.segment.index+" for quality "+r.qualityLevelIndex+" on period "+n.segment.period.id;if(t instanceof _c.AcquisitionError){l+=" with errorType "+t.reason.type;var f="ParseError"===t.reason.type||"UnknownError"===t.reason.type?t.reason.cause:null;null!=f&&(l+=" caused by "+f);var u=od.FragmentUtilities.getSegmentSizeFromByteRange(n.segment.segment.byteRange);"UnknownError"!==t.reason.type&&null!=o&&null!=i?s={type:e,initFragment:n.segment.segment.isInitSegment,bitrateBps:o.bandwidth,maxBitrateBitsPerSec:r.maxBitrateBitsPerSec,maxCappedResolution:r.maxCappedResolution,url:i.sourceUrl.url,urlId:i.sourceUrl.urlId,status:Qe.nestedValue(t.reason,"statusCode"),latencyMs:Qe.nestedValue(t.reason,"timing.latencyMs"),totalMs:Qe.nestedValue(t.reason,"timing.totalMs"),expectedBytes:u,headers:Qe.nestedValue(t.reason,"headers"),fragmentIndex:i.index,fragmentDurationMs:i.position.durationMs,acquisitionError:t}:"UnknownError"!==t.reason.type&&(l+='\nDid not emit "fragmentDownloadFailed", selectedQualityLevel: '+o+", selectedMediaFragmentInfo: "+i),null!=o&&(a={type:e,initFragment:!1,error:t.reason.type,fragmentIndex:n.segment.segment.index,qualityLevelIndex:r.qualityLevelIndex,bitrateBps:o.bandwidth,expectedBytes:u,status:Qe.nestedValue(t.reason,"statusCode"),latencyMs:Qe.nestedValue(t.reason,"timing.latencyMs"),totalMs:Qe.nestedValue(t.reason,"timing.totalMs")})}return{failed:!0,errorMessage:l,diagnosticsPayload:a,eventEmitterPayload:s}}}));e(Jh);Jh.collectSuccessfulMediaSegmentPayloads,Jh.collectSuccessfulSegmentPayloads,Jh.collectFailedMediaSegmentPayload;var Zh=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={}).Audio=freeOnUnref(function(){}),n.TimedText=freeOnUnref(function(){}),n.Video=function(e,t){if("Video"===e.type){var n=t;null!=n.height&&null!=n.width&&(e.fragmentResolution={height:n.height,width:n.width})}},n.Image=function(e,t){if("Image"===e.type){var n=t;e.fragmentResolution={height:n.tileHeight*n.thumbnailHeight,width:n.tileWidth*n.thumbnailWidth}}},n);t.ADD_FRAGMENT_RESOLUTION_MAP=r}));e(Zh);Zh.ADD_FRAGMENT_RESOLUTION_MAP;var $h=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.fixedBitrates=e,this.configBitrateIndex=0}return e.prototype.selectBitrate=freeOnUnref(function(e,t,n){var r=e.fragment.fragmentQualities,i=this.fixedBitrates[this.configBitrateIndex];return this.configBitrateIndex=(this.configBitrateIndex+1)%this.fixedBitrates.length,this.getClosestBitrateIndex(i,r)}),e.prototype.onSeek=freeOnUnref(function(){}),e.prototype.onRebuffer=freeOnUnref(function(){}),e.prototype.onDownloadComplete=freeOnUnref(function(e,t){}),e.prototype.getClosestBitrateIndex=freeOnUnref(function(e,t){for(var n=0,r=void 0,i=0;i<t.length;i++){var o=Math.abs(e-t[i].bitrateBps);(null==r||o<r)&&(n=i,r=o)}return n}),e})();t.FixedBitrateSelector=n}));e($h);$h.FixedBitrateSelector;var em=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.stepAmount=e,this.currentIndexValue=0}return e.prototype.selectBitrate=freeOnUnref(function(e,t,n){var r=e.fragment.fragmentQualities,i=Math.floor(this.currentIndexValue);return i<0?(this.currentIndexValue=(this.currentIndexValue%r.length+r.length)%r.length,i=Math.floor(this.currentIndexValue)):i>=r.length&&(this.currentIndexValue=this.currentIndexValue%r.length,i=Math.floor(this.currentIndexValue)),this.currentIndexValue+=this.stepAmount,i}),e.prototype.onSeek=freeOnUnref(function(){}),e.prototype.onRebuffer=freeOnUnref(function(){}),e.prototype.onDownloadComplete=freeOnUnref(function(e,t){}),e})();t.SteppingBitrateSelector=n}));e(em);em.SteppingBitrateSelector;var tm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("BitrateSelectorFactory"),r=freeOnUnref(function(){function e(e){this.defaultBitrateSelectorFactory=new Nh.AggregatedBitrateSelectorFactory(e)}return e.prototype.createBitrateSelector=freeOnUnref(function(e,t){var n=L.configurationStore.configuration;if(null!=n&&null!=n.streamAcquirers&&null!=n.streamAcquirers.bitrateSelectorOverride){var r=n.streamAcquirers.bitrateSelectorOverride.Video;if("Video"===e&&null!=r){var i=this.createCustomBitrateSelector(r);if(null!=i)return i}}return this.defaultBitrateSelectorFactory.createBitrateSelector(e,t)}),e.prototype.createCustomBitrateSelector=freeOnUnref(function(e){var t=e.type;return"SteppingBitrateSelector"===e.type?new em.SteppingBitrateSelector(e.stepAmount):"FixedBitrateSelector"===e.type?new $h.FixedBitrateSelector(e.bitrates):void n.warn("Unknown custom BitrateSelector type '"+t+"'")}),e})();t.BitrateSelectorFactory=r}));e(tm);tm.BitrateSelectorFactory;var nm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("NullFallbackQualitySelector"),n=freeOnUnref(function(){function e(e){this.streamType=e}return e.prototype.selectFallbackQuality=freeOnUnref(function(e,t,n,r,i){return t.fragment.fragmentQualities.some(freeOnUnref(function(e){return e.valid}))?o.info("["+this.streamType+"] Segment "+t.index+" not available for quality index ("+e.index+"). Loading quality and deferring fragment download."):o.info("["+this.streamType+"] Segment "+t.index+" has no immediately-available/valid qualities. Deferring fragment download"),null}),e})();t.NullFallbackQualitySelector=n}));e(nm);nm.NullFallbackQualitySelector;var rm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.playbackSettingsProvider=e}return e.prototype.selectQuality=freeOnUnref(function(e,t,n){var r=this.playbackSettingsProvider.playbackSettings.dynamicBitrateCapping,i=r.dynamicBitrateCappingStrategy,o=r.targetQualityScore,a=e.index;switch(i){case"NoQualityScore":return n;case"IdealQualityScore":return this.selectQualityLevelWithIdealQualityScore(a,o,t,n);case"MaxQualityScore":return this.selectQualityLevelWithMaxQualityScore(a,o,t,n);default:return n}}),e.prototype.selectQualityLevelWithIdealQualityScore=freeOnUnref(function(e,t,n,r){for(var i=Number.POSITIVE_INFINITY,o=r,a=0,s=n.qualityLevels;a<s.length;a++){var l=s[a],f=this.getQualityScore(l,e);if(null==f)return r;var u=Math.abs(t-f);u<=i&&l.bandwidth<=r.bandwidth&&(i=u,o=l)}return o}),e.prototype.selectQualityLevelWithMaxQualityScore=freeOnUnref(function(e,t,n,r){for(var i=Number.NEGATIVE_INFINITY,o=r,a=0,s=n.qualityLevels;a<s.length;a++){var l=s[a],f=this.getQualityScore(l,e);if(null==f)return r;i<=f&&f<=t&&l.bandwidth<=r.bandwidth&&(i=f,o=l)}return o}),e.prototype.getQualityScore=freeOnUnref(function(e,t){return null==e.perceptualQuality?null:null==e.perceptualQuality.getQualityScore(t)?null:e.perceptualQuality.getQualityScore(t)}),e})();t.PerceptualQualityLimiter=n}));e(rm);rm.PerceptualQualityLimiter;var im=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("DefaultQualityLevelSelector");var n=freeOnUnref(function(){function e(e,t,n){this.streamType=e,this.bitrateSelector=t,this.perceptualQualityLimiter=new rm.PerceptualQualityLimiter(n)}return e.prototype.selectQuality=freeOnUnref(function(e,t,n,r){var i=this.bitrateSelector.selectBitrate(e,t,n),o=e.fragment.fragmentQualities[i].bitrateBps,a=x.findIndex(r.qualityLevels,freeOnUnref(function(e){return e.bandwidth===o}));if(a<0)throw new Error(this.streamType+" segment "+e.index+" non-existent bitrate is selected.");var s={index:a,qualityLevel:r.qualityLevels[a]};return this.selectPerceptualQuality(e,r,s)}),e.prototype.selectPerceptualQuality=freeOnUnref(function(e,t,n){var r=this.perceptualQualityLimiter.selectQuality(e,t,n.qualityLevel);return{index:x.findIndex(t.qualityLevels,freeOnUnref(function(e){return e===r})),qualityLevel:r}}),e})();t.DefaultQualityLevelSelector=n}));e(im);im.DefaultQualityLevelSelector;var om=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("AvailableBufferCalculator");var n=freeOnUnref(function(){function e(e,t,n,r,i){this.rawContentTimeWindow=e,this.playerBufferManager=t,this.playbackSettingsProvider=n,this.flushConsumedFragments=r,this.getSourceBufferInfo=i}return e.prototype.calculateMaxAvailableBufferDurationMs=freeOnUnref(function(e,t){var n,r=1e3*this.playbackSettingsProvider.playbackSettings.buffer.forwardBufferLengthSeconds,i=this.getMaxBitrateForCurrentFragment(t),o=8*this.playerBufferManager.getMaxAvailableBytes()/i*1e3;if(this.flushConsumedFragments){var a=this.getSourceBufferInfo();n=null==a?o:a.maxDurationMs+o}else n=o;if(null!==e){var s=Math.max(0,this.rawContentTimeWindow.endMs-e);n=Math.min(n,s)}return n=Math.min(n,r)}),e.prototype.getMaxBitrateForCurrentFragment=freeOnUnref(function(e){var t=e.fragment.fragmentQualities;return t[t.length-1].bitrateBps}),e})();t.AvailableBufferCalculator=n}));e(om);om.AvailableBufferCalculator;var am=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createRawAvailabilityWindowUtc=function(e){var t=e.timeWindow,n=null!=e.utcMsAtZero?e.utcMsAtZero:0;return{get startMs(){return t.startMs+n},get endMs(){return t.endMs+n},isUpdating:freeOnUnref(function(){return t.isUpdating()})}}}));e(am);am.createRawAvailabilityWindowUtc;var sm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.selectQuality=freeOnUnref(function(e,t){if(null==t.height||null==t.width)return null;for(var n=null,r=null,i=0;i<e.qualityLevels.length;i++){var o=e.qualityLevels[i];null!=o.height&&null!=o.width&&(this.isSameResolution(o,t)&&(null==n||o.bandwidth<=t.bandwidth)&&(n=o,r=i))}return null==n||null==r?null:{index:r,qualityLevel:n}}),e.prototype.isSameResolution=freeOnUnref(function(e,t){return e.height===t.height&&e.width===t.width}),e})();t.MatchingResolutionQualityLevelSelector=n}));e(sm);sm.MatchingResolutionQualityLevelSelector;var lm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.parseFrameRate=freeOnUnref(function(e){if(null!=e){var t=In.stringToNumber(e);return isNaN(t)?void 0:t}}),e.getMaxHeight=freeOnUnref(function(e){switch(e){case"UHD":return Number.MAX_VALUE;case"HD":return this.MAX_HD_HEIGHT;case"SD":return this.MAX_SD_HEIGHT}}),e.getMaxFrameRate=freeOnUnref(function(e){switch(e){case"HFR":return Number.MAX_VALUE;case"SFR":return this.MAX_SFR}}),e.getVideoQuality=freeOnUnref(function(e){return e>this.MAX_HD_HEIGHT?"UHD":e>this.MAX_SD_HEIGHT?"HD":"SD"}),e.getFrameRate=freeOnUnref(function(e){return e>this.MAX_SFR?"HFR":"SFR"}),e.MAX_HD_HEIGHT=1080,e.MAX_SD_HEIGHT=480,e.MAX_SFR=30,e})();t.RendererCapabilitiesUtils=n}));e(lm);lm.RendererCapabilitiesUtils;var fm=t(freeOnUnref(function(e,t){var M=ce&&ce.__assign||freeOnUnref(function(){return(M=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var d=_c,_=de.get("StreamAcquirer"),R=new In.StepFunction([[0,50],[3,500],[6,4e3]]),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v){var O=this;this.fragmentDownloadHistory=new Nh.FragmentHistory,this.initFragmentRequestCancelCallbacks={},this.networkRequestManager=_c.getInstance(),this.positionMs=null,this.finalSegmentCallback=freeOnUnref(function(e){O.fragmentBuffer.setFinalSegment(e.period.id,e.segment.index),O.downloadQueue.offFinalSegment(O.finalSegmentCallback)}),this.reportStateChange=freeOnUnref(function(){var e=O.initFragmentAcquirer.getDiagnostics();O.diagnostics.report("state",M({},O.pendingSegmentTracker.collectPendingSegmentsDiagnosticsState(),e,{timestamp:Date.now()}))}),this.type=e,this.contentSource=t,this.downloadQueue=n,this.fragmentBuffer=r,this.fragmentContentSourceEventEmitter=i,this.localSegmentLoader=u,this.playerBufferManager=a,this.resourceAcquisitionMonitor=s,this.blockedSegmentTracker=f,this.mediaRepresentation=c,this.getFrontBufferDurationMs=d,this.preventHevcShortFragmentResolutionChanges=m,this.segmentQualityLevelTracker=g,this.downloadOperationId=v,this.diagnostics=nn.Diagnostics.create("StreamAcquirer."+e),this.fragmentRequestFactory=new od.FragmentRequestFactory,this.initFragmentAcquirer=new od.InitFragmentAcquirer(this.reportStateChange,4),this.prioritizationSystem=o;var S=L.configurationStore.configuration,U=null!=S&&null!=S.streamAcquirers?S.streamAcquirers:null;this.maxConcurrentRequests=null==U?3:Qe.withDefault(U.maxConcurrentRequests,3);var b=new tm.BitrateSelectorFactory(y);this.addFragmentResolution=Zh.ADD_FRAGMENT_RESOLUTION_MAP[this.type],this.bitrateSelector=b.createBitrateSelector(e,this.fragmentDownloadHistory),this.qualitySelector=new im.DefaultQualityLevelSelector(this.type,this.bitrateSelector,y),this.fallbackQualitySelector=new nm.NullFallbackQualitySelector(this.type),this.downloadQueue.onFinalSegment(this.finalSegmentCallback),this.fragmentInfosCalculator=new Xh.FragmentInfosCalculator(l,y),this.fragmentProcessor=new od.IsoBmffFragmentProcessor,this.pendingSegmentTracker=new Yh.SegmentAcquisitionRequestTracker,this.timeoutCalculator=new Qh.BufferSizeBasedTimeoutCalculator(y);var P=am.createRawAvailabilityWindowUtc(c);this.availableBufferCalculator=new om.AvailableBufferCalculator(P,a,y,h,p),this.matchingResolutionQualityLevelSelector=new sm.MatchingResolutionQualityLevelSelector}return e.prototype.start=freeOnUnref(function(e){_.info(">> start("+this.type+", "+e+")"),this.positionMs=e;for(var t=0;t<this.maxConcurrentRequests;t++)this.waitSegment()}),e.prototype.stop=freeOnUnref(function(){_.info(">> stop("+this.type+")");for(var e=0,t=Object.keys(this.initFragmentRequestCancelCallbacks);e<t.length;e++){var n=t[e];this.initFragmentRequestCancelCallbacks[n]()}this.initFragmentRequestCancelCallbacks={},this.initFragmentAcquirer.stop(),this.pendingSegmentTracker.terminate(),this.blockedSegmentTracker.removeAllBlockedSegments(this.type),this.reportStateChange()}),e.prototype.onPosition=freeOnUnref(function(e){if(this.positionMs=e,this.missingSegmentAheadOfPosition(e))return this.downloadQueue.stop(),this.downloadQueue.start(e),void this.start(e);this.downloadQueue.onPosition(e)}),e.prototype.missingSegmentAheadOfPosition=freeOnUnref(function(e){if(!x.contains(vu.CRITICAL_STREAM_TYPES,this.type))return!1;var t=this.downloadQueue.getQueuedRange(!0);if(null==t)return!1;var n=this.fragmentBuffer.getBufferedRanges(),r=n.find(e);if(null==r){var i=n.getIntervals();return!(0<i.length&&i[0].start>e-1)&&e<t.startMs-150}return r.end<t.startMs-150}),e.prototype.onRebuffer=freeOnUnref(function(){this.bitrateSelector.onRebuffer()}),e.prototype.onSeek=freeOnUnref(function(){this.bitrateSelector.onSeek()}),e.prototype.isFragmentPending=freeOnUnref(function(e){return this.pendingSegmentTracker.isSegmentPending(e)}),e.prototype.isMediaFragmentPendingThat=freeOnUnref(function(e){return this.pendingSegmentTracker.isMediaFragmentPendingThat(e)}),e.prototype.isInitFragmentPendingThat=freeOnUnref(function(e){return this.initFragmentAcquirer.isInitFragmentPendingThat(e)}),e.prototype.registerMediaFragmentRequest=freeOnUnref(function(m,p){var y=this;if(null!=this.fragmentBuffer.getMediaFragment(m.segment.period.id,m.segment.segment.index))return _.info("Ignoring attempt to download already-downloaded media "+this.type+" fragment "+m.segment.segment.index+" on period "+m.segment.period.id),this.downloadQueue.done(m),void this.waitSegment();var g,v,h,O,S,U=this.type+"|"+m.segment.period.id+"|"+m.segment.stream.id+"|"+m.segment.segment.index,e=lt.CancelToken.source(),b=e.token,P=e.cancel,M=this.pendingSegmentTracker.trackMediaSegmentDownloadRequest(m,P),C=M.diagnosticsTracker,E=m.segment.contentPosition.startTimeMs,T={index:m.segment.segment.index,periodId:m.segment.period.id,contentPosition:m.segment.contentPosition},w={fulfilled:!1},I=this.getPriorityFunction(b,m);C.queued(I()),this.reportStateChange();var k={assetType:"mediaFragment."+this.type,getRequestBuilder:freeOnUnref(function(e){if(b.requested)return null;var t=y.fragmentInfosCalculator.getFragmentInfos(m.segment),n={index:m.segment.segment.index,attempt:M.attempt,requestType:"Normal",fragment:t.fragmentInfos[0],futureFragments:t.fragmentInfos.slice(1)};S=y.availableBufferCalculator.calculateMaxAvailableBufferDurationMs(y.positionMs,n);var r,i={currentDurationMs:y.getBufferDurationMs(),maxAvailableDurationMs:S},o=m.segment.stream;r=null!=h?h:y.qualitySelector.selectQuality(n,i,e,o),v=r.qualityLevel,M.qualityLevelIndex=r.index,M.maxBitrateBitsPerSec=t.maxBitrateBitsPerSec,M.maxCappedResolution=t.maxCappedResolution;var a=y.calculateTimeout(n,i.currentDurationMs,e);k.description=U+"|"+v.id;var s=v.segmentTimeline.getEquivalentSegment(m.segment.segment);if("RefreshMe"===s.type){var l=s.load();return null!=y.fallbackQualitySelector.selectFallbackQuality(r,n,i,e,o)&&_.warn("(legacy) Fallback quality handling not implemented. Ignoring"),l.then(freeOnUnref(function(){b.requested||y.registerMediaFragmentRequest(m,p)})),null}if("Unavailable"===s.type)throw new Error("Someone pulled the rug from us: "+y.type+" segment "+n.index+" is Unavailable on quality "+v.id+": "+s.reason);g=s.segment,y.shouldRegisterInitFragmentRequest(m.segment.period,m.segment.stream,v)&&y.registerInitFragmentRequest(m.segment.period,m.segment.stream,v,E,0,p);var f=od.FragmentUtilities.getSegmentSizeBytes(v,g);if(0===f)return _.error("Received zero sizeBytes"),null;var u={type:"Fragment",position:m.segment.contentPosition},c={sizeBytes:f,position:m.segment.contentPosition.startTimeMs,getPriority:I,priorityComparable:y.prioritizationSystem.getPriorityComparable(y.contentSource,u),flush:y.getFlushFunction(m,P),onRetry:{retry:y.getRetryFunction(m,b,P,p),cancelToken:b},contentId:y.downloadOperationId};if(w=y.playerBufferManager.reserve(c),O=m.segment.period.id+"_"+m.segment.segment.index,!w.fulfilled){M.isBlockedByBufferManager=!0;var d=m.segment.contentPosition.startTimeMs;return y.blockedSegmentTracker.addBlockedSegment(y.type,O,d),y.reportStateChange(),null}return M.isBlockedByBufferManager=!1,y.blockedSegmentTracker.removeBlockedSegment(y.type,O),y.fragmentDownloadHistory.addEvent({index:m.segment.segment.index,bitrateBps:v.bandwidth,selectedBitrateIndex:M.qualityLevelIndex,fragmentRequestType:n.requestType}),k.getApproximateResponseSizeBytes=freeOnUnref(function(){return f}),C.requestStarted(I(),a),y.reportStateChange(),y.fragmentRequestFactory.createMediaFragmentRequestBuilder(g,a,void 0,p)}),getPriority:I,onCancelled:freeOnUnref(function(e){}),description:U};(M.isLocalStorageRetrievalOver?lt.Promise.resolve(yh.FAILED_LOAD_CONTEXT):this.localSegmentLoader.retrieveLocalMediaSegment(m,b)).then(freeOnUnref(function(e){if(b.throwIfRequested(),e.isLoaded&&null!=e.qualityLevel){var t=m.segment.period,n=m.segment.stream,r=e.qualityLevel;return y.shouldRegisterInitFragmentRequest(t,n,r)&&y.registerInitFragmentRequest(t,n,r,m.segment.contentPosition.startTimeMs,0,p),y.pendingSegmentTracker.stopTrackingSegment(M),y.reportStateChange(),y.downloadQueue.done(m),y.waitSegment(),null}return M.isLocalStorageRetrievalOver=!0,y.reportStateChange(),null!=y.segmentQualityLevelTracker&&y.segmentQualityLevelTracker.trackSegment(T,m.token),y.getQualityLevelOverride(m).then(freeOnUnref(function(e){return h=e,y.networkRequestManager.requestDownload(k,b)}))})).then(freeOnUnref(function(e){if(b.throwIfRequested(),null!=e){if(_.enabledFor(de.DEBUG)){var t=new Date,n={type:y.type,startTime:new Date(t.getTime()-e.getTotalMs()).toISOString(),loadTime:new Date(t.getTime()-e.getLatencyMs()).toISOString(),endTime:t.toISOString(),latencyMs:e.getLatencyMs(),index:m.segment.segment.index,durationMs:g.position.durationMs,sizeBytes:od.FragmentUtilities.getSegmentSizeBytes(v,g),bitrate:v.bandwidth,url:g.sourceUrl.url};_.info(JSON.stringify(n))}if(w.fulfilled)if(null!=g&&null!=v)if(null!=S){var r=Jh.collectSuccessfulMediaSegmentPayloads(y.type,e,m,M,g,v);y.onRequestSucceed(r.resource);var i=r.eventEmitterPayload;y.addFragmentResolution(i,v),y.fragmentContentSourceEventEmitter.emit("fragmentDownloaded",i);var o={currentDurationMs:y.getBufferDurationMs(),maxAvailableDurationMs:S},a=e.getMetrics(),s={fragmentIndex:g.index,sizeBytes:a.totalBytes,fragmentDurationMs:g.position.durationMs,elapsedDurationMs:e.getTotalMs()};y.bitrateSelector.onDownloadComplete(o,s),y.diagnostics.report("fragmentDownloaded",r.diagnosticsPayload);var l=e.getArrayBuffer();y.fragmentProcessor.process(l,g);var f=w.onFreed,u=freeOnUnref(function(){f(),null!=e.releaseResponse&&e.releaseResponse()}),c={isInitSegment:!1,type:y.type,index:g.index,isFinalSegment:m.segment.isFinalSegment,periodId:m.segment.period.id,streamId:m.segment.stream.id,qualityLevelId:v.id,bitrateBps:v.bandwidth,position:m.segment.contentPosition,data:l,onFreed:u};if("Video"===y.type){var d=c,p=v;d.width=p.width,d.height=p.height}y.fragmentBuffer.addMediaFragment(c),null!=y.segmentQualityLevelTracker&&y.segmentQualityLevelTracker.addSegmentQualityLevel(T,v),null!=m.previousSegment&&m.previousSegment.periodId!==m.segment.period.id&&y.fragmentBuffer.linkSegment(m.previousSegment.periodId,m.previousSegment.index,m.segment.period.id,g.index),y.pendingSegmentTracker.stopTrackingSegment(M),y.pendingSegmentTracker.trackSegmentSuccess(M),y.reportStateChange();var h=e.getLatencyMs();e.getTotalMs();y.downloadQueue.done(m),y.waitSegment()}else _.error("maxAvailableBufferDurationMs should have been set at this point.");else _.error("selectedMediaFragmentInfo is "+g+" and selectedQualityLevel is "+v+", HttpResponse.status: "+e.getStatus());else _.error("reservationResponse should have been fulfilled at this point.")}})).catch(freeOnUnref(function(e){if(w.fulfilled&&w.onFreed(),null!=O&&y.blockedSegmentTracker.removeBlockedSegment(y.type,O),e instanceof lt.CancelError)return b.requested||y.downloadQueue.release(m),void y.waitSegment();if(e instanceof d.AcquisitionError&&null!=g&&y.onRequestFailed(e,g.sourceUrl),e instanceof d.AccessTokenExpired){if(null!=e.refreshPromise)return _.warn("Auth Token is invalid for segment "+m.segment.segment.index+", will retry after the refresh Promise is resolved."),void e.refreshPromise.then(freeOnUnref(function(e){b.requested||y.registerMediaFragmentRequest(m,e)}));_.warn("Auth Token is invalid for segment "+m.segment.segment.index+" and there is no refresh promise. Segment will retry as usually.")}var t=Jh.collectFailedMediaSegmentPayload(y.type,e,m,M,g,v);null!=t.eventEmitterPayload&&null!=v&&(y.addFragmentResolution(t.eventEmitterPayload,v),y.fragmentContentSourceEventEmitter.emit("fragmentDownloadFailed",t.eventEmitterPayload)),null!=t.diagnosticsPayload&&y.diagnostics.report("fragmentDownloadFailed",t.diagnosticsPayload);var n=t.errorMessage;_.error(n,e),C.failed(n),y.reportStateChange();var r=R.evaluate(M.attempt);M.attempt++,M.timerHandle=oe.timer.setTimeout(freeOnUnref(function(){M.timerHandle=null,b.requested||y.registerMediaFragmentRequest(m)}),r)}))}),e.prototype.getFlushFunction=freeOnUnref(function(e,t){var n=this;return freeOnUnref(function(){return t(),n.downloadQueue.release(e),n.fragmentBuffer.flushFragment(e.segment.period.id,e.segment.segment.index)})}),e.prototype.getPriorityFunction=freeOnUnref(function(e,t){var n=this;return freeOnUnref(function(){return e.requested?1/0:n.prioritizationSystem.getPriority(n.contentSource,t.segment.contentPosition)})}),e.prototype.getRetryFunction=freeOnUnref(function(t,n,r,i){var o=this;return freeOnUnref(function(e){e?n.requested||(r(),o.downloadQueue.release(t)):o.registerMediaFragmentRequest(t,i)})}),e.prototype.shouldRegisterInitFragmentRequest=freeOnUnref(function(e,t,n){return!this.fragmentBuffer.containsInitFragment(e.id,n.id)&&null==this.initFragmentRequestCancelCallbacks[this.createInitFragmentId(e,n)]&&"Unavailable"!==n.segmentTimeline.getInitSegment().type}),e.prototype.registerInitFragmentRequest=freeOnUnref(function(a,s,l,r,i,t){var f=this,u=this.createInitFragmentId(a,l),n=freeOnUnref(function(){return Math.max(r-f.positionMs,0)}),e=lt.CancelToken.source(),c=e.token,o=e.cancel;this.initFragmentRequestCancelCallbacks[u]=o,oe.timer.setImmediate(freeOnUnref(function(){c.requested||f.initFragmentAcquirer.getInitSegmentInfo(f.type,c,a,l).then(freeOnUnref(function(o){if(c.throwIfRequested(),null!=o)return(0===i?f.localSegmentLoader.retrieveLocalInitSegment(a,s,l,o,c):lt.Promise.resolve(!1)).then(freeOnUnref(function(e){return e?null:f.initFragmentAcquirer.downloadInitFragment(f.type,c,o,a,s,l,n,t)})).then(freeOnUnref(function(e){if(null!=e){if(_.enabledFor(de.DEBUG)){var t=new Date,n={type:f.type+": INIT",startTime:new Date(t.getTime()-e.getTotalMs()).toISOString(),loadTime:new Date(t.getTime()-e.getLatencyMs()).toISOString(),endTime:t.toISOString(),latencyMs:e.getLatencyMs(),index:"INIT",sizeBytes:e.getArrayBuffer().byteLength,bitrate:l.bandwidth,url:e.getResponseUrl()};_.info(JSON.stringify(n))}var r=Jh.collectSuccessfulSegmentPayloads(f.type,e,void 0,o.segment,l);f.onRequestSucceed(r.resource);var i=freeOnUnref(function(){null!=e.releaseResponse&&e.releaseResponse()});f.fragmentBuffer.addInitFragment({isInitSegment:!0,type:f.type,periodId:a.id,streamId:s.id,qualityLevelId:l.id,bitrateBps:l.bandwidth,data:e.getArrayBuffer(),onFreed:i}),f.fragmentContentSourceEventEmitter.emit("fragmentDownloaded",r.eventEmitterPayload),f.diagnostics.report("fragmentDownloaded",r.diagnosticsPayload),delete f.initFragmentRequestCancelCallbacks[u],f.reportStateChange()}})).catch(freeOnUnref(function(e){if(e instanceof d.AcquisitionError){f.onRequestFailed(e,o.segment.sourceUrl);var t=od.FragmentUtilities.getSegmentSizeFromByteRange(o.segment.byteRange);f.fragmentContentSourceEventEmitter.emit("fragmentDownloadFailed",{type:f.type,initFragment:!0,bitrateBps:l.bandwidth,maxBitrateBitsPerSec:void 0,maxCappedResolution:void 0,url:o.segment.sourceUrl.url,urlId:o.segment.sourceUrl.urlId,status:Qe.nestedValue(e.reason,"statusCode"),latencyMs:Qe.nestedValue(e.reason,"timing.latencyMs"),totalMs:Qe.nestedValue(e.reason,"timing.totalMs"),headers:Qe.nestedValue(e.reason,"headers"),expectedBytes:t,acquisitionError:e}),f.diagnostics.report("fragmentDownloadFailed",{type:f.type,initFragment:!0,expectedBytes:t,error:e.reason.type,status:Qe.nestedValue(e.reason,"statusCode"),latencyMs:Qe.nestedValue(e.reason,"timing.latencyMs"),totalMs:Qe.nestedValue(e.reason,"timing.totalMs")})}if(e instanceof d.AccessTokenExpired){if(null!=e.refreshPromise)return _.warn("Auth Token is invalid for segment on period "+a.id+", will retry after the refresh Promise is resolved."),void e.refreshPromise.then(freeOnUnref(function(e){c.requested||f.registerInitFragmentRequest(a,s,l,r,i,e)}));_.warn("Auth Token is invalid for segment on period "+a.id+" and there is no refresh promise. Segment will retry as usually.")}var n=R.evaluate(i);oe.timer.setTimeout(freeOnUnref(function(){c.requested||f.registerInitFragmentRequest(a,s,l,r,i+1)}),n)}))}))}))}),e.prototype.onRequestSucceed=freeOnUnref(function(e){this.resourceAcquisitionMonitor.resourceAcquired(e)}),e.prototype.onRequestFailed=freeOnUnref(function(e,t){"UnknownError"!==e.reason.type&&this.resourceAcquisitionMonitor.resourceAcquisitionFailed(e.reason,Ac.AcquisitionResourceType.Fragment,t.url,t.urlId)}),e.prototype.calculateTimeout=freeOnUnref(function(e,t,n){return this.timeoutCalculator.calculateTimeout(e,t,n)}),e.prototype.getBufferDurationMs=freeOnUnref(function(){var e=this.getFrontBufferDurationMs();return null==e?0:e}),e.prototype.waitSegment=freeOnUnref(function(){var e=this,t=this.downloadQueue.claim();null!==t?oe.timer.setTimeout(freeOnUnref(function(){e.registerMediaFragmentRequest(t)}),0):this.downloadQueue.wait(freeOnUnref(function(){return e.waitSegment()}))}),e.prototype.getQualityLevelOverride=freeOnUnref(function(t){var n=this;return this.preventHevcShortFragmentResolutionChanges&&null!=this.segmentQualityLevelTracker&&null!=t.previousSegment&&this.isShortHevcSegment(t.segment)?this.segmentQualityLevelTracker.getSegmentQualityLevel(t.previousSegment).then(freeOnUnref(function(e){return null==e?null:n.matchingResolutionQualityLevelSelector.selectQuality(t.segment.stream,e)})).catch(freeOnUnref(function(){return null})):lt.Promise.resolve(null)}),e.prototype.isShortHevcSegment=freeOnUnref(function(e){if(0===e.stream.qualityLevels.length||"Video"!==e.stream.type)return!1;var t=e.stream.qualityLevels[0];if(null==t.frameRate)return!1;var n=ci.CodecParser.parseVideoCodec(t.codecs,!1),r=lm.RendererCapabilitiesUtils.parseFrameRate(t.frameRate);return null!=n&&"HEVC"===n.codec&&null!=r&&r*(e.contentPosition.durationMs/1e3)<=30}),e.prototype.createInitFragmentId=freeOnUnref(function(e,t){return e.id+"_"+t.id}),e})();t.StreamAcquirer=n}));e(fm);fm.StreamAcquirer;var um=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("CompositeFilter"),r=freeOnUnref(function(){function e(){this.filters=[]}return e.prototype.addFilter=freeOnUnref(function(e){this.filters.push(e)}),e.prototype.removeFilter=freeOnUnref(function(t){this.filters=this.filters.filter(freeOnUnref(function(e){return e!==t}))}),e.prototype.filter=freeOnUnref(function(e,o){var t={validQualities:e};return 0===(t=this.filters.reduce(freeOnUnref(function(e,t){var n=t.filter(e.validQualities,o),r=e.maxBitrateBitsPerSec;(null==r||null!=n.maxBitrateBitsPerSec&&n.maxBitrateBitsPerSec<r)&&(r=n.maxBitrateBitsPerSec);var i={validQualities:n.validQualities};return null!=r&&(i.maxBitrateBitsPerSec=r),i}),t)).validQualities.length&&(n.warn("Quality levels filtered to empty, falling back to first quality level"),t={validQualities:[e[0]],maxBitrateBitsPerSec:e[0].bandwidth}),t}),e.prototype.isValidQuality=freeOnUnref(function(t,n){return this.filters.every(freeOnUnref(function(e){return e.isValidQuality(t,n)}))}),e})();t.CompositeFilter=r}));e(um);um.CompositeFilter;var cm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("PeriodValidator"),r=freeOnUnref(function(){function e(){this.invalidPeriodsTimestamp={}}return e.prototype.validateTailorablePeriod=freeOnUnref(function(e){if(!e.streams.some(freeOnUnref(function(e){return"Video"===e.type})))throw new ct.XpError("content_src.manifest.parse",void 0,"New MediaRepresentation has period "+e.id+" not containing Video streams",!0)}),e.prototype.validateTailoredPeriod=freeOnUnref(function(e){if(!e.skipped){for(var n=e.streams,r=null,t=freeOnUnref(function(t){if(!n.some(freeOnUnref(function(e){return e.type===t})))return r=t,"break"}),i=0,o=vu.CRITICAL_STREAM_TYPES;i<o.length;i++){if("break"===t(o[i]))break}if(this.updateValidatorState(e,r),null!==r)throw new ct.XpError("content_src.manifest.parse",void 0,"New MediaRepresentation has period "+e.id+" not containing "+r+" streams",!0)}}),e.prototype.stopTrackingPeriod=freeOnUnref(function(e){null!=this.invalidPeriodsTimestamp[e.id]&&delete this.invalidPeriodsTimestamp[e.id]}),e.prototype.updateValidatorState=freeOnUnref(function(e,t){null===t?null!=this.invalidPeriodsTimestamp[e.id]&&n.warn("Period@id="+e.id+" was identified as invalid "+(Date.now()-this.invalidPeriodsTimestamp[e.id])+" ms ago."):(null==this.invalidPeriodsTimestamp[e.id]&&n.error("Invalid period ("+e.id+"), critical stream "+t+" missing."),this.invalidPeriodsTimestamp[e.id]=Date.now())}),e})();t.PeriodValidator=r}));e(cm);cm.PeriodValidator;var dm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("SegmentTimelineHelper"),n=freeOnUnref(function(){function e(e,t){this.baseQualitySegmentTimelineSelector=new vh.BaseQualitySegmentTimelineSelector,this.initialQualitySelector=new Vh.InitialQualitySelector,this.offlineSegmentTimelineSelector=new jh.OfflineSegmentTimelineSelector,this.qualityLevelFilters=t,this.streamSelector=e,this.selectionContext=null}return e.prototype.setSelectionContext=freeOnUnref(function(e){null!=this.selectionContext&&null==e&&a.warn("Explicitly resetting selection context"),this.selectionContext=e}),e.prototype.getFirstSegment=freeOnUnref(function(a,s){var l=this;return lt.Promise.resolve().then(freeOnUnref(function(){var e=[l.selectTimeline(a,s,!1,l.selectionContext)],t=lt.CancelToken.source(),n=t.token,r=(t.cancel,Math.max(a.shiftMs,0));if(null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.streamAcquirers&&null!=L.configurationStore.configuration.streamAcquirers.initialQuality&&!0===L.configurationStore.configuration.streamAcquirers.initialQuality.downloadBaseQualityIndex){var i=l.selectTimeline(a,s,!0,l.selectionContext);e[0]!==i&&e.push(i)}var o=e.map(freeOnUnref(function(t){var e=freeOnUnref(function(){return t.getSegmentAt(r,150)});return l.waitSegment(e,n).then(freeOnUnref(function(e){return{segmentInfo:e,timeline:t}}))}));return lt.Promise.all(o)})).then(freeOnUnref(function(e){return e[0]}))}),e.prototype.getLastSegment=freeOnUnref(function(n,r,i){var o=this;return lt.Promise.resolve().then(freeOnUnref(function(){var t=o.selectTimeline(n,i,!1,o.selectionContext),e=t.getSegmentAt(Math.max(0,r-n.originalStartMs-100,0));if("Unavailable"===e.type)throw new Error("Last segment for period is not available!");return"RefreshMe"===e.type?e.load().then(freeOnUnref(function(e){if("Unavailable"===e.type)throw new Error("Segment is still not available after a refresh!");return o.iterateToFinalSegment(t,e.segment)})):o.iterateToFinalSegment(t,e.segment)}))}),e.prototype.selectTimeline=freeOnUnref(function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=null);var i=this.streamSelector.selectStreams(e,t);if(x.isEmpty(i))throw new Error("Period "+e.id+" returned no "+t+" streams");var o=i[0];if(null!=r&&null!=r[e.id]&&null!=r[e.id][t]&&0<r[e.id][t].length)try{return this.offlineSegmentTimelineSelector.selectTimeline(o,this.qualityLevelFilters[t],r[e.id][t])}catch(e){a.error("Offline segment timeline selection failed. Fallback to online timeline. Error:",e)}return(n?this.baseQualitySegmentTimelineSelector:this.initialQualitySelector).selectTimeline(o,this.qualityLevelFilters[t])}),e.prototype.iterateToFinalSegment=freeOnUnref(function(t,e){var n=this;if(e.isFinalSegment)return lt.Promise.resolve(e);var r=t.getNext(e);return"Unavailable"===r.type?lt.Promise.reject("Last segment for period is not available!"):"RefreshMe"===r.type?r.load().then(freeOnUnref(function(e){if("Unavailable"===e.type)throw new Error("Segment is still not available after a refresh!");return n.iterateToFinalSegment(t,e.segment)})):this.iterateToFinalSegment(t,r.segment)}),e.prototype.waitSegment=freeOnUnref(function(t,n){var r=this,e=t();return("RefreshMe"===e.type?e.load():lt.Promise.resolve(e)).then(freeOnUnref(function(e){if(n.throwIfRequested(),"Unavailable"===e.type){if(null==e.etaMs)throw new Error("Segment unavailable without ETA. Reason: "+e.reason);return r.delay(e.etaMs,n).then(freeOnUnref(function(){return n.throwIfRequested(),r.waitSegment(t,n)}))}return e.segment}))}),e.prototype.delay=freeOnUnref(function(r,i){return new lt.Promise(freeOnUnref(function(e,t){var n=oe.timer.setTimeout(e,r);i.promise.then(freeOnUnref(function(e){oe.timer.clearTimeout(n),t(e)}))}))}),e})();t.SegmentTimelineHelper=n}));e(dm);dm.SegmentTimelineHelper;var pm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.segmentTimeline=e,this.isInitSegment=!1,this.segmentInfo=n,this.index=n.index,this.isFinalSegment=n.isFinalSegment,this.byteRange=n.byteRange,this.offsetMs=t,this.rawData=n.rawData}return Object.defineProperty(e.prototype,"position",{get:freeOnUnref(function(){return null==this.computedPosition&&(this.computedPosition={startTimeMs:this.segmentInfo.position.startTimeMs+this.offsetMs,endTimeMs:this.segmentInfo.position.endTimeMs+this.offsetMs,durationMs:this.segmentInfo.position.durationMs}),this.computedPosition}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceUrl",{get:freeOnUnref(function(){return this.segmentInfo.sourceUrl}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyId",{get:freeOnUnref(function(){return this.segmentInfo.keyId}),enumerable:!0,configurable:!0}),e})();t.TailoredMediaSegmentInfo=n}));e(pm);pm.TailoredMediaSegmentInfo;var hm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("TailoredSegmentTimeline");var n=freeOnUnref(function(){function e(e,t,n){this.period=t,this.segmentTimeline=e,this.offsetMs=null,this.usePeriodWideOffset=n}return e.prototype.resetTailoring=freeOnUnref(function(){this.offsetMs=null}),e.prototype.offset=freeOnUnref(function(e){this.offsetMs=e}),e.prototype.getInternalOffsetMs=freeOnUnref(function(){return this.usePeriodWideOffset?this.period.offsetMs:this.offsetMs}),Object.defineProperty(e.prototype,"presentationTimeOffsetMs",{get:freeOnUnref(function(){var e=this.getInternalOffsetMs();return this.segmentTimeline.presentationTimeOffsetMs-(null!=e?e:0)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentDurationMs",{get:freeOnUnref(function(){return this.segmentTimeline.segmentDurationMs}),enumerable:!0,configurable:!0}),e.prototype.getInitSegment=freeOnUnref(function(){return this.segmentTimeline.getInitSegment()}),e.prototype.getNext=freeOnUnref(function(e){var t=e;return this.offsetSegment(this.segmentTimeline.getNext(t.segmentInfo),null)}),e.prototype.getSequenceFromPosition=freeOnUnref(function(e){return null}),e.prototype.getSequenceRange=freeOnUnref(function(){return null}),e.prototype.getSegmentFromSequence=freeOnUnref(function(e){return null}),e.prototype.getSegmentAt=freeOnUnref(function(e,t){var n=this,r=this.getInternalOffsetMs();if(null!=r||null==this.period.latestTailoredTimeline){var i=null!=r?r:0;return this.offsetSegment(this.segmentTimeline.getSegmentAt(Math.min(Math.max(e-i,0),this.period.originalDurationMs),t),null)}var o=this.period.latestTailoredTimeline.getSegmentAt(e,t);return"Unavailable"===o.type?o:"RefreshMe"!==o.type?this.getEquivalentSegment(o.segment):{type:"RefreshMe",load:freeOnUnref(function(){return o.load().then(freeOnUnref(function(e){if("Unavailable"===e.type)return e;var t=n.getEquivalentSegment(e.segment);return"RefreshMe"===t.type?t.load():t}))})}}),e.prototype.getEquivalentSegment=freeOnUnref(function(e){var t=e;return this.offsetSegment(this.segmentTimeline.getEquivalentSegment(t.segmentInfo),t)}),e.prototype.offsetSegment=freeOnUnref(function(e,t){switch(e.type){case"Unavailable":return e;case"Inferred":case"WellKnown":return null!=this.offsetMs||null==t||this.usePeriodWideOffset||(this.offsetMs=t.position.startTimeMs-e.segment.position.startTimeMs,this.period.latestTailoredTimeline=this),{type:e.type,segment:new pm.TailoredMediaSegmentInfo(this.segmentTimeline,this.usePeriodWideOffset?this.period.offsetMs:this.offsetMs,e.segment)};case"RefreshMe":return this.wrapRefreshMeSegment(e,t)}}),e.prototype.wrapRefreshMeSegment=freeOnUnref(function(e,t){var n=this;return{type:"RefreshMe",load:freeOnUnref(function(){return e.load().then(freeOnUnref(function(e){return n.offsetSegment(e,t)}))})}}),e})();t.TailoredSegmentTimeline=n}));e(hm);hm.TailoredSegmentTimeline;var mm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.qualityLevel=e,this.timeline=new hm.TailoredSegmentTimeline(this.qualityLevel.segmentTimeline,t,n)}return e.prototype.resetTailoring=freeOnUnref(function(){this.timeline.resetTailoring()}),Object.defineProperty(e.prototype,"bandwidth",{get:freeOnUnref(function(){return this.qualityLevel.bandwidth}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"codecPrivateData",{get:freeOnUnref(function(){return this.qualityLevel.codecPrivateData}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"codecs",{get:freeOnUnref(function(){return this.qualityLevel.codecs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:freeOnUnref(function(){return this.qualityLevel.id}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentTimeline",{get:freeOnUnref(function(){return this.timeline}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"samplingRate",{get:freeOnUnref(function(){return this.qualityLevel.samplingRate}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameRate",{get:freeOnUnref(function(){return this.qualityLevel.frameRate}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:freeOnUnref(function(){return this.qualityLevel.height}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:freeOnUnref(function(){return this.qualityLevel.width}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perceptualQuality",{get:freeOnUnref(function(){return this.qualityLevel.perceptualQuality}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbnailHeight",{get:freeOnUnref(function(){return this.qualityLevel.thumbnailHeight}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbnailWidth",{get:freeOnUnref(function(){return this.qualityLevel.thumbnailWidth}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileHeight",{get:freeOnUnref(function(){return this.qualityLevel.tileHeight}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileWidth",{get:freeOnUnref(function(){return this.qualityLevel.tileWidth}),enumerable:!0,configurable:!0}),e})();t.TailoredQualityLevel=n}));e(mm);mm.TailoredQualityLevel;var ym=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(t,n,r){this.stream=t,this.tailoredQualityLevels=this.stream.qualityLevels.map(freeOnUnref(function(e){return new mm.TailoredQualityLevel(e,r,!n||"Video"!==t.type)}))}return e.prototype.resetTailoring=freeOnUnref(function(){for(var e=0,t=this.tailoredQualityLevels;e<t.length;e++){t[e].resetTailoring()}}),Object.defineProperty(e.prototype,"contentProtections",{get:freeOnUnref(function(){return this.stream.contentProtections}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentAlignment",{get:freeOnUnref(function(){return this.stream.segmentAlignment}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:freeOnUnref(function(){return this.stream.id}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mimeType",{get:freeOnUnref(function(){return this.stream.mimeType}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"qualityLevels",{get:freeOnUnref(function(){return this.tailoredQualityLevels}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:freeOnUnref(function(){return this.stream.type}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseId",{get:freeOnUnref(function(){return this.stream.baseId}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:freeOnUnref(function(){return this.stream.label}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:freeOnUnref(function(){return this.stream.language}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textType",{get:freeOnUnref(function(){return this.stream.textType}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subtype",{get:freeOnUnref(function(){return this.stream.subtype}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pictureAspectRatio",{get:freeOnUnref(function(){return this.stream.pictureAspectRatio}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioTrackId",{get:freeOnUnref(function(){return this.stream.audioTrackId}),enumerable:!0,configurable:!0}),e})();t.TailoredStream=n}));e(ym);ym.TailoredStream;var gm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("TailoredPeriod"),r=freeOnUnref(function(){function e(e,t,n){this.tailoredStreams=null,this.utcMsAtZero=e,this.period=t,this.totalShiftMs=0,this.totalExtendMs=0,this.totalOffsetMs=0,this.isSkipped=!1,this.latestTailoredTimeline=null,this.tailoringState={start:{tailored:!1,promise:null,cancel:null},end:{tailored:!1,promise:null,cancel:null}},this.perTimelineOffsetTracking=n}return e.prototype.shift=freeOnUnref(function(e){this.totalShiftMs+=e,n.info(">> TailoredPeriod "+this.period.id+" shifted by "+e+". Total shift now "+this.totalShiftMs+", and tailored bounds are "+this.getTailoredStartMs()+"-"+this.getTailoredEndMs())}),e.prototype.extend=freeOnUnref(function(e){this.totalExtendMs+=e,n.info(">> TailoredPeriod "+this.period.id+" extended by "+e+". Total extend now "+this.totalExtendMs+", and tailored bounds are "+this.getTailoredStartMs()+"-"+this.getTailoredEndMs())}),e.prototype.offset=freeOnUnref(function(e){this.totalOffsetMs=e}),e.prototype.resetTailoring=freeOnUnref(function(){if(this.isSkipped=!1,this.totalOffsetMs=0,this.totalExtendMs=0,this.totalShiftMs=0,(this.latestTailoredTimeline=null)!=this.tailoredStreams)for(var e=0,t=this.tailoredStreams;e<t.length;e++){t[e].resetTailoring()}}),e.prototype.skip=freeOnUnref(function(){this.isSkipped=!0,this.extend(-(this.period.endMs-this.period.startMs))}),Object.defineProperty(e.prototype,"skipped",{get:freeOnUnref(function(){return this.isSkipped}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:freeOnUnref(function(){return this.period.id}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){return this.utcMsAtZero+this.getTailoredStartMs()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){return this.utcMsAtZero+this.getTailoredEndMs()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mediaWallClockUtcStartMs",{get:freeOnUnref(function(){return this.period.mediaWallClockUtcStartMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFinalPeriod",{get:freeOnUnref(function(){return this.period.isFinalPeriod}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"streams",{get:freeOnUnref(function(){var t=this;return null==this.tailoredStreams&&(this.tailoredStreams=this.period.streams.map(freeOnUnref(function(e){return new ym.TailoredStream(e,t.perTimelineOffsetTracking,t)}))),this.tailoredStreams}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isResolved",{get:freeOnUnref(function(){return this.period.isResolved}),enumerable:!0,configurable:!0}),e.prototype.resolve=freeOnUnref(function(){return this.period.resolve()}),e.prototype.awaitForwardAccess=freeOnUnref(function(){return this.period.awaitForwardAccess()}),Object.defineProperty(e.prototype,"offsetMs",{get:freeOnUnref(function(){return this.totalOffsetMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shiftMs",{get:freeOnUnref(function(){return this.totalShiftMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extendMs",{get:freeOnUnref(function(){return this.totalExtendMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originalStartMs",{get:freeOnUnref(function(){return this.utcMsAtZero+this.period.startMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originalEndMs",{get:freeOnUnref(function(){return this.utcMsAtZero+this.period.endMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originalDurationMs",{get:freeOnUnref(function(){return this.period.endMs-this.period.startMs}),enumerable:!0,configurable:!0}),e.prototype.getTailoredStartMs=freeOnUnref(function(){return this.period.startMs+this.totalShiftMs}),e.prototype.getTailoredEndMs=freeOnUnref(function(){return this.period.endMs+this.totalShiftMs+this.totalExtendMs}),e})();t.TailoredPeriod=r}));e(gm);gm.TailoredPeriod;var vm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("PeriodTailor"),n=freeOnUnref(function(){function l(e,t,n,r,i){var o=this;this.eventEmitter=new A.EventEmitter,this.tailorFirstPeriod=!1,this.perTimelineOffsetTracking=!0,this.utcMsAtZero=null==e.utcMsAtZero?0:e.utcMsAtZero,this.timeWindow=e.timeWindow,this.minimumPlayablePositionMs=this.utcMsAtZero+e.timeWindow.startMs,this.periods=[],this.periodValidator=new cm.PeriodValidator,this.segmentTimelineHelper=new dm.SegmentTimelineHelper(t,n),this.periodIdMap={},this.streamAlternatorGetter=r,this.onPeriodRemoved=i,null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.periodTailor&&(this.tailorFirstPeriod=this.tailorFirstPeriod||!0===L.configurationStore.configuration.periodTailor.tailorFirstPeriod,this.perTimelineOffsetTracking=!1!==L.configurationStore.configuration.periodTailor.perTimelineOffsetTracking);var a=freeOnUnref(function(){try{o.updatePeriods(o.periods,e.periods.contents)}catch(e){f.error("Error occurs when updating periods:",e),o.eventEmitter.emit("fatalError",e)}});a(),e.periods.onChange(a)}return l.prototype.setSelectionContext=freeOnUnref(function(e){this.segmentTimelineHelper.setSelectionContext(e)}),l.prototype.getMinimumPlayablePositionMs=freeOnUnref(function(){return this.minimumPlayablePositionMs}),l.prototype.getStitchingInformation=freeOnUnref(function(e,t,n,r){var i=this.periodIdMap[e];if(null==i)throw new Error("Unable to find period "+e+": Current periods are "+JSON.stringify(this.periods.map(freeOnUnref(function(e){return e.id}))));if(!i.isResolved)throw new Error("Period "+e+" is unresolved when it is expected to be resolved.");var o=this.findStream(i,t,n);if(null==o)throw new Error("Unable to find "+t+" stream "+n+" on period "+e);var a=x.find(o.qualityLevels,freeOnUnref(function(e){return e.id===r}));if(null==a)throw new Error("Unable to find "+t+" qualityLevel "+r+" on stream "+n+" of period "+e+"!");return{timestampOffsetMs:i.startMs-a.segmentTimeline.presentationTimeOffsetMs,appendWindowStartMs:Math.max(0,i.startMs-3*hh.Constants.CIRCA_ONE_FRAME_MS),appendWindowEndMs:i.tailoringState.end.tailored?i.endMs+3*hh.Constants.CIRCA_ONE_FRAME_MS:1/0}}),l.prototype.playbackTimeToManifestTime=freeOnUnref(function(e,t){var n=this.periodIdMap[e];return null==n?t-this.utcMsAtZero:t-n.shiftMs-n.offsetMs-this.utcMsAtZero}),l.prototype.manifestTimeToPlaybackTime=freeOnUnref(function(e,t){var n=this.periodIdMap[e];return null==n?t:this.utcMsAtZero+t+n.shiftMs+n.offsetMs}),l.prototype.getPeriodAt=freeOnUnref(function(i){var o=this;return lt.Promise.resolve(this.periods).then(freeOnUnref(function(e){if(x.isEmpty(e)||i<e[0].startMs)return null;var t=null,n=0;for(n=0;n<e.length;n++){var r=e[n];if(i<r.endMs-1){t=r;break}}if(null===t)return t;if(!o.isTailoringOrTailored(t)){if(0<n&&o.isTailoringOrTailored(e[n-1]))return o.tailorPeriodStart(t,e[n-1]);if(n<o.periods.length-1&&o.isTailoringOrTailored(e[n+1])&&Math.abs(i-e[n+1].startMs)<=50)return o.tailorPeriodStart(e[n+1]);o.resetTailoring()}return o.tailorPeriodStart(t)}))}),l.prototype.getPrevPeriod=freeOnUnref(function(e){return lt.Promise.resolve(null)}),l.prototype.getNextPeriod=freeOnUnref(function(r){var i=this;return lt.Promise.resolve(this.periods).then(freeOnUnref(function(e){var t=x.findIndex(e,freeOnUnref(function(e){return r.id===e.id})),n=-1<t?Qe.withDefault(e[t+1],null):null;return null===n?lt.Promise.resolve(e):n.awaitForwardAccess().then(freeOnUnref(function(){return e}))})).then(freeOnUnref(function(e){var t=x.findIndex(e,freeOnUnref(function(e){return r.id===e.id})),n=-1<t?Qe.withDefault(e[t+1],null):null;return null===n?n:n.tailoringState.start.tailored?n:i.tailorPeriodStart(n,e[t])})).then(freeOnUnref(function(e){return null!==e&&e.skipped?i.getNextPeriod(e):e}))}),l.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),l.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),l.prototype.findStream=freeOnUnref(function(e,t,n){var r=e.streams.filter(freeOnUnref(function(e){return e.type===t&&e.id===n}));return x.isEmpty(r)?null:this.streamAlternatorGetter(t).selectStream(r)}),l.prototype.updatePeriods=freeOnUnref(function(e,t){for(var n=0,r=0,i=null;n<e.length&&r<t.length;){for(;n<e.length&&e[n].id!==t[r].id;)null==i&&(i=n),this.onPeriodRemoved(e[n].id),this.periodValidator.stopTrackingPeriod(e[n]),delete this.periodIdMap[e[n].id],e.splice(n,1);n++,r++}for(null!=i&&(n=i);n<e.length&&e[n].id===t[n].id;)isFinite(t[n].endMs)&&e[n].tailoringState.start.tailored&&!e[n].tailoringState.end.tailored&&null==e[n].tailoringState.end.promise&&!e[n].skipped&&this.tailorPeriodEnd(e[n]),n++;for(n<t.length&&this.eventEmitter.emit("newPeriodsAvailable");n<t.length;)e[n]=new gm.TailoredPeriod(this.utcMsAtZero,t[n],this.perTimelineOffsetTracking),this.periodIdMap[e[n].id]=e[n],n++;return e}),l.prototype.isTailoringOrTailored=freeOnUnref(function(e){return e.tailoringState.start.tailored||null!==e.tailoringState.start.promise||e.tailoringState.end.tailored||null!==e.tailoringState.end.promise}),l.prototype.resetTailoring=freeOnUnref(function(){for(var e=0,t=this.periods;e<t.length;e++){var n=t[e],r={start:{tailored:n.tailoringState.start.tailored,tailoring:null!=n.tailoringState.start.promise},end:{tailored:n.tailoringState.end.tailored,tailoring:null!=n.tailoringState.end.promise}};n.resetTailoring(),n.tailoringState.start.tailored=!1,null!==n.tailoringState.start.cancel&&n.tailoringState.start.cancel(),n.tailoringState.start.promise=null,n.tailoringState.end.tailored=!1,null!==n.tailoringState.end.cancel&&n.tailoringState.end.cancel(),n.tailoringState.end.promise=null,f.info(">> TailoredPeriod "+n.id+" was reset to original conditions. Bounds now are "+n.startMs+"-"+n.endMs+". State was: "+JSON.stringify(r))}}),l.prototype.tailorPeriodStart=freeOnUnref(function(n,e){var r=this,t=this.periods[0]===n||n.startMs<this.timeWindow.startMs+this.utcMsAtZero;if(t&&this.periods[0]!==n&&f.warn("A period other than the first period in the MPD was found whose start position ("+n.startMs+"ms) is before the start of the availability window ("+(this.timeWindow.startMs+this.utcMsAtZero)+"ms)"),n.tailoringState.start.tailored||!this.tailorFirstPeriod&&t)return n.tailoringState.start.tailored=!0,n.tailoringState.end.tailored||!isFinite(n.endMs)?lt.Promise.resolve(n):this.tailorPeriodEnd(n);if(null===n.tailoringState.start.promise){var i=lt.CancelToken.source(),o=i.token,a=i.cancel;n.tailoringState.start.cancel=a;var s=void 0;null!=e?(e.tailoringState.start.tailored||f.warn(">>> Previous period "+e.id+" didn't have start tailored, when start tailoring period "+n.id+"!"),e.skipped||e.tailoringState.end.tailored?s=lt.Promise.resolve(e):null!=e.tailoringState.end.promise?s=e.tailoringState.end.promise:isFinite(e.endMs)?s=this.tailorPeriodEnd(e):(f.warn(">>> EndMs of previous period "+e.id+" is still unknown, when start tailoring period "+n.id),s=lt.Promise.resolve(null))):s=lt.Promise.resolve(null),n.tailoringState.start.promise=s.then(freeOnUnref(function(e){if(o.requested)return f.info("Cancelled tailorPeriodStart for period "+n.id),null;if(null!=e){n.shift(e.shiftMs+e.extendMs),f.warn(">>> Begin tailoring start position of period {\n                            id:"+n.id+",\n                            originalBoundary:["+n.originalStartMs+","+n.originalEndMs+"],\n                            boundary:["+n.startMs+","+n.endMs+"],\n                            offsetMs:"+n.offsetMs+",\n                            shiftMs:"+n.shiftMs+",\n                            extendMs:"+n.extendMs+"\n                        }");var t=n.startMs-e.endMs;.001<Math.abs(t)&&f.warn(">>> Mismatch between end of period "+e.id+" and start of period "+n.id+": difference of "+t+"ms!!!")}return l.shouldSkipPeriod(n)?null:n.resolve().then(freeOnUnref(function(){if(!n.streams.some(freeOnUnref(function(e){return"Video"===e.type}))){var e=new ct.XpError("content_src.manifest.parse",void 0,"New MediaRepresentation has period "+n.id+" not containing Video streams",!0);throw f.error("Unable to tailor start of period (id="+n.id+"):",e),r.eventEmitter.emit("fatalError",e),e}return r.segmentTimelineHelper.getFirstSegment(n,"Video")}))})).catch(freeOnUnref(function(e){if(l.shouldSkipPeriod(n))return null;throw e})).then(freeOnUnref(function(e){if(o.requested)return f.info("Cancelled tailorPeriodStart for period "+n.id),null;if(null==e||null==e.segmentInfo){if(!isFinite(n.endMs))throw new Error("Could not get first segment for period (@id="+n.id+"), but the period is not ended yet!");f.warn(">> Period "+n.id+" will be skipped! Untailored duration is "+n.originalDurationMs+"ms"),null!==n.tailoringState.end.cancel&&n.tailoringState.end.cancel(),n.skip(),f.warn(">> Period "+n.id+" is skipped and therefore had its end tailored: extendMs: "+n.extendMs+"ms. End shifted: "+n.originalEndMs+" --\x3e "+n.endMs)}else{if(0<Math.abs(e.segmentInfo.position.startTimeMs)){n.offset(-e.segmentInfo.position.startTimeMs),f.warn(">> Segments from period "+n.id+" are being offset by "+n.offsetMs+"ms");var t=e.timeline;t.offset(n.offsetMs),n.latestTailoredTimeline=t}n.extend(n.offsetMs),f.warn(">> Period "+n.id+" had its start tailored: shiftMs="+n.shiftMs+" and extendMs="+n.extendMs+". Start shifted: "+n.originalStartMs+" --\x3e "+n.startMs)}n.tailoringState.start.tailored=!0,n.tailoringState.start.promise=null,n.tailoringState.start.cancel=null;try{r.periodValidator.validateTailoredPeriod(n)}catch(e){throw f.error("Error while tailoring start of period (id="+n.id+"):",e),r.eventEmitter.emit("fatalError",e),e}return!isFinite(n.endMs)||n.skipped||n.tailoringState.end.tailored?n:r.tailorPeriodEnd(n)}))}return n.tailoringState.start.promise}),l.prototype.tailorPeriodEnd=freeOnUnref(function(r){var e=this;if(r.tailoringState.end.tailored||r.skipped)return lt.Promise.resolve(r);if(null===r.tailoringState.end.promise){var t=lt.CancelToken.source(),i=t.token,n=t.cancel;r.tailoringState.end.cancel=n,r.tailoringState.end.promise=r.resolve().then(freeOnUnref(function(){return e.segmentTimelineHelper.getLastSegment(r,r.originalEndMs,"Video").catch(freeOnUnref(function(e){return i.requested||(r.tailoringState.end.promise=null,r.tailoringState.end.cancel=null,f.warn("Could not find last video segment of period "+r.id,e)),null})).then(freeOnUnref(function(e){if(i.requested)return f.info("Cancelled tailorPeriodEnd for period "+r.id),null;var t=r.endMs-r.startMs,n=null===e?0:e.position.endTimeMs-t;return 0<Math.abs(n)&&f.warn(">>> Period "+r.id+" needs to be further extended by "+n+"ms, for a total of "+(r.extendMs+n)+"ms"),r.extend(n),r.tailoringState.end.tailored=!0,r.tailoringState.end.promise=null,r.tailoringState.end.cancel=null,f.warn(">> Period "+r.id+" had its end tailored: adding "+n+" to extendMs. End shifted: "+r.originalEndMs+" --\x3e "+r.endMs),r}))}))}return r.tailoringState.end.promise}),l.shouldSkipPeriod=freeOnUnref(function(e){var t=Math.max(e.shiftMs,100);return!!(isFinite(e.originalDurationMs)&&e.originalDurationMs<t)&&(f.warn(">> Period "+e.id+" has an untailored duration of "+e.originalDurationMs+"ms. Expecting valid period has untailored duration at least "+t+"ms. Skipping it."),!0)}),l})();t.PeriodTailor=n}));e(vm);vm.PeriodTailor;var Om=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){var e;this.locks=((e={}).Audio={},e.TimedText={},e.Video={},e.Image={},e),this.diagnostics=nn.Diagnostics.create("BlockedSegmentTracker")}return e.prototype.addBlockedSegment=freeOnUnref(function(e,t,n){this.locks[e][t]=n,this.reportDiagnosticsState()}),e.prototype.removeBlockedSegment=freeOnUnref(function(e,t){delete this.locks[e][t],this.reportDiagnosticsState()}),e.prototype.removeAllBlockedSegments=freeOnUnref(function(e){this.locks[e]={},this.reportDiagnosticsState()}),e.prototype.getMinimumBlockedPositionMs=freeOnUnref(function(e){for(var t=1/0,n=0,r=Object.keys(this.locks[e]);n<r.length;n++){var i=r[n];t=Math.min(t,this.locks[e][i])}return t}),e.prototype.reportDiagnosticsState=freeOnUnref(function(){this.diagnostics.report("state",{locks:this.locks,timestamp:Date.now()})}),e})();t.BlockedSegmentTracker=n}));e(Om);Om.BlockedSegmentTracker;var Sm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("PersistentStorageSelectionLoader"),r=freeOnUnref(function(){function e(e){var o=this;this.cachedSelectionContext={},this.updateCachedSelectionContext=freeOnUnref(function(e,t,n,r,i){Jo.metadataStorage.capabilities.isSupported&&null!=o.cachedSelectionContextKey&&(null==o.cachedSelectionContext[e]&&(o.cachedSelectionContext[e]={}),null==o.cachedSelectionContext[e][t]&&(o.cachedSelectionContext[e][t]={}),null==o.cachedSelectionContext[e][t][n]&&(o.cachedSelectionContext[e][t][n]=[]),o.cachedSelectionContext[e][t][n].push({index:r,qualityLevelId:i}),Jo.metadataStorage.put(o.cachedSelectionContextKey,o.cachedSelectionContext))}),this.persistentSelectionContextPromise=null,this.downloadOperationId=e,this.selectionContextKey=yd.createSelectionContextKey(null==e?"":e),this.cachedSelectionContextKey=vu.createCachedSelectionContextKey(null==e?"":e)}return e.prototype.load=freeOnUnref(function(){var e=this;return null!=this.persistentSelectionContextPromise||(Jo.metadataStorage.capabilities.isSupported&&null!=this.downloadOperationId?this.persistentSelectionContextPromise=Jo.metadataStorage.get(this.selectionContextKey).then(freeOnUnref(function(e){return null==e?null:e})).then(freeOnUnref(function(t){return Jo.metadataStorage.get(e.cachedSelectionContextKey).then(freeOnUnref(function(e){return null==e?{selectionContext:t,cachedSelectionContext:null}:{selectionContext:t,cachedSelectionContext:e}})).catch(freeOnUnref(function(e){return n.error("Fail to load cached selection context",e),{selectionContext:t,cachedSelectionContext:null}}))})).catch(freeOnUnref(function(e){return n.error("Fail to load selection context or cached selection context",e),{selectionContext:null,cachedSelectionContext:null}})):this.persistentSelectionContextPromise=lt.Promise.resolve({selectionContext:null,cachedSelectionContext:null})),this.persistentSelectionContextPromise}),e})();t.PersistentStorageSelectionLoader=r}));e(Sm);Sm.PersistentStorageSelectionLoader;var Um=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.fragmentBuffer=e,this.segmentQualityLevelTracker=t}return e.prototype.onPosition=freeOnUnref(function(e){var t=e-3e4,n=t-3e4,r=this.fragmentBuffer.getBufferedRanges().bounds();null!==r&&(n<r.start||(this.fragmentBuffer.trim(t),null!=this.segmentQualityLevelTracker&&this.segmentQualityLevelTracker.trim(t)))}),e})();t.PositionBasedBufferTrimmer=n}));e(Um);Um.PositionBasedBufferTrimmer;var bm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.seekPreviewState=null}return e.prototype.start=freeOnUnref(function(){}),e.prototype.stop=freeOnUnref(function(){}),e.prototype.getTileAt=freeOnUnref(function(e){return null}),e.prototype.getTilesInRange=freeOnUnref(function(e,t){return[]}),e.prototype.seekPreviewExists=freeOnUnref(function(){return null!=this.seekPreviewState}),e})();t.NoOpSeekPreviewManager=n}));e(bm);bm.NoOpSeekPreviewManager;var Pm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.segmentBufferedCallback=new A.MulticastCallback,this.totalAcquiredThumbnailSizeBytes=0,this.segmentMetrics={averageThumbnailSizeBytes:0,bufferedSizeBytes:0,thumbnailsAcquired:0}}return e.prototype.getSegmentMetrics=freeOnUnref(function(){return this.segmentMetrics}),e.prototype.recordSegmentMetrics=freeOnUnref(function(e,t,n){var r=this;this.totalAcquiredThumbnailSizeBytes+=n,this.segmentMetrics.thumbnailsAcquired+=t.tileHeight*t.tileWidth,this.segmentMetrics.averageThumbnailSizeBytes=this.totalAcquiredThumbnailSizeBytes/this.segmentMetrics.thumbnailsAcquired,this.segmentMetrics.bufferedSizeBytes+=n;var i=e.onFreed;e.onFreed=freeOnUnref(function(){r.segmentMetrics.bufferedSizeBytes-=n,i()}),this.segmentBufferedCallback.invoke()}),e.prototype.onSegmentBuffered=freeOnUnref(function(e){this.segmentBufferedCallback.add(e)}),e.prototype.offSegmentBuffered=freeOnUnref(function(e){this.segmentBufferedCallback.remove(e)}),e})();t.BufferedImageSegmentsTracker=n}));e(Pm);Pm.BufferedImageSegmentsTracker;var Mm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r){this.overallBuffer=e,this.multiQualityBufferManager=t,this.liveHeadBuffer=n,this.timeWindow=r;var i=L.configurationStore.configuration;this.enableLoadFromPlaybackPosition=null!=i&&null!=i.dashLiveTrickplay&&!0===i.dashLiveTrickplay.enableLoadFromPlaybackPosition}return e.prototype.isBufferReadyForConsumption=freeOnUnref(function(){return this.enableLoadFromPlaybackPosition?0<this.overallBuffer.getBufferedRanges().getIntervals().length:this.isBufferReady(this.overallBuffer.getBufferedRanges(),.5)}),e.prototype.isBufferReadyForUpgrade=freeOnUnref(function(){var e=this.multiQualityBufferManager.getBufferedRangesInProgress().union(this.liveHeadBuffer.getBufferedRanges());return this.isBufferReady(e,.92)}),e.prototype.isCurrentWaveBufferFull=freeOnUnref(function(){var e=this.multiQualityBufferManager.getBufferedRangesInProgress();return this.isBufferReady(e,1)}),e.prototype.isBufferReady=freeOnUnref(function(e,t){var n=e.getIntervals();if(1!==n.length)return!1;var r=n[0].end-Math.max(n[0].start,this.timeWindow.startMs);return(this.timeWindow.endMs-this.timeWindow.startMs)*t<=r}),e})();t.BufferReadyManager=n}));e(Mm);Mm.BufferReadyManager;var Cm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.maxBitrate=e}return e.prototype.filter=freeOnUnref(function(e,t){var n=this;return isFinite(this.maxBitrate)?{validQualities:e.filter(freeOnUnref(function(e){return n.isValidQuality(e,t)})),maxBitrateBitsPerSec:this.maxBitrate}:{validQualities:e}}),e.prototype.isValidQuality=freeOnUnref(function(e,t){return e.bandwidth<=this.maxBitrate}),Object.defineProperty(e.prototype,"maxBitrateBitsPerSec",{get:freeOnUnref(function(){return this.maxBitrate}),enumerable:!0,configurable:!0}),e})();t.BitrateCapFilter=n}));e(Cm);Cm.BitrateCapFilter;var Em=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.filter=freeOnUnref(function(e,t){if(e.length<1)return{validQualities:[]};for(var n=e[0].thumbnailHeight,r=e[0].thumbnailWidth,i=0,o=e;i<o.length;i++){var a=o[i];(a.thumbnailHeight>n||a.thumbnailHeight===n&&a.thumbnailWidth>r)&&(n=a.thumbnailHeight,r=a.thumbnailWidth)}return{validQualities:e.filter(freeOnUnref(function(e){return e.thumbnailWidth===r&&e.thumbnailHeight===n}))}}),e.prototype.isValidQuality=freeOnUnref(function(e,t){return!0}),e})();t.HighestThumbnailResolutionFilter=n}));e(Em);Em.HighestThumbnailResolutionFilter;var Tm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.configure=freeOnUnref(function(e){this.maxTileResolutionCells=e}),e.prototype.filter=freeOnUnref(function(e,t){var n=this;return{validQualities:e.filter(freeOnUnref(function(e){return n.isValidQuality(e,t)}))}}),e.prototype.isValidQuality=freeOnUnref(function(e,t){return null==this.maxTileResolutionCells||e.tileHeight<=this.maxTileResolutionCells.height&&e.tileWidth<=this.maxTileResolutionCells.width}),e})();t.MaxTileCellResolutionFilter=n}));e(Tm);Tm.MaxTileCellResolutionFilter;var wm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.configure=freeOnUnref(function(e){this.maxTileResolutionPx=e}),e.prototype.filter=freeOnUnref(function(e,t){var n=this;return{validQualities:e.filter(freeOnUnref(function(e){return n.isValidQuality(e,t)}))}}),e.prototype.isValidQuality=freeOnUnref(function(e,t){return null==this.maxTileResolutionPx||e.thumbnailHeight*e.tileHeight<=this.maxTileResolutionPx.height&&e.thumbnailWidth*e.tileWidth<=this.maxTileResolutionPx.width}),e})();t.MaxTilePixelResolutionFilter=n}));e(wm);wm.MaxTilePixelResolutionFilter;var Im=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.minSegmentDurationMs=e,this.maxSegmentDurationMs=t}return e.prototype.filter=freeOnUnref(function(e,t){var n=this;return{validQualities:e.filter(freeOnUnref(function(e){return n.isValidQuality(e,t)}))}}),e.prototype.isValidQuality=freeOnUnref(function(e,t){var n=e.segmentTimeline.segmentDurationMs;return null!=n&&((null==this.minSegmentDurationMs||n>=this.minSegmentDurationMs)&&(null==this.maxSegmentDurationMs||n<=this.maxSegmentDurationMs))}),e})();t.SegmentDurationFilter=n}));e(Im);Im.SegmentDurationFilter;var km=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i){this.bitrateCapFilter=new Cm.BitrateCapFilter(e),this.maxTilePixelResolutionFilter=new wm.MaxTilePixelResolutionFilter,this.maxTileCellResolutionFilter=new Tm.MaxTileCellResolutionFilter,this.segmentDurationFilter=new Im.SegmentDurationFilter(r,i),this.highestThumbnailResolutionFilter=new Em.HighestThumbnailResolutionFilter,this.configure(t,n)}return e.prototype.configure=freeOnUnref(function(e,t){this.maxTilePixelResolutionFilter.configure(e),this.maxTileCellResolutionFilter.configure(t)}),e.prototype.filter=freeOnUnref(function(e,t){var n=this,r=e.filter(freeOnUnref(function(e){return n.isValidQuality(e,t)}));return this.highestThumbnailResolutionFilter.filter(r,t)}),e.prototype.isValidQuality=freeOnUnref(function(e,t){return this.bitrateCapFilter.isValidQuality(e,t)&&this.maxTilePixelResolutionFilter.isValidQuality(e,t)&&this.maxTileCellResolutionFilter.isValidQuality(e,t)&&this.segmentDurationFilter.isValidQuality(e,t)}),e})();t.CompositeImageQualityLevelFilter=n}));e(km);km.CompositeImageQualityLevelFilter;var _m=t(freeOnUnref(function(e,t){var l=ce&&ce.__assign||freeOnUnref(function(){return(l=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});function f(e,t){return e.position.endTimeMs-t.position.endTimeMs}Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function s(e,t){var n=this;this.updateCallback=new A.MulticastCallback,this.invokeCallback=freeOnUnref(function(){return n.updateCallback.invoke()}),this.mainBuffer=e,this.backupBuffer=t,this.attachBufferListeners()}return s.prototype.destroy=freeOnUnref(function(){this.detachBufferListeners()}),s.prototype.getMainBuffer=freeOnUnref(function(){return this.mainBuffer}),s.prototype.getBackupBuffer=freeOnUnref(function(){return this.backupBuffer}),s.prototype.setBuffers=freeOnUnref(function(e,t){this.detachBufferListeners(),this.mainBuffer=e,this.backupBuffer=t,this.attachBufferListeners()}),s.prototype.addMediaFragment=freeOnUnref(function(e){this.mainBuffer.addMediaFragment(e),this.backupBuffer.trim(e.position.endTimeMs,!0)}),s.prototype.getMediaFragmentAt=freeOnUnref(function(e){var t=this.mainBuffer.getMediaFragmentAt(e);return null!=t?t:this.backupBuffer.getMediaFragmentAt(e)}),s.prototype.getMediaFragmentsInRange=freeOnUnref(function(e,t){var n=this.mainBuffer.getMediaFragmentsInRange(e,t),r=this.backupBuffer.getMediaFragmentsInRange(e,t);if(n.length<1)return r;if(r.length<1)return n;n.sort(f),r.sort(f);var i=n,o=n[n.length-1].position.endTimeMs,a=r[r.length-1].position.endTimeMs;return o<t&&o<a&&(i=s.mergeSegments(n,r)),i}),s.prototype.getBufferedRanges=freeOnUnref(function(){return this.mainBuffer.getBufferedRanges().union(this.backupBuffer.getBufferedRanges())}),s.prototype.linkSegment=freeOnUnref(function(e,t,n,r){this.mainBuffer.linkSegment(e,t,n,r)}),s.prototype.flush=freeOnUnref(function(){this.backupBuffer.flush(!0),this.mainBuffer.flush(!0)}),s.prototype.trim=freeOnUnref(function(e){this.backupBuffer.trim(e,!0),this.mainBuffer.trim(e,!0)}),s.prototype.onUpdate=freeOnUnref(function(e){this.updateCallback.add(e)}),s.prototype.offUpdate=freeOnUnref(function(e){this.updateCallback.remove(e)}),s.prototype.attachBufferListeners=freeOnUnref(function(){this.mainBuffer.onUpdate(this.invokeCallback),this.backupBuffer.onUpdate(this.invokeCallback)}),s.prototype.detachBufferListeners=freeOnUnref(function(){this.mainBuffer.offUpdate(this.invokeCallback),this.backupBuffer.offUpdate(this.invokeCallback)}),s.mergeSegments=freeOnUnref(function(e,t){var n=e[e.length-1].position.endTimeMs,r=x.findIndex(t,freeOnUnref(function(e){return e.position.endTimeMs>n}));if(-1<r){var i=t[r],o=null!=i.presentationTimeOffsetMs?i.presentationTimeOffsetMs:0,a=Math.max(i.position.startTimeMs,n),s=l({},i,{presentationTimeOffsetMs:o+a-i.position.startTimeMs,position:l({},i.position,{startTimeMs:a})});e.push(s),r<t.length-1&&(e=e.concat(t.slice(r+1)))}return e}),s})();t.CompositeImageSegmentBuffer=n}));e(_m);_m.CompositeImageSegmentBuffer;var Rm=t(freeOnUnref(function(e,t){function i(e,t,n){for(var r=0,i=e.periods.contents;r<i.length;r++)for(var o=0,a=i[r].streams;o<a.length;o++){var s=a[o],l=0<s.qualityLevels.length?s.qualityLevels[0].segmentTimeline.segmentDurationMs:null;if("Image"===s.type&&l===t){var f=n.selectQuality(s);return null!=f?f.qualityLevel:null}}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.createTileConfig=function(e,t,n){var r=n,i=t.tileHeight*t.tileWidth;return{mimeType:e.mimeType,streamType:e.type,thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth,tileHeight:t.tileHeight,tileWidth:t.tileWidth,thumbnailDurationMs:r/i}},t.getAllValidPeriodImageStreams=function(e,t){return e.periods.contents.map(freeOnUnref(function(e){return t.selectStreams(e,"Image")}))},t.getQualityLevelForSegmentDuration=i,t.getBandwidthForSegmentDuration=function(e,t,n){var r=i(e,t,n);return null!=r?r.bandwidth:null},t.getReadableDuration=function(e){return e/1e3/60+"min"}}));e(Rm);Rm.createTileConfig,Rm.getAllValidPeriodImageStreams,Rm.getQualityLevelForSegmentDuration,Rm.getBandwidthForSegmentDuration,Rm.getReadableDuration;var Am=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.name="AverageThumbnailSize",this.segmentTracker=e}return e.prototype.getEstimatedBandwidths=freeOnUnref(function(e,t){return{targetLevelBandwidthBitsPerSec:this.getEstimatedBandwidthBitsPerSec(e.qualityLevel,e.effectiveTileDurationMs),liveHeadBandwidthBitsPerSec:null!=t?this.getEstimatedBandwidthBitsPerSec(t.qualityLevel,t.effectiveTileDurationMs):void 0}}),e.prototype.getEstimatedBandwidthBitsPerSec=freeOnUnref(function(e,t){var n=8*this.segmentTracker.getSegmentMetrics().averageThumbnailSizeBytes*e.tileHeight*e.tileWidth*1.1;return Math.floor(n/(t/1e3))}),e})();t.AverageThumbnailSizeBandwidthStrategy=n}));e(Am);Am.AverageThumbnailSizeBandwidthStrategy;var Dm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.name="Basic"}return e.prototype.getEstimatedBandwidths=freeOnUnref(function(e,t){var n,r=Math.floor(e.effectiveBitrateBitsPerSec*(1/3));return null!=t&&(n=Math.floor(t.effectiveBitrateBitsPerSec*(1/3))),{targetLevelBandwidthBitsPerSec:r,liveHeadBandwidthBitsPerSec:n}}),e})();t.BasicBandwidthEstimationStrategy=n}));e(Dm);Dm.BasicBandwidthEstimationStrategy;var xm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("CompositeBandwidthEstimationStrategy"),n=freeOnUnref(function(){function e(e){this.lastStrategyName=null,this.segmentsTracker=e,this.averageThumbnailSizeBandwidthStrategy=new Am.AverageThumbnailSizeBandwidthStrategy(this.segmentsTracker),this.basicBandwidthEstimationStrategy=new Dm.BasicBandwidthEstimationStrategy}return Object.defineProperty(e.prototype,"name",{get:freeOnUnref(function(){return"Composite."+this.lastStrategyName}),enumerable:!0,configurable:!0}),e.prototype.getEstimatedBandwidths=freeOnUnref(function(e,t){var n;return n=this.segmentsTracker.getSegmentMetrics().thumbnailsAcquired<300?this.basicBandwidthEstimationStrategy:this.averageThumbnailSizeBandwidthStrategy,this.lastStrategyName=n.name,r.info("Estimation strategy: "+this.lastStrategyName),n.getEstimatedBandwidths(e,t)}),e})();t.CompositeBandwidthEstimationStrategy=n}));e(xm);xm.CompositeBandwidthEstimationStrategy;var Fm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.isUpdateRequired=freeOnUnref(function(e,t){return.95*t<e}),e.prototype.getReservationIncreaseRatio=freeOnUnref(function(e,t){if(t<=0)return 0;var n=e/(.95*t)-1;return Math.max(0,n)}),e})();t.ReservationThresholdAssessmentStrategy=n}));e(Fm);Fm.ReservationThresholdAssessmentStrategy;var Bm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("ImageBufferReservationManager");function s(e){return null==e?null:e/1024/1024}var n=freeOnUnref(function(){function o(e,t,n,r){var o=this;this.reservationUpdateCallback=new A.MulticastCallback,this.maxImageBufferSizeBytes=null,this.memoryEstimationRatio=1,this.memoryReservedBytes=0,this.assessReservation=freeOnUnref(function(){for(var e=o.segmentsTracker.getSegmentMetrics(),t=0,n=o.reservationAssessmentStrategies;t<n.length;t++){var r=n[t];if(r.isUpdateRequired(e.bufferedSizeBytes,o.memoryReservedBytes)){o.memoryEstimationRatio+=r.getReservationIncreaseRatio(e.bufferedSizeBytes,o.memoryReservedBytes)+.05,o.reservationUpdateCallback.invoke();var i={bufferedSizeMiB:s(e.bufferedSizeBytes),reservedSizeMiB:s(o.memoryReservedBytes),currentEventDurationMins:(o.timeWindow.endMs-o.timeWindow.startMs)/1e3/60,newMemoryEstimationRatio:o.memoryEstimationRatio};a.info("Estimated reservation requires update: "+JSON.stringify(i)),q.metrics.putMetric("LiveTrickplay.ReservationEstimateUpdate."+o.bandwidthEstimationStrategy.name)}}}),this.mediaRepresentation=e,this.timeWindow=t,this.playerBufferManager=n,this.segmentsTracker=r,this.bandwidthEstimationStrategy=new xm.CompositeBandwidthEstimationStrategy(this.segmentsTracker),this.reservationAssessmentStrategies=[new Fm.ReservationThresholdAssessmentStrategy]}return o.prototype.initialize=freeOnUnref(function(){this.segmentsTracker.onSegmentBuffered(this.assessReservation);var e=o.getMaxBandwidthBitsPerSec(this.mediaRepresentation),t=e.Audio,n=e.Video;a.info("maxVideoBandwidthBitsPerSec: "+n+", maxAudioBandwidthBitsPerSec: "+t);var r=30,i=L.configurationStore.configuration;null!=i&&null!=i.dashLiveTrickplay&&null!=i.dashLiveTrickplay.minAudioVideoBufferReservedOverrideSec&&(r=i.dashLiveTrickplay.minAudioVideoBufferReservedOverrideSec),this.maxImageBufferSizeBytes=this.playerBufferManager.getMaxAvailableBytes()-(t+n)*r/8,a.info("For a minimum of "+r+" seconds A/V reserved, maxImageBufferSizeBytes is "+s(this.maxImageBufferSizeBytes)+" MiB")}),o.prototype.uninitialize=freeOnUnref(function(){this.segmentsTracker.offSegmentBuffered(this.assessReservation),this.maxImageBufferSizeBytes=null,this.memoryReservedBytes=0}),o.prototype.attemptEstimatedReservation=freeOnUnref(function(e,t,n){a.info("Attempting reservation for an estimated event duration of "+Rm.getReadableDuration(n));var r=this.getEstimatedMemoryBytes(e,t,n);return this.attemptDirectReservation(r)}),o.prototype.attemptDirectReservation=freeOnUnref(function(e){var t=this;if(a.info("Attempting to reserve "+s(e)+" MiB."),!this.isBufferSufficient(e))return a.info("Reservation does not leave enough memory for A/V. maxImageBufferSizeBytes: "+s(this.maxImageBufferSizeBytes)+" MiB, currentReservedBytes: "+s(this.memoryReservedBytes)+" MiB"),{fulfilled:!1};var n=this.playerBufferManager.irrevocableReserve(e);if(n.fulfilled){this.memoryReservedBytes+=n.sizeBytes;var r=n.onFreed;n.onFreed=freeOnUnref(function(){t.memoryReservedBytes-=n.sizeBytes,r(),oe.timer.setImmediate(t.assessReservation)})}return n}),o.prototype.onReservationUpdateRequired=freeOnUnref(function(e){this.reservationUpdateCallback.add(e)}),o.prototype.offReservationUpdateRequired=freeOnUnref(function(e){this.reservationUpdateCallback.remove(e)}),o.prototype.reportBufferedToEstimationRatioMetric=freeOnUnref(function(){var e=this.segmentsTracker.getSegmentMetrics().bufferedSizeBytes;q.metrics.putMetric("LiveTrickplay.BufferedSizeToEstimationRatio."+this.bandwidthEstimationStrategy.name,e/this.memoryReservedBytes)}),o.prototype.getEstimatedMemoryBytes=freeOnUnref(function(e,t,n){var r=this.bandwidthEstimationStrategy.getEstimatedBandwidths(e,t),i=o.getBytesNeededForDuration(r.targetLevelBandwidthBitsPerSec,n);return null!=r.liveHeadBandwidthBitsPerSec&&(i+=o.getBytesNeededForDuration(r.liveHeadBandwidthBitsPerSec,e.effectiveTileDurationMs)),i*this.memoryEstimationRatio}),o.getBytesNeededForDuration=freeOnUnref(function(e,t){return e*t/1e3/8}),o.getMaxBandwidthBitsPerSec=freeOnUnref(function(e){for(var t={},n=0,r=e.periods.contents;n<r.length;n++)for(var i=0,o=r[n].streams;i<o.length;i++){var a=o[i],s=a.qualityLevels;0!==s.length&&(null==t[a.type]&&(t[a.type]=0),t[a.type]=Math.max(s[s.length-1].bandwidth,t[a.type]))}return t}),o.prototype.isBufferSufficient=freeOnUnref(function(e){return null!=this.maxImageBufferSizeBytes&&e+this.memoryReservedBytes<=this.maxImageBufferSizeBytes}),o})();t.ImageBufferReservationManager=n}));e(Bm);Bm.ImageBufferReservationManager;var Lm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var m=de.get("ImageQualityManager"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d){var p=this;this.onBufferUpdate=freeOnUnref(function(){p.bufferReadyManager.isBufferReadyForUpgrade()&&("ChangingQuality"===p.state&&p.eventEmitter.emit("qualityChangeComplete"),p.multiQualityBufferManager.flushOldBuffer(),p.state="Waiting",p.attemptUpgrade())}),this.onPeriodUpdate=freeOnUnref(function(){var e=p.imageStreamAlternator.getCurrentGranularityLevel();if("Uninitialized"!==p.state&&null!=e){var t=p.timeWindow.endMs-p.timeWindow.startMs,n=p.imageStreamAlternator.updateStreams(Rm.getAllValidPeriodImageStreams(p.mediaRepresentation,p.streamSelector)),r=p.multiQualityBufferManager.progressImageBuffer.allottedSizeBytes,i=!1;t>=p.estimatedEventDurationMs&&(i=!0,p.estimatedEventDurationMs=p.timeWindow.endMs-p.timeWindow.startMs+36e5,m.info("Event is exceeding the estimated duration. New estimate is "+Rm.getReadableDuration(p.estimatedEventDurationMs)+". Attempting to update buffer reservation."),p.imageBufferReservationManager.reportBufferedToEstimationRatioMetric()),null!=n&&e!==n&&(i=!0,m.info("Trickplay granularity updated to "+n+" ms per tile after period update.")),p.liveHeadTileAcquirer.update()&&(i=!0),i&&null!=n&&p.attemptReservationUpdate(n,r)}}),this.onReservationUpdate=freeOnUnref(function(){var e=p.imageStreamAlternator.getCurrentGranularityLevel();null!=e&&p.attemptReservationUpdate(e,p.multiQualityBufferManager.progressImageBuffer.allottedSizeBytes)}),this.shouldSkipPeriodForPartialFlush=freeOnUnref(function(e){var t=p.periodAccessor.getPeriod(e.periodId);if(null==t)return!1;var n=p.imageStreamAlternator.selectStream(p.streamSelector.selectStreams(t,p.streamType));return null!=n&&n.id===e.streamId}),this.streamType=e,this.mediaRepresentation=t,this.multiQualityBufferManager=n,this.overallImageBuffer=r,this.liveHeadTileAcquirer=i,this.streamSelector=o,this.imageStreamAlternator=a,this.imageBufferReservationManager=s,this.periodAccessor=l,this.qualityLevelFilter=f,this.qualitySelector=u,this.timeWindow=c,this.bufferReadyManager=d;var h=this.timeWindow.endMs-this.timeWindow.startMs;this.estimatedEventDurationMs=h+36e5,this.eventEmitter=new A.EventEmitter,this.state="Uninitialized"}return Object.defineProperty(e.prototype,"currentState",{get:freeOnUnref(function(){return this.state}),enumerable:!0,configurable:!0}),e.prototype.initialize=freeOnUnref(function(){this.liveHeadTileAcquirer.initialize(),this.imageBufferReservationManager.initialize(),this.streamSelector.setMatchers("Image",new vu.ImageStreamMatcher(this.qualityLevelFilter)),this.imageStreamAlternator.initialize(Rm.getAllValidPeriodImageStreams(this.mediaRepresentation,this.streamSelector));var e=this.imageStreamAlternator.getCurrentGranularityLevel();return null==e?(m.info("Trickplay failed to initialize: Could not find any valid Trickplay streams."),this.uninitialize(),!1):this.attemptEstimatedReservation(e)?(m.info("Trickplay initialized with "+e+" ms per tile, with an estimated event duration of "+Rm.getReadableDuration(this.estimatedEventDurationMs)+"."),this.state="Waiting",this.overallImageBuffer.onUpdate(this.onBufferUpdate),this.mediaRepresentation.periods.onChange(this.onPeriodUpdate),this.imageBufferReservationManager.onReservationUpdateRequired(this.onReservationUpdate),!0):(m.info("Trickplay failed to initialize: Could not reserve memory for the estimated event duration ("+Rm.getReadableDuration(this.estimatedEventDurationMs)+")."),q.metrics.putMetric("LiveTrickplay.Initialization.InsufficientMemory"),this.uninitialize(),!1)}),e.prototype.uninitialize=freeOnUnref(function(){this.state="Uninitialized",this.mediaRepresentation.periods.offChange(this.onPeriodUpdate),this.overallImageBuffer.offUpdate(this.onBufferUpdate),this.imageBufferReservationManager.offReservationUpdateRequired(this.onReservationUpdate),this.overallImageBuffer.flush(),this.multiQualityBufferManager.destroy(),this.imageStreamAlternator.uninitialize(),this.liveHeadTileAcquirer.uninitialize(),this.imageBufferReservationManager.uninitialize()}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.attemptUpgrade=freeOnUnref(function(){var e=this.imageStreamAlternator.getCurrentGranularityLevel(),t=this.imageStreamAlternator.getNextGranularityLevel(),n=null!=t?this.getTargetLevelTileInfo(t):null;if(null!=e&&null!=t&&t!==e&&null!=n){var r=this.getLiveHeadTileDurationMs(n),i=this.imageBufferReservationManager.attemptEstimatedReservation(n,this.liveHeadTileAcquirer.getTileInfo(this.mediaRepresentation,r),this.estimatedEventDurationMs);i.fulfilled&&(this.multiQualityBufferManager.completeInProgressBuffer(),this.multiQualityBufferManager.setProgressBufferMetadata(i.onFreed,i.sizeBytes),this.imageStreamAlternator.upgradeGranularityLevel(),this.liveHeadTileAcquirer.setTargetTileDurationMs(r),this.onQualityChange())}}),e.prototype.attemptDowngrade=freeOnUnref(function(e){m.info(">> attemptDowngrade");for(var t=e,n=this.imageStreamAlternator.downgradeGranularityLevel();null!=n&&t!==n;){if(this.attemptEstimatedReservation(n))return!0;t=n,n=this.imageStreamAlternator.downgradeGranularityLevel()}return!1}),e.prototype.attemptEstimatedReservation=freeOnUnref(function(e){var t=this.getTargetLevelTileInfo(e);if(null==t)return!1;var n=this.getLiveHeadTileDurationMs(t),r=this.imageBufferReservationManager.attemptEstimatedReservation(t,this.liveHeadTileAcquirer.getTileInfo(this.mediaRepresentation,n),this.estimatedEventDurationMs);return r.fulfilled&&(this.multiQualityBufferManager.setProgressBufferMetadata(r.onFreed,r.sizeBytes),this.liveHeadTileAcquirer.setTargetTileDurationMs(n)),r.fulfilled}),e.prototype.attemptDirectReservation=freeOnUnref(function(e){var t=this.imageBufferReservationManager.attemptDirectReservation(e);return t.fulfilled&&this.multiQualityBufferManager.setProgressBufferMetadata(t.onFreed,t.sizeBytes),t.fulfilled}),e.prototype.attemptReservationUpdate=freeOnUnref(function(e,t){if(this.multiQualityBufferManager.progressImageBuffer.onFreed(),m.info("Updating reservation for the estimated event duration ("+Rm.getReadableDuration(this.estimatedEventDurationMs)+")."),!this.attemptEstimatedReservation(e)){m.info("Flushing half of the current tiles to release some memory.");var n=this.attemptDirectReservation(t/2);return this.multiQualityBufferManager.completeInProgressBuffer(),n&&this.attemptDowngrade(e)?(this.multiQualityBufferManager.oldImageBuffer.buffer.partialFlush(this.shouldSkipPeriodForPartialFlush),this.onQualityChange(),!1):(this.uninitialize(),this.eventEmitter.emit("memoryCapacityReached"),m.info("<< memoryCapacityReached"),q.metrics.putMetric("LiveTrickplay.TrickplayAbandoned.MemoryCapacityReached"),!1)}return m.info("Updated the buffer reservation."),!0}),e.prototype.getTargetLevelTileInfo=freeOnUnref(function(e){var t=Rm.getQualityLevelForSegmentDuration(this.mediaRepresentation,e,this.qualitySelector);return null==t?(m.warn("Could not find a stream with segment duration "+e+" ms in the current MediaRepresentation."),null):{qualityLevel:t,effectiveBitrateBitsPerSec:t.bandwidth,effectiveTileDurationMs:e}}),e.prototype.getLiveHeadTileDurationMs=freeOnUnref(function(e){return e.effectiveTileDurationMs/e.qualityLevel.tileHeight/e.qualityLevel.tileWidth}),e.prototype.onQualityChange=freeOnUnref(function(){this.state="ChangingQuality";var e=this.imageStreamAlternator.getCurrentGranularityLevel();m.info("Trickplay granularity changed to "+e+" ms per tile."),this.eventEmitter.emitSync("qualityChange")}),e})();t.ImageQualityManager=n}));e(Lm);Lm.ImageQualityManager;var Nm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createPeriodBoundedTileSegmentPosition=function(e,t){var n=qh.clampInPeriodBoundary(e,t);return{startTimeMs:n.startTimeMs,endTimeMs:n.endTimeMs,durationMs:t.durationMs}},t.createTimeWindowBoundedTileSegmentPosition=function(e,t){return{startTimeMs:Math.max(e.startMs,t.startTimeMs,0),endTimeMs:Math.min(e.endMs,t.endTimeMs),durationMs:t.durationMs}}}));e(Nm);Nm.createPeriodBoundedTileSegmentPosition,Nm.createTimeWindowBoundedTileSegmentPosition;var Vm=t(freeOnUnref(function(e,t){var d=ce&&ce.__assign||freeOnUnref(function(){return(d=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var a=new In.StepFunction([[0,50],[3,500],[6,4e3]]);function g(e){return freeOnUnref(function(){un.DataLocator.revoke(e)})}var s=de.get("ImageStreamAcquirer"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f){var u=this;this.started=!1,this.acquisitionToken=null,this.acquisitionCancel=null,this.reportStateChange=freeOnUnref(function(){u.diagnostics.report("state",d({},u.pendingSegmentTracker.collectPendingSegmentsDiagnosticsState(),{timestamp:Date.now()}))}),this.type=e,this.downloadQueue=t,this.segmentBuffer=n,this.bufferedImageSegmentsTracker=r,this.acquisitionValidator=i,this.fragmentContentSourceEventEmitter=o,this.prioritizationSystem=s,this.qualitySelector=l,this.addFragmentResolution=Zh.ADD_FRAGMENT_RESOLUTION_MAP[this.type];var c=null!=f?"."+f:"";this.diagnostics=nn.Diagnostics.create("ImageStreamAcquirer"+c),this.fragmentRequestFactory=new od.FragmentRequestFactory,this.maxConcurrentRequests=1,this.networkRequestManager=_c.getInstance(),this.pendingSegmentTracker=new Yh.SegmentAcquisitionRequestTracker,this.segmentSkippedCallback=new A.MulticastCallback}return e.prototype.start=freeOnUnref(function(){var e=lt.CancelToken.source(),t=e.token,n=e.cancel;this.acquisitionToken=t,this.acquisitionCancel=n,this.started=!0;for(var r=0;r<this.maxConcurrentRequests;r++)this.waitSegment()}),e.prototype.stop=freeOnUnref(function(){null!=this.acquisitionCancel&&this.acquisitionCancel(),this.acquisitionToken=null,this.acquisitionCancel=null,this.pendingSegmentTracker.terminate(),this.started=!1,this.reportStateChange()}),e.prototype.trimPendingAcquisitions=freeOnUnref(function(e){this.pendingSegmentTracker.trimPendingSegments(e)}),e.prototype.onSegmentSkipped=freeOnUnref(function(e){this.segmentSkippedCallback.add(e)}),e.prototype.offSegmentSkipped=freeOnUnref(function(e){this.segmentSkippedCallback.remove(e)}),e.prototype.registerMediaSegmentRequest=freeOnUnref(function(l,o){var f=this,e=lt.CancelToken.source(),u=e.token,t=e.cancel,c=l.segment,d=this.qualitySelector.selectQuality(c.stream);if(null==d)return s.warn("Segment "+c.segment.index+" in period "+c.period.id+" got requested despite not having any valid quality levels."),void this.waitSegment();var p=Nm.createPeriodBoundedTileSegmentPosition(c.period,c.contentPosition);if(!this.acquisitionValidator.shouldAcquire(c,p,d))return this.downloadQueue.done(l),void this.waitSegment();var n=this.type+"|"+l.segment.period.id+"|"+l.segment.stream.id+"|"+l.segment.segment.index,h=this.pendingSegmentTracker.trackMediaSegmentDownloadRequest(l,t);h.qualityLevelIndex=d.index;var r=this.getPriorityFunction(u),m={priorityFunction:r,selectedQualityLevel:d.qualityLevel,selectedMediaSegmentInfo:c.segment},y=p.startTimeMs-c.contentPosition.startTimeMs,i={assetType:"mediaFragment."+this.type,getRequestBuilder:freeOnUnref(function(){return f.createRequestBuilder(u,i,h,m)}),getPriority:r,onCancelled:freeOnUnref(function(e){}),description:n};h.diagnosticsTracker.queued(r()),this.reportStateChange(),this.networkRequestManager.requestDownload(i,u).then(freeOnUnref(function(e){var t=e.getDataLocator();if(null==t)throw new Error("Response data is null");var n=g(t);u.requested&&(n(),u.throwIfRequested());var r=m.selectedQualityLevel,i=m.selectedMediaSegmentInfo,o=Jh.collectSuccessfulMediaSegmentPayloads(f.type,e,l,h,i,r);f.onRequestSucceed(o.resource);var a=o.eventEmitterPayload;f.addFragmentResolution(a,r),f.fragmentContentSourceEventEmitter.emit("fragmentDownloaded",a),f.diagnostics.report("fragmentDownloaded",o.diagnosticsPayload);var s=f.addSegmentToBuffer(l,c,p,r,y,t,g(t));f.bufferedImageSegmentsTracker.recordSegmentMetrics(s,d.qualityLevel,e.getMetrics().totalBytes),f.pendingSegmentTracker.stopTrackingSegment(h),f.pendingSegmentTracker.trackSegmentSuccess(h),f.reportStateChange(),f.downloadQueue.done(l),f.waitSegment()})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError){if(null!=o&&o.requested)return;return u.requested?f.downloadQueue.done(l):f.downloadQueue.release(l),void f.waitSegment()}var t=m.selectedQualityLevel,n=m.selectedMediaSegmentInfo;e instanceof _c.AcquisitionError&&null!=n&&(f.onRequestFailed(e,n.sourceUrl),"HttpError"===e.reason.type&&h.httpErrorCount++);var r=Jh.collectFailedMediaSegmentPayload(f.type,e,l,h,n,t);if(null!=r.eventEmitterPayload&&null!=t&&(f.addFragmentResolution(r.eventEmitterPayload,t),f.fragmentContentSourceEventEmitter.emit("fragmentDownloadFailed",r.eventEmitterPayload)),null!=r.diagnosticsPayload&&f.diagnostics.report("fragmentDownloadFailed",r.diagnosticsPayload),s.error(r.errorMessage,e),h.diagnosticsTracker.failed(r.errorMessage),f.reportStateChange(),3<=h.httpErrorCount)return f.addSegmentToBuffer(l,c,p,t,y,null,freeOnUnref(function(){})),f.downloadQueue.done(l),f.waitSegment(),void f.segmentSkippedCallback.invoke();var i=a.evaluate(h.attempt);h.attempt++,h.timerHandle=oe.timer.setTimeout(freeOnUnref(function(){h.timerHandle=null,u.requested||f.registerMediaSegmentRequest(l,o)}),i)}))}),e.prototype.createRequestBuilder=freeOnUnref(function(e,t,n,r){if(e.requested)return null;var i=od.FragmentUtilities.getSegmentSizeBytes(r.selectedQualityLevel,r.selectedMediaSegmentInfo);if(0===i)return s.error("Received zero sizeBytes"),null;t.getApproximateResponseSizeBytes=freeOnUnref(function(){return i});n.diagnosticsTracker.requestStarted(r.priorityFunction(),4e3),this.reportStateChange();return this.fragmentRequestFactory.createMediaFragmentRequestBuilder(r.selectedMediaSegmentInfo,4e3,!0)}),e.prototype.onRequestSucceed=freeOnUnref(function(e){}),e.prototype.onRequestFailed=freeOnUnref(function(e,t){e.reason.type}),e.prototype.waitSegment=freeOnUnref(function(){var e=this,t=this.downloadQueue.claim();if(null!==t){var n=this.acquisitionToken;oe.timer.setTimeout(freeOnUnref(function(){e.started&&e.registerMediaSegmentRequest(t,n)}),0)}else this.downloadQueue.wait(freeOnUnref(function(){return e.waitSegment()}))}),e.prototype.getPriorityFunction=freeOnUnref(function(e){var t=this.prioritizationSystem.getAbsoluteCurrentPosition();return freeOnUnref(function(){return e.requested||null==t?1/0:t+3e4})}),e.prototype.addSegmentToBuffer=freeOnUnref(function(e,t,n,r,i,o,a){n.endTimeMs=Math.min(n.endTimeMs,t.period.endMs);var s={isInitSegment:!1,type:this.type,index:t.segment.index,isFinalSegment:t.isFinalSegment,periodId:t.period.id,streamId:t.stream.id,qualityLevelId:r.id,bitrateBps:r.bandwidth,position:n,presentationTimeOffsetMs:i,data:o,onFreed:a};this.segmentBuffer.addMediaFragment(s);var l=L.configurationStore.configuration,f=null!=l&&null!=l.dashLiveTrickplay&&!0===l.dashLiveTrickplay.enableLoadFromPlaybackPosition;return null==e.previousSegment||e.previousSegment.periodId===e.segment.period.id||f||this.segmentBuffer.linkSegment(e.previousSegment.periodId,e.previousSegment.index,t.period.id,t.segment.index),s}),e})();t.ImageStreamAcquirer=n}));e(Vm);Vm.ImageStreamAcquirer;var jm=t(freeOnUnref(function(e,t){var a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i){var o=this;this.minTargetSegmentDurationMs=0,this.lastExtendedTile=null,this.onNewPeriodsAvailable=freeOnUnref(function(){if(null!=o.lastExtendedTile){var e=o.periodAccessor.getPeriod(o.lastExtendedTile.period.id),t=o.liveHeadFragmentBuffer.getMediaFragment(o.lastExtendedTile.period.id,o.lastExtendedTile.segment.index);if(null!=t&&null!=e){var n=a({},t.position,{endTimeMs:Math.min(t.position.endTimeMs,e.endMs)});n.endTimeMs!==t.position.endTimeMs&&o.liveHeadFragmentBuffer.updateFragmentPosition(t,n)}}}),this.streamType=e,this.liveHeadFragmentBuffer=t,this.multiWaveStreamSelector=n,this.multiWaveStreamAlternator=r,this.periodAccessor=i}return e.prototype.start=freeOnUnref(function(){this.periodAccessor.on("newPeriodsAvailable",this.onNewPeriodsAvailable)}),e.prototype.stop=freeOnUnref(function(){this.lastExtendedTile=null,this.periodAccessor.off("newPeriodsAvailable",this.onNewPeriodsAvailable)}),e.prototype.setMinTargetSegmentDurationMs=freeOnUnref(function(e){this.minTargetSegmentDurationMs=e}),e.prototype.getExtendedSegmentPosition=freeOnUnref(function(e){var t=e.contentPosition.durationMs,n=this.multiWaveStreamAlternator.selectStream(this.multiWaveStreamSelector.selectStreams(e.period,this.streamType));return null!=n&&n.id===e.stream.id||t>=this.minTargetSegmentDurationMs?e.contentPosition:{startTimeMs:(this.lastExtendedTile=e).contentPosition.startTimeMs,durationMs:this.minTargetSegmentDurationMs,endTimeMs:e.contentPosition.startTimeMs+this.minTargetSegmentDurationMs}}),e})();t.LiveHeadTileExtender=n}));e(jm);jm.LiveHeadTileExtender;var qm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.qualityLevelFilter=e}return e.prototype.selectQuality=freeOnUnref(function(e){var t=(null!=this.qualityLevelFilter?this.qualityLevelFilter.filter(e.qualityLevels,e):{validQualities:e.qualityLevels}).validQualities;if(0===t.length)return null;var n=t[0];return{index:x.findIndex(e.qualityLevels,freeOnUnref(function(e){return e.id===n.id})),qualityLevel:n}}),e})();t.LowestBitrateQualitySelector=n}));e(qm);qm.LowestBitrateQualitySelector;var Hm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="MultiWave",r="LiveHead",i=["SegmentDownloadQueue.Image."+(t.MULTI_WAVE_SUFFIX=n),"ImageStreamAcquirer."+n,"SegmentDownloadQueue.Image."+(t.LIVE_HEAD_SUFFIX=r),"ImageStreamAcquirer."+r,"NetworkRequestManager.QueuedRequestPool"],o=freeOnUnref(function(){function e(){this.compositeState={}}return e.prototype.onEvent=freeOnUnref(function(e,t,n){"state"===t&&x.contains(i,e)&&(this.compositeState[e]=n)}),Object.defineProperty(e.prototype,"state",{get:freeOnUnref(function(){return this.compositeState.timestamp=Date.now(),this.compositeState}),enumerable:!0,configurable:!0}),e})();t.SeekPreviewDiagnosticsSink=o}));e(Hm);Hm.MULTI_WAVE_SUFFIX,Hm.LIVE_HEAD_SUFFIX,Hm.SeekPreviewDiagnosticsSink;var zm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a){this.segmentExtender=t,this.segmentInfoProducer=new zh.PrimarySegmentInfoProducer(e,r,a,o,n,i,new Oh.CompositeSegmentTimelineSelector(new vh.BaseQualitySegmentTimelineSelector)),this.periodAccessor=r,this.finalSegmentProduced=!1}return Object.defineProperty(e.prototype,"isFinalSegmentProduced",{get:freeOnUnref(function(){return this.finalSegmentProduced}),enumerable:!0,configurable:!0}),e.prototype.getSegmentAt=freeOnUnref(function(e,t){var n=this;return this.segmentInfoProducer.getSegmentAt(e,t).then(freeOnUnref(function(e){return t.throwIfRequested(),null!=e&&(e.contentPosition=n.segmentExtender.getExtendedSegmentPosition(e),e.period.endMs<=e.contentPosition.endTimeMs&&e.period.isFinalPeriod&&(e.isFinalSegment=!0)),e}))}),e.prototype.getNextSegment=freeOnUnref(function(t,n){var r=this;return this.checkFinalSegmentProduced(t)?lt.Promise.resolve(null):this.periodAccessor.getPeriodAt(t.contentPosition.endTimeMs).then(freeOnUnref(function(e){return n.throwIfRequested(),null==e?null:r.getSegmentAt(e.id===t.period.id?t.contentPosition.endTimeMs:e.startMs,n)})).then(freeOnUnref(function(e){return null==e&&r.checkFinalSegmentProduced(t),e}))}),e.prototype.checkFinalSegmentProduced=freeOnUnref(function(e){return!(!e.period.isFinalPeriod||!(e.isFinalSegment||e.period.endMs<=e.contentPosition.endTimeMs))&&(this.finalSegmentProduced=!0)}),e})();t.SegmentExtendingSegmentInfoProducer=n}));e(zm);zm.SegmentExtendingSegmentInfoProducer;var Wm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("SingleLevelTileAcquirer"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u){var c=this;this.started=!1,this.onMultiWaveQualityBufferUpdate=freeOnUnref(function(){var e=c.multiWaveQualityCompositeBuffer.getBufferedRanges().bounds();null!=e&&c.streamAcquirer.trimPendingAcquisitions(e.end)}),this.multiWaveQualityCompositeBuffer=i,this.qualitySelector=new qm.LowestBitrateQualitySelector(n),this.mediaRepresentation=u.mediaRepresentation,this.streamSelector=new vu.StreamSelector,this.streamSelector.setMatchers("Image",new vu.ImageStreamMatcher(n)),this.imageStreamAlternator=new vu.MinimumDurationImageStreamAlternator,this.liveHeadTileExtender=new jm.LiveHeadTileExtender(e,r,o,a,t);var d=new zm.SegmentExtendingSegmentInfoProducer(e,this.liveHeadTileExtender,u.acceptableSegmentPositionErrorMs,t,n,this.imageStreamAlternator,this.streamSelector),p=null!=l?[l]:[],h=new Wh.BlockingSegmentInfoProducer("Image",d,p);this.downloadQueue=new Kh.SegmentDownloadQueue(e,t,h,Hm.LIVE_HEAD_SUFFIX),null!=l&&l.setDownloadQueue(this.downloadQueue),this.streamAcquirer=new Vm.ImageStreamAcquirer(e,this.downloadQueue,r,s,f,u.eventEmitter,u.resourceAcquisitionMonitor,u.prioritizationSystem,this.qualitySelector,Hm.LIVE_HEAD_SUFFIX)}return Object.defineProperty(e.prototype,"isStarted",{get:freeOnUnref(function(){return this.started}),enumerable:!0,configurable:!0}),e.prototype.initialize=freeOnUnref(function(){this.imageStreamAlternator.initialize(Rm.getAllValidPeriodImageStreams(this.mediaRepresentation,this.streamSelector));var e=this.imageStreamAlternator.getMinSegmentDurationMs();null==e?i.warn(">> initialize could not find valid tiles to acquire near the live head."):i.info(">> initialize live head acquisition with "+e+" ms tiles")}),e.prototype.uninitialize=freeOnUnref(function(){this.imageStreamAlternator.uninitialize()}),e.prototype.setTargetTileDurationMs=freeOnUnref(function(e){this.liveHeadTileExtender.setMinTargetSegmentDurationMs(e)}),e.prototype.update=freeOnUnref(function(){var e=this.imageStreamAlternator.getMinSegmentDurationMs();this.imageStreamAlternator.uninitialize(),this.imageStreamAlternator.initialize(Rm.getAllValidPeriodImageStreams(this.mediaRepresentation,this.streamSelector));var t=this.imageStreamAlternator.getMinSegmentDurationMs();return e!==t&&(i.info(">> update live head acquisition to "+t+" ms tiles"),null==e||null==t)}),e.prototype.start=freeOnUnref(function(e){i.info(">> start from position "+e+" ms"),this.liveHeadTileExtender.start(),this.downloadQueue.start(e),this.streamAcquirer.start(),this.started=!0,this.multiWaveQualityCompositeBuffer.onUpdate(this.onMultiWaveQualityBufferUpdate)}),e.prototype.stop=freeOnUnref(function(){this.liveHeadTileExtender.stop(),this.downloadQueue.stop(),this.streamAcquirer.stop(),this.started=!1,this.multiWaveQualityCompositeBuffer.offUpdate(this.onMultiWaveQualityBufferUpdate)}),e.prototype.getTileInfo=freeOnUnref(function(e,t){var n=this.imageStreamAlternator.getMinSegmentDurationMs();if(null==n)return null;var r=Rm.getQualityLevelForSegmentDuration(e,n,this.qualitySelector);return null==r?(i.warn("Could not find a stream with segment duration "+n+" ms in the current MediaRepresentation."),null):t<n?{qualityLevel:r,effectiveTileDurationMs:n,effectiveBitrateBitsPerSec:r.bandwidth}:{qualityLevel:r,effectiveTileDurationMs:t,effectiveBitrateBitsPerSec:r.bandwidth/(t/n)}}),e.prototype.onSegmentSkipped=freeOnUnref(function(e){this.streamAcquirer.onSegmentSkipped(e)}),e.prototype.offSegmentSkipped=freeOnUnref(function(e){this.streamAcquirer.offSegmentSkipped(e)}),e})();t.SingleLevelTileAcquirer=n}));e(Wm);Wm.SingleLevelTileAcquirer;var Km=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){var n=this;this.trim=freeOnUnref(function(){n.buffer.trim(Qe.withDefault(n.mediaRepresentation.utcMsAtZero,0)+n.mediaRepresentation.timeWindow.startMs)}),this.buffer=e,this.mediaRepresentation=t}return e.prototype.start=freeOnUnref(function(){this.mediaRepresentation.periods.onChange(this.trim)}),e.prototype.stop=freeOnUnref(function(){this.mediaRepresentation.periods.offChange(this.trim)}),e})();t.TimeWindowBufferTrimmer=n}));e(Km);Km.TimeWindowBufferTrimmer;var Gm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.utcMsAtZero=e,this.period=t}return Object.defineProperty(e.prototype,"id",{get:freeOnUnref(function(){return this.period.id}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){return this.utcMsAtZero+this.period.startMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){return this.utcMsAtZero+this.period.endMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mediaWallClockUtcStartMs",{get:freeOnUnref(function(){return this.period.mediaWallClockUtcStartMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFinalPeriod",{get:freeOnUnref(function(){return this.period.isFinalPeriod}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"streams",{get:freeOnUnref(function(){return this.period.streams}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isResolved",{get:freeOnUnref(function(){return this.period.isResolved}),enumerable:!0,configurable:!0}),e.prototype.resolve=freeOnUnref(function(){return this.period.resolve()}),e.prototype.awaitForwardAccess=freeOnUnref(function(){return this.period.awaitForwardAccess()}),e})();t.OffsetPeriod=n}));e(Gm);Gm.OffsetPeriod;var Qm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("UntailoredPeriodAccessor"),n=freeOnUnref(function(){function e(e){var r=this;this.onPeriodUpdate=freeOnUnref(function(){for(var e=r.mediaRepresentation.periods.contents,t=r.periods;0<t.length&&t[0].id!==e[0].id;)delete r.periodIdMap[t[0].id],t.shift();if(t.length>e.length)a.error("New MediaRepresentation has removed periods from the leading edge!");else{for(var n=0;n<t.length&&t[n].id===e[n].id;)n++;if(n<t.length)a.error("New MediaRepresentation has replaced period "+t[n].id+" with "+e[n].id);else for(n<e.length&&r.eventEmitter.emit("newPeriodsAvailable");n<e.length;)t[n]=new Gm.OffsetPeriod(r.utcMsAtZero,e[n]),r.periodIdMap[t[n].id]=t[n],n++}}),this.utcMsAtZero=null==e.utcMsAtZero?0:e.utcMsAtZero,this.mediaRepresentation=e,this.eventEmitter=new A.EventEmitter,this.periods=[],this.periodIdMap={};for(var t=0,n=this.mediaRepresentation.periods.contents;t<n.length;t++){var i=n[t],o=new Gm.OffsetPeriod(this.utcMsAtZero,i);this.periods.push(o),this.periodIdMap[i.id]=o}}return e.prototype.initialize=freeOnUnref(function(){this.mediaRepresentation.periods.onChange(this.onPeriodUpdate)}),e.prototype.uninitialize=freeOnUnref(function(){this.mediaRepresentation.periods.offChange(this.onPeriodUpdate)}),e.prototype.getPeriod=freeOnUnref(function(e){var t=this.periodIdMap[e];return null==t?null:t}),e.prototype.getPeriodAt=freeOnUnref(function(e){for(var t=0,n=this.periods;t<n.length;t++){var r=n[t];if(e<r.endMs)return lt.Promise.resolve(r)}return lt.Promise.resolve(null)}),e.prototype.getNextPeriod=freeOnUnref(function(t){var e=this.periods,n=x.findIndex(e,freeOnUnref(function(e){return e.id===t.id}));return n<0||n>e.length-2?lt.Promise.resolve(null):lt.Promise.resolve(e[n+1])}),e.prototype.getPrevPeriod=freeOnUnref(function(t){var e=this.periods,n=x.findIndex(e,freeOnUnref(function(e){return e.id===t.id}));return n<=0?lt.Promise.resolve(null):lt.Promise.resolve(e[n-1])}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e})();t.UntailoredPeriodAccessor=n}));e(Qm);Qm.UntailoredPeriodAccessor;var Xm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(){}),n=freeOnUnref(function(){function e(e,t){var n=this;this.onInProgressBufferUpdate=freeOnUnref(function(){null==n.oldBuffer.buffer.getBufferedRanges().bounds()&&n.oldBuffer.onFreed()}),this.compositeImageSegmentBuffer=e,this.createNewBuffer=t,this.oldBuffer={buffer:e.getBackupBuffer(),onFreed:r,allottedSizeBytes:0},this.inProgressBuffer=this.createProgressBuffer(e.getMainBuffer())}return e.prototype.destroy=freeOnUnref(function(){this.oldBuffer.onFreed(),this.inProgressBuffer.onFreed(),this.compositeImageSegmentBuffer.flush(),this.compositeImageSegmentBuffer.destroy()}),e.prototype.getBufferedRangesInProgress=freeOnUnref(function(){return this.inProgressBuffer.buffer.getBufferedRanges()}),e.prototype.flushOldBuffer=freeOnUnref(function(){this.oldBuffer.buffer.flush(!0),this.oldBuffer.onFreed()}),e.prototype.completeInProgressBuffer=freeOnUnref(function(){this.oldBuffer.buffer.flush(!0),this.oldBuffer.onFreed(),this.oldBuffer=this.inProgressBuffer,this.oldBuffer.buffer.offUpdate(this.onInProgressBufferUpdate),this.inProgressBuffer=this.createProgressBuffer(this.createNewBuffer()),this.compositeImageSegmentBuffer.setBuffers(this.inProgressBuffer.buffer,this.oldBuffer.buffer)}),Object.defineProperty(e.prototype,"oldImageBuffer",{get:freeOnUnref(function(){return this.oldBuffer}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"progressImageBuffer",{get:freeOnUnref(function(){return this.inProgressBuffer}),enumerable:!0,configurable:!0}),e.prototype.setProgressBufferMetadata=freeOnUnref(function(e,t){var n=this.inProgressBuffer;n.onFreed(),n.allottedSizeBytes=t,n.onFreed=freeOnUnref(function(){e(),n.onFreed=r,n.allottedSizeBytes=0})}),e.prototype.createProgressBuffer=freeOnUnref(function(e){return e.onUpdate(this.onInProgressBufferUpdate),{buffer:e,onFreed:r,allottedSizeBytes:0}}),e})();t.MultiQualityImageBufferManager=n}));e(Xm);Xm.MultiQualityImageBufferManager;var Ym=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.createPeriodGapFill=freeOnUnref(function(e,t){var n=e.position.endTimeMs,r=t.position.startTimeMs,i=null;return 0<r-n&&(e.position.endTimeMs=t.position.startTimeMs,i={start:n,end:r}),i}),e.prototype.isPositionInFilledGap=freeOnUnref(function(e,t){return!1}),e.prototype.getFilledGapAtPeriodEnd=freeOnUnref(function(e){return null}),e.prototype.removeFilledGapAtPeriodEnd=freeOnUnref(function(e){return null}),e})();t.ImageSegmentPeriodGapHandler=n}));e(Ym);Ym.ImageSegmentPeriodGapHandler;var Jm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.downloadQueue=null,this.onChangeCallback=new A.MulticastCallback,this.liveHeadSegmentBuffer=e,this.targetTileStreamAlternator=t}return e.prototype.setDownloadQueue=freeOnUnref(function(e){this.downloadQueue=e}),e.prototype.canProduce=freeOnUnref(function(e){var t=this.targetTileStreamAlternator.getCurrentGranularityLevel();if(null==t)return{canProduce:!1,reason:"Cannot determine buffered range length limit"};var n=this.liveHeadSegmentBuffer.getBufferedRanges().bounds(),r=null!=n?n:{start:1/0,end:-1/0},i=null!=this.downloadQueue?this.downloadQueue.getQueuedRange(!0):null,o=null!=i?i:{startMs:1/0,endMs:-1/0},a=qh.clampInPeriodBoundary(e.period,e.contentPosition),s=Math.min(r.start,o.startMs,a.startTimeMs),l=Math.max(r.end,o.endMs,a.endTimeMs)-s;return t<l?{canProduce:!1,reason:"Image pending and buffered range is above the limit: "+l+" ms > "+t+" ms"}:{canProduce:!0}}),e.prototype.onChange=freeOnUnref(function(e){this.onChangeCallback.add(e)}),e.prototype.offChange=freeOnUnref(function(e){this.onChangeCallback.remove(e)}),e.prototype.onBufferedRangeUpdate=freeOnUnref(function(){this.onChangeCallback.invoke()}),e})();t.LiveHeadImageSegmentProductionBarrier=n}));e(Jm);Jm.LiveHeadImageSegmentProductionBarrier;var Zm=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.imageSegmentBuffer=e}return e.prototype.shouldAcquire=freeOnUnref(function(e,t,n){var r=this.imageSegmentBuffer.getMediaFragmentAt(t.startTimeMs);return null==r||r.periodId!==e.period.id||r.index!==e.segment.index||r.qualityLevelId!==n.qualityLevel.id||(this.imageSegmentBuffer.addMediaFragment(r),!1)}),e})();t.MultiQualityImageAcquisitionValidator=n}));e(Zm);Zm.MultiQualityImageAcquisitionValidator;var $m=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.imageSegmentBuffer=e}return e.prototype.shouldAcquire=freeOnUnref(function(e,t){var n=this.imageSegmentBuffer.getBufferedRanges().bounds();return!(null!=n&&n.end>=t.endTimeMs)}),e})();t.LiveHeadImageAcquisitionValidator=n}));e($m);$m.LiveHeadImageAcquisitionValidator;var ey=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.decorateSeekPreviewRestrictionsWithConfigurationRestrictions=function(e){if(void 0===e&&(e={}),null==L.configurationStore.configuration||null==L.configurationStore.configuration.dashLiveTrickplay||null==L.configurationStore.configuration.dashLiveTrickplay.maxTileResolutionPx)return e;var t=Qe.withDefault(e.maxTileResolutionPx,{}),n=L.configurationStore.configuration.dashLiveTrickplay.maxTileResolutionPx;return{maxTileResolutionCells:e.maxTileResolutionCells,maxTileResolutionPx:{height:Math.min(n.height,Qe.withDefault(t.height,1/0)),width:Math.min(n.width,Qe.withDefault(t.width,1/0))}}}}));e(ey);ey.decorateSeekPreviewRestrictionsWithConfigurationRestrictions;var ty=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o){this.log=new Ka.EphemeralJSLogger("TrickplaySegmentInfoProducer"),this.finalSegmentProduced=!1,this.allPreviousSegmentsLoaded=!1,this.lastQueryWasFront=!0,this.startPointer=null,this.endPointer=null,this.waitingSegmentCallback=new A.MulticastCallback,this.periodAccessor=t,this.streamSelector=n,this.streamAlternator=r,this.streamType=e,this.qualityLevelFilter=i,this.timelineSelector=o,this.log.setId(e)}return Object.defineProperty(e.prototype,"isFinalSegmentProduced",{get:freeOnUnref(function(){return this.finalSegmentProduced}),enumerable:!0,configurable:!0}),e.prototype.getSegmentAt=freeOnUnref(function(t,n){var r=this;return this.allPreviousSegmentsLoaded=!1,this.finalSegmentProduced=!1,this.periodAccessor.getPeriodAt(t).then(freeOnUnref(function(e){return n.throwIfRequested(),null==e?(r.log.warn("No initial period at "+t),null):r.findStartingSegment(e,t,n)})).then(freeOnUnref(function(e){return n.throwIfRequested(),null==e?(r.log.warn("No valid segment at "+t),null):(r.startPointer={index:e.segment.index,period:e.period},r.endPointer={index:e.segment.index,period:e.period},e)}))}),e.prototype.getNextSegment=freeOnUnref(function(e,n){var r=this;return e.segment.isFinalSegment&&e.period.isFinalPeriod?(this.finalSegmentProduced=!0,lt.Promise.resolve(null)):lt.Promise.resolve().then(freeOnUnref(function(){return n.throwIfRequested(),r.allPreviousSegmentsLoaded||!r.lastQueryWasFront?(r.lastQueryWasFront=!0,r.getAdjacentSegment(n,!0).then(freeOnUnref(function(e){return n.throwIfRequested(),null!=e?e:r.getBackwardsSegment(n)}))):r.getBackwardsSegment(n)})).then(freeOnUnref(function(e){if(n.throwIfRequested(),null==e)return e;var t=r.lastQueryWasFront?r.endPointer:r.startPointer;return null==t?null:(t.index=e.segment.index,t.period=e.period,e)}))}),e.prototype.onWaitingForSegment=freeOnUnref(function(e){this.waitingSegmentCallback.add(e)}),e.prototype.offWaitingForSegment=freeOnUnref(function(e){this.waitingSegmentCallback.remove(e)}),e.prototype.getBackwardsSegment=freeOnUnref(function(t){var n=this;return this.lastQueryWasFront=!1,this.getAdjacentSegment(t,!1).then(freeOnUnref(function(e){return t.throwIfRequested(),null==e?(n.allPreviousSegmentsLoaded=!0,n.lastQueryWasFront=!0,n.getAdjacentSegment(t,!0)):e}))}),e.prototype.findStartingSegment=freeOnUnref(function(r,i,o){var a=this;return this.getClosestSegmentLocator(r,o,!1).then(freeOnUnref(function(e){if(o.throwIfRequested(),null==e)return null;if(r===e.period){var t=e.timeline.getSequenceFromPosition(Math.max(i-r.startMs,0));return null==t?(a.log.warn("No sequence range available for timeline"),null):a.retrieveSegmentAtSequence(e.period,e.stream,e.timeline,t,o)}var n=e.timeline.getSequenceRange();return null==n?(a.log.warn("No sequence range available for timeline"),lt.Promise.resolve(null)):a.retrieveSegmentAtSequence(e.period,e.stream,e.timeline,n.endSequence,o)}))}),e.prototype.retrieveSegmentAtSequence=freeOnUnref(function(n,r,i,o,a){var s=this,e=this.createSegmentQueryCallback(i,o)();return("RefreshMe"===e.type?e.load():lt.Promise.resolve(e)).then(freeOnUnref(function(e){if(a.throwIfRequested(),"Unavailable"===e.type){if(null==e.etaMs)return lt.Promise.resolve(null);var t=e.etaMs;return s.findPreviousAvailableSegment(n,r,i,o,a).then(freeOnUnref(function(e){return null!=e?e:(s.waitingSegmentCallback.invoke(null),new lt.Delay(t,a).promise.then(freeOnUnref(function(){return a.throwIfRequested(),s.getSegmentAtSequence(n,r,i,o,a)})))}))}return{segment:e.segment,period:n,stream:r,contentPosition:qh.toContentRelative(n,e.segment.position,r.type),isFinalSegment:e.segment.isFinalSegment&&n.isFinalPeriod}}))}),e.prototype.findPreviousAvailableSegment=freeOnUnref(function(e,t,n,r,i){var o=r-1,a=n.getSequenceRange();return null!=a&&o>=a.startSequence&&o<=a.endSequence?this.retrieveSegmentAtSequence(e,t,n,o,i):this.getLastSegmentFromPreviousPeriod(e,i)}),e.prototype.getLastSegmentFromPreviousPeriod=freeOnUnref(function(e,n){var r=this;return this.periodAccessor.getPrevPeriod(e).then(freeOnUnref(function(e){return null==e?null:r.getClosestSegmentLocator(e,n,!1).then(freeOnUnref(function(e){if(null==e)return null;var t=e.timeline.getSequenceRange();return null==t?(r.log.warn("No sequence range available for timeline"),lt.Promise.resolve(null)):r.retrieveSegmentAtSequence(e.period,e.stream,e.timeline,t.endSequence,n)}))}))}),e.prototype.getSegmentAtSequence=freeOnUnref(function(e,t,n,r,i){var o=this;return Hh.waitSegment(this.createSegmentQueryCallback(n,r),e,t,i,freeOnUnref(function(){return o.waitingSegmentCallback.invoke(null)}),this.allPreviousSegmentsLoaded)}),e.prototype.createSegmentQueryCallback=freeOnUnref(function(t,n){return freeOnUnref(function(){var e=t.getSegmentFromSequence(n);return null==e?{type:"Unavailable",reason:"Segment "+n+" not available"}:e})}),e.prototype.getClosestSegmentLocator=freeOnUnref(function(e,t,n){var r=this,i=this.getSegmentLocator(e,t);return null!=i?lt.Promise.resolve(i):(n?this.periodAccessor.getNextPeriod(e):this.periodAccessor.getPrevPeriod(e)).then(freeOnUnref(function(e){return t.throwIfRequested(),null==e?null:r.getClosestSegmentLocator(e,t,n)}))}),e.prototype.getSegmentLocator=freeOnUnref(function(e,t){var n=this.streamSelector.selectStreams(e,this.streamType),r=this.streamAlternator.selectStream(n),i=null!=r?this.timelineSelector.selectTimeline(r,this.qualityLevelFilter,!1,[]):null,o=null!=i?i.getSequenceRange():null;return null==r||null==i||null==o?(this.log.warn("Period "+e.id+" returned no streams/timeline"),null):{period:e,stream:r,timeline:i,sequenceRange:o}}),e.prototype.getAdjacentSegment=freeOnUnref(function(e,t){var n=t?this.endPointer:this.startPointer;if(null==n)return lt.Promise.resolve(null);var r=t?n.index+1:n.index-1,i=this.getSegmentLocator(n.period,e);if(null==i)return lt.Promise.resolve(null);var o=i.sequenceRange;return null!=o&&o.startSequence<=r&&r<=o.endSequence?this.getSegmentAtSequence(i.period,i.stream,i.timeline,r,e):this.getAdjacentBoundarySegment(i.period,e,t)}),e.prototype.getAdjacentBoundarySegment=freeOnUnref(function(t,r,i){var o=this;return(i?this.periodAccessor.getNextPeriod(t):this.periodAccessor.getPrevPeriod(t)).then(freeOnUnref(function(e){return r.throwIfRequested(),null==e?(o.log.warn("No next period available. isForwardDirection: "+i+", period: "+t.id),null):o.getClosestSegmentLocator(e,r,i)})).then(freeOnUnref(function(e){if(r.throwIfRequested(),null==e)return null;var t=e.sequenceRange,n=i?t.startSequence:t.endSequence;return o.getSegmentAtSequence(e.period,e.stream,e.timeline,n,r)}))}),e})();t.TrickplaySegmentInfoProducer=n}));e(ty);ty.TrickplaySegmentInfoProducer;var ny=t(freeOnUnref(function(e,t){var h=ce&&ce.__assign||freeOnUnref(function(){return(h=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var m=de.get("SeekPreviewManager");function y(e){return{startTimeMs:e.position.startTimeMs,endTimeMs:e.position.endTimeMs,durationMs:e.position.durationMs,periodId:e.periodId,index:e.index}}var n=freeOnUnref(function(){function e(e){var n=this;this.seekPreviewState=null,this.eventEmitter=new A.EventEmitter,this.liveHeadProductionBarrier=null,this.enableLoadFromPlaybackPosition=!1,this.skippedTilesCount=0,this.stateMetricTimerHandle=null,this.timeToTrickplayAvailableTimer=null,this.currentPositionMs=0,this.onQualityChange=freeOnUnref(function(){n.stopAcquisition(),n.startAcquisition();var e=n.imageSegmentBuffer.getBufferedRanges().getIntervals();!n.liveHeadTileAcquirer.isStarted&&0<e.length&&n.liveHeadTileAcquirer.start(e[e.length-1].end)}),this.onQualityChangeComplete=freeOnUnref(function(){n.eventEmitter.emit("revokeSeekPreview")}),this.onMemoryCapacityReached=freeOnUnref(function(){n.stop()}),this.onBufferUpdate=freeOnUnref(function(){n.checkSeekPreviewStateChange(),null!=n.liveHeadProductionBarrier&&n.liveHeadProductionBarrier.onBufferedRangeUpdate(),!n.isImageCroppingSupported()&&n.liveHeadTileAcquirer.isStarted&&"Waiting"===n.imageQualityManager.currentState&&n.bufferReadyManager.isCurrentWaveBufferFull()&&n.liveHeadTileAcquirer.stop()}),this.onSegmentSkipped=freeOnUnref(function(){n.skippedTilesCount++,10<=n.skippedTilesCount&&(m.warn("Abandoning Trickplay due to too many failed requests."),q.metrics.putMetric("LiveTrickplay.TrickplayAbandoned.FailedRequests"),n.stop())}),this.checkSeekPreviewStateChange=freeOnUnref(function(){var e=n.bufferReadyManager.isBufferReadyForConsumption()?"Ready":"Waiting";e!==n.seekPreviewState&&(n.seekPreviewState=e,n.eventEmitter.emit("seekPreviewStateChange",n.seekPreviewState),"Ready"===e&&null!=n.timeToTrickplayAvailableTimer&&(n.timeToTrickplayAvailableTimer.end(),n.timeToTrickplayAvailableTimer=null))}),this.onTimeWindowUpdate=freeOnUnref(function(){n.downloadQueue.onPosition(n.timeWindow.startMs),n.checkSeekPreviewStateChange()}),this.onWaitingForSegment=freeOnUnref(function(e){var t=n.timeWindow.startMs;null!=e&&(t=qh.clampInPeriodBoundary(e.period,e.contentPosition).endTimeMs),n.liveHeadTileAcquirer.isStarted||n.liveHeadTileAcquirer.start(t),n.segmentInfoProducer.offWaitingForSegment(n.onWaitingForSegment)}),this.reportStateMetric=freeOnUnref(function(){if(q.metrics.putMetric("LiveTrickplay.WaitingState","Waiting"===n.seekPreviewState?1:0),"Waiting"===n.seekPreviewState){var e=n.imageSegmentBuffer.getMediaFragmentsInRange(0,1/0).map(y),t=h({},n.seekPreviewDiagnosticSink.state,{SeekPreviewBuffer:e});m.info("Unexpected SeekPreviewState: 'Waiting'. "+JSON.stringify(t,void 0,2))}}),this.streamType="Image";var t=e.mediaRepresentation;this.mediaRepresentation=t,this.timeWindow=e.timeWindow,this.rawAvailabilityWindowUtc=am.createRawAvailabilityWindowUtc(t),this.seekPreviewDiagnosticSink=new Hm.SeekPreviewDiagnosticsSink,this.seekPreviewRestriction=ey.decorateSeekPreviewRestrictionsWithConfigurationRestrictions(e.seekPreviewRestriction);var r=new km.CompositeImageQualityLevelFilter(25e4,this.seekPreviewRestriction.maxTileResolutionPx,this.seekPreviewRestriction.maxTileResolutionCells,1e4),i=new km.CompositeImageQualityLevelFilter(25e4,this.seekPreviewRestriction.maxTileResolutionPx,this.seekPreviewRestriction.maxTileResolutionCells),o=new qm.LowestBitrateQualitySelector(r);this.periodAccessor=new Qm.UntailoredPeriodAccessor(this.mediaRepresentation);var a=new Ym.ImageSegmentPeriodGapHandler,s=freeOnUnref(function(){return new dh.FragmentBuffer(n.streamType,e.segmentCacheFactory,a)}),l=new _m.CompositeImageSegmentBuffer(s(),s()),f=new Xm.MultiQualityImageBufferManager(l,s),u=s();this.imageSegmentBuffer=new _m.CompositeImageSegmentBuffer(l,u),this.bufferTrimmer=new Km.TimeWindowBufferTrimmer(this.imageSegmentBuffer,e.mediaRepresentation);var c=L.configurationStore.configuration;null!=c&&null!=c.dashLiveTrickplay&&!0===c.dashLiveTrickplay.enableLoadFromPlaybackPosition?(this.enableLoadFromPlaybackPosition=!0,q.metrics.putMetric("LiveTrickplay.LoadFromPlaybackPositionEnabled"),this.segmentInfoProducer=new ty.TrickplaySegmentInfoProducer(this.streamType,this.periodAccessor,e.streamSelector,e.imageStreamAlternator,r,new Oh.CompositeSegmentTimelineSelector(new vh.BaseQualitySegmentTimelineSelector))):this.segmentInfoProducer=new zh.PrimarySegmentInfoProducer(this.streamType,this.periodAccessor,e.streamSelector,e.imageStreamAlternator,e.acceptableSegmentPositionErrorMs,r,new Oh.CompositeSegmentTimelineSelector(new vh.BaseQualitySegmentTimelineSelector)),this.downloadQueue=new Kh.SegmentDownloadQueue(this.streamType,this.periodAccessor,this.segmentInfoProducer,Hm.MULTI_WAVE_SUFFIX),this.bufferReadyManager=new Mm.BufferReadyManager(this.imageSegmentBuffer,f,u,this.timeWindow);var d=new Pm.BufferedImageSegmentsTracker;this.multiWaveStreamAcquirer=new Vm.ImageStreamAcquirer(this.streamType,this.downloadQueue,this.imageSegmentBuffer,d,new Zm.MultiQualityImageAcquisitionValidator(this.imageSegmentBuffer),e.eventEmitter,e.resourceAcquisitionMonitor,e.prioritizationSystem,o,Hm.MULTI_WAVE_SUFFIX),this.isImageCroppingSupported()&&(this.liveHeadProductionBarrier=new Jm.LiveHeadImageSegmentProductionBarrier(u,e.imageStreamAlternator)),this.liveHeadTileAcquirer=new Wm.SingleLevelTileAcquirer(this.streamType,this.periodAccessor,i,u,l,e.streamSelector,e.imageStreamAlternator,d,this.liveHeadProductionBarrier,new $m.LiveHeadImageAcquisitionValidator(this.imageSegmentBuffer),e);var p=new Bm.ImageBufferReservationManager(e.mediaRepresentation,this.timeWindow,e.playerBufferManager,d);this.imageQualityManager=new Lm.ImageQualityManager(this.streamType,this.mediaRepresentation,f,this.imageSegmentBuffer,this.liveHeadTileAcquirer,e.streamSelector,e.imageStreamAlternator,p,this.periodAccessor,r,o,this.timeWindow,this.bufferReadyManager)}return e.prototype.start=freeOnUnref(function(e){this.currentPositionMs=e,this.imageQualityManager.initialize()&&(this.seekPreviewState="Waiting",this.eventEmitter.emit("seekPreviewExists"),this.imageQualityManager.on("qualityChange",this.onQualityChange),this.imageQualityManager.on("qualityChangeComplete",this.onQualityChangeComplete),this.imageQualityManager.on("memoryCapacityReached",this.onMemoryCapacityReached),this.imageSegmentBuffer.onUpdate(this.onBufferUpdate),this.mediaRepresentation.periods.onChange(this.onTimeWindowUpdate),this.multiWaveStreamAcquirer.onSegmentSkipped(this.onSegmentSkipped),this.liveHeadTileAcquirer.onSegmentSkipped(this.onSegmentSkipped),this.bufferTrimmer.start(),this.periodAccessor.initialize(),this.startAcquisition(),this.segmentInfoProducer.onWaitingForSegment(this.onWaitingForSegment),this.timeToTrickplayAvailableTimer=q.metrics.startTimer("LiveTrickplay.TimeToTrickplayAvailable"),null==this.stateMetricTimerHandle&&(this.stateMetricTimerHandle=oe.timer.setInterval(this.reportStateMetric,3e5)),nn.Diagnostics.addSink(this.seekPreviewDiagnosticSink))}),e.prototype.stop=freeOnUnref(function(){this.skippedTilesCount=0,(this.timeToTrickplayAvailableTimer=null)!=this.stateMetricTimerHandle&&(oe.timer.clearInterval(this.stateMetricTimerHandle),this.stateMetricTimerHandle=null),this.imageQualityManager.uninitialize(),this.imageSegmentBuffer.flush(),this.imageSegmentBuffer.destroy(),this.periodAccessor.uninitialize(),this.mediaRepresentation.periods.offChange(this.onTimeWindowUpdate),this.imageSegmentBuffer.offUpdate(this.onBufferUpdate),this.multiWaveStreamAcquirer.offSegmentSkipped(this.onSegmentSkipped),this.liveHeadTileAcquirer.offSegmentSkipped(this.onSegmentSkipped),this.bufferTrimmer.stop(),this.stopAcquisition(),this.segmentInfoProducer.offWaitingForSegment(this.onWaitingForSegment),this.liveHeadTileAcquirer.stop(),this.imageQualityManager.off("qualityChange",this.onQualityChange),this.imageQualityManager.off("qualityChangeComplete",this.onQualityChangeComplete),this.imageQualityManager.off("memoryCapacityReached",this.onMemoryCapacityReached),this.eventEmitter.emitSync("revokeSeekPreview"),"Ready"===this.seekPreviewState&&(this.seekPreviewState="Waiting",this.eventEmitter.emitSync("seekPreviewStateChange",this.seekPreviewState)),nn.Diagnostics.removeSink(this.seekPreviewDiagnosticSink)}),e.prototype.getTileAt=freeOnUnref(function(e){var t=this.imageSegmentBuffer.getMediaFragmentAt(e);return this.processSegment(t)}),e.prototype.getTilesInRange=freeOnUnref(function(e,t){for(var n=[],r=0,i=this.imageSegmentBuffer.getMediaFragmentsInRange(e,t);r<i.length;r++){var o=i[r],a=this.processSegment(o);null!=a&&n.push(a)}return n}),e.prototype.seekPreviewExists=freeOnUnref(function(){return null!=this.seekPreviewState}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.processSegment=freeOnUnref(function(e){if(null==e||null==e.data)return null;var t=gf.MediaRepresentationQuerier.for(this.mediaRepresentation).itemById(e.periodId).streamById(e.streamId).value();if(null==t)return m.warn("Unable to find image stream "+e.streamId+" at period "+e.periodId),null;var n=gf.MediaRepresentationQuerier.for(t).qualityLevelById(e.qualityLevelId).value();if(null==n)return m.warn("Unable to find image qualityLevel "+e.qualityLevelId+" at period "+e.periodId),null;var r=Nm.createTimeWindowBoundedTileSegmentPosition(this.rawAvailabilityWindowUtc,e.position);return{startTimeMs:r.startTimeMs,endTimeMs:r.endTimeMs,presentationTimeOffsetMs:null!=e.presentationTimeOffsetMs?e.presentationTimeOffsetMs:0,tileConfig:Rm.createTileConfig(t,n,r.durationMs),data:e.data}}),e.prototype.startAcquisition=freeOnUnref(function(){var e=this.currentPositionMs;this.enableLoadFromPlaybackPosition||(e=this.timeWindow.startMs),m.info(">> start acquisition from position (ms):",e),this.multiWaveStreamAcquirer.start(),this.downloadQueue.start(e)}),e.prototype.stopAcquisition=freeOnUnref(function(){this.multiWaveStreamAcquirer.stop(),this.downloadQueue.stop()}),e.prototype.isImageCroppingSupported=freeOnUnref(function(){return null==this.seekPreviewRestriction.maxTileResolutionCells||1<this.seekPreviewRestriction.maxTileResolutionCells.height||1<this.seekPreviewRestriction.maxTileResolutionCells.width}),e})();t.SeekPreviewManager=n}));e(ny);ny.SeekPreviewManager;var ry=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var d=de.get("AvailableSegmentInfoProducer");function p(e,t,n){return{segment:n,period:e,stream:t,contentPosition:qh.toContentRelative(e,n.position,t.type),isFinalSegment:n.isFinalSegment&&e.isFinalPeriod}}var n=freeOnUnref(function(){function e(e,t,n,r){this.mediaRepresentation=e,this.selectStream=t,this.selectTimeline=n,this.acceptableSegmentPositionErrorMs=r}return e.prototype.getSegmentAt=freeOnUnref(function(e){var t=this.getPeriodAt(e);if(null==t)return null;var n=this.selectStream(t);if(null==n)return d.info("Period "+t.id+" returned no Image streams"),null;var r=this.selectTimeline(n),i=this.getMediaSegmentInfoAt(t,r,e);return null==i?null:p(t,n,i)}),e.prototype.getSegmentsBetween=freeOnUnref(function(e,t){for(var n=[],r=0,i=this.getPeriodsBetween(e,t);r<i.length;r++){var o=i[r],a=this.selectStream(o);if(null!=a)for(var s=Math.min(t,o.endMs)-o.startMs,l=this.selectTimeline(a),f=this.getMediaSegmentInfoAt(o,l,e);null!=f&&f.position.startTimeMs<s;){var u=p(o,a,f);if(n.push(u),f.isFinalSegment)break;var c=this.getNextSegmentInPeriod(o,l,f,a);if(null==c){f=null;break}f=c.segment}else d.info("Period "+o.id+" returned no Image streams")}return n}),e.prototype.resolveSegmentQuery=freeOnUnref(function(e,t){return"Unavailable"===e.type?(null==e.etaMs&&d.warn("Unable to resolve Unavailable segment without ETA: "+t),null):"RefreshMe"===e.type?(e.load(),null):e.segment}),e.prototype.getNextSegmentInPeriod=freeOnUnref(function(e,t,n,r){var i=t.getNext(n),o=this.resolveSegmentQuery(i,"Next segment after "+n.index+" on period "+e.id);return null==o?null:p(e,r,o)}),e.prototype.getMediaSegmentInfoAt=freeOnUnref(function(e,t,n){var r=Math.max(n-e.startMs,0),i=t.getSegmentAt(r,this.acceptableSegmentPositionErrorMs),o=this.resolveSegmentQuery(i,"Segment at "+n+"ms ("+r+" period-relative) on period "+e.id);return null==o?null:o}),e.prototype.getPeriodAt=freeOnUnref(function(e){for(var t=0,n=this.mediaRepresentation.periods.contents;t<n.length;t++){var r=n[t];if(e<r.endMs)return r}return null}),e.prototype.getPeriodsBetween=freeOnUnref(function(e,t){for(var n=[],r=0,i=this.mediaRepresentation.periods.contents;r<i.length;r++){var o=i[r];if(t<o.startMs)break;e<o.endMs&&n.push(o)}return n}),e})();t.AvailableSegmentInfoProducer=n}));e(ry);ry.AvailableSegmentInfoProducer;var iy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("UrlReturningSeekPreviewManager"),n=freeOnUnref(function(){function e(e){var t=this;this.seekPreviewState=null,this.eventEmitter=new A.EventEmitter,this.streamType="Image",this.mediaRepresentation=e.mediaRepresentation,this.streamSelector=e.streamSelector,this.imageStreamAlternator=e.imageStreamAlternator,this.utcMsAtZero=null!=e.mediaRepresentation.utcMsAtZero?e.mediaRepresentation.utcMsAtZero:0;var n=ey.decorateSeekPreviewRestrictionsWithConfigurationRestrictions(e.seekPreviewRestriction);this.qualityLevelFilter=new km.CompositeImageQualityLevelFilter(1/0,n.maxTileResolutionPx,n.maxTileResolutionCells),this.qualitySelector=new qm.LowestBitrateQualitySelector(this.qualityLevelFilter),this.timelineSelector=new vh.BaseQualitySegmentTimelineSelector,this.rawAvailabilityWindowUtc=am.createRawAvailabilityWindowUtc(e.mediaRepresentation),this.segmentInfoProducer=new ry.AvailableSegmentInfoProducer(e.mediaRepresentation,freeOnUnref(function(e){return t.selectStream(e)}),freeOnUnref(function(e){return t.selectTimeline(e)}),e.acceptableSegmentPositionErrorMs)}return e.prototype.start=freeOnUnref(function(){this.streamSelector.setMatchers("Image",new vu.ImageStreamMatcher(this.qualityLevelFilter)),this.imageStreamAlternator.initialize(Rm.getAllValidPeriodImageStreams(this.mediaRepresentation,this.streamSelector)),this.imageStreamAlternator.selectMaxGranularity(),null!=this.imageStreamAlternator.getCurrentGranularityLevel()?(this.seekPreviewState="Ready",this.eventEmitter.emitSync("seekPreviewStateChange",this.seekPreviewState),this.eventEmitter.emit("seekPreviewExists")):f.info("Trickplay failed to initialize: Could not find any valid Trickplay streams.")}),e.prototype.stop=freeOnUnref(function(){this.eventEmitter.emitSync("revokeSeekPreview"),"Ready"===this.seekPreviewState&&(this.seekPreviewState="Waiting",this.eventEmitter.emitSync("seekPreviewStateChange",this.seekPreviewState))}),e.prototype.getTileAt=freeOnUnref(function(e){var t=e-this.utcMsAtZero,n=this.segmentInfoProducer.getSegmentAt(t);if(null==n)return null;var r=n.stream,i=n.segment;return this.createSeekPreviewTile(n.period,r,i)}),e.prototype.getTilesInRange=freeOnUnref(function(e,t){for(var n=Math.max(e,this.rawAvailabilityWindowUtc.startMs),r=Math.min(t,this.rawAvailabilityWindowUtc.endMs),i=n-this.utcMsAtZero,o=r-this.utcMsAtZero,a=[],s=0,l=this.segmentInfoProducer.getSegmentsBetween(i,o);s<l.length;s++){var f=l[s],u=f.stream,c=f.segment,d=this.createSeekPreviewTile(f.period,u,c);null!=d&&a.push(d)}return a}),e.prototype.seekPreviewExists=freeOnUnref(function(){return null!=this.seekPreviewState}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.createSeekPreviewTile=freeOnUnref(function(e,t,n){var r=this.qualitySelector.selectQuality(t);if(null==r)return f.warn("Segment "+n.index+" in period "+e.id+" got requested despite not having any valid quality levels."),null;var i=r.qualityLevel,o=qh.toContentRelative(e,n.position,t.type),a=Nm.createPeriodBoundedTileSegmentPosition(e,o),s=a.startTimeMs-o.startTimeMs,l=n.sourceUrl.url;return{startTimeMs:a.startTimeMs+this.utcMsAtZero,endTimeMs:a.endTimeMs+this.utcMsAtZero,presentationTimeOffsetMs:s,tileConfig:Rm.createTileConfig(t,i,a.durationMs),data:l}}),e.prototype.selectStream=freeOnUnref(function(e){var t=this.streamSelector.selectStreams(e,this.streamType);return this.imageStreamAlternator.selectStream(t)}),e.prototype.selectTimeline=freeOnUnref(function(e){return this.timelineSelector.selectTimeline(e,this.qualityLevelFilter)}),e})();t.UrlReturningSeekPreviewManager=n}));e(iy);iy.UrlReturningSeekPreviewManager;var oy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.create=freeOnUnref(function(e){if(e.mediaRepresentation instanceof ih.PlaylistedMediaRepresentation)return new bm.NoOpSeekPreviewManager;if(!function(e){for(var t=0,n=e.periods.contents;t<n.length;t++)for(var r=0,i=n[t].streams;r<i.length;r++)if("Image"===i[r].type)return!0;return!1}(e.mediaRepresentation))return new bm.NoOpSeekPreviewManager;var t=L.configurationStore.configuration;return null==t||null==t.dashLiveTrickplay||"http"!==t.dashLiveTrickplay.tileDataResponseType?new ny.SeekPreviewManager(e):new iy.UrlReturningSeekPreviewManager(e)}),e})();t.SeekPreviewManagerFactory=n}));e(oy);oy.SeekPreviewManagerFactory;var ay=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.trackedSegments={}}return e.prototype.trackSegment=freeOnUnref(function(e,t){null==this.trackedSegments[e.periodId]&&(this.trackedSegments[e.periodId]={});var n=this.trackedSegments[e.periodId];if(null==n[e.index]){var r=new lt.Deferred;n[e.index]={contentPosition:e.contentPosition,deferredQualityLevel:r},t.promise.then(freeOnUnref(function(){return r.reject(new lt.CancelError)}))}}),e.prototype.addSegmentQualityLevel=freeOnUnref(function(e,t){var n=this.trackedSegments[e.periodId];if(null!=n){var r=n[e.index];null!=r&&r.deferredQualityLevel.resolve(t)}}),e.prototype.getSegmentQualityLevel=freeOnUnref(function(e){var t=this.trackedSegments[e.periodId];if(null==t)return lt.Promise.resolve(null);var n=t[e.index];return null==n?lt.Promise.resolve(null):n.deferredQualityLevel.promise}),e.prototype.flush=freeOnUnref(function(){for(var e=0,t=Object.keys(this.trackedSegments);e<t.length;e++)for(var n=t[e],r=0,i=Object.keys(this.trackedSegments[n]);r<i.length;r++){var o=i[r];this.trackedSegments[n][o].deferredQualityLevel.reject(new lt.CancelError)}this.trackedSegments={}}),e.prototype.trim=freeOnUnref(function(e){for(var t=0,n=Object.keys(this.trackedSegments);t<n.length;t++){for(var r=n[t],i=0,o=Object.keys(this.trackedSegments[r]);i<o.length;i++){var a=o[i],s=this.trackedSegments[r][a];s.contentPosition.endTimeMs<=e&&(s.deferredQualityLevel.reject(new lt.CancelError),delete this.trackedSegments[r][a])}0===Object.keys(this.trackedSegments[r]).length&&delete this.trackedSegments[r]}}),e})();t.SegmentQualityLevelTracker=n}));e(ay);ay.SegmentQualityLevelTracker;var sy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("HdcpComplianceStreamRestarter"),o=["output-downscaled","output-not-allowed","output-restricted"],n=freeOnUnref(function(){function e(e,t,n){var r=this;this.keyMetadataMap={},this.onKeyStatusChange=freeOnUnref(function(e){var t=e.status,n=e.keyId;null!=r.keyMetadataMap[n]&&(r.isStreamQualityAboveThreshold(r.mediaRepresentation)&&(-1===o.indexOf(t)||(i.warn("Triggering a Video stream restart to SD due to keyStatus="+t),r.eventEmitter.emit("streamRestartNeeded",{videoQuality:"SD"}),q.metrics.putMetric("StreamFlush.HdcpRestarter"))))}),this.eventEmitter=e,this.mediaKeysManager=t,this.mediaRepresentation=n;L.configurationStore.configuration;q.metrics.putMetric("HdcpComplianceStreamRestarter.Created")}return e.prototype.start=freeOnUnref(function(){this.mediaKeysManager.on("keyStatusChange",this.onKeyStatusChange)}),e.prototype.stop=freeOnUnref(function(){this.mediaKeysManager.off("keyStatusChange",this.onKeyStatusChange)}),e.prototype.updateHdcpStatus=freeOnUnref(function(e,t){}),e.prototype.updateKeyMetadata=freeOnUnref(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];"CONTENT"===r.keyType&&(this.keyMetadataMap[r.id]=r)}}),e.prototype.isStreamQualityAboveThreshold=freeOnUnref(function(e){for(var t=0,n=e.periods.contents;t<n.length;t++){var r=n[t];if(r.isResolved)for(var i=0,o=r.streams;i<o.length;i++){var a=o[i];if("Video"===a.type)for(var s=0,l=a.qualityLevels;s<l.length;s++){var f=l[s];if(this.isVideoQualityLevelAboveThreshold(f))return!0}}}return!1}),e.prototype.isVideoQualityLevelAboveThreshold=freeOnUnref(function(e){var t=e.width,n=void 0===t?0:t,r=e.height;return 52e4<n*(void 0===r?0:r)}),e})();t.HdcpComplianceStreamRestarter=n}));e(sy);sy.HdcpComplianceStreamRestarter;var ly=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("PixelCountVideoQualityLevelFilter"),n=freeOnUnref(function(){function e(){var t=this;this.internalPixelConstraint=Number.MAX_VALUE,this.isValidResolution=freeOnUnref(function(e){return null!=e.height&&null!=e.width&&e.height*e.width<=t.internalPixelConstraint})}return Object.defineProperty(e.prototype,"pixelConstraint",{get:freeOnUnref(function(){return this.internalPixelConstraint}),set:freeOnUnref(function(e){this.internalPixelConstraint=e,i.warn("Maximum amount of pixels allowed is "+this.internalPixelConstraint+".")}),enumerable:!0,configurable:!0}),e.prototype.resetPixelConstraint=freeOnUnref(function(){this.internalPixelConstraint!==Number.MAX_VALUE&&(this.internalPixelConstraint=Number.MAX_VALUE,i.info("Amount of pixels is not constrained."))}),e.prototype.isPixelConstrained=freeOnUnref(function(){return this.internalPixelConstraint!==Number.MAX_VALUE}),e.prototype.filter=freeOnUnref(function(e,t){if(this.internalPixelConstraint===Number.MAX_VALUE||null==t.contentProtections||0===t.contentProtections.length)return{validQualities:e};var n=e.filter(this.isValidResolution);if(0===n.length&&i.error("All available video qualities are above pixel constraint."),n.length===e.length)return{validQualities:e};var r=n.reduce(freeOnUnref(function(e,t){return Math.max(e,t.bandwidth)}),0);return{validQualities:n,maxBitrateBitsPerSec:r}}),e.prototype.isValidQuality=freeOnUnref(function(e,t){return this.internalPixelConstraint===Number.MAX_VALUE||null==t.contentProtections||0===t.contentProtections.length||this.isValidResolution(e)}),e})();t.PixelCountVideoQualityLevelFilter=n}));e(ly);ly.PixelCountVideoQualityLevelFilter;var fy=t(freeOnUnref(function(e,t){var n,o=ce&&ce.__assign||freeOnUnref(function(){return(o=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var a={hdcp:"1.4",hdcpEnforcementResolutionPixels:52e4},s=((n={}).HDCP_NONE="0",n.HDCP_V1="1.4",n.HDCP_V2_2="2.2",n),l=de.get("HdcpRestrictionEnforcer"),r=freeOnUnref(function(){function e(e,t,n,r,i){this.hdcpLicensePolicy=o({},a),this.pixelCountVideoQualityLevelFilter=new ly.PixelCountVideoQualityLevelFilter,e.addFilter(this.pixelCountVideoQualityLevelFilter),t.addFilter(this.pixelCountVideoQualityLevelFilter),this.videoSegmentMonitor=n,this.notifyRestrictionChange=r,this.triggerStreamRestart=i}return e.prototype.start=freeOnUnref(function(){}),e.prototype.stop=freeOnUnref(function(){}),e.prototype.updateHdcpStatus=freeOnUnref(function(e,t){null==this.hdcpLicensePolicy.hdcpEnforcementResolutionPixels||ea.HdcpStore.compareHdcpStatuses(e,this.hdcpLicensePolicy.hdcp)?this.clearHdcpEnforcementResolutionPixels(t):this.setHdcpEnforcementResolutionPixels(t,this.hdcpLicensePolicy.hdcpEnforcementResolutionPixels)}),e.prototype.updateKeyMetadata=freeOnUnref(function(e){for(var t=0,n=0,r=e;n<r.length;n++){var i=r[n];if("CONTENT"===i.keyType){t++;var o=i.hdcp;if(null!=o&&null!=o.hdcpEnforcementResolutionPixels){var a=s[o.hdcp];return null==a?void l.error("Content license policy requires unsupported HDCP level "+o.hdcp+". Keep using default license policy instead."):void this.updateHdcpLicensePolicy({hdcp:a,hdcpEnforcementResolutionPixels:o.hdcpEnforcementResolutionPixels})}}}0<t&&this.updateHdcpLicensePolicy({hdcp:s.HDCP_NONE})}),e.prototype.setHdcpEnforcementResolutionPixels=freeOnUnref(function(e,t){var n=this.pixelCountVideoQualityLevelFilter.pixelConstraint;if(this.pixelCountVideoQualityLevelFilter.pixelConstraint=t,!e&&this.pixelCountVideoQualityLevelFilter.isPixelConstrained()&&this.videoSegmentMonitor.checkResolutionPixels(t)&&(l.warn("Video stream is restricted. Triggering restart."),q.metrics.putMetric("StreamFlush.Hdcp"),this.triggerStreamRestart("Video")),n!==t||e){var r={streamType:"Video",restrictionType:"Hdcp",hdcpEnforcementResolutionPixels:t};this.notifyRestrictionChange("Video","Hdcp",r)}}),e.prototype.clearHdcpEnforcementResolutionPixels=freeOnUnref(function(e){var t=this.pixelCountVideoQualityLevelFilter.isPixelConstrained();this.pixelCountVideoQualityLevelFilter.resetPixelConstraint(),(t||e)&&this.notifyRestrictionChange("Video","Hdcp",null)}),e.prototype.updateHdcpLicensePolicy=freeOnUnref(function(e){this.hdcpLicensePolicy.hdcp!==e.hdcp&&l.info("Content license policy updated to",JSON.stringify(e)),this.hdcpLicensePolicy=e}),e})();t.HdcpRestrictionEnforcer=r}));e(fy);fy.HdcpRestrictionEnforcer;var uy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.start=freeOnUnref(function(){}),e.prototype.stop=freeOnUnref(function(){}),e.prototype.updateHdcpStatus=freeOnUnref(function(e,t){}),e.prototype.updateKeyMetadata=freeOnUnref(function(e){}),e})();t.NullRestrictionEnforcer=n}));e(uy);uy.NullRestrictionEnforcer;var cy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("RendererCapabilityFilter");var n=freeOnUnref(function(){function e(e){this.rendererCapabilityStore=e}return e.prototype.filter=freeOnUnref(function(e,t){var n=this,r=e.filter(freeOnUnref(function(e){return n.isValidQuality(e,t)}));if(r.length===e.length)return{validQualities:e};var i=r.reduce(freeOnUnref(function(e,t){return Math.max(e,t.bandwidth)}),0);return{validQualities:r,maxBitrateBitsPerSec:i}}),e.prototype.isValidQuality=freeOnUnref(function(e,t){return this.rendererCapabilityStore.canRender(e.width,e.height,lm.RendererCapabilitiesUtils.parseFrameRate(e.frameRate))}),e})();t.RendererCapabilityFilter=n}));e(cy);cy.RendererCapabilityFilter;var dy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.from=freeOnUnref(function(e){var t=this.determineVideoQuality(e.height),n=this.determineFrameRate(e.hdcpStatus,t);return"UHD"===t&&"HFR"===n?null:{streamType:"Video",restrictionType:"RendererCapability",videoQualityToMaxSupportedFrameRate:this.createRestrictedQualities(t,n)}}),e.determineVideoQuality=freeOnUnref(function(e){return e>this.MAX_HD_HEIGHT?"UHD":e>this.MAX_SD_HEIGHT?"HD":"SD"}),e.determineFrameRate=freeOnUnref(function(e,t){return"UHD"===t?"2.2"===e?"HFR":"SFR":"HFR"}),e.createRestrictedQualities=freeOnUnref(function(e,t){var n,r,i;switch(e){case"UHD":return(n={}).UHD=t,n.HD="HFR",n.SD="HFR",n;case"HD":return(r={UHD:null}).HD=t,r.SD="HFR",r;case"SD":return(i={UHD:null,HD:null}).SD=t,i}}),e.MAX_HD_HEIGHT=1080,e.MAX_SD_HEIGHT=480,e})();t.RendererCapabilityStreamRestrictionFactory=n}));e(dy);dy.RendererCapabilityStreamRestrictionFactory;var py=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){void 0===e&&(e=new A.EventEmitter),this.deviceDisplayWidth=zt.deviceCapabilities.output.video.display.width,this.deviceDisplayHeight=zt.deviceCapabilities.output.video.display.height,this.eventEmitter=e,this.internalHdcpStatus=t}return e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.canRender=freeOnUnref(function(e,t,n){return null!=t&&null!=n&&(n>lm.RendererCapabilitiesUtils.getMaxFrameRate("SFR")?this.canRenderHFR(t):this.canRenderSFR(t))}),e.prototype.canRenderHFR=freeOnUnref(function(e){var t=this.canRenderSFR(e);return t&&e>lm.RendererCapabilitiesUtils.getMaxHeight("HD")?"2.2"===this.internalHdcpStatus:t}),e.prototype.canRenderSFR=freeOnUnref(function(e){return!0}),Object.defineProperty(e.prototype,"hdcpStatus",{set:freeOnUnref(function(e){this.internalHdcpStatus!==e&&(this.internalHdcpStatus=e,this.eventEmitter.emit("RendererCapabilitiesChange",{streamRestriction:dy.RendererCapabilityStreamRestrictionFactory.from({hdcpStatus:this.internalHdcpStatus,height:this.deviceDisplayHeight,width:this.deviceDisplayWidth})}))}),enumerable:!0,configurable:!0}),e})();t.RendererCapabilitiesStore=n}));e(py);py.RendererCapabilitiesStore;var hy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("ResolutionBasedVideoQualityFilter"),n=freeOnUnref(function(){function e(e,t,n){void 0===t&&(t="ApplicationViewportSize"),void 0===n&&(n=720),this.pixelHeightCeiling=n,this.resolutionCappingStrategy=t,this.viewHeight=zt.deviceCapabilities.output.video.applicationViewport.height,this.viewWidth=zt.deviceCapabilities.output.video.applicationViewport.width,this.playerViewportCallback=e}return e.prototype.filter=freeOnUnref(function(e,t){var n=this;this.updateViewportDetails();for(var r=null,i=0,o=e;i<o.length;i++){var a=o[i];null!=a.height&&720===a.height&&(null===r||a.bandwidth<r.bandwidth)&&(r=a)}var s=e.filter(freeOnUnref(function(e){return null!==r&&e.id===r.id||n.isValidResolution(e)}));if(s.length===e.length)return{validQualities:e};var l=s.reduce(freeOnUnref(function(e,t){return Math.max(e,t.bandwidth)}),0);return{validQualities:s,maxBitrateBitsPerSec:l}}),e.prototype.isValidQuality=freeOnUnref(function(e,t){return this.updateViewportDetails(),this.isValidResolution(e)}),e.prototype.isValidResolution=freeOnUnref(function(e){var t=null!=e.height&&e.height<=this.viewHeight&&null!=e.width&&e.width<=this.viewWidth;return null!=e.height&&e.height<this.pixelHeightCeiling||t}),e.prototype.updateViewportDetails=freeOnUnref(function(){var e,t,n=null;if("PlayerViewportSize"===this.resolutionCappingStrategy&&(n=this.playerViewportCallback()),null!=n)e=n.height,t=n.width;else{var r=zt.deviceCapabilities.output.video.applicationViewport;e=r.height,t=r.width}e===this.viewHeight&&t===this.viewWidth||(this.viewHeight=e,this.viewWidth=t,i.info("Viewport resolution is changed to "+this.viewWidth+"x"+this.viewHeight+"."))}),e})();t.ResolutionBasedVideoQualityFilter=n}));e(hy);hy.ResolutionBasedVideoQualityFilter;var my=t(freeOnUnref(function(e,t){var n,S,U=ce&&ce.__assign||freeOnUnref(function(){return(U=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.Playback=0]="Playback",e[e.Caching=1]="Caching"})(S||(S={})),t.StreamRestrictionsContext=S;var o=de.get("StreamRestrictionsManager"),b=((n={}).AppendTimeRatio=null,n.External=null,n.FrameDropRate=null,n.UnexpectedWaiting=null,n.ExternalNetwork=null,n),r=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c){var d,p,h,m=this;this.cancelUpdateRestrictions=null,this.isStarted=!1,this.maxBitrateThresholdFilters=((d={}).Audio=U({},b),d.TimedText=U({},b),d.Video=U({},b),d),this.playbackRestrictionFilters=((p={}).Video=new um.CompositeFilter,p),this.restrictionPromise=lt.Promise.resolve(),this.playbackRestrictions=((h={}).Hdcp=null,h.RendererCapability=null,h),this.createHdcpCompliance=freeOnUnref(function(n,r,e,t,i){if(m.streamRestrictionsContext===S.Caching)return lt.Promise.resolve(new uy.NullRestrictionEnforcer);var o=L.configurationStore.configuration,a=null!=i&&null!=o&&null!=o.hdcpComplianceStreamRestarter&&null!=o.hdcpComplianceStreamRestarter.keySystems&&Array.isArray(o.hdcpComplianceStreamRestarter.keySystems)?o.hdcpComplianceStreamRestarter.keySystems:[],s=freeOnUnref(function(){return new fy.HdcpRestrictionEnforcer(m.downloadFilters.Video,m.playbackRestrictionFilters.Video,t,m.updateStreamRestriction,e)});return 0===a.length?lt.Promise.resolve(s()):ea.MediaKeysManager.getMediaKeys().then(freeOnUnref(function(e){var t=e.system;return-1===a.indexOf(t)?s():new sy.HdcpComplianceStreamRestarter(n,i,r)}))}),this.onHdcpStatusChanged=freeOnUnref(function(){m.restrictionPromise=m.updateHdcpRestriction()}),this.updateStreamRestriction=freeOnUnref(function(e,t,n){m.playbackRestrictions[t]=n,m.notifyPlaybackRestrictionChange(e),m.reportDiagnostics()}),this.onRendererCapabilityChange=freeOnUnref(function(e){var t=m.playbackRestrictions.RendererCapability,n=e.streamRestriction;m.isSameRendererRestriction(t,n)||m.updateStreamRestriction("Video","RendererCapability",n)}),this.downloadFilters=e,this.hdcpStore=f,this.notifyPlaybackRestrictionChange=n,this.streamRestrictionsContext=l,this.createHdcpCompliancePromise=this.createHdcpCompliance(s,a,r,t,u),this.diagnostics=nn.Diagnostics.create("StreamRestrictionsManager"),e.Video.addFilter(new hy.ResolutionBasedVideoQualityFilter(i,c)),this.rendererCapabilitiesStore=new py.RendererCapabilitiesStore;var y=new cy.RendererCapabilityFilter(this.rendererCapabilitiesStore);this.downloadFilters.Video.addFilter(y),this.playbackRestrictionFilters.Video.addFilter(y);var g=1/0;null!=zt.deviceInformation.mediaSource&&null!=zt.deviceInformation.mediaSource.maxVideoBitrate&&(g=Math.min(g,zt.deviceInformation.mediaSource.maxVideoBitrate));var v=o.playbackSettings;if(null!=v.filters&&null!=v.filters.maxBitrateKbps&&(g=Math.min(g,1e3*v.filters.maxBitrateKbps)),isFinite(g)){var O=new Cm.BitrateCapFilter(g);this.downloadFilters.Video.addFilter(O)}}return e.prototype.setMaxBitrateThreshold=freeOnUnref(function(e,t,n){var r=this.maxBitrateThresholdFilters[e][t];if(null!==r){if(n===r.maxBitrateBitsPerSec)return;this.downloadFilters[e].removeFilter(r)}if(n===1/0)null!==r&&(o.info("["+e+"]["+t+"] MaxBitrateThreshold filter removed."),this.maxBitrateThresholdFilters[e][t]=null);else{o.info("["+e+"]["+t+"] MaxBitrateThreshold filter set to "+n+" bits/sec.");var i=new Cm.BitrateCapFilter(n);this.maxBitrateThresholdFilters[e][t]=i,this.downloadFilters[e].addFilter(i)}}),e.prototype.start=freeOnUnref(function(){this.isStarted?o.warn("Attempted to start while already started"):(this.isStarted=!0,this.streamRestrictionsContext!==S.Caching&&null!=this.hdcpStore&&this.hdcpStore.on("hdcpStatusChange",this.onHdcpStatusChanged),this.rendererCapabilitiesStore.on("RendererCapabilitiesChange",this.onRendererCapabilityChange),this.restrictionPromise=this.updateHdcpRestriction(!0),this.createHdcpCompliancePromise.then(freeOnUnref(function(e){e.start()})).catch(freeOnUnref(function(e){o.error("Error executing HDCP compliance promise",e)})))}),e.prototype.stop=freeOnUnref(function(){this.isStarted=!1,this.streamRestrictionsContext!==S.Caching&&null!=this.hdcpStore&&this.hdcpStore.off("hdcpStatusChange",this.onHdcpStatusChanged),this.rendererCapabilitiesStore.off("RendererCapabilitiesChange",this.onRendererCapabilityChange),null!==this.cancelUpdateRestrictions&&this.cancelUpdateRestrictions(),this.createHdcpCompliancePromise.then(freeOnUnref(function(e){e.stop()})).catch(freeOnUnref(function(e){o.error("Error executing HDCP compliance promise",e)}))}),e.prototype.awaitRestrictionResolution=freeOnUnref(function(){return this.restrictionPromise}),e.prototype.getPlaybackRestrictions=freeOnUnref(function(){return this.playbackRestrictions}),e.prototype.getPlaybackRestrictionFilters=freeOnUnref(function(){return this.playbackRestrictionFilters}),e.prototype.updateKeyMetadata=freeOnUnref(function(t){this.createHdcpCompliancePromise.then(freeOnUnref(function(e){e.updateKeyMetadata(t)})).catch(freeOnUnref(function(e){o.error("Error executing HDCP compliance promise",e)})),this.restrictionPromise=this.updateHdcpRestriction()}),e.prototype.updateHdcpRestriction=freeOnUnref(function(n){var e=this;if(void 0===n&&(n=!1),null!==this.cancelUpdateRestrictions&&this.cancelUpdateRestrictions(),this.streamRestrictionsContext===S.Caching||null==this.hdcpStore)return lt.Promise.resolve();var t=lt.CancelToken.source(),r=t.token,i=t.cancel;return this.cancelUpdateRestrictions=i,this.hdcpStore.getHdcpStatus().then(freeOnUnref(function(t){r.throwIfRequested(),e.cancelUpdateRestrictions=null,e.rendererCapabilitiesStore.hdcpStatus=t,e.createHdcpCompliancePromise.then(freeOnUnref(function(e){e.updateHdcpStatus(t,n)})).catch(freeOnUnref(function(e){o.error("Error executing HDCP compliance promise",e)}))})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||o.error(e.message)}))}),e.prototype.isSameRendererRestriction=freeOnUnref(function(e,t){return null===e?null===t:null===t?null===e:x.isEqual(e.videoQualityToMaxSupportedFrameRate,t.videoQualityToMaxSupportedFrameRate)}),e.prototype.reportDiagnostics=freeOnUnref(function(){this.diagnostics.report("state",{playbackRestrictions:this.playbackRestrictions,timestamp:Date.now()})}),e})();t.StreamRestrictionsManager=r}));e(my);my.StreamRestrictionsContext,my.StreamRestrictionsManager;var yy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i){this.type=e,this.fragmentBuffer=t,this.streamAcquirer=n,this.mediaRepresentation=r,this.getPreferredStream=i}return e.prototype.hasUnpreferredStream=freeOnUnref(function(){return!!this.hasUnpreferredDownloadedSegment()||this.hasUnpreferredDownloadingSegment()}),e.prototype.hasUnpreferredDownloadedSegment=freeOnUnref(function(){for(var e=0,t=this.fragmentBuffer.getBufferedStreamMetadata();e<t.length;e++){var n=t[e];if(!this.isStreamIdPreferred(n.periodId,n.streamId))return!0}return!1}),e.prototype.hasUnpreferredDownloadingSegment=freeOnUnref(function(){var r=this;return!!this.streamAcquirer.isMediaFragmentPendingThat(freeOnUnref(function(e){var t=e.segment.period.id,n=e.segment.stream.id;return!r.isStreamIdPreferred(t,n)}))||this.streamAcquirer.isInitFragmentPendingThat(freeOnUnref(function(e,t){return!r.isStreamIdPreferred(e,t)}))}),e.prototype.isStreamIdPreferred=freeOnUnref(function(e,t){var n=gf.MediaRepresentationQuerier.for(this.mediaRepresentation).itemById(e).value();if(null==n)return!1;var r=this.getPreferredStream(this.type,n);return null!=r&&r.id===t}),e})();t.ActiveStreamMonitor=n}));e(yy);yy.ActiveStreamMonitor;var gy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var p=de.get("StreamSelectionManager");function u(e){return x.contains(vu.CRITICAL_STREAM_TYPES,e)}var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u){var c=this;this.activeStreamTypes=[],this.streamMetadata={},this.cancelSetNewStream={},this.setNewStreamsPromise=lt.Promise.resolve(),this.playbackPositionMs=null,this.cachedCurrentPlaybackPeriod=null,this.started=!1,this.getPreferredStream=freeOnUnref(function(e,t){var n=c.streamSelector.selectStreams(t,e);return c.streamAlternators[e].selectStream(n)}),this.streamSelector=e,this.streamAlternators=t,this.mediaRepresentation=n,this.mainContentVideoQuality=r,this.periods=n.periods,this.periodTailor=i,this.fragmentSources=o,this.onContentFlushed=l,this.onStreamMetadataChanged=f,this.onStreamChange=u,this.activeStreamMonitors={},this.streamTypes=Object.keys(o);for(var d=0,p=this.streamTypes;d<p.length;d++){var h=p[d];this.activeStreamMonitors[h]=new yy.ActiveStreamMonitor(h,s[h],a[h],n,this.getPreferredStream),this.initializeStreamAlternator(h),this.setRepresentativeStream(h,this.getRepresentativeStream(h))}this.diagnostics=nn.Diagnostics.create("StreamSelectionManager"),this.state={streamSwitches:[],unsupportedCodecs:{},timestamp:Date.now()}}return e.prototype.start=freeOnUnref(function(e){this.started?p.warn("Already started"):(this.started=!0,this.playbackPositionMs=e,this.tryUpdateActiveStreamTypes(e))}),e.prototype.stop=freeOnUnref(function(){this.playbackPositionMs=null,this.cachedCurrentPlaybackPeriod=null,this.started=!1}),e.prototype.onPosition=freeOnUnref(function(e){this.playbackPositionMs=e,this.tryUpdateActiveStreamTypes(e)}),e.prototype.setStreamMatchers=freeOnUnref(function(t,n,e){void 0===e&&(e=!1),this.streamSelector.setMatchers(t,n),this.updateStreams(t,e).catch(freeOnUnref(function(e){e instanceof lt.CancelError||p.error(">> setStreamMatchers, type: "+t+", matchers: "+JSON.stringify(n)+", error: "+e.message)}))}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(t,n){this.streamAlternators[t].setUnsupportedCodecs(n),this.state.unsupportedCodecs[t]=n,this.started?this.updateStreams(t).catch(freeOnUnref(function(e){e instanceof lt.CancelError||p.error(">> setUnsupportedCodecs, type: "+t+", unsupportedCodecs: "+JSON.stringify(n)+", error: "+e.message)})):this.setRepresentativeStream(t,this.getRepresentativeStream(t))}),e.prototype.updateStreams=freeOnUnref(function(t,n){var r=this;void 0===n&&(n=!1);var e=this.cancelSetNewStream[t];null!=e&&e();var i=lt.CancelToken.source(),o=i.token,a=i.cancel;this.cancelSetNewStream[t]=a;var s=this.setNewStreamsPromise.then(freeOnUnref(function(){if(!o.requested&&r.started){if(null==r.playbackPositionMs)throw new Error("playbackPositionMs is null");if(null!=r.fragmentSources[t]||u(t))return r.periodTailor.getPeriodAt(r.playbackPositionMs).then(freeOnUnref(function(e){o.throwIfRequested(),null!==e&&r.selectNewStream(e,t,n)}))}}));return this.setNewStreamsPromise=s.catch(freeOnUnref(function(e){e instanceof lt.CancelError||p.error("updateStreams error:",e)})),s}),e.prototype.selectNewStream=freeOnUnref(function(e,t,n){if(this.streamAlternators[t].uninitialize(),this.initializeStreamAlternator(t),this.updateActiveStreamTypes(e),null!=this.playbackPositionMs){var r=this.activeStreamMonitors[t];if(null==r)throw new Error("Attempted to select new stream for unavailable StreamType "+t);if(r.hasUnpreferredStream()){var i=this.getPreferredStream(t,e);if(null===i&&u(t))throw new Error("selectStream for type "+t+" returned no streams");if(null===i)return p.info("There isn't a currently available "+t+" stream"),this.fragmentSources[t].stop(),this.fragmentSources[t].start(this.playbackPositionMs),this.onContentFlushed(t),void this.onStreamChange(t,n);var o=this.streamMetadata[t],a=this.createStreamMetadata(t,i);if(null==o||o.codecs!==a.codecs){p.info("["+t+"] Newly selected stream has different codec. Current stream codec is ["+a.codecs+"] and previous stream codec was ["+(null==o?null:o.codecs)+"]"),this.streamMetadata[t]=a;for(var s=0,l=this.streamTypes;s<l.length;s++){var f=l[s];this.fragmentSources[f].stop(),this.fragmentSources[f].start(this.playbackPositionMs)}q.metrics.putMetric("StreamSwitch."+t+".DifferentCodec.Started"),this.onStreamMetadataChanged(t,this.playbackPositionMs)}else p.info("["+t+"] Newly selected stream has same codec ["+a.codecs+"] as previous stream"),this.fragmentSources[t].stop(),this.fragmentSources[t].start(this.playbackPositionMs),q.metrics.putMetric("StreamSwitch."+t+".SameCodec.Started"),n||this.onContentFlushed(t);this.state.streamSwitches.push({type:t,from:null!=o?{codec:o.codecs}:null,to:{id:i.id,codec:a.codecs}}),this.reportDiagnostics(),this.onStreamChange(t,n)}}}),e.prototype.tryUpdateActiveStreamTypes=freeOnUnref(function(e,t){var n=this;void 0===t&&(t=!1),!t&&null!=this.cachedCurrentPlaybackPeriod&&this.cachedCurrentPlaybackPeriod.startMs<=e&&e<=this.cachedCurrentPlaybackPeriod.endMs||this.periodTailor.getPeriodAt(e).then(freeOnUnref(function(e){null!=e&&n.updateActiveStreamTypes(e)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||p.error("updateActiveStreamTypes failed:",e)}))}),e.prototype.updateActiveStreamTypes=freeOnUnref(function(e){for(var t={},n=0,r=(this.cachedCurrentPlaybackPeriod=e).streams;n<r.length;n++){var i=r[n];"Image"!==i.type&&(t[i.type]=!0)}this.activeStreamTypes=[];for(var o=0,a=Object.keys(t);o<a.length;o++){var s=a[o];null!==this.getPreferredStream(s,e)&&this.activeStreamTypes.push(s)}}),e.prototype.getRepresentativeStream=freeOnUnref(function(t){if(u(t)){for(var e=0,n=this.periods.contents;e<n.length;e++){if((o=n[e]).isResolved)if(null!=(a=this.getPreferredStream(t,o)))return a}throw new ct.XpError("content_src.no_representative_stream",void 0,"Unable to find a representative stream for type "+t)}for(var r=0,i=this.periods.contents;r<i.length;r++){var o,a;if((o=i[r]).isResolved)if(null!=(a=x.find(o.streams,freeOnUnref(function(e){return e.type===t}))))return a}return null}),e.prototype.setRepresentativeStream=freeOnUnref(function(e,t){null!=t&&(this.streamMetadata[e]=this.createStreamMetadata(e,t))}),e.prototype.initializeStreamAlternator=freeOnUnref(function(t){var n=this,e=this.periods.contents.filter(freeOnUnref(function(e){return e.isResolved})).map(freeOnUnref(function(e){return n.streamSelector.selectStreams(e,t)}));this.streamAlternators[t].initialize(e)}),e.prototype.createStreamMetadata=freeOnUnref(function(e,t){var n={mimeType:t.mimeType,codecs:t.qualityLevels[0].codecs};if("Video"===e){var r=t.qualityLevels;n.framerate=r[0].frameRate;var i=this.getMaxResolution();null!=i?(n.maxWidth=i.maxWidth,n.maxHeight=i.maxHeight):p.warn("Setting maxResolution in StreamMetadata to null.")}return n}),e.prototype.reportDiagnostics=freeOnUnref(function(){this.state.timestamp=Date.now(),this.diagnostics.report("state",this.state)}),e.prototype.variableAspectRatioSupported=freeOnUnref(function(){if(null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.capabilities&&!0===L.configurationStore.configuration.capabilities.supportsVariableAspectRatio)return!0;var e=zt.deviceCapabilities.output.video.display.supportsVariableAspectRatio;return null!=e&&e}),e.prototype.getMaxResolutionForPlaylistedContent=freeOnUnref(function(e){var t={SD:{width:1920,height:1080},HD:{width:1920,height:1080},UHD:{width:3840,height:2160}}[e],n=t.width,r=t.height;if(this.variableAspectRatioSupported())return p.info("Variable aspect ratio supported. Returning "+n+"x"+r+" for content quality "+e+" without adjusting it to content aspect ratio."),{maxWidth:n,maxHeight:r};var i=x.find(this.mediaRepresentation.periods.contents,freeOnUnref(function(e){return"Main"===e.periodType}));if(null==i)return p.warn("Can't find any main content. Returning null for max width and height."),null;if(!i.isResolved)throw p.warn("First main content period should be resolved by now. Erroring out."),new Error("First main content period not resolved.");var o=this.getPreferredStream("Video",i);if(null==o)return p.warn("No preferredStream returned. Returning null for max width and height."),null;var a=o.qualityLevels[0],s=a.width,l=a.height;if(null==s||null==l)return p.warn("Missing width and height in video quality level. Returning null for max width and height."),null;var f=n/r,u=s/l*this.parseSAR(a),c=void 0,d=void 0;return f<u?(c=n,d=Math.round(n/u)):(c=Math.round(r*u),d=r),p.info("Variable aspect ratio NOT supported. Returning "+c+"x"+d+" for content quality "+e+" matching content aspect ratio "+s+"/"+l+" ("+s/l+")."),{maxWidth:c,maxHeight:d}}),e.prototype.parseSAR=freeOnUnref(function(e){if(null==e.sar)return 1;var t=e.sar.split(":"),n=t[0],r=t[1],i=parseInt(n),o=parseInt(r);return!x.isFinite(i)||!x.isFinite(o)||o<=0||i<=0?(p.warn("Invalid SAR value '"+e.sar+"' for quality "+e.width+"x"+e.height+". Defaulting to SAR = 1."),1):i/o}),e.prototype.getMaxResolution=freeOnUnref(function(){if(null!=this.mainContentVideoQuality&&null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.fragmentContentSource&&"v2"===L.configurationStore.configuration.fragmentContentSource.contentMaxResolutionStrategy){if(x.contains(["SD","HD","UHD"],this.mainContentVideoQuality))return p.info("Using V2 EXPL-compatible calculation for max resolution."),this.getMaxResolutionForPlaylistedContent(this.mainContentVideoQuality);p.info("Player configured to use V2 EXPL-compatible calculation for max content resolution but main content quality "+this.mainContentVideoQuality+" is not valid. Expected SD | HD | UHD. Reverting to legacy method.")}for(var e=null,t=null,n=0,r=this.periods.contents;n<r.length;n++){var i=r[n];if(i.isResolved){var o=this.getPreferredStream("Video",i);if(null!=o)for(var a=0,s=o.qualityLevels;a<s.length;a++){var l=s[a];null!=l.width&&(null==e||e<l.width)&&(e=l.width),null!=l.height&&(null==t||t<l.height)&&(t=l.height)}}}return null==e||null==t?null:{maxWidth:e,maxHeight:t}}),e})();t.StreamSelectionManager=n}));e(gy);gy.StreamSelectionManager;var vy=t(freeOnUnref(function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0});var i=((n={}).Video=3*hh.Constants.CIRCA_ONE_FRAME_MS,n.Audio=hh.Constants.CIRCA_ONE_AUDIO_FRAME_MS,n.TimedText=0,n);t.SEGMENT_PRODUCTION_ERROR_MARGIN_MS=i;var o=((r={}).Video=3*hh.Constants.CIRCA_ONE_FRAME_MS,r.Audio=hh.Constants.CIRCA_ONE_AUDIO_FRAME_MS,r.TimedText=0,r);t.SEGMENT_QUERY_POSITION_ERROR_MARGIN_MS=o}));e(vy);vy.SEGMENT_PRODUCTION_ERROR_MARGIN_MS,vy.SEGMENT_QUERY_POSITION_ERROR_MARGIN_MS;var Oy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.flushingOfConsumedFragmentsEnabled=function(e){var t=L.configurationStore.configuration,n=null!=t&&null!=t.fragmentContentSource&&!0===t.fragmentContentSource.flushConsumedFragments,r=null!=t&&null!=t.fragmentContentSource&&!0===t.fragmentContentSource.flushConsumedFragmentsForLive;return"LiveStreaming"===e?n||r:n}}));e(Oy);Oy.flushingOfConsumedFragmentsEnabled;var Sy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.shouldPreventHevcShortFragmentResolutionChanges=function(e){return"LiveStreaming"===e&&null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.fragmentContentSource&&!0===L.configurationStore.configuration.fragmentContentSource.preventHevcShortFragmentResolutionChangesForLive}}));e(Sy);Sy.shouldPreventHevcShortFragmentResolutionChanges;var Uy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var _=de.get("FragmentContentSource"),u=3*hh.Constants.CIRCA_ONE_FRAME_MS,R=3*hh.Constants.CIRCA_ONE_FRAME_MS;var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,u,c,l,f,d,p,h,m,y,g){var v,O=this;this.onContentFlushed=null,this.onStreamMetadataChanged=null,this.playerViewportCallback=null,this.getFrontBufferDurationMsCallback=null,this.getSourceBufferInfoCallback=null,this.onContentDurationChanged=null,this.blockedSegmentTracker=new Om.BlockedSegmentTracker,this.cancelFragmentSourcesStart=null,this.eventEmitter=new A.EventEmitter,this.fatalError=null,this.started=!1,this.ongoingSeekPromise=lt.Promise.resolve(),this.pendingSeekCancel=null,this.playbackPositionMs=null,this.notifyRestrictionChange=freeOnUnref(function(e){for(var t=[],n=O.streamRestrictionsManager.getPlaybackRestrictions(),r=0,i=Object.keys(n);r<i.length;r++){var o=n[i[r]];null!=o&&o.streamType===e&&t.push(o)}var a={streamType:e,restrictions:t};_.info("Stream restriction changed:",JSON.stringify(a)),O.eventEmitter.emit("streamRestrictionChange",a)}),this.getDistanceFromPlayhead=freeOnUnref(function(e){return O.prioritizationSystem.getDistanceFromPlayhead(O,e)}),this.onPeriodRemoved=freeOnUnref(function(e){for(var t=0,n=O.streamTypes;t<n.length;t++){var r=n[t];O.fragmentBuffers[r].removePeriod(e,!0)}}),this.streamAlternatorGetter=freeOnUnref(function(e){return O.streamAlternators[e]}),this.triggerStreamRestart=freeOnUnref(function(e){if(null!==O.playbackPositionMs){var t=O.sources[e];null!=t&&(_.info("Restarting "+e+" stream."),t.stop(),t.start(O.playbackPositionMs))}else _.warn("Ignoring stream restart without a current position")}),this.onFragmentDownloaded=freeOnUnref(function(){for(var e=0,t=Object.keys(O.fragmentBuffers);e<t.length;e++){var n=t[e];O.state.buffers[n]=O.fragmentBuffers[n].getBufferedRanges().getIntervals()}O.reportDiagnostics()}),this.onPeriodTailorFatalError=freeOnUnref(function(e){e=ct.XpError.generatePrefixedError(e,"content_src"),O.fatalError=e,O.state.fatalError=e,O.started&&O.eventEmitter.emit("fatalError",e),O.reportDiagnosticsIfStarted()}),this.getPreferredStream=freeOnUnref(function(e,t){var n=O.streamSelector.selectStreams(t,e);return O.streamAlternators[e].selectStream(n)}),this.onPeriodsChange=freeOnUnref(function(){O.initializationDataGenerator.updateInitializationData(),O.state.keyIds=O.initializationDataGenerator.keyIds,null!=O.onContentDurationChanged&&O.onContentDurationChanged()}),this.mediaRepresentation=e,this.periods=e.periods,this.getLicense=t,this.prioritizationSystem=n,this.playerBufferManager=r,this.resourceAcquisitionMonitor=o,this.availabilityTimeWindow=a,this.mediaPlayerConfig=y,this.persistentStorageSelectionLoader=new Sm.PersistentStorageSelectionLoader(m),this.diagnostics=nn.Diagnostics.create("FragmentContentSource"),this.state={started:!1,keyIds:[],positionMs:null,fatalError:null,frontBufferSizeMs:null,buffers:{},timestamp:Date.now()},this.streamTypes=this.extractStreamTypes(),this.validateCriticalStreamsExistence(this.streamTypes),this.streamSelector=new vu.StreamSelector(l,i);var S=((v={}).Audio=new um.CompositeFilter,v.TimedText=new um.CompositeFilter,v.Video=new um.CompositeFilter,v);this.periodTailor=new vm.PeriodTailor(e,this.streamSelector,S,this.streamAlternatorGetter,this.onPeriodRemoved),this.bufferTrimmers={},this.fragmentBuffers={},this.downloadQueues={},this.acquirers={},this.localSegmentLoaders={},this.segmentInfoProducers={},this.sources={},this.streamAlternators={},this.frontBufferBarrier=new mh.FrontBufferProductionBarrier(this.getDistanceFromPlayhead,fh.BufferConstants.MAX_FRONT_BUFFER_MS),this.state.frontBufferSizeMs=fh.BufferConstants.MAX_FRONT_BUFFER_MS,this.slowSegmentBarrier=new Gh.SlowSegmentBarrier(1e4),this.flushConsumedFragments=Oy.flushingOfConsumedFragmentsEnabled(s);for(var U=Sy.shouldPreventHevcShortFragmentResolutionChanges(s),b=freeOnUnref(function(e){var t=void 0;"Video"===e&&U&&(t=new ay.SegmentQualityLevelTracker),P.fragmentBuffers[e]=new dh.FragmentBuffer(e,c,void 0,P.persistentStorageSelectionLoader.updateCachedSelectionContext),P.fragmentBuffers[e].onUpdate(freeOnUnref(function(){O.reportBufferSizeForDiagnostics(e),O.slowSegmentBarrier.segmentDownloaded()})),P.bufferTrimmers[e]=new Um.PositionBasedBufferTrimmer(P.fragmentBuffers[e],t),P.streamAlternators[e]=new vu.streamAlternatorTypeMap[e];var n=vy.SEGMENT_PRODUCTION_ERROR_MARGIN_MS[e],r=new zh.PrimarySegmentInfoProducer(e,P.periodTailor,P.streamSelector,P.streamAlternators[e],n,S[e]);P.segmentInfoProducers[e]=r;var i=[P.frontBufferBarrier,P.slowSegmentBarrier],o=new Wh.BlockingSegmentInfoProducer(e,r,i);P.downloadQueues[e]=new Kh.SegmentDownloadQueue(e,P.periodTailor,o),"TimedText"!==e&&P.slowSegmentBarrier.addProducer(P.downloadQueues[e]),P.localSegmentLoaders[e]=new gh.LocalSegmentLoader(e,P.fragmentBuffers[e],S[e],P.persistentStorageSelectionLoader);var a,s,l=freeOnUnref(function(){return null!=O.getFrontBufferDurationMsCallback?O.getFrontBufferDurationMsCallback(e):null}),f=freeOnUnref(function(){return null!=O.getSourceBufferInfoCallback?O.getSourceBufferInfoCallback(e):null});P.acquirers[e]=new fm.StreamAcquirer(e,P,P.downloadQueues[e],P.fragmentBuffers[e],P.eventEmitter,P.prioritizationSystem,P.playerBufferManager,P.resourceAcquisitionMonitor,S[e],P.blockedSegmentTracker,P.localSegmentLoaders[e],P.mediaRepresentation,l,f,P.flushConsumedFragments,U,u,t,m),P.sources[e]=new uh.DefaultFragmentSource(e,(a=e,s=L.configurationStore.configuration,"Audio"===a&&null!=s&&null!=s.fragmentContentSource&&!0===s.fragmentContentSource.enableAudioSegmentQueryPositionErrorMargin?R:vy.SEGMENT_QUERY_POSITION_ERROR_MARGIN_MS[a]),P.periodTailor,P.fragmentBuffers[e],P.downloadQueues[e],P.acquirers[e],P.eventEmitter,P.getPreferredStream,P.flushConsumedFragments,t)}),P=this,M=0,C=this.streamTypes;M<C.length;M++){b(C[M])}var E=u.playbackSettings.buffer;if(c.isDiskCaching){var T=6e3;null!=E&&null!=E.bufferFullnessForPlaybackStartSeconds&&(T=1e3*E.bufferFullnessForPlaybackStartSeconds),this.setFrontBufferSize(T)}this.bufferInformationCalculator=new Uu.BufferInformationCalculator(this.fragmentBuffers,this.blockedSegmentTracker,E);var w=new ph.VideoSegmentMonitor(this.fragmentBuffers.Video,this.acquirers.Video,this.mediaRepresentation),I=null==h?my.StreamRestrictionsContext.Caching:my.StreamRestrictionsContext.Playback;this.streamRestrictionsManager=new my.StreamRestrictionsManager(S,w,this.notifyRestrictionChange,this.triggerStreamRestart,freeOnUnref(function(){return null!=O.playerViewportCallback?O.playerViewportCallback():null}),u,e,this.eventEmitter,I,p,h,d),this.initializationDataGenerator=new vu.InitializationDataGenerator(e,this.eventEmitter),this.state.keyIds=this.initializationDataGenerator.keyIds,this.mediaRepresentation.periods.onChange(this.onPeriodsChange),this.eventEmitter.on("fragmentDownloaded",this.onFragmentDownloaded),this.periodTailor.on("fatalError",this.onPeriodTailorFatalError),this.streamSelectionManager=new gy.StreamSelectionManager(this.streamSelector,this.streamAlternators,e,null==g?null:g,this.periodTailor,this.sources,this.acquirers,this.fragmentBuffers,freeOnUnref(function(e){null!=O.onContentFlushed&&O.onContentFlushed(e)}),freeOnUnref(function(e,t){null!=O.onStreamMetadataChanged&&O.onStreamMetadataChanged(e,t)}),freeOnUnref(function(e,t){var n={streamType:e,seamless:t};O.eventEmitter.emit("streamChange",n)}));var k={acceptableSegmentPositionErrorMs:0,segmentCacheFactory:c,eventEmitter:this.eventEmitter,imageStreamAlternator:new vu.UpgradableImageStreamAlternator,mediaRepresentation:this.mediaRepresentation,prioritizationSystem:this.prioritizationSystem,playerBufferManager:this.playerBufferManager,seekPreviewRestriction:f,resourceAcquisitionMonitor:this.resourceAcquisitionMonitor,streamSelector:this.streamSelector,timeWindow:this.availabilityTimeWindow};this.seekPreviewManager=oy.SeekPreviewManagerFactory.create(k),this.reportDiagnostics()}return Object.defineProperty(e.prototype,"activeStreamTypes",{get:freeOnUnref(function(){return this.streamSelectionManager.activeStreamTypes}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"streamMetadata",{get:freeOnUnref(function(){return this.streamSelectionManager.streamMetadata}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seekPreview",{get:freeOnUnref(function(){return this.seekPreviewManager}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"downloadOperationId",{get:freeOnUnref(function(){return this.persistentStorageSelectionLoader.downloadOperationId}),enumerable:!0,configurable:!0}),e.prototype.flush=freeOnUnref(function(){for(var e=0,t=this.streamTypes;e<t.length;e++){var n=t[e];this.fragmentBuffers[n].flush()}}),e.prototype.setKeyMetadata=freeOnUnref(function(e){this.streamRestrictionsManager.updateKeyMetadata(e)}),e.prototype.isEncrypted=freeOnUnref(function(){var a=this;return lt.Promise.resolve().then(freeOnUnref(function(){for(var e=0,t=a.mediaRepresentation.periods.contents;e<t.length;e++){var n=t[e];if(n.isResolved)for(var r=0,i=n.streams;r<i.length;r++){var o=i[r];if(null!=o.contentProtections&&0<o.contentProtections.length)return!0}}return!1}))}),e.prototype.isSegmentQualityValid=freeOnUnref(function(i,o,a,s){var l=this;return"Video"!==i?lt.Promise.resolve(!0):this.streamRestrictionsManager.awaitRestrictionResolution().then(freeOnUnref(function(){var e=l.streamRestrictionsManager.getPlaybackRestrictionFilters()[i];if(null==e)return!0;var t=gf.MediaRepresentationQuerier.for(l.mediaRepresentation).itemById(o).streamById(a),n=t.value();if(null===n)return!1;var r=t.qualityLevelById(s).value();return null!==r&&e.isValidQuality(r,n)}))}),e.prototype.getInitializationData=freeOnUnref(function(){var n=this;return this.initializationDataGenerator.getInitializationData().map(freeOnUnref(function(e,t){return{type:"cenc",data:e,mimeType:n.initializationDataGenerator.getMimeTypeByIndex(t)}}))}),e.prototype.getDurationMs=freeOnUnref(function(){return this.mediaRepresentation.durationMs}),Object.defineProperty(e.prototype,"minimumPlayablePositionMs",{get:freeOnUnref(function(){return this.periodTailor.getMinimumPlayablePositionMs()}),enumerable:!0,configurable:!0}),e.prototype.start=freeOnUnref(function(s){var l=this;if(_.info(">> start at "+s+"ms, with available streamTypes: "+this.streamTypes),this.started=!0,this.playbackPositionMs=s,this.frontBufferBarrier.onPosition(s),null!=this.fatalError)return _.error("FatalError exists at start:",this.fatalError),this.eventEmitter.emit("fatalError",this.fatalError),void this.reportDiagnostics();this.streamRestrictionsManager.start();var e=lt.CancelToken.source(),f=e.token,t=e.cancel;this.cancelFragmentSourcesStart=t,this.persistentStorageSelectionLoader.load().then(freeOnUnref(function(e){f.throwIfRequested();var t=null,n=null;null!=e&&(t=e.selectionContext,n=e.cachedSelectionContext),l.periodTailor.setSelectionContext(t);for(var r=0,i=l.streamTypes;r<i.length;r++){var o=i[r];l.segmentInfoProducers[o].setSelectionContext(t),l.localSegmentLoaders[o].initialize(t,n)}if(null!=l.playbackPositionMs){var a=l.playbackPositionMs;return l.periodTailor.getPeriodAt(a).then(freeOnUnref(function(e){f.throwIfRequested(),l.playbackPositionMs===a&&null!=e&&s>=e.endMs-u&&(_.info(">> start("+s+"ms) adjusted to tailored period end "+e.endMs),l.playbackPositionMs=e.endMs,l.eventEmitter.emitSync("positionAdjusted",l.playbackPositionMs))}))}})).then(freeOnUnref(function(){return l.ongoingSeekPromise})).then(freeOnUnref(function(){if(f.throwIfRequested(),null!==l.playbackPositionMs){l.streamSelectionManager.start(l.playbackPositionMs),l.seekPreviewManager.start(s);for(var e=freeOnUnref(function(e){("Video"===e?l.streamRestrictionsManager.awaitRestrictionResolution():lt.Promise.resolve()).then(freeOnUnref(function(){f.throwIfRequested(),null!==l.playbackPositionMs?l.sources[e].start(l.playbackPositionMs):_.warn("this.playbackPositionMs is null when trying to start FragmentSource")})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||_.error(e.message)}))}),t=0,n=l.streamTypes;t<n.length;t++){e(n[t])}}else _.warn("this.playbackPositionMs is null when trying to start StreamSelectionManager")})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||_.error(e.message)})),this.reportDiagnostics()}),e.prototype.stop=freeOnUnref(function(){_.info(">> stop"),(this.playbackPositionMs=null)!=this.cancelFragmentSourcesStart&&this.cancelFragmentSourcesStart(),null!=this.pendingSeekCancel&&(this.pendingSeekCancel(),this.pendingSeekCancel=null),this.mediaRepresentation.stop(),this.mediaRepresentation.periods.offChange(this.onPeriodsChange),this.streamRestrictionsManager.stop(),this.streamSelectionManager.stop();for(var e=0,t=this.streamTypes;e<t.length;e++){var n=t[e];this.sources[n].stop(),this.localSegmentLoaders[n].uninitialize()}this.ongoingSeekPromise=lt.Promise.resolve(),this.seekPreviewManager.stop(),this.reportDiagnosticsIfStarted(),this.started=!1}),e.prototype.setFrontBufferSize=freeOnUnref(function(e){this.frontBufferBarrier.setFrontBufferSize(e),this.state.frontBufferSizeMs=e,this.reportDiagnosticsIfStarted()}),e.prototype.setMaxBitrateThreshold=freeOnUnref(function(e,t,n){this.streamRestrictionsManager.setMaxBitrateThreshold(e,t,n)}),e.prototype.setMaxResolution=freeOnUnref(function(e,t){}),e.prototype.setStreamMatchers=freeOnUnref(function(e,t,n){this.streamSelectionManager.setStreamMatchers(e,t,n),n&&this.diagnostics.report("seamlessSwitchLatency",{switchStartTimeMs:Date.now()})}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(e,t){this.streamSelectionManager.setUnsupportedCodecs(e,t)}),e.prototype.onPosition=freeOnUnref(function(e){this.playbackPositionMs=e,this.frontBufferBarrier.onPosition(e);for(var t=0,n=Object.keys(this.acquirers);t<n.length;t++){var r=n[t];this.acquirers[r].onPosition(e)}for(var i=0,o=Object.keys(this.bufferTrimmers);i<o.length;i++){r=o[i];this.bufferTrimmers[r].onPosition(e)}for(var a=0,s=Object.keys(this.fragmentBuffers);a<s.length;a++){r=s[a];this.state.buffers[r]=this.fragmentBuffers[r].getBufferedRanges().getIntervals()}this.streamSelectionManager.onPosition(e),this.reportDiagnostics()}),e.prototype.onRebuffer=freeOnUnref(function(){for(var e=0,t=Object.keys(this.acquirers);e<t.length;e++){var n=t[e];this.acquirers[n].onRebuffer()}}),e.prototype.seek=freeOnUnref(function(t){var e,n=this;_.info(">> seek to "+t),null!=this.pendingSeekCancel&&this.pendingSeekCancel();var r=lt.CancelToken.source(),i=r.token,o=r.cancel;this.pendingSeekCancel=o,this.streamSelectionManager.onPosition(t),this.ongoingSeekPromise=(e=this.periodTailor.getPeriodAt(t).then(freeOnUnref(function(e){i.throwIfRequested(),null!=e&&t>=e.endMs-u&&(_.info(">> seek("+t+"ms) adjusted to tailored period end "+e.endMs),t=e.endMs,n.eventEmitter.emitSync("positionAdjusted",t)),n.applySeek(t)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||_.error(">> seek("+t+") failed.",e,e.stack)}))).then.apply(e,lt.FINALLY(freeOnUnref(function(){n.ongoingSeekPromise=lt.Promise.resolve()})))}),e.prototype.getFragmentSource=freeOnUnref(function(e){return this.sources[e]}),e.prototype.playbackTimeToManifestTime=freeOnUnref(function(e,t){return this.periodTailor.playbackTimeToManifestTime(e,t)}),e.prototype.contentTimeToWallClockUtcTime=freeOnUnref(function(t,e){var n=x.findIndex(this.periods.contents,freeOnUnref(function(e){return e.id===t})),r=this.periods.contents[n];if(null==r)return null;var i=this.periodTailor.playbackTimeToManifestTime(t,e),o=r.mediaWallClockUtcStartMs;if(null==o)for(var a=0,s=n-1;0<=s;s--){var l=this.periods.contents[s];if(a+=l.endMs-l.startMs,null!=l.mediaWallClockUtcStartMs){o=l.mediaWallClockUtcStartMs+a;break}}return null==o?null:i-r.startMs+o}),e.prototype.wallClockUtcTimeToContentTime=freeOnUnref(function(e){for(var t=null,n=0,r=this.periods.contents;n<r.length;n++){var i=r[n];if(null!=i.mediaWallClockUtcStartMs&&e>=i.mediaWallClockUtcStartMs&&(t=i.mediaWallClockUtcStartMs),null!=t){var o=i.endMs-i.startMs;if(t<=e&&e<=t+o){var a=e-t+i.startMs;return this.periodTailor.manifestTimeToPlaybackTime(i.id,a)}t+=o}}return null}),e.prototype.getBufferInformationCalculator=freeOnUnref(function(){return this.bufferInformationCalculator}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.applySeek=freeOnUnref(function(e){this.onPosition(e);for(var t=0,n=Object.keys(this.acquirers);t<n.length;t++){var r=n[t];this.acquirers[r].onSeek()}this.playerBufferManager.onPosition(e)}),e.prototype.extractStreamTypes=freeOnUnref(function(){for(var e=!1,t=0,n=this.periods.contents;t<n.length;t++){var r=n[t];if(r.isResolved)for(var i=0,o=r.streams;i<o.length;i++){if("TimedText"===o[i].type){e=!0;break}}}e||_.info("TimedText not present in the initial MediaRepresentation, no TimedText Stream Acquirer will be created.");var a=["Audio","Video"];return e&&a.push("TimedText"),a.sort()}),e.prototype.reportDiagnostics=freeOnUnref(function(){this.state.started=this.started,this.state.positionMs=this.playbackPositionMs,this.state.timestamp=Date.now(),this.diagnostics.report("state",this.state)}),e.prototype.reportDiagnosticsIfStarted=freeOnUnref(function(){this.started&&this.reportDiagnostics()}),e.prototype.reportBufferSizeForDiagnostics=freeOnUnref(function(e){null!=this.playbackPositionMs&&this.diagnostics.report("fragmentBufferChanged",{type:e,positionMs:this.playbackPositionMs,ranges:this.fragmentBuffers[e].getBufferedRanges().getIntervals().map(freeOnUnref(function(e){return{startMs:e.start,endMs:e.end}}))})}),e.prototype.validateCriticalStreamsExistence=freeOnUnref(function(e){var t=x.difference(vu.CRITICAL_STREAM_TYPES,e);if(0<t.length)throw new ct.XpError("content_src.missing_critical_stream",void 0,"MediaRepresentation missing critical stream types: "+t)}),e})();t.FragmentContentSource=n}));e(Uy);Uy.FragmentContentSource;var by=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("DownloadedAssetsMediaRepresentationFilter"),n=freeOnUnref(function(){function n(e){this.selectionContext=e}return n.create=freeOnUnref(function(e){if(null==e)return lt.Promise.resolve(null);if(!Jo.metadataStorage.capabilities.isSupported)return lt.Promise.resolve(null);var t=yd.createSelectionContextKey(e);return Jo.metadataStorage.get(t).then(freeOnUnref(function(e){return null==e?null:new n(e)})).catch(freeOnUnref(function(e){return r.warn("Failed to access "+t+":",e),null}))}),n.prototype.isQualityLevelSupported=freeOnUnref(function(e,t){if("Image"===e.type)return!1;for(var n=0,r=Object.keys(this.selectionContext);n<r.length;n++){var i=r[n],o=this.selectionContext[i][e.type];if(null!=o)for(var a=0,s=o;a<s.length;a++){var l=s[a];if(l.streamId===e.id&&l.qualityLevelId===t.id)return!0}}return!1}),n})();t.DownloadedAssetsMediaRepresentationFilter=n}));e(by);by.DownloadedAssetsMediaRepresentationFilter;var Py=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.hasCardsWithInBandSubtitles=function(e){for(var t=0,n=e.periods.contents;t<n.length;t++){var r=n[t];if("Aux"===r.contentType)for(var i=0,o=r.streams;i<o.length;i++)if("TimedText"===o[i].type)return!0}return!1}}));e(Py);Py.hasCardsWithInBandSubtitles;var My=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.hasInBandSubtitlesInAllPeriods=function(e){return!(e.periods.contents.length<=0)&&e.periods.contents.every(freeOnUnref(function(e){return e.streams.some(freeOnUnref(function(e){return"TimedText"===e.type}))}))}}));e(My);My.hasInBandSubtitlesInAllPeriods;var Cy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.resourceAcquirer=new Ac.ResourceAcquirer}return e.prototype.create=freeOnUnref(function(a,s,l,f,u,c,d,p,h,m,y,e,g,v,O,t,S,n,U,b,P,r){var i=lt.CancelToken.source(),M=i.token,o=i.cancel;if("DASH"!==p)throw new Error("StreamingTechnology "+p+" is not supported!");var C=l.playbackSettings.scheduler,E=new ih.DashMediaRepresentationSource(this.resourceAcquirer,d,null,"segmentBase",e,t,g,C,r);void 0!==n&&n(E);var T=Date.now(),w=this.createMediaRepresentation(E,h,M,g).then(freeOnUnref(function(e){M.throwIfRequested();var t=null==e.updatePeriodMs?"Static":"Dynamic";q.metrics.putMetric("MediaRepresentation."+p+"."+t+".InitialCreation.Time",Date.now()-T);var n=new oh.RefreshingRepresentationTimeWindow(e,f);e.start(f);var r=null!=b?b:"InMemory",i=new vu.CacheFactory(r,g),o=new Uy.FragmentContentSource(e,a,u,c,s,d,n,h,l,i,S,O,v,m,y,g,P);return o.suggestedPictureModes=U,{representationSource:E,mediaRepresentation:e,contentSource:o}}));return{cancel:freeOnUnref(function(){E.stop(),o()}),contentSourceContextPromise:w}}),e.prototype.addFilterToRemoveInBandSubtitlesIfNotNeeded=freeOnUnref(function(e,t,n){"Feature"===t&&(Py.hasCardsWithInBandSubtitles(e)||My.hasInBandSubtitlesInAllPeriods(e)||n.push({isQualityLevelSupported:freeOnUnref(function(e){return"TimedText"!==e.type})}))}),e.prototype.createMediaRepresentation=freeOnUnref(function(e,r,i,t){var o=this,n=e.mediaRepresentation;return(!0===n.valid?lt.Promise.resolve(n.contents):n.refresh()).then(freeOnUnref(function(n){return i.throwIfRequested(),lt.Promise.all([gf.MediaCapabilitiesFilter.create(n),by.DownloadedAssetsMediaRepresentationFilter.create(t)]).then(freeOnUnref(function(e){i.throwIfRequested();var t=e.filter(freeOnUnref(function(e){return null!=e}));return t.push(new gf.AudioQualityLevelFilter),o.addFilterToRemoveInBandSubtitlesIfNotNeeded(n,r,t),n.applyFilters(t),n}))}))}),e})();t.FragmentContentSourceFactory=n}));e(Cy);Cy.FragmentContentSourceFactory;var Ey=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.create=freeOnUnref(function(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v,O,S,U,b){var P=n.playbackSettings,M=1e3*P.buffer.delayBehindLiveHeadSeconds;return"HLS"===a?(new Nc.SafariHlsContentSourceFactory).create(e,o,P,M,l,s,f,t,y,g,O,U):(new Cy.FragmentContentSourceFactory).create(e,t,n,M,r,i,o,a,s,u,c,l,d,p,h,m,y,g,v,S,U,b)}),e})();t.ContentSourceFactory=n}));e(Ey);Ey.ContentSourceFactory;var Ty=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BufferInformationCalculator=Uu.BufferInformationCalculator,t.ContentSourceFactory=Ey.ContentSourceFactory,t.FragmentContentSourceFactory=Cy.FragmentContentSourceFactory,t.FragmentContentSource=Uy.FragmentContentSource}));e(Ty);Ty.BufferInformationCalculator,Ty.ContentSourceFactory,Ty.FragmentContentSourceFactory,Ty.FragmentContentSource;var wy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.LEGACY="LEGACY",e.RETENTION_LOW="RETENTION_LOW",e})();t.AudioAdaptationSelectionMode=n}));e(wy);wy.AudioAdaptationSelectionMode;var Iy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.extend=freeOnUnref(function(e,t){return Qe.deepExtend(e,t)}),e})();t.PlaybackSettingsMerger=n}));e(Iy);Iy.PlaybackSettingsMerger;var ky=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("PlaybackSettingsParser"),r=freeOnUnref(function(){function e(){}return e.fromEncodedString=freeOnUnref(function(e){try{return JSON.parse(Lr.decodeString(e))}catch(e){return n.error("Invalid encoded PlaybackSettings:",e),null}}),e})();t.PlaybackSettingsParser=r}));e(ky);ky.PlaybackSettingsParser;var _y=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.distanceMeasure=e,this.centroids=t,this.featureWeights=n}return e.prototype.classify=freeOnUnref(function(e){return this.validateFeatureVector(e),this.getNearestClusterLabel(e)}),e.prototype.validateFeatureVector=freeOnUnref(function(e){if(e.length!==this.featureWeights.length)throw new Error("Input feature vector does not match with the features used in cluster model")}),e.prototype.getNearestClusterLabel=freeOnUnref(function(e){for(var t=1/0,n=null,r=0,i=Object.keys(this.centroids);r<i.length;r++){var o=i[r],a=this.distanceMeasure.measure(e,this.centroids[o],this.featureWeights);a<t&&(t=a,n=o)}return n}),e})();t.NearestNeighborClassifier=n}));e(_y);_y.NearestNeighborClassifier;var Ry=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.measure=freeOnUnref(function(e,t,n){for(var r=0,i=0;i<e.length;i++)r+=n[i]*Math.pow(t[i]-e[i],2);return Math.sqrt(r)}),e})();t.EuclideanDistance=n}));e(Ry);Ry.EuclideanDistance;var Ay=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createClassifier=freeOnUnref(function(e,t){switch(e.type){case"NEAREST_NEIGHBOUR":var n=this.createDistanceMeasure(e.distanceMeasureType);return new _y.NearestNeighborClassifier(n,t.centroids,t.featureWeights);default:throw new Error("Classifier: "+e.type+" is not supported by continuous optimization")}}),e.createDistanceMeasure=freeOnUnref(function(e){switch(e){case"EUCLIDEAN_DISTANCE":return new Ry.EuclideanDistance;default:throw new Error("Distance Measure type: "+e+" is not supported by continuous optimization")}}),e})();t.ClassifierFactory=n}));e(Ay);Ay.ClassifierFactory;var Dy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("PlaybackSettingsProvider"),n=freeOnUnref(function(){function e(e,t,n){var r=this;if(this.classifier=null,this.currentClusterLabel=null,this.networkStatisticsWindows=void 0,this.continuousOptimizationTimeoutId=null,this.startTimeInMs=null,this.runClassifier=freeOnUnref(function(){var e=r.getFeatureVector();if(null!=e){var t=r.classifier.classify(e);r.updatePlaybackSettings(t)}r.scheduleNextClassifierRun()}),this.currentPlaybackSettings=e,this.basePlaybackSettings=e,this.continuousOptimizationSettings=t,this.clusterSpecificPlaybackSettingsMap=n,this.updateCallback=new A.MulticastCallback,this.hasContinuousOptimization()){var i=this.continuousOptimizationSettings.featureComputation;this.classifier=Ay.ClassifierFactory.createClassifier(this.continuousOptimizationSettings.classifier,this.continuousOptimizationSettings.clusterModel),this.networkStatisticsWindows={bandwidthAverageWindow:i.bandwidthAvgFragmentWindow,bandwidthStdDevWindow:i.bandwidthStdDevFragmentWindow,latencyAvgWindow:i.latencyAvgFragmentWindow,latencyStdDevWindow:i.latencyStdDevFragmentWindow}}}return Object.defineProperty(e.prototype,"playbackSettings",{get:freeOnUnref(function(){return this.currentPlaybackSettings}),enumerable:!0,configurable:!0}),e.prototype.start=freeOnUnref(function(){this.hasContinuousOptimization()&&(null==this.continuousOptimizationTimeoutId?(this.continuousOptimizationTimeoutId=oe.timer.setTimeout(this.runClassifier,this.continuousOptimizationSettings.sessionStartIntervalInMilliseconds),this.startTimeInMs=Date.now()):r.warn("PlaybackSettingsProvider started when already running"))}),e.prototype.stop=freeOnUnref(function(){this.hasContinuousOptimization()&&null!=this.continuousOptimizationTimeoutId&&(oe.timer.clearTimeout(this.continuousOptimizationTimeoutId),this.continuousOptimizationTimeoutId=null,this.startTimeInMs=null)}),e.prototype.onUpdate=freeOnUnref(function(e){this.updateCallback.add(e)}),e.prototype.offUpdate=freeOnUnref(function(e){this.updateCallback.remove(e)}),e.prototype.hasContinuousOptimization=freeOnUnref(function(){return!x.isEmpty(this.clusterSpecificPlaybackSettingsMap)}),e.prototype.scheduleNextClassifierRun=freeOnUnref(function(){var e;e=Date.now()-this.startTimeInMs<this.continuousOptimizationSettings.intervalInMilliseconds?this.continuousOptimizationSettings.sessionStartIntervalInMilliseconds:this.continuousOptimizationSettings.intervalInMilliseconds,this.continuousOptimizationTimeoutId=oe.timer.setTimeout(this.runClassifier,e)}),e.prototype.getFeatureVector=freeOnUnref(function(){var e=_c.getInstance().getNetworkStatistics(this.networkStatisticsWindows),t=e.bandwidthAvgKbps,n=e.bandwidthStdDevKbps,r=e.latencyAvgMs,i=e.latencyStdDevMs;return null==t||null==n||null==r||null==i?null:[t/1e3,n/1e3,r,i]}),e.prototype.updatePlaybackSettings=freeOnUnref(function(e){if(e!==this.currentClusterLabel){var t=this.clusterSpecificPlaybackSettingsMap,n=void 0;null==e?(r.info("Classifier did not select any network cluster. Using base playback settings."),n=this.basePlaybackSettings):null==t[e]?(r.info("Playback settings tailored for network cluster "+e+", but are there no playback settings defined for this cluster. Using base playback settings."),n=this.basePlaybackSettings):(r.info("Playback settings tailored for network cluster "+e+"."),n=t[e]),this.currentClusterLabel=e,this.currentPlaybackSettings=n,this.updateCallback.invoke(n)}}),e})();t.PlaybackSettingsProvider=n}));e(Dy);Dy.PlaybackSettingsProvider;var xy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={audioAdaptationSetSelectionMode:wy.AudioAdaptationSelectionMode.LEGACY,audioTransferSpeedVariationFactorToTransferSpeedSharePair:[[0,0]],bufferFullnessSecondsToAudioTransferSpeedFactor:[[0,1]]},r={averageFragmentWindow:5,averageRequestWindow:10,stdDevFragmentWindow:10,stdDevRequestWindow:10,maxStartingBandwidthKbps:99999999,minStartingBandwidthKbps:0,bufferFullnessSecondsToConfidenceFactorGraph:[[0,Number("-25e-2")]],maxBandwidthHeadroomFactor:Number("5e-1"),minBandwidthHeadroomFactor:Number("15e-2"),bandwidthHeadroomStepFactor:Number("5e-2"),bandwidthBaselineFactor:Number("1e-1")},i={targetBufferFullnessMs:7e4,bufferFillFactor:Number("9e-1"),useBufferSizeRatio:!0,bufferSizeRatio:Number("25e-2")},o={bufferFullnessSecondsToBitrateUpshiftLimitFactorGraph:[[0,0],[Number("49e-1"),0],[5,1],[Number("149e-1"),1],[15,2],[Number("299e-1"),2],[30,3],[120,3]],bufferFullnessSecondsToBitrateDownshiftLimitFactorGraph:[[0,-50],[Number("49e-1"),-50],[5,-4],[Number("199e-1"),-4],[20,-3],[Number("299e-1"),-3],[30,-2],[Number("449e-1"),-2],[45,-1],[Number("899e-1"),-1],[90,0],[120,0]],bufferFullnessSecondsToBitrateRetryDownshiftLimitFactorGraph:[[0,-50],[Number("49e-1"),-50],[5,-8],[Number("199e-1"),-8],[20,-6],[Number("299e-1"),-6],[30,-4],[Number("449e-1"),-4],[45,-2],[Number("849e-1"),-2],[85,-1],[120,-1]],maxBitrateKbps:99999999,minBitrateKbps:0,minBaselineUpgradeDifferenceQualityLevels:2},a={averageFragmentWindow:5,averageRequestWindow:10,stdDevFragmentWindow:10,stdDevRequestWindow:10,bufferFullnessSecondsToConfidenceFactorGraph:[[0,Number("25e-2")]]},s={bufferFullnessSecondsToTimeoutFactorGraph:[[0,1],[10,Number("18e-1")],[20,Number("22e-1")],[30,Number("25e-1")],[40,Number("28e-1")],[60,Number("30e-1")],[90,Number("38e-1")]],confidenceLevelsToCompute:8,minConfidenceLevelSum:10,linearizationPotential:1,maxConcurrentRequests:3,maxFutureDownloadFragments:3,upgradeOffsetFragments:2,upgradeEmptyBufferSkipCountFragments:4,isMinUpdatePeriodEnforced:!1},l={bitrateVariationFactor:1,bitrateVariationWindow:6,bufferFullnessSecondsToBandwidthThrottleFactorGraph:[[15,Number("16e-2")],[25,Number("20e-2")],[35,Number("25e-2")],[50,Number("32e-2")],[70,Number("50e-2")],[88,Number("75e-2")],[100,Number("90e-2")],[110,1]],bufferFullnessSecondsToLiveBandwidthThrottleFactorGraph:[[10,Number("5e-1")],[20,1]],bufferFullnessSecondsToRetryBandwidthThrottleFactorGraph:[[5,Number("65e-2")],[20,Number("70e-2")],[30,Number("80e-2")],[60,Number("85e-2")],[120,Number("95e-2")]],minBitrateVariationPenaltyFactor:Number("-2e-1"),maxBitrateVariationPenaltyFactor:0},f={bolaAlgorithm:"DYNAMIC_TRADE_OFF_FACTOR",bufferScaler:0,tradeOffFactor:10,bufferLowWatermarkSeconds:80,transientStateBufferThresholdSeconds:40,bufferLowWatermarkSecondsForLowTransient:6,shouldAdjustBufferLowWatermarkForLowTransient:!1,startupBitratePercent:Number("5e-1"),rampUpGoodnessValueFactor:Number("95e-2"),maxRampUpQualityLevel:2,transientClipMaxDurationFactor:Number("99e-2"),transientBufferDurationIncrementScaleFactor:Number("9e-1"),lowTransientBufferDurationIncrementScaleFactor:Number("7e-1"),maxAvailableBufferDurationScaleFactorLow:1,maxAvailableBufferDurationScaleFactorHigh:1,shouldAdjustBufferLowWatermarkForCVBR:!1,scalerThroughputEstimateInGetBolaBitRate:Number("9e-1"),shouldUseThroughputEstimateInGetBolaBitRate:!1,reservedBandwidthForAudioBitsPerSecond:0,shouldUseBitrateInGoodnessValueCalculation:!1,shouldAdaptForGivenDeviceMaxBuffer:!1,shouldSelectLowestQualityAboveIdealGoodnessValue:!1,scalerThroughputEstimateInGetBolaBitRateLowTransient:Number("9e-1"),shouldSwitchHybridBolaOnTransientStates:!1,shouldUseRelativeChangeBasedQualityRatio:!1,shouldUseActualFragmentDurationToUpdateBuffer:!1,minBufferLowWatermarkSeconds:0,shouldCompensateForExternalFragmentAcquisitionDelay:!1,recomputeVirtualBufferOnBufferCapacityChange:!0},u={lookAheadType:"FragmentBased",lookAheadWindowSize:5,targetBufferDurationMs:8e3,rebufferingCostFactor:1,switchingCostFactor:2,maxQualityLevelChange:4,estimatedBandwidthSafetyFactor:Number("9e-1"),estimatedBandwidthSafetyFactorForStartup:Number("5e-1"),useThroughputAvg:!1,predictionStrategy:"Bitrate",targetQualityScore:100,deviationCostStrategy:"Symmetrical",rebufferingCostFactorForPerceptualQuality:1,switchingCostFactorForPerceptualQuality:2},c={sessionStartIntervalInMilliseconds:3e3,intervalInMilliseconds:7e4,clusterModel:{type:"NEAREST_NEIGHBOUR",version:"v4",features:["bandwidth_mean","bandwidth_sd","latency_mean","latency_sd"],featureWeights:[Number("25e-2"),Number("25e-2"),Number("25e-2"),Number("25e-2")],centroids:{"1-v4":[Number("8439e-2"),Number("8003e-2"),Number("4823e-2"),Number("2791e-2")],"2-v4":[Number("3409e-2"),Number("1948e-2"),Number("2634e-2"),Number("9840e-2")],"3-v4":[Number("2890e-2"),Number("2222e-2"),Number("4843e-2"),Number("3801e-2")],"4-v4":[Number("1810e-2"),Number("1875e-2"),Number("10776e-2"),Number("14359e-2")],"5-v4":[Number("1224e-2"),Number("744e-2"),Number("5114e-2"),Number("285e-2")],"6-v4":[Number("641-2"),Number("917e-2"),Number("34852e-2"),Number("54041e-2")],"7-v4":[Number("409e-2"),Number("276e-2"),Number("9631e-2"),Number("7836e-2")],"8-v4":[Number("98e-2"),Number("68e-2"),Number("27194e-2"),Number("26790e-2")]},clusterLabelGroups:{"1-v4":"goodNetworkConditions","2-v4":"goodNetworkConditions","3-v4":"goodNetworkConditions","4-v4":"averageNetworkConditions","5-v4":"averageNetworkConditions","6-v4":"badNetworkConditions","7-v4":"badNetworkConditions","8-v4":"badNetworkConditions"}},classifier:{type:"NEAREST_NEIGHBOUR",distanceMeasureType:"EUCLIDEAN_DISTANCE"},featureComputation:{type:"SLIDING_WINDOW",bandwidthAvgFragmentWindow:5,bandwidthStdDevFragmentWindow:10,latencyAvgFragmentWindow:5,latencyStdDevFragmentWindow:10}};t.DefaultContinuousOptimizationSettings=c;var d={audioSelection:n,auxiliaryDownload:{maxAuxiliaryConcurrentRequests:999,maxAuxiliaryRequestsCancellation:999,minBandwidthToMaintainAuxiliaryDownloadKbps:-1,minBandwidthToStartAuxiliaryDownloadKbps:0,minBufferFullnessToMaintainAuxiliaryDownloadSeconds:-1,minBufferFullnessToStartAuxiliaryDownloadSeconds:7},bandwidthPredictor:r,legacyHeuristic:i,bola:f,mpc:u,dynamicBitrateCapping:{dynamicBitrateCappingStrategy:"NoQualityScore",targetQualityScore:100},buffer:{backwardBufferLengthSeconds:32,bufferFullnessForPlaybackResumeSeconds:6,bufferFullnessForPlaybackStartSeconds:6,delayBehindLiveHeadSeconds:30,forwardBufferLengthSeconds:120},filters:o,latencyPredictor:a,player:{heuristicAlgorithm:"DUAL_MODE_HEURISTICS"},retention:{fragmentsToRetain:20,requestsPerFragmentToRetain:4},scheduler:s,timeToDownloadPredictor:l,metadata:{apiCallType:"GPS",classifierName:"DefaultClassification",clusterLabel:"Legacy",clusterModelVersion:"v4",policyId:"DefaultXPPolicyId",treatmentName:"DefaultXPTreatment"},minTimeoutMs:2e3};t.DefaultPlaybackSettings=d}));e(xy);xy.DefaultContinuousOptimizationSettings,xy.DefaultPlaybackSettings;var Fy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function a(){}return a.sanitize=freeOnUnref(function(e,t){var n=[];a.sanitizeBufferSettings(e.buffer,freeOnUnref(function(e){n=n.concat(e)}));for(var r=0,i=a.GRAPH_TYPE_KEYS;r<i.length;r++){var o=i[r];a.sortGraphType(e,o,n)}return 0<n.length&&null!=t&&t(n),e}),a.sanitizeBufferSettings=freeOnUnref(function(e,t){if(null!=e.forwardBufferLengthSeconds){var n=e.forwardBufferLengthSeconds;e.forwardBufferLengthSeconds=Math.max(n,Qe.withDefault(e.bufferFullnessForPlaybackStartSeconds,0),Qe.withDefault(e.bufferFullnessForPlaybackResumeSeconds,0)),n!==e.forwardBufferLengthSeconds&&null!=t&&t(["bufferSettings.forwardBufferLengthSeconds"])}return e}),a.sortGraphType=freeOnUnref(function(e,t,n){var r=Qe.nestedValue(e,t);if(null!=r){for(var i=0;i<r.length-1;++i)if(r[i][0]>r[i+1][0]){n.push(t);break}r.sort(freeOnUnref(function(e,t){return e[0]-t[0]}))}}),a.GRAPH_TYPE_KEYS=["filters.bufferFullnessSecondsToBitrateUpshiftLimitFactorGraph","filters.bufferFullnessSecondsToBitrateDownshiftLimitFactorGraph","filters.bufferFullnessSecondsToBitrateRetryDownshiftLimitFactorGraph","bandwidthPredictor.bufferFullnessSecondsToConfidenceFactorGraph","latencyPredictor.bufferFullnessSecondsToConfidenceFactorGraph","scheduler.bufferFullnessSecondsToTimeoutFactorGraph","timeToDownloadPredictor.bufferFullnessSecondsToBandwidthThrottleFactorGraph","timeToDownloadPredictor.bufferFullnessSecondsToLiveBandwidthThrottleFactorGraph","timeToDownloadPredictor.bufferFullnessSecondsToRetryBandwidthThrottleFactorGraph"],a})();t.PlaybackSettingsSanitizer=n}));e(Fy);Fy.PlaybackSettingsSanitizer;var By=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("PlaybackSettingsProviderFactory");var n=freeOnUnref(function(){function e(){}return e.createFromEncodedPlaybackSettingsResponse=freeOnUnref(function(e,t){void 0===t&&(t=!1);var n=null;null!=e&&(n=ky.PlaybackSettingsParser.fromEncodedString(e));var r=null!=n?n.base:null,i=null;null!=r&&null!=r.continuousOptimization&&(i=r.continuousOptimization),i=Qe.deepExtend(Qe.deepClone(xy.DefaultContinuousOptimizationSettings),i);var o={};null!=r&&null!=r.playbackSettingsMap&&(o=r.playbackSettingsMap);var a=null;null!=r&&(delete(a=r).continuousOptimization,delete r.playbackSettingsMap),t&&(a=null);var s=Fy.PlaybackSettingsSanitizer.sanitize(Qe.deepExtend(Qe.deepClone(xy.DefaultPlaybackSettings),a)),l=this.createClusterSpecificPlaybackSettingsMap(o,s,i);return new Dy.PlaybackSettingsProvider(s,i,l)}),e.createClusterSpecificPlaybackSettingsMap=freeOnUnref(function(e,t,n){var r={};if(!x.isEmpty(e))for(var i=0,o=Object.keys(n.clusterModel.centroids);i<o.length;i++){var a=o[i],s=Fy.PlaybackSettingsSanitizer.sanitize(Qe.deepExtend(Qe.deepClone(t),e[a]));s.metadata.clusterLabel=a,s.metadata.megaClusterLabel=n.clusterModel.clusterLabelGroups[a],r[a]=s}return r}),e})();t.PlaybackSettingsProviderFactory=n}));e(By);By.PlaybackSettingsProviderFactory;var Ly=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioAdaptationSelectionMode=wy.AudioAdaptationSelectionMode,t.PlaybackSettingsMerger=Iy.PlaybackSettingsMerger,t.PlaybackSettingsParser=ky.PlaybackSettingsParser,t.PlaybackSettingsProvider=Dy.PlaybackSettingsProvider,t.PlaybackSettingsProviderFactory=By.PlaybackSettingsProviderFactory,t.PlaybackSettingsSanitizer=Fy.PlaybackSettingsSanitizer}));e(Ly);Ly.AudioAdaptationSelectionMode,Ly.PlaybackSettingsMerger,Ly.PlaybackSettingsParser,Ly.PlaybackSettingsProvider,Ly.PlaybackSettingsProviderFactory,Ly.PlaybackSettingsSanitizer;var Ny=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.v4=freeOnUnref(function(){for(var e=lr.randomEngine,t=new Uint8Array(16),n=0;n<16;n++)t[n]=256*e.getRandom();return t[6]=15&t[6]|64,t[8]=63&t[8]|128,this.bytesToUuid(t)}),e.bytesToUuid=freeOnUnref(function(e){for(var t=[],n=0;n<256;n++)t[n]=(n+256).toString(16).substr(1);var r=0;return[t[e[r++]],t[e[r++]],t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],"-",t[e[r++]],t[e[r++]],t[e[r++]],t[e[r++]],t[e[r++]],t[e[15]]].join("")}),e})();t.UUID=n}));e(Ny);Ny.UUID;var Vy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.UUID=Ny.UUID}));e(Vy);Vy.UUID;var jy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("AcmDeviceInitializationServiceClient"),f="/acm/GetConfiguration/xpPlayerconfigs",n=freeOnUnref(function(){function e(e,t,n,r){this.route=null,this.responseProcessor=freeOnUnref(function(e,t,n,r){var i=e.getText();if(null!==i){var o;try{o=JSON.parse(i)}catch(e){return void n(new ct.XpError("parse",void 0,e.message,!1,e))}if("ERROR"!==Qe.nestedValue(o,"message.statusCode"))t(o);else{var a=Qe.nestedValue(o,"message.body.code",""),s=Qe.nestedValue(o,"message.body.message","");r(new ct.XpError("error_status",void 0,"statusCode='ERROR', code='"+a+"', message='"+s+"'"))}}else n(new ct.XpError("null_response"))}),null!=r&&(this.route=r);var i={deviceID:e,deviceTypeID:t,gascEnabled:null==zt.deviceCapabilities.gascEnabled||zt.deviceCapabilities.gascEnabled},o=zt.deviceInformation.hardware.zipcode;null!=o&&(i["comcast-zipcode"]=o);var a=this.createDeviceProxyUrl("api.amazonvideo.com");l.info("ACM baseServiceUrl: "+a+", SERVICE_ENDPOINT: "+f);var s=new yr.ServiceClientFactory(a,i,n);this.acmServiceClient=s.createServiceClient(f,{firmware:"1",version:"1",format:"json"},this.responseProcessor,"acm")}return e.prototype.send=freeOnUnref(function(e){var t={timeoutMs:freeOnUnref(function(e){return Math.min(4e3+4e3*e,16e3)})};return this.acmServiceClient.send(t,e,"CRITICAL")}),e.prototype.createDeviceProxyUrl=freeOnUnref(function(e){return null!=zt.deviceCapabilities.deviceProxyUrl?zt.deviceCapabilities.deviceProxyUrl:this.prefixBaseUrl(e)}),e.prototype.prefixBaseUrl=freeOnUnref(function(e){return null!=this.route?"https://"+this.route+"."+e:"https://"+this.createAffinityUrl()+"."+e}),e.prototype.createAffinityUrl=freeOnUnref(function(){var e=zt.deviceInformation.software,t=e.operatingSystem,n=e.middleware,r=["xp"];if(x.isEmpty(t.name)||r.push(t.name),null!=n){x.isEmpty(n.name)||r.push(n.name);var i=n.version.replace(/\./g,"-");x.isEmpty(i)||r.push(i)}return r.join("-").replace(/[^\w\-]/gi,"")}),e})();t.AcmServiceClient=n}));e(jy);jy.AcmServiceClient;var qy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("DeviceInitializationServiceClient"),d="/cdp/usage/v2/GetAppStartupConfig",n=freeOnUnref(function(){function e(e,t,n,r,i){var c=this;this.route=null,this.responseProcessor=freeOnUnref(function(e,t,n,r){var i=e.getText();if(null!==i){var o;try{o=JSON.parse(i)}catch(e){return void n(new ct.XpError("parse",void 0,e.message,!1,e))}if("ERROR"!==Qe.nestedValue(o,"message.statusCode")){var a=["customerConfig","deviceConfig","territoryConfig"].filter(freeOnUnref(function(e){return null==o[e]}));if(0===a.length){var s,l=c.extractBaseUrlOverride(o);s=c.serviceEndpoint===d?o.customerConfig.locale&&o.customerConfig.locale.uxLocale:o.customerConfig.preferredLanguage,t({baseUrl:c.createDeviceProxyUrl(o.customerConfig.baseUrl,l),currentTerritory:o.customerConfig.currentTerritory,preferredLanguage:s,marketplaceId:c.extractMarketplaceId(o),deviceConfig:o.deviceConfig.additionalConfig})}else r(new ct.XpError("invalid_response",void 0,"Missing required fields in response: "+a.join()+".",!0))}else{var f=Qe.nestedValue(o,"message.body.code",""),u=Qe.nestedValue(o,"message.body.message","");r(new ct.XpError("error_status",void 0,"statusCode='ERROR', code='"+f+"', message='"+u+"'"))}}else n(new ct.XpError("null_response"))}),null!=r&&(this.route=r),this.serviceEndpoint="/cdp/usage/GetAppStartupConfig";var o={deviceID:e,deviceTypeID:t,gascEnabled:null==zt.deviceCapabilities.gascEnabled||zt.deviceCapabilities.gascEnabled},a=zt.deviceInformation.hardware.zipcode;null!=a&&(o["comcast-zipcode"]=a),"FireOS"===zt.deviceInformation.software.operatingSystem.name&&(o.clientName="PVLRC"),"Kepler"===zt.deviceInformation.software.operatingSystem.name&&(this.serviceEndpoint=d,o.supportedLocales=i||"",o.osLocale=null);var s=this.createDeviceProxyUrl("api.amazonvideo.com");f.info("DIS baseServiceUrl: "+s+", SERVICE_ENDPOINT: "+this.serviceEndpoint);var l=new yr.ServiceClientFactory(s,o,n);this.disServiceClient=l.createServiceClient(this.serviceEndpoint,{firmware:"1",version:"1",format:"json"},this.responseProcessor,"dis")}return e.prototype.send=freeOnUnref(function(e){var t={timeoutMs:freeOnUnref(function(e){return Math.min(4e3+4e3*e,16e3)})};return this.disServiceClient.send(t,e,"CRITICAL")}),e.prototype.createDeviceProxyUrl=freeOnUnref(function(e,t){return null!=t?this.prefixBaseUrl(t):null!=zt.deviceCapabilities.deviceProxyUrl?zt.deviceCapabilities.deviceProxyUrl:this.prefixBaseUrl(e)}),e.prototype.prefixBaseUrl=freeOnUnref(function(e){return null!=this.route?"https://"+this.route+"."+e:"https://"+this.createAffinityUrl()+"."+e}),e.prototype.createAffinityUrl=freeOnUnref(function(){var e=zt.deviceInformation.software,t=e.operatingSystem,n=e.middleware,r=["xp"];if(x.isEmpty(t.name)||r.push(t.name),null!=n){x.isEmpty(n.name)||r.push(n.name);var i=n.version.replace(/\./g,"-");x.isEmpty(i)||r.push(i)}return r.join("-").replace(/[^\w\-]/gi,"")}),e.prototype.extractBaseUrlOverride=freeOnUnref(function(e){if(null!=e.deviceConfig.additionalConfig)for(var t=0,n=e.deviceConfig.additionalConfig.values;t<n.length;t++){var r=n[t];if("xp.deviceProxyBaseUrlOverride"===r.key)return r.value}return null}),e.prototype.extractMarketplaceId=freeOnUnref(function(e){return null!=zt.deviceCapabilities.marketplaceId?zt.deviceCapabilities.marketplaceId:e.customerConfig.marketplaceId}),e})();t.DeviceInitializationServiceClient=n}));e(qy);qy.DeviceInitializationServiceClient;var Hy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function t(){}return t.isClassic=freeOnUnref(function(e){switch(e){case t.DE:case t.JP:case t.UK:case t.US:return!0}return!1}),t.ROE_EU="A3K6Y4MI8GDYMT",t.ROW_EU="A2MFUE2XK8ZSSY",t.ROW_FE="A15PK738MTQHSO",t.ROW_NA="ART4WZ8MWBX2Y",t.DE="A1PA6795UKMFR9",t.JP="A1VC38T7YXB528",t.UK="A1F83G8C2ARO7P",t.US="ATVPDKIKX0DER",t})();t.MarketplaceID=n}));e(Hy);Hy.MarketplaceID;var zy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function r(){}return r.fromMarketplaceId=freeOnUnref(function(e){var t,n=r.getDomainFromMarketplaceId(e);switch(e){case Hy.MarketplaceID.ROW_NA:case Hy.MarketplaceID.US:t=r.US_REGION;break;case Hy.MarketplaceID.ROE_EU:case Hy.MarketplaceID.ROW_EU:case Hy.MarketplaceID.UK:case Hy.MarketplaceID.DE:t=r.EU_REGION;break;case Hy.MarketplaceID.ROW_FE:case Hy.MarketplaceID.JP:t=r.JP_REGION;break;default:throw new Error("Can't get PartnerServiceEndpoint for unknown MarketplaceId! Received: "+e)}return r.PROTOCOL+t+n}),r.getDomainFromMarketplaceId=freeOnUnref(function(e){switch(e){case Hy.MarketplaceID.ROW_NA:case Hy.MarketplaceID.ROE_EU:case Hy.MarketplaceID.ROW_EU:case Hy.MarketplaceID.ROW_FE:return".primevideo.com";case Hy.MarketplaceID.DE:return".amazon.de";case Hy.MarketplaceID.JP:return".amazon.co.jp";case Hy.MarketplaceID.UK:return".amazon.co.uk";default:return".amazon.com"}}),r.EU_REGION="atv-ps-eu",r.JP_REGION="atv-ps-fe",r.US_REGION="atv-ps",r.DOMAIN_REGEX=/.*(\.(amazon|primevideo)\..*)/,r.DEFAULT_DOMAIN=".amazon.com",r.PROTOCOL="https://",r})();t.PartnerServiceEndpoint=n}));e(zy);zy.PartnerServiceEndpoint;var Wy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AcmServiceClient=jy.AcmServiceClient,t.DeviceInitializationServiceClient=qy.DeviceInitializationServiceClient,t.MarketplaceID=Hy.MarketplaceID,t.PartnerServiceEndpoint=zy.PartnerServiceEndpoint}));e(Wy);Wy.AcmServiceClient,Wy.DeviceInitializationServiceClient,Wy.MarketplaceID,Wy.PartnerServiceEndpoint;var Ky=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.items=[]}return e.prototype.getItems=freeOnUnref(function(){return this.items}),e.prototype.appendItem=freeOnUnref(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.items).push.apply(e,t)}),e.prototype.split=freeOnUnref(function(e,t,n,r,i){for(var o=this.splitsies(e,t,n,r),a=o.fromIndex,s=o.toIndex,l=a;l<=s;l++)x.extend(this.items[l],i)}),e.prototype.splice=freeOnUnref(function(e,t,n,r,i){var o,a=this.splitsies(e,t,n,r),s=a.fromIndex,l=a.toIndex,f=0;s===l&&t===r||(f=l-s+1),(o=this.items).splice.apply(o,[s,f].concat(i))}),e.prototype.removeAllItems=freeOnUnref(function(){var e=this.items;return this.items=[],e}),e.prototype.shiftPositionsFrom=freeOnUnref(function(e,t){for(var n=e;n<this.items.length;n++){var r=this.items[n];r.start+=t,null!=r.end&&(r.end+=t)}}),e.prototype.splitsies=freeOnUnref(function(e,t,n,r){var i,o,a=this.splitItemAt(this.items[e],t);return(i=this.items).splice.apply(i,[e,1].concat(a)),this.items[e].start!==t&&e++,n+=a.length-1,a=this.splitItemAt(this.items[n],r),(o=this.items).splice.apply(o,[n,1].concat(a)),this.items[n].start===r&&n--,{fromIndex:e,toIndex:n}}),e.prototype.splitItemAt=freeOnUnref(function(e,t){return isFinite(t)&&e.start<t&&(null===e.end||t<e.end)?[x.extend({},e,{end:t}),x.extend({},e,{start:t})]:[e]}),e})();t.Playlist=n}));e(Ky);Ky.Playlist;var Gy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("PlaylistEngine"),n=freeOnUnref(function(){function e(){this.deferredExecutors=[],this.playlist=new Ky.Playlist,this.currentItemIndex=null,this.currentPosition=null,this.isPlaylistEnded=!1,this.seekInterceptors=[],this.onPositionInterceptors=[],this.autoplayBarriers=[],this.diagnostics=nn.Diagnostics.create("PlaylistEngine"),this.state={currentItemIndex:null,currentPosition:null,isPlaylistEnded:!1,itemCount:this.getItems().length,timestamp:Date.now()},this.eventEmitter=new A.EventEmitter,this.eventEmitter.setMaxListeners(1e3)}return e.prototype.getItems=freeOnUnref(function(){return this.playlist.getItems()}),e.prototype.getCurrentItem=freeOnUnref(function(){return null===this.currentItemIndex?null:this.playlist.getItems()[this.currentItemIndex]}),e.prototype.getCurrentPosition=freeOnUnref(function(){return this.currentPosition}),e.prototype.getCurrentItemIndex=freeOnUnref(function(){return this.currentItemIndex}),e.prototype.registerSeekInterceptor=freeOnUnref(function(e){this.seekInterceptors.push(e)}),e.prototype.deregisterSeekInterceptor=freeOnUnref(function(t){this.seekInterceptors=this.seekInterceptors.filter(freeOnUnref(function(e){return e!==t}))}),e.prototype.registerOnPositionInterceptor=freeOnUnref(function(e){this.onPositionInterceptors.push(e)}),e.prototype.deregisterOnPositionInterceptor=freeOnUnref(function(t){this.onPositionInterceptors=this.onPositionInterceptors.filter(freeOnUnref(function(e){return e!==t}))}),e.prototype.registerAutoplayBarrier=freeOnUnref(function(e){this.autoplayBarriers.push(e)}),e.prototype.appendItem=freeOnUnref(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.playlist).appendItem.apply(e,t),this.checkDeferredExecutors(),this.emitIdempotent("PlaylistUpdate"),this.reportDiagnostics()}),e.prototype.removeAllItems=freeOnUnref(function(){var e=this.playlist.removeAllItems();return this.currentItemIndex=null,this.currentPosition=null,0<e.length&&(this.checkDeferredExecutors(),this.emitIdempotent("PlaylistUpdate")),this.reportDiagnostics(),e}),e.prototype.update=freeOnUnref(function(e,t,n,r,i){null!==this.currentItemIndex&&null!==this.currentPosition&&(this.currentItemIndex+=this.calculatePrePlayheadItemIncrease(e,t,n,r)),this.playlist.split(e,t,n,r,i),this.checkDeferredExecutors(),this.emitIdempotent("PlaylistUpdate"),null!==this.currentItemIndex&&null!==this.currentPosition&&(null==this.getCurrentItem()&&l.warn(">>> update: No current PlaylistItem of Playlist:",this.stringifyCurrentPlaylistItems()),this.eventEmitter.emitSync("EnterItem",{item:this.getCurrentItem(),position:this.currentPosition,seekedTo:!1})),this.reportDiagnostics()}),e.prototype.splice=freeOnUnref(function(e,t,n,r,i){if(null!==this.currentItemIndex&&null!==this.currentPosition&&e<=this.currentItemIndex&&this.currentItemIndex<=n&&t<=this.currentPosition&&this.currentPosition<=r){var o=new Error("Invalid splice over current position");throw this.reportDiagnostics(o),o}null!==this.currentItemIndex&&null!==this.currentPosition&&(this.currentItemIndex+=this.calculatePrePlayheadItemIncrease(e,t,n,r),this.isBeforeCurrentLocation(n,r)&&(this.currentItemIndex+=i.length,this.currentItemIndex-=this.calculateDeleteCount(e,t,n,r))),this.playlist.splice(e,t,n,r,i),this.checkDeferredExecutors(),this.emitIdempotent("PlaylistUpdate"),null!==this.currentItemIndex&&null!==this.currentPosition&&(null==this.getCurrentItem()&&l.warn(">>> splice: No current PlaylistItem of Playlist:",this.stringifyCurrentPlaylistItems()),this.eventEmitter.emitSync("EnterItem",{item:this.getCurrentItem(),position:this.currentPosition,seekedTo:!1})),this.reportDiagnostics()}),e.prototype.onMatch=freeOnUnref(function(e,t){var n=this.playlist.getItems().filter(e);0<n.length?t(n):this.deferredExecutors.push({matcher:e,executor:t})}),e.prototype.seek=freeOnUnref(function(e,t,n){if(l.info(">> seek with position "+e+" and playlistItemIndex "+t),null==t){if(null===this.currentItemIndex){var r=new Error("Invalid seek without a playlistItemIndex");throw this.reportDiagnostics(r),r}t=this.currentItemIndex}var i=this.playlist.getItems()[t];null!=i.start&&e<i.start?e=i.start:null!=i.end&&e>i.end&&(e=i.end);for(var o=0,a=this.seekInterceptors;o<a.length;o++){var s=a[o].getNewSeekTarget(e,t,n);if(null===s)return;e=s.newPosition,t=s.newItemIndex}this.internalSeek(e,t,!0)}),e.prototype.internalSeek=freeOnUnref(function(e,t,n){if(l.info(">> internalSeek with position "+e+" and playlistItemIndex "+t),this.isPlaylistEnded=!1,this.currentPosition=e,t!==this.currentItemIndex){var r=this.getItems()[this.currentItemIndex=t];null==r&&l.warn(">>> internalSeek: No current PlaylistItem of Playlist:",this.stringifyCurrentPlaylistItems()),this.eventEmitter.emitSync("EnterItem",{item:r,position:e,seekedTo:n})}this.eventEmitter.emitSync("Seek",e),this.reportDiagnostics()}),e.prototype.onPosition=freeOnUnref(function(e){if(null===this.currentItemIndex){var t=new Error("Invalid position change without a playlistItemIndex");throw this.reportDiagnostics(t),t}this.currentPosition=e;var n=this.getItems(),r=n[this.currentItemIndex],i=this.currentItemIndex;if(null!==r.end&&this.currentPosition>=r.end&&!this.isPlaylistEnded){var o=n.length-1;if(this.currentItemIndex+1>o)return this.currentPosition=r.end,this.isPlaylistEnded=!0,this.eventEmitter.emitSync("PlaylistEnd"),void this.reportDiagnostics();i=this.currentItemIndex+1}if(i!==this.currentItemIndex){for(var a=this.currentItemIndex,s=0,l=this.onPositionInterceptors;s<l.length;s++){var f=l[s].getNewPositionTarget(e);null!=f&&(e=f.newPosition,a=f.newItemIndex)}if(a!==this.currentItemIndex||e!==this.currentPosition)return void this.internalSeek(e,a,!1);if(!this.canAutoplayBetween(r,n[i]))return this.currentPosition=r.end,this.isPlaylistEnded=!0,this.eventEmitter.emitSync("PlaylistEnd"),void this.reportDiagnostics();this.currentItemIndex++,r=n[this.currentItemIndex],this.currentPosition=r.start,this.eventEmitter.emitSync("EnterItem",{item:r,position:0,seekedTo:!1})}this.reportDiagnostics()}),e.prototype.shiftPositionsFrom=freeOnUnref(function(e,t){if(e<0||e>=this.playlist.getItems().length){var n=new Error("Invalid startIndex "+e);throw this.reportDiagnostics(n),n}null!=this.currentPosition&&null!=this.currentItemIndex&&this.currentItemIndex>=e&&(this.currentPosition+=t),this.playlist.shiftPositionsFrom(e,t),this.checkDeferredExecutors(),this.emitIdempotent("PlaylistUpdate"),this.reportDiagnostics()}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.eventEmitter.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.emit=freeOnUnref(function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];(t=this.eventEmitter).emit.apply(t,[e].concat(n))}),e.prototype.emitIdempotent=freeOnUnref(function(e){this.eventEmitter.emitIdempotent(e)}),e.prototype.checkDeferredExecutors=freeOnUnref(function(){var e=this.deferredExecutors;this.deferredExecutors=[];for(var t=0,n=e;t<n.length;t++){var r=n[t];this.onMatch(r.matcher,r.executor)}}),e.prototype.calculatePrePlayheadItemIncrease=freeOnUnref(function(e,t,n,r){if(null===this.currentItemIndex||null===this.currentPosition)return 0;var i=0,o=this.playlist.getItems(),a=o[e];this.isBeforeCurrentLocation(e,t)&&a.start<t&&t<a.end&&i++;var s=o[n];return this.isBeforeCurrentLocation(n,r)&&s.start<r&&r<s.end&&i++,e===n&&t===r&&2===i&&i--,i}),e.prototype.calculateDeleteCount=freeOnUnref(function(e,t,n,r){if(null===this.currentItemIndex||null===this.currentPosition)return 0;if(e===n&&t===r)return 0;if(n===e)return 1;var i=n-e-1,o=this.playlist.getItems();return o[e].end!==t&&i++,o[n].start!==r&&i++,i}),e.prototype.isBeforeCurrentLocation=freeOnUnref(function(e,t){return null!==this.currentItemIndex&&null!==this.currentPosition&&(e<this.currentItemIndex||this.currentItemIndex===e&&t<this.currentPosition)}),e.prototype.canAutoplayBetween=freeOnUnref(function(t,n){return this.autoplayBarriers.every(freeOnUnref(function(e){return e.canAutoplayBetween(t,n)}))}),e.prototype.reportDiagnostics=freeOnUnref(function(e){this.state.currentItemIndex=this.currentItemIndex,this.state.currentPosition=this.currentPosition,this.state.isPlaylistEnded=this.isPlaylistEnded,this.state.itemCount=this.getItems().length;var t=Date.now();this.state.timestamp=t,null!=e&&(this.state.lastThrownError=e,this.state.lastThrownErrorTimestamp=t),this.diagnostics.report("state",this.state)}),e.prototype.stringifyCurrentPlaylistItems=freeOnUnref(function(){return JSON.stringify(this.playlist.getItems().map(freeOnUnref(function(e){return{start:e.start,end:e.end}})))}),e.prototype.tracePlaylistItems=freeOnUnref(function(e){if(de.enabledFor(de.INFO)){var t=this.getItems();if(0===t.length)return;for(var n=new au.TableFormatterGeneric,r=0,i=e(t);r<i.length;r++){var o=i[r];n.addRow(o)}l.info("Playlist updated, items:\n"+n.renderString())}}),e})();t.PlaylistEngine=n}));e(Gy);Gy.PlaylistEngine;var Qy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=Object.keys({EnterView:null,ExitView:null}),n=freeOnUnref(function(){function e(e,t){var n=this;this.isViewItem=freeOnUnref(function(e){return null!==e&&x.isMatch(e,n.id)}),this.currentItem=null,this.onEnterItem=freeOnUnref(function(e){n.isViewItem(e.item)&&!n.isViewItem(n.currentItem)?n.eventEmitter.emit("EnterView",e.seekedTo):!n.isViewItem(e.item)&&n.isViewItem(n.currentItem)&&n.eventEmitter.emit("ExitView",e.seekedTo),n.currentItem=e.item}),this.playlistEngine=e,this.id=t,this.eventEmitter=new A.EventEmitter}return e.prototype.isActive=freeOnUnref(function(){return this.isViewItem(this.playlistEngine.getCurrentItem())}),e.prototype.createItem=freeOnUnref(function(e){return x.extend({},this.id,e)}),e.prototype.appendItem=freeOnUnref(function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=n.map(freeOnUnref(function(e){return x.extend(e,t.id)}));(e=this.playlistEngine).appendItem.apply(e,i)}),e.prototype.getItems=freeOnUnref(function(){return this.playlistEngine.getItems().filter(this.isViewItem)}),e.prototype.awaitItems=freeOnUnref(function(e){this.playlistEngine.onMatch(this.isViewItem,e)}),e.prototype.on=freeOnUnref(function(e,t){0===this.getTotalEventEmitterListenerCount()&&(this.currentItem=this.playlistEngine.getCurrentItem(),this.playlistEngine.on("EnterItem",this.onEnterItem)),this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t),0===this.getTotalEventEmitterListenerCount()&&this.playlistEngine.off("EnterItem",this.onEnterItem)}),e.prototype.getTotalEventEmitterListenerCount=freeOnUnref(function(){for(var e=0,t=0,n=i;t<n.length;t++){var r=n[t];e+=this.eventEmitter.listeners(r).length}return e}),e.prototype.createViewRangeError=freeOnUnref(function(e){for(var t=[],n=0,r=this.playlistEngine.getItems();n<r.length;n++){var i=r[n];this.isViewItem(i)&&t.push({start:i.start,end:i.end})}return new Error("Position "+e+" not in View: "+JSON.stringify(t))}),e})();t.View=n}));e(Qy);Qy.View;var Xy=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return r(n,e),n.fromView=freeOnUnref(function(e,t){return new n(e.playlistEngine,x.extend({},e.id,t))}),n.prototype.update=freeOnUnref(function(e,t,n){var r=this.getItemLocation(e),i=this.getItemLocation(t);this.playlistEngine.update(r.index,r.position,i.index,i.position,n)}),n.prototype.splice=freeOnUnref(function(e,t,n){var r=this.getItemLocation(e),i=this.getItemLocation(t);this.playlistEngine.splice(r.index,r.position,i.index,i.position,n)}),n.prototype.getItemLocation=freeOnUnref(function(e){for(var t=this.playlistEngine.getItems(),n=0,r=0;r<t.length;r++){var i=t[r];if(this.isViewItem(i)){var o=void 0;o=null===i.end?1/0:i.end-i.start;var a=e-n;if(0<=a&&a<=o)return{index:r,position:i.start+a};n+=o}}throw this.createViewRangeError(e)}),n})(Qy.View);t.ItemRelativeView=n}));e(Xy);Xy.ItemRelativeView;var Yy=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return r(n,e),n.fromView=freeOnUnref(function(e,t){return new n(e.playlistEngine,x.extend({},e.id,t))}),n.prototype.update=freeOnUnref(function(e,t,n){this.playlistEngine.update(this.getItemIndex(e),e,this.getItemIndex(t),t,n)}),n.prototype.splice=freeOnUnref(function(e,t,n){this.playlistEngine.splice(this.getItemIndex(e),e,this.getItemIndex(t),t,n)}),n.prototype.getItemIndex=freeOnUnref(function(e){for(var t=this.playlistEngine.getItems(),n=0;n<t.length;n++){var r=t[n];if(this.isViewItem(r)&&(r.start<=e&&(null===r.end||e<=r.end)))return n}throw this.createViewRangeError(e)}),n})(Qy.View);t.PlaylistRelativeView=n}));e(Yy);Yy.PlaylistRelativeView;var Jy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlaylistEngine=Gy.PlaylistEngine,t.ItemRelativeView=Xy.ItemRelativeView,t.PlaylistRelativeView=Yy.PlaylistRelativeView,t.View=Qy.View}));e(Jy);Jy.PlaylistEngine,Jy.ItemRelativeView,Jy.PlaylistRelativeView,Jy.View;var Zy=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=[500,503],o={backoffBaseMs:100,backoffMaxMs:5e3,backoffModifier:2,jitterMs:60},a=de.get("BeaconServiceClientHttp"),n=freeOnUnref(function(){function e(){}return e.prototype.send=freeOnUnref(function(e,t){void 0===t&&(t=o);for(var n=0,r=e;n<r.length;n++){var i=r[n];this.fireBeacon(i,t)}}),e.prototype.fireBeacon=freeOnUnref(function(i,e){var o=this;(new _n.ExponentialBackoffRetry).withMaxAttempts(4).withInitialIntervalMs(e.backoffBaseMs).withExponentialFactor(e.backoffModifier).withRandomizationFactor(e.jitterMs).withMaxDelayMs(e.backoffMaxMs).onAttempt(freeOnUnref(function(e,t,n,r){o.sendRequest(i,t)})).execute()}),e.prototype.sendRequest=freeOnUnref(function(n,r){var e;"POST"===n.method?(e=pn.HttpRequest.post(n.url),null!=n.data&&e.body(n.data)):e=pn.HttpRequest.get(n.url),e.timeout(5e3).contentType("application/json").onLoad(freeOnUnref(function(e){a.info("Tracking event "+n.url+" sent.")})).onError(freeOnUnref(function(e,t){a.error("Error while sending tracking event "+n.url+": "+e.message),(null==t||x.contains(i,t.getStatus()))&&r(e)})).send()}),e.prototype.sendAuditPing=freeOnUnref(function(e,t,n,r){pn.HttpRequest.get(e).timeout(5e3).withFollowRedirects(!0).onLoad(freeOnUnref(function(e){t()})).onError(freeOnUnref(function(e,t){null==t||x.contains(i,t.getStatus())?n(e):r(e)})).send()}),e})();t.BeaconServiceClientHttp=n}));e(Zy);Zy.BeaconServiceClientHttp;var $y=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BeaconServiceClient=Zy.BeaconServiceClientHttp}));e($y);$y.BeaconServiceClient;var eg=t(freeOnUnref(function(e,t){function a(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n],o="["+i+"]";e=e.replace(o,t[i]).replace(encodeURIComponent(o),t[i])}return e}Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.beaconServiceClient=new $y.BeaconServiceClient,this.enableEventReporting=!0}return e.prototype.toggleReporting=freeOnUnref(function(e){this.enableEventReporting=e}),e.prototype.send=freeOnUnref(function(e,t,n){if(void 0===t&&(t={}),this.enableEventReporting){for(var r=0,i=e;r<i.length;r++){var o=i[r];o.url=a(o.url,t)}this.beaconServiceClient.send(e,n)}}),e})();t.AdEventReporter=n}));e(eg);eg.AdEventReporter;var tg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.validate=freeOnUnref(function(e,t){if(null!=e&&null!=t)for(var n=t,r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];null!=e[o]&&("object"!=typeof e[o]||Array.isArray(e[o])?"string"!=typeof e[o]&&"number"!=typeof e[o]&&!Array.isArray(e[o])||null==n[o]||(e[o]=n[o].constrain(e[o])):this.validate(e[o],n[o]))}}),e.validateMap=freeOnUnref(function(e,t,n){for(var r={},i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];(a=a.replace(/\s/g,"")).length>t||!a.match(/^[a-zA-Z0-9_]+$/)||null!=e[a]&&(r[a]=e[a].trim().substring(0,n))}return r}),e.validateNumberMap=freeOnUnref(function(e,t,n){var r={};if(!e)return r;for(var i=0,o=0,a=Object.keys(e);o<a.length;o++){var s=a[o],l=s.replace(/\s/g,"");if(!(l.length>t)&&l.match(/^[a-zA-Z0-9_]+$/)&&(null!=e[s]&&!isNaN(e[s])&&isFinite(e[s])&&(r[l]=e[s],n<=++i)))break}return r}),e})();t.ValidationUtils=n}));e(tg);tg.ValidationUtils;var ng=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){void 0===e&&(e=Number.MIN_VALUE),void 0===t&&(t=Number.MAX_VALUE),this.minValue=e,this.maxValue=t}return e.prototype.constrain=freeOnUnref(function(e){return this.minValue>this.maxValue?e:e>this.maxValue?this.maxValue:e<this.minValue?this.minValue:e}),e})();t.NumberValidator=n}));e(ng);ng.NumberValidator;var rg=t(freeOnUnref(function(e,t){var n,r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});function o(e){return e<0?Math.ceil(e):Math.floor(e)}var a=((n={})[0]=o,n[1]=freeOnUnref(function(e){return Math.floor(e)}),n[2]=freeOnUnref(function(e){return Math.ceil(e)}),n[3]=freeOnUnref(function(e){return Math.round(e)}),n),i=freeOnUnref(function(i){function e(e,t,n){void 0===e&&(e=-9007199254740991),void 0===t&&(t=9007199254740991),void 0===n&&(n=0);var r=i.call(this,o(e),o(t))||this;return r.round=a[n],r}return r(e,i),e.prototype.constrain=freeOnUnref(function(e){var t=this.round(e);return i.prototype.constrain.call(this,t)}),e})(ng.NumberValidator);t.IntegerValidator=i}));e(rg);rg.IntegerValidator;var ig=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.maxLength=Qe.withDefault(n,t),this.elementValidator=e}return e.prototype.constrain=freeOnUnref(function(e){var t=this;return(null==this.maxLength?e:e.slice(0,this.maxLength)).map(freeOnUnref(function(e){return"object"==typeof e?(tg.ValidationUtils.validate(e,t.elementValidator),e):t.elementValidator.constrain(e)}))}),e})();t.ListValidator=n}));e(ig);ig.ListValidator;var og=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.maxLength=Qe.withDefault(t,e)}return e.prototype.constrain=freeOnUnref(function(e){return e.substring(0,this.maxLength)}),e})();t.StringValidator=n}));e(og);og.StringValidator;var ag=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=new og.StringValidator(36,36);t.playerInstanceIdValidator=n;var r=new og.StringValidator(36,36);t.watchSessionIdValidator=r}));e(ag);ag.playerInstanceIdValidator,ag.watchSessionIdValidator;var sg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{assets:new ig.ListValidator({description:{duration:new rg.IntegerValidator},uiFeatures:new ig.ListValidator(new og.StringValidator(16)),deliveries:new ig.ListValidator({})})},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.AssetFulfillmentEventValidatable=n}));e(sg);sg.AssetFulfillmentEventValidatable;var lg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createAssetFulfillmentEvent=freeOnUnref(function(e,t,n,r){var i={_type:"AssetFulfillment",playerInstanceId:n,watchSessionId:r,body:{adDeliverySessionId:e,assets:t}};return tg.ValidationUtils.validate(i,sg.AssetFulfillmentEventValidatable),i}),e})();t.AssetFulfillmentEventFactory=n}));e(lg);lg.AssetFulfillmentEventFactory;var fg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.getReportingServiceUrlFromMarketplaceId=freeOnUnref(function(e){if(__HOMEBREW_NOTELEMETRY){return"http://"+__HOMEBREW_DEBUG_LOGS_ENDPOINT+"/telemetry-sink"}if(null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.mediaEventReporting&&"enabled"===L.configurationStore.configuration.mediaEventReporting.useGlobalTelemetryUrl)return"https://global.telemetry.insights.video.a2z.com";var t;switch(e){case Wy.MarketplaceID.ROW_NA:case Wy.MarketplaceID.US:t="api.us-east-1";break;case Wy.MarketplaceID.ROE_EU:case Wy.MarketplaceID.ROW_EU:case Wy.MarketplaceID.UK:case Wy.MarketplaceID.DE:t="api.eu-west-1";break;case Wy.MarketplaceID.ROW_FE:case Wy.MarketplaceID.JP:t="api.us-west-2";break;default:throw new Error("Can't get ReportingServiceUrl for unknown MarketplaceId! Received: "+e)}return"https://"+t+".aiv-delivery.net"}),e.SCHEMA_VERSION="AV20180601",e.UNRETRIABLE_HTTP_ERROR_CODES=[400,404,410],e})();t.MediaEventConstants=n}));e(fg);fg.MediaEventConstants;var ug=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("OfflineReportingBatchManager"),n=freeOnUnref(function(){function e(e,t,n){var r=this;this.dispatchReportingBatches=freeOnUnref(function(t){0<r.localReportingBatchKeys.length?r.executeRetriableReportingBatchRequest(t):r.listReportingBatchKeys().then(freeOnUnref(function(e){0!==e.length&&r.executeRetriableReportingBatchRequest(t)}))}),this.localKeyPrefix=e,this.maxKeyCount=t,this.maxKeyExpirationDays=n,this.localReportingBatchKeys=[],this.keyRegEx=new RegExp("^"+this.localKeyPrefix+"(\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z)_[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"),this.cleanupReportingBatches()}return e.prototype.storeReportingBatch=freeOnUnref(function(e){var t=this,n=this.generateKeyName();return Pt.localStorage.put(n,this.serializeReportingBatch(e)).then(freeOnUnref(function(){t.localReportingBatchKeys.push(n)}))}),e.prototype.cleanupReportingBatches=freeOnUnref(function(){var l=this;this.localReportingBatchKeys.length<=this.maxKeyCount&&0<this.localReportingBatchKeys.length&&!this.isKeyExpired(this.localReportingBatchKeys[0])||Pt.localStorage.listKeys(this.localKeyPrefix).then(freeOnUnref(function(e){e.sort();var t=[];e.length>l.maxKeyCount&&(t=e.slice(0,e.length-l.maxKeyCount),e=e.slice(e.length-l.maxKeyCount)),l.localReportingBatchKeys=[];for(var n=0,r=e;n<r.length;n++){var i=r[n];l.isKeyExpired(i)?t.push(i):l.localReportingBatchKeys.push(i)}for(var o=0,a=t;o<a.length;o++){var s=a[o];l.deleteReportingBatch(s)}})).catch(freeOnUnref(function(e){i.error("Encountered error when cleaning up reporting batches.",e)}))}),e.prototype.executeRetriableReportingBatchRequest=freeOnUnref(function(t){var n=this,r=this.localReportingBatchKeys.shift();this.getReportingBatch(r).then(freeOnUnref(function(e){t(e).then(freeOnUnref(function(){n.deleteReportingBatch(r).catch(freeOnUnref(function(e){i.error("Encountered error while deleting reporting batch from local storage: "+e)})).then(freeOnUnref(function(){n.dispatchReportingBatches(t)}))}))})).catch(freeOnUnref(function(e){n.localReportingBatchKeys.push(r),n.localReportingBatchKeys.sort(),i.error("Failed to get reporting batch from local storage: "+e)}))}),e.prototype.listReportingBatchKeys=freeOnUnref(function(){var t=this;return Pt.localStorage.listKeys(this.localKeyPrefix).then(freeOnUnref(function(e){return e.sort(),t.localReportingBatchKeys=e})).catch(freeOnUnref(function(e){return i.error("Failed to list keys from local storage: "+e),lt.Promise.resolve([])}))}),e.prototype.getReportingBatch=freeOnUnref(function(t){var n=this;return Pt.localStorage.getText(t).then(freeOnUnref(function(e){if(null==e)throw new Error("Reporting batch obtained from local storage is null. Key: "+t);return n.deserializeReportingBatch(e)})).catch(freeOnUnref(function(e){return i.error("Failed to get reporting batch from local storage: "+e),lt.Promise.reject(e)}))}),e.prototype.deleteReportingBatch=freeOnUnref(function(t){var e=this;return Pt.localStorage.remove(t).then(freeOnUnref(function(){e.localReportingBatchKeys=e.localReportingBatchKeys.filter(freeOnUnref(function(e){return e!==t}))}))}),e.prototype.serializeReportingBatch=freeOnUnref(function(e){return JSON.stringify(e)}),e.prototype.deserializeReportingBatch=freeOnUnref(function(e){return JSON.parse(e)}),e.prototype.getTimestampFromKey=freeOnUnref(function(e){var t=e.match(this.keyRegEx);return t?new Date(t[1]).getTime():null}),e.prototype.isKeyExpired=freeOnUnref(function(e){var t=this.getTimestampFromKey(e);return!(null!=t&&!isNaN(t))||(Date.now()-t)/864e5>this.maxKeyExpirationDays}),e.prototype.generateKeyName=freeOnUnref(function(){return this.localKeyPrefix+(new Date).toISOString()+"_"+Vy.UUID.v4()}),e})();t.OfflineReportingBatchManager=n}));e(ug);ug.OfflineReportingBatchManager;var cg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.storeReportingBatch=freeOnUnref(function(e){return lt.Promise.resolve()}),e.prototype.cleanupReportingBatches=freeOnUnref(function(){}),e.prototype.dispatchReportingBatches=freeOnUnref(function(e){}),e})();t.BlackHoleOfflineReportingBatchManager=n}));e(cg);cg.BlackHoleOfflineReportingBatchManager;var dg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("OfflineReportingBatchManagerFactory"),n=freeOnUnref(function(){function i(){}return i.createOfflineReportingBatchManager=freeOnUnref(function(e,t,n,r){return!0===r&&!0===zt.deviceInformation.software.offlineDownloadsEnabled?Pt.localStorage.capabilities.isSupported?(o.info("Offline reporting enabled. Creating OfflineReportingBatchManager."),new ug.OfflineReportingBatchManager(e,t,n)):(o.warn("Offline reporting is enabled but Local Storage not available. Creating BlackHoleOfflineReportingBatchManager."),new cg.BlackHoleOfflineReportingBatchManager):(o.info("Offline reporting disabled. Creating BlackHoleOfflineReportingBatchManager."),Pt.localStorage.capabilities.isSupported&&(o.info("Deleting any old data for "+e+"."),i.deleteOldOfflineData(e)),new cg.BlackHoleOfflineReportingBatchManager)}),i.deleteOldOfflineData=freeOnUnref(function(r){lt.Promise.resolve().then(freeOnUnref(function(){return Pt.localStorage.listKeys(r).then(freeOnUnref(function(e){return o.info("Found "+e.length+" offline metrics for "+r+" to delete."),e})).catch(freeOnUnref(function(e){return o.error("Error listing offline metrics for "+r,e),null}))})).then(freeOnUnref(function(t){var n=Date.now();return Pt.localStorage.removePrefix(r).then(freeOnUnref(function(){var e=Date.now();null==t?o.info("Deleted offline metrics for "+r+". Time taken: "+(e-n)+" ms."):o.info("Deleted "+t.length+" offline metric(s) for "+r+". Time taken: "+(e-n)+" ms.")})).catch(freeOnUnref(function(e){o.error("Error deleting offline metrics for "+r,e)}))}))}),i})();t.OfflineReportingBatchManagerFactory=n}));e(dg);dg.OfflineReportingBatchManagerFactory;var pg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineReportingBatchManagerFactory=dg.OfflineReportingBatchManagerFactory}));e(pg);pg.OfflineReportingBatchManagerFactory;var hg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="/Bootstrap/"+fg.MediaEventConstants.SCHEMA_VERSION,r=freeOnUnref(function(){function e(e,t){this.retry=null,this.request=null,this.url=e.replace(/\/$/,"")+n,this.authContext=t}return e.prototype.send=freeOnUnref(function(e,t){var i=this;this.retry=(new _n.ExponentialBackoffRetry).withMaxAttempts(4).withInitialIntervalMs(500).withExponentialFactor(2).withRandomizationFactor(200).onSuccess(e).onError(t).onAttempt(freeOnUnref(function(e,t,n,r){i.sendRequest(e,t,n,r)})).execute()}),e.prototype.abort=freeOnUnref(function(){null!==this.retry&&(this.retry.abort(),this.retry=null),null!==this.request&&(this.request.abort(),this.request=null)}),e.prototype.sendRequest=freeOnUnref(function(e,r,i,n){var o=this;this.request=pn.HttpRequest.get(this.url).headers(this.authContext.getHeaders()).accept("application/json").timeout(6e3).onError(freeOnUnref(function(e,t){null==t||fg.MediaEventConstants.UNRETRIABLE_HTTP_ERROR_CODES.indexOf(t.getStatus())<0?r(e):n(e)})).onLoad(freeOnUnref(function(e){o.request=null;var t,n=e.getText();try{t=JSON.parse(n)}catch(e){return void r(new Error("JSON parsing error in bootstrapping response."))}i(t)})),this.request.send()}),e})();t.BootstrappingRequest=r}));e(hg);hg.BootstrappingRequest;var mg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.request=null,this.requestPromise=null,this.url=e,this.authContext=t,this.configuration=null}return e.prototype.getBootstrappingConfiguration=freeOnUnref(function(){return null==this.requestPromise&&this.sendRequest(),this.requestPromise}),e.prototype.sendRequest=freeOnUnref(function(){var n=this;this.request=new hg.BootstrappingRequest(this.url,this.authContext),this.requestPromise=new lt.Promise(freeOnUnref(function(t,e){n.request.send(freeOnUnref(function(e){n.onSuccess(e),t(n.configuration)}),freeOnUnref(function(e){n.onFail(e),t(n.configuration)}))}))}),e.prototype.onSuccess=freeOnUnref(function(e){this.configuration=e,this.request=null}),e.prototype.onFail=freeOnUnref(function(e){this.configuration={appInstanceId:Vy.UUID.v4(),batching:{period:3e4,depth:300},events:{},retry:{modifier:1.5,max:3e5,jitter:5e3}},this.request=null}),e})();t.Bootstrapper=n}));e(mg);mg.Bootstrapper;var yg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.bootstrappingConfiguration=null,this.getContextualMediaEvents=freeOnUnref(function(){return[]}),this.masterSequence=0,this.mediaEvents=[],this.pendingMediaEvents=[],this.timeProvider=e}return e.prototype.batchMediaEvents=freeOnUnref(function(e){if(null==this.bootstrappingConfiguration)return this.pendingMediaEvents=this.pendingMediaEvents.concat(e),!1;for(var t=!1,n=0,r=0===this.mediaEvents.length?this.getContextualMediaEvents().concat(e):e;n<r.length;n++){var i=r[n],o=i._type,a=this.bootstrappingConfiguration.events[o];if(null==a||!1!==a.enabled){var s=null!=a&&!0===a.forceDispatch;if("Error"===i._type){var l=i;null!=l.body&&(s=s&&l.body.fatal)}t=t||s,this.addMetadataToMediaEvent(i),this.mediaEvents.push(i)}}return this.reachedBatchingDepth()||t}),e.prototype.getMediaEvents=freeOnUnref(function(){return this.mediaEvents}),e.prototype.resetMediaEvents=freeOnUnref(function(){this.mediaEvents=[]}),e.prototype.setContextualMediaEventsCallback=freeOnUnref(function(e){this.getContextualMediaEvents=e}),e.prototype.setBootstrappingConfiguration=freeOnUnref(function(e){this.bootstrappingConfiguration=e,this.batchMediaEvents(this.pendingMediaEvents),this.pendingMediaEvents=[]}),e.prototype.addMetadataToMediaEvent=freeOnUnref(function(e){var t=e;t.reltime=Math.round(this.timeProvider.getHighResRelativeTimeMs()),t.sequence=this.masterSequence++,null==t.timestamp&&(t.timestamp=Date.now())}),e.prototype.reachedBatchingDepth=freeOnUnref(function(){return null!=this.bootstrappingConfiguration&&this.mediaEvents.length>=this.bootstrappingConfiguration.batching.depth}),e})();t.MediaEventBatcher=n}));e(yg);yg.MediaEventBatcher;var gg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.initialize=freeOnUnref(function(){}),e.prototype.prepare=freeOnUnref(function(){}),e.prototype.stop=freeOnUnref(function(){}),e.prototype.reportEvent=freeOnUnref(function(){}),e})();t.NoOpTelemetryReporter=n}));e(gg);gg.NoOpTelemetryReporter;var vg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="RemoteTelemetryModule",s="RemoteTelemetryReporter",r=de.get("RemoteTelemetryReporter"),i=freeOnUnref(function(){function e(e){var t=this;this.bootstrappingConfiguration=null,this.getContextualMediaEvents=null,this.eventsSinceLastBatch=0,this.lastBatchTimeMs=null,this.reportingEnabled=!1,this.objectBridge=e,r.info("Registering "+n+" on Object Bridge"),e.register(n,{start:freeOnUnref(function(){r.info("Reporter started"),t.reportingEnabled=!0}),stop:freeOnUnref(function(){r.info("Reporter stopped"),t.reportingEnabled=!1})}),this.currentMetrics=this.newMetrics()}return e.prototype.initialize=freeOnUnref(function(e){this.bootstrappingConfiguration=e}),e.prototype.stop=freeOnUnref(function(){r.info("Deregistering "+n+" on Object Bridge"),this.objectBridge.deregister(n)}),e.prototype.prepare=freeOnUnref(function(e){this.getContextualMediaEvents=e}),e.prototype.reportEvent=freeOnUnref(function(e){var t=this;if(this.reportingEnabled&&null!=this.bootstrappingConfiguration){var n=Date.now(),r=this.bootstrappingConfiguration.batching;if(null==this.lastBatchTimeMs||r.period<=n-this.lastBatchTimeMs||r.depth<=this.eventsSinceLastBatch){if(null!=this.getContextualMediaEvents){var i=this.getContextualMediaEvents();if(0<i.length){var o=JSON.stringify(i).length;this.objectBridge.call(s,"reportContextualEvents",[i]).then(freeOnUnref(function(e){t.currentMetrics.batchesSent++,t.currentMetrics.contextualEvents+=i.length,t.currentMetrics.contextualEventsTotalPayloadBytes+=o,t.currentMetrics.contextualEventsTotalTimeMs+=e.timeReceived-n})).catch(freeOnUnref(function(){t.currentMetrics.batchErrors++})).then(freeOnUnref(function(){t.logMetrics()}))}}this.lastBatchTimeMs=n,this.eventsSinceLastBatch=0}var a=JSON.stringify(e).length;this.objectBridge.call(s,"reportEvent",[e]).then(freeOnUnref(function(e){t.currentMetrics.regularEvents++,t.currentMetrics.regularEventsTotalPayloadBytes+=a,t.currentMetrics.regularEventsTotalTimeMs+=e.timeReceived-n})).catch(freeOnUnref(function(){t.currentMetrics.regularEventErrors++})),this.eventsSinceLastBatch++}}),e.prototype.resetMetrics=freeOnUnref(function(){this.currentMetrics=this.newMetrics()}),e.prototype.newMetrics=freeOnUnref(function(){return{regularEvents:0,regularEventErrors:0,regularEventsTotalPayloadBytes:0,regularEventsTotalTimeMs:0,batchesSent:0,batchErrors:0,contextualEvents:0,contextualEventsTotalTimeMs:0,contextualEventsTotalPayloadBytes:0}}),e.prototype.logMetrics=freeOnUnref(function(){r.info("Stats: "+JSON.stringify(this.currentMetrics)),this.resetMetrics()}),e})();t.RemoteTelemetryReporter=i}));e(vg);vg.RemoteTelemetryReporter;var Og=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("TelemetryReporterFactory"),r=freeOnUnref(function(){function e(){}return e.createTestTelemetryReporter=freeOnUnref(function(){var e=xt.platformRuntime.configuration.objectBridge;return null==e?(n.info("Creating NoOpTelemetryReporter, Remote Bridge not available on this device"),new gg.NoOpTelemetryReporter):null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.mediaEventReporting&&!0===L.configurationStore.configuration.mediaEventReporting.enableRemoteTelemetrySdkReporting?(n.info("Creating RemoteTelemetryReporter (enabled by DIS)"),new vg.RemoteTelemetryReporter(e)):(n.info("Creating NoOpTelemetryReporter, RemoteTelemetryReporter not enabled by DIS"),new gg.NoOpTelemetryReporter)}),e})();t.TelemetryReporterFactory=r}));e(Og);Og.TelemetryReporterFactory;var Sg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){void 0===e&&(e=Date),this.dateConstructor=e,this.performanceRef=void 0===t&&"undefined"!=typeof performance?performance:t}return e.prototype.getHighResRelativeTimeMs=freeOnUnref(function(){return void 0===this.performanceRef?(new this.dateConstructor).getTime():this.performanceRef.now()}),e})();t.TimeProvider=n}));e(Sg);Sg.TimeProvider;var Ug=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.CustomMetricsEventValidatable=n}));e(Ug);Ug.CustomMetricsEventValidatable;var bg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createCustomMetricsEvent=freeOnUnref(function(e,t,n){var r={_type:"CustomMetrics",playerInstanceId:t,watchSessionId:n,body:{metrics:tg.ValidationUtils.validateNumberMap(e,100,50)}};return tg.ValidationUtils.validate(r,Ug.CustomMetricsEventValidatable),r}),e})();t.CustomMetricsEventFactory=n}));e(bg);bg.CustomMetricsEventFactory;var Pg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("MediaEventReporter"),r="/Events/"+fg.MediaEventConstants.SCHEMA_VERSION,n=freeOnUnref(function(){function e(){var u=this;this.bootstrapper=null,this.bootstrappingConfiguration=null,this.dispatchInterval=null,this.offlineReportingBatchManager=null,this.dispatchMediaEvents=freeOnUnref(function(){var e;if(0!==u.mediaEventBatcher.getMediaEvents().length&&null!=u.bootstrappingConfiguration){for(var t=0,n=0,r=u.mediaEventBatcher.getMediaEvents();n<r.length;n++){var i=r[n];if(u.isCustomMetricsEvent(i))for(var o=i.body.metrics,a=0,s=Object.keys(o);a<s.length;a++){0===s[a].indexOf("CMR_")&&t++}}if(0<t){var l=bg.CustomMetricsEventFactory.createCustomMetricsEvent(((e={}).CMR_CustomMetrics_Cnt=t,e),null,null);u.mediaEventBatcher.batchMediaEvents([l])}var f=u.mediaEventBatcher.getMediaEvents();u.mediaEventBatcher.resetMediaEvents(),"none"!==zt.deviceCapabilities.network.type?(u.buildRetriableMediaEventRequestSender(f).onError(freeOnUnref(function(e){return u.storeMediaEvents(f)})).onAttempt(freeOnUnref(function(e,t,n,r){f=f.concat(u.mediaEventBatcher.getMediaEvents()),u.mediaEventBatcher.resetMediaEvents(),u.sendMediaEventRequest(f,e,t,n,r)})).execute(),u.tryDispatchOfflineMediaEvents()):u.storeMediaEvents(f)}}),this.tryDispatchOfflineMediaEvents=freeOnUnref(function(){if(null!=u.offlineReportingBatchManager){if("none"!==zt.deviceCapabilities.network.type){var e=freeOnUnref(function(n){return new lt.Promise(freeOnUnref(function(e,t){u.buildRetriableMediaEventRequestSender(n).onSuccess(freeOnUnref(function(){e()})).onError(freeOnUnref(function(e){t(e)})).execute()}))});u.offlineReportingBatchManager.dispatchReportingBatches(e)}}else l.warn("tryDispatchOfflineMediaEvents called even though OfflineReportingBatchManager is not initialized")}),this.buildRetriableMediaEventRequestSender=freeOnUnref(function(i){return(new _n.ExponentialBackoffRetry).withInitialIntervalMs(1e4).withExponentialFactor(2).withMaxElapsedTimeMs(3e5).withRandomizationFactor(u.bootstrappingConfiguration.retry.jitter).onSuccess(freeOnUnref(function(e){u.updateBootstrappingConfiguration(e)})).onError(freeOnUnref(function(e){l.error("Failed to send media event request: "+e)})).onAttempt(freeOnUnref(function(e,t,n,r){u.sendMediaEventRequest(i,e,t,n,r)}))}),this.updateBootstrappingConfiguration=freeOnUnref(function(e){try{var t=JSON.parse(e.getText());x.extend(u.bootstrappingConfiguration,t),u.eventEmitter.emit("bootstrappingConfigurationFetched",u.bootstrappingConfiguration),null!=u.dispatchInterval&&u.startDispatchInterval()}catch(e){l.error("Error occurred when updating bootstrapping configuration: "+e)}}),this.eventEmitter=new A.EventEmitter,this.timeProvider=new Sg.TimeProvider,this.timer=oe.timer,this.mediaEventBatcher=new yg.MediaEventBatcher(this.timeProvider),this.telemetryReporter=Og.TelemetryReporterFactory.createTestTelemetryReporter()}return e.prototype.initialize=freeOnUnref(function(e,t){var n=this;this.url=e.replace(/\/$/,"")+r,this.authContext=t,this.bootstrapper=new mg.Bootstrapper(e,this.authContext),this.bootstrapper.getBootstrappingConfiguration().then(freeOnUnref(function(e){n.mediaEventBatcher.setBootstrappingConfiguration(e),n.bootstrappingConfiguration=e,l.info("Media Event Reporting App Instance ID: "+n.bootstrappingConfiguration.appInstanceId),n.eventEmitter.emit("bootstrappingConfigurationFetched",e),n.startDispatchInterval(),n.tryDispatchOfflineMediaEvents(),n.telemetryReporter.initialize(e)})),this.offlineReportingBatchManager=pg.OfflineReportingBatchManagerFactory.createOfflineReportingBatchManager("media_event_batches/",1e3,14,!0),zt.deviceCapabilities.on("network",this.tryDispatchOfflineMediaEvents)}),e.prototype.prepare=freeOnUnref(function(e){this.mediaEventBatcher.setContextualMediaEventsCallback(e),this.telemetryReporter.prepare(e),null!=this.bootstrappingConfiguration&&null==this.dispatchInterval&&this.startDispatchInterval()}),e.prototype.stop=freeOnUnref(function(){this.dispatchMediaEvents(),null!=this.dispatchInterval&&(this.timer.clearInterval(this.dispatchInterval),this.dispatchInterval=null),this.telemetryReporter.stop(),zt.deviceCapabilities.off("network",this.tryDispatchOfflineMediaEvents)}),e.prototype.enqueueMediaEvents=freeOnUnref(function(e){this.mediaEventBatcher.batchMediaEvents(e)&&this.dispatchMediaEvents();for(var t=0,n=e;t<n.length;t++){var r=n[t];this.telemetryReporter.reportEvent(r)}}),e.prototype.getAppInstanceId=freeOnUnref(function(){return null!=this.bootstrappingConfiguration?this.bootstrappingConfiguration.appInstanceId:null}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.isCustomMetricsEvent=freeOnUnref(function(e){return"CustomMetrics"===e._type}),e.prototype.sendMediaEventRequest=freeOnUnref(function(n,r,i,o,a){var s=this;null!=this.dispatchInterval&&this.timer.clearInterval(this.dispatchInterval);pn.HttpRequest.post(this.url).headers(this.authContext.getHeaders()).timeout(1e4).json({clientPublishTimestamp:Date.now(),clientPublishRelativeTime:Math.round(this.timeProvider.getHighResRelativeTimeMs()),appInstanceId:this.bootstrappingConfiguration.appInstanceId,events:n}).onLoad(freeOnUnref(function(e){if(null!=s.dispatchInterval&&s.startDispatchInterval(),l.enabledFor(de.DEBUG)){var t=n.map(freeOnUnref(function(e){return e.sequence+" ("+e._type+")"})).join(", ");l.info("Successfully sent events for "+s.bootstrappingConfiguration.appInstanceId+": "+t)}o(e)})).onError(freeOnUnref(function(e,t){null!=s.dispatchInterval&&s.startDispatchInterval(),null==t||fg.MediaEventConstants.UNRETRIABLE_HTTP_ERROR_CODES.indexOf(t.getStatus())<0?(l.error("Request attempt #"+r+" to report media events has failed: "+e),i(e)):a(e)})).send()}),e.prototype.startDispatchInterval=freeOnUnref(function(){null!=this.dispatchInterval&&this.timer.clearInterval(this.dispatchInterval),this.dispatchInterval=this.timer.setInterval(this.dispatchMediaEvents,this.bootstrappingConfiguration.batching.period)}),e.prototype.storeMediaEvents=freeOnUnref(function(e){null!=this.offlineReportingBatchManager?(this.offlineReportingBatchManager.cleanupReportingBatches(),this.offlineReportingBatchManager.storeReportingBatch(e).catch(freeOnUnref(function(e){l.error("Failed to write media event batch to local storage "+e)}))):l.warn("storeMediaEvents called even though OfflineReportingBatchManager is not initialized")}),e})();t.MediaEventReporter=n}));e(Pg);Pg.MediaEventReporter;var Mg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{volume:new rg.IntegerValidator(0,100)},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.AudioEventValidatable=n}));e(Mg);Mg.AudioEventValidatable;var Cg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{hardware:{classTypeId:new og.StringValidator(15),manufacturer:new og.StringValidator(40),modelName:new og.StringValidator(50),chipset:new og.StringValidator(40)},software:{application:{name:new og.StringValidator(60),version:new og.StringValidator(60)},operatingSystem:{name:new og.StringValidator(30),version:new og.StringValidator(50)},firmware:{name:new og.StringValidator(100),version:new og.StringValidator(100)},middleware:{name:new og.StringValidator(60),version:new og.StringValidator(60),userAgent:new og.StringValidator(512)},runtime:{name:new og.StringValidator(20),version:new og.StringValidator(60)},ui:{name:new og.StringValidator(60),version:new og.StringValidator(60)},browser:{name:new og.StringValidator(60),version:new og.StringValidator(60),userAgent:new og.StringValidator(512)},scriptEngine:{name:new og.StringValidator(20),version:new og.StringValidator(60)},player:{name:new og.StringValidator(20),version:new og.StringValidator(60)},attributionTag:new og.StringValidator(60)}}};t.DeviceEventValidatable=n}));e(Cg);Cg.DeviceEventValidatable;var Eg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{tenantId:new og.StringValidator(64),deviceId:new og.StringValidator(64),content:{consumptionId:new og.StringValidator(100),contentId:new og.StringValidator(64),streamType:new og.StringValidator(64)},metadata:{playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator}}};t.DeviceFulfillmentEventValidatable=n}));e(Eg);Eg.DeviceFulfillmentEventValidatable;var Tg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{display:{width:new rg.IntegerValidator(0),height:new rg.IntegerValidator(0)},player:{width:new rg.IntegerValidator(0),height:new rg.IntegerValidator(0)},visible:{pixelsTotal:new rg.IntegerValidator(0),pixelsVisible:new rg.IntegerValidator(0)}}};t.DisplayEventValidatable=n}));e(Tg);Tg.DisplayEventValidatable;var wg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{signal:{dbm:new rg.IntegerValidator(-500,0)}}};t.NetworkEventValidatable=n}));e(wg);wg.NetworkEventValidatable;var Ig=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{player:{name:new og.StringValidator(20),version:new og.StringValidator(60)},renderer:{name:new og.StringValidator(20),version:new og.StringValidator(60)}},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.PlayerEventValidatable=n}));e(Ig);Ig.PlayerEventValidatable;var kg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{treatment:new og.StringValidator(1,200)}};t.PlayerHeuristicEventValidatable=n}));e(kg);kg.PlayerHeuristicEventValidatable;var _g=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{language:new og.StringValidator(2,10)},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.TimedTextEventValidatable=n}));e(_g);_g.TimedTextEventValidatable;var Rg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={consumptionId:new og.StringValidator(20,100),trackId:new og.StringValidator(1,30),language:new og.StringValidator(2,10),bitrate:new rg.IntegerValidator(1),frameRate:new ng.NumberValidator(0),resolution:{width:new rg.IntegerValidator(0),height:new rg.IntegerValidator(0)}};t.TrackValidatable=n}));e(Rg);Rg.TrackValidatable;var Ag=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{track:{consumptionId:new og.StringValidator(20,100)},playhead:new rg.IntegerValidator(0)},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.TrackEventValidatable=n}));e(Ag);Ag.TrackEventValidatable;var Dg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{player:{width:new rg.IntegerValidator(0),height:new rg.IntegerValidator(0)},visible:{pixelsTotal:new rg.IntegerValidator(0),pixelsVisible:new rg.IntegerValidator(0)}},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.ViewportEventValidatable=n}));e(Dg);Dg.ViewportEventValidatable;var xg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{name:new og.StringValidator(1,50),treatment:new og.StringValidator(1,2)}};t.WeblabEventValidatable=n}));e(xg);xg.WeblabEventValidatable;var Fg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.FeatureFlagsValidatable=n}));e(Fg);Fg.FeatureFlagsValidatable;var Bg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createDeviceEvent=freeOnUnref(function(e,t){var n={_type:"Device",body:{hardware:e,software:t}};return tg.ValidationUtils.validate(n,Cg.DeviceEventValidatable),n}),e.createPlayerEvent=freeOnUnref(function(e,t,n,r,i,o){void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null);var a=null;null!=o?a={_type:"Cache",status:o}:null!=i&&(a={_type:"Preinit",hit:i});var s={_type:"Player",playerInstanceId:e,watchSessionId:t,body:{player:n,renderer:r,state:a}};return tg.ValidationUtils.validate(s,Ig.PlayerEventValidatable),s}),e.createNetworkEvent=freeOnUnref(function(e,t,n,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var o={_type:"Network",body:{category:{type:e,subtype:r},connected:t,active:n,signal:i}};return tg.ValidationUtils.validate(o,wg.NetworkEventValidatable),o}),e.createDisplayEvent=freeOnUnref(function(e,t,n,r,i){void 0===i&&(i=null);var o={_type:"Display",body:{connected:e,display:t,mode:n,player:r,visible:i}};return tg.ValidationUtils.validate(o,Tg.DisplayEventValidatable),o}),e.createViewportEvent=freeOnUnref(function(e,t,n,r,i){void 0===i&&(i=null);var o={_type:"Viewport",playerInstanceId:n,watchSessionId:r,body:{mode:e,player:t,visible:i}};return tg.ValidationUtils.validate(o,Dg.ViewportEventValidatable),o}),e.createDeviceFulfillmentEvent=freeOnUnref(function(e,t,n,r,i,o){var a={_type:"DeviceFulfillment",body:{deviceId:e,content:{consumptionId:r,contentId:t,streamType:n},metadata:{playerInstanceId:i,userWatchSessionId:o}}};return tg.ValidationUtils.validate(a,Eg.DeviceFulfillmentEventValidatable),a}),e.createAudioEvent=freeOnUnref(function(e,t,n){var r={_type:"Audio",playerInstanceId:t,watchSessionId:n,body:{volume:e}};return tg.ValidationUtils.validate(r,Mg.AudioEventValidatable),r}),e.createWeblabEvent=freeOnUnref(function(e,t){var n={_type:"Weblab",body:{name:e,treatment:t}};return tg.ValidationUtils.validate(n,xg.WeblabEventValidatable),n}),e.createFeatureFlagsEvent=freeOnUnref(function(e,t,n){var r={_type:"FeatureFlags",playerInstanceId:t,watchSessionId:n,body:{flags:x.clone(e)}};return tg.ValidationUtils.validate(r,Fg.FeatureFlagsValidatable),r}),e.createPlayerHeuristicEvent=freeOnUnref(function(e,t,n,r,i,o,a,s,l,f,u,c){void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===f&&(f=null),void 0===u&&(u=null),void 0===c&&(c=null);var d={_type:"PlayerHeuristic",body:{platform:e,treatment:t,treatmentInfo:{_type:"PrimeVideoHeuristics",treatmentName:n,heuristicAlgorithm:r,rawClusterLabel:i,apiCallType:o,classifierName:a,heuristicsPolicyId:s,delayBehindLive:l,clusterModelVersion:f,megaClusterLabel:u,heuristicProfileId:c}}};return tg.ValidationUtils.validate(d,kg.PlayerHeuristicEventValidatable),d}),e.createTimedTextEvent=freeOnUnref(function(e,t,n,r,i,o){void 0===i&&(i=null),void 0===o&&(o=null);var a={_type:"TimedText",playerInstanceId:n,watchSessionId:r,body:{enabled:e,language:t,textType:i,textSubtype:o}};return tg.ValidationUtils.validate(a,_g.TimedTextEventValidatable),a}),e.createTrackEvent=freeOnUnref(function(e,t,n,r){var i={_type:"Track",playerInstanceId:n,watchSessionId:r,body:{track:e,playhead:t}};return tg.ValidationUtils.validate(e,Rg.TrackValidatable),tg.ValidationUtils.validate(i,Ag.TrackEventValidatable),i}),e})();t.ContextualEventFactory=n}));e(Bg);Bg.ContextualEventFactory;var Lg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{asset:{consumptionId:new og.StringValidator(20,100)},request:{bitrate:new rg.IntegerValidator(1),bitrateCap:new rg.IntegerValidator(1),resolutionCap:{width:new rg.IntegerValidator(0),height:new rg.IntegerValidator(0)},fragmentIndex:new rg.IntegerValidator(0),fragmentDuration:new rg.IntegerValidator(0,6e4),fragmentResolution:{width:new rg.IntegerValidator(0),height:new rg.IntegerValidator(0)},url:new og.StringValidator(1e3),bytesExpected:new rg.IntegerValidator(0),server:{hostname:new og.StringValidator(100),ipv4:new og.StringValidator(7,15),ipv6:new og.StringValidator(11,45)},scoreModel:new og.StringValidator(100),qualityScore:new ng.NumberValidator(0,100)},response:{responseCode:new rg.IntegerValidator(100,599),bytesAcquired:new rg.IntegerValidator(0)},performance:{timeToFirstByte:new rg.IntegerValidator(0),timeToLastByte:new rg.IntegerValidator(0)}}};t.AcquisitionEventValidatable=n}));e(Lg);Lg.AcquisitionEventValidatable;var Ng=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createAcquisitionEvent=freeOnUnref(function(e,t,n,r,i,o){var a={_type:"Acquisition",body:{asset:{type:e,consumptionId:i,caching:o},request:t,response:n,performance:r}};return tg.ValidationUtils.validate(a,Lg.AcquisitionEventValidatable),a}),e})();t.AcquisitionEventFactory=n}));e(Ng);Ng.AcquisitionEventFactory;var Vg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{consumptionId:new og.StringValidator(20,100)}};t.AdIdentifierEventValidatable=n}));e(Vg);Vg.AdIdentifierEventValidatable;var jg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={sessionId:new og.StringValidator(36,36),streamId:new og.StringValidator(36,36),adReportingAgency:new og.StringValidator(1,50),url:new og.StringValidator(1,500)};t.AuditPingAdIdentifierValidatable=n}));e(jg);jg.AuditPingAdIdentifierValidatable;var qg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={sessionId:new og.StringValidator(36,36),streamId:new og.StringValidator(36,36)};t.NielsenAdIdentifierValidatable=n}));e(qg);qg.NielsenAdIdentifierValidatable;var Hg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createAdIdentifierEvent=freeOnUnref(function(e,t){var n={_type:"AdIdentifier",body:{consumptionId:e,adId:t}};return tg.ValidationUtils.validate(n,Vg.AdIdentifierEventValidatable),n}),e.createNielsenAdIdentifier=freeOnUnref(function(e,t){var n={_type:"Nielsen",sessionId:e,streamId:t};return tg.ValidationUtils.validate(n,qg.NielsenAdIdentifierValidatable),n}),e.createAuditPingAdIdentifier=freeOnUnref(function(e,t,n,r){var i={_type:"AuditPing",sessionId:e,streamId:t,adReportingAgency:n,url:r};return tg.ValidationUtils.validate(i,jg.AuditPingAdIdentifierValidatable),i}),e})();t.AdIdentifierEventFactory=n}));e(Hg);Hg.AdIdentifierEventFactory;var zg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{asset:{consumptionId:new og.StringValidator(20,100)},update:{url:new og.StringValidator(1e3),server:{hostname:new og.StringValidator(100),ipv4:new og.StringValidator(7,15),ipv6:new og.StringValidator(11,45)},bitrate:new rg.IntegerValidator(1),bitrateCap:new rg.IntegerValidator(1),roundtrip:new rg.IntegerValidator(1),bytes:{received:new rg.IntegerValidator(0)},packets:{received:new rg.IntegerValidator(0),lost:new rg.IntegerValidator(0),retransmitted:new rg.IntegerValidator(0)},frames:{received:new rg.IntegerValidator(0),damagedVideo:new rg.IntegerValidator(0),damagedAudio:new rg.IntegerValidator(0),divergentVideoTime:new rg.IntegerValidator(0),divergentAudioTime:new rg.IntegerValidator(0),decrypted:new rg.IntegerValidator(0)},resolution:{height:new rg.IntegerValidator(0),width:new rg.IntegerValidator(0)},resolutionCap:{height:new rg.IntegerValidator(0,3),width:new rg.IntegerValidator(0,3)},pitcherGroupId:new og.StringValidator(1,100),pointOfPresence:new og.StringValidator(1,20)}}};t.BitstreamEventValidatable=n}));e(zg);zg.BitstreamEventValidatable;var Wg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createBitstreamEvent=freeOnUnref(function(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v){var O={_type:"Bitstream",body:{asset:{consumptionId:t,types:e},update:{url:n,server:r,bitrate:i,bitrateCap:o,roundtrip:a,bytes:s,packets:l,frames:f,errors:u,duration:c,resolution:d,resolutionCap:p,pitcherGroupId:h,scoreModel:m,scoreVersion:y,qualityScore:g,pointOfPresence:v}}};return tg.ValidationUtils.validate(O,zg.BitstreamEventValidatable),O}),e})();t.BitstreamEventFactory=n}));e(Wg);Wg.BitstreamEventFactory;var Kg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.CapabilitiesValidatable=n}));e(Kg);Kg.CapabilitiesValidatable;var Gg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createPlayerCapabilitiesEvent=freeOnUnref(function(e,t,n,r){var i={_type:"Capabilities",playerInstanceId:n,watchSessionId:r,body:{component:{_type:"Player",consumptionId:t,capabilities:e}}};return tg.ValidationUtils.validate(i,Kg.CapabilitiesValidatable),i}),e})();t.CapabilitiesEventFactory=n}));e(Gg);Gg.CapabilitiesEventFactory;var Qg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={server:new og.StringValidator(1,64),breakNumber:new rg.IntegerValidator(0),adNumberWithinBreak:new rg.IntegerValidator(0)};t.AdContentValidatable=n;var r={body:{contentId:new og.StringValidator(1,64),playhead:new rg.IntegerValidator(0)},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator,asset:{consumptionId:new og.StringValidator(1,100),playhead:new rg.IntegerValidator(0)}};t.ContentEventValidatable=r}));e(Qg);Qg.AdContentValidatable,Qg.ContentEventValidatable;var Xg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createContentEvent=freeOnUnref(function(e,t,n,r,i,o,a){var s=null;null!=r&&null!=i&&(s={consumptionId:r,playhead:i});var l={_type:"Content",playerInstanceId:o,watchSessionId:a,body:{contentId:e,playhead:t,content:n,asset:s}};if(n)switch(n._type){case"Ad":tg.ValidationUtils.validate(n,Qg.AdContentValidatable)}return tg.ValidationUtils.validate(l,Qg.ContentEventValidatable),l}),e})();t.ContentEventFactory=n}));e(Xg);Xg.ContentEventFactory;var Yg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.CustomMetadataEventValidatable=n}));e(Yg);Yg.CustomMetadataEventValidatable;var Jg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createCustomMetadataEvent=freeOnUnref(function(e,t,n){var r={_type:"CustomMetadata",playerInstanceId:t,watchSessionId:n,body:{metadata:tg.ValidationUtils.validateMap(e,50,50)}};return tg.ValidationUtils.validate(r,Yg.CustomMetadataEventValidatable),r}),e})();t.CustomMetadataEventFactory=n}));e(Jg);Jg.CustomMetadataEventFactory;var Zg=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{label:new og.StringValidator(20,60),value:new og.StringValidator(0,200)}};t.DiagnosticEventValidatable=n}));e(Zg);Zg.DiagnosticEventValidatable;var $g=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createDiagnosticEvent=freeOnUnref(function(e,t,n){void 0===n&&(n=null);var r={_type:"Diagnostic",body:{label:e,value:n,state:t}};return tg.ValidationUtils.validate(r,Zg.DiagnosticEventValidatable),r}),e})();t.DiagnosticEventFactory=n}));e($g);$g.DiagnosticEventFactory;var ev=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{acquired:new rg.IntegerValidator(0,100),assets:new ig.ListValidator(new og.StringValidator(16))}};t.DownloadEventValidatable=n}));e(ev);ev.DownloadEventValidatable;var tv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createDownloadEvent=freeOnUnref(function(e,t,n,r){var i={_type:"Download",body:{action:e,acquired:t,consumptionId:null==r?null:r,assets:n}};return tg.ValidationUtils.validate(i,ev.DownloadEventValidatable),i}),e})();t.DownloadEventFactory=n}));e(tv);tv.DownloadEventFactory;var nv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{details:{message:{generic:new og.StringValidator(50),specific:new og.StringValidator(500)},stackTrace:new ig.ListValidator(new og.StringValidator(300))}},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.ErrorEventValidatable=n}));e(nv);nv.ErrorEventValidatable;var rv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createErrorEvent=freeOnUnref(function(e,t,n,r,i,o,a){void 0===i&&(i=null);var s={_type:"Error",playerInstanceId:o,watchSessionId:a,body:{context:{source:e,type:t},fatal:n,details:r,consumptionId:i}};return tg.ValidationUtils.validate(s,nv.ErrorEventValidatable),s}),e.createErrorDetails=freeOnUnref(function(e){var t={message:{generic:e.name,specific:e.message},stackTrace:null};return Qe.exists(e.stack)&&(t.stackTrace=e.stack.split("\n")),t}),e})();t.ErrorEventFactory=n}));e(rv);rv.ErrorEventFactory;var iv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{ruleId:new og.StringValidator(1,36),fromConsumptionId:new og.StringValidator(20,60),toConsumptionId:new og.StringValidator(20,60)}};t.FailoverEventValidatable=n}));e(iv);iv.FailoverEventValidatable;var ov=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createFailoverEvent=freeOnUnref(function(e,t,n){var r={_type:"Failover",body:{ruleId:e,fromConsumptionId:t,toConsumptionId:n}};return tg.ValidationUtils.validate(r,iv.FailoverEventValidatable),r}),e})();t.FailoverEventFactory=n}));e(ov);ov.FailoverEventFactory;var av=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{coordinates:new og.StringValidator(8,18)}};t.GeoLocationEventValidatable=n}));e(av);av.GeoLocationEventValidatable;var sv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createGeoLocationEvent=freeOnUnref(function(e){var t={_type:"GeoLocation",body:{coordinates:e}};return tg.ValidationUtils.validate(t,av.GeoLocationEventValidatable),t}),e})();t.GeoLocationEventFactory=n}));e(sv);sv.GeoLocationEventFactory;var lv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{targetDeviceId:new og.StringValidator(60),sourceDeviceId:new og.StringValidator(60),timeOffset:new rg.IntegerValidator,context:{uiClick:{uiElement:new og.StringValidator(60),elementSelection:new og.StringValidator(60)}}},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.InteractionEventValidatable=n}));e(lv);lv.InteractionEventValidatable;var fv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createInteractionEvent=freeOnUnref(function(e,t,n,r,i,o,a,s,l,f,u){void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===f&&(f=null),void 0===u&&(u=null);var c={_type:"Interaction",playerInstanceId:n,watchSessionId:r,body:{context:{source:e,type:t,input:i,cause:o,navigation:a,uiClick:s},targetDeviceId:l,sourceDeviceId:f,timeOffset:u}};return null==s&&delete c.body.context.uiClick,tg.ValidationUtils.validate(c,lv.InteractionEventValidatable),c}),e})();t.InteractionEventFactory=n}));e(fv);fv.InteractionEventFactory;var uv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.InterfaceEventValidatable=n}));e(uv);uv.InterfaceEventValidatable;var cv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createInterfaceEvent=freeOnUnref(function(e,t,n,r,i,o){var a={_type:"Interface",playerInstanceId:i,watchSessionId:o,body:{state:e,source:t,cause:n,component:r}};return tg.ValidationUtils.validate(a,uv.InterfaceEventValidatable),a}),e})();t.InterfaceEventFactory=n}));e(cv);cv.InterfaceEventFactory;var dv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator,body:{multiplayerId:new og.StringValidator(36),activeStreamCount:new rg.IntegerValidator(0)}};t.MultiplayerEventValidatable=n}));e(dv);dv.MultiplayerEventValidatable;var pv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createMultiplayerEvent=freeOnUnref(function(e,t,n,r,i,o,a,s){var l={_type:"Multiplayer",playerInstanceId:a,watchSessionId:s,body:{multiplayerId:e,experienceType:t,viewportPosition:n,audioFocus:r,activeStreamCount:i,action:o}};return tg.ValidationUtils.validate(l,dv.MultiplayerEventValidatable),l}),e})();t.MultiplayerEventFactory=n}));e(pv);pv.MultiplayerEventFactory;var hv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={timeAvailable:new rg.IntegerValidator(0),timeCapacity:new rg.IntegerValidator(1),bytesAvailable:new rg.IntegerValidator(0),bytesCapacity:new rg.IntegerValidator(1)},r={body:{playhead:new rg.IntegerValidator(0),consumptionId:new og.StringValidator(20,100),buffers:{front:new ig.ListValidator(n),back:new ig.ListValidator(n),renderer:new ig.ListValidator(n)},livehead:new rg.IntegerValidator(1),clientId:new og.StringValidator(36,36),droppedFrames:new rg.IntegerValidator(0),averageFrameRate:new ng.NumberValidator(0),asset:{consumptionId:new og.StringValidator(1,100),playhead:new rg.IntegerValidator(0)}},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.PlaybackEventValidatable=r}));e(hv);hv.PlaybackEventValidatable;var mv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createPlaybackEvent=freeOnUnref(function(e,t,n,r,i,o,a,s,l,f,u,c,d,p){void 0===d&&(d=null),void 0===p&&(p=null);var h=null;null!=l&&null!=f&&(h={consumptionId:l,playhead:f});var m={_type:"Playback",playerInstanceId:u,watchSessionId:c,body:{action:t,playhead:n,consumptionId:e,contentContext:r,buffers:{front:i,back:o,renderer:null},livehead:d,clientId:p,droppedFrames:a,averageFrameRate:s,asset:h}};return tg.ValidationUtils.validate(m,hv.PlaybackEventValidatable),m}),e})();t.PlaybackEventFactory=n}));e(mv);mv.PlaybackEventFactory;var yv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{scale:new rg.IntegerValidator(2),score:new rg.IntegerValidator(0)}};t.RatingEventValidatable=n}));e(yv);yv.RatingEventValidatable;var gv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createRatingEvent=freeOnUnref(function(e,t,n){var r={_type:"Rating",body:{type:e,scale:t,score:n}};return tg.ValidationUtils.validate(r,yv.RatingEventValidatable),r}),e})();t.RatingEventFactory=n}));e(gv);gv.RatingEventFactory;var vv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{remoteDeviceId:new og.StringValidator(60)},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.RemoteEventValidatable=n}));e(vv);vv.RemoteEventValidatable;var Ov=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createRemoteEvent=freeOnUnref(function(e,t,n,r,i){var o={_type:"Remote",playerInstanceId:n,watchSessionId:r,body:{action:e,transport:t,remoteDeviceId:i}};return tg.ValidationUtils.validate(o,vv.RemoteEventValidatable),o}),e})();t.RemoteEventFactory=n}));e(Ov);Ov.RemoteEventFactory;var Sv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{sdkVersion:new og.StringValidator(1,30),experimentCohort:new og.StringValidator(1,50),triggerType:new og.StringValidator(1,60),triggerTimestamp:new rg.IntegerValidator(0),consumptionId:new og.StringValidator(20,100),instructionSetId:new og.StringValidator(10,60)}};t.SonarNotificationEventValidatable=n;var r={monitorName:new og.StringValidator(1,64),startTimestamp:new rg.IntegerValidator(0),endTimestamp:new rg.IntegerValidator(0)};t.SonarNotificationActiveMonitorValidatable=r;var i={mitigationType:new og.StringValidator(1,60),mitigationCategory:new og.StringValidator(1,60),resultType:new og.StringValidator(1,50),resultCategory:new og.StringValidator(1,50),reportId:new og.StringValidator(20,60),rootCauseDag:new og.StringValidator(1,20)};t.SonarNotificationMitigationValidatable=i;var o={errorCode:new rg.IntegerValidator(0)};t.SonarUxDetailsValidatable=o}));e(Sv);Sv.SonarNotificationEventValidatable,Sv.SonarNotificationActiveMonitorValidatable,Sv.SonarNotificationMitigationValidatable,Sv.SonarUxDetailsValidatable;var Uv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createSonarNotificationEvent=freeOnUnref(function(e,t,n,r,i,o,a){var s={_type:"SonarNotification",body:{sdkVersion:e,experimentCohort:t,triggerType:n,triggerTimestamp:r,consumptionId:i,instructionSetId:o,notification:a}};return tg.ValidationUtils.validate(s,Sv.SonarNotificationEventValidatable),s}),e.createSonarNotificationActiveMonitor=freeOnUnref(function(e,t,n,r,i){var o={_type:"ActiveMonitor",monitorType:e,monitorName:t,success:n,startTimestamp:r,endTimestamp:i};return tg.ValidationUtils.validate(o,Sv.SonarNotificationActiveMonitorValidatable),o}),e.createSonarNotificationMitigation=freeOnUnref(function(e,t,n,r,i,o,a,s){var l={_type:"Mitigation",mitigationType:e,mitigationCategory:t,resultType:n,resultCategory:r,success:i,reportId:o,rootCauseDag:a,uxDetails:s};return tg.ValidationUtils.validate(l,Sv.SonarNotificationMitigationValidatable),l}),e.createSonarUxDetails=freeOnUnref(function(e,t,n){var r={isObservation:e,isFeedbackSubmitted:t,errorCode:n};return tg.ValidationUtils.validate(r,Sv.SonarUxDetailsValidatable),r}),e})();t.SonarNotificationEventFactory=n}));e(Uv);Uv.SonarNotificationEventFactory;var bv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={body:{reason:new og.StringValidator(1,64),playhead:new rg.IntegerValidator(0)},playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator};t.StallEventValidatable=n}));e(bv);bv.StallEventValidatable;var Pv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createStallEvent=freeOnUnref(function(e,t,n,r,i){var o={_type:"Stall",playerInstanceId:r,watchSessionId:i,body:{expected:e,reason:t,playhead:n}};return tg.ValidationUtils.validate(o,bv.StallEventValidatable),o}),e})();t.StallEventFactory=n}));e(Pv);Pv.StallEventFactory;var Mv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=new og.StringValidator(1,50),r={timestamp:new rg.IntegerValidator(0),playerInstanceId:ag.playerInstanceIdValidator,watchSessionId:ag.watchSessionIdValidator,body:{stepName:n}};t.TraceEventValidatable=r}));e(Mv);Mv.TraceEventValidatable;var Cv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createTraceEvent=freeOnUnref(function(e,t,n,r,i,o,a,s,l){var f={_type:"Trace",timestamp:null!=l?l:null,playerInstanceId:a,watchSessionId:s,body:{type:e,stepName:t,state:n,parent:r,result:i,metadata:o}};return tg.ValidationUtils.validate(f,Mv.TraceEventValidatable),f}),e})();t.TraceEventFactory=n}));e(Cv);Cv.TraceEventFactory;var Ev=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.reportTraceStart=freeOnUnref(function(e,t,n,r){}),e.prototype.reportTraceStop=freeOnUnref(function(e,t,n,r,i){}),e.prototype.playbackStarted=freeOnUnref(function(){}),e.prototype.unload=freeOnUnref(function(){}),e})();t.NoopTraceEventReporter=n}));e(Ev);Ev.NoopTraceEventReporter;var Tv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AssetFulfillmentEventFactory=lg.AssetFulfillmentEventFactory,t.MediaEventConstants=fg.MediaEventConstants,t.MediaEventReporter=Pg.MediaEventReporter,t.ContextualEventFactory=Bg.ContextualEventFactory,t.AcquisitionEventFactory=Ng.AcquisitionEventFactory,t.AdIdentifierEventFactory=Hg.AdIdentifierEventFactory,t.BitstreamEventFactory=Wg.BitstreamEventFactory,t.CapabilitiesEventFactory=Gg.CapabilitiesEventFactory,t.ContentEventFactory=Xg.ContentEventFactory,t.CustomMetadataEventFactory=Jg.CustomMetadataEventFactory,t.CustomMetricsEventFactory=bg.CustomMetricsEventFactory,t.DiagnosticEventFactory=$g.DiagnosticEventFactory,t.DownloadEventFactory=tv.DownloadEventFactory,t.ErrorEventFactory=rv.ErrorEventFactory,t.FailoverEventFactory=ov.FailoverEventFactory,t.GeoLocationEventFactory=sv.GeoLocationEventFactory,t.InteractionEventFactory=fv.InteractionEventFactory,t.InterfaceEventFactory=cv.InterfaceEventFactory,t.MultiplayerEventFactory=pv.MultiplayerEventFactory,t.PlaybackEventFactory=mv.PlaybackEventFactory,t.RatingEventFactory=gv.RatingEventFactory,t.RemoteEventFactory=Ov.RemoteEventFactory,t.SonarNotificationEventFactory=Uv.SonarNotificationEventFactory,t.StallEventFactory=Pv.StallEventFactory,t.TraceEventFactory=Cv.TraceEventFactory,t.NoopTraceEventReporter=Ev.NoopTraceEventReporter}));e(Tv);Tv.AssetFulfillmentEventFactory,Tv.MediaEventConstants,Tv.MediaEventReporter,Tv.ContextualEventFactory,Tv.AcquisitionEventFactory,Tv.AdIdentifierEventFactory,Tv.BitstreamEventFactory,Tv.CapabilitiesEventFactory,Tv.ContentEventFactory,Tv.CustomMetadataEventFactory,Tv.CustomMetricsEventFactory,Tv.DiagnosticEventFactory,Tv.DownloadEventFactory,Tv.ErrorEventFactory,Tv.FailoverEventFactory,Tv.GeoLocationEventFactory,Tv.InteractionEventFactory,Tv.InterfaceEventFactory,Tv.MultiplayerEventFactory,Tv.PlaybackEventFactory,Tv.RatingEventFactory,Tv.RemoteEventFactory,Tv.SonarNotificationEventFactory,Tv.StallEventFactory,Tv.TraceEventFactory,Tv.NoopTraceEventReporter;var wv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.SYE_FALLBACK_ERROR_CODES=["sye"]}));e(wv);wv.SYE_FALLBACK_ERROR_CODES;var Iv=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var d=["drm_service.unsupported_cdm_version",Ni.codes.xp.content.concurrency_limit,Ni.codes.xp.system.display_disconnected,Ni.codes.xp.system.hdcp_insufficient,Ni.codes.xp.system.backgrounded,"prs.no_rights","prs.unsupported_cdm_version","prs.no_rights.no_available_streams","prs.concurrency_limit_breached","envelope.refresh.error.entitlement","prs.hd_content_not_allowed","drm_service.hd_content_not_allowed","drm_service.uhd_content_not_allowed"].concat(wv.SYE_FALLBACK_ERROR_CODES);t.NON_FATAL_ERROR_CODES=d;var i=((n={})[Ni.codes.xp.system.display_disconnected]={errorSource:"Player",errorType:"DRM"},n[Ni.codes.xp.system.hdcp_insufficient]={errorSource:"Player",errorType:"DRM"},n),p=de.get("ErrorMediaEventController"),r=freeOnUnref(function(){function e(e,t,n){var r=this;this.consumptionId=null,this.onFatalError=freeOnUnref(function(e){r.reportError(!0,e)}),this.onNonFatalError=freeOnUnref(function(e){r.reportError(!1,e)}),this.onContentStateChange=freeOnUnref(function(){if("error"===r.mpPlayer.contentState&&null!=r.mpPlayer.contentError){var e=r.mpPlayer.contentError,t=null;if(e instanceof ct.XpError){var n=e.code;null==(t=i[n])&&0===n.indexOf("drm.")&&(t={errorSource:"Player",errorType:"DRM"})}null!=t?r.reportError(!0,e,t.errorSource,t.errorType):r.reportError(!0,e)}}),this.mediaEventReporter=e,this.mpPlayer=t,this.sessionIdTracker=n}return e.prototype.initialize=freeOnUnref(function(){var t=this;this.mpPlayer.on("error",this.onFatalError),this.mpPlayer.on("nonfatalError",this.onNonFatalError),this.mpPlayer.on("contentStateChange",this.onContentStateChange),xt.platformRuntime.onUncaughtException(freeOnUnref(function(e){p.error("PlatformRuntime.UncaughtException:",e),q.metrics.putMetric("PlatformRuntime.UncaughtException"),t.reportError(!1,ct.XpError.generatePrefixedError(e,"platform_uncaught"))}))}),e.prototype.uninitialize=freeOnUnref(function(){this.mpPlayer.off("error",this.onFatalError),this.mpPlayer.off("nonfatalError",this.onNonFatalError),this.mpPlayer.off("contentStateChange",this.onContentStateChange)}),e.prototype.unload=freeOnUnref(function(){this.consumptionId=null}),e.prototype.reportError=freeOnUnref(function(e,t,n,r,i){var o=Tv.ErrorEventFactory.createErrorDetails(t),a=!1;if(t instanceof ct.XpError){for(var s=0,l=d;s<l.length;s++){var f=l[s];-1!==t.code.indexOf(f)&&(e=!1)}a=-1!==t.code.indexOf(Ni.codes.xp.system.backgrounded)}var u=[Tv.ErrorEventFactory.createErrorEvent(Qe.withDefault(n,"Player"),Qe.withDefault(r,"Unknown"),e,o,null!=i?i:this.consumptionId,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId())];if(a){var c=Tv.InterfaceEventFactory.createInterfaceEvent("Show","Player",null,{_type:"Background"},this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId());u.unshift(c)}this.mediaEventReporter.enqueueMediaEvents(u),e&&(p.error("Reporting fatal error "+o.message.generic+": "+o.message.specific),q.metrics.putMetric("FatalError"),q.metrics.flush(),this.sessionIdTracker.updateStashedWatchSessionId(),this.sessionIdTracker.updateWatchSessionId())}),e.prototype.updateConsumptionId=freeOnUnref(function(e){this.consumptionId=e}),e})();t.ErrorMediaEventController=r}));e(Iv);Iv.NON_FATAL_ERROR_CODES,Iv.ErrorMediaEventController;var kv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("DownloadPlaybackMetricsCalculator"),n=Iv.NON_FATAL_ERROR_CODES.concat([Ni.codes.xp.content.playback_waiting_timeout]),i=freeOnUnref(function(){function e(e){var n=this;this.currentPlaylistItem=null,this.isCurrentItemPlaybackAttemptReported=!1,this.isPlayRequested=!1,this.onEnterItem=freeOnUnref(function(e){var t=n.currentPlaylistItem;n.currentPlaylistItem=e.item,null!=t&&t.downloadOperationId===n.currentPlaylistItem.downloadOperationId||(null!=n.currentPlaylistItem.downloadOperationId&&r.info(">> onEnterItem: "+n.currentPlaylistItem.downloadOperationId),n.isCurrentItemPlaybackAttemptReported=!1,n.reportPlaybackAttempt())}),(this.playlistEngine=e).on("EnterItem",this.onEnterItem)}return e.prototype.destroy=freeOnUnref(function(){this.playlistEngine.off("EnterItem",this.onEnterItem)}),e.prototype.play=freeOnUnref(function(){this.isPlayRequested=!0,this.reportPlaybackAttempt()}),e.prototype.unload=freeOnUnref(function(e){null!=e&&this.isPlayRequested&&null!=this.currentPlaylistItem&&null!=this.currentPlaylistItem.downloadOperationId&&(q.metrics.putMetric("DownloadPlayback.Failure"),r.info("DownloadPlayback.Failure: "+e),this.isFailureByDesign(e)&&q.metrics.putMetric("DownloadPlayback.Failure.ByDesign")),this.isPlayRequested=!1,this.currentPlaylistItem=null,this.isCurrentItemPlaybackAttemptReported=!1}),e.prototype.reportPlaybackAttempt=freeOnUnref(function(){null!=this.currentPlaylistItem&&null!=this.currentPlaylistItem.downloadOperationId&&this.isPlayRequested&&!this.isCurrentItemPlaybackAttemptReported&&(q.metrics.putMetric("DownloadPlayback.Attempt"),r.info("Attempted playback of downloaded content."),this.isCurrentItemPlaybackAttemptReported=!0)}),e.prototype.isFailureByDesign=freeOnUnref(function(t){return t instanceof ct.XpError&&null!=x.find(n,freeOnUnref(function(e){return-1!==t.code.indexOf(e)}))}),e})();t.DownloadPlaybackMetricsCalculator=i}));e(kv);kv.DownloadPlaybackMetricsCalculator;var _v=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var a=((n={})["envelope.expired"]=Ni.codes.xp.content.envelope.expired,n["envelope.refresh.error"]=Ni.codes.xp.content.envelope.refresh.error,n["envelope.refresh.error.vppa"]=Ni.codes.xp.content.no_rights.consent_expired,n["envelope.refresh.timeout"]=Ni.codes.xp.content.envelope.refresh.timeout,n["envelope.refresh.stale"]=Ni.codes.xp.content.envelope.refresh.error,n["envelope.refresh.loop"]=Ni.codes.xp.content.envelope.refresh.error,n["drm_service.hd_content_not_allowed"]=Ni.codes.xp.content.no_rights.hd_content_not_allowed,n["drm_service.uhd_content_not_allowed"]=Ni.codes.xp.content.no_rights.uhd_content_not_allowed,n["drm_service.unsupported_cdm_version"]=Ni.codes.xp.system.unsupported_cdm_version,n["prs.hd_content_not_allowed"]=Ni.codes.xp.content.no_rights.hd_content_not_allowed,n["prs.unsupported_cdm_version"]=Ni.codes.xp.system.unsupported_cdm_version,n["prs.no_rights.anonymizer_ip"]=Ni.codes.xp.content.no_rights.anonymizer_ip,n["prs.no_rights.consent_expired"]=Ni.codes.xp.content.no_rights.consent_expired,n["prs.no_rights.device_limit_reached"]=Ni.codes.xp.content.no_rights.device_limit_reached,n["prs.no_rights.download_limit_exceeded"]=Ni.codes.xp.content.no_rights.download_limit_exceeded,n["prs.no_rights.invalid_geo_ip"]=Ni.codes.xp.content.no_rights.invalid_geo_ip,n["prs.no_rights.no_available_streams"]=Ni.codes.xp.content.no_rights.no_available_streams,n["prs.no_rights.not_accepted_terms"]=Ni.codes.xp.content.no_rights.not_accepted_terms_and_conditions,n["prs.no_rights.not_owned"]=Ni.codes.xp.content.no_rights.not_owned,n["prs.no_rights.pv_lower_tier_device_not_permitted_access"]=Ni.codes.xp.content.no_rights.pv_lower_tier_device_not_permitted_access,n["prs.no_rights"]=Ni.codes.xp.content.no_rights.unknown,n["prs.concurrency_limit_breached"]=Ni.codes.xp.content.concurrency_limit,n["prs.rapid_recap_playback_urls.no_resource"]=Ni.codes.xp.content.rapid_recap_unplayable,n["prs.rapid_recap_playback_urls.no_url_sets"]=Ni.codes.xp.content.rapid_recap_unplayable,n["prs.rapid_recap_playback_urls.invalid_default_url_set_id"]=Ni.codes.xp.content.rapid_recap_unplayable,n["pes.invalid_request"]=Ni.codes.xp.content.service.unknown,n["pes.session_token.invalid"]=Ni.codes.xp.content.no_rights.unknown,n["pes.session_token.expired"]=Ni.codes.xp.content.no_rights.unknown,n["pes.session_handoff.invalid"]=Ni.codes.xp.content.no_rights.unknown,n["pes.concurrency.limit_breached"]=Ni.codes.xp.content.concurrency_limit,n["pes.session_not_started"]=Ni.codes.xp.unknown,n),r=freeOnUnref(function(){function e(){}return e.convertCode=freeOnUnref(function(e){if(e instanceof ct.XpError){if(x.contains(Ni.allCodes,e.code))return e;for(var t=0,n=Object.keys(a);t<n.length;t++){var r=n[t];if(e.code===r)return new ct.XpError(a[r]);var i=e.code.indexOf(r);if(!(i<0)){var o=i+r.length;if(!(0!==i&&"."!==e.code.charAt(i-1)||o!==e.code.length&&"."!==e.code.charAt(o)))return new ct.XpError(a[r])}}}return new ct.XpError(Ni.codes.xp.unknown,void 0,void 0,void 0,e)}),e})();t.InternalToExternalCodeConverter=r}));e(_v);_v.InternalToExternalCodeConverter;var Rv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="(\\d|[1-9]\\d|1\\d\\d|2([0-4]\\d|5[0-5]))",r=new RegExp("^"+n+"\\."+n+"\\."+n+"\\."+n+"$"),i=freeOnUnref(function(){function e(){}return e.isValidIPv4Address=freeOnUnref(function(e){return r.test(e)}),e})();t.IPAddress=i}));e(Rv);Rv.IPAddress;var Av=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="x-server-ip",r=freeOnUnref(function(){function e(){}return e.createEdgeServer=freeOnUnref(function(e,t){return{hostname:new mt.URL(e).hostname,ipv4:null!=t&&null!=t[n]&&Rv.IPAddress.isValidIPv4Address(t[n])?t[n]:null,ipv6:null}}),e})();t.EdgeServerBuilder=r}));e(Av);Av.EdgeServerBuilder;var Dv=t(freeOnUnref(function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0});var i=((n={}).Audio="Audio",n.Video="Video",n.TimedText="TimedText",n.Image="TrickPlay",n),o=((r={}).Audio="AudioMetadata",r.Video="VideoMetadata",r.TimedText="TimedText",r.Image="TrickPlay",r),a=freeOnUnref(function(){function e(e,t){var n=this;this.consumptionId=null,this.titleId=null,this.hasPlaybackInitiated=!1,this.onPlaybackStateChange=freeOnUnref(function(e){"playing"===e.playbackState&&(n.hasPlaybackInitiated=!0,n.mpPlayer.off("playbackStateChange",n.onPlaybackStateChange))}),this.mediaEventReporter=e,this.mpPlayer=t,this.mpPlayer.on("playbackStateChange",this.onPlaybackStateChange)}return e.prototype.unload=freeOnUnref(function(){this.consumptionId=null,this.titleId=null,this.hasPlaybackInitiated=!1,this.mpPlayer.off("playbackStateChange",this.onPlaybackStateChange),this.mpPlayer.on("playbackStateChange",this.onPlaybackStateChange)}),e.prototype.updateConsumptionId=freeOnUnref(function(e){this.consumptionId=e}),e.prototype.updateTitleId=freeOnUnref(function(e){this.titleId=e}),e.prototype.reportFragmentAcquisitionSuccess=freeOnUnref(function(e){var t=Tv.AcquisitionEventFactory.createAcquisitionEvent(this.determineMediaEventAssetType(e.type,e.initFragment),this.createFragmentAcquisitionRequest(e),this.createAcquisitionResponse(!0,e.status,e.totalBytes,e.headers),this.createAcquisitionPerformance(e.latencyMs,e.totalMs),e.consumptionId,this.getCaching(e.titleId));this.mediaEventReporter.enqueueMediaEvents([t])}),e.prototype.reportFragmentAcquisitionFailure=freeOnUnref(function(e){var t=Tv.AcquisitionEventFactory.createAcquisitionEvent(this.determineMediaEventAssetType(e.type,e.initFragment),this.createFragmentAcquisitionRequest(e),this.createAcquisitionResponse(!1,Qe.withDefault(e.status,null),Qe.withDefault(e.totalBytes,0),Qe.withDefault(e.headers,{}),e.acquisitionError),this.createAcquisitionPerformance(Qe.withDefault(e.latencyMs,0),Qe.withDefault(e.totalMs,0)),e.consumptionId,this.getCaching(e.titleId));this.mediaEventReporter.enqueueMediaEvents([t])}),e.prototype.reportLicenseAcquisitionSuccess=freeOnUnref(function(e){var t=Tv.AcquisitionEventFactory.createAcquisitionEvent("DRMLicense",this.createNonFragmentAcquisitionRequest(e.url,e.headers),this.createAcquisitionResponse(!0,Qe.withDefault(e.status,null),Qe.withDefault(e.totalBytes,0),Qe.withDefault(e.headers,{})),this.createAcquisitionPerformance(e.latencyMs,e.latencyMs+e.downloadTimeMs),e.consumptionId,this.getCaching(e.titleId));this.mediaEventReporter.enqueueMediaEvents([t])}),e.prototype.reportLicenseAcquisitionFailure=freeOnUnref(function(e){var t=Tv.AcquisitionEventFactory.createAcquisitionEvent("DRMLicense",this.createNonFragmentAcquisitionRequest(e.url,e.headers),this.createAcquisitionResponse(!1,Qe.withDefault(e.status,null),Qe.withDefault(e.totalBytes,0),Qe.withDefault(e.headers,{})),this.createAcquisitionPerformance(Qe.withDefault(e.latencyMs,0),Qe.withDefault(e.latencyMs,0)+Qe.withDefault(e.downloadTimeMs,0)),e.consumptionId,this.getCaching(e.titleId));this.mediaEventReporter.enqueueMediaEvents([t])}),e.prototype.reportManifestAcquisitionSuccess=freeOnUnref(function(e){var t=Tv.AcquisitionEventFactory.createAcquisitionEvent("Manifest",this.createNonFragmentAcquisitionRequest(e.sourceUrl.url,e.headers),this.createAcquisitionResponse(!0,Qe.withDefault(e.status,null),Qe.withDefault(e.totalBytes,0),Qe.withDefault(e.headers,{})),this.createAcquisitionPerformance(e.timing.latencyMs,e.timing.totalMs),e.consumptionId,this.getCaching(e.titleId));this.mediaEventReporter.enqueueMediaEvents([t])}),e.prototype.reportManifestAcquisitionFailure=freeOnUnref(function(e){var t=Qe.nestedValue(e.error.reason,"headers",{}),n=Tv.AcquisitionEventFactory.createAcquisitionEvent("Manifest",this.createNonFragmentAcquisitionRequest(e.sourceUrl.url,t),this.createAcquisitionResponse(!1,Qe.nestedValue(e.error.reason,"statusCode",null),Qe.withDefault(0,0),Qe.withDefault(t,{}),e.error),this.createAcquisitionPerformance(Qe.nestedValue(e.error.reason,"timing.latencyMs",0),Qe.nestedValue(e.error.reason,"timing.totalMs",0)),e.consumptionId,this.getCaching(e.titleId));this.mediaEventReporter.enqueueMediaEvents([n])}),e.prototype.reportTimedTextAcquisitionSuccess=freeOnUnref(function(e){var t=Tv.AcquisitionEventFactory.createAcquisitionEvent("TimedText",this.createNonFragmentAcquisitionRequest(e.url,e.headers),this.createAcquisitionResponse(!0,Qe.withDefault(e.status,null),Qe.withDefault(e.totalBytes,0),Qe.withDefault(e.headers,{})),this.createAcquisitionPerformance(e.latencyMs,e.totalMs),Qe.withDefault(this.consumptionId,""),!this.hasPlaybackInitiated);this.mediaEventReporter.enqueueMediaEvents([t])}),e.prototype.reportTimedTextAcquisitionFailure=freeOnUnref(function(e){var t=Tv.AcquisitionEventFactory.createAcquisitionEvent("TimedText",this.createNonFragmentAcquisitionRequest(e.url,e.headers),this.createAcquisitionResponse(!1,Qe.withDefault(e.status,null),Qe.withDefault(e.totalBytes,0),Qe.withDefault(e.headers,{})),this.createAcquisitionPerformance(Qe.withDefault(e.latencyMs,0),Qe.withDefault(e.totalMs,0)),Qe.withDefault(this.consumptionId,""),!this.hasPlaybackInitiated);this.mediaEventReporter.enqueueMediaEvents([t])}),e.prototype.reportCdnAccessTokenAcquisition=freeOnUnref(function(e){var t=Tv.AcquisitionEventFactory.createAcquisitionEvent("CdnAccessToken",this.createNonFragmentAcquisitionRequest(e.url,e.headers),this.createAcquisitionResponse(e.success,Qe.withDefault(e.status,null),Qe.withDefault(e.totalBytes,0),Qe.withDefault(e.headers,{})),this.createAcquisitionPerformance(Qe.withDefault(e.latencyMs,0),Qe.withDefault(e.totalMs,0)),Qe.withDefault(this.consumptionId,""),!this.hasPlaybackInitiated);this.mediaEventReporter.enqueueMediaEvents([t])}),e.prototype.getCaching=freeOnUnref(function(e){return!(this.hasPlaybackInitiated&&this.titleId===e)}),e.prototype.determineMediaEventAssetType=freeOnUnref(function(e,t){return t?o[e]:i[e]}),e.prototype.createFragmentAcquisitionRequest=freeOnUnref(function(e){return{bitrate:e.bitrateBps,bitrateCap:null!=e.maxBitrateBitsPerSec?e.maxBitrateBitsPerSec:null,resolutionCap:null!=e.maxCappedResolution?e.maxCappedResolution:null,fragment:!0,fragmentDuration:null!=e.fragmentDurationMs?e.fragmentDurationMs:null,fragmentIndex:Qe.withDefault(e.fragmentIndex,null),fragmentResolution:null!=e.fragmentResolution?e.fragmentResolution:null,url:e.url,bytesExpected:e.expectedBytes,server:Av.EdgeServerBuilder.createEdgeServer(e.url,e.headers),qualityScore:null!=e.qualityScore?e.qualityScore:null,scoreModel:null!=e.scoreModel?e.scoreModel:null}}),e.prototype.createNonFragmentAcquisitionRequest=freeOnUnref(function(e,t){return{bitrate:null,bitrateCap:null,resolutionCap:null,fragment:!1,fragmentDuration:null,fragmentIndex:null,fragmentResolution:null,url:e,bytesExpected:null,server:Av.EdgeServerBuilder.createEdgeServer(e,t),scoreModel:null,qualityScore:null}}),e.prototype.createAcquisitionResponse=freeOnUnref(function(e,t,n,r,i){var o="Success";return e||(o=null!=i&&"Timeout"===i.reason.type?"NetworkTimeout":"UnknownError"),{response:o,responseCode:t,bytesAcquired:n,headers:this.convertHeaderValueFromStringToArray(r)}}),e.prototype.createAcquisitionPerformance=freeOnUnref(function(e,t){return{timeToFirstByte:Math.round(e),timeToLastByte:Math.round(t)}}),e.prototype.convertHeaderValueFromStringToArray=freeOnUnref(function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];t[i]=[e[i]]}return t}),e})();t.AcquisitionMediaEventController=a}));e(Dv);Dv.AcquisitionMediaEventController;var xv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("AdIdentifierMediaEventController"),n=freeOnUnref(function(){function e(e,t){this.consumptionId=null,this.auditPings=null,this.auditPingStreamId=null,this.mediaEventReporter=e,this.playerSessionId=t}return e.prototype.updateAuditPings=freeOnUnref(function(e,t){this.auditPings=e,this.auditPingStreamId=t,this.reportAdIdentifierEvent()}),e.prototype.updateConsumptionId=freeOnUnref(function(e){this.consumptionId=e,this.reportAdIdentifierEvent()}),e.prototype.reportAdIdentifierEvent=freeOnUnref(function(){if(this.consumptionId&&this.auditPingStreamId)if(this.isLegacyReportingEnabled()||null===this.auditPings){i.info("Reporting Nielsen AdIdentifier event with stream ID: "+this.auditPingStreamId);r=Tv.AdIdentifierEventFactory.createNielsenAdIdentifier(this.playerSessionId,this.auditPingStreamId);this.enqueueAdIdentifierEvent(this.consumptionId,r)}else for(var e=0,t=this.auditPings;e<t.length;e++){var n=t[e];i.info("Reporting Audit Ping AdIdentifier event with stream ID: "+this.auditPingStreamId+" for "+n.adReportingAgency+" with URL: "+n.url);var r=Tv.AdIdentifierEventFactory.createAuditPingAdIdentifier(this.playerSessionId,this.auditPingStreamId,n.adReportingAgency,n.url);this.enqueueAdIdentifierEvent(this.consumptionId,r)}}),e.prototype.enqueueAdIdentifierEvent=freeOnUnref(function(e,t){var n=Tv.AdIdentifierEventFactory.createAdIdentifierEvent(e,t);this.mediaEventReporter.enqueueMediaEvents([n])}),e.prototype.isLegacyReportingEnabled=freeOnUnref(function(){return null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.mediaEventReporting&&null!=L.configurationStore.configuration.mediaEventReporting.shouldUseNielsenAdIdentifierReporting&&L.configurationStore.configuration.mediaEventReporting.shouldUseNielsenAdIdentifierReporting}),e})();t.AdIdentifierMediaEventController=n}));e(xv);xv.AdIdentifierMediaEventController;var Fv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("BitstreamMediaEventController"),n=freeOnUnref(function(){function e(e){var a=this;this.bitstreamUpdateIntervalMs=5e3,this.bitstreamUpdateId=null,this.consumptionId=null,this.currentUrl=null,this.pitcherGroup=null,this.pointOfPresence=null,this.numReceivedBytes=0,this.numReceivedFrames=0,this.numDecryptedFrames=0,this.numDamagedAudioFrames=0,this.audioDropoutMillis=0,this.numDamagedVideoFrames=0,this.videoDivergenceMillis=0,this.bitrate=0,this.maxBitrate=1/0,this.width=0,this.maxWidth=0,this.height=0,this.maxHeight=0,this.qualityScoreUpdates=[],this.timestamp=0,this.reportBitstream=freeOnUnref(function(){if(null!=a.consumptionId)if(null!=a.bitstreamSource){null==a.currentUrl&&(a.currentUrl=a.bitstreamSource.sourceUrlGetter.get().url);var e=a.bitstreamSource.getBitstreamInfo(),t=a.bitstreamSource.getStatistics();if(null!=t&&null!=e){null!=e.pointOfPresence&&(a.pointOfPresence=e.pointOfPresence);var n=Date.now();if(0===a.bitrate&&0===a.width&&0===a.height)return a.pitcherGroup=e.pitcherGroup,a.bitrate=e.bitrate,a.maxBitrate=e.maxBitrate,a.width=e.width,a.maxWidth=e.maxWidth,a.height=e.height,void(a.maxHeight=e.maxHeight);var r=isFinite(a.maxBitrate)?a.maxBitrate:null,i=a.getQualityUpdateAverage(),o=Tv.BitstreamEventFactory.createBitstreamEvent(["Video","Audio"],a.consumptionId,a.currentUrl,Av.EdgeServerBuilder.createEdgeServer(a.currentUrl),a.bitrate,r,t.currentRoundtripMillis,a.createBitstreamBytes(t),a.createBitstreamPackets(t),a.createBitstreamFrames(t),[],n-a.timestamp,a.createResolution(a.width,a.height),a.createResolution(a.maxWidth,a.maxHeight),a.pitcherGroup,i.scoreModel,i.scoreVersion,i.qualityScore,a.pointOfPresence);a.updateLastKnownStatistics(t,e,n),a.mediaEventReporter.enqueueMediaEvents([o])}}else s.warn("Attempted to report a Bitstream event without a source");else s.warn("Attempted to report a Bitstream event without a consumptionId")}),this.onBootstrappingConfigurationFetched=freeOnUnref(function(e){var t=Qe.nestedValue(e.events.Bitstream,"period");null!=t&&t!==a.bitstreamUpdateIntervalMs&&(a.bitstreamUpdateIntervalMs=t,null!=a.bitstreamUpdateId&&a.startBitstreamUpdateInterval(!0))}),this.onNotificationReceived=freeOnUnref(function(e){switch(e.messageType){case"avqm":a.handleAvqmNotification(e)}}),this.handleAvqmNotification=freeOnUnref(function(t){var e;try{var n=JSON.parse(t.data);e={scoreModel:n.m,scoreVersion:n.v,qualityScore:n.s}}catch(e){return void s.error("Unable to parse AVQM notification due to error="+e+", data="+t.data)}0<a.qualityScoreUpdates.length&&(e.scoreVersion!==a.qualityScoreUpdates[0].scoreVersion||e.scoreModel!==a.qualityScoreUpdates[0].scoreModel)?s.warn("Dropping AVQM notification due to version or model: "+JSON.stringify(e)):a.qualityScoreUpdates.push(e)}),this.getQualityUpdateAverage=freeOnUnref(function(){if(0===a.qualityScoreUpdates.length)return{scoreModel:null,scoreVersion:null,qualityScore:null};var e=a.qualityScoreUpdates[0],t=In.average(a.qualityScoreUpdates.map(freeOnUnref(function(e){return e.qualityScore})));return{scoreModel:e.scoreModel,scoreVersion:e.scoreVersion,qualityScore:t}}),this.mediaEventReporter=e}return e.prototype.initialize=freeOnUnref(function(){this.mediaEventReporter.on("bootstrappingConfigurationFetched",this.onBootstrappingConfigurationFetched)}),e.prototype.uninitialize=freeOnUnref(function(){this.unload(),this.mediaEventReporter.off("bootstrappingConfigurationFetched",this.onBootstrappingConfigurationFetched),null!=this.bitstreamSource&&(this.bitstreamSource.off("bitstreamChange",this.reportBitstream),this.bitstreamSource.off("notificationReceived",this.onNotificationReceived))}),e.prototype.unload=freeOnUnref(function(){this.stopBitstreamUpdateInterval(),this.clearLastKnownStatistics()}),e.prototype.setBitstreamSource=freeOnUnref(function(e){this.bitstreamSource=e,this.startBitstreamUpdateInterval(),this.bitstreamSource.on("bitstreamChange",this.reportBitstream),this.bitstreamSource.on("notificationReceived",this.onNotificationReceived)}),e.prototype.updateConsumptionId=freeOnUnref(function(e){null!=this.consumptionId&&this.reportBitstream(),this.consumptionId=e,null!=this.bitstreamSource&&null!=this.bitstreamSource.sourceUrlGetter&&(this.currentUrl=this.bitstreamSource.sourceUrlGetter.get().url),this.pitcherGroup=null,this.bitrate=0,this.maxBitrate=1/0,this.width=0,this.maxWidth=0,this.height=0,this.maxHeight=0}),e.prototype.startBitstreamUpdateInterval=freeOnUnref(function(e){var t=this;void 0===e&&(e=!1),(null==this.bitstreamUpdateId||e)&&(null!=this.bitstreamUpdateId&&oe.timer.clearInterval(this.bitstreamUpdateId),this.timestamp=Date.now(),this.bitstreamUpdateId=oe.timer.setInterval(freeOnUnref(function(){t.reportBitstream()}),this.bitstreamUpdateIntervalMs))}),e.prototype.stopBitstreamUpdateInterval=freeOnUnref(function(){null!=this.bitstreamUpdateId&&(oe.timer.clearInterval(this.bitstreamUpdateId),this.bitstreamUpdateId=null)}),e.prototype.createResolution=freeOnUnref(function(e,t){return 0!==e&&0!==t&&isFinite(e)&&isFinite(t)?{width:e,height:t}:null}),e.prototype.createBitstreamBytes=freeOnUnref(function(e){return{received:(null==e.numReceivedBytes?0:e.numReceivedBytes)-this.numReceivedBytes}}),e.prototype.createBitstreamPackets=freeOnUnref(function(e){return{received:0,lost:0,retransmitted:0}}),e.prototype.createBitstreamFrames=freeOnUnref(function(e){return{received:e.numReceivedFrames-this.numReceivedFrames,damagedVideo:e.numDamagedVideoFrames-this.numDamagedVideoFrames,damagedAudio:e.numDamagedAudioFrames-this.numDamagedAudioFrames,decrypted:e.numDecryptedFrames-this.numDecryptedFrames,divergentVideoTime:e.videoDivergenceMillis-this.videoDivergenceMillis,divergentAudioTime:e.audioDropoutMillis-this.audioDropoutMillis}}),e.prototype.updateLastKnownStatistics=freeOnUnref(function(e,t,n){this.numReceivedBytes=null==e.numReceivedBytes?0:e.numReceivedBytes,this.numReceivedFrames=e.numReceivedFrames,this.numDecryptedFrames=e.numDecryptedFrames,this.numDamagedAudioFrames=e.numDamagedAudioFrames,this.audioDropoutMillis=e.audioDropoutMillis,this.numDamagedVideoFrames=e.numDamagedVideoFrames,this.videoDivergenceMillis=e.videoDivergenceMillis,this.pitcherGroup=t.pitcherGroup,this.bitrate=t.bitrate,this.maxBitrate=t.maxBitrate,this.width=t.width,this.maxWidth=t.maxWidth,this.height=t.height,this.maxHeight=t.maxHeight,this.timestamp=n,this.qualityScoreUpdates=[]}),e.prototype.clearLastKnownStatistics=freeOnUnref(function(){this.numReceivedBytes=0,this.numReceivedFrames=0,this.numDecryptedFrames=0,this.numDamagedAudioFrames=0,this.audioDropoutMillis=0,this.numDamagedVideoFrames=0,this.videoDivergenceMillis=0,this.pitcherGroup=null,this.pointOfPresence=null,this.bitrate=0,this.maxBitrate=1/0,this.width=0,this.maxWidth=0,this.height=0,this.maxHeight=0,this.timestamp=0,this.qualityScoreUpdates=[]}),e})();t.BitstreamMediaEventController=n}));e(Fv);Fv.BitstreamMediaEventController;var Bv=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("ContentMediaEventController"),r=["Draper","ATVDraperSchedulingService"],i=((n={}).Logo="Logo",n.Disclaimer="Disclaimer",n.Intro="Intro",n.PreviouslyOn="PreviouslyOn",n.NextOn="NextOn",n.BehindTheScenes="BehindTheScenes",n.Credits="Credits",n.Dubcard="Dub",n),o=freeOnUnref(function(){function e(e,t,n,r){var o=this;this.vcid=null,this.liveAdTimelineManager=null,this.onEnterItem=freeOnUnref(function(e){if(null==o.liveAdTimelineManager){var t=o.getContentId(e.item),n=o.getContent(e.item),r=null,i=o.getAssetConsumptionId(e.item);null!=i&&(r=0,"Main"===e.item.type&&(r+=e.item.timelineStart)),null!=t&&null!=n?t&&o.lastReportedId!==t&&(o.lastReportedId=t,o.reportEvent(t,Math.round(e.item.start),n,i,null!=r?Math.round(r):null)):a.warn("contentId or content is null for the current timeline item. Not reporting Content event.")}}),this.onTimeupdate=freeOnUnref(function(e){if(null!=e.periodId&&null!=o.liveAdTimelineManager){var t=null!=o.vcid?o.vcid:Vy.UUID.v4(),n={_type:"Feature"},r=o.liveAdTimelineManager.getVastAdId(e);r&&(t=r,n={_type:"Ad",subtype:"Linear"}),o.lastReportedId&&t===o.lastReportedId||(o.reportEvent(t,e.positionMs,n,null,null),o.lastReportedId=t)}}),this.mediaEventReporter=e,this.mpPlayer=t,this.sessionIdTracker=n,this.playlistEngine=r}return e.prototype.initialize=freeOnUnref(function(){this.mpPlayer.on("timeupdate",this.onTimeupdate),this.playlistEngine.on("EnterItem",this.onEnterItem)}),e.prototype.uninitialize=freeOnUnref(function(){this.mpPlayer.off("timeupdate",this.onTimeupdate),this.playlistEngine.off("EnterItem",this.onEnterItem)}),e.prototype.unload=freeOnUnref(function(){this.vcid=null,this.lastReportedId=void 0,this.liveAdTimelineManager=null}),e.prototype.setVcid=freeOnUnref(function(e){this.vcid=e}),e.prototype.setLiveAdTimelineManager=freeOnUnref(function(e){this.liveAdTimelineManager=e}),e.prototype.reportSyeContentMediaEvent=freeOnUnref(function(e,t){if("Feature"===e.contentType){null==this.vcid&&(this.vcid=Vy.UUID.v4());var n=this.vcid,r={_type:"Feature"};this.reportEvent(n,t,r,null,null)}else if("Ad"===e.contentType){n=e.contentId,r={_type:"Ad",subtype:"Linear",adNumberWithinBreak:e.adNumberWithinBreak,breakNumber:e.breakNumber};this.reportEvent(n,t,r,null,null)}else a.warn("Attempt to report an unknown Sye event: "+e)}),e.prototype.reportEvent=freeOnUnref(function(e,t,n,r,i){var o=Tv.ContentEventFactory.createContentEvent(e,Math.round(t),n,r,i,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId());this.mediaEventReporter.enqueueMediaEvents([o])}),e.prototype.getContentId=freeOnUnref(function(e){switch(e.type){case"Ad":case"AdTransition":case"Aux":var t=e.catalogMetadata;if(null==t)return;return t.adId;case"Main":case"Recap":return e.titleId}}),e.prototype.getContent=freeOnUnref(function(e){switch(e.type){case"Ad":case"AdTransition":return this.getAdContent(e);case"Aux":return this.getAuxContent(e);case"Main":case"Recap":return{_type:"Feature"}}return null}),e.prototype.getAdContent=freeOnUnref(function(e){var t=e.catalogMetadata;return null==t?null:{_type:"Ad",subtype:this.getAdSubType(e),server:t.adSystem.name,breakType:t.breakType,breakNumber:t.breakNumber,adNumberWithinBreak:t.adNumberWithinBreak}}),e.prototype.getAdSubType=freeOnUnref(function(e){var t=e.catalogMetadata;return x.contains(r,t.adSystem.name)?"Draper":"AdTransition"===e.type?"Transition":null!=t.extensions&&0<t.extensions.length&&t.extensions.some(freeOnUnref(function(e){return"ava.amazon.com/actionable"===e.attributes.type}))?"IVA":"Linear"}),e.prototype.getAuxContent=freeOnUnref(function(e){var t=e.catalogMetadata;if(null==t)return null;var n=t.contentSubType;return null==n?null:{_type:"Aux",subtype:i[n]}}),e.prototype.getAssetConsumptionId=freeOnUnref(function(e){if(null==e.sourceUrlStore)return null;var t=e.sourceUrlStore.get();return null==t.assetConsumptionId?null:t.assetConsumptionId}),e})();t.ContentMediaEventController=o}));e(Bv);Bv.ContentMediaEventController;var Lv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.timer=oe.timer}return e.prototype.throttle=freeOnUnref(function(n,r){var i=null,o=null,a=null,s=null,l=freeOnUnref(function(){s=x.now(),i=null,n.apply(o,a),Qe.isNullOrUndefined(i)&&(a=o=null)}),f=this;return freeOnUnref(function(){var e=x.now(),t=r-(e-(null===s?0:s));o=f,a=arguments,null===s||t<=0||r<t?(i&&(f.timer.clearTimeout(i),i=null),s=e,n.apply(o,a),Qe.isNullOrUndefined(i)&&(a=o=null)):Qe.isNullOrUndefined(i)&&(i=f.timer.setTimeout(l,t))})}),e})();t.FunctionThrottler=n}));e(Lv);Lv.FunctionThrottler;var Nv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionThrottler=Lv.FunctionThrottler}));e(Nv);Nv.FunctionThrottler;var Vv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={ethernet:"Ethernet",wifi:"WiFi",cellular:"Cellular"},n="Unknown",i=(de.get("ContextualMediaEventController"),freeOnUnref(function(){function e(e,t,n,r,i,o,a,s){var l=this;this.displayMode="Fullscreen",this.viewportMode="Fullscreen",this.additionalWeblabs={},this.volume=null,this.volumeFeature=null,this.featureFlagsMap={},this.playerCapabilities=[],this.consumptionId=null,this.playbackSettingsId=null,this.playbackSettings=null,this.lastApplicationViewport=null,this.lastDisplayDimensions=null,this.lastNetworkType=null,this.preInitHit=null,this.getContextualMediaEvents=freeOnUnref(function(){var e=[];e.push(Tv.ContextualEventFactory.createDeviceEvent(l.hardware,l.software)),e.push(l.createNetworkEvent()),e.push(l.createDisplayEvent()),e.push(l.createPlayerEvent()),e.push(l.createViewportEvent()),e.push.apply(e,l.createWeblabEvents());var t=l.streamMediaEventController.getAudioTrackEvent();null!=t&&e.push(t);var n=l.streamMediaEventController.getVideoTrackEvent();null!=n&&e.push(n),0<Object.keys(l.featureFlagsMap).length&&e.push(l.createFeatureFlagsEvent());var r=l.deviceFulfillmentMediaEventController.createDeviceFulfillmentEvent();return null!=r&&e.push(r),e.push(Tv.ContextualEventFactory.createAudioEvent(Qe.withDefault(l.volume,100),l.sessionIdTracker.getPlayerInstanceId(),l.sessionIdTracker.getWatchSessionId())),e.push(l.createPlayerHeuristicEvent()),0<l.playerCapabilities.length&&e.push(l.createPlayerCapabilitiesEvent()),e}),this.onDisplayChanged=freeOnUnref(function(e){var t={height:e.height,width:e.width};x.isEqual(t,l.lastDisplayDimensions)||(l.lastDisplayDimensions=t,l.mediaEventReporter.enqueueMediaEvents([l.createDisplayEvent()]))}),this.onApplicationViewportChanged=freeOnUnref(function(e){x.isEqual(e,l.lastApplicationViewport)||(l.lastApplicationViewport=e,l.mediaEventReporter.enqueueMediaEvents([l.createDisplayEvent(),l.createViewportEvent()]))}),this.onNetworkChanged=freeOnUnref(function(e){e.type!==l.lastNetworkType&&(l.lastNetworkType=e.type,l.mediaEventReporter.enqueueMediaEvents([l.createNetworkEvent()]))}),this.mediaEventReporter=e,this.streamMediaEventController=i,this.applicationIdentity=o,this.clientIdentity=a,this.uiIdentity=s,this.sessionIdTracker=n,this.deviceFulfillmentMediaEventController=r;var f=zt.deviceInformation;this.hardware=this.mergeHardware(f.hardware,t),this.software=this.mergeSoftware(f.software);var u=new Nv.FunctionThrottler;this.throttledUpdateVolume=u.throttle(freeOnUnref(function(){l.updateVolume()}),1e4)}return e.prototype.initialize=freeOnUnref(function(e){this.mediaEventReporter.prepare(this.getContextualMediaEvents);var t=zt.deviceCapabilities;t.on("output.video.display",this.onDisplayChanged),t.on("output.video.applicationViewport",this.onApplicationViewportChanged),t.on("network",this.onNetworkChanged),null!=e&&(this.volumeFeature=e,this.volume=this.normalizeVolume(e.volume),this.volumeFeature.onChange(this.throttledUpdateVolume))}),e.prototype.unload=freeOnUnref(function(){this.featureFlagsMap={},this.playerCapabilities=[],this.preInitHit=null,ip.CacheStatusTracker.reset()}),e.prototype.setDisplayMode=freeOnUnref(function(e){var t=this.displayMode;this.displayMode=e,this.displayMode!==t&&this.mediaEventReporter.enqueueMediaEvents([this.createDisplayEvent()])}),e.prototype.setViewportMode=freeOnUnref(function(e){e!==this.viewportMode&&(this.viewportMode=e,this.mediaEventReporter.enqueueMediaEvents([this.createViewportEvent()]))}),e.prototype.reportCapability=freeOnUnref(function(e){-1===this.playerCapabilities.indexOf(e)&&(this.playerCapabilities.push(e),this.mediaEventReporter.enqueueMediaEvents([this.createPlayerCapabilitiesEvent()]))}),e.prototype.reportFeatureFlag=freeOnUnref(function(e,t){this.featureFlagsMap[e]=t,this.mediaEventReporter.enqueueMediaEvents([this.createFeatureFlagsEvent()])}),e.prototype.reportWeblab=freeOnUnref(function(e,t){this.additionalWeblabs[e]=t}),e.prototype.updateConsumptionId=freeOnUnref(function(e){this.consumptionId=e}),e.prototype.uninitialize=freeOnUnref(function(){var e=zt.deviceCapabilities;e.off("output.video.display",this.onDisplayChanged),e.off("output.video.applicationViewport",this.onApplicationViewportChanged),e.off("network",this.onNetworkChanged),null!=this.volumeFeature&&(this.volumeFeature.offChange(this.throttledUpdateVolume),this.volumeFeature=null,this.volume=null)}),e.prototype.updatePlaybackSettings=freeOnUnref(function(e,t){this.playbackSettingsId=e,this.playbackSettings=t,this.mediaEventReporter.enqueueMediaEvents([this.createPlayerHeuristicEvent()])}),e.prototype.updatePreinitHit=freeOnUnref(function(e){this.preInitHit=e}),e.prototype.updateCacheStatus=freeOnUnref(function(e){}),e.prototype.mergeHardware=freeOnUnref(function(e,t){return{classTypeId:t,manufacturer:Qe.withDefault(e.manufacturer,""),modelName:Qe.nestedValue(e,"model.name"),chipset:Qe.withDefault(e.chipset,null)}}),e.prototype.mergeSoftware=freeOnUnref(function(e){var t;return t=null!=this.clientIdentity?{name:this.clientIdentity.name,version:Qe.withDefault(this.clientIdentity.version,n)}:null!=e.nativeRuntime?{name:e.nativeRuntime.name,version:e.nativeRuntime.version}:null,{application:null!=this.applicationIdentity?{name:this.applicationIdentity.name,version:Qe.withDefault(this.applicationIdentity.version,n)}:null!=e.nativeApplication?{name:Qe.withDefault(e.nativeApplication.name,n),version:Qe.withDefault(e.nativeApplication.version,n)}:{name:n,version:n},operatingSystem:{name:e.operatingSystem.name,version:Qe.withDefault(e.operatingSystem.version,n)},firmware:null!=e.firmware?{name:Qe.withDefault(e.firmware.name,null),version:e.firmware.version}:null,middleware:null!=e.middleware?{name:e.middleware.name,version:e.middleware.version,userAgent:Qe.withDefault(e.middleware.userAgent,null)}:null,runtime:t,ui:null!=this.uiIdentity?{name:this.uiIdentity.name,version:this.uiIdentity.version}:null,browser:null!=e.browser?{name:e.browser.name,version:e.browser.version,userAgent:e.browser.userAgent}:null,scriptEngine:null!=e.scriptEngine?{name:e.scriptEngine.name,version:e.scriptEngine.version}:null,player:this.createPlayerProperties(),attributionTag:null}}),e.prototype.createNetworkEvent=freeOnUnref(function(){var e=zt.deviceCapabilities.network,t="none"!==e.type,n=Qe.withDefault(r[e.type],"Unknown");return Tv.ContextualEventFactory.createNetworkEvent(n,t,!0,null,null)}),e.prototype.createDisplayEvent=freeOnUnref(function(){var e=zt.deviceCapabilities,t=e.output.video.display,n=e.output.video.applicationViewport;return Tv.ContextualEventFactory.createDisplayEvent(!0,{height:t.height,width:t.width},this.displayMode,n)}),e.prototype.createPlayerProperties=freeOnUnref(function(){var e=zt.deviceInformation.software;return{name:"XP Player",version:Qe.nestedValue(e.playerBundle,"version",n)}}),e.prototype.createPlayerEvent=freeOnUnref(function(){var e=this.createPlayerProperties();return Tv.ContextualEventFactory.createPlayerEvent(this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId(),e,void 0,this.preInitHit,ip.CacheStatusTracker.getCacheStatus())}),e.prototype.createViewportEvent=freeOnUnref(function(){var e=zt.deviceCapabilities.output.video.applicationViewport;return Tv.ContextualEventFactory.createViewportEvent(this.viewportMode,e,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId())}),e.prototype.createWeblabEvents=freeOnUnref(function(){var e=[];if(null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.weblabs)for(var t=L.configurationStore.configuration.weblabs,n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];e.push(Tv.ContextualEventFactory.createWeblabEvent(i,t[i]))}for(var o=0,a=Object.keys(this.additionalWeblabs);o<a.length;o++){i=a[o];e.push(Tv.ContextualEventFactory.createWeblabEvent(i,this.additionalWeblabs[i]))}return e}),e.prototype.createFeatureFlagsEvent=freeOnUnref(function(){return Tv.ContextualEventFactory.createFeatureFlagsEvent(this.featureFlagsMap,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId())}),e.prototype.updateVolume=freeOnUnref(function(){if(null!=this.volumeFeature){var e=this.normalizeVolume(this.volumeFeature.volume);if(this.volume!==e){this.volume=e;var t=Tv.ContextualEventFactory.createAudioEvent(this.volume,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId());this.mediaEventReporter.enqueueMediaEvents([t])}}}),e.prototype.normalizeVolume=freeOnUnref(function(e){return Math.round(100*e)}),e.prototype.createPlayerHeuristicEvent=freeOnUnref(function(){var e=null,t=null,n=null,r=null,i=null,o=null,a=null,s=null,l=null,f=null;if(null!=this.playbackSettings){var u=this.playbackSettings.metadata,c=this.playbackSettings.player,d=this.playbackSettings.buffer;e=this.playbackSettings.metadata.treatmentName,t=c.heuristicAlgorithm,n=u.clusterLabel,r=u.apiCallType,i=u.classifierName,o=u.policyId,a=d.delayBehindLiveHeadSeconds,s=u.clusterModelVersion,l=null!=u.megaClusterLabel?u.megaClusterLabel:null,f=null!=u.heuristicProfileId?u.heuristicProfileId:null}return Tv.ContextualEventFactory.createPlayerHeuristicEvent("Miyagi",this.playbackSettingsId,e,t,n,r,i,o,a,s,l,f)}),e.prototype.createPlayerCapabilitiesEvent=freeOnUnref(function(){return Tv.CapabilitiesEventFactory.createPlayerCapabilitiesEvent(this.playerCapabilities,this.consumptionId,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId())}),e})());t.ContextualMediaEventController=i}));e(Vv);Vv.ContextualMediaEventController;var jv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){var r=this;this.onPlaybackStateChange=freeOnUnref(function(e){"playing"===e.playbackState&&r.reportMpPlayerCustomMetadata()}),this.mediaEventReporter=e,this.mpPlayer=t,this.sessionIdTracker=n}return e.prototype.initialize=freeOnUnref(function(){this.mpPlayer.on("playbackStateChange",this.onPlaybackStateChange)}),e.prototype.uninitialize=freeOnUnref(function(){this.mpPlayer.off("playbackStateChange",this.onPlaybackStateChange)}),e.prototype.reportCustomMetadata=freeOnUnref(function(e){var t=this.createCustomMetadataEvent(e);this.mediaEventReporter.enqueueMediaEvents([t])}),e.prototype.reportMpPlayerCustomMetadata=freeOnUnref(function(){var e=this.mpPlayer.metadata;null!=e&&this.reportCustomMetadata(e)}),e.prototype.createCustomMetadataEvent=freeOnUnref(function(e){return Tv.CustomMetadataEventFactory.createCustomMetadataEvent(e,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId())}),e})();t.CustomMetadataEventController=n}));e(jv);jv.CustomMetadataEventController;var qv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.mediaEventReporter=e,this.sessionIdTracker=t}return e.prototype.reportCustomMetrics=freeOnUnref(function(e){var t=Tv.CustomMetricsEventFactory.createCustomMetricsEvent(e,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId());this.mediaEventReporter.enqueueMediaEvents([t])}),e})();t.CustomMetricsController=n}));e(qv);qv.CustomMetricsController;var Hv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.titleId=null,this.videoMaterialType=null,this.consumptionId=null,this.mediaEventReporter=e,this.deviceId=n,this.sessionIdTracker=t}return e.prototype.unload=freeOnUnref(function(){this.consumptionId=null,this.titleId=null,this.videoMaterialType=null}),e.prototype.updateConsumptionId=freeOnUnref(function(e){this.consumptionId=e}),e.prototype.reportDeviceFulfillmentEvent=freeOnUnref(function(){var e=this.createDeviceFulfillmentEvent();null!=e&&this.mediaEventReporter.enqueueMediaEvents([e])}),e.prototype.setParameters=freeOnUnref(function(e,t){this.titleId=e,this.videoMaterialType="LiveStreaming"===t?"Live":"VOD"}),e.prototype.createDeviceFulfillmentEvent=freeOnUnref(function(){return null==this.titleId||null==this.videoMaterialType||null==this.consumptionId?null:Tv.ContextualEventFactory.createDeviceFulfillmentEvent(this.deviceId,this.titleId,this.videoMaterialType,this.consumptionId,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId())}),e})();t.DeviceFulfillmentMediaEventController=n}));e(Hv);Hv.DeviceFulfillmentMediaEventController;var zv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var b=de.get("PlaybackMediaEventController"),n=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.contentSource=null,this.playbackUpdateIntervalMs=1e4,this.playbackUpdateId=null,this.droppedFramesReported=0,this.contentState=null,this.playbackState=null,this.hasLoadedContent=!1,this.frontBufferTimeCapacityMs=fh.BufferConstants.MAX_FRONT_BUFFER_MS,this.backBufferTimeCapacityMs=fh.BufferConstants.MAX_BACK_BUFFER_MS,this.consumptionId=null,this.playbackContentContext="Feature",this.clientId=null,this.lastKnownPlayheadMs=null,this.currentPlaybackState="Stop",this.isOpen=!1,this.flushBatchOnUnload=!1,this.disableContextEventReporting=!1,this.onContentStateChange=freeOnUnref(function(e){if(i.contentState!==e.contentState){switch(e.contentState){case"ready":i.hasLoadedContent||(i.hasLoadedContent=!0,i.reportAction("ReadyToWatch")),"playing"===i.playbackState&&i.reportAction("Start");break;case"waiting":case"error":"ready"===i.contentState&&"playing"===i.playbackState&&i.reportAction("Stop",e.playbackPositionMs)}"unloaded"===e.contentState&&(i.hasLoadedContent=!1,i.droppedFramesReported=0),i.contentState=e.contentState}}),this.onPlaybackStateChange=freeOnUnref(function(e){var t=e.playbackState;if(i.playbackState!==t&&(i.playbackState=t,"ready"===i.contentState))switch(null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.mediaEventReporting&&!0===L.configurationStore.configuration.mediaEventReporting.reportPlatformTriggeredPause&&!0===e.platformTriggered&&i.reportInteraction("PlayerSDK","Pause","Forced","Platform"),t){case"playing":i.reportAction("Start",e.playbackPositionMs);break;case"paused":i.reportAction("Stop",e.playbackPositionMs);break;default:return}}),this.onTimeupdate=freeOnUnref(function(e){i.lastKnownPlayheadMs=e.positionMs}),this.onContentEnded=freeOnUnref(function(e){i.lastKnownPlayheadMs=e}),this.onBootstrappingConfigurationFetched=freeOnUnref(function(e){var t=Qe.nestedValue(e.events.Playback,"period");null!=t&&t!==i.playbackUpdateIntervalMs&&(i.playbackUpdateIntervalMs=t,null!=i.playbackUpdateId&&i.startPlaybackUpdateInterval(!0))}),this.mediaEventReporter=e,this.mpPlayer=t,this.playlistEngine=r,this.timer=oe.timer,this.sessionIdTracker=n;var o=L.configurationStore.configuration;null!=o&&null!=o.mediaEventReporting&&(this.flushBatchOnUnload=!0===o.mediaEventReporting.flushBatchOnUnload,this.disableContextEventReporting=!0===o.mediaEventReporting.disableContextEventReporting)}return e.prototype.initialize=freeOnUnref(function(){this.mpPlayer.on("contentStateChange",this.onContentStateChange),this.mpPlayer.on("playbackStateChange",this.onPlaybackStateChange),this.mpPlayer.on("timeupdate",this.onTimeupdate),this.mpPlayer.on("ended",this.onContentEnded),this.mediaEventReporter.on("bootstrappingConfigurationFetched",this.onBootstrappingConfigurationFetched)}),e.prototype.uninitialize=freeOnUnref(function(){this.mpPlayer.off("contentStateChange",this.onContentStateChange),this.mpPlayer.off("playbackStateChange",this.onPlaybackStateChange),this.mpPlayer.off("timeupdate",this.onTimeupdate),this.mpPlayer.off("ended",this.onContentEnded),this.mediaEventReporter.off("bootstrappingConfigurationFetched",this.onBootstrappingConfigurationFetched),this.stopPlaybackUpdateInterval(),this.contentState=null,this.playbackState=null,this.currentPlaybackState="Stop"}),e.prototype.setContentSource=freeOnUnref(function(e){this.contentSource=e}),e.prototype.unload=freeOnUnref(function(){this.isOpen||(this.consumptionId=null),this.contentSource=null,this.playbackContentContext="Feature"}),e.prototype.updateBufferSettings=freeOnUnref(function(e){null!=e?(this.frontBufferTimeCapacityMs=1e3*e.forwardBufferLengthSeconds,this.backBufferTimeCapacityMs=1e3*e.backwardBufferLengthSeconds):(this.frontBufferTimeCapacityMs=fh.BufferConstants.MAX_FRONT_BUFFER_MS,this.backBufferTimeCapacityMs=fh.BufferConstants.MAX_BACK_BUFFER_MS)}),e.prototype.updateConsumptionId=freeOnUnref(function(e){this.consumptionId!==e&&(this.consumptionId=e,"Start"===this.currentPlaybackState&&this.reportAction("Update"))}),e.prototype.updateClientId=freeOnUnref(function(e){this.clientId=null==e?null:e}),e.prototype.updatePlaybackContentContext=freeOnUnref(function(e){var t=this;if(this.hasLoadedContent&&!this.disableContextEventReporting){if(this.playbackContentContext!==e){var n=this.currentPlaybackState;"Start"===this.currentPlaybackState&&this.reportAction("Stop"),this.playbackContentContext=e,this.reportAction("Context"),this.timer.setImmediate(freeOnUnref(function(){"ready"===t.mpPlayer.contentState&&"playing"===t.mpPlayer.playbackState&&"Start"===n&&t.reportAction("Start")}))}}else this.playbackContentContext=e}),e.prototype.getIsOpen=freeOnUnref(function(){return this.isOpen}),e.prototype.reportPlaybackEvent=freeOnUnref(function(e){if("Open"===e){if(this.isOpen)return;this.isOpen=!0,null===(t=this.getPlayheadPositionMs())&&(t=0),this.report("Open",this.consumptionId,t),this.sessionIdTracker.resetStashedWatchSessionId()}else if("Exit"===e){var t;if("Start"===this.currentPlaybackState&&this.reportAction("Stop"),this.isOpen)null===(t=this.getPlayheadPositionMs())&&(t=0),this.report("Exit",this.consumptionId,t),this.sessionIdTracker.updateWatchSessionId(),this.isOpen=!1,this.flushBatchOnUnload&&this.mediaEventReporter.dispatchMediaEvents();this.consumptionId=null}else"Stop"===e&&this.reportAction("Stop")}),e.prototype.reportAction=freeOnUnref(function(e,t){if("Start"===e){if(this.startPlaybackUpdateInterval(),"Start"===this.currentPlaybackState)return void b.warn("Attempted to report Playback.Start while the last action reported was already Playback.Start.")}else if("Stop"===e&&(this.stopPlaybackUpdateInterval(),"Stop"===this.currentPlaybackState))return void b.warn("Attempted to report Playback.Stop before reporting a Playback.Start event.");var n=null;"Stop"===e&&(n=this.lastKnownPlayheadMs),null==n&&(n=null!=t?t:this.getPlayheadPositionMs()),null!==n?null!==this.consumptionId?this.report(e,this.consumptionId,n):b.warn("Cannot report Playback events without a valid consumptionId"):b.warn("Cannot report Playback events without a known playhead.")}),e.prototype.report=freeOnUnref(function(e,t,n){var r=[],i=[],o=this.mpPlayer.getBufferInformationProvider();if(null===o)b.warn("Cannot report Playback events buffer without a BufferInformationProvider.");else for(var a=o.getBufferInformation(),s=0,l=Object.keys(a);s<l.length;s++){var f=l[s];r.push(this.createPlaybackBuffer(f,a[f].front,this.frontBufferTimeCapacityMs)),i.push(this.createPlaybackBuffer(f,a[f].back,this.backBufferTimeCapacityMs))}var u=0,c=this.mpPlayer.getPlaybackQualityProvider();if(null!=c){var d=c.getVideoDecodePerformance();if(null!=d){var p=d.droppedVideoFrames,h=p-this.droppedFramesReported;2073600<=h?(b.info("Dropped video frames metric threshold exceeded, dropping emission. Dropped frames: "+h),q.metrics.putMetric("Reporting.DroppedFrames.ThresholdExceededError")):(u=h,this.droppedFramesReported=p)}}var m=null;null!=this.contentSource&&this.contentSource.availabilityTimeWindow.isUpdating()&&(m=Math.max(this.contentSource.availabilityTimeWindow.endMs,n),m=Math.round(m));var y=this.sessionIdTracker.getWatchSessionId();"Exit"===e&&(y=this.sessionIdTracker.getStashedWatchSessionId(),this.sessionIdTracker.resetStashedWatchSessionId());var g=null,v=null,O=this.playlistEngine.getCurrentItem();if(null!=O&&null!=O.sourceUrlStore){var S=O.sourceUrlStore.get();null!=S.assetConsumptionId&&(g=S.assetConsumptionId,v=n-O.start,"Main"===O.type&&(v+=O.timelineStart))}var U=Tv.PlaybackEventFactory.createPlaybackEvent(t,e,Math.round(n),this.playbackContentContext,r,i,u,0,g,null!=v?Math.round(v):null,this.sessionIdTracker.getPlayerInstanceId(),y,m,this.clientId);this.mediaEventReporter.enqueueMediaEvents([U]),"Start"!==e&&"Stop"!==e||(this.currentPlaybackState=e)}),e.prototype.createPlaybackBuffer=freeOnUnref(function(e,t,n){return{type:e,timeAvailable:Math.round(t.endTimeMs-t.startTimeMs),timeCapacity:n,bytesAvailable:Qe.withDefault(t.sizeBytes,0),bytesCapacity:zt.deviceInformation.storage.fragmentCache.sizeBytes}}),e.prototype.startPlaybackUpdateInterval=freeOnUnref(function(e){var t=this;void 0===e&&(e=!1),(null==this.playbackUpdateId||e)&&(null!=this.playbackUpdateId&&this.timer.clearInterval(this.playbackUpdateId),this.playbackUpdateId=this.timer.setInterval(freeOnUnref(function(){t.reportAction("Update")}),this.playbackUpdateIntervalMs))}),e.prototype.stopPlaybackUpdateInterval=freeOnUnref(function(){null!=this.playbackUpdateId&&(this.timer.clearInterval(this.playbackUpdateId),this.playbackUpdateId=null)}),e.prototype.getPlayheadPositionMs=freeOnUnref(function(){var e=this.mpPlayer.currentTimeMs;return null!==e&&(this.lastKnownPlayheadMs=e),this.lastKnownPlayheadMs}),e.prototype.reportInteraction=freeOnUnref(function(e,t,n,r){var i=Tv.InteractionEventFactory.createInteractionEvent(e,t,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId(),n,r);this.mediaEventReporter.enqueueMediaEvents([i])}),e})();t.PlaybackMediaEventController=n}));e(zv);zv.PlaybackMediaEventController;var Wv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.matches=freeOnUnref(function(e,t){throw new Error("Not implemented.")}),e.prototype.getId=freeOnUnref(function(){return"Base"}),e.prototype.getDescription=freeOnUnref(function(){throw new Error("Not implemented.")}),e})();t.BaseMatcher=n}));e(Wv);Wv.BaseMatcher;var Kv=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function u(){}return u.findInsufficientInMemoryBufferType=freeOnUnref(function(e){if(null==e||e.inMemoryBufferSizeSec>e.inMemoryReadyBufferSizeThresholdSec||e.isInMemoryBufferedToCapacity)return null;if(null==e.inMemoryBufferedSec)return null;var t=u.calculateBufferInformation(e.inMemoryBufferedSec.Video,e.mediaPlayerCurrentTimeSec),n=u.calculateBufferInformation(e.inMemoryBufferedSec.Audio,e.mediaPlayerCurrentTimeSec);return null!=t||null!=n?null==t?"Video":null==n?"Audio":t.bufferSizeSec<=n.bufferSizeSec?"Video":"Audio":void 0}),u.findInsufficientSourceBufferType=freeOnUnref(function(e){if(null==e||e.sourceBufferSizeSec>=e.sourceBufferReadyLengthSec||null==e.sourceBufferRangesSec)return null;var t=u.calculateBufferInformation(e.sourceBufferRangesSec.Video,e.mediaPlayerCurrentTimeSec),n=u.calculateBufferInformation(e.sourceBufferRangesSec.Audio,e.mediaPlayerCurrentTimeSec);return null!=t||null!=n?null==t?"Video":null==n?"Audio":t.bufferSizeSec<=n.bufferSizeSec?"Video":"Audio":void 0}),u.calculateBufferInformation=freeOnUnref(function(e,t){var n=u.findBufferedRangeIndex(e,t);if(-1===n)return null;for(var r=e[n],i=n+1;i<e.length;i++){if(e[i].start!==r.end)return{bufferEndSec:r.end,bufferSizeSec:r.end-t};r=e[i]}return{bufferEndSec:r.end,bufferSizeSec:r.end-t}}),u.findBufferedRangeIndex=freeOnUnref(function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.start<=t+1e-5&&r.end>=t-1e-5)return n}return-1}),u.findPendingMediaFragment=freeOnUnref(function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.segment.index===t.index)return r}return null}),u.findPendingMediaFragmentByPosition=freeOnUnref(function(e,t,n){null==n&&(n=.01);for(var r=0;r<e.length;r++){var i=e[r];if(i.segment.startMs<=t+n&&i.segment.endMs>=t-n)return i}return null}),u.findUnfinishedSegmentInDownloadQueue=freeOnUnref(function(e,t,n){void 0===n&&(n=.01);for(var r=0;r<e.length;r++){var i=e[r];if(i.startMs-n<=t&&i.endMs+n>=t&&!i.done)return i}return null}),u.calculateHigherPriorityStreamType=freeOnUnref(function(e,t,n){var r=u.findUnfinishedSegmentInDownloadQueue(e,n),i=u.findUnfinishedSegmentInDownloadQueue(t,n);return null==r&&null==i?null:null==r?"Audio":null==i?"Video":r.startMs<=i.startMs?"Video":"Audio"}),u.isPositionBetweenGaps=freeOnUnref(function(e,t,n){if(t.length<=1)return!1;for(var r=0;r<t.length-1;r++){var i=t[r],o=t[r+1];if(i.end<=e&&e<=o.start&&o.start-i.end<n)return!0}return!1}),u.hasGapWithinDistance=freeOnUnref(function(e,t,n,r){var i=u.findBufferedRangeIndex(e,t);if(-1===i)return!1;for(var o=t+n,a=e[i],s=i;s<e.length-1;s++){var l=e[s+1];if(l.start>o)break;var f=l.start-a.end;if(0<f&&f<r)return!0;a=l}return!1}),u.getLinearizationPool=freeOnUnref(function(e){if(null!=e.linearizationPool)return e.linearizationPool;if(null!=e.activeChannels){var t=null!=e.pendingRemovalChannels?e.pendingRemovalChannels:[];return e.activeChannels.concat(t)}return null}),u.getPendingNetworkRequests=freeOnUnref(function(e){var t=e["NetworkRequestManager.RequestScheduler"];if(null==t)return[];var n=this.getLinearizationPool(t);if(null==n||null==e["NetworkRequestManager.QueuedRequestPool"])return[];for(var r=[],i=0,o=n.concat([{inflightRequests:e["NetworkRequestManager.QueuedRequestPool"].requests}]);i<o.length;i++){var a=o[i];r.push.apply(r,a.inflightRequests)}return r}),u})();t.MatcherUtilities=n}));e(Kv);Kv.MatcherUtilities;var Gv=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.insufficientBufferType=null,e}return n(e,t),e.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;return this.insufficientBufferType=Kv.MatcherUtilities.findInsufficientInMemoryBufferType(n),null!==this.insufficientBufferType&&!1===n.seeking}),e.prototype.getId=freeOnUnref(function(){return"InsufficientInMemoryBuffer"}),e.prototype.getDescription=freeOnUnref(function(){return"Matches when the inMemoryBuffer is insufficient and not buffered to capacity and readyTracker.seeking is false"}),e})(Wv.BaseMatcher);t.InsufficientInMemoryBufferMatcher=r}));e(Gv);Gv.InsufficientInMemoryBufferMatcher;var Qv=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return n(e,a),e.prototype.matches=freeOnUnref(function(e,t){if(!a.prototype.matches.call(this,e,t))return!1;var n=e.ReadyTracker;if(null==n)return!1;if(n.isBufferedToEnd||n.isInMemoryBufferedToCapacity)return!1;if(null==this.insufficientBufferType)return!1;if(null==n.inMemoryBufferedSec)return!1;var r=n.inMemoryBufferedSec[this.insufficientBufferType];if(null==r)return!1;var i=n.mediaPlayerCurrentTimeSec,o=n.inMemoryReadyBufferSizeThresholdSec;return Kv.MatcherUtilities.hasGapWithinDistance(r,i,o,1)}),e.prototype.getId=freeOnUnref(function(){return"MicroGapInsufficientInMemoryBuffer"}),e.prototype.getDescription=freeOnUnref(function(){return"Matches when 1) inMemoryBuffer is insufficient, 2) not buffered to end/capacity, 3) not seeking, and 4) there exists a small in-memory gap within the ready threshold"}),e})(Gv.InsufficientInMemoryBufferMatcher);t.MicroGapInsufficientInMemoryBufferMatcher=r}));e(Qv);Qv.MicroGapInsufficientInMemoryBufferMatcher;var Xv=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(a){function e(){var e=null!==a&&a.apply(this,arguments)||this;return e.neededFragmentPositionMs=null,e}return n(e,a),e.prototype.matches=freeOnUnref(function(e,t){if(!a.prototype.matches.call(this,e,t))return!1;var n=e.ReadyTracker;if(void 0===this.insufficientBufferType){if(null==e["SegmentDownloadQueue.Video"]||null==e["SegmentDownloadQueue.Audio"])return!1;this.insufficientBufferType=Kv.MatcherUtilities.calculateHigherPriorityStreamType(e["SegmentDownloadQueue.Video"].queue,e["SegmentDownloadQueue.Audio"].queue,1e3*n.mediaPlayerCurrentTimeSec)}if(null==this.insufficientBufferType)return!1;if(null==n||null==n.inMemoryBufferedSec)return!1;var r="Video"===this.insufficientBufferType?n.inMemoryBufferedSec.Video:n.inMemoryBufferedSec.Audio,i="Video"===this.insufficientBufferType?e["StreamAcquirer.Video"]:e["StreamAcquirer.Audio"],o="Video"===this.insufficientBufferType?e["SegmentDownloadQueue.Video"]:e["SegmentDownloadQueue.Audio"];return null!=i&&null!=o&&(this.inMemoryBuffer=Kv.MatcherUtilities.calculateBufferInformation(r,n.mediaPlayerCurrentTimeSec),this.neededFragmentPositionMs=1e3*(null!=this.inMemoryBuffer?this.inMemoryBuffer.bufferEndSec:n.mediaPlayerCurrentTimeSec),this.segmentInDownloadQueue=Kv.MatcherUtilities.findUnfinishedSegmentInDownloadQueue(o.queue,this.neededFragmentPositionMs),null!=this.segmentInDownloadQueue&&(this.pendingMediaFragment=Kv.MatcherUtilities.findPendingMediaFragment(i.pendingMediaFragments,this.segmentInDownloadQueue),null!=this.pendingMediaFragment&&!0===this.segmentInDownloadQueue.claimed&&!1===this.segmentInDownloadQueue.done))}),e.prototype.getId=freeOnUnref(function(){return"NeededFragment"}),e.prototype.getDescription=freeOnUnref(function(){return a.prototype.getDescription.call(this)+", the next fragment needed by the inMemoryBuffer is queued in the SegmentDownloadQueue"}),e})(Gv.InsufficientInMemoryBufferMatcher);t.NeededFragmentMatcher=r}));e(Xv);Xv.NeededFragmentMatcher;var Yv=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(l){function e(){return null!==l&&l.apply(this,arguments)||this}return n(e,l),e.prototype.matches=freeOnUnref(function(e,t){if(!l.prototype.matches.call(this,e,t))return!1;var n=e.ReadyTracker;if(void 0===this.insufficientBufferType)return!1;if(null==n||null==n.inMemoryBufferedSec)return!1;var r="Video"===this.insufficientBufferType?n.inMemoryBufferedSec.Video:n.inMemoryBufferedSec.Audio,i="Video"===this.insufficientBufferType?e["StreamAcquirer.Video"]:e["StreamAcquirer.Audio"],o="Video"===this.insufficientBufferType?e["SegmentDownloadQueue.Video"]:e["SegmentDownloadQueue.Audio"];if(null==i||null==o)return!1;var a=Kv.MatcherUtilities.findBufferedRangeIndex(r,n.mediaPlayerCurrentTimeSec);if(-1===a)return!1;if(a===r.length-1)return!1;var s=r[a];return this.neededFragmentPositionMs=1e3*s.end,this.segmentInDownloadQueue=Kv.MatcherUtilities.findUnfinishedSegmentInDownloadQueue(o.queue,this.neededFragmentPositionMs),null==this.segmentInDownloadQueue&&(this.pendingMediaFragment=Kv.MatcherUtilities.findPendingMediaFragmentByPosition(i.pendingMediaFragments,this.neededFragmentPositionMs,50),null==this.pendingMediaFragment)}),e.prototype.getId=freeOnUnref(function(){return"MissingFragment"}),e.prototype.getDescription=freeOnUnref(function(){return l.prototype.getDescription.call(this)+" and the required fragment is neither in SegmentDownloadQueue nor pending on StreamAcquirer."}),e})(Xv.NeededFragmentMatcher);t.MissingFragmentMatcher=r}));e(Yv);Yv.MissingFragmentMatcher;var Jv=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return r(e,n),e.prototype.matches=freeOnUnref(function(e,t){return!!n.prototype.matches.call(this,e,t)&&(0===this.pendingMediaFragment.failureCount&&"Infinity"===this.pendingMediaFragment.priorityWhenQueued&&!0===this.pendingMediaFragment.isBlockedByBufferManager&&null==this.pendingMediaFragment.requestStartedTime)}),e.prototype.getId=freeOnUnref(function(){return"NeededFragmentBlockedByBufferManager"}),e.prototype.getDescription=freeOnUnref(function(){return n.prototype.getDescription.call(this)+" and is pending in StreamAcquirer, and the pendingMediaFragment has Infinite priority and is blocked by the BufferManager."}),e})(Xv.NeededFragmentMatcher);t.NeededFragmentBlockedByBufferManagerMatcher=n}));e(Jv);Jv.NeededFragmentBlockedByBufferManagerMatcher;var Zv=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return r(e,n),e.prototype.matches=freeOnUnref(function(e,t){return!!n.prototype.matches.call(this,e,t)&&null!=this.pendingMediaFragment.lastFailureReason}),e.prototype.getId=freeOnUnref(function(){return"NeededFragmentDownloadFailed"}),e.prototype.getDescription=freeOnUnref(function(){return n.prototype.getDescription.call(this)+" and is pending in StreamAcquirer, and the fragment download has failed at least once."}),e})(Xv.NeededFragmentMatcher);t.NeededFragmentDownloadFailedMatcher=n}));e(Zv);Zv.NeededFragmentDownloadFailedMatcher;var $v=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.matches=freeOnUnref(function(e,t){if(!i.prototype.matches.call(this,e,t))return!1;var n=e["NetworkRequestManager.NetworkStatisticsStore.holistic"],r=e["NetworkRequestManager.NetworkStatisticsStore.mediaFragment.Video"];return null!=n&&n.statistics.bandwidthAvgKbps<400||null!=r&&r.statistics.bandwidthAvgKbps<400}),e.prototype.getId=freeOnUnref(function(){return"NeededFragmentDownloadFailedLowBandwidth"}),e.prototype.getDescription=freeOnUnref(function(){return i.prototype.getDescription.call(this)+", and the network bandwidth is lower than 400 kbps."}),e})(Zv.NeededFragmentDownloadFailedMatcher);t.NeededFragmentDownloadFailedLowBandwidthMatcher=r}));e($v);$v.NeededFragmentDownloadFailedLowBandwidthMatcher;var eO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;return null!==Kv.MatcherUtilities.findInsufficientInMemoryBufferType(n)&&!0===n.seeking}),t.prototype.getId=freeOnUnref(function(){return"NeededFragmentDownloadSeeking"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches when the inMemoryBuffer is insufficient and not buffered to capacity and readyTracker.seeking is true"}),t})(Wv.BaseMatcher);t.NeededFragmentDownloadSeekingMatcher=r}));e(eO);eO.NeededFragmentDownloadSeekingMatcher;var tO=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return r(e,n),e.prototype.matches=freeOnUnref(function(e,t){return!!n.prototype.matches.call(this,e,t)&&(0===this.pendingMediaFragment.failureCount&&null!=this.pendingMediaFragment.priorityWhenQueued&&!1===this.pendingMediaFragment.isBlockedByBufferManager&&null!=this.pendingMediaFragment.requestStartedTime)}),e.prototype.getId=freeOnUnref(function(){return"NeededFragmentDownloadStarted"}),e.prototype.getDescription=freeOnUnref(function(){return n.prototype.getDescription.call(this)+" and is pending in StreamAcquirer, and the fragment download was started by the NetworkRequestManager but hasn't finished yet."}),e})(Xv.NeededFragmentMatcher);t.NeededFragmentDownloadStartedMatcher=n}));e(tO);tO.NeededFragmentDownloadStartedMatcher;var nO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.matches=freeOnUnref(function(e,t){if(!i.prototype.matches.call(this,e,t))return!1;var n=e["NetworkRequestManager.NetworkStatisticsStore.holistic"],r=e["NetworkRequestManager.NetworkStatisticsStore.mediaFragment.Video"];return null!=n&&n.statistics.bandwidthAvgKbps<400||null!=r&&r.statistics.bandwidthAvgKbps<400}),e.prototype.getId=freeOnUnref(function(){return"NeededFragmentDownloadStartedLowBandwidth"}),e.prototype.getDescription=freeOnUnref(function(){return i.prototype.getDescription.call(this)+", and the network bandwidth is lower than 400 kbps."}),e})(tO.NeededFragmentDownloadStartedMatcher);t.NeededFragmentDownloadStartedLowBandwidthMatcher=r}));e(nO);nO.NeededFragmentDownloadStartedLowBandwidthMatcher;var rO=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return r(e,n),e.prototype.matches=freeOnUnref(function(e,t){return!!n.prototype.matches.call(this,e,t)&&(0===this.pendingMediaFragment.failureCount&&null!=this.pendingMediaFragment.priorityWhenQueued&&!1===this.pendingMediaFragment.isBlockedByBufferManager&&null===this.pendingMediaFragment.requestStartedTime)}),e.prototype.getId=freeOnUnref(function(){return"NeededFragmentDownloadNotStarted"}),e.prototype.getDescription=freeOnUnref(function(){return n.prototype.getDescription.call(this)+" and is pending in StreamAcquirer, but the fragment download request was never started by the NetworkRequestManager."}),e})(Xv.NeededFragmentMatcher);t.NeededFragmentDownloadNotStartedMatcher=n}));e(rO);rO.NeededFragmentDownloadNotStartedMatcher;var iO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.matches=freeOnUnref(function(e,t){if(!i.prototype.matches.call(this,e,t))return!1;var n=e["NetworkRequestManager.NetworkStatisticsStore.holistic"],r=e["NetworkRequestManager.NetworkStatisticsStore.mediaFragment.Video"];return null!=n&&n.statistics.bandwidthAvgKbps<400||null!=r&&r.statistics.bandwidthAvgKbps<400}),e.prototype.getId=freeOnUnref(function(){return"NeededFragmentDownloadNotStartedLowBandwidth"}),e.prototype.getDescription=freeOnUnref(function(){return i.prototype.getDescription.call(this)+", and the network bandwidth is lower than 400 kbps."}),e})(rO.NeededFragmentDownloadNotStartedMatcher);t.NeededFragmentDownloadNotStartedLowBandwidthMatcher=r}));e(iO);iO.NeededFragmentDownloadNotStartedLowBandwidthMatcher;var oO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;if(null==n)return!1;if(null!==Kv.MatcherUtilities.findInsufficientInMemoryBufferType(n))return!1;var r=null!=n.sourceBufferReadyLengthSec?n.sourceBufferReadyLengthSec:.5;return n.sourceBufferSizeSec<r}),t.prototype.getId=freeOnUnref(function(){return"InsufficientSourceBuffer"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches when the inMemoryBuffer is sufficient and source buffer is insufficient"}),t})(Wv.BaseMatcher);t.InsufficientSourceBufferMatcher=r}));e(oO);oO.InsufficientSourceBufferMatcher;var aO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return n(e,s),e.prototype.matches=freeOnUnref(function(e,t){if(!s.prototype.matches.call(this,e,t))return!1;var n=e.ReadyTracker;if(null==n)return!1;var r=Kv.MatcherUtilities.findInsufficientSourceBufferType(n);if(null==r)return!1;var i=n.sourceBufferRangesSec[r];if(null==i)return!1;var o=n.mediaPlayerCurrentTimeSec,a=n.sourceBufferReadyLengthSec;return Kv.MatcherUtilities.hasGapWithinDistance(i,o,a,1)}),e.prototype.getId=freeOnUnref(function(){return"MicroGapInsufficientSourceBuffer"}),e.prototype.getDescription=freeOnUnref(function(){return"Matches when 1) inMemoryBuffer is sufficient 2) source buffer is insufficient 3) there exists a small source buffer gap within the ready threshold"}),e})(oO.InsufficientSourceBufferMatcher);t.MicroGapInsufficientSourceBufferMatcher=r}));e(aO);aO.MicroGapInsufficientSourceBufferMatcher;var sO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.matches=freeOnUnref(function(e,t){if(!i.prototype.matches.call(this,e,t))return!1;var n=e["FragmentLoader.Audio"],r=e["FragmentLoader.Video"];return!this.isLastFragmentAppendedShowing(n)||!this.isLastFragmentAppendedShowing(r)}),e.prototype.getId=freeOnUnref(function(){return"MissingAppendedFragment"}),e.prototype.isLastFragmentAppendedShowing=freeOnUnref(function(e){return 0===e.buffered.length||null==e.lastFragmentAppended||e.buffered[e.buffered.length-1].end>e.lastFragmentAppended.startMs}),e.prototype.getDescription=freeOnUnref(function(){return"Matches when a fragment was appended but doesn't show in the SourceBuffer"}),e})(oO.InsufficientSourceBufferMatcher);t.MissingAppendedFragmentMatcher=r}));e(sO);sO.MissingAppendedFragmentMatcher;var lO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return n(e,a),e.prototype.matches=freeOnUnref(function(e,t){if(!a.prototype.matches.call(this,e,t))return!1;var n=e.ReadyTracker;if(null==n)return!1;var r=this.getBufferedBounds(n.sourceBufferRangesSec.Video),i=this.getBufferedBounds(n.sourceBufferRangesSec.Audio);if(null==r||null==i)return!1;var o=n.mediaPlayerCurrentTimeSec;return!this.isWithinBounds(o,r)||!this.isWithinBounds(o,i)}),e.prototype.getId=freeOnUnref(function(){return"PositionOutsideSourceBufferBounds"}),e.prototype.getDescription=freeOnUnref(function(){return"Matches when 1) inMemoryBuffer is sufficient 2) source buffer is insufficient 3) source buffer size is empty 4) MediaPlayer position is outside SourceBuffer bounds"}),e.prototype.getBufferedBounds=freeOnUnref(function(e){return null==e||0===e.length?null:{start:e[0].start,end:e[e.length-1].end}}),e.prototype.isWithinBounds=freeOnUnref(function(e,t){return t.start<=e&&e<=t.end}),e})(oO.InsufficientSourceBufferMatcher);t.PositionOutsideSourceBufferBoundsMatcher=r}));e(lO);lO.PositionOutsideSourceBufferBoundsMatcher;var fO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.matches=freeOnUnref(function(e,t){var n=e["FragmentLoader.Audio"],r=e["FragmentLoader.Video"];return i.prototype.matches.call(this,e,t)&&(n.sourceBufferUpdating||r.sourceBufferUpdating)}),e.prototype.getId=freeOnUnref(function(){return"WaitingSourceBuffer"}),e.prototype.getDescription=freeOnUnref(function(){return i.prototype.getDescription.call(this)+" and source buffer stuck in updating"}),e})(oO.InsufficientSourceBufferMatcher);t.WaitingSourceBufferMatcher=r}));e(fO);fO.WaitingSourceBufferMatcher;var uO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;if(null==n)return!1;var r=null!=n.sourceBufferReadyLengthSec?n.sourceBufferReadyLengthSec:.5;return n.inMemoryBufferSizeSec>=n.inMemoryReadyBufferSizeThresholdSec&&n.sourceBufferSizeSec>=r}),t.prototype.getId=freeOnUnref(function(){return"SufficientBuffer"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches when both inMemoryBuffer and sourceBuffer are sufficiently buffered"}),t})(Wv.BaseMatcher);t.SufficientBufferMatcher=r}));e(uO);uO.SufficientBufferMatcher;var cO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker,r=e["MediaPlayer.ContentStateMachine"];return i.prototype.matches.call(this,e,t)&&2===n.readyState&&null!=r&&"Detaching"===r.contentState}),e.prototype.getId=freeOnUnref(function(){return"ContentStateDetaching"}),e.prototype.getDescription=freeOnUnref(function(){return i.prototype.getDescription.call(this)+" and readyState is 2, but ContentStateMachine.contentState is 'Detaching'"}),e})(uO.SufficientBufferMatcher);t.ContentStateDetachingMatcher=r}));e(cO);cO.ContentStateDetachingMatcher;var dO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker,r=e["MediaPlayer.ContentStateMachine"];return i.prototype.matches.call(this,e,t)&&2===n.readyState&&null!=r&&"Error"===r.contentState}),e.prototype.getId=freeOnUnref(function(){return"ContentStateError"}),e.prototype.getDescription=freeOnUnref(function(){return i.prototype.getDescription.call(this)+" and readyState is 2, but ContentStateMachine.contentState is 'Error'"}),e})(uO.SufficientBufferMatcher);t.ContentStateErrorMatcher=r}));e(dO);dO.ContentStateErrorMatcher;var pO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(l){function e(){return null!==l&&l.apply(this,arguments)||this}return n(e,l),e.prototype.matches=freeOnUnref(function(e,t){if(!l.prototype.matches.call(this,e,t))return!1;var n=e.ReadyTracker;if(null!=n.bufferReason||!0===n.seeking)return!1;var r=e["MediaPlayer.ContentStateMachine"],i=e.SeekController;if(null==i)return!1;var o=i.lastOperationTimestamp;if(null==t)return!1;var a=t-o,s=r.lastContentStateChangeTimestamp-o;return!0===i.seeking&&3e4<=a&&a<30050&&0<=s&&s<50}),e.prototype.getId=freeOnUnref(function(){return"SeekFailure"}),e.prototype.getDescription=freeOnUnref(function(){return l.prototype.getDescription.call(this)+", ReadyTracker.bufferReason is null and ReadyTracker.seeking is false whereas SeekController.seeking is true, infinite spinner occurred after 30000 - 300050ms upon SeekController.lastOperationTimestamp and ContentStateMachine.lastContentStateChangeTimestamp happened within 50ms after SeekController.lastOperationTimestamp"}),e})(dO.ContentStateErrorMatcher);t.SeekFailureMatcher=r}));e(pO);pO.SeekFailureMatcher;var hO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(o){function e(){return null!==o&&o.apply(this,arguments)||this}return n(e,o),e.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker,r=e.SeekMachine,i=e["MediaPlayer.ContentStateMachine"];return o.prototype.matches.call(this,e,t)&&2===n.readyState&&null!=r&&"Pausing"===r.seekState&&null!=i&&!("Error"===i.contentState||"Detaching"===i.contentState)}),e.prototype.getId=freeOnUnref(function(){return"SeekMachinePausing"}),e.prototype.getDescription=freeOnUnref(function(){return o.prototype.getDescription.call(this)+" and readyState is 2, SeekMachine.seekState is 'Pausing' and contentStateMachine.contentState is not 'Error' or 'Detaching'."}),e})(uO.SufficientBufferMatcher);t.SeekMachinePausingMatcher=r}));e(hO);hO.SeekMachinePausingMatcher;var mO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(){return null!==r&&r.apply(this,arguments)||this}return n(e,r),e.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;e["MediaPlayer.ContentStateMachine"];return r.prototype.matches.call(this,e,t)&&1===n.readyState&&!1===e.SeekController.seeking}),e.prototype.getId=freeOnUnref(function(){return"WaitingForPlatform"}),e.prototype.getDescription=freeOnUnref(function(){return r.prototype.getDescription.call(this)+", SeekController and SeekMachine are not seeking, and both ContentStateMachine and ReadyTracker have readyState 1."}),e})(uO.SufficientBufferMatcher);t.WaitingForPlatformMatcher=r}));e(mO);mO.WaitingForPlatformMatcher;var yO=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this)||this;return t.streamType=e,t.productionStoppedRegex=new RegExp("^Did not get a "+t.streamType+" segment back for a query at"),t}return r(e,n),e.prototype.matches=freeOnUnref(function(e,t){var n=e["SegmentDownloadQueue."+this.streamType];return null!=n&&null!=n.productionStoppedReason&&this.productionStoppedRegex.test(n.productionStoppedReason)}),e.prototype.getId=freeOnUnref(function(){return"FailedSegmentProduction."+this.streamType}),e.prototype.getDescription=freeOnUnref(function(){return"["+this.streamType+"] Failed to produce segment to play content"}),e})(Wv.BaseMatcher);t.FailedSegmentProductionMatcher=n}));e(yO);yO.FailedSegmentProductionMatcher;var gO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){return null==e["FragmentLoader.Audio"]||null==e["FragmentLoader.Video"]}),t.prototype.getId=freeOnUnref(function(){return"NoFragmentLoaders"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches if snapshot have not got any FragmentLoader state"}),t})(Wv.BaseMatcher);t.NoFragmentLoadersMatcher=r}));e(gO);gO.NoFragmentLoadersMatcher;var vO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){return null==e.ReadyTracker}),t.prototype.getId=freeOnUnref(function(){return"NoReadyTracker"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches if snapshot have not got a ReadyTracker state"}),t})(Wv.BaseMatcher);t.NoReadyTrackerMatcher=r}));e(vO);vO.NoReadyTrackerMatcher;var OO=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this)||this;return t.streamType=e,t}return r(e,n),e.prototype.matches=freeOnUnref(function(e,t){return null==e["StreamAcquirer."+this.streamType]}),e.prototype.getId=freeOnUnref(function(){return"No"+this.streamType+"StreamAcquirer"}),e.prototype.getDescription=freeOnUnref(function(){return"Matches if snapshot have not got a StreamAcquirer."+this.streamType}),e})(Wv.BaseMatcher);t.NoStreamAcquirerMatcher=n}));e(OO);OO.NoStreamAcquirerMatcher;var SO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){if(null==e.FragmentContentSource||!e.FragmentContentSource.started)return!1;if(null!=e["SegmentDownloadQueue.Audio"]||null==e["SegmentDownloadQueue.Video"])return!1;for(var n=0,r=Kv.MatcherUtilities.getPendingNetworkRequests(e);n<r.length;n++){var i=r[n];if(i.description.endsWith(".sidx")&&-1!==i.description.indexOf("audio"))return!0}return!1}),t.prototype.getId=freeOnUnref(function(){return"PendingAudioIndex"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches when we have a started ContentSource, a Video SegmentDownloadQueue, no Audio SegmentDownloadQueue, and an audio sidx is pending download"}),t})(Wv.BaseMatcher);t.PendingAudioIndexMatcher=r}));e(SO);SO.PendingAudioIndexMatcher;var UO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){if(null!=e.FragmentContentSource&&e.FragmentContentSource.started)return!1;for(var n=0,r=Kv.MatcherUtilities.getPendingNetworkRequests(e);n<r.length;n++){if("manifest.dash"===r[n].description)return!0}return!1}),t.prototype.getId=freeOnUnref(function(){return"PendingManifest"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches if the ContentSources (if it exists) is stopped and a manifest is pending download"}),t})(Wv.BaseMatcher);t.PendingManifestMatcher=r}));e(UO);UO.PendingManifestMatcher;var bO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){var n=e.MediaKeysManager;if(null==n||null==n.mediaKeys||null==n.mediaKeys.Playback&&null==n.mediaKeys.Download||null==n.sessions)return!1;for(var r=0,i=Object.keys(n.sessions);r<i.length;r++){var o=i[r],a=n.sessions[o];if(null!=a&&"pending"===a.status)return!0}return!1}),t.prototype.getId=freeOnUnref(function(){return"PendingMediaKeySessionMatcher"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches if there exists any single MediaKeySession with a pending status"}),t})(Wv.BaseMatcher);t.PendingMediaKeySessionMatcher=r}));e(bO);bO.PendingMediaKeySessionMatcher;var PO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){return null!=e.MediaKeysManager&&null!=e.MediaKeysManager.mediaKeys&&(null!=e.MediaKeysManager.mediaKeys.Playback&&"pending"===e.MediaKeysManager.mediaKeys.Playback.status||null!=e.MediaKeysManager.mediaKeys.Download&&"pending"===e.MediaKeysManager.mediaKeys.Download.status)}),t.prototype.getId=freeOnUnref(function(){return"PendingMediaKeysMatcher"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches if the MediaKeys creation are pending"}),t})(Wv.BaseMatcher);t.PendingMediaKeysMatcher=r}));e(PO);PO.PendingMediaKeysMatcher;var MO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){if(null==e.FragmentContentSource||!e.FragmentContentSource.started)return!1;if(null!=e["SegmentDownloadQueue.Video"])return!1;for(var n=0,r=Kv.MatcherUtilities.getPendingNetworkRequests(e);n<r.length;n++){var i=r[n];if(i.description.endsWith(".sidx")&&-1!==i.description.indexOf("video"))return!0}return!1}),t.prototype.getId=freeOnUnref(function(){return"PendingTailoring"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches when we have a started ContentSource, no Video SegmentDownloadQueue, and a video sidx is pending download. ContentSource is stuck tailoring the first period."}),t})(Wv.BaseMatcher);t.PendingTailoringMatcher=r}));e(MO);MO.PendingTailoringMatcher;var CO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;if(null==n||1<n.readyState||null==n.sourceBufferRangesSec||null==n.sourceBufferRangesSec.Audio||null==n.sourceBufferRangesSec.Video)return!1;if(n.sourceBufferRangesSec.Video.length<=1)return!1;var r=n.sourceBufferRangesSec.Video,i=n.mediaPlayerCurrentTimeSec,o=(n.sourceBufferReadyLengthSec,Kv.MatcherUtilities.findBufferedRangeIndex(r,i));return-1!==o&&r[o].start>=i-3}),t.prototype.getId=freeOnUnref(function(){return"PlayheadAfterMicroGapInsufficientReadyState"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches when 1) inMemoryBuffer is sufficient 2) source buffer is insufficient 3) there exists a small source buffer gap within the ready threshold 4) Playhead is a certain threshold *after* the gap"}),t})(Wv.BaseMatcher);t.PlayHeadAfterMicroGapInsufficientReadyStateMatcher=r}));e(CO);CO.PlayHeadAfterMicroGapInsufficientReadyStateMatcher;var EO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){var n=e["NetworkRequestManager.RequestScheduler"],r=e["NetworkRequestManager.QueuedRequestPool"];if(null==n||null==r)return!1;if(0===r.requests.length)return!1;for(var i=0,o=n.activeChannels;i<o.length;i++){var a=o[i];if(0===a.inflightCount&&1<=a.linearizationPotential)return!0}return!1}),t.prototype.getId=freeOnUnref(function(){return"RequestSchedulerBlocked"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches if snapshot has a RequestScheduler blocked for making new requests"}),t})(Wv.BaseMatcher);t.RequestSchedulerBlockedMatcher=r}));e(EO);EO.RequestSchedulerBlockedMatcher;var TO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){return null!=e.SeekMachine&&("WaitingSample"===e.SeekMachine.seekState&&null==e.SeekMachine.computedSeekPositionMs)}),t.prototype.getId=freeOnUnref(function(){return"SeekWaitingForSample"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches if SeekMachine is waiting for a sample so it knows where video base PTS starts"}),t})(Wv.BaseMatcher);t.SeekWaitingForSampleMatcher=r}));e(TO);TO.SeekWaitingForSampleMatcher;var wO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;if(null==n)return!1;var r=Kv.MatcherUtilities.findInsufficientInMemoryBufferType(n);return null!==r&&(void 0===r?this.isSegmentDownloadQueueStarving("Audio",e)||this.isSegmentDownloadQueueStarving("Video",e):this.isSegmentDownloadQueueStarving(r,e))}),t.prototype.getId=freeOnUnref(function(){return"SegmentDownloadQueueStarvation"}),t.prototype.isSegmentDownloadQueueStarving=freeOnUnref(function(e,t){var n=t["SegmentDownloadQueue."+e];if(null==n)return!1;var r=t["StreamAcquirer."+e];if(null==r)return!1;var i=t["FragmentLoader."+e];return null!=i&&(null!=t["BlockingSegmentInfoProducer."+e]&&0===r.pendingMediaFragments.length&&"No next segment available yet"===i.lastFragmentAttemptedBlockedReason&&n.queue.every(freeOnUnref(function(e){return!0===e.done})))}),t.prototype.getDescription=freeOnUnref(function(){return"Matches if insufficient in-memory buffer type's stream acquirer has not got any pending fragments whereas in memory buffer size is insufficient, segment download queue has starvation and just have already done segments, the respective fragment loader has stopped production because next segment is not available and the stream's blocking segment info producer has been blocked"}),t})(Wv.BaseMatcher);t.SegmentDownloadQueueStarvationMatcher=r}));e(wO);wO.SegmentDownloadQueueStarvationMatcher;var IO=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this)||this;return t.streamType=e,t}return r(e,n),e.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;if(null==n||null==n.inMemoryBufferedSec)return!1;var r=n.playheadTimeSec,i=n.inMemoryBufferedSec;return Kv.MatcherUtilities.isPositionBetweenGaps(r,i[this.streamType],1)}),e.prototype.getId=freeOnUnref(function(){return"StuckAtInMemoryBufferGap."+this.streamType}),e.prototype.getDescription=freeOnUnref(function(){return"Stuck at a gap in the "+this.streamType+" in-memory buffer"}),e})(Wv.BaseMatcher);t.StuckAtInMemoryBufferGapMatcher=n}));e(IO);IO.StuckAtInMemoryBufferGapMatcher;var kO=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this)||this;return t.checkSufficient=e,t}return r(e,n),e.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;if(null==n||n.inMemoryBufferSizeSec>=n.inMemoryReadyBufferSizeThresholdSec||n.isInMemoryBufferedToCapacity)return!1;var r=e.PlayerBufferManager;return null!=r&&(this.playerBufferManagerStuck("Audio",r,e)||this.playerBufferManagerStuck("Video",r,e))}),e.prototype.getId=freeOnUnref(function(){return this.checkSufficient?"StuckPlayerBufferManagerSufficient":"StuckPlayerBufferManagerInsufficient"}),e.prototype.getDescription=freeOnUnref(function(){return"Matches if the in-memory buffer is insufficient and all of a particular stream's pending media fragments are blocked by the player buffer manager, whereas player buffer manager's top pending reservation's requested size bytes is "+(this.checkSufficient?"less than or equal to":"greater than")+" the available bytes."}),e.prototype.playerBufferManagerStuck=freeOnUnref(function(e,t,n){var r=t.pendingReservations;if(0===r.length)return!1;var i="Audio"===e?n["StreamAcquirer.Audio"]:n["StreamAcquirer.Video"];if(null==i)return!1;var o=i.pendingMediaFragments.filter(freeOnUnref(function(e){return!0===e.isBlockedByBufferManager})).length,a=r.reduce(freeOnUnref(function(e,t){return t.cachedPriority<e.cachedPriority?t:e}));return 0!==o&&o===i.pendingMediaFragments.length&&(this.checkSufficient?a.requestedSizeBytes<=t.availableBytes:a.requestedSizeBytes>t.availableBytes)}),e})(Wv.BaseMatcher);t.StuckPlayerBufferManagerMatcher=n}));e(kO);kO.StuckPlayerBufferManagerMatcher;var _O=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;return null!=n&&1===n.readyState&&1<n.sourceBufferSizeSec&&!0===n.isMediaPlayerWaitingForKey}),t.prototype.getId=freeOnUnref(function(){return"StuckWaitingForKey"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches snapshot if playback gets stuck and waiting for an encryption key"}),t})(Wv.BaseMatcher);t.StuckWaitingForKeyMatcher=r}));e(_O);_O.StuckWaitingForKeyMatcher;var RO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;return null!=n&&1<n.sourceBufferSizeSec&&!0===n.seeking}),t.prototype.getId=freeOnUnref(function(){return"StuckWaitingForSeek"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches snapshot if playback has content, but is stuck waiting for a seek to complete."}),t})(Wv.BaseMatcher);t.StuckWaitingForSeekMatcher=r}));e(RO);RO.StuckWaitingForSeekMatcher;var AO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){return!0}),t.prototype.getId=freeOnUnref(function(){return"Unclassified"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches unclassified snapshots"}),t})(Wv.BaseMatcher);t.UnclassifiedMatcher=r}));e(AO);AO.UnclassifiedMatcher;var DO=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.matches=freeOnUnref(function(e,t){var n=e.ReadyTracker;if(null==n)return!1;var r=null!=n.sourceBufferReadyLengthSec?n.sourceBufferReadyLengthSec:.5,i=e["MediaPlayer.ContentStateMachine"];return n.sourceBufferSizeSec>=r&&1===n.readyState&&null!=i&&"Waiting"===i.contentState&&"waitingforkey"===i.lastEmittedEvent}),t.prototype.getId=freeOnUnref(function(){return"WaitForKey"}),t.prototype.getDescription=freeOnUnref(function(){return"Matches snapshot if SourceBuffer is sufficiently buffered, ContentState is Waiting, the last emitted event from the content state machine is waitingforkey and the ReadyTracker's readyState is set to 1"}),t})(Wv.BaseMatcher);t.WaitForKeyMatcher=r}));e(DO);DO.WaitForKeyMatcher;var xO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=[new PO.PendingMediaKeysMatcher,new UO.PendingManifestMatcher,new MO.PendingTailoringMatcher,new SO.PendingAudioIndexMatcher,new OO.NoStreamAcquirerMatcher("Audio"),new OO.NoStreamAcquirerMatcher("Video"),new EO.RequestSchedulerBlockedMatcher,new vO.NoReadyTrackerMatcher,new kO.StuckPlayerBufferManagerMatcher(!0),new kO.StuckPlayerBufferManagerMatcher(!1),new cO.ContentStateDetachingMatcher,new dO.ContentStateErrorMatcher,new yO.FailedSegmentProductionMatcher("Audio"),new yO.FailedSegmentProductionMatcher("Video"),new Jv.NeededFragmentBlockedByBufferManagerMatcher,new $v.NeededFragmentDownloadFailedLowBandwidthMatcher,new Zv.NeededFragmentDownloadFailedMatcher,new iO.NeededFragmentDownloadNotStartedLowBandwidthMatcher,new rO.NeededFragmentDownloadNotStartedMatcher,new nO.NeededFragmentDownloadStartedLowBandwidthMatcher,new tO.NeededFragmentDownloadStartedMatcher,new eO.NeededFragmentDownloadSeekingMatcher,new wO.SegmentDownloadQueueStarvationMatcher,new gO.NoFragmentLoadersMatcher,new fO.WaitingSourceBufferMatcher,new sO.MissingAppendedFragmentMatcher,new IO.StuckAtInMemoryBufferGapMatcher("Audio"),new IO.StuckAtInMemoryBufferGapMatcher("Video"),new Qv.MicroGapInsufficientInMemoryBufferMatcher,new Yv.MissingFragmentMatcher,new pO.SeekFailureMatcher,new _O.StuckWaitingForKeyMatcher,new bO.PendingMediaKeySessionMatcher,new RO.StuckWaitingForSeekMatcher,new mO.WaitingForPlatformMatcher,new hO.SeekMachinePausingMatcher,new DO.WaitForKeyMatcher,new Gv.InsufficientInMemoryBufferMatcher,new lO.PositionOutsideSourceBufferBoundsMatcher,new aO.MicroGapInsufficientSourceBufferMatcher,new CO.PlayHeadAfterMicroGapInsufficientReadyStateMatcher,new oO.InsufficientSourceBufferMatcher,new TO.SeekWaitingForSampleMatcher,new AO.UnclassifiedMatcher];t.DEFAULT_MATCHERS=o,t.analyze=function(e,t){for(var n=0,r=o;n<r.length;n++){var i=r[n];if(i.matches(e,t))return i.getId()}throw new Error("None of the matchers matches the snapshot state.")}}));e(xO);xO.DEFAULT_MATCHERS,xO.analyze;var FO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MATCHERS=xO.DEFAULT_MATCHERS,t.analyze=xO.analyze,t.UnclassifiedMatcher=AO.UnclassifiedMatcher}));e(FO);FO.DEFAULT_MATCHERS,FO.analyze,FO.UnclassifiedMatcher;var BO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.compositeState={}}return e.prototype.onEvent=freeOnUnref(function(e,t,n){"state"===t&&(this.compositeState[e]=n)}),Object.defineProperty(e.prototype,"state",{get:freeOnUnref(function(){return this.compositeState.timestamp=Date.now(),this.compositeState}),enumerable:!0,configurable:!0}),e})();t.StateSnapshotDiagnosticsSink=n}));e(BO);BO.StateSnapshotDiagnosticsSink;var LO=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("ExcessiveWaitingTracker");function i(e,t){return t instanceof Error?n({name:t.name,message:t.message,stack:t.stack},t):"number"!=typeof t||isFinite(t)&&!isNaN(t)?t:t.toString()}t.stateJsonReplacer=i;var o=freeOnUnref(function(){function e(e,t){this.excessiveWaitingTimeoutId=null,this.playbackWaitingTimeoutId=null,this.isExcessiveWaiting=!1,this.isContentUnloaded=!0,this.currentVideoMaterialType=null,this.currentExcessiveWaitingReason=void 0,this.restartOnSeekDisabled=!1,this.mediaEventController=e,this.playbackWaitingTimeoutCallback=t,this.stateSnapshotDiagnosticsSink=new BO.StateSnapshotDiagnosticsSink,nn.Diagnostics.addSink(this.stateSnapshotDiagnosticsSink);var n=L.configurationStore.configuration;null!=n&&null!=n.weblabs&&this.stateSnapshotDiagnosticsSink.onEvent("weblabs","state",n.weblabs),null!=n&&null!=n.excessiveWaitingTracker&&(this.restartOnSeekDisabled=!0===n.excessiveWaitingTracker.disableRestartOnSeek)}return e.prototype.destroy=freeOnUnref(function(){this.contentUnloaded(),nn.Diagnostics.removeSink(this.stateSnapshotDiagnosticsSink)}),e.prototype.waitingStarted=freeOnUnref(function(){var n=this;null==this.excessiveWaitingTimeoutId&&(this.excessiveWaitingTimeoutId=oe.timer.setTimeout(freeOnUnref(function(){var e=n.stateSnapshotDiagnosticsSink.state;r.error("EXCESSIVE_WAITING",JSON.stringify(e,i,2));try{n.currentExcessiveWaitingReason=FO.analyze(e,e.timestamp),r.info("Excessive Waiting Reason: "+n.currentExcessiveWaitingReason)}catch(e){r.warn("Error calculating Excessive Waiting Reason: "+e),n.currentExcessiveWaitingReason=void 0,n.mediaEventController.reportError(!1,new ct.XpError("snapshot_analyzer_error"),"Player","Error")}n.reportExcessiveWaiting(),q.metrics.putMetric("ExcessiveWait"),null!=n.currentVideoMaterialType&&q.metrics.putMetric("ExcessiveWait."+n.currentVideoMaterialType),n.isExcessiveWaiting=!0}),3e4)),null==this.playbackWaitingTimeoutId&&(this.playbackWaitingTimeoutId=oe.timer.setTimeout(freeOnUnref(function(){q.metrics.putMetric("PlaybackWaitingTimeout");var e=n.getExcessiveWaitingErrorMessage(n.currentExcessiveWaitingReason),t=new ct.XpError(Ni.codes.xp.content.playback_waiting_timeout,void 0,e);n.mediaEventController.reportError(!1,t,"Player","Error"),n.playbackWaitingTimeoutCallback(t)}),45e3))}),e.prototype.waitingCompleted=freeOnUnref(function(){null!=this.excessiveWaitingTimeoutId&&(oe.timer.clearTimeout(this.excessiveWaitingTimeoutId),this.excessiveWaitingTimeoutId=null,this.isExcessiveWaiting=!1,this.currentExcessiveWaitingReason=void 0),null!=this.playbackWaitingTimeoutId&&(oe.timer.clearTimeout(this.playbackWaitingTimeoutId),this.playbackWaitingTimeoutId=null)}),e.prototype.contentUnloaded=freeOnUnref(function(){if(!this.isContentUnloaded){var e=this.isExcessiveWaiting?1:0;q.metrics.putMetric("SessionAbandoned",e),null!=this.currentVideoMaterialType&&q.metrics.putMetric("SessionAbandoned."+this.currentVideoMaterialType,e)}this.isExcessiveWaiting&&(r.error("session_abandoned for "+this.currentVideoMaterialType+": Content unloaded after an excessive waiting!"),this.reportSessionAbandoned(),this.isExcessiveWaiting=!1),this.currentVideoMaterialType=null,this.isContentUnloaded=!0,null!=this.excessiveWaitingTimeoutId&&(oe.timer.clearTimeout(this.excessiveWaitingTimeoutId),this.excessiveWaitingTimeoutId=null),null!=this.playbackWaitingTimeoutId&&(oe.timer.clearTimeout(this.playbackWaitingTimeoutId),this.playbackWaitingTimeoutId=null)}),e.prototype.onContentLoading=freeOnUnref(function(e){this.currentVideoMaterialType=e,this.isContentUnloaded=!1}),e.prototype.restartWaiting=freeOnUnref(function(){this.restartOnSeekDisabled||null==this.excessiveWaitingTimeoutId||(this.waitingCompleted(),this.waitingStarted())}),e.prototype.getExcessiveWaitingErrorMessage=freeOnUnref(function(e){return null==e?"Unknown":e}),e.prototype.reportExcessiveWaiting=freeOnUnref(function(){var e=this.getExcessiveWaitingErrorMessage(this.currentExcessiveWaitingReason),t=new ct.XpError("excessive_waiting",void 0,e);this.mediaEventController.reportError(!1,t,"Player","Error")}),e.prototype.reportSessionAbandoned=freeOnUnref(function(){var e=this.getExcessiveWaitingErrorMessage(this.currentExcessiveWaitingReason),t=new ct.XpError("session_abandoned",void 0,e);null!=this.currentVideoMaterialType?r.warn("session_abandoned for "+this.currentVideoMaterialType+": "+e):r.warn("session_abandoned: "+e),this.mediaEventController.reportError(!1,t,"Player","Error")}),e})();t.ExcessiveWaitingTracker=o}));e(LO);LO.stateJsonReplacer,LO.ExcessiveWaitingTracker;var NO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("StallMediaEventController"),n=freeOnUnref(function(){function e(e,t,n){var r=this;this.manifestAcquisitionError=null,this.onStall=freeOnUnref(function(e){var t=e.reason;if(null!=r.manifestAcquisitionError&&"ParseError"===r.manifestAcquisitionError.reason.type&&r.manifestAcquisitionError.reason.cause instanceof ct.XpError){var n=r.manifestAcquisitionError.reason.cause.code;"manifest.stale"===n?t="Manifest.Stale":"manifest.negative"===n&&(t="Manifest.Negative")}r.reportStallEvent(e.expected,t)}),this.mediaEventReporter=e,this.mpPlayer=t,this.sessionIdTracker=n,this.stateSnapshotDiagnosticsSink=new BO.StateSnapshotDiagnosticsSink}return e.prototype.initialize=freeOnUnref(function(){this.mpPlayer.on("stall",this.onStall),nn.Diagnostics.addSink(this.stateSnapshotDiagnosticsSink)}),e.prototype.uninitialize=freeOnUnref(function(){this.mpPlayer.off("stall",this.onStall),this.manifestAcquisitionError=null,nn.Diagnostics.removeSink(this.stateSnapshotDiagnosticsSink)}),e.prototype.reportManifestAcquisitionSuccess=freeOnUnref(function(){this.manifestAcquisitionError=null}),e.prototype.reportManifestAcquisitionFailure=freeOnUnref(function(e){this.manifestAcquisitionError=e.error}),e.prototype.reportStallEvent=freeOnUnref(function(e,t){var n=this.mpPlayer.currentTimeMs;if(null!=n){Math.random()<.05&&i.info("State snapshot at rebuffer",JSON.stringify(this.stateSnapshotDiagnosticsSink.state,LO.stateJsonReplacer,2)),i.warn("BufferReason:",t),q.metrics.putMetric("BufferReason."+t);var r=Tv.StallEventFactory.createStallEvent(e,t,n,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId());this.mediaEventReporter.enqueueMediaEvents([r])}}),e})();t.StallMediaEventController=n}));e(NO);NO.StallMediaEventController;var VO=t(freeOnUnref(function(e,t){var n,r,i,o;Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("StreamMediaEventController"),p=((n={}).AV1="AV1",n.AVC="H264",n.HEVC="H265",n.DVHE=null,n),h=((r={}).AVC="SDR8",r.DVHE="DolbyVision",r.HEVC=null,r.AV1=null,r),s=((i={}).Caption="Caption",i.Mandatory="ForcedNarrative",i.Subtitle="Subtitle",i.MachineGenerated="Subtitle",i.Audio="Subtitle",i.SDH=null,i),l=((o={}).Commentary="Commentary",o.Descriptive="Descriptive",o.Dialog="Dialog",o.FilteredContent="Dialog",o),f=freeOnUnref(function(){function e(e,t,n,r){var d=this;this.consumptionId=null,this.audioStreamInfo=null,this.videoStreamInfo=null,this.timedTextStreamInfo=null,this.onAudioQualityChange=freeOnUnref(function(e){if(null!=e){var t=d.getActiveStream(e,"Audio"),n=d.getActiveQualityLevel(e,"Audio");if(null!=t&&null!=n){var r=null!=n.audioCodec?n.audioCodec:null,i=null!=n.audioFormat?n.audioFormat:null;if(null==d.audioStreamInfo||d.audioStreamInfo.language!==t.language||d.audioStreamInfo.audioTrackId!==t.audioTrackId||d.audioStreamInfo.codec!==r||d.audioStreamInfo.format!==i){d.audioStreamInfo={language:t.language,audioTrackId:t.audioTrackId,codec:r,format:i};var o=d.createAudioTrackEvent(d.audioStreamInfo);d.mediaEventReporter.enqueueMediaEvents([o])}}}}),this.onVideoQualityChange=freeOnUnref(function(e){if(null!=e){var t=d.getActiveStream(e,"Video"),n=d.getActiveQualityLevel(e,"Video");if(null!=t&&null!=n){var r=n.height,i=n.width,o=n.bandwidth,a=null;null!=n.frameRate&&(a=In.round(In.stringToNumber(n.frameRate),2),isNaN(a)&&(a=null));var s=null;null!=a&&(s=30<a?"High":"Standard");var l=null,f=void 0,u=null;if(null!=n.codecs&&null!=(f=ci.CodecParser.parseVideoCodec(n.codecs))&&(u=p[f.codec],l=h[f.codec]),null==d.videoStreamInfo||null==d.videoStreamInfo.videoTrackResolution||d.videoStreamInfo.videoTrackResolution.height!==r||d.videoStreamInfo.videoTrackResolution.width!==i||d.videoStreamInfo.bitrate!==o||d.videoStreamInfo.frameRate!==a||d.videoStreamInfo.frameRateCategory!==s){d.videoStreamInfo={videoTrackId:null,videoTrackResolution:null!=r&&null!=i?{height:r,width:i}:null,bitrate:o,frameRate:a,frameRateCategory:s,colorSpace:l,codec:u};var c=d.createVideoTrackEvent(d.videoStreamInfo);d.mediaEventReporter.enqueueMediaEvents([c])}}}}),this.onStreamGroupChange=freeOnUnref(function(e,t){if("TimedText"===e){for(var n={},r=0,i=t;r<i.length;r++){var o=i[r];n[o.id]=o}d.timedTextStreamInfo={activeStreamId:null,streams:n}}}),this.onActiveStreamChange=freeOnUnref(function(e,t){if("TimedText"===e){var n=d.timedTextStreamInfo;if(null!=n&&0!==Object.keys(n.streams).length){var r=n.streams;t!==n.activeStreamId?null==t?d.reportTimedTextEvent(!1,r[n.activeStreamId]):d.reportTimedTextEvent(!0,r[t]):a.warn("Ignoring report for subtitle change to the same id: "+t+"."),n.activeStreamId=t}else a.warn("TimedText ActiveStreamChange without StreamGroup information")}}),this.onMpPlayerStateChange=freeOnUnref(function(e){"unloaded"===e.contentState&&(d.audioStreamInfo=null)}),this.mediaEventReporter=e,this.streamFeature=t,this.mpPlayer=n,this.sessionIdTracker=r,this.mediaRepresentation=null}return e.prototype.initialize=freeOnUnref(function(){this.streamFeature.on("StreamGroupChange",this.onStreamGroupChange),this.streamFeature.on("ActiveStreamChange",this.onActiveStreamChange),this.mpPlayer.on("contentStateChange",this.onMpPlayerStateChange);var e=this.mpPlayer.getPlaybackQualityProvider();null!=e?(e.on("Audio","qualityLevel",this.onAudioQualityChange),e.on("Video","qualityLevel",this.onVideoQualityChange)):a.warn("No QualityProvider. Audio Track events won't be reported")}),e.prototype.uninitialize=freeOnUnref(function(){this.streamFeature.off("StreamGroupChange",this.onStreamGroupChange),this.streamFeature.off("ActiveStreamChange",this.onActiveStreamChange),this.mpPlayer.off("contentStateChange",this.onMpPlayerStateChange),this.mediaRepresentation=null,this.consumptionId=null;var e=this.mpPlayer.getPlaybackQualityProvider();null!=e&&(e.off("Audio","qualityLevel",this.onAudioQualityChange),e.off("Video","qualityLevel",this.onVideoQualityChange))}),e.prototype.unload=freeOnUnref(function(){this.audioStreamInfo=null,this.videoStreamInfo=null,this.timedTextStreamInfo=null}),e.prototype.updateConsumptionId=freeOnUnref(function(e){this.consumptionId=e}),e.prototype.updateMediaRepresentation=freeOnUnref(function(e){this.mediaRepresentation=e}),e.prototype.getAudioTrackEvent=freeOnUnref(function(){return null==this.audioStreamInfo?null:this.createAudioTrackEvent(this.audioStreamInfo)}),e.prototype.getVideoTrackEvent=freeOnUnref(function(){return null==this.videoStreamInfo?null:this.createVideoTrackEvent(this.videoStreamInfo)}),e.prototype.getMediaRepresentationStreamFor=freeOnUnref(function(e){return null==this.mediaRepresentation?null:gf.MediaRepresentationQuerier.for(this.mediaRepresentation).itemById(e.periodId).streamsByType(e.type).streamById(e.streamId).value()}),e.prototype.getQualityLevelFor=freeOnUnref(function(e){return null==this.mediaRepresentation?null:gf.MediaRepresentationQuerier.for(this.mediaRepresentation).itemById(e.periodId).streamsByType(e.type).streamById(e.streamId).qualityLevelById(e.qualityLevelId).value()}),e.prototype.getActiveStream=freeOnUnref(function(e,t){var n=this.getMediaRepresentationStreamFor(e);if(null==n){var r="mediaRepresentation "+(null==this.mediaRepresentation?"does not exist":"exists")+", periodId="+e.periodId+", streamId="+e.streamId;return a.error("["+t+"] Could not find new active Stream. "+r),null}return n}),e.prototype.getActiveQualityLevel=freeOnUnref(function(e,t){var n=this.getQualityLevelFor(e);if(null==n){var r="mediaRepresentation "+(null==this.mediaRepresentation?"does not exist":"exists")+", periodId="+e.periodId+", qualityLevelId="+e.qualityLevelId;return a.error("["+t+"] Could not find new quality level. "+r),null}return n}),e.prototype.createAudioTrackEvent=freeOnUnref(function(e){""===e.language&&a.warn("Empty language reporting to QoS");var t={_type:"Audio",consumptionId:this.consumptionId,trackId:null!=e.audioTrackId?e.audioTrackId:null,language:e.language,format:e.format,codec:e.codec};return Tv.ContextualEventFactory.createTrackEvent(t,this.mpPlayer.currentTimeMs,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId())}),e.prototype.createVideoTrackEvent=freeOnUnref(function(e){var t={_type:"Video",consumptionId:this.consumptionId,trackId:null,resolution:e.videoTrackResolution,nominalBitrate:e.bitrate,frameRate:e.frameRate,frameRateCategory:e.frameRateCategory,colorSpace:e.colorSpace,codec:e.codec};return Tv.ContextualEventFactory.createTrackEvent(t,this.mpPlayer.currentTimeMs,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId())}),e.prototype.reportTimedTextEvent=freeOnUnref(function(e,t){var n=Tv.ContextualEventFactory.createTimedTextEvent(e,t.language,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId(),null!=t.type?s[t.type]:null,null!=t.subtype?l[t.subtype]:null);this.mediaEventReporter.enqueueMediaEvents([n])}),e})();t.StreamMediaEventController=f}));e(VO);VO.StreamMediaEventController;var jO=t(freeOnUnref(function(e,t){var l=ce&&ce.__assign||freeOnUnref(function(){return(l=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("TraceEventController"),n=freeOnUnref(function(){function e(e,t){this.hasReportedPrePlayback=!1,this.playbackHasStarted=!1,this.parentStepTracker={},this.mediaEventReporter=e,this.sessionIdTracker=t}return e.prototype.reportTraceStart=freeOnUnref(function(e,t,n,r,i){void 0===n&&(n=null),void 0===r&&(r=null),this.reportTraceEvent(e,t,"Start",null,n,r,i)}),e.prototype.reportTraceStop=freeOnUnref(function(e,t,n,r,i,o){void 0===r&&(r=null),void 0===i&&(i=null),this.reportTraceEvent(e,t,"Stop",n,r,i,o)}),e.prototype.playbackStarted=freeOnUnref(function(){this.reportParentTraces(),this.playbackHasStarted=!0}),e.prototype.unload=freeOnUnref(function(){this.playbackHasStarted=!1,this.hasReportedPrePlayback=!1,this.parentStepTracker={}}),e.prototype.reportTraceEvent=freeOnUnref(function(e,t,n,r,i,o,a){if(void 0===i&&(i=null),void 0===o&&(o=null),!this.playbackHasStarted){this.trackParent(i,t,n,a),o=l({},o,{playerName:"XpPlayer"});var s=Tv.TraceEventFactory.createTraceEvent(e,t,n,i,r,o,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId(),a);this.mediaEventReporter.enqueueMediaEvents([s])}}),e.prototype.trackParent=freeOnUnref(function(e,t,n,r){if(null!=e)if(s.info("Tracking parent step "+e+" for child step "+t+" with state "+n),null==this.parentStepTracker[e]&&(this.parentStepTracker[e]={children:[]}),this.parentStepTracker[e].children.push(t),null==r&&(r=Date.now()),"Start"===n&&null==this.parentStepTracker[e].startTimestamp)this.parentStepTracker[e].startTimestamp=r;else if("Stop"===n){var i=this.parentStepTracker[e].stopTimestamp;this.parentStepTracker[e].stopTimestamp=Math.max(null!=i?i:0,r)}}),e.prototype.reportParentTraces=freeOnUnref(function(){for(var e=0,t=Object.keys(this.parentStepTracker);e<t.length;e++){var n=t[e];if(null!=this.parentStepTracker[n].startTimestamp){null==this.parentStepTracker[n].stopTimestamp&&(s.warn("The minor step didn't report stop for parent "+n+". Setting current time as stop"),this.parentStepTracker[n].stopTimestamp=Date.now());var r=this.parentStepTracker[n],i=r.startTimestamp,o=r.stopTimestamp,a=r.children;this.reportTraceStart("PlaybackStartup",n,null,null,i),this.reportTraceStop("PlaybackStartup",n,"Success",null,null,o),s.info("Reported parent trace "+n+" with children "+a.join(", "))}else s.warn("Trace start missing for parent "+n)}}),e})();t.TraceEventController=n}));e(jO);jO.TraceEventController;var qO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("MediaEventController"),r=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f){this.consumptionId=null,this.mediaEventReporter=e,this.playlistEngine=a,this.sessionIdTracker=t,this.acquisitionMediaEventController=new Dv.AcquisitionMediaEventController(e,n),this.adIdentifierMediaEventController=new xv.AdIdentifierMediaEventController(e,t.getPlayerInstanceId()),this.bitstreamMediaEventController=new Fv.BitstreamMediaEventController(e),this.contentMediaEventController=new Bv.ContentMediaEventController(e,n,this.sessionIdTracker,this.playlistEngine),this.deviceFulfillmentMediaEventController=new Hv.DeviceFulfillmentMediaEventController(e,this.sessionIdTracker,o),this.streamMediaEventController=new VO.StreamMediaEventController(e,i,n,this.sessionIdTracker),this.contextualMediaEventController=new Vv.ContextualMediaEventController(e,r,this.sessionIdTracker,this.deviceFulfillmentMediaEventController,this.streamMediaEventController,s,l,f),this.customMetadataEventController=new jv.CustomMetadataEventController(e,n,this.sessionIdTracker),this.customMetricsController=new qv.CustomMetricsController(e,this.sessionIdTracker),this.errorMediaEventController=new Iv.ErrorMediaEventController(e,n,this.sessionIdTracker),this.stallMediaEventController=new NO.StallMediaEventController(e,n,this.sessionIdTracker),this.playbackMediaEventController=new zv.PlaybackMediaEventController(e,n,this.sessionIdTracker,this.playlistEngine),this.traceEventController=new jO.TraceEventController(e,this.sessionIdTracker)}return e.prototype.reportSyeContentMediaEvent=freeOnUnref(function(e,t){this.contentMediaEventController.reportSyeContentMediaEvent(e,t)}),e.prototype.setVcid=freeOnUnref(function(e){this.contentMediaEventController.setVcid(e)}),e.prototype.reportDeviceFulfillment=freeOnUnref(function(e,t){this.deviceFulfillmentMediaEventController.setParameters(e,t),this.deviceFulfillmentMediaEventController.reportDeviceFulfillmentEvent()}),e.prototype.setLiveAdTimelineManager=freeOnUnref(function(e){this.contentMediaEventController.setLiveAdTimelineManager(e)}),e.prototype.initialize=freeOnUnref(function(e){this.bitstreamMediaEventController.initialize(),this.contentMediaEventController.initialize(),this.contextualMediaEventController.initialize(e),this.customMetadataEventController.initialize(),this.errorMediaEventController.initialize(),this.playbackMediaEventController.initialize(),this.stallMediaEventController.initialize(),this.streamMediaEventController.initialize()}),e.prototype.uninitialize=freeOnUnref(function(){this.mediaEventReporter.dispatchMediaEvents(),this.bitstreamMediaEventController.uninitialize(),this.contentMediaEventController.uninitialize(),this.contextualMediaEventController.uninitialize(),this.customMetadataEventController.uninitialize(),this.errorMediaEventController.uninitialize(),this.playbackMediaEventController.uninitialize(),this.stallMediaEventController.uninitialize(),this.streamMediaEventController.uninitialize()}),e.prototype.unload=freeOnUnref(function(){this.consumptionId=null,this.acquisitionMediaEventController.unload(),this.bitstreamMediaEventController.unload(),this.contentMediaEventController.unload(),this.errorMediaEventController.unload(),this.playbackMediaEventController.unload(),this.deviceFulfillmentMediaEventController.unload(),this.streamMediaEventController.unload(),this.contextualMediaEventController.unload()}),e.prototype.updateClientId=freeOnUnref(function(e){this.playbackMediaEventController.updateClientId(e)}),e.prototype.updatePlaybackSettings=freeOnUnref(function(e,t){this.contextualMediaEventController.updatePlaybackSettings(e,t)}),e.prototype.updateBufferSettings=freeOnUnref(function(e){this.playbackMediaEventController.updateBufferSettings(e)}),e.prototype.updateConsumptionId=freeOnUnref(function(e){this.consumptionId=e,this.acquisitionMediaEventController.updateConsumptionId(e),this.adIdentifierMediaEventController.updateConsumptionId(e),this.playbackMediaEventController.updateConsumptionId(e),this.bitstreamMediaEventController.updateConsumptionId(e),this.errorMediaEventController.updateConsumptionId(e),this.streamMediaEventController.updateConsumptionId(e),this.deviceFulfillmentMediaEventController.updateConsumptionId(e),this.contextualMediaEventController.updateConsumptionId(e)}),e.prototype.getConsumptionId=freeOnUnref(function(){return this.consumptionId}),e.prototype.getWatchSessionId=freeOnUnref(function(){return this.sessionIdTracker.getWatchSessionId()}),e.prototype.isOpen=freeOnUnref(function(){return this.playbackMediaEventController.getIsOpen()}),e.prototype.updateTitleId=freeOnUnref(function(e){this.acquisitionMediaEventController.updateTitleId(e)}),e.prototype.updateAuditPings=freeOnUnref(function(e,t){this.adIdentifierMediaEventController.updateAuditPings(e,t)}),e.prototype.updatePlaybackContentContext=freeOnUnref(function(e){this.playbackMediaEventController.updatePlaybackContentContext(e)}),e.prototype.updateMediaRepresentation=freeOnUnref(function(e){this.streamMediaEventController.updateMediaRepresentation(e)}),e.prototype.setContentSource=freeOnUnref(function(e){this.playbackMediaEventController.setContentSource(e)}),e.prototype.setBitstreamSource=freeOnUnref(function(e){this.bitstreamMediaEventController.setBitstreamSource(e)}),e.prototype.reportError=freeOnUnref(function(e,t,n,r){this.errorMediaEventController.reportError(e,t,n,r)}),e.prototype.reportPlayback=freeOnUnref(function(e){this.playbackMediaEventController.reportPlaybackEvent(e)}),e.prototype.reportFailover=freeOnUnref(function(e){var t=Tv.FailoverEventFactory.createFailoverEvent(e.ruleId,e.fromConsumptionId,e.toConsumptionId);this.mediaEventReporter.enqueueMediaEvents([t])}),e.prototype.reportFragmentAcquisitionSuccess=freeOnUnref(function(e){this.acquisitionMediaEventController.reportFragmentAcquisitionSuccess(e)}),e.prototype.reportFragmentAcquisitionFailure=freeOnUnref(function(e){this.reportCdnEdgeError(e),this.acquisitionMediaEventController.reportFragmentAcquisitionFailure(e)}),e.prototype.reportLicenseAcquisitionSuccess=freeOnUnref(function(e){this.acquisitionMediaEventController.reportLicenseAcquisitionSuccess(e)}),e.prototype.reportLicenseAcquisitionFailure=freeOnUnref(function(e){this.acquisitionMediaEventController.reportLicenseAcquisitionFailure(e)}),e.prototype.reportManifestAcquisitionSuccess=freeOnUnref(function(e){this.acquisitionMediaEventController.reportManifestAcquisitionSuccess(e),this.stallMediaEventController.reportManifestAcquisitionSuccess()}),e.prototype.reportManifestAcquisitionFailure=freeOnUnref(function(e){n.info("Reporting manifest acquisition failure: "+JSON.stringify(e)),this.acquisitionMediaEventController.reportManifestAcquisitionFailure(e),this.stallMediaEventController.reportManifestAcquisitionFailure(e);var t=this.extractErrorType(e.error);this.errorMediaEventController.reportError(!1,e.error,void 0,t,e.consumptionId)}),e.prototype.reportStallEvent=freeOnUnref(function(e,t){this.stallMediaEventController.reportStallEvent(e,t)}),e.prototype.reportTimedTextAcquisitionSuccess=freeOnUnref(function(e){this.acquisitionMediaEventController.reportTimedTextAcquisitionSuccess(e)}),e.prototype.reportTimedTextAcquisitionFailure=freeOnUnref(function(e){this.acquisitionMediaEventController.reportTimedTextAcquisitionFailure(e)}),e.prototype.setDisplayMode=freeOnUnref(function(e){this.contextualMediaEventController.setDisplayMode(e)}),e.prototype.setViewportMode=freeOnUnref(function(e){this.contextualMediaEventController.setViewportMode(e)}),e.prototype.reportWeblab=freeOnUnref(function(e,t){this.contextualMediaEventController.reportWeblab(e,t)}),e.prototype.reportFeatureFlag=freeOnUnref(function(e,t){this.contextualMediaEventController.reportFeatureFlag(e,t)}),e.prototype.resetFeatureFlags=freeOnUnref(function(){this.contextualMediaEventController.unload()}),e.prototype.reportCustomMetadata=freeOnUnref(function(e){this.customMetadataEventController.reportCustomMetadata(e)}),e.prototype.reportCustomMetrics=freeOnUnref(function(e){this.customMetricsController.reportCustomMetrics(e)}),e.prototype.reportPlayerCapability=freeOnUnref(function(e){this.contextualMediaEventController.reportCapability(e)}),e.prototype.reportPlayerCacheStatus=freeOnUnref(function(e){this.contextualMediaEventController.updateCacheStatus(e)}),e.prototype.reportPreInitState=freeOnUnref(function(e){this.contextualMediaEventController.updatePreinitHit(e)}),e.prototype.reportAccessTokenAcquisition=freeOnUnref(function(e){this.acquisitionMediaEventController.reportCdnAccessTokenAcquisition(e)}),e.prototype.reportAssetFulfilment=freeOnUnref(function(e){for(var t=[],n=0,r=e.playlist;n<r.length;n++){var i=r[n];t.push({_type:"Ad",description:{adId:i.description.adId,creativeId:i.description.creativeId,duration:jr.extendedLimitedIso8601TimeFormatToMilliseconds(i.description.duration),contentType:i.description.contentType},uiFeatures:null!=i.uiFeatures?Object.keys(i.uiFeatures):[],deliveries:i.media.urls.map(freeOnUnref(function(e){return{url:e.url,cdn:e.cdn,origin:e.origin,consumptionId:e.consumptionId}}))})}var o=Tv.AssetFulfillmentEventFactory.createAssetFulfillmentEvent(e.description.adDeliverySessionId,t,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId());this.mediaEventReporter.enqueueMediaEvents([o])}),e.prototype.extractErrorType=freeOnUnref(function(e){if("ParseError"===e.reason.type)return"ManifestParse"}),e.prototype.reportCdnEdgeError=freeOnUnref(function(e){if(null!=e.acquisitionError&&(null!=e.headers&&"edge"===e.headers["x-amz-error-source"])){var t=null!=e.status?e.status:"xxx",n=ct.Errors.newError("cdnTokenAuthError","cdnTokenAuthError.http."+t,e.acquisitionError);this.reportError(!1,n,"Player","Unknown")}}),e})();t.MediaEventController=r}));e(qO);qO.MediaEventController;var HO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("EndOfContentSeekInterceptor"),n=freeOnUnref(function(){return function(e){var i=this;this.getNewSeekTarget=freeOnUnref(function(e,t){var n=i.playlistEngine.getItems(),r=n[t].end;return null!=r&&r-1e4<e&&(t===n.length-1||n[t].titleId!==n[t+1].titleId)?(o.info("Detected a seek too close to the end of the content, setting seek position to "+(r-1e4)+"ms"),{newPosition:r-1e4,newItemIndex:t}):{newPosition:e,newItemIndex:t}}),this.playlistEngine=e}})();t.EndOfContentSeekInterceptor=n}));e(HO);HO.EndOfContentSeekInterceptor;var zO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function s(e){return null==e.mediaRepresentation&&null==e.contentSource}function l(e,t,n){for(var r=e[t].titleId,i=0,o=null,a=t;0<=a;a--){var s=e[a];if(s.titleId!==r&&n<++i){o=a;break}r=s.titleId}return o}var n=freeOnUnref(function(){function e(e,t,n,r){void 0===n&&(n=1/0),void 0===r&&(r=1);var i=this;this.onEnterItem=freeOnUnref(function(){i.trim(),i.cleanse()}),this.playlistEngine=e,this.unloadTitle=t,this.titlesToRetain=n,this.titlesToNotCleanse=r,null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.playlistTrimming&&(null!=L.configurationStore.configuration.playlistTrimming.titlesToRetain&&(this.titlesToRetain=L.configurationStore.configuration.playlistTrimming.titlesToRetain),null!=L.configurationStore.configuration.playlistTrimming.titlesToNotCleanse&&(this.titlesToNotCleanse=L.configurationStore.configuration.playlistTrimming.titlesToNotCleanse))}return e.prototype.initialize=freeOnUnref(function(){this.titlesToRetain===1/0&&this.titlesToNotCleanse===1/0||this.playlistEngine.on("EnterItem",this.onEnterItem)}),e.prototype.terminate=freeOnUnref(function(){this.playlistEngine.off("EnterItem",this.onEnterItem)}),e.prototype.cleanseItem=freeOnUnref(function(e){s(e)||this.unloadTitle(e.titleId),null!=e.mediaRepresentation&&e.mediaRepresentation.stop(),null!=e.contentSource&&e.contentSource.stop(),null!=e.destroy&&e.destroy()}),e.prototype.cleanseRange=freeOnUnref(function(e,t,n){for(var r=null,i=t;i<=n;i++){var o=e[i];r!==o.titleId&&(this.cleanseItem(o),r=o.titleId)}}),e.prototype.cleanse=freeOnUnref(function(){var e=this.playlistEngine.getCurrentItemIndex();if(null!==e){var t=this.playlistEngine.getItems(),n=function(e){for(var t=0;t<e.length;t++)if(!s(e[t]))return t;return null}(t),r=l(t,e,this.titlesToNotCleanse);if(null!=n&&null!=r&&n<=r){this.cleanseRange(t,n,r);var i=t[n].start,o=t[r].end,a=null===o?1/0:o;this.playlistEngine.update(n,i,r,a,{mediaRepresentation:void 0,contentSource:void 0,playlistRelativeConstrainedTimeWindow:void 0,sourceUrlStore:void 0,playbackErrorHandler:void 0,destroy:void 0,initializeContentCallback:void 0,internalCancelFunction:void 0,internalCancelToken:void 0})}}}),e.prototype.trim=freeOnUnref(function(){var e=this.playlistEngine.getCurrentItemIndex();if(null!==e){var t=this.playlistEngine.getItems(),n=l(t,e,this.titlesToRetain);if(null!=n){this.cleanseRange(t,0,n);var r=t[0].start,i=t[n].end,o=null===i?1/0:i;this.playlistEngine.splice(0,r,n,o,[])}}}),e})();t.PlaylistTrimmer=n}));e(zO);zO.PlaylistTrimmer;var WO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var n=this;this.enableInfiniteAutoplay=!1,this.maxContinuousPlayTitleTransitions=5,this.titleTransitionsSinceLastInteraction=0,this.currentTitleId=null,this.titleIdBarrierMap={},this.onEnterItem=freeOnUnref(function(e){var t=e.item.titleId;null!==n.currentTitleId&&t!==n.currentTitleId&&n.titleTransitionsSinceLastInteraction++,n.currentTitleId=t}),this.playlistEngine=e}return e.prototype.initialize=freeOnUnref(function(e){void 0===e&&(e=!1),this.enableInfiniteAutoplay=e,this.playlistEngine.on("EnterItem",this.onEnterItem)}),e.prototype.terminate=freeOnUnref(function(){this.playlistEngine.off("EnterItem",this.onEnterItem)}),e.prototype.unloaded=freeOnUnref(function(){this.currentTitleId=null,this.titleIdBarrierMap={}}),e.prototype.resetInteractions=freeOnUnref(function(){this.titleTransitionsSinceLastInteraction=0}),e.prototype.setMaxContinuousPlayTitleTransitions=freeOnUnref(function(e){this.maxContinuousPlayTitleTransitions=e}),e.prototype.addTitleBarrier=freeOnUnref(function(e,t){this.titleIdBarrierMap[e]=t}),e.prototype.canAutoplayBetween=freeOnUnref(function(e,t){return e.titleId===t.titleId||(null==this.titleIdBarrierMap[e.titleId]||this.titleIdBarrierMap[e.titleId]!==t.titleId)&&(this.enableInfiniteAutoplay||this.titleTransitionsSinceLastInteraction<this.maxContinuousPlayTitleTransitions)}),e})();t.XpAutoplayBarrier=n}));e(WO);WO.XpAutoplayBarrier;var KO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("VideoQualityOverrideStorage"),a="xp.drm_allowed_playback_quality",n=freeOnUnref(function(){function e(e){var i=this;this.videoQualityOverride=null,this.storageUpdated=!1,this.xpPlayerCapabilitiesFeature=e,this.storageAccessPromise=new lt.Promise(freeOnUnref(function(r){Tt.keyValueStore.get(a,freeOnUnref(function(e,t){if(null==e){if(null!=t)try{var n=JSON.parse(t);i.isOverrideExpired(n.timestampMs)?i.storeDowngradeQuality(null):null!=n.qualityOverride&&(o.info("Downgrading video quality to "+n.qualityOverride+" based on locally stored override."),i.xpPlayerCapabilitiesFeature.setVerifiedSecurePipeline(!1),i.videoQualityOverride=n.qualityOverride)}catch(e){o.warn("Error parsing locally stored video quality override:",e),i.storeDowngradeQuality(null)}}else o.warn("Error occurs during local storage access, error: "+e+", code: "+e.code);r(i.videoQualityOverride)}))}))}return e.prototype.storeDowngradeQuality=freeOnUnref(function(e){var t=null==(this.videoQualityOverride=e);this.xpPlayerCapabilitiesFeature.setVerifiedSecurePipeline(t),this.storageUpdated=!0;var n={timestampMs:Date.now(),qualityOverride:this.videoQualityOverride},r=JSON.stringify(n);Tt.keyValueStore.set(a,r,freeOnUnref(function(e){null!=e&&o.warn("Cannot store video quality override locally, error: "+e+", code: "+e.code)}))}),e.prototype.getValue=freeOnUnref(function(){return this.storageUpdated?lt.Promise.resolve(this.videoQualityOverride):this.storageAccessPromise}),e.prototype.isOverrideExpired=freeOnUnref(function(e){return 864e5<Date.now()-e}),e})();t.VideoQualityOverrideStorage=n}));e(KO);KO.VideoQualityOverrideStorage;var GO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("PlaylistTrackingEventReporter"),r=freeOnUnref(function(){function e(e){var n=this;this.eventReporters={},this.playlistItem=null,this.volumeFeature=null,this.volumeMuted=!1,this.onEnterItem=freeOnUnref(function(e){if(e.item!==n.playlistItem){var t=n.getCurrentTrackingEventReporter();null!==t&&t.reportSkipOrComplete(e.seekedTo)}n.playlistItem=e.item}),this.onPlaylistEnd=freeOnUnref(function(){var e=n.getCurrentTrackingEventReporter();null!==e&&e.reportSkipOrComplete(!1)}),this.onPlaylistUpdate=freeOnUnref(function(){if(x.isEmpty(n.playlistEngine.getItems())){var e=n.getCurrentTrackingEventReporter();null!==e&&e.reportClose(),n.reset()}}),this.onVolumeChange=freeOnUnref(function(){if(null!==n.volumeFeature){var e=n.volumeFeature.muted||0===n.volumeFeature.volume;if(e!==n.volumeMuted){var t=n.getCurrentTrackingEventReporter();null!==t&&t.reportMuteOrUnmute(e),n.volumeMuted=e}}}),this.playlistEngine=e}return e.prototype.initialize=freeOnUnref(function(e){this.playlistEngine.on("EnterItem",this.onEnterItem),this.playlistEngine.on("PlaylistEnd",this.onPlaylistEnd),this.playlistEngine.on("PlaylistUpdate",this.onPlaylistUpdate),null!==e&&(this.volumeFeature=e,this.volumeMuted=e.muted||0===e.volume,e.onChange(this.onVolumeChange))}),e.prototype.terminate=freeOnUnref(function(){this.playlistEngine.off("EnterItem",this.onEnterItem),this.playlistEngine.off("PlaylistEnd",this.onPlaylistEnd),this.playlistEngine.off("PlaylistUpdate",this.onPlaylistUpdate),null!==this.volumeFeature&&this.volumeFeature.offChange(this.onVolumeChange),this.reset()}),e.prototype.registerAdTrackingEventReporter=freeOnUnref(function(e,t){this.eventReporters[e]=t}),e.prototype.getCurrentTrackingEventReporter=freeOnUnref(function(){return null!==this.playlistItem&&"Ad"===this.playlistItem.type?Qe.withDefault(this.eventReporters[this.playlistItem.adInstanceId],null):null}),e.prototype.reset=freeOnUnref(function(){n.info("Resetting playlist tracking events"),this.playlistItem=null,this.eventReporters={}}),e})();t.PlaylistTrackingEventReporter=r}));e(GO);GO.PlaylistTrackingEventReporter;var QO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createDownloadOperationMetadataKey=function(e){return"download_operation_"+e},t.createDownloadOperationStoragePrefixKey=function(e){return e+"/segment_data/"},t.createGetSectionsResponseKey=function(e){return"get_sections_"+e},t.createLicenseInformationMetadataKey=function(e){return"license_information_"+e},t.createPlaybackResourceResponseKey=function(e){return"prs_metadata_"+e}}));e(QO);QO.createDownloadOperationMetadataKey,QO.createDownloadOperationStoragePrefixKey,QO.createGetSectionsResponseKey,QO.createLicenseInformationMetadataKey,QO.createPlaybackResourceResponseKey;var XO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(e){return"Init"+e});t.convertStateIntoInitAction=n}));e(XO);XO.convertStateIntoInitAction;var YO=t(freeOnUnref(function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0});var i=((n={}).Completed="Completed",n.Deleted="Deleted",n.Deleting="Deleting",n.Disabled="Disabled",n.DisabledCompleted="Disabled",n.Downloading="Downloading",n.Error="Error",n.Retrying="Error",n.Paused="Paused",n.Pausing="Pausing",n.Pending="Pending",n);t.INTERNAL_DOWNLOAD_OPERATION_STATE_TO_PUBLIC_STATE_MAP=i;var o=((r={}).Completed="Complete",r.Deleted="Delete",r.Disabled="Disable",r.DisabledCompleted="Disable",r.Downloading="Start",r.Error="Error",r.Paused="Stop",r.Pending="Disable",r);t.INTERNAL_DOWNLOAD_OPERATION_STATE_TO_DOWNLOAD_REPORT_ACTION=o}));e(YO);YO.INTERNAL_DOWNLOAD_OPERATION_STATE_TO_PUBLIC_STATE_MAP,YO.INTERNAL_DOWNLOAD_OPERATION_STATE_TO_DOWNLOAD_REPORT_ACTION;var JO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.eventEmitter=new A.EventEmitter,this.playbackUrls=e,this.currentUrlSet=this.playbackUrls.urlSets[this.playbackUrls.defaultUrlSetId]}return e.prototype.get=freeOnUnref(function(){return this.toSourceUrl(this.currentUrlSet)}),e.prototype.getCurrentManifestData=freeOnUnref(function(){return this.currentUrlSet.urls.manifest}),e.prototype.resourceAcquired=freeOnUnref(function(e){}),e.prototype.resourceAcquisitionFailed=freeOnUnref(function(e,t,n,r){return!0}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.toSourceUrl=freeOnUnref(function(e){return{url:e.urls.manifest.url,urlId:e.urlSetId,headers:{},getAccessToken:freeOnUnref(function(){return{type:"NoToken"}})}}),e})();t.DownloadPlaybackUrlsSourceUrlStore=n}));e(JO);JO.DownloadPlaybackUrlsSourceUrlStore;var ZO=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var p=de.get("PlaybackUrlsContentDownloaderSource"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s){var l=this;if(this.audioTrackMetadata=null,this.deferredContentDownloaderFragmentPromise=null,this.internalOperationCancelFunction=null,this.internalOperationCancelToken=null,this.mediaRepresentation=null,this.representationSource=null,this.resourceAcquirer=new Ac.ResourceAcquirer,this.acquireManifest=freeOnUnref(function(){var e=l.createRepresentationSource();l.representationSource=e,lt.Promise.resolve().then(freeOnUnref(function(){return l.checkOperationCanceled(),l.acquireMediaRepresentation(e)})).then(freeOnUnref(function(t){return l.checkOperationCanceled(),gf.MediaCapabilitiesFilter.create(t).then(freeOnUnref(function(e){l.checkOperationCanceled(),t.applyFilters([e,new gf.AudioQualityLevelFilter]),l.mediaRepresentation=t,l.stateMachine.act("Ready")}))})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||l.stateMachine.act("Cancel")}))}),this.handleInitialManifestAcquired=freeOnUnref(function(){if(null!=l.mediaRepresentation){l.mediaRepresentation.start(0);var e=l.createContentDownloader(l.mediaRepresentation);null!=l.deferredContentDownloaderFragmentPromise&&(l.deferredContentDownloaderFragmentPromise.resolve(e),l.deferredContentDownloaderFragmentPromise=null)}else l.stateMachine.act("Cancel")}),this.shutdownSource=freeOnUnref(function(){null!=l.internalOperationCancelFunction&&(l.internalOperationCancelFunction(),l.internalOperationCancelFunction=null),null!=l.deferredContentDownloaderFragmentPromise&&null!=l.internalOperationCancelToken&&l.deferredContentDownloaderFragmentPromise.reject(l.internalOperationCancelToken.promise),null!=l.mediaRepresentation&&(l.mediaRepresentation.stop(),l.mediaRepresentation=null),null!=l.representationSource&&(l.representationSource.stop(),l.representationSource=null)}),this.onStateChangeError=freeOnUnref(function(e){null!=l.deferredContentDownloaderFragmentPromise&&l.deferredContentDownloaderFragmentPromise.reject(e),p.error(e)}),this.contentConfig=e,this.downloadOperationId=t,this.getLicenseCallback=n,this.mediaKeysManager=r,this.maxVideoBitrate=o,this.audioStreamMatchers=a,this.timedTextStreamMatchers=s,!x.isEmpty(i.audioTracks)){this.audioTrackMetadata={};for(var f=0,u=i.audioTracks;f<u.length;f++){var c=u[f],d=null!=c.audioTrackId?c.audioTrackId:c.languageCode+"_"+c.audioSubtype+"_"+c.index;this.audioTrackMetadata[d]={languageCode:c.languageCode,subtype:gf.AUDIO_SUBTYPE_MAP[c.audioSubtype],label:c.displayName}}}this.sourceUrlStore=new JO.DownloadPlaybackUrlsSourceUrlStore(i),this.stateMachine=new ml.FiniteStateMachine("Uninitialized"),this.setupStateMachine()}return e.prototype.start=freeOnUnref(function(){if(null!=this.deferredContentDownloaderFragmentPromise)return this.deferredContentDownloaderFragmentPromise.promise;this.deferredContentDownloaderFragmentPromise=new lt.Deferred;var e=lt.CancelToken.source(),t=e.token,n=e.cancel;return this.internalOperationCancelFunction=n,this.internalOperationCancelToken=t,p.info("Manifest URL:",this.sourceUrlStore.get().url),this.stateMachine.act("Initialize"),this.deferredContentDownloaderFragmentPromise.promise}),e.prototype.stop=freeOnUnref(function(){this.stateMachine.act("Cancel")}),e.prototype.getCurrentConsumptionId=freeOnUnref(function(){return this.sourceUrlStore.get().urlId}),e.prototype.acquireMediaRepresentation=freeOnUnref(function(e){var t=e.mediaRepresentation;return!0===t.valid?t.contents:t.refresh()}),e.prototype.checkOperationCanceled=freeOnUnref(function(){null!=this.internalOperationCancelToken&&this.internalOperationCancelToken.throwIfRequested()}),e.prototype.createContentDownloader=freeOnUnref(function(e){return new yd.ContentDownloaderFragment(this.contentConfig,this.downloadOperationId,this.getLicenseCallback,this.mediaKeysManager,e,this.maxVideoBitrate,this.sourceUrlStore,this.audioStreamMatchers,this.timedTextStreamMatchers)}),e.prototype.createRepresentationSource=freeOnUnref(function(){return new ih.DashMediaRepresentationSource(this.resourceAcquirer,this.sourceUrlStore,null,"segmentBase",this.audioTrackMetadata,3,this.downloadOperationId)}),e.prototype.setupStateMachine=freeOnUnref(function(){this.stateMachine.addTransition("Uninitialized","Initialize","Initializing"),this.stateMachine.addTransition("Initializing","Cancel","Uninitialized"),this.stateMachine.addTransition("Initializing","Ready","Ready"),this.stateMachine.addTransition("Ready","Cancel","Uninitialized"),this.stateMachine.onEnterState("Initializing",this.acquireManifest),this.stateMachine.onEnterState("Uninitialized",this.shutdownSource),this.stateMachine.onTransition("Initializing","Ready",this.handleInitialManifestAcquired),this.stateMachine.onIllegalTransition(freeOnUnref(function(e,t,n){p.error("IllegalTransitionError from action ["+t+"] while in state ["+e+"]")})),this.stateMachine.onUncaughtException(this.onStateChangeError)}),e})();t.PlaybackUrlsContentDownloaderSource=n}));e(ZO);ZO.PlaybackUrlsContentDownloaderSource;var $O=t(freeOnUnref(function(e,t){var n,r,i,o,s=ce&&ce.__assign||freeOnUnref(function(){return(s=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});de.get("StreamMatcherTransformer"),(n={}).Audio="Audio",n.TimedText="TimedText",n.Video="Video";var a=((r={}).Dialog="Dialog",r.Commentary="Commentary",r.Descriptive="Descriptive",r.BoostedDialogLow="BoostedDialogLow",r.BoostedDialogMedium="BoostedDialogMedium",r.BoostedDialogHigh="BoostedDialogHigh",r.FilteredContent="FilteredContent",r.DialogMachineGenerated="DialogMachineGenerated",r),l=((i={}).Dialog="Dialog",i.Commentary="Commentary",i.Descriptive="Descriptive",i.BoostedDialogLow="BoostedDialogLow",i.BoostedDialogMedium="BoostedDialogMedium",i.BoostedDialogHigh="BoostedDialogHigh",i.FilteredContent="FilteredContent",i.DialogMachineGenerated="DialogMachineGenerated",i);t.MediaRepresentationAudioSubtypeToAudioTypeMap=l;var f=((o={}).Mandatory="Mandatory",o.Subtitle="Subtitle",o.Caption="Subtitle",o.SDH="Subtitle",o.MachineGenerated="Subtitle",o.Audio="Audio",o),u=freeOnUnref(function(){function e(){}return e.expandMatcherLanguages=freeOnUnref(function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];if(t.push(i),null!=i.language){i.language=i.language.toLowerCase();for(var o=i.language,a=o.lastIndexOf("-");-1!==a;)a=(o=o.substring(0,a)).lastIndexOf("-"),t.push(s({},i,{language:o}))}}return t}),e.convertStreamMatcherToTypeMatcher=freeOnUnref(function(e,t){if("Audio"===e){var n=t;return{type:"Audio",language:n.language,subtype:null!=n.type?a[n.type]:void 0}}if("TimedText"===e){var r=t,i=null!=r.type?f[r.type]:"Subtitle";return{type:"TimedText",language:t.language,textType:i}}return{type:"Video"}}),e})();t.StreamMatcherTransformer=u}));e($O);$O.MediaRepresentationAudioSubtypeToAudioTypeMap,$O.StreamMatcherTransformer;var eS=t(freeOnUnref(function(e,t){var p=ce&&ce.__assign||freeOnUnref(function(){return(p=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var g=de.get("DownloadOperation"),h=["prs.no_rights.anonymizer_ip","prs.no_rights.consent_expired","prs.no_rights.device_limit_reached","prs.no_rights.download_limit_exceeded","prs.no_rights.invalid_geo_ip","prs.no_rights.no_available_streams","prs.no_rights.not_owned","prs.no_rights.not_accepted_terms","prs.no_rights.pv_lower_tier_device_not_permitted_access","prs.no_rights",Ni.codes.xp.download.storage.disk_full,"download.drm.license.prs.no_rights"],o=["prs.no_rights.consent_expired"],n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c){var d=this;this.metadata=null,this.contentConfig=null,this.downloadError=null,this.needRefresh=!1,this.audioStreamMatchers=[],this.cancelCurrentOperation=null,this.contentDownloaderFragment=null,this.contentDownloaderSource=null,this.licenseAcquirer=null,this.staticTimedTextStreams=[],this.startDownloadPromise=lt.Promise.resolve(),this.timedTextStreamMatchers=null,this.isHeld=!1,this.eventEmitter=new A.EventEmitter,this.cancelingTransition=freeOnUnref(function(){q.metrics.putMetric("Download.Canceled")}),this.onEnterErrorState=freeOnUnref(function(){if(null!=d.downloadError){var e=d.downloadError instanceof ct.XpError&&x.contains(h,d.downloadError.code);g.info("Download error (byDesign:"+e+"): "+d.downloadError),d.eventEmitter.emit("DownloadError",{downloadOperationId:d.id,error:d.downloadError})}d.processStateChange("Error"),d.internalPause()}),this.onLeaveErrorState=freeOnUnref(function(){d.downloadError=null,d.updateDownloadOperationMetadata(d.downloadOperationState)}),this.errorTransition=freeOnUnref(function(e){q.metrics.putMetric("Download.Failed");var t=e instanceof ct.XpError&&x.contains(h,e.code);t&&q.metrics.putMetric("Download.Failed.ByDesign"),d.downloadError=e instanceof ct.XpError?e:new ct.XpError(e.name,void 0,e.message,!0,e),g.warn("Reported metric for download error (byDesign:"+t+"): "+d.downloadError)}),this.processStateChange=freeOnUnref(function(t){return g.info(">>> Storing download operation "+d.id+' metadata on state change to "'+t+'".'),d.updateDownloadOperationMetadata(t).then(freeOnUnref(function(){return d.emitStateChange(t)})).catch(freeOnUnref(function(e){g.error('Unable to store download operation metadata on state change to "'+t+'": ',e)}))}),this.onError=freeOnUnref(function(e){e instanceof lt.CancelError||d.stateMachine.actNow("Error",e)}),this.reportLicenseAcquisitionSuccess=freeOnUnref(function(e){}),this.reportLicenseAcquisitionFailure=freeOnUnref(function(e){}),this.downloadCompletedTransition=freeOnUnref(function(){d.internalPause().then(freeOnUnref(function(){return d.stateMachine.actNow("Complete")})).catch(freeOnUnref(function(e){return d.onError(e)}))}),this.onDownloadProgress=freeOnUnref(function(e){var t=p({downloadOperationId:d.id},e);d.localContentSize.totalSizeBytes=e.estimatedTotalSizeBytes,d.localContentSize.downloadedSizeBytes=e.downloadedSizeBytes,d.eventEmitter.emit("DownloadProgress",t)}),this.onTracksAvailable=freeOnUnref(function(n){var e=Object.keys(n.audioTracks).map(freeOnUnref(function(e){var t=n.audioTracks[e];return{language:t.language,type:$O.MediaRepresentationAudioSubtypeToAudioTypeMap[t.type],isScheduled:t.isScheduled}}));d.eventEmitter.emit("TracksAvailable",{downloadOperationId:d.id,availableTracks:{audioTracks:e}})}),this.id=e,this.downloadOperationMetadataKey=QO.createDownloadOperationMetadataKey(this.id),this.mediaEventController=n,this.getSectionsAcquirer=t,this.mediaKeysManager=r,this.isHeld=i,this.playbackResourceAcquirer=o,this.prsClient=a,this.staticTimedTextDataStore=s,this.localContentSize={downloadedSizeBytes:0,totalSizeBytes:0},this.licenseConsumptionTracker=ea.LicenseConsumptionTrackerManager.getInstance().getLicenseConsumptionTracker(this.id),null!=l&&(this.contentConfig=l),this.maxVideoBitrateBitPerSec=null!=f?f:Number.MAX_VALUE,null!=u&&(this.audioStreamMatchers=u),null!=c&&(this.timedTextStreamMatchers=c),this.stateMachine=new ml.FiniteStateMachine("Pending"),this.setupStateMachine()}return Object.defineProperty(e.prototype,"downloadOperationState",{get:freeOnUnref(function(){return this.stateMachine.state}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bookmarkPositionMsAtDownload",{get:freeOnUnref(function(){return this.bookmarkPositionMs}),enumerable:!0,configurable:!0}),e.prototype.initialize=freeOnUnref(function(){var r=this;return g.info(">> initialize: "+this.id),Jo.metadataStorage.get(this.downloadOperationMetadataKey).then(freeOnUnref(function(e){if(null==e){if(null==r.contentConfig){g.warn("DownloadOperation "+r.id+" doesn't have persistent metadata nor ContentConfig: rebuilding ContentConfig");var t=r.id.split("_");if(2===t.length)return r.contentConfig={titleId:t[0],videoMaterialType:t[1]},g.warn("Use ContentConfig "+JSON.stringify(r.contentConfig)+" to represent "+r.id+" and set state to Pending"),r.onReportableStateChange("Pending"),r.updateDownloadOperationMetadata("Pending").then(freeOnUnref(function(){return r.deleteContent()}));throw g.error("Unable to form ContentConfig for "+r.id),new ct.XpError("downloader.initialization.invalid_state",void 0,"DownloadOperation "+r.id+" doesn't have persistent metadata nor ContentConfig, and cannot extract titleId or VMT")}return r.onReportableStateChange("Pending"),g.info(">>> download operation "+r.id+" is newly requested. Storing its metadata now."),r.updateDownloadOperationMetadata("Pending")}if(null!=r.contentConfig)return g.warn("DownloadOperation "+r.id+" is constructed with ContentConfig AND has persistent metadata. Potentially metadata was not properly removed. Ignore stale metadata and overwrite."),r.updateDownloadOperationMetadata("Pending");var n=e;r.downloadError=null!=n.downloadErrorCode?new ct.XpError(n.downloadErrorCode):null,r.contentConfig=n.contentConfig,r.localContentSize=n.localContentSize,r.maxVideoBitrateBitPerSec=n.maxVideoBitrateBitPerSec,r.audioStreamMatchers=n.audioStreamMatchers,r.timedTextStreamMatchers=n.timedTextStreamMatchers,r.bookmarkPositionMs=n.bookmarkPositionMs,g.info(">>> download operation "+r.id+" recovered its metadata: "+JSON.stringify(n)),r.stateMachine.actNow(XO.convertStateIntoInitAction(n.state))})).then(freeOnUnref(function(){return r.licenseConsumptionTracker.initialize()})).then(freeOnUnref(function(){return g.info("<< initialize succeed "+r.id)})).catch(freeOnUnref(function(e){throw g.error("<< initialize failed for download operation "+r.id+": ",e),r.onError(e),e}))}),e.prototype.disable=freeOnUnref(function(){g.info(">> disable: "+this.id),this.stateMachine.actNow("Disable")}),e.prototype.enable=freeOnUnref(function(){g.info(">> enable: "+this.id),this.stateMachine.actNow("Enable")}),e.prototype.hold=freeOnUnref(function(){return g.info(">> hold: "+this.id),this.isHeld=!0,null!=this.contentDownloaderFragment?this.contentDownloaderFragment.stop():("Downloading"===this.stateMachine.state&&null!=this.cancelCurrentOperation&&this.cancelCurrentOperation(),lt.Promise.resolve())}),e.prototype.release=freeOnUnref(function(){return g.info(">> release: "+this.id),this.isHeld?(this.isHeld=!1,"Downloading"!==this.stateMachine.state?lt.Promise.resolve():null!=this.contentDownloaderFragment?this.contentDownloaderFragment.start():this.startDownload()):lt.Promise.resolve()}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.pause=freeOnUnref(function(){g.info(">> pause: "+this.id),null!=this.cancelCurrentOperation&&this.cancelCurrentOperation(),this.stateMachine.actNow("StartPausing")}),e.prototype.refresh=freeOnUnref(function(){var t=this;g.info(">> refresh: "+this.id+", download operation state: "+this.stateMachine.state),this.eventEmitter.emit("Refreshing",{downloadOperationId:this.id,refreshing:!0});var e,n=lt.CancelToken.source(),r=n.token,i=n.cancel;return null==this.contentDownloaderFragment?(e=this.createContentDownloaderFragment(r),this.cancelCurrentOperation=i):e=lt.Promise.resolve(this.contentDownloaderFragment),e.then(freeOnUnref(function(e){return(t.contentDownloaderFragment=e).refresh()})).then(freeOnUnref(function(){g.info('Content Downloader Fragment refresh complete, emit "Refreshed", cleanup downloaders and enable download'),t.eventEmitter.emit("Refreshed",{downloadOperationId:t.id,refreshing:!1})})).then(freeOnUnref(function(){t.cleanupContentDownloaders(),t.enable()})).catch(freeOnUnref(function(e){if(g.info("Refresh failed with error: "+e),!(e instanceof lt.CancelError))throw(e instanceof ct.XpError&&x.contains(o,e.code)||x.contains(o,e.message))&&(t.downloadError=e instanceof ct.XpError?e:new ct.XpError(e.message,void 0,e.message,!0,e),t.disable()),t.eventEmitter.emit("RefreshError",{downloadOperationId:t.id,error:e}),e;g.info(">> cancel invoked during refresh: "+t.id)}))}),e.prototype.remove=freeOnUnref(function(){g.info(">> remove, id "+this.id),null!=this.contentConfig&&(null!=this.cancelCurrentOperation&&this.cancelCurrentOperation(),null!=this.licenseAcquirer&&this.deregisterLicenseAcquisitionReporterCallbacks(this.licenseAcquirer),this.mediaKeysManager.off("licenseLoaded",this.licenseConsumptionTracker.setExpiration),this.stateMachine.actNow("StartDeleting"))}),e.prototype.reset=freeOnUnref(function(){g.info(">> reset: "+this.id),null!=this.cancelCurrentOperation&&this.cancelCurrentOperation(),this.stateMachine.actNow("Reset")}),e.prototype.retry=freeOnUnref(function(){g.info(">> retry: "+this.id),this.stateMachine.actNow("Retry")}),e.prototype.start=freeOnUnref(function(){g.info(">> start: "+this.id),this.stateMachine.actNow("Start")}),e.prototype.setupStateMachine=freeOnUnref(function(){var e,r=this;this.stateMachine.addTransition("Pending","InitCompleted","Completed"),this.stateMachine.addTransition("Pending","InitDeleting","Deleting"),this.stateMachine.addTransition("Pending","InitDisabled","Disabled"),this.stateMachine.addTransition("Pending","InitDownloading","Downloading"),this.stateMachine.addTransition("Pending","InitError","Error"),this.stateMachine.addTransition("Pending","InitPaused","Paused"),this.stateMachine.addTransition("Pending","InitPausing","Pausing"),this.stateMachine.addTransition("Pending","InitPending","Pending"),this.stateMachine.addTransition("Pending","InitDisabledCompleted","DisabledCompleted"),this.stateMachine.addTransition("Pending","InitRetrying","Retrying"),this.stateMachine.addTransition("Error","Disable","Disabled"),this.stateMachine.addTransition("Paused","Disable","Disabled"),this.stateMachine.addTransition("Downloading","Disable","Disabled"),this.stateMachine.addTransition("Completed","Disable","DisabledCompleted"),this.stateMachine.onEnterState("Disabled",freeOnUnref(function(){return r.onDisabled("Disabled")})),this.stateMachine.onEnterState("DisabledCompleted",freeOnUnref(function(){return r.onDisabled("DisabledCompleted")})),this.stateMachine.addTransition("Disabled","Enable","Paused"),this.stateMachine.addTransition("DisabledCompleted","Enable","Completed"),this.stateMachine.addTransition("Completed","Enable","Completed"),this.stateMachine.onLeaveState("Disabled",freeOnUnref(function(){return r.downloadError=null})),this.stateMachine.onLeaveState("DisabledCompleted",freeOnUnref(function(){return r.downloadError=null})),this.stateMachine.addTransition("Downloading","StartPausing","Pausing"),this.stateMachine.addTransition("Pending","StartPausing","Pausing"),this.stateMachine.addTransition("Pausing","FinishPausing","Paused"),this.stateMachine.onEnterState("Pausing",freeOnUnref(function(){return r.pausingTransition()})),this.stateMachine.onEnterState("Paused",freeOnUnref(function(){return r.completeTransition("Paused")})),this.stateMachine.addTransition("Completed","StartDeleting","Deleting"),this.stateMachine.addTransition("Disabled","StartDeleting","Deleting"),this.stateMachine.addTransition("DisabledCompleted","StartDeleting","Deleting"),this.stateMachine.addTransition("Downloading","StartDeleting","Deleting"),this.stateMachine.addTransition("Error","StartDeleting","Deleting"),this.stateMachine.addTransition("Paused","StartDeleting","Deleting"),this.stateMachine.addTransition("Pausing","StartDeleting","Deleting"),this.stateMachine.addTransition("Pending","StartDeleting","Deleting"),this.stateMachine.addTransition("Deleting","FinishDeleting","Deleted"),this.stateMachine.onTransition("Disabled","StartDeleting",this.cancelingTransition),this.stateMachine.onTransition("Downloading","StartDeleting",this.cancelingTransition),this.stateMachine.onTransition("Paused","StartDeleting",this.cancelingTransition),this.stateMachine.onTransition("Pausing","StartDeleting",this.cancelingTransition),this.stateMachine.onEnterState("Deleting",freeOnUnref(function(){return r.deletingTransition()})),this.stateMachine.onEnterState("Deleted",freeOnUnref(function(){return r.completeTransition("Deleted",!1)})),this.stateMachine.addTransition("Downloading","Reset","Pending"),this.stateMachine.onTransition("Downloading","Reset",freeOnUnref(function(){return r.resetTransition()})),this.stateMachine.addTransition("Error","Retry","Retrying"),this.stateMachine.onEnterState("Retrying",freeOnUnref(function(){return r.retryTransition()})),this.stateMachine.addTransition("Retrying","Error","Error"),this.stateMachine.addTransition("Pending","Start","Downloading"),this.stateMachine.addTransition("Paused","Start","Downloading"),this.stateMachine.addTransition("Retrying","Start","Downloading"),this.stateMachine.onEnterState("Downloading",freeOnUnref(function(){return r.startDownload()})),this.stateMachine.addTransition("Downloading","Complete","Completed"),this.stateMachine.onEnterState("Completed",freeOnUnref(function(){return r.processStateChange("Completed")})),this.stateMachine.onTransition("Downloading","Complete",freeOnUnref(function(){q.metrics.putMetric("Download.Completed")})),this.stateMachine.addTransition("Pending","Error","Error"),this.stateMachine.addTransition("Downloading","Error","Error"),this.stateMachine.addTransition("Pausing","Error","Error"),this.stateMachine.addTransition("Deleting","Error","Error"),this.stateMachine.addTransition("Disabled","Error","Error"),this.stateMachine.addTransition("DisabledCompleted","Error","Error"),this.stateMachine.addTransition("Error","Error","Error"),this.stateMachine.onEnterState("Error",this.onEnterErrorState),this.stateMachine.onLeaveState("Error",this.onLeaveErrorState),this.stateMachine.onTransition("Pending","Error",this.errorTransition),this.stateMachine.onTransition("Downloading","Error",this.errorTransition),this.stateMachine.onTransition("Pausing","Error",this.errorTransition),this.stateMachine.onTransition("Deleting","Error",this.errorTransition),this.stateMachine.onTransition("Disabled","Error",this.errorTransition),this.stateMachine.onTransition("DisabledCompleted","Error",this.errorTransition),this.stateMachine.onTransition("Retrying","Error",this.errorTransition),this.stateMachine.onTransition("Error","Error",freeOnUnref(function(e){g.error("Received download error while already in error state",e)})),this.stateMachine.onIllegalTransition(freeOnUnref(function(e,t,n){g.error("IllegalTransitionError for download "+r.id+', action "'+t+'" while in state "'+e+'".')}));for(var t=((e={}).Completed=!0,e.Deleted=!0,e.Disabled=!0,e.DisabledCompleted=!0,e.Downloading=!0,e.Error=!0,e.Paused=!0,e.Pending=!0,e),n=freeOnUnref(function(e){i.stateMachine.onEnterState(e,freeOnUnref(function(){return r.onReportableStateChange(e)}))}),i=this,o=0,a=x.keys(t);o<a.length;o++){n(a[o])}this.stateMachine.onUncaughtException(freeOnUnref(function(e){g.error("<< Unhandled exception: ",e),r.stateMachine.actNow("Error",e)}))}),e.prototype.internalPause=freeOnUnref(function(){var e,t=this;return g.info(">> internalPause: "+this.id),null!=this.licenseAcquirer&&this.deregisterLicenseAcquisitionReporterCallbacks(this.licenseAcquirer),this.stopListeningToDownloadProgressOnNextEvent(),(e=this.startDownloadPromise.catch(freeOnUnref(function(e){if(!(e instanceof lt.CancelError))throw e}))).then.apply(e,lt.FINALLY(freeOnUnref(function(){return t.cleanupContentDownloaders()})))}),e.prototype.cleanupContentDownloaders=freeOnUnref(function(){if(null!=this.contentDownloaderSource&&this.contentDownloaderSource.stop(),null!=this.contentDownloaderFragment){this.contentDownloaderFragment.off("Completed",this.downloadCompletedTransition),this.contentDownloaderFragment.off("Error",this.onError),this.contentDownloaderFragment.off("DownloadableTracksAvailable",this.onTracksAvailable);var e=this.contentDownloaderFragment.stop();return this.contentDownloaderFragment=null,e}return lt.Promise.resolve()}),e.prototype.startDownload=freeOnUnref(function(){var t=this;this.processStateChange("Downloading");var e=lt.CancelToken.source(),n=e.token,r=e.cancel;return this.cancelCurrentOperation=r,this.startDownloadPromise=this.startDownloadPromise.then(freeOnUnref(function(){if(n.throwIfRequested(),!t.isHeld)return t.createContentDownloaderFragment(n).then(freeOnUnref(function(e){return n.throwIfRequested(),null!=t.contentDownloaderFragment&&t.contentDownloaderFragment.getDownloadProgress().offUpdate(t.onDownloadProgress),t.contentDownloaderFragment=e,t.contentDownloaderFragment.getDownloadProgress().onUpdate(t.onDownloadProgress),t.contentDownloaderFragment.on("Completed",t.downloadCompletedTransition),t.contentDownloaderFragment.on("Error",t.onError),t.contentDownloaderFragment.on("DownloadableTracksAvailable",t.onTracksAvailable),lt.Promise.all([e.start(),t.downloadStaticTimedText(),t.getSectionsAcquirer.acquire(t.id,t.contentConfig.titleId)])})).then(freeOnUnref(function(){}))})).catch(freeOnUnref(function(e){return t.onError(e)})),this.startDownloadPromise}),e.prototype.createContentDownloaderFragment=freeOnUnref(function(m){var y=this;return this.playbackResourceAcquirer.acquire(this.id,this.contentConfig,m).then(freeOnUnref(function(e){m.throwIfRequested();var t=e.prsResponse.playbackUrls;g.info("Default URL SET ID: "+t.defaultUrlSetId);var i=y.licenseAcquirer=new Hf.LicenseAcquirerV1(y.prsClient,e.baseBuilder);y.registerLicenseAcquisitionReporterCallbacks(y.licenseAcquirer),y.mediaKeysManager.on("licenseLoaded",y.licenseConsumptionTracker.setExpiration);for(var n=[],r=0,o=y.audioStreamMatchers;r<o.length;r++){var a=o[r],s=$O.StreamMatcherTransformer.expandMatcherLanguages(a).map(freeOnUnref(function(e){return $O.StreamMatcherTransformer.convertStreamMatcherToTypeMatcher("Audio",e)}));n.push(s)}if(y.metadata=e.prsResponse.catalogMetadata,null==y.bookmarkPositionMs&&null!=e.prsResponse.whisperSyncBookmark){var l=e.prsResponse.whisperSyncBookmark.timecodeSec;y.bookmarkPositionMs=0<l?1e3*l:l}var f=Ef.SubtitleUrlTransformer.transformV1TimedTextUrls(e.prsResponse.subtitleUrls),u=Ef.SubtitleUrlTransformer.transformV1TimedTextUrls(e.prsResponse.forcedNarratives);y.staticTimedTextStreams=Ef.SubtitleUrlTransformer.toTimedTextStreams(y.contentConfig.titleId,f,u),null==y.timedTextStreamMatchers&&(y.timedTextStreamMatchers=y.buildTimedTextStreamMatchersFromStreams(y.staticTimedTextStreams));for(var c=[],d=0,p=y.timedTextStreamMatchers;d<p.length;d++){var h=p[d];s=$O.StreamMatcherTransformer.expandMatcherLanguages(h).map(freeOnUnref(function(e){return $O.StreamMatcherTransformer.convertStreamMatcherToTypeMatcher("TimedText",e)}));c.push(s)}return null==y.contentDownloaderSource&&(y.contentDownloaderSource=new ZO.PlaybackUrlsContentDownloaderSource(y.contentConfig,y.id,freeOnUnref(function(e,t,n){var r=i.acquireLicense(e,t,n);return r.then(freeOnUnref(function(e){y.licenseConsumptionTracker.setLicenseInformation(e)})),r}),y.mediaKeysManager,t,y.maxVideoBitrateBitPerSec,n,c),q.metrics.putMetric("Download.Started")),y.contentDownloaderSource.start()}))}),e.prototype.completeTransition=freeOnUnref(function(e,t){void 0===t&&(t=!0),t?this.processStateChange(e):this.emitStateChange(e)}),e.prototype.deletingTransition=freeOnUnref(function(){var t=this;this.processStateChange("Deleting"),this.internalPause().then(freeOnUnref(function(){return t.deleteContent()})).then(freeOnUnref(function(){return t.stateMachine.actNow("FinishDeleting")})).catch(freeOnUnref(function(e){return t.onError(e)}))}),e.prototype.deleteContent=freeOnUnref(function(){var e=this;return Ef.StaticTimedTextDataStore.deleteContentsFromStorage(this.id).then(freeOnUnref(function(){return yd.ContentDownloaderFragment.delete(e.id)})).then(freeOnUnref(function(){return ih.DashMediaRepresentationSource.delete(e.id)})).then(freeOnUnref(function(){return e.playbackResourceAcquirer.remove(e.id)})).then(freeOnUnref(function(){return e.getSectionsAcquirer.remove(e.id)})).then(freeOnUnref(function(){return Jo.metadataStorage.remove(e.downloadOperationMetadataKey)}))}),e.prototype.onDisabled=freeOnUnref(function(e){var t=this;this.processStateChange(e),this.internalPause().catch(freeOnUnref(function(e){return t.onError(e)}))}),e.prototype.pausingTransition=freeOnUnref(function(){var t=this;this.processStateChange("Pausing"),this.internalPause().then(freeOnUnref(function(){return t.stateMachine.actNow("FinishPausing")})).catch(freeOnUnref(function(e){return t.onError(e)}))}),e.prototype.retryTransition=freeOnUnref(function(){var t=this;g.info(">> retryTransition "+this.id),this.internalPause().then(freeOnUnref(function(){return t.deleteContent()})).then(freeOnUnref(function(){t.stateMachine.actNow("Start")})).catch(freeOnUnref(function(e){g.error("<< retryTransition "+t.id+", error "+e),t.onError(e)}))}),e.prototype.resetTransition=freeOnUnref(function(){var t=this;this.completeTransition("Pending"),this.internalPause().catch(freeOnUnref(function(e){g.error("<< reset error",e),t.onError(e)}))}),e.prototype.createDownloadOperationMetadata=freeOnUnref(function(e){if(null==this.contentConfig||null==this.maxVideoBitrateBitPerSec||null==this.audioStreamMatchers)throw new ct.XpError("downloader.invalid_state",void 0,"Download operation has missing metadata attributes for storage.");return{audioStreamMatchers:this.audioStreamMatchers,downloadErrorCode:null!=this.downloadError?this.downloadError.code:null,contentConfig:this.contentConfig,maxVideoBitrateBitPerSec:this.maxVideoBitrateBitPerSec,state:e,timedTextStreamMatchers:this.timedTextStreamMatchers,localContentSize:this.localContentSize,bookmarkPositionMs:this.bookmarkPositionMs}}),e.prototype.downloadStaticTimedText=freeOnUnref(function(){if(null==this.timedTextStreamMatchers)return lt.Promise.resolve();for(var e={},t=[],n=0,r=this.timedTextStreamMatchers;n<r.length;n++){var i=r[n],o=this.findMatchingStaticTimedTextStream(i);null!=o&&!0!==e[o.id]&&(e[o.id]=!0,t.push(this.staticTimedTextDataStore.storeContents(this.id,o)))}return lt.Promise.all(t).then(freeOnUnref(function(){}))}),e.prototype.findMatchingStaticTimedTextStream=freeOnUnref(function(e){for(var t=0,n=e;t<n.length;t++)for(var r=n[t],i=0,o=this.staticTimedTextStreams;i<o.length;i++){var a=o[i];if(Jl.isMatch(a,r))return a}return null}),e.prototype.buildTimedTextStreamMatchersFromStreams=freeOnUnref(function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n],o={};null!=i.language&&(o.language=i.language),null!=i.subtype&&(o.subtype=i.subtype),null!=i.type&&(o.type=i.type),t.push([o])}return t}),e.prototype.registerLicenseAcquisitionReporterCallbacks=freeOnUnref(function(e){e.on("licenseAcquired",this.reportLicenseAcquisitionSuccess),e.on("licenseAcquisitionFailed",this.reportLicenseAcquisitionFailure)}),e.prototype.deregisterLicenseAcquisitionReporterCallbacks=freeOnUnref(function(e){e.off("licenseAcquired",this.reportLicenseAcquisitionSuccess),e.off("licenseAcquisitionFailed",this.reportLicenseAcquisitionFailure)}),e.prototype.emitStateChange=freeOnUnref(function(e){g.info("Emitting state change for "+this.id+" to: "+e);var t={downloadOperationId:this.id,downloadOperationState:YO.INTERNAL_DOWNLOAD_OPERATION_STATE_TO_PUBLIC_STATE_MAP[e]};this.eventEmitter.emit("DownloadStateChange",t)}),e.prototype.stopListeningToDownloadProgressOnNextEvent=freeOnUnref(function(){var t=this;if(null!=this.contentDownloaderFragment){var n=this.contentDownloaderFragment.getDownloadProgress(),r=freeOnUnref(function(e){n.offUpdate(t.onDownloadProgress),n.offUpdate(r)});n.onUpdate(r)}}),e.prototype.onReportableStateChange=freeOnUnref(function(e){this.reportDownloadEvent(YO.INTERNAL_DOWNLOAD_OPERATION_STATE_TO_DOWNLOAD_REPORT_ACTION[e])}),e.prototype.reportDownloadEvent=freeOnUnref(function(e){var t=0;if(null!=this.contentDownloaderFragment){var n=this.contentDownloaderFragment.getDownloadProgress(),r=n.downloadedBytes(),i=n.estimatedTotalBytes();0!==i&&(t=Math.round(100*r/i))}this.mediaEventController.reportDownload(e,t,["Audio","DRMLicense","Manifest","TimedText","Video"],null!=this.contentDownloaderSource?this.contentDownloaderSource.getCurrentConsumptionId():void 0)}),e.prototype.updateDownloadOperationMetadata=freeOnUnref(function(e){return Jo.metadataStorage.put(this.downloadOperationMetadataKey,this.createDownloadOperationMetadata(e))}),e})();t.DownloadOperation=n}));e(eS);eS.DownloadOperation;var tS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.validate=freeOnUnref(function(e){var t="Malformed DownloadOperationQueue metadata";if(!Array.isArray(e))throw new ct.XpError("metadata.malformed",void 0,t);var n=e;if(0<n.length&&"string"!=typeof n[0])throw t+=", not strings",new ct.XpError("metadata.malformed",void 0,t)}),e})();t.DownloadOperationQueueMetadataValidator=n}));e(tS);tS.DownloadOperationQueueMetadataValidator;var nS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=yr.createCDPResponseProcessor(freeOnUnref(function(e,t,n,r){var i=Qe.nestedValue(e,"sections.bottom.collections.collectionList.0.items.itemList.0"),o=Qe.nestedValue(e,"sections.bottom.collections.collectionList.0.autoplayConfig");if(null!=o&&null!=i){var a={autoplayEnabled:!0===o.autoplayEnabled,numTitlesToAutoplay:o.numTitlesToAutoplay,preferredImageName:o.autoplayCardPreferredImage,showAutoplayCard:!0===o.showAutoplayCard,titleId:i.titleId},s=i.metadata;null!=s&&(a.recommendationStrategy=Qe.withDefault(x.find(Object.keys(s),freeOnUnref(function(e){return 0===e.indexOf("source.")})),void 0),a.inSameSeries="source.OtherEpisodes"===a.recommendationStrategy),t(a)}else t(null)})),r=freeOnUnref(function(){function e(e){this.serviceClient=e.createServiceClient("/cdp/discovery/GetSections",{firmware:"1"},n,"getsections")}return e.prototype.send=freeOnUnref(function(e,t){var n={accept:"application/json"};Qe.sanitize(n,!0);var r={method:"GET",timeoutMs:4e3,headers:n,queryParams:{decorationScheme:"none",pageType:"player",sectionTypes:"bottom",version:"default",format:"json",pageId:e}};return this.serviceClient.send(r,t,"CRITICAL")}),e})();t.GetSectionsClient=r}));e(nS);nS.GetSectionsClient;var rS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GetSectionsClient=nS.GetSectionsClient}));e(rS);rS.GetSectionsClient;var iS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("GetSectionsAcquirer"),n=freeOnUnref(function(){function e(e){this.getSectionsClient=new rS.GetSectionsClient(e)}return e.prototype.acquire=freeOnUnref(function(t,e){var n=lt.CancelToken.source(),r=n.token;n.cancel;return this.getSectionsClient.send(e,r).then(freeOnUnref(function(e){return e.on("latency",freeOnUnref(function(e){q.metrics.putMetric("ServiceRequest.GetSections.RequestLatencyTime",e,"ms")})),e.response()})).catch(freeOnUnref(function(e){return r.throwIfRequested(),i.error("GetSections request failed",e),q.metrics.putMetric("ServiceRequest.GetSections.Error"),null})).then(freeOnUnref(function(e){if(r.throwIfRequested(),null!=e)return Jo.metadataStorage.put(QO.createGetSectionsResponseKey(t),e)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||i.error("GetSectionsAcquirer failed",e)}))}),e.prototype.remove=freeOnUnref(function(e){return Jo.metadataStorage.remove(QO.createGetSectionsResponseKey(e))}),e})();t.GetSectionsAcquirer=n}));e(iS);iS.GetSectionsAcquirer;var oS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("PRSResponseHandler");var f=["DASH"];t.validatePRSResponse=function(e){var t=(new Pr.PRSResponseValidator).validateResponse(e);if(null!=t)throw t;if(null!=(t=function(e){var t=e.urlSets,n=e.defaultUrlSetId,r=t[n].urls.manifest.streamingTechnology;if(!x.includes(f,r))return new Error("PRS response contains unsupported "+r+" Url Sets");for(var i=0,o=Object.keys(t);i<o.length;i++){var a=o[i],s=t[a],l=s.urls.manifest.streamingTechnology;if(l!==r)return new Error("PRS response contains "+l+" streaming technology, which is different from the default ("+r+")")}return null}(e.playbackUrls)))throw t}}));e(oS);oS.validatePRSResponse;var aS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("PlaybackResourceAcquirer"),n=freeOnUnref(function(){function e(e,t){this.prsClient=e,this.clientPrsParameters=t}return e.prototype.acquire=freeOnUnref(function(r,i,o){var n=this,e=new Hf.PlaybackResourceRequestBuilderFactory,a=null;return e.createDeviceCompliantBuilder(null,o).then(freeOnUnref(function(e){o.throwIfRequested();var t=i.titleId,n=i.videoMaterialType;return a=e.content(t,n,"Download"),Hf.PlaybackUrlsOptionsFactory.create()})).then(freeOnUnref(function(e){o.throwIfRequested();var t=a.clone().resource(Pr.PlaybackResource.PlaybackUrls(e)).resource(Pr.PlaybackResource.CatalogMetadata(n.clientPrsParameters.titleDecorationScheme)).resource(Pr.PlaybackResource.SubtitleUrls("TTMLv2")).resource(Pr.PlaybackResource.ForcedNarratives()).resource(Pr.PlaybackResource.TrickplayUrls()).resource(Pr.PlaybackResource.TransitionTimecodes()).resource(Pr.PlaybackResource.PlaybackSettings("1.0.0")).resource(Pr.PlaybackResource.WhisperSyncBookmark());return null!=i.site&&t.sitePageUrl(i.site.page),n.prsClient.send(t.build("ImmediateConsumption"),o)})).then(freeOnUnref(function(e){return o.throwIfRequested(),e.on("latency",freeOnUnref(function(e){q.metrics.putMetric("ServiceRequest.PRS.Download.PrimaryResources.RequestLatencyTime",e,"ms")})),lt.Promise.all([e.response(),n.getCurrentCachedPRSResponse(o,r)])})).catch(freeOnUnref(function(e){throw o.throwIfRequested(),q.metrics.putMetric("ServiceRequest.PRS.Download.PrimaryResources.Error"),e})).then(freeOnUnref(function(e){var t=e[0],n=e[1];return o.throwIfRequested(),oS.validatePRSResponse(t),null!=n&&null!=n.playbackUrls.cacheKey&&n.playbackUrls.cacheKey!==t.playbackUrls.cacheKey&&s.warn("Cache key is different between cached PRS Response and recently acquired PRS Response"),Jo.metadataStorage.put(QO.createPlaybackResourceResponseKey(r),t).then(freeOnUnref(function(){return o.throwIfRequested(),{baseBuilder:a,prsResponse:t}}))}))}),e.prototype.remove=freeOnUnref(function(e){return Jo.metadataStorage.remove(QO.createPlaybackResourceResponseKey(e))}),e.prototype.getCurrentCachedPRSResponse=freeOnUnref(function(t,e){return Jo.metadataStorage.get(QO.createPlaybackResourceResponseKey(e)).catch(freeOnUnref(function(e){return s.error("Acquiring PRSResponse from MetadataStorage resulted in error: "+e),null})).then(freeOnUnref(function(e){return t.throwIfRequested(),e}))}),e})();t.PlaybackResourceAcquirer=n}));e(aS);aS.PlaybackResourceAcquirer;var sS=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={"downloader.operation_not_found":Ni.codes.xp.download.operation_not_found,"drm.unexpected_key_system":"downloader.drm.unexpected_key_system","download.drm.license.prs.no_rights":Ni.codes.xp.download.drm.license.no_rights})["drm_service.hd_content_not_allowed"]=Ni.codes.xp.content.no_rights.hd_content_not_allowed,n["drm_service.uhd_content_not_allowed"]=Ni.codes.xp.content.no_rights.uhd_content_not_allowed,n["drm_service.license_denied"]="downloader.drm.license_denied",n["prs.no_rights.anonymizer_ip"]=Ni.codes.xp.content.no_rights.anonymizer_ip,n["prs.no_rights.consent_expired"]=Ni.codes.xp.content.no_rights.consent_expired,n["prs.no_rights.download_limit_exceeded"]=Ni.codes.xp.content.no_rights.download_limit_exceeded,n["prs.no_rights.invalid_geo_ip"]=Ni.codes.xp.content.no_rights.invalid_geo_ip,n["prs.no_rights.no_available_streams"]=Ni.codes.xp.content.no_rights.no_available_streams,n["prs.no_rights.not_accepted_terms"]=Ni.codes.xp.content.no_rights.not_accepted_terms_and_conditions,n["prs.no_rights.not_owned"]=Ni.codes.xp.content.no_rights.not_owned,n["prs.no_rights.pv_lower_tier_device_not_permitted_access"]=Ni.codes.xp.content.no_rights.pv_lower_tier_device_not_permitted_access,n["prs.no_rights"]=Ni.codes.xp.content.no_rights.unknown,n["prs.hd_content_not_allowed"]=Ni.codes.xp.content.no_rights.hd_content_not_allowed,n["prs.unsupported_cdm_version"]=Ni.codes.xp.system.unsupported_cdm_version,n),i=freeOnUnref(function(){function e(){}return e.convertCode=freeOnUnref(function(e){if(e instanceof ct.XpError){if(x.contains(Ni.allCodes,e.code))return e;var t=r[e.code];if(null!=t)return new ct.XpError(t)}return new ct.XpError(Ni.codes.xp.unknown,void 0,void 0,void 0,e)}),e})();t.InternalToExternalCodeConverter=i}));e(sS);sS.InternalToExternalCodeConverter;var lS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="download_operation_queue",c=de.get("DownloadOperationQueue");var r=freeOnUnref(function(){function e(e,t,n,r,i){var o=this;this.downloadOperations=[],this.pendingRefreshOperations=[],this.refreshInProgressId=null,this.maxDownloadingOperations=1,this.isHeld=!1,this.holdReleaseSerializerPromise=lt.Promise.resolve(),this.queueState="Uninitialized",this.queueStoragePromise=lt.Promise.resolve(),this.onDownloadOperationStateChange=freeOnUnref(function(e){var t=o.findDownloadOperation(e.downloadOperationId);null!=t?("Completed"===e.downloadOperationState||"Error"===e.downloadOperationState?o.tryStartNextPending():"Deleted"===e.downloadOperationState&&(o.removeDownloadListeners(t),o.downloadOperations=o.downloadOperations.filter(freeOnUnref(function(e){return e.id!==t.id})),o.storeQueue()),o.localContentManagerEventEmitter.emit("DownloadStateChange",e)):c.warn("Unexpected behavior: untracked download operation "+e.downloadOperationId+" is changing state")}),this.onDownloadOperationProgress=freeOnUnref(function(e){null!=o.findDownloadOperation(e.downloadOperationId)?o.localContentManagerEventEmitter.emit("DownloadProgress",e):c.warn("Unexpected behavior: untracked download operation "+e.downloadOperationId+" is updating progress")}),this.onDownloadOperationError=freeOnUnref(function(e){o.localContentManagerEventEmitter.emit("DownloadError",{downloadOperationId:e.downloadOperationId,error:sS.InternalToExternalCodeConverter.convertCode(e.error)})}),this.onDownloadOperationRefreshing=freeOnUnref(function(e){o.localContentManagerEventEmitter.emit("Refreshing",e)}),this.onDownloadOperationRefreshed=freeOnUnref(function(e){o.localContentManagerEventEmitter.emit("Refreshed",e),o.startNextRefresh(e.downloadOperationId)}),this.onDownloadOperationRefreshError=freeOnUnref(function(e){o.localContentManagerEventEmitter.emit("RefreshError",e),o.startNextRefresh(e.downloadOperationId)}),this.startNextRefresh=freeOnUnref(function(e){e!==o.refreshInProgressId&&c.warn("Download Refreshed: Expected completedRefreshId "+e+" to match refreshInProgressId: "+o.refreshInProgressId);var t=o.pendingRefreshOperations.shift();if(null!=t){var n=t.downloadOperation;c.info("Setting pending refresh for "+n.id+" to start in 5000ms because refresh for "+e+" has completed, remaining refreshes: "+o.pendingRefreshOperations.length),o.refreshInProgressId=n.id,oe.timer.setTimeout(freeOnUnref(function(){n.refresh().then(freeOnUnref(function(){return t.refreshDeferred.resolve()}))}),5e3)}else o.refreshInProgressId=null}),this.onTracksAvailable=freeOnUnref(function(e){o.localContentManagerEventEmitter.emit("TracksAvailable",e)}),this.localContentManagerEventEmitter=t,this.mediaEventController=n;var a,s,l,f,u=new ea.HdcpStore(!1);this.mediaKeysManager=new ea.MediaKeysManager(u),this.prsClient=new Pr.PlaybackResourceClient(r,(null!=(a=e).applicationIdentity?(s=a.applicationIdentity.name,l=a.applicationIdentity.bundle,f=a.applicationIdentity.storeUrl):null!=zt.deviceInformation.software&&null!=zt.deviceInformation.software.nativeApplication&&(s=zt.deviceInformation.software.nativeApplication.name),{appBundleId:l,appStoreUrl:f,deviceApplicationName:s})),this.playbackResourceAcquirer=new aS.PlaybackResourceAcquirer(this.prsClient,e),this.staticTimedTextDataStore=new Ef.StaticTimedTextDataStore,this.getSectionsAcquirer=new iS.GetSectionsAcquirer(r),this.clientId=i,yd.ContentDownloaderFragment.mediaKeysManager=this.mediaKeysManager}return e.prototype.initialize=freeOnUnref(function(){var s=this;if(c.info(">> initialize"),"Uninitialized"!==this.queueState){var e="Download operation queue already initialized or is initializing";return c.error(e),lt.Promise.reject(new ct.XpError("downloader.initialization.invalid_state",void 0,e,!0))}return this.queueState="Initializing",Jo.metadataStorage.get(n).then(freeOnUnref(function(e){if(c.info(">>> Retrieved queue metadata from storage. Metadata:",JSON.stringify(e)),null==e)return lt.Promise.resolve([]);(new tS.DownloadOperationQueueMetadataValidator).validate(e);var t=e.map(freeOnUnref(function(t){var e=new eS.DownloadOperation(t,s.getSectionsAcquirer,s.mediaEventController,s.mediaKeysManager,s.isHeld,s.playbackResourceAcquirer,s.prsClient,s.staticTimedTextDataStore);return e.initialize().then(freeOnUnref(function(){return e})).catch(freeOnUnref(function(e){return c.info("Download operation "+t+" could not be initialized due to error: "+e),null}))}));return lt.Promise.all(t)})).then(freeOnUnref(function(e){for(var t=[],n=0,r=0,i=e;r<i.length;r++){var o=i[r];if(null!=o){var a=o.downloadOperationState;"Deleted"!==a?("Downloading"===a||"Retrying"===a?n++:"Pending"===a&&t.push(o),s.attachDownloadListeners(o),s.downloadOperations.push(o)):c.warn("Unexpected persistent download operation "+o.id+" state "+o.downloadOperationState+", Ignored.")}}for(;0<t.length&&n<s.maxDownloadingOperations;)t.shift().start(),n++;s.queueState="Initialized",c.info("<< initialize succeed, current queue size:",s.downloadOperations.length)})).catch(freeOnUnref(function(e){throw s.queueState="Uninitialized",c.error("<< initialize fail with error:",e),e instanceof ct.XpError?ct.XpError.generatePrefixedError(e,"downloader.initialization"):new ct.XpError("downloader.initialization",void 0,"Fail to initialize",!0,e)}))}),e.prototype.register=freeOnUnref(function(e,i,o,a){for(var s=this,l=[],t=freeOnUnref(function(e){null==e.clientId&&(e.clientId=f.clientId),c.info(">> register. (contentConfig:"+JSON.stringify(e)+", maxVideoBitrateBitsPerSec:"+i+")");var t=e.titleId+"_"+e.videoMaterialType,n=f.findDownloadOperation(t);if(null!=n)return c.warn("DownloadOperation "+t+" already exists. Don't create duplication."),l.push(n),"continue";var r=new eS.DownloadOperation(t,f.getSectionsAcquirer,f.mediaEventController,f.mediaKeysManager,f.isHeld,f.playbackResourceAcquirer,f.prsClient,f.staticTimedTextDataStore,e,i,o,a);f.mediaEventController.reportDownload("Queue",0,[]),f.attachDownloadListeners(r),f.downloadOperations.push(r),r.initialize().then(freeOnUnref(function(){return s.tryStartNextPending()})).catch(freeOnUnref(function(e){c.error("Fail to start newly created download operation "+t,e)})),f.storeQueue(),l.push(r)}),f=this,n=0,r=e;n<r.length;n++){t(r[n])}return l}),e.prototype.refresh=freeOnUnref(function(e){var t=this.findDownloadOperation(e);if(null==t)return lt.Promise.reject(new ct.XpError("downloader.operation_not_found"));if(null!=this.refreshInProgressId){c.info("Deferring refresh for "+e+" as "+this.refreshInProgressId+" is in progress");var n=new lt.Deferred,r={downloadOperation:t,refreshDeferred:n};return this.pendingRefreshOperations.push(r),n.promise}return this.refreshInProgressId=e,t.refresh()}),e.prototype.resume=freeOnUnref(function(e){var t=this.findDownloadOperation(e);return null==t?lt.Promise.reject(new ct.XpError("downloader.operation_not_found")):("Paused"!==t.downloadOperationState?c.info("Attempted to resume download operation "+e+", but it was in "+t.downloadOperationState+" state."):(this.setActiveDownloadToPending(),t.start()),lt.Promise.resolve())}),e.prototype.retry=freeOnUnref(function(e){var t=this.findDownloadOperation(e);return null==t?lt.Promise.reject(new ct.XpError("downloader.operation_not_found")):("Error"!==t.downloadOperationState?c.info("Attempted to retry download operation "+e+", but it was in "+t.downloadOperationState+" state."):(this.setActiveDownloadToPending(),t.retry()),lt.Promise.resolve())}),e.prototype.pause=freeOnUnref(function(e){var t=this.findDownloadOperation(e);return null==t?lt.Promise.reject(new ct.XpError("downloader.operation_not_found",void 0,"Download operation not found")):(t.pause(),this.tryStartNextPending(),lt.Promise.resolve())}),e.prototype.enable=freeOnUnref(function(e){var t=this.findDownloadOperation(e);return null==t?lt.Promise.reject(new ct.XpError("downloader.operation_not_found")):(t.enable(),lt.Promise.resolve())}),e.prototype.disable=freeOnUnref(function(e){var t=this.findDownloadOperation(e);return null==t?lt.Promise.reject(new ct.XpError("downloader.operation_not_found")):(t.disable(),this.tryStartNextPending(),lt.Promise.resolve())}),e.prototype.remove=freeOnUnref(function(e){var t=this.findDownloadOperation(e);return null==t?c.warn(">>> Download operation "+e+" doesn't exist, ignore remove call."):(t.remove(),this.tryStartNextPending()),lt.Promise.resolve()}),e.prototype.getAllDownloadOperations=freeOnUnref(function(){for(var e=[],t=[],n=[],r=[],i=0,o=this.downloadOperations;i<o.length;i++){var a=o[i];switch(a.downloadOperationState){case"Deleted":break;case"Downloading":e.push(a);break;case"Pending":t.push(a);break;case"Completed":case"DisabledCompleted":r.push(a);break;default:n.push(a)}}return e.concat(t,n,r)}),e.prototype.getCurrentDownloadOperation=freeOnUnref(function(){var e=x.find(this.downloadOperations,freeOnUnref(function(e){return"Downloading"===e.downloadOperationState}));return lt.Promise.resolve(null!=e?e:null)}),e.prototype.hold=freeOnUnref(function(){if(this.isHeld)return this.holdReleaseSerializerPromise;c.info(">> hold"),this.isHeld=!0;var e=this.downloadOperations.map(freeOnUnref(function(t){return t.hold().catch(freeOnUnref(function(e){return c.error("Failed to hold "+t.id+":",e)}))}));return this.holdReleaseSerializerPromise=this.holdReleaseSerializerPromise.then(freeOnUnref(function(){return lt.Promise.all(e).then(freeOnUnref(function(){}))}))}),e.prototype.release=freeOnUnref(function(){if(!this.isHeld)return lt.Promise.resolve();this.isHeld=!1,c.info(">> release");var e=this.downloadOperations.map(freeOnUnref(function(t){return t.release().catch(freeOnUnref(function(e){return c.error("Failed to release "+t.id+":",e)}))}));return this.holdReleaseSerializerPromise=this.holdReleaseSerializerPromise.then(freeOnUnref(function(){return lt.Promise.all(e).then(freeOnUnref(function(){}))}))}),e.prototype.findDownloadOperation=freeOnUnref(function(t){return x.find(this.downloadOperations,freeOnUnref(function(e){return e.id===t}))}),e.prototype.tryStartNextPending=freeOnUnref(function(){for(var e=0,t=null,n=0,r=this.downloadOperations;n<r.length;n++){var i=r[n];"Pending"===i.downloadOperationState&&null==t?t=i:"Downloading"!==i.downloadOperationState&&"Retrying"!==i.downloadOperationState||e++}null!=t&&e<this.maxDownloadingOperations&&t.start()}),e.prototype.storeQueue=freeOnUnref(function(){var t=this;return this.queueStoragePromise=this.queueStoragePromise.then(freeOnUnref(function(){var e=t.downloadOperations.map(freeOnUnref(function(e){return e.id}));return Jo.metadataStorage.put(n,e)})).catch(freeOnUnref(function(e){c.error("Metadata storage failed. Ignore the error and continue: "+e)})),this.queueStoragePromise}),e.prototype.attachDownloadListeners=freeOnUnref(function(e){e.on("DownloadProgress",this.onDownloadOperationProgress),e.on("TracksAvailable",this.onTracksAvailable),e.on("DownloadStateChange",this.onDownloadOperationStateChange),e.on("DownloadError",this.onDownloadOperationError),e.on("Refreshing",this.onDownloadOperationRefreshing),e.on("Refreshed",this.onDownloadOperationRefreshed),e.on("RefreshError",this.onDownloadOperationRefreshError)}),e.prototype.removeDownloadListeners=freeOnUnref(function(e){e.off("DownloadProgress",this.onDownloadOperationProgress),e.off("TracksAvailable",this.onTracksAvailable),e.off("DownloadStateChange",this.onDownloadOperationStateChange),e.off("DownloadError",this.onDownloadOperationError),e.off("Refreshing",this.onDownloadOperationRefreshing),e.off("Refreshed",this.onDownloadOperationRefreshed),e.off("RefreshError",this.onDownloadOperationRefreshError)}),e.prototype.setActiveDownloadToPending=freeOnUnref(function(){var e=x.find(this.downloadOperations,freeOnUnref(function(e){return"Downloading"===e.downloadOperationState}));null!=e&&e.reset()}),e})();t.DownloadOperationQueue=r}));e(lS);lS.DownloadOperationQueue;var fS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function i(){}return i.transformToPublicDownloadOperation=freeOnUnref(function(e){if("Completed"===e.downloadOperationState)return i.transformToPublicLocalContent(e);var t=e.localContentSize;return{id:e.id,contentConfig:e.contentConfig,downloadError:i.transformToPublicError(e.downloadError),downloadedSizeBytes:t.downloadedSizeBytes,downloadState:YO.INTERNAL_DOWNLOAD_OPERATION_STATE_TO_PUBLIC_STATE_MAP[e.downloadOperationState],metadata:e.metadata,needRefresh:e.needRefresh,totalSizeBytes:t.totalSizeBytes,bookmarkPositionMsAtDownload:e.bookmarkPositionMsAtDownload}}),i.transformToPublicLocalContent=freeOnUnref(function(e){var t;t=e.needRefresh?"Refreshing":e.downloadError?"Error":"Ready";var n=e.localContentSize,r=ea.LicenseConsumptionTrackerManager.getInstance().getLicenseConsumptionTracker(e.id);return{id:e.id,contentConfig:e.contentConfig,downloadError:i.transformToPublicError(e.downloadError),downloadedSizeBytes:n.downloadedSizeBytes,downloadState:YO.INTERNAL_DOWNLOAD_OPERATION_STATE_TO_PUBLIC_STATE_MAP[e.downloadOperationState],needRefresh:e.needRefresh,totalSizeBytes:n.totalSizeBytes,licenseInformation:r.licenseInformation,localContentError:e.downloadError,localContentState:t,bookmarkPositionMsAtDownload:e.bookmarkPositionMsAtDownload}}),i.transformToPublicError=freeOnUnref(function(e){return null==e?null:sS.InternalToExternalCodeConverter.convertCode(e)}),i})();t.DownloadOperationTransformer=n}));e(fS);fS.DownloadOperationTransformer;var uS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.isHeld=!1,this.holdChangeCallback=null}return e.prototype.hold=freeOnUnref(function(){this.isHeld||(this.isHeld=!0,null!=this.holdChangeCallback&&this.holdChangeCallback(!0))}),e.prototype.release=freeOnUnref(function(){this.isHeld&&(this.isHeld=!1,null!=this.holdChangeCallback&&this.holdChangeCallback(!1))}),e.prototype.onChange=freeOnUnref(function(e){this.holdChangeCallback=e}),e})();t.BasicHolder=n}));e(uS);uS.BasicHolder;var cS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("NetworkHolder"),r=freeOnUnref(function(){function e(){var t=this;this.onNetworkChange=freeOnUnref(function(e){"none"===e.type?(n.info("Network disconnected, holding NetworkHolder"),t.holder.hold()):(n.info("Network reconnected, releasing NetworkHolder"),t.holder.release())}),this.holder=new uS.BasicHolder,zt.deviceCapabilities.on("network",this.onNetworkChange),this.onNetworkChange(zt.deviceCapabilities.network)}return Object.defineProperty(e.prototype,"isHeld",{get:freeOnUnref(function(){return this.holder.isHeld}),enumerable:!0,configurable:!0}),e.prototype.onChange=freeOnUnref(function(e){this.holder.onChange(e)}),e})();t.NetworkHolder=r}));e(cS);cS.NetworkHolder;var dS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var t=this;this.holdChangeCallback=null,this.onHoldChange=freeOnUnref(function(e){null!=t.holdChangeCallback&&(e?t.holdChangeCallback(!0):t.isHeld||t.holdChangeCallback(!1))}),(this.holders=e).forEach(freeOnUnref(function(e){return e.onChange(t.onHoldChange)}))}return Object.defineProperty(e.prototype,"isHeld",{get:freeOnUnref(function(){return this.holders.some(freeOnUnref(function(e){return e.isHeld}))}),enumerable:!0,configurable:!0}),e.prototype.onChange=freeOnUnref(function(e){this.holdChangeCallback=e}),e})();t.CompositeHolder=n}));e(dS);dS.CompositeHolder;var pS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("DownloadOperationQueueHoldManager"),n=freeOnUnref(function(){function e(e){var t=this;this.onHoldChange=freeOnUnref(function(e){if(e)return r.info("Holding download queue."),void t.downloadOperationQueue.hold();r.info("All holders released, releasing download queue."),t.downloadOperationQueue.release()}),this.downloadOperationQueue=e,this.basicHolder=new uS.BasicHolder;var n=[this.basicHolder,new cS.NetworkHolder];this.compositeHolder=new dS.CompositeHolder(n),this.compositeHolder.onChange(this.onHoldChange),this.onHoldChange(this.isHeld)}return e.prototype.hold=freeOnUnref(function(){this.basicHolder.hold()}),e.prototype.release=freeOnUnref(function(){this.basicHolder.release()}),Object.defineProperty(e.prototype,"isHeld",{get:freeOnUnref(function(){return this.compositeHolder.isHeld}),enumerable:!0,configurable:!0}),e})();t.DownloadOperationQueueHoldManager=n}));e(pS);pS.DownloadOperationQueueHoldManager;var hS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.mediaEventReporter=e}return e.prototype.reportDownload=freeOnUnref(function(e,t,n,r){var i=Tv.DownloadEventFactory.createDownloadEvent(e,t,n,r);this.mediaEventReporter.enqueueMediaEvents([i])}),e})();t.DownloadMediaEventController=n}));e(hS);hS.DownloadMediaEventController;var mS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.mediaEventReporter=e,this.downloadMediaEventController=new hS.DownloadMediaEventController(e)}return e.prototype.reportDownload=freeOnUnref(function(e,t,n,r){this.downloadMediaEventController.reportDownload(e,t,n,r)}),e})();t.MediaEventController=n}));e(mS);mS.MediaEventController;var yS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("XpLocalContentManagerFeature"),n=freeOnUnref(function(){function e(e,t,n){this.version="0.0.1",this.objectId="XpPlayerSDK-Local-Content-Manager-Feature-"+Math.random(),this.eventEmitter=new A.EventEmitter;var r={titleDecorationScheme:t.titleDecorationScheme,applicationIdentity:t.applicationIdentity};this.mediaEventController=new mS.MediaEventController(n),this.queue=new lS.DownloadOperationQueue(r,this.eventEmitter,this.mediaEventController,e,t.clientId),this.holdManager=new pS.DownloadOperationQueueHoldManager(this.queue)}return e.prototype.initialize=freeOnUnref(function(){return this.queue.initialize().catch(freeOnUnref(function(e){throw o.error("Failed to initialize",e),sS.InternalToExternalCodeConverter.convertCode(e)}))}),e.prototype.createDownload=freeOnUnref(function(t,n,r,i){o.info(">> createDownload, contentConfig: "+JSON.stringify(t)+", maxVideoBitrateBitsPerSec: "+n+", audioStreamMatchers: "+JSON.stringify(r)+", timedTextStreamMatchers: "+JSON.stringify(i));try{return this.queue.register(t,n,r,i).map(freeOnUnref(function(e){return fS.DownloadOperationTransformer.transformToPublicDownloadOperation(e)}))}catch(e){throw o.error("Failed to execute createDownload, id: contentConfig: "+JSON.stringify(t)+", maxVideoBitrateBitsPerSec: "+n+", audioStreamMatchers: "+JSON.stringify(r)+", timedTextStreamMatchers: "+JSON.stringify(i),e),sS.InternalToExternalCodeConverter.convertCode(e)}}),e.prototype.hold=freeOnUnref(function(){this.holdManager.hold()}),e.prototype.release=freeOnUnref(function(){this.holdManager.release()}),e.prototype.resume=freeOnUnref(function(e){return o.info(">> resume, id:",e),this.ensureExternalErrors("resume",e,this.queue.resume(e))}),e.prototype.retry=freeOnUnref(function(e){return o.info(">> retry, id:",e),this.ensureExternalErrors("retry",e,this.queue.retry(e))}),e.prototype.pause=freeOnUnref(function(e){return o.info(">> pause, id:",e),this.ensureExternalErrors("pause",e,this.queue.pause(e))}),e.prototype.disable=freeOnUnref(function(e){return o.info(">> disable, id:",e),this.ensureExternalErrors("disable",e,this.queue.disable(e))}),e.prototype.enable=freeOnUnref(function(e){return o.info(">> enable, id:",e),this.ensureExternalErrors("enable",e,this.queue.enable(e))}),e.prototype.refresh=freeOnUnref(function(e){return o.info(">> refresh, id:",e),this.ensureExternalErrors("refresh",e,this.queue.refresh(e))}),e.prototype.remove=freeOnUnref(function(e){return o.info(">> remove, id:",e),this.ensureExternalErrors("remove",e,this.queue.remove(e))}),e.prototype.getAllDownloadOperations=freeOnUnref(function(){o.info(">> getAllDownloadOperations");try{var e=this.queue.getAllDownloadOperations().map(freeOnUnref(function(e){return fS.DownloadOperationTransformer.transformToPublicDownloadOperation(e)}));return lt.Promise.resolve(e)}catch(e){return o.error("Failed to execute getAllDownloadOperations",e),lt.Promise.reject(sS.InternalToExternalCodeConverter.convertCode(e))}}),e.prototype.getCurrentDownloadOperation=freeOnUnref(function(){return o.info(">> getCurrentDownloadOperation"),this.queue.getCurrentDownloadOperation().then(freeOnUnref(function(e){return null==e?null:fS.DownloadOperationTransformer.transformToPublicDownloadOperation(e)})).catch(freeOnUnref(function(e){throw o.error("Failed to execute getCurrentDownloadOperation",e),sS.InternalToExternalCodeConverter.convertCode(e)}))}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.eventEmitter.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.toJSON=freeOnUnref(function(){return{version:this.version,objectId:this.objectId}}),e.prototype.ensureExternalErrors=freeOnUnref(function(t,n,e){return e.catch(freeOnUnref(function(e){throw o.error("Failed to execute "+t+", id: "+n,e),sS.InternalToExternalCodeConverter.convertCode(e)}))}),e})();t.XpLocalContentManagerFeature=n}));e(yS);yS.XpLocalContentManagerFeature;var gS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createDownloadOperationMetadataKey=QO.createDownloadOperationMetadataKey,t.createDownloadOperationStoragePrefixKey=QO.createDownloadOperationStoragePrefixKey,t.createGetSectionsResponseKey=QO.createGetSectionsResponseKey,t.createPlaybackResourceResponseKey=QO.createPlaybackResourceResponseKey,t.XpLocalContentManagerFeature=yS.XpLocalContentManagerFeature}));e(gS);gS.createDownloadOperationMetadataKey,gS.createDownloadOperationStoragePrefixKey,gS.createGetSectionsResponseKey,gS.createPlaybackResourceResponseKey,gS.XpLocalContentManagerFeature;var vS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("CleanupCollection"),n=freeOnUnref(function(){function e(){this.sources=[]}return e.prototype.push=freeOnUnref(function(e){this.sources.push(e)}),e.prototype.cleanup=freeOnUnref(function(){for(var e=0,t=this.sources;e<t.length;e++){var n=t[e];if(null!=n.terminate)try{n.terminate()}catch(e){r.error("Failed to terminate source:",e)}if(null!=n.destroy)try{n.destroy()}catch(e){r.error("Failed to destroy source:",e)}}this.sources=[]}),e})();t.CleanupCollection=n}));e(vS);vS.CleanupCollection;var OS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.adBreaks=e}return e.prototype.convert=freeOnUnref(function(e){for(var t=0,n=0,r=0,i=this.adBreaks;r<i.length;r++){var o=i[r];if(e<=o.timestampMs)return t+(e-n);if(t+=o.timestampMs-n,e<o.timestampMs+o.durationMs)return t;n=o.timestampMs+o.durationMs}return t+(e-n)}),e.prototype.updateAdBreaks=freeOnUnref(function(e){this.adBreaks=e}),e})();t.MainContentTimeTranslator=n}));e(OS);OS.MainContentTimeTranslator;var SS=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(e){return t.call(this,e.map(freeOnUnref(function(e){return{timestampMs:e.timestampMs,durationMs:e.durationMs}})))||this}return n(e,t),e})(OS.MainContentTimeTranslator);t.CuepointMainContentTimeTranslator=r}));e(SS);SS.CuepointMainContentTimeTranslator;var US=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.mediaEventController=e,this.sonarEventAdapter=t,this.titleView=n}return e.prototype.updateConsumptionId=freeOnUnref(function(e){this.titleView.isActive()&&(this.consumptionId=e,this.mediaEventController.updateConsumptionId(this.consumptionId),this.sonarEventAdapter.updateConsumptionId(this.consumptionId))}),e})();t.ConsumptionIdUpdater=n}));e(US);US.ConsumptionIdUpdater;var bS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){var r=this;this.onEnterView=freeOnUnref(function(){r.consumptionIdUpdater.updateConsumptionId(r.consumptionId)}),this.consumptionIdUpdater=e,this.titleView=t,this.consumptionId=n}return e.prototype.initialize=freeOnUnref(function(){this.titleView.on("EnterView",this.onEnterView)}),e.prototype.terminate=freeOnUnref(function(){this.titleView.off("EnterView",this.onEnterView)}),e.prototype.updateConsumptionId=freeOnUnref(function(e){this.consumptionId=e,this.consumptionIdUpdater.updateConsumptionId(e)}),e})();t.ActivePlaybackConsumptionIdTracker=n}));e(bS);bS.ActivePlaybackConsumptionIdTracker;var PS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("MediaEventReportingPlaylistListener"),n=freeOnUnref(function(){function e(e,t,n){var r=this;this.adBreakViews=[],this.onEnterView=freeOnUnref(function(){r.mediaEventController.updateTitleId(r.titleView.id.titleId),r.mediaEventController.reportDeviceFulfillment(r.titleView.id.titleId,r.videoMaterialType);var e=r.titleView.getItems()[0];null!=e&&(null!=e.initializeContentCallback?e.initializeContentCallback().then(freeOnUnref(function(){r.cancelToken.throwIfRequested(),r.onTitleViewUpdate(e)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||s.error("Error happened when processing a deferred content",e)})):r.onTitleViewUpdate(e))}),this.onExitView=freeOnUnref(function(){r.reportInternalStop(),r.mediaEventController.resetFeatureFlags()}),this.onEnterAdBreakView=freeOnUnref(function(){r.mediaEventController.updatePlaybackContentContext("AdBreak")}),this.onExitAdBreakView=freeOnUnref(function(){r.mediaEventController.updatePlaybackContentContext("Feature")}),this.mediaEventController=e,this.videoMaterialType=n,this.titleView=t;var i=lt.CancelToken.source(),o=i.token,a=i.cancel;this.cancelFunction=a,this.cancelToken=o}return e.prototype.initialize=freeOnUnref(function(){this.titleView.on("EnterView",this.onEnterView),this.titleView.on("ExitView",this.onExitView)}),e.prototype.terminate=freeOnUnref(function(){this.cancelFunction(),this.titleView.off("EnterView",this.onEnterView),this.titleView.off("ExitView",this.onExitView),this.reportInternalStop();for(var e=0,t=this.adBreakViews;e<t.length;e++){var n=t[e];n.off("EnterView",this.onEnterAdBreakView),n.off("ExitView",this.onExitAdBreakView)}this.adBreakViews=[]}),e.prototype.appendAdBreakView=freeOnUnref(function(e){e.getItems().some(freeOnUnref(function(e){return"Ad"===e.type}))&&(e.on("EnterView",this.onEnterAdBreakView),e.on("ExitView",this.onExitAdBreakView),this.adBreakViews.push(e))}),e.prototype.onTitleViewUpdate=freeOnUnref(function(e){this.mediaEventController.updateMediaRepresentation(e.mediaRepresentation),null!=e.contentSource&&this.mediaEventController.setContentSource(e.contentSource),(e.contentSource instanceof nf.LiveLowLatencyContentSource||e.contentSource instanceof Nc.SafariHlsContentSource)&&this.mediaEventController.setBitstreamSource(e.contentSource)}),e.prototype.reportInternalStop=freeOnUnref(function(){this.mediaEventController.reportPlayback("Stop")}),e})();t.MediaEventReportingPlaylistListener=n}));e(PS);PS.MediaEventReportingPlaylistListener;var MS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.transform=freeOnUnref(function(e){return{autoplayEnabled:e.autoplayEnabled,showAutoplayCard:e.showAutoplayCard,autoplayCardPreferredImage:e.preferredImageName,inSameSeries:e.inSameSeries}}),e})();t.AutoplaySettingsTransformer=n}));e(MS);MS.AutoplaySettingsTransformer;var CS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("GetSectionsRetriever"),n=freeOnUnref(function(){function e(e,t){this.getSectionsClient=new rS.GetSectionsClient(e),this.mediaEventController=t}return e.prototype.retrieve=freeOnUnref(function(t,n,e){var r=this;return this.retrieveLocalGetSectionsResponse(e).then(freeOnUnref(function(e){return n.throwIfRequested(),null!=e?e:r.retrieveGetSectionsResponse(t,n)}))}),e.prototype.retrieveLocalGetSectionsResponse=freeOnUnref(function(e){return Jo.metadataStorage.capabilities.isSupported&&null!=e?Jo.metadataStorage.get(gS.createGetSectionsResponseKey(e)).then(freeOnUnref(function(e){return e})).catch(freeOnUnref(function(){return null})):lt.Promise.resolve(null)}),e.prototype.retrieveGetSectionsResponse=freeOnUnref(function(e,t){var n=this;return this.getSectionsClient.send(e,t).then(freeOnUnref(function(e){return e.on("latency",freeOnUnref(function(e){q.metrics.putMetric("ServiceRequest.GetSections.RequestLatencyTime",e,"ms")})),e.response()})).catch(freeOnUnref(function(e){return t.throwIfRequested(),r.error("GetSections request failed",e),q.metrics.putMetric("ServiceRequest.GetSections.Error"),n.mediaEventController.reportError(!1,e,"Service","Error"),null}))}),e})();t.GetSectionsRetriever=n}));e(CS);CS.GetSectionsRetriever;var ES=t(freeOnUnref(function(e,t){var u=ce&&ce.__assign||freeOnUnref(function(){return(u=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var c=de.get("NextTitlePlaylistListener"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l){var f=this;this.autoplaySettingsTransformer=new MS.AutoplaySettingsTransformer,this.nextSectionCalled=!1,this.tryGetSections=freeOnUnref(function(){if(f.titleView.isActive()&&"ready"===f.mpPlayer.contentState&&!f.mpPlayer.ended&&!f.nextSectionCalled){f.nextSectionCalled=!0;var e=lt.CancelToken.source(),a=e.token,t=e.cancel;f.getSectionsCancel=t,f.getSectionsRetriever.retrieve(f.currentTitleContentConfig.titleId,a,f.downloadOperationId).then(freeOnUnref(function(e){if(a.throwIfRequested(),null===e)return lt.Promise.resolve();!0===f.currentTitleContentConfig.disableAutoplay&&(e.autoplayEnabled=!1),e.autoplayEnabled||f.playlistAutoplayBarrier.addTitleBarrier(f.currentTitleContentConfig.titleId,e.titleId),f.playlistAutoplayBarrier.setMaxContinuousPlayTitleTransitions(e.numTitlesToAutoplay);var t=f.autoplaySettingsTransformer.transform(e),n=lt.CancelToken.source(),r=n.token,i=n.cancel;f.prsManager.titleRequestTracker.addTitle(e.titleId,{videoMaterialType:"Feature",cancel:i,positionMs:0,positionRelativity:"Nominal"});var o=u({},f.currentTitleContentConfig,{titleId:e.titleId,videoMaterialType:"Feature",position:0,useBookmarkStartPosition:!1});return f.prsManager.resolve(o,!1,f.userWatchSessionId,r,t)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||(c.error("Next episode PRS request failed",e),q.metrics.putMetric("NextEpisodeRequest.Error"),f.mediaEventController.reportError(!1,e,"Service","Error"))}))}}),this.currentTitleContentConfig=e,this.getSectionsRetriever=new CS.GetSectionsRetriever(t,a),this.mpPlayer=s,this.prsManager=n,this.titleView=r,this.userWatchSessionId=i,this.playlistAutoplayBarrier=o,this.mediaEventController=a,this.downloadOperationId=l}return e.prototype.initialize=freeOnUnref(function(){this.mpPlayer.on("contentStateChange",this.tryGetSections),this.titleView.on("EnterView",this.tryGetSections)}),e.prototype.terminate=freeOnUnref(function(){this.mpPlayer.off("contentStateChange",this.tryGetSections),this.titleView.off("EnterView",this.tryGetSections),this.nextSectionCalled=!1,null!=this.getSectionsCancel&&this.getSectionsCancel()}),e})();t.NextTitlePlaylistListener=n}));e(ES);ES.NextTitlePlaylistListener;var TS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("SessionTrackingListener"),r=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u){var c,d=this;this.timer=oe.timer,this.initialized=!1,this.hasStarted=!1,this.hasStopped=!1,this.lastKnownPositionMs=null,this.timeUnit=ka.TimeUnit.ContentMillis,this.hasReportedBookmarkData=!1,this.playerLoadedForAnotherTitle=!1,this.onEnterTitleView=freeOnUnref(function(){!d.isFirstTitle&&x.contains(["ready","waiting"],d.mpPlayer.contentState)&&(d.playerLoadedForAnotherTitle=!0,d.mpPlayer.on("contentStateChange",d.awaitingUnloadedCallback)),d.hasStopped&&(d.hasStopped=!1,d.hasStarted=!1,d.hasReportedBookmarkData=!1);var e=d.titleView.playlistEngine.getCurrentItem();d.timeUnit=null!=e?e.timelineUnit:d.timeUnit,d.mpPlayer.on("playbackStateChange",d.onPlaybackStateChange),d.mpPlayer.on("contentStateChange",d.onContentStateChange),d.mpPlayer.on("timeupdate",d.onTimeUpdate),d.sessionEngagementTracker.onUpdate(d.onSessionEngagementChange)}),this.onExitTitleView=freeOnUnref(function(){d.mpPlayer.off("contentStateChange",d.awaitingUnloadedCallback),d.mpPlayer.off("playbackStateChange",d.onPlaybackStateChange),d.mpPlayer.off("contentStateChange",d.onContentStateChange),d.mpPlayer.off("timeupdate",d.onTimeUpdate),d.sessionEngagementTracker.offUpdate(d.onSessionEngagementChange),d.hasStarted&&!d.hasStopped&&(d.hasStopped=!0,d.reportStop()),d.clearReportTimeout()}),this.awaitingUnloadedCallback=freeOnUnref(function(e){"unloaded"===e.contentState&&(d.playerLoadedForAnotherTitle=!1,d.mpPlayer.off("contentStateChange",d.awaitingUnloadedCallback))}),this.onEnterMainContentView=freeOnUnref(function(){!d.playerLoadedForAnotherTitle&&x.contains(["ready","waiting"],d.mpPlayer.contentState)&&d.playbackStateTriggerMap[d.mpPlayer.playbackState](!0)}),this.onTimeUpdate=freeOnUnref(function(e){d.mainContentView.isActive()&&(d.lastKnownPositionMs=d.timeTranslator.convert(e.positionMs))}),this.onPlaybackStateChange=freeOnUnref(function(e){d.playbackStateTriggerMap[e.playbackState]()}),this.onContentStateChange=freeOnUnref(function(e){"unloaded"===e.contentState&&d.hasStarted&&!d.hasStopped?(d.hasStopped=!0,d.reportStop()):"ready"===e.contentState&&d.playbackStateTriggerMap[d.mpPlayer.playbackState]()}),this.onSessionEngagementChange=freeOnUnref(function(){d.hasStarted&&d.reportUpdate()}),this.onPlaying=freeOnUnref(function(e){if(d.hasStarted=!0,!d.hasReportedBookmarkData&&d.mainContentView.isActive()){var t=d.mainContentView.playlistEngine.getCurrentItem(),n=void 0;null!=t&&null!=t.liveScheduleTitleId&&(n={scheduleStartTimeEpoch:null!=t.timelineStart?t.timelineStart/1e3:0,scheduleEndTimeEpoch:null!=t.timelineEnd?t.timelineEnd/1e3:0,fragmentTitleId:d.titleId},null!=t.liveScheduleChannelID&&t.liveScheduleChannelID!==d.titleId&&(d.titleId=t.liveScheduleChannelID)),d.sessionTracker.setAdditionalBookmarkData(d.titleId,n),d.hasReportedBookmarkData=!0}d.reportPlay(e)}),this.onPaused=freeOnUnref(function(){d.hasStarted&&d.reportPause()}),this.titleId=e,this.isFirstTitle=!0===u,this.restartContentConfig=t,this.sessionTracker=a,this.titleView=n,this.mainContentView=r,this.timeTranslator=i,this.mpPlayer=o,this.globalStreamControl=s,this.mediaEventController=l,this.sessionEngagementTracker=f,this.playbackStateTriggerMap=((c={}).playing=this.onPlaying,c.paused=this.onPaused,c)}return e.prototype.initialize=freeOnUnref(function(){this.initialized=!0,this.mainContentView.on("EnterView",this.onEnterMainContentView),this.titleView.on("EnterView",this.onEnterTitleView),this.titleView.on("ExitView",this.onExitTitleView)}),e.prototype.terminate=freeOnUnref(function(){this.initialized=!1,this.mainContentView.off("EnterView",this.onEnterMainContentView),this.titleView.off("EnterView",this.onEnterTitleView),this.titleView.off("ExitView",this.onExitTitleView),this.onExitTitleView()}),e.prototype.clearReportTimeout=freeOnUnref(function(){null!=this.scheduledReportTimeoutId&&(this.timer.clearTimeout(this.scheduledReportTimeoutId),delete this.scheduledReportTimeoutId)}),e.prototype.scheduleUpdate=freeOnUnref(function(e){var t=this;if(void 0===e&&(e=!1),this.clearReportTimeout(),this.initialized&&!this.hasStopped){var n=this.getUpdateIntervalMs(e);this.scheduledReportTimeoutId=this.timer.setTimeout(freeOnUnref(function(){t.reportUpdate()}),n)}}),e.prototype.getUpdateIntervalMs=freeOnUnref(function(e){return e?1e3:this.sessionTracker.updateIntervalMs}),e.prototype.reportUpdate=freeOnUnref(function(){var t=this;this.updateCachedPosition();var e=this.getReportingPosition();null!==e?this.sessionTracker.update(e,this.timeUnit,this.sessionEngagementTracker.isAutoplaySession(),this.tuneInTimeMs).then(freeOnUnref(function(e){t.handleResult(e)&&t.scheduleUpdate()})):this.reportMissingPosition("update")}),e.prototype.handleResult=freeOnUnref(function(e){switch(e.result){case"not_allowed":return this.globalStreamControl.onStreamError(e.reason),!1;case"stale_resources":return null==this.restartContentConfig?this.globalStreamControl.onStreamError(new Error("Content is using stale resources, but we don't have a config to restart playback")):this.globalStreamControl.onStreamRestart(this.restartContentConfig),!1;case"normal":return!0}}),e.prototype.reportPlay=freeOnUnref(function(t){var n=this;this.updateCachedPosition();var e=this.getReportingPosition();null!==e?this.sessionTracker.play(e,this.timeUnit,this.sessionEngagementTracker.isAutoplaySession(),this.tuneInTimeMs).then(freeOnUnref(function(e){n.handleResult(e)&&n.scheduleUpdate(t)})):this.reportMissingPosition("play")}),e.prototype.reportPause=freeOnUnref(function(){var t=this;this.updateCachedPosition();var e=this.getReportingPosition();null!==e?this.sessionTracker.pause(e,this.timeUnit,this.sessionEngagementTracker.isAutoplaySession()).then(freeOnUnref(function(e){t.handleResult(e)&&t.scheduleUpdate()})):this.reportMissingPosition("pause")}),e.prototype.reportStop=freeOnUnref(function(){var e=this.getReportingPosition();null!==e?this.sessionTracker.stop(e,this.timeUnit,this.sessionEngagementTracker.isAutoplaySession()):this.reportMissingPosition("stop")}),e.prototype.updateCachedPosition=freeOnUnref(function(){var e=this.mpPlayer.currentTimeMs;null!==e&&(this.lastKnownPositionMs=this.timeTranslator.convert(e),(null==this.tuneInTimeMs||null!=this.lastKnownPositionMs&&this.tuneInTimeMs>this.lastKnownPositionMs)&&(this.tuneInTimeMs=this.lastKnownPositionMs))}),e.prototype.getReportingPosition=freeOnUnref(function(){return this.lastKnownPositionMs}),e.prototype.reportMissingPosition=freeOnUnref(function(e){var t="Cannot report playback "+e+" without a current or last known position";n.error(t),this.mediaEventController.reportError(!1,new Error(t),"Player","Unknown")}),e})();t.SessionTrackingListener=r}));e(TS);TS.SessionTrackingListener;var wS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.whisperCacheBufferSizeMs=8e3,this.playbackBufferSizeMs=fh.BufferConstants.MAX_FRONT_BUFFER_MS,this.onEnterView=freeOnUnref(function(){"playing"===i.mpPlayer.playbackState?i.contentSource.setFrontBufferSize(i.playbackBufferSizeMs):i.mpPlayer.on("playbackStateChange",i.onPlaybackStateChange)}),this.onPlaybackStateChange=freeOnUnref(function(e){"playing"===e.playbackState&&(i.contentSource.setFrontBufferSize(i.playbackBufferSizeMs),i.mpPlayer.off("playbackStateChange",i.onPlaybackStateChange))}),this.titleIdView=e,this.mpPlayer=t,this.contentSource=n;var o=r.playbackSettings;this.playbackBufferSizeMs=1e3*o.buffer.forwardBufferLengthSeconds,this.whisperCacheBufferSizeMs=Math.max(8e3,1e3*o.buffer.bufferFullnessForPlaybackStartSeconds)}return e.prototype.initialize=freeOnUnref(function(){this.titleIdView.isActive()?"playing"===this.mpPlayer.playbackState?this.contentSource.setFrontBufferSize(this.playbackBufferSizeMs):(this.contentSource.setFrontBufferSize(this.whisperCacheBufferSizeMs),this.mpPlayer.on("playbackStateChange",this.onPlaybackStateChange)):(this.contentSource.setFrontBufferSize(this.whisperCacheBufferSizeMs),this.titleIdView.on("EnterView",this.onEnterView))}),e.prototype.terminate=freeOnUnref(function(){this.titleIdView.off("EnterView",this.onEnterView),this.mpPlayer.off("playbackStateChange",this.onPlaybackStateChange)}),e})();t.FrontBufferSetter=n}));e(wS);wS.FrontBufferSetter;var IS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.playlistRelativeConstrainedTimeWindow=e,this.playlistEngine=t,this.liveContentView=n}return e.prototype.getNewSeekTarget=freeOnUnref(function(e,t){var n=this.playlistEngine.getItems()[t];if(!x.contains(this.liveContentView.getItems(),n))return{newPosition:e,newItemIndex:t};var r=this.constrainPosition(e);return{newPosition:r,newItemIndex:this.liveContentView.getItemIndex(r)}}),e.prototype.constrainPosition=freeOnUnref(function(e){var t=this.playlistRelativeConstrainedTimeWindow;return Math.max(t.startMs,Math.min(e,t.endMs))}),e})();t.TimeWindowEnforcingSeekInterceptor=n}));e(IS);IS.TimeWindowEnforcingSeekInterceptor;var kS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.contentTimeWindow=e,this.initialPlaybackPositionTracker=t,this.liveLookbackPolicy=n}return Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){var e=this.contentTimeWindow.startMs,t=this.contentTimeWindow.endMs;if("Unrestricted"===this.liveLookbackPolicy.liveLookbackControl)return e;var n=-1/0;if("LiveHead"===this.liveLookbackPolicy.liveLookbackRoot&&"Rolling"===this.liveLookbackPolicy.liveLookbackRootMode)n=t;else if("LiveHead"===this.liveLookbackPolicy.liveLookbackRoot&&"Fixed"===this.liveLookbackPolicy.liveLookbackRootMode){n=null!=(i=this.initialPlaybackPositionTracker.getInitialLiveHeadPositionMs())?i:t}else if("PlayStart"===this.liveLookbackPolicy.liveLookbackRoot&&"Rolling"===this.liveLookbackPolicy.liveLookbackRootMode){var r=this.initialPlaybackPositionTracker.getInitialPlayPositionMs(),i=this.initialPlaybackPositionTracker.getInitialLiveHeadPositionMs();null!=r&&null!=i&&(n=r+t-i)}else if("PlayStart"===this.liveLookbackPolicy.liveLookbackRoot&&"Fixed"===this.liveLookbackPolicy.liveLookbackRootMode){null!=(r=this.initialPlaybackPositionTracker.getInitialPlayPositionMs())&&(n=r)}return n+=this.liveLookbackPolicy.liveLookbackOffsetMs,Math.max(e,n)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){return this.contentTimeWindow.endMs}),enumerable:!0,configurable:!0}),e.prototype.isUpdating=freeOnUnref(function(){return this.contentTimeWindow.isUpdating()}),e})();t.ConstrainedLookbackTimeWindow=n}));e(kS);kS.ConstrainedLookbackTimeWindow;var _S=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.baseTimeWindow=e,this.offsetMs=t}return e.prototype.updateTimeWindow=freeOnUnref(function(e){this.baseTimeWindow=e}),e.prototype.updateOffset=freeOnUnref(function(e){this.offsetMs=e}),Object.defineProperty(e.prototype,"startMs",{get:freeOnUnref(function(){return this.baseTimeWindow.startMs+this.offsetMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMs",{get:freeOnUnref(function(){return this.baseTimeWindow.endMs+this.offsetMs}),enumerable:!0,configurable:!0}),e.prototype.isUpdating=freeOnUnref(function(){return this.baseTimeWindow.isUpdating()}),e})();t.TimeWindowProxy=n}));e(_S);_S.TimeWindowProxy;var RS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("TimeWindowController"),r=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.timer=oe.timer,this.timeWindowCheckId=null,this.onEnterView=freeOnUnref(function(){"waiting"===i.mpPlayer.contentState&&i.startBufferTimer(),i.mpPlayer.on("contentStateChange",i.onContentStateChange)}),this.onExitView=freeOnUnref(function(){i.stopBufferTimer(),i.mpPlayer.off("contentStateChange",i.onContentStateChange)}),this.onContentStateChange=freeOnUnref(function(e){"waiting"===e.contentState?i.startBufferTimer():i.stopBufferTimer()}),this.mediaRepresentation=e,this.mpPlayer=t,this.playlistEngine=n,this.view=r,this.playlistRelativeTimeWindow=this.createPlaylistRelativeTimeWindow(e)}return e.prototype.initialize=freeOnUnref(function(){null!=this.mediaRepresentation.updatePeriodMs&&0!==this.mediaRepresentation.updatePeriodMs&&(this.view.on("EnterView",this.onEnterView),this.view.on("ExitView",this.onExitView))}),e.prototype.terminate=freeOnUnref(function(){this.view.off("EnterView",this.onEnterView),this.view.off("ExitView",this.onExitView),this.mpPlayer.off("contentStateChange",this.onContentStateChange),this.stopBufferTimer()}),e.prototype.reset=freeOnUnref(function(e){this.mediaRepresentation=e,this.playlistRelativeTimeWindow=this.createPlaylistRelativeTimeWindow(e)}),e.prototype.startBufferTimer=freeOnUnref(function(){var t=this,e=freeOnUnref(function(){var e=t.playlistEngine.getCurrentPosition();return null===e?(n.warn("Attempted to check for buffer without a current position. Retrying in 1min"),6e4):Math.max(0,e-t.playlistRelativeTimeWindow.startMs)});this.stopBufferTimer(),this.timeWindowCheckId=this.timer.setTimeout(freeOnUnref(function(){var e=t.playlistEngine.getCurrentPosition();null!==e?(n.info("Current position "+e+"ms (playlist time) outside time window. Seeking back into time window"),t.playlistEngine.seek(e),t.startBufferTimer()):n.error("Cannot seek back into time window without current position")}),e())}),e.prototype.stopBufferTimer=freeOnUnref(function(){null!==this.timeWindowCheckId&&this.timer.clearTimeout(this.timeWindowCheckId)}),e.prototype.createPlaylistRelativeTimeWindow=freeOnUnref(function(e){var t=Qe.withDefault(e.utcMsAtZero,0);return new _S.TimeWindowProxy(e.timeWindow,t)}),e})();t.TimeWindowController=r}));e(RS);RS.TimeWindowController;var AS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("TrackingEventReportingServiceController"),n=freeOnUnref(function(){function e(e,t,n,r,i){var o=this;this.lastReportedPosition=null,this.hasSeeked=!1,this.onTimeUpdate=freeOnUnref(function(e){var t=o.getTrackingPosition(e);if(null!=t){null==o.lastReportedPosition&&o.setAnchor(t);var n={CONSUMPTIONID:o.sourceUrlStore.get().urlId};o.triggerTrackingEvents(t,n,o.trackingEventsSource.getRetryPolicy())}}),this.setAnchor=freeOnUnref(function(e){o.lastReportedPosition=e}),this.onSeek=freeOnUnref(function(){o.hasSeeked=!0;var e=o.getTrackingPosition(o.mpPlayerProxy.playbackTime);null!=e&&o.setAnchor(e)}),this.mpPlayerProxy=e,this.adEventReporter=t,this.trackingEventsSource=i,this.sourceUrlStore=n,this.trackingPositionExtractor=r,this.mpPlayerProxy.on("timeupdate",this.onTimeUpdate),this.mpPlayerProxy.on("seeking",this.onSeek)}return e.prototype.destroy=freeOnUnref(function(){this.mpPlayerProxy.off("timeupdate",this.onTimeUpdate),this.mpPlayerProxy.off("seeking",this.onSeek)}),e.prototype.getAnchor=freeOnUnref(function(){return this.lastReportedPosition}),e.prototype.triggerTrackingEvents=freeOnUnref(function(e,t,n){var r=null;if(null!=this.lastReportedPosition){for(var i=this.trackingEventsSource.getSortedTrackingEventsBetween(this.lastReportedPosition,e),o=0;o<i.length;o++){var a=i[o],s=this.getTrackingEventPosition(a);null!=s&&(this.isEventInTriggerRange(s,e)&&(this.adEventReporter.send(a.beaconUrls,t,n),r=s,l.info("TrackingEvent "+a.eventType+" triggered. Event located at position (Time: "+s+").")))}null!=r&&(this.setAnchor(r),this.hasSeeked=!1)}}),e.prototype.isEventInTriggerRange=freeOnUnref(function(e,t){var n=this.getAnchor();return null!==n&&(this.hasSeeked?n<=e&&e<=t:n<e&&e<=t)}),e.prototype.getTrackingPosition=freeOnUnref(function(e){return this.trackingPositionExtractor.getTrackingPosition(e)}),e.prototype.getTrackingEventPosition=freeOnUnref(function(e){return this.trackingPositionExtractor.getTrackingEventPosition(e)}),e})();t.TrackingEventReportingServiceController=n}));e(AS);AS.TrackingEventReportingServiceController;var DS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.getTrackingPosition=freeOnUnref(function(e){return null==e||null==e.manifestTimeMs?null:e.manifestTimeMs}),e.prototype.getTrackingEventPosition=freeOnUnref(function(e){return null==e.startTimeInSeconds?null:1e3*e.startTimeInSeconds}),e.prototype.isPositionInAd=freeOnUnref(function(e,t){return null!=t.manifestTimeMs&&(1e3*e.startTimeInSeconds<=t.manifestTimeMs&&t.manifestTimeMs<1e3*(e.startTimeInSeconds+e.durationInSeconds))}),e.prototype.isPositionInLiveAd=freeOnUnref(function(e,t){return null!=t.manifestTimeMs&&null!=e.timeInfo&&(e.timeInfo.startMs<=t.manifestTimeMs&&t.manifestTimeMs<e.timeInfo.endMs)}),e})();t.TrackingPositionExtractorDash=n}));e(DS);DS.TrackingPositionExtractorDash;var xS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.getTrackingPosition=freeOnUnref(function(e){return null==e||null==e.fragmentIndex?null:e.fragmentIndex}),e.prototype.getTrackingEventPosition=freeOnUnref(function(e){return null==e.eventId?null:parseInt(e.eventId)}),e.prototype.isPositionInAd=freeOnUnref(function(e,t){return null!=t.playheadTimeMs&&(1e3*e.startTimeInSeconds<=t.playheadTimeMs&&t.playheadTimeMs<1e3*(e.startTimeInSeconds+e.durationInSeconds))}),e.prototype.isPositionInLiveAd=freeOnUnref(function(e,t){return null!=t.manifestTimeMs&&null!=e.timeInfo&&(e.timeInfo.startMs<=t.manifestTimeMs&&t.manifestTimeMs<e.timeInfo.endMs)}),e})();t.TrackingPositionExtractorHls=n}));e(xS);xS.TrackingPositionExtractorHls;var FS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.create=freeOnUnref(function(e){return"HLS"===e?new xS.TrackingPositionExtractorHls:new DS.TrackingPositionExtractorDash}),e})();t.TrackingEventReportingServiceControllerFactory=n}));e(FS);FS.TrackingEventReportingServiceControllerFactory;var BS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.trackingEvents=[],this.ads=[],this.supportedEvents=["impression","start","firstQuartile","midpoint","thirdQuartile","complete"],this.retryPolicy={backoffBaseMs:100,backoffMaxMs:5e3,backoffModifier:2,jitterMs:60},this.trackingPositionExtractor=e}return e.prototype.resetTrackingEvents=freeOnUnref(function(){this.trackingEvents=[],this.ads=[]}),e.prototype.addTrackingEvents=freeOnUnref(function(e){this.resetTrackingEvents(),this.retryPolicy={backoffBaseMs:e.retry.backoffBase,backoffMaxMs:e.retry.backoffMax,backoffModifier:e.retry.backoffModifier,jitterMs:e.retry.jitter};for(var t=0,n=e.avails;t<n.length;t++)for(var r=0,i=n[t].ads;r<i.length;r++){for(var o=i[r],a=0,s=o.trackingEvents;a<s.length;a++){var l=s[a];x.contains(this.supportedEvents,l.eventType)&&null!=this.getTrackingEventPosition(l)&&this.trackingEvents.push(l)}this.ads.push({vastAdId:o.vastAdId,startTimeInSeconds:o.startTimeInSeconds,durationInSeconds:o.durationInSeconds})}this.trackingEvents=x.sortBy(this.trackingEvents,freeOnUnref(function(e){return e.startTimeInSeconds}))}),e.prototype.getVastAdId=freeOnUnref(function(e){for(var t=0,n=this.ads;t<n.length;t++){var r=n[t];if(this.trackingPositionExtractor.isPositionInAd(r,e))return r.vastAdId}return null}),e.prototype.getRetryPolicy=freeOnUnref(function(){return this.retryPolicy}),e.prototype.getSortedTrackingEventsBetween=freeOnUnref(function(e,t){for(var n=[],r=this.findFirstEventIndexAfterPosition(e);r<this.trackingEvents.length;r++){var i=this.trackingEvents[r],o=this.getTrackingEventPosition(i);if(null!=o){if(t<o)break;n.push(this.trackingEvents[r])}}return n}),e.prototype.getTrackingEventPosition=freeOnUnref(function(e){return this.trackingPositionExtractor.getTrackingEventPosition(e)}),e.prototype.findFirstEventIndexAfterPosition=freeOnUnref(function(n){var r=this;if(null==n)return 1/0;for(var e=freeOnUnref(function(e){var t=r.getTrackingEventPosition(e);return null==t?0:n-t}),t=Pn.binarySearchIndexOfClosestBelow(this.trackingEvents,e),i=t;1<=i;i--){var o=this.getTrackingEventPosition(this.trackingEvents[i]),a=this.getTrackingEventPosition(this.trackingEvents[i-1]);if(null==o||null==a||o!==a)break;t--}return t}),e})();t.TrackingEventsSource=n}));e(BS);BS.TrackingEventsSource;var LS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=[500,503],f=de.get("TrackingEventVendingServiceClient"),n=freeOnUnref(function(){function e(){this.request=null,this.retry=null,this.retryPolicy={backoffBase:100,backoffMax:5e3,backoffModifier:2,jitter:60}}return e.prototype.stop=freeOnUnref(function(){this.cancelPendingRequest()}),e.prototype.send=freeOnUnref(function(i,o,e,t){var a=this;this.cancelPendingRequest(),this.retry=(new _n.ExponentialBackoffRetry).withMaxAttempts(4).withInitialIntervalMs(this.retryPolicy.backoffBase).withExponentialFactor(this.retryPolicy.backoffModifier).withRandomizationFactor(this.retryPolicy.jitter).withMaxDelayMs(this.retryPolicy.backoffMax).onSuccess(e).onError(t).onAttempt(freeOnUnref(function(e,t,n,r){a.sendRequest(i,o,e,t,n,r)})).execute()}),e.prototype.sendRequest=freeOnUnref(function(e,t,n,r,o,a){var s=this,i=new mt.URL(e);mt.URLUtils.appendQueryParams(i,t),this.request=pn.HttpRequest.get(i.toString()).timeout(5e3).accept("application/json").onError(freeOnUnref(function(e,t){null==t||x.contains(l,t.getStatus())?r(e):a(e)})).onLoad(freeOnUnref(function(e){var t;s.request=null;try{var n=e.getText(),r=Date.now();t=JSON.parse(n);var i=Date.now();f.enabledFor(de.DEBUG)&&f.info("TEVS response parsing took "+(i-r)+"ms (avails: "+(null!=t.avails?t.avails.length:0)+", size: "+n.length+")")}catch(e){return void a(new Error("JSON parsing error in TEVS response: "+e.toString()))}s.retryPolicy=t.retry,o(t)})).send()}),e.prototype.cancelPendingRequest=freeOnUnref(function(){null!==this.retry&&(this.retry.abort(),this.retry=null),null!==this.request&&(this.request.abort(),this.request=null)}),e})();t.TrackingEventVendingServiceClient=n}));e(LS);LS.TrackingEventVendingServiceClient;var NS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("TrackingEventVendingServiceController"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l){void 0===l&&(l=new LS.TrackingEventVendingServiceClient);var f=this;this.timer=oe.timer,this.updateIntervalMs=6e3,this.scheduledReportTimeoutId=null,this.shouldSendRequest=!0,this.onSourceUrlChange=freeOnUnref(function(){f.clearReportTimeout(),null==f.sourceUrlStore.get().adsTrackingEndpoint?f.trackingEventsSource.resetTrackingEvents():f.setSendingRequest()}),this.onSuccess=freeOnUnref(function(e){f.trackingEventsSource.addTrackingEvents(e),f.liveAdPlaylistSource.handleAdAvails(e.avails)}),this.onError=freeOnUnref(function(e){u.error(e)}),this.onTimeUpdate=freeOnUnref(function(e){f.shouldSendRequest&&(f.shouldSendRequest=!1,f.sendRequest(e))}),this.trackingEventsSource=a,this.mpPlayerProxy=e,this.optOutAdTracking=t,this.advertisingId=n,this.sourceUrlStore=r,this.reportingServiceController=o,this.vendingServiceClient=l,this.streamingTechnology=i,this.liveAdPlaylistSource=s}return e.prototype.start=freeOnUnref(function(){this.sourceUrlStore.on("SourceUrlChange",this.onSourceUrlChange),this.mpPlayerProxy.on("timeupdate",this.onTimeUpdate)}),e.prototype.stop=freeOnUnref(function(){this.clearReportTimeout(),this.vendingServiceClient.stop(),this.reportingServiceController.destroy(),this.sourceUrlStore.off("SourceUrlChange",this.onSourceUrlChange),this.mpPlayerProxy.off("timeupdate",this.onTimeUpdate)}),e.prototype.startTimer=freeOnUnref(function(){var e=this;this.clearReportTimeout(),this.scheduledReportTimeoutId=this.timer.setTimeout(freeOnUnref(function(){return e.setSendingRequest()}),this.updateIntervalMs)}),e.prototype.clearReportTimeout=freeOnUnref(function(){null!=this.scheduledReportTimeoutId&&(this.timer.clearTimeout(this.scheduledReportTimeoutId),this.scheduledReportTimeoutId=null)}),e.prototype.setSendingRequest=freeOnUnref(function(){this.shouldSendRequest=!0}),e.prototype.sendRequest=freeOnUnref(function(e){var t=this.sourceUrlStore.get();if(null!=t.adsTrackingEndpoint){var n={consumptionId:t.urlId,optOut:this.optOutAdTracking?"true":"false",advertisingId:this.optOutAdTracking?"optOut":null==this.advertisingId?void 0:this.advertisingId};"DASH"===this.streamingTechnology&&null!=e.manifestTimeMs?n["aws.playheadPositionInSeconds"]=Math.floor(e.manifestTimeMs/1e3):"HLS"===this.streamingTechnology&&null!=e.playheadTimeMs&&(n["aws.playheadPositionInSeconds"]=Math.floor(e.playheadTimeMs/1e3)),this.vendingServiceClient.send(t.adsTrackingEndpoint,n,this.onSuccess,this.onError),this.startTimer()}else u.warn("No 'adsTrackingEndpoint' for consumption id "+t.urlId+". Won't request tracking events")}),e})();t.TrackingEventVendingServiceController=n}));e(NS);NS.TrackingEventVendingServiceController;var VS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("LiveAdTimelineManager"),n=freeOnUnref(function(){function e(e){this.updateCallback=new A.MulticastCallback,this.trackingPositionExtractor=null,this.liveAdsStore={},this.updateCallback=new A.MulticastCallback,this.mpPlayer=e}return e.prototype.updateAdData=freeOnUnref(function(e){this.liveAdsStore[e.adId]=e,this.updateCallback.invoke(!1)}),e.prototype.updateAdEndTime=freeOnUnref(function(t){var n=this,e=Object.keys(this.liveAdsStore).map(freeOnUnref(function(e){return n.liveAdsStore[e]})).filter(freeOnUnref(function(e){return null!=e.timeInfo&&e.timeInfo.startMs<=t&&e.timeInfo.endMs>=t}));if(0===e.length)a.error("No ads found corresponding to endTime: "+t);else if(1<e.length)a.error("Multiple ads found corresponding to endTime: "+t);else{var r=e[0];this.liveAdsStore[r.adId]={adId:r.adId,extensions:r.extensions,timeInfo:{startMs:r.timeInfo.startMs,endMs:t},trackingURL:r.trackingURL},this.updateCallback.invoke(!0)}}),e.prototype.reset=freeOnUnref(function(){this.liveAdsStore={},this.updateCallback.invoke(!1)}),e.prototype.flushLiveAds=freeOnUnref(function(e){var t=this,n={};e.forEach(freeOnUnref(function(e){t.liveAdsStore[e]&&(n[e]=t.liveAdsStore[e])}));var r=this.getCurrentlyPlayingAd();null!=r&&null==n[r.adId]&&(q.metrics.putMetric("LiveEvent.OngoingAdRemoved"),a.info("Ad "+r.adId+" is currently playing. Not removing from the store."),n[r.adId]=r),this.liveAdsStore=n,this.updateCallback.invoke(!1)}),e.prototype.getAllAdData=freeOnUnref(function(){var t=this;return Object.keys(this.liveAdsStore).map(freeOnUnref(function(e){return t.liveAdsStore[e]}))}),e.prototype.onUpdate=freeOnUnref(function(e){this.updateCallback.add(e)}),e.prototype.offUpdate=freeOnUnref(function(e){this.updateCallback.remove(e)}),e.prototype.getVastAdId=freeOnUnref(function(e){if(null!=this.trackingPositionExtractor)for(var t=0,n=Object.keys(this.liveAdsStore);t<n.length;t++){var r=n[t];if(this.trackingPositionExtractor.isPositionInLiveAd(this.liveAdsStore[r],e))return r}else a.error("TrackingPositionExtractor not set")}),e.prototype.setTrackingPositionExtractor=freeOnUnref(function(e){this.trackingPositionExtractor=e}),e.prototype.getCurrentlyPlayingAd=freeOnUnref(function(){var e=this.mpPlayer.playbackTime;if(null==e)return null;for(var t=e.positionMs,n=0,r=Object.keys(this.liveAdsStore);n<r.length;n++){var i=r[n],o=this.liveAdsStore[i];if(null!=o.timeInfo&&t>=o.timeInfo.startMs&&t<=o.timeInfo.endMs)return a.info("getCurrentlyPlayingAd Found ad "+i+" at position "+t+"ms"),o}return null}),e})();t.LiveAdTimelineManager=n}));e(VS);VS.LiveAdTimelineManager;var jS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("LiveAdPlaylistSource"),n=freeOnUnref(function(){function e(e){this.xmlParser=new bp.Parser,this.adsTimelineManager=e}return e.prototype.handleAdAvails=freeOnUnref(function(e){var s=this;e.forEach(freeOnUnref(function(e){e.ads.forEach(freeOnUnref(function(e){var t=1e3*e.startTimeInSeconds,n=[];null!=e.extensions&&e.extensions.forEach(freeOnUnref(function(t){try{var e=s.xmlParser.parse(new bp.ElementNodeHandler("ActionableAd"),t.content);null!=e?n.push(e):l.error("Failed to parse EMT extension of "+t.content)}catch(e){l.error("Failed to parse EMT extension of type "+t.type+", error: ",e)}}));var r,i=e.trackingEvents.filter(freeOnUnref(function(e){return"error"===e.eventType&&0<e.beaconUrls.length}));0<i.length&&(r=i[0].beaconUrls[0].url),null==r&&l.error("Unable to get error URL from TEVS for IVA");var o={startMs:t,endMs:t+1e3*e.durationInSeconds},a={adId:e.vastAdId,extensions:n,timeInfo:o,trackingURL:r};s.adsTimelineManager.updateAdData(a)}))}))}),e.prototype.reset=freeOnUnref(function(){this.adsTimelineManager.reset()}),e})();t.LiveAdPlaylistSource=n}));e(jS);jS.LiveAdPlaylistSource;var qS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("PlaybackUrlsPlaylistUpdater"),n=freeOnUnref(function(){function e(e,t,n,r,i,o){var a=this;this.shouldUpdateAdExtensionData=!1,this.timer=oe.timer,this.updateIntervalId=null,this.onLiveAdsUpdate=freeOnUnref(function(){a.shouldUpdateAdExtensionData=!0}),this.contentMetadata=e,this.mainContentView=t,this.mediaRepresentation=n,this.eventTimelineMetadata=r,this.playlistRelativeConstrainedTimeWindow=i,this.liveAdTimelineManager=o}return e.prototype.start=freeOnUnref(function(){this.startUpdater(),this.liveAdTimelineManager.onUpdate(this.onLiveAdsUpdate)}),e.prototype.stop=freeOnUnref(function(){null!==this.updateIntervalId&&(this.timer.clearInterval(this.updateIntervalId),this.updateIntervalId=null),this.liveAdTimelineManager.offUpdate(this.onLiveAdsUpdate)}),e.prototype.reset=freeOnUnref(function(e,t){this.eventTimelineMetadata=e,this.mediaRepresentation=t,this.stop(),this.start()}),e.prototype.startUpdater=freeOnUnref(function(){var r=this,e=this.mainContentView.getItems()[0];if(null!=e){var i=e.start,o=null!=e.end?e.end:1/0;null!==this.updateIntervalId&&this.timer.clearInterval(this.updateIntervalId);var a=this.eventTimelineMetadata.startTimeMs;this.updateIntervalId=this.timer.setInterval(freeOnUnref(function(){var e=r.mediaRepresentation.timeWindow.endMs+Qe.withDefault(r.mediaRepresentation.utcMsAtZero,0),t=null!=a?Math.min(a,r.playlistRelativeConstrainedTimeWindow.endMs):r.mediaRepresentation.timeWindow.startMs+Qe.withDefault(r.mediaRepresentation.utcMsAtZero,0),n=Math.max(o,e);if(null==r.mediaRepresentation.updatePeriodMs&&e<=o&&(n=e,r.stop()),t!==i||n!==o||r.shouldUpdateAdExtensionData)try{r.mainContentView.update(i,o,{start:t,end:n,timelineStart:t,timelineEnd:n,liveAds:r.liveAdTimelineManager.getAllAdData()}),r.shouldUpdateAdExtensionData=!1}catch(e){s.error("Live Event playlist update failed (["+i+", "+o+"]):",e)}o=n,i=t}),2e3)}else s.warn("Failed to start updater: no initial item in playlist")}),e})();t.PlaybackUrlsPlaylistItemUpdater=n}));e(qS);qS.PlaybackUrlsPlaylistItemUpdater;var HS=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.StreamEnd="StreamEnd",e.OriginFailure="OriginFailure591",e.LegacyOriginFailure="LegacyOriginFailure504",e.FragmentNotReady="FragmentNotReady",e.LegacyOriginFailureOnFragment="LegacyOriginFailure5XX",e.OriginManifestFailure="OriginManifestFailure",e.MidasFailure="MidasFailure",e.CDNFailure="CDNFailure",e.TimeoutCDN="TimeoutCDN",e.TokenFailure="TokenFailure",e.CatchAll="CatchAll",e.StructuralParse="StructuralParse",e.StaleManifest="StaleManifest",e.NegativeManifest="NegativeManifest",e.SonarInducedCdnSwitch="SonarInducedCdnSwitch"})(n||(n={})),t.FailoverCase=n}));e(HS);HS.FailoverCase;var zS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function t(){}return t.prototype.getDefaultTable=freeOnUnref(function(){return[{case:HS.FailoverCase.OriginFailure,maxAttempts:1,action:"origin",statusCode:{min:591,max:591}},{case:HS.FailoverCase.LegacyOriginFailure,maxAttempts:1,action:"origin",xAmzSource:["liveplaybackorigin"],statusCode:{min:504,max:504}},{case:HS.FailoverCase.FragmentNotReady,maxAttempts:100,action:"origin",xAmzSource:["liveplaybackorigin"],resourceType:Ac.AcquisitionResourceType.Fragment,statusCode:{min:404,max:404}},{case:HS.FailoverCase.LegacyOriginFailureOnFragment,maxAttempts:3,action:"origin",xAmzSource:["liveplaybackorigin"],resourceType:Ac.AcquisitionResourceType.Fragment,statusCode:{min:500,max:599}},{case:HS.FailoverCase.OriginManifestFailure,maxAttempts:3,action:"origin",xAmzSource:["liveplaybackorigin"],resourceType:Ac.AcquisitionResourceType.Manifest,statusCode:{min:400,max:599}},{case:HS.FailoverCase.MidasFailure,maxAttempts:3,action:"manifestService",xAmzSource:["midas"],statusCode:{min:400,max:599}},{case:HS.FailoverCase.CDNFailure,maxAttempts:3,action:"cdn",xAmzSource:["cdn",null,void 0],statusCode:{min:400,max:599}},{case:HS.FailoverCase.StaleManifest,maxAttempts:7,action:[{occurrence:{min:7,max:7},action:"cdn"},{occurrence:{min:8,max:1/0},action:"origin"}],errorReason:{type:"ParseError",causeCode:"manifest.stale"}},{case:HS.FailoverCase.NegativeManifest,maxAttempts:7,action:[{occurrence:{min:7,max:7},action:"cdn"},{occurrence:{min:8,max:1/0},action:"origin"}],errorReason:{type:"ParseError",causeCode:"manifest.negative"}},{case:HS.FailoverCase.StructuralParse,maxAttempts:1,action:[{occurrence:{min:1,max:1},action:"cdn"},{occurrence:{min:2,max:1/0},action:"origin"}],errorReason:{type:"ParseError"}},{case:HS.FailoverCase.TimeoutCDN,maxAttempts:2,action:"cdn",xAmzSource:[null,void 0]},{case:HS.FailoverCase.CatchAll,maxAttempts:3,action:"cdn",statusCode:{min:400,max:599}}]}),t.findRule=freeOnUnref(function(e,t){var n=x.find(e,freeOnUnref(function(e){return e.case===t}));if(null==n)throw new Error("Can't find failover case "+t+" in the default failover table.");return n}),t.applyCustomConfigs=freeOnUnref(function(e){null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.failover&&null!=L.configurationStore.configuration.failover.cdnTimeoutMaxAttempts&&(t.findRule(e,HS.FailoverCase.TimeoutCDN).maxAttempts=L.configurationStore.configuration.failover.cdnTimeoutMaxAttempts)}),t.prototype.getTable=freeOnUnref(function(){var e=this.getDefaultTable();return t.applyCustomConfigs(e),e}),t})();t.FailoverTableProvider=n}));e(zS);zS.FailoverTableProvider;var WS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("FailoverTracker"),r=[HS.FailoverCase.OriginFailure,HS.FailoverCase.LegacyOriginFailure,HS.FailoverCase.FragmentNotReady,HS.FailoverCase.LegacyOriginFailureOnFragment,HS.FailoverCase.OriginManifestFailure,HS.FailoverCase.MidasFailure,HS.FailoverCase.CDNFailure,HS.FailoverCase.StructuralParse,HS.FailoverCase.StaleManifest,HS.FailoverCase.NegativeManifest,HS.FailoverCase.TimeoutCDN,HS.FailoverCase.CatchAll,HS.FailoverCase.SonarInducedCdnSwitch];function o(e,t,n){return t<=e&&e<=n}function a(e,t){return e.type===t.type&&(null==t.causeCode||("UnknownError"===e.type||"ParseError"===e.type||"SourceError"===e.type)&&(n=e.cause,r=t.causeCode,n instanceof ct.XpError&&0<=n.code.indexOf(r)));var n,r}var n=freeOnUnref(function(){function s(){this.failoverCaseCounter={};var e=new zS.FailoverTableProvider;this.failoverTable=e.getTable(),this.resetFailoverCaseCounter()}return s.isMatchingEntry=freeOnUnref(function(e,t,n,r,i){return null!=t&&(t=t.toLowerCase()),(null==e.xAmzSource||x.contains(e.xAmzSource,t))&&(null==e.resourceType||e.resourceType===r)&&(null==e.statusCode||null!=n&&o(n,e.statusCode.min,e.statusCode.max))&&(null==e.errorReason||null!=i&&a(i,e.errorReason))}),s.prototype.resetFailoverCaseCounter=freeOnUnref(function(){for(var e=0,t=r;e<t.length;e++){var n=t[e];l.enabledFor(de.DEBUG)&&0!==this.failoverCaseCounter[n]&&l.info("Failure counter for case "+n+" is being reset. Previous count was "+this.failoverCaseCounter[n]),this.failoverCaseCounter[n]=0}}),s.prototype.resourceAcquisitionFailed=freeOnUnref(function(t,n){var r,i;"HttpError"===t.type&&(i=t.headers["x-amz-source"],r=t.statusCode);var e=x.find(this.failoverTable,freeOnUnref(function(e){return s.isMatchingEntry(e,i,r,n,t)}));if(null==e)return null;var o=++this.failoverCaseCounter[e.case];if(o<e.maxAttempts)return l.enabledFor(de.DEBUG)&&l.info("Failure case "+e.case+" now has failure count "+o+" but did not reach "+e.maxAttempts+". No failover executed."),null;l.enabledFor(de.DEBUG)&&l.info("Resource failure for resource "+n+" with status code "+r+" and amz-source "+i+" matched rule "+JSON.stringify(e));var a=this.getFailoverAction(e);return null==a?(l.warn("No applied occurrence-based failover action for case "+e.case+" with failure count "+e.maxAttempts+". Not triggering failover."),null):(l.enabledFor(de.DEBUG)&&l.info("Failure case "+e.case+" now has failure count "+o+" and reached the max count "+e.maxAttempts+". Attempting an "+a+" failover"),{failoverAction:a,failoverCase:e.case})}),s.prototype.getFailoverAction=freeOnUnref(function(e){if(!Array.isArray(e.action))return e.action;var t=this.failoverCaseCounter[e.case],n=x.find(e.action,freeOnUnref(function(e){return o(t,e.occurrence.min,e.occurrence.max)}));return null!=n?n.action:void 0}),s})();t.FailoverTracker=n}));e(WS);WS.FailoverTracker;var KS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={case:HS.FailoverCase.StreamEnd,maxAttempts:1,action:"playerClose",xAmzSource:["liveplaybackorigin"],statusCode:{min:260,max:260}};t.StreamEndFailoverTableEntry=n}));e(KS);KS.StreamEndFailoverTableEntry;var GS=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("PlaybackUrlsSourceUrlStore"),l="x-amz-live-playback-stream-status",f=((n={}).none=!0,n.seamless=!0,n.manifestService=!0,n.playerClose=!1,n.error=!1,n.discontinuous=!1,n);function u(e){return JSON.stringify(e,freeOnUnref(function(e,t){return t instanceof Error?t.toString():t}),2)}t.formatAcquisitionErrorReasonForLogging=u;var r=freeOnUnref(function(){function e(e,t,n,r,i,o){this.tokenManagers={},this.activeTokenManager=null,this.livePlaybackStreamStatusMap={},this.redirectionHistory={},this.playbackUrls=t,this.onStreamEnd=n,this.onStreamError=r,this.mediaEventController=i,this.activePlaybackConsumptionIdTracker=o,this.playbackResourcesTimestamp=e,this.failoverTracker=new WS.FailoverTracker,this.currentUrlSet=this.playbackUrls.urlSets[this.playbackUrls.defaultUrlSetId],this.eventEmitter=new A.EventEmitter,this.streamEndInitiated=!1,this.initializeTokenManagers(),this.diagnostics=nn.Diagnostics.create("PlaybackUrlsSourceUrlStore")}return e.prototype.get=freeOnUnref(function(){return this.toSourceUrl(this.currentUrlSet)}),e.prototype.getCurrentManifestData=freeOnUnref(function(){return this.currentUrlSet.urls.manifest}),e.prototype.getPlaybackUrls=freeOnUnref(function(){return this.playbackUrls}),e.prototype.resourceAcquired=freeOnUnref(function(e){var t=e.headers["x-amz-source"];WS.FailoverTracker.isMatchingEntry(KS.StreamEndFailoverTableEntry,t,e.status)&&!this.streamEndInitiated&&(this.onStreamEnd(),this.streamEndInitiated=!0),this.updateStreamStatusMap(e.headers[l]),this.failoverTracker.resetFailoverCaseCounter(),null!=e.redirectedUrl&&(null==this.redirectionHistory[e.sourceUrl.urlId]?s.info("URL Set "+e.sourceUrl.urlId+" first redirecting to "+e.redirectedUrl):s.enabledFor(de.DEBUG)&&s.info("URL Set "+e.sourceUrl.urlId+" redirecting from "+this.redirectionHistory[e.sourceUrl.urlId]+" to "+e.redirectedUrl),this.redirectionHistory[e.sourceUrl.urlId]=e.redirectedUrl)}),e.prototype.resourceAcquisitionFailed=freeOnUnref(function(e,t,n,r){if(s.warn("Received acquisition error for "+n+", type: "+Ac.AcquisitionResourceType[t]+", urlId: "+r+", error:\n"+u(e)),this.currentUrlSet.urlSetId!==r)return s.warn("URL ID "+r+" of failed acquisition doesn't match current UrlSetId "+this.currentUrlSet.urlSetId+", ignore failover."),!0;"HttpError"===e.type&&this.updateStreamStatusMap(e.headers[l]);var i=this.tryNonContractualFailover(e);if("none"!==i)return f[i];var o=this.failoverTracker.resourceAcquisitionFailed(e,t);if(null!=o){var a=this.performAction(o.failoverAction,o.failoverCase);if("none"!==a)return f[a]}return f.none}),e.prototype.failover=freeOnUnref(function(e,t,n){null!=n?this.applyFailoverRule(e,t,n):this.performAction(e,t)}),e.prototype.destroy=freeOnUnref(function(){var t=this;Object.keys(this.tokenManagers).forEach(freeOnUnref(function(e){t.tokenManagers[e].stop()})),this.tokenManagers={}}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.tryNonContractualFailover=freeOnUnref(function(e){return"SourceError"===e.type?(this.onStreamError(e.cause),"error"):"none"}),e.prototype.onSourceUrlChanged=freeOnUnref(function(e){null!=this.activeTokenManager&&(this.activeTokenManager.stop(),this.activeTokenManager=null);var t=this.tokenManagers[this.currentUrlSet.urlSetId];null!=t&&(t.start(),this.activeTokenManager=t),this.eventEmitter.emitSync("SourceUrlChange",{newSourceUrl:this.toSourceUrl(this.currentUrlSet),failoverMode:e})}),e.prototype.performAction=freeOnUnref(function(e,t){var n=this.getValidRule(this.currentUrlSet.failover,e,this.currentUrlSet.urlSetId);return null==n?(this.mediaEventController.reportError(!1,new ct.XpError("failover.no_url"),"Player","Error"),"none"):this.applyFailoverRule(e,t,n)}),e.prototype.applyFailoverRule=freeOnUnref(function(e,t,n){t===HS.FailoverCase.StaleManifest&&"origin"===e&&this.mediaEventController.reportStallEvent(!1,"Manifest.Stale"),"origin"===e&&(n=this.selectHealthyOrigin(n));var r,i=this.currentUrlSet;switch(this.currentUrlSet=this.playbackUrls.urlSets[n.urlSetId],s.warn("Switch "+n.mode+" to "+this.currentUrlSet.urlSetId+" with manifest: "+JSON.stringify(this.currentUrlSet.urls.manifest,null,2)),this.mediaEventController.reportFailover({ruleId:t,fromConsumptionId:i.urlSetId,toConsumptionId:this.currentUrlSet.urlSetId}),n.mode){case"seamless":this.onSourceUrlChanged("seamless"),q.metrics.putMetric("Failover.CdnSwitch."+i.urls.manifest.cdn.toLowerCase()),r="seamless";break;case"manifest":this.onSourceUrlChanged("manifest"),q.metrics.putMetric("Failover.Manifest"),r="manifestService";break;default:this.onSourceUrlChanged("discontinuous"),q.metrics.putMetric("Failover.OriginSwitch"),r="discontinuous",this.mediaEventController.reportPlayback("Stop")}this.activePlaybackConsumptionIdTracker.updateConsumptionId(this.currentUrlSet.urlSetId);var o=this.isUrlSetTokenAuthEnabled(i)?"Enabled":"Disabled",a=this.isUrlSetTokenAuthEnabled(this.currentUrlSet)?"Enabled":"Disabled";return q.metrics.putMetric("Failover.TokenAuth."+o+".To."+a,1),this.diagnostics.report("cdnSwitched",{mode:n.mode,from:{urlSetId:i.urlSetId,cdn:i.urls.manifest.cdn,origin:i.urls.manifest.origin},to:{urlSetId:this.currentUrlSet.urlSetId,cdn:this.currentUrlSet.urls.manifest.cdn,origin:this.currentUrlSet.urls.manifest.origin}}),r}),e.prototype.getStreamIdFromRule=freeOnUnref(function(e){return this.playbackUrls.urlSets[e.urlSetId].urls.manifest.livePlaybackStreamId}),e.prototype.getValidRule=freeOnUnref(function(e,t,n){var r=e[t];if(null==r){if(null==(r=e.default))return s.warn("No 'default' rule exists for "+n+", urls exhausted."),null;s.warn("No rule '"+t+"' exists for "+n+". Using 'default' rule.")}return r}),e.prototype.selectHealthyOrigin=freeOnUnref(function(e){for(var t=e,n=this.getStreamIdFromRule(t);null!=n&&n!==this.currentUrlSet.urls.manifest.livePlaybackStreamId;){if(null==this.livePlaybackStreamStatusMap[n]||"DOWN"!==this.livePlaybackStreamStatusMap[n].currentStatus)return t;var r=this.getValidRule(this.playbackUrls.urlSets[t.urlSetId].failover,"origin",t.urlSetId);if(null==r)return e;t=r,n=this.getStreamIdFromRule(t)}return e}),e.prototype.updateStreamStatusMap=freeOnUnref(function(t){if(null!=t)try{var e=JSON.parse(t);this.livePlaybackStreamStatusMap=Qe.deepExtend(this.livePlaybackStreamStatusMap,e)}catch(e){s.error("Failed to parse status: "+t)}}),e.prototype.initializeTokenManagers=freeOnUnref(function(){var n=this;null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.prs&&!0===L.configurationStore.configuration.prs.enableTokenAuth&&(Object.keys(this.playbackUrls.urlSets).forEach(freeOnUnref(function(e){var t=n.playbackUrls.urlSets[e].urls.manifest.edgeDeliveryAuthorization;null!=t&&"PVExchangeV1"===t.authorizationScheme&&(n.tokenManagers[e]=new ih.AccessTokenManager(n.playbackResourcesTimestamp,t.accessTokens,freeOnUnref(function(e){n.mediaEventController.reportAccessTokenAcquisition(e)})),n.currentUrlSet.urlSetId===e&&(n.tokenManagers[e].start(),n.activeTokenManager=n.tokenManagers[e]))})),0<Object.keys(this.tokenManagers).length&&this.mediaEventController.reportCustomMetadata({TokenAuthEnabled:"true"}))}),e.prototype.toSourceUrl=freeOnUnref(function(n){var r=this,e=n.urls.manifest.url;return null!=this.redirectionHistory[n.urlSetId]&&(e=this.redirectionHistory[n.urlSetId]),{url:e,urlId:n.urlSetId,headers:{},adsTrackingEndpoint:n.urls.adsTrackingEndpoint,getAccessToken:freeOnUnref(function(){var e=r.tokenManagers[n.urlSetId];if(null!=e){var t=e.getAccessToken();return t.isValid?{type:"ValidToken",token:t.token}:{type:"ExpiredToken",token:t.token,refreshPromise:t.refreshPromise}}return{type:"NoToken"}})}}),e.prototype.isUrlSetTokenAuthEnabled=freeOnUnref(function(e){var t=e.urls.manifest.edgeDeliveryAuthorization;return null!=t&&"PVExchangeV1"===t.authorizationScheme}),e})();t.PlaybackUrlsSourceUrlStore=r}));e(GS);GS.formatAcquisitionErrorReasonForLogging,GS.PlaybackUrlsSourceUrlStore;var QS=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.Initialize=0]="Initialize",e[e.OriginSwitch=1]="OriginSwitch",e[e.Ready=2]="Ready",e[e.Cancel=3]="Cancel"})(n||(n={})),t.PlaylistSourceAction=n}));e(QS);QS.PlaylistSourceAction;var XS=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Ready=2]="Ready",e[e.SwitchingOrigins=3]="SwitchingOrigins"})(n||(n={})),t.PlaylistSourceState=n}));e(XS);XS.PlaylistSourceState;var YS=t(freeOnUnref(function(e,t){var h=ce&&ce.__assign||freeOnUnref(function(){return(h=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});function k(e){var t=e?e.playbackEnvelope:void 0;return t?t.playbackResourceType:void 0}function _(e){return"LiveChannel"===Qe.nestedValue(e,"streamingType")}function m(e,t,n,r,i,o){var a=0,s=a+e.durationMs;return null!=t.liveSchedule&&0<t.liveSchedule.scheduled.length||o===ka.PlaybackResourceType.Linear||!0===i||null==n.durationMs||(a=null!=n.startTimeMs?Math.min(n.startTimeMs,r.endMs):e.timeWindow.startMs+Qe.withDefault(e.utcMsAtZero,0),s=Math.max(a+n.durationMs,e.timeWindow.endMs+Qe.withDefault(e.utcMsAtZero,0))),{startTime:a,endTime:s}}function r(e,t,n,r,i,o,a,s,l,f){var u=m(o,t,i,a,_(e),k(e)),c=lt.CancelToken.source(),d=c.token,p=c.cancel;return h({},t,{clientId:e.clientId,contentSource:n,encodePreferences:e.encodePreferences,type:s,start:u.startTime,end:u.endTime,timelineStart:u.startTime,timelineEnd:u.endTime,timelineUnit:null!=o.utcMsAtZero?ka.TimeUnit.EpochMillis:ka.TimeUnit.ContentMillis,playlistRelativeConstrainedTimeWindow:a,mediaRepresentation:o,sourceUrlStore:r,downloadOperationId:l,internalCancelToken:d,internalCancelFunction:p,multiviewMetadata:f})}Object.defineProperty(t,"__esModule",{value:!0}),t.getPlaybackResourceTypeFromContentConfig=k,t.isLiveChannelStream=_,t.extractMetadata=m,t.createPlaylistItem=r;var R=de.get("PlaybackUrlsPlaylistSourceHandler"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v,O,S,U,b,P,M,C,E,T,w){var I=this;this.adEventReporter=null,this.audioTrackMetadata=null,this.contentSource=null,this.deferredPlaylistSourcePromise=null,this.frontBufferSetter=null,this.internalOperationCancelFunction=null,this.lookbackConstrainedContentTimeWindow=null,this.mainContentView=null,this.mediaRepresentation=null,this.playlistItemUpdater=void 0,this.playlistRelativeConstrainedTimeWindow=null,this.playlistSourceResolutionCancelToken=null,this.representationSource=null,this.timeWindowEnforcingSeekInterceptor=null,this.timeWindowController=null,this.trackingEventVendingServiceController=null,this.liveAdPlaylistSource=null,this.trackingPositionExtractor=null,this.acquireNewContentSource=freeOnUnref(function(){if(I.licenseAcquirer.uninitialize(),null!=I.internalOperationCancelFunction&&I.internalOperationCancelFunction(),null!=I.frontBufferSetter&&I.frontBufferSetter.terminate(),null!=I.contentSource){var e=I.contentSource.availabilityTimeWindow;R.info("Availability Window prior to new acquisition: "+e.startMs+"-"+e.endMs),I.deregisterFragmentDownloadReporterCallbacks(I.contentSource),I.deregisterHdcpComplianceCallbacks(I.contentSource),I.contentSource.off("fatalError",I.onContentSourceFatalError),I.contentSource.stop()}null!=I.mediaRepresentation&&I.mediaRepresentation.stop(),null!=I.representationSource&&(I.deregisterRepresentationSourceDownloadReporterCallbacks(I.representationSource),I.representationSource.stop(),I.representationSource=null);var t=lt.CancelToken.source(),n=t.token,r=t.cancel;I.internalOperationCancelFunction=r,I.acquireContentSource(n)}),this.handleInitialContentSourceAcquired=freeOnUnref(function(){if(null==I.mediaRepresentation||null==I.contentSource||null==I.lookbackConstrainedContentTimeWindow)return null!=I.deferredPlaylistSourcePromise&&I.deferredPlaylistSourcePromise.reject(new Error("FragmentContentSource acquisition failed")),void I.stateMachine.act(QS.PlaylistSourceAction.Cancel);if(null==I.playlistSourceResolutionCancelToken||I.playlistSourceResolutionCancelToken.requested)return R.warn("Initial FragmentContentSource acquired after cancellation"),void I.stateMachine.act(QS.PlaylistSourceAction.Cancel);I.frontBufferSetter=new wS.FrontBufferSetter(I.titleIdView,I.mpPlayer,I.contentSource,I.playbackSettingsProvider),I.frontBufferSetter.initialize(),I.playlistRelativeConstrainedTimeWindow=new _S.TimeWindowProxy(I.lookbackConstrainedContentTimeWindow,0);var e=I.createLiveEventTimelineMetadata(),t=null!=I.contentMetadata.liveSchedule&&0<I.contentMetadata.liveSchedule.scheduled.length,n=new VS.LiveAdTimelineManager(I.mpPlayer);if(t||k(I.contentConfig)===ka.PlaybackResourceType.Linear||_(I.contentConfig)||null==e.durationMs||null==I.mediaRepresentation.updatePeriodMs||(I.playlistItemUpdater=new qS.PlaybackUrlsPlaylistItemUpdater(I.contentMetadata,I.mainContentView,I.mediaRepresentation,e,I.playlistRelativeConstrainedTimeWindow,n)),I.timeWindowEnforcingSeekInterceptor=new IS.TimeWindowEnforcingSeekInterceptor(I.playlistRelativeConstrainedTimeWindow,I.playlistEngine,I.mainContentView),I.playlistEngine.registerSeekInterceptor(I.timeWindowEnforcingSeekInterceptor),I.timeWindowController=new RS.TimeWindowController(I.mediaRepresentation,I.mpPlayer,I.playlistEngine,I.mainContentView),I.timeWindowController.initialize(),null!=I.sourceUrlStore.get().adsTrackingEndpoint){I.trackingPositionExtractor=FS.TrackingEventReportingServiceControllerFactory.create(I.streamingTechnology),n.setTrackingPositionExtractor(I.trackingPositionExtractor),I.mediaEventController.setLiveAdTimelineManager(n);var r=new BS.TrackingEventsSource(I.trackingPositionExtractor),i=new AS.TrackingEventReportingServiceController(I.mpPlayer,I.adEventReporter,I.sourceUrlStore,I.trackingPositionExtractor,r);I.liveAdPlaylistSource=new jS.LiveAdPlaylistSource(n),I.trackingEventVendingServiceController=new NS.TrackingEventVendingServiceController(I.mpPlayer,I.optOutAdTracking,I.advertisingId,I.sourceUrlStore,I.streamingTechnology,i,r,I.liveAdPlaylistSource),I.trackingEventVendingServiceController.start()}null!=I.deferredPlaylistSourcePromise&&(I.deferredPlaylistSourcePromise.resolve(),I.deferredPlaylistSourcePromise=null),I.internalOperationCancelFunction=null}),this.handleOriginSwitchContentSourceAcquired=freeOnUnref(function(){if(null==I.mediaRepresentation||null==I.contentSource||null==I.lookbackConstrainedContentTimeWindow)return null!=I.deferredPlaylistSourcePromise&&I.deferredPlaylistSourcePromise.reject(new Error("FragmentContentSource acquisition failed")),void I.stateMachine.act(QS.PlaylistSourceAction.Cancel);if(null==I.playlistSourceResolutionCancelToken||I.playlistSourceResolutionCancelToken.requested)return R.warn("Initial FragmentContentSource acquired after cancellation"),void I.stateMachine.act(QS.PlaylistSourceAction.Cancel);var e=I.contentSource.availabilityTimeWindow;R.info(">> new ContentSource acquired after origin switch. New Availability Window: "+e.startMs+"-"+e.endMs),I.frontBufferSetter=new wS.FrontBufferSetter(I.titleIdView,I.mpPlayer,I.contentSource,I.playbackSettingsProvider),I.frontBufferSetter.initialize(),I.mediaEventController.updateMediaRepresentation(I.mediaRepresentation),I.playlistRelativeConstrainedTimeWindow.updateTimeWindow(I.lookbackConstrainedContentTimeWindow),I.timeWindowController.reset(I.mediaRepresentation),I.onOriginFailover({contentSource:I.contentSource,mediaRepresentation:I.mediaRepresentation}),null!=I.playlistItemUpdater&&I.playlistItemUpdater.reset(I.createLiveEventTimelineMetadata(),I.mediaRepresentation),I.globalStreamControl.onReset(),null!=I.liveAdPlaylistSource&&I.liveAdPlaylistSource.reset(),I.internalOperationCancelFunction=null}),this.onSourceUrlChange=freeOnUnref(function(e){"discontinuous"===e.failoverMode&&(R.info("Attempting an origin switch."),I.stateMachine.act(QS.PlaylistSourceAction.OriginSwitch))}),this.reacquireContentSource=freeOnUnref(function(){R.info(">> reacquireContentSource"),null!=I.internalOperationCancelFunction&&I.internalOperationCancelFunction(),null!=I.representationSource&&(I.representationSource.stop(),I.representationSource=null);var e=lt.CancelToken.source(),t=e.token,n=e.cancel;I.internalOperationCancelFunction=n,I.acquireContentSource(t)}),this.reportLicenseAcquisitionSuccess=freeOnUnref(function(e){var t=e;t.consumptionId=I.sourceUrlStore.get().urlId,t.titleId=I.titleIdView.id.titleId,I.mediaEventController.reportLicenseAcquisitionSuccess(t)}),this.reportLicenseAcquisitionFailure=freeOnUnref(function(e){var t=e;t.consumptionId=I.sourceUrlStore.get().urlId,t.titleId=I.titleIdView.id.titleId,I.mediaEventController.reportLicenseAcquisitionFailure(t)}),this.reportFragmentDownloadSuccess=freeOnUnref(function(e){var t=e;t.consumptionId=e.urlId,t.titleId=I.titleIdView.id.titleId,I.mediaEventController.reportFragmentAcquisitionSuccess(t);var n=I.playbackUrls.urlSets[e.urlId];if(null==n)I.sonarEventAdapter.handleFragmentAcquisitionSuccessEvent(e,void 0);else{var r=n.urls.manifest.cdn;I.sonarEventAdapter.handleFragmentAcquisitionSuccessEvent(e,r)}}),this.reportFragmentDownloadFailure=freeOnUnref(function(e){if(null!=e.acquisitionError&&"ParseError"===e.acquisitionError.reason.type){var t=e.acquisitionError.reason.cause;I.mediaEventController.reportError(!1,t,"Player","FragmentParse")}else{var n=e;n.consumptionId=e.urlId,n.titleId=I.titleIdView.id.titleId,I.mediaEventController.reportFragmentAcquisitionFailure(n),I.sonarEventAdapter.handleFragmentAcquisitionFailure(n)}}),this.shutdownSource=freeOnUnref(function(){I.deregisterLicenseAcquisitionReporterCallbacks(I.licenseAcquirer),I.sourceUrlStore.off("SourceUrlChange",I.onSourceUrlChange),I.licenseAcquirer.uninitialize(),null!==I.deferredPlaylistSourcePromise&&I.deferredPlaylistSourcePromise.reject(new lt.CancelError),null!=I.internalOperationCancelFunction&&I.internalOperationCancelFunction(),null!=I.trackingEventVendingServiceController&&I.trackingEventVendingServiceController.stop(),null!=I.timeWindowController&&I.timeWindowController.terminate(),null!=I.timeWindowEnforcingSeekInterceptor&&I.playlistEngine.deregisterSeekInterceptor(I.timeWindowEnforcingSeekInterceptor),null!=I.playlistItemUpdater&&(I.playlistItemUpdater.stop(),I.playlistItemUpdater=void 0),null!=I.frontBufferSetter&&I.frontBufferSetter.terminate(),null!=I.contentSource&&(I.deregisterFragmentDownloadReporterCallbacks(I.contentSource),I.deregisterHdcpComplianceCallbacks(I.contentSource),I.contentSource.off("fatalError",I.onContentSourceFatalError),I.contentSource.stop()),null!=I.mediaRepresentation&&I.mediaRepresentation.stop(),null!=I.representationSource&&(I.deregisterRepresentationSourceDownloadReporterCallbacks(I.representationSource),I.representationSource.stop(),I.representationSource=null),null!=I.liveAdPlaylistSource&&I.liveAdPlaylistSource.reset(),null!=I.sourceUrlStore&&I.sourceUrlStore.destroy()}),this.onContentSourceFatalError=freeOnUnref(function(e){e instanceof ct.XpError&&"content_src.manifest.parse"===e.code?I.mediaEventController.reportError(!0,e,"Player","ManifestParse"):I.mediaEventController.reportError(!0,e,"Player","Error"),I.globalStreamControl.onStreamFatalError(e)}),this.reportRepresentationSourceDownloadSuccess=freeOnUnref(function(e){var t=I.sourceUrlStore.get().urlId;null!=e.sourceUrl&&(t=e.sourceUrl.urlId);var n=e;n.consumptionId=t,n.titleId=I.titleIdView.id.titleId,I.mediaEventController.reportManifestAcquisitionSuccess(n),I.sonarEventAdapter.handleManifestFetchedEvent()}),this.reportRepresentationSourceDownloadFailure=freeOnUnref(function(e){var t=e;t.consumptionId=e.sourceUrl.urlId,t.titleId=I.titleIdView.id.titleId,I.mediaEventController.reportManifestAcquisitionFailure(t),I.sonarEventAdapter.handleManifestAcquisitionFailure(t)}),this.registerRepresentationSourceDownloadReporterCallbacks=freeOnUnref(function(e){e.on("downloadComplete",I.reportRepresentationSourceDownloadSuccess),e.on("failure",I.reportRepresentationSourceDownloadFailure)}),this.onStateChangeError=freeOnUnref(function(e){null!=I.deferredPlaylistSourcePromise?I.deferredPlaylistSourcePromise.reject(e):I.globalStreamControl.onStreamFatalError(e)}),this.onStreamRestartNeeded=freeOnUnref(function(e){var t=e.videoQuality;I.globalStreamControl.onStreamRestart(I.contentConfig,{videoQuality:t})}),this.acquireLicenseWithStreamRestart=freeOnUnref(function(e,t,n){return I.licenseAcquirer.acquireLicense(e,t,n).catch(freeOnUnref(function(e){if(I.shouldTriggerStreamRestart(e)){var t=e instanceof ct.XpError?e.code:e.message;return R.info("Triggering stream restart due to DRM error "+t),I.globalStreamControl.onStreamRestart(I.contentConfig,{bypassCache:!0}),lt.Promise.reject(new lt.CancelError)}throw e}))}),this.streamingTechnology=e,this.adEventReporter=n,this.mediaKeysManager=P,this.mpPlayer=i,this.playlistEngine=o,this.titleIdView=a,this.contentConfig=s,this.contentMetadata=l,this.playbackSettingsProvider=f,this.prioritizationSystem=u,this.playerBufferManager=c,this.streamFeature=d,this.initialPlaybackPositionTracker=p,this.videoPreviewFeature=h,this.hdcpStore=m,this.mediaEventController=y,this.globalStreamControl=v,this.optOutAdTracking=O,this.resolutionCappingStrategy=S,this.advertisingId=M,this.suggestedPictureModes=C,this.fairPlayDrmCertificate=E,this.downloadOperationId=T,this.onOriginFailover=U,this.sonarEventAdapter=b,this.mediaPlayerConfig=w,this.licenseAcquirer=r.licenseAcquirer,this.registerLicenseAcquisitionReporterCallbacks(this.licenseAcquirer),this.playbackUrls=r.playbackUrls,this.activePlaybackConsumptionIdTracker=new bS.ActivePlaybackConsumptionIdTracker(g,this.titleIdView,this.playbackUrls.defaultUrlSetId),this.activePlaybackConsumptionIdTracker.initialize(),this.sourceUrlStore=new GS.PlaybackUrlsSourceUrlStore(t,this.playbackUrls,v.onStreamEnd,v.onStreamError,y,this.activePlaybackConsumptionIdTracker),this.fallbackLanguageStreamMatchers=Hf.fromPlaybackUrls(this.playbackUrls),this.audioTrackMetadata=Hf.mapAudioTracks(this.playbackUrls.audioTracks),this.sourceUrlStore.on("SourceUrlChange",this.onSourceUrlChange),this.stateMachine=new ml.FiniteStateMachine(XS.PlaylistSourceState.Uninitialized),this.setupStateMachine()}return e.prototype.createContent=freeOnUnref(function(e,t){var n=this;return this.playlistSourceResolutionCancelToken=t,this.mainContentView=e,t.promise.then(freeOnUnref(function(){null!=n.internalOperationCancelFunction&&n.internalOperationCancelFunction(),n.stateMachine.act(QS.PlaylistSourceAction.Cancel),n.playlistSourceResolutionCancelToken=null,n.activePlaybackConsumptionIdTracker.terminate()})),null===this.deferredPlaylistSourcePromise&&(this.deferredPlaylistSourcePromise=new lt.Deferred),R.info("Manifest URL:",this.sourceUrlStore.get().url),this.stateMachine.act(QS.PlaylistSourceAction.Initialize),this.deferredPlaylistSourcePromise.promise.then(freeOnUnref(function(){if(null===n.contentSource||null===n.lookbackConstrainedContentTimeWindow||null===n.mediaRepresentation||null===n.playlistRelativeConstrainedTimeWindow)throw new Error("Failed to create FragmentContentSource!");return{playlistItems:[r(n.contentConfig,n.contentMetadata,n.contentSource,n.sourceUrlStore,n.createLiveEventTimelineMetadata(),n.mediaRepresentation,n.playlistRelativeConstrainedTimeWindow,"Main",void 0,n.playbackUrls.multiviewMetadata)],playlistItemUpdater:n.playlistItemUpdater}})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;throw R.error(e),n.mediaEventController.reportError(!1,e,"Player","Unknown"),e}))}),e.prototype.acquireContentSource=freeOnUnref(function(i){var o=this;lt.Promise.resolve().then(freeOnUnref(function(){i.throwIfRequested(),o.licenseAcquirer.initialize();var e=null!=o.downloadOperationId?1:void 0,t=Ty.ContentSourceFactory.create(o.acquireLicenseWithStreamRestart,o.fallbackLanguageStreamMatchers,o.playbackSettingsProvider,o.prioritizationSystem,o.playerBufferManager,o.sourceUrlStore,o.streamingTechnology,o.contentMetadata.playbackData.videoMaterialType,o.audioTrackMetadata,o.contentMetadata.staticTimedTextStreams,o.hdcpStore,o.mediaKeysManager,o.downloadOperationId,o.resolutionCappingStrategy,o.videoPreviewFeature.getSeekPreviewRestriction(),e,o.streamFeature.getCurrentMatchers(),o.registerRepresentationSourceDownloadReporterCallbacks,o.suggestedPictureModes,o.fairPlayDrmCertificate,void 0,o.mediaPlayerConfig,o.mediaEventController.traceEventController),n=t.cancel,r=t.contentSourceContextPromise;return i.promise.then(freeOnUnref(function(){n()})),r})).then(freeOnUnref(function(e){i.throwIfRequested();var t=e.representationSource,n=e.mediaRepresentation,r=e.contentSource;o.initializeContentSource(r),o.representationSource=t,o.mediaRepresentation=n,o.contentSource=r,o.lookbackConstrainedContentTimeWindow=new kS.ConstrainedLookbackTimeWindow(r.availabilityTimeWindow,o.initialPlaybackPositionTracker,o.contentMetadata.playbackData.liveLookbackPolicy),o.initialPlaybackPositionTracker.updateContentTimeWindow(r.availabilityTimeWindow),o.stateMachine.act(QS.PlaylistSourceAction.Ready)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||(o.stateMachine.act(QS.PlaylistSourceAction.Cancel),o.deferredPlaylistSourcePromise.reject(e))}))}),e.prototype.initializeContentSource=freeOnUnref(function(e){for(var t=this.streamFeature.getCurrentMaxBitrateThresholds(),n=0,r=Object.keys(t);n<r.length;n++){var i=t[l=r[n]];null!=i&&e.setMaxBitrateThreshold(l,"External",i)}for(var o=this.streamFeature.getCurrentUnsupportedCodecs(),a=0,s=Object.keys(o);a<s.length;a++){var l,f=o[l=s[a]];null!=f&&e.setUnsupportedCodecs(l,f)}this.registerFragmentDownloadReporterCallbacks(e),this.registerHdcpComplianceCallbacks(e),e.on("fatalError",this.onContentSourceFatalError)}),e.prototype.registerLicenseAcquisitionReporterCallbacks=freeOnUnref(function(e){e.on("licenseAcquired",this.reportLicenseAcquisitionSuccess),e.on("licenseAcquisitionFailed",this.reportLicenseAcquisitionFailure)}),e.prototype.deregisterLicenseAcquisitionReporterCallbacks=freeOnUnref(function(e){e.off("licenseAcquired",this.reportLicenseAcquisitionSuccess),e.off("licenseAcquisitionFailed",this.reportLicenseAcquisitionFailure)}),e.prototype.setupStateMachine=freeOnUnref(function(){var r=this;this.stateMachine.addTransition(XS.PlaylistSourceState.Uninitialized,QS.PlaylistSourceAction.Initialize,XS.PlaylistSourceState.Initializing),this.stateMachine.addTransition(XS.PlaylistSourceState.Initializing,QS.PlaylistSourceAction.Cancel,XS.PlaylistSourceState.Uninitialized),this.stateMachine.addTransition(XS.PlaylistSourceState.Initializing,QS.PlaylistSourceAction.OriginSwitch,XS.PlaylistSourceState.Initializing),this.stateMachine.addTransition(XS.PlaylistSourceState.Initializing,QS.PlaylistSourceAction.Ready,XS.PlaylistSourceState.Ready),this.stateMachine.addTransition(XS.PlaylistSourceState.Ready,QS.PlaylistSourceAction.Cancel,XS.PlaylistSourceState.Uninitialized),this.stateMachine.addTransition(XS.PlaylistSourceState.Ready,QS.PlaylistSourceAction.OriginSwitch,XS.PlaylistSourceState.SwitchingOrigins),this.stateMachine.addTransition(XS.PlaylistSourceState.SwitchingOrigins,QS.PlaylistSourceAction.Cancel,XS.PlaylistSourceState.Uninitialized),this.stateMachine.addTransition(XS.PlaylistSourceState.SwitchingOrigins,QS.PlaylistSourceAction.OriginSwitch,XS.PlaylistSourceState.SwitchingOrigins),this.stateMachine.addTransition(XS.PlaylistSourceState.SwitchingOrigins,QS.PlaylistSourceAction.Ready,XS.PlaylistSourceState.Ready),this.stateMachine.onEnterState(XS.PlaylistSourceState.Initializing,freeOnUnref(function(){if(null!=r.playlistSourceResolutionCancelToken&&!r.playlistSourceResolutionCancelToken.requested){var e=lt.CancelToken.source(),t=e.token,n=e.cancel;r.internalOperationCancelFunction=n,r.acquireContentSource(t)}})),this.stateMachine.onEnterState(XS.PlaylistSourceState.Uninitialized,this.shutdownSource),this.stateMachine.onReenterState(XS.PlaylistSourceState.Initializing,this.reacquireContentSource),this.stateMachine.onReenterState(XS.PlaylistSourceState.SwitchingOrigins,this.reacquireContentSource),this.stateMachine.onTransition(XS.PlaylistSourceState.Initializing,QS.PlaylistSourceAction.Ready,this.handleInitialContentSourceAcquired),this.stateMachine.onTransition(XS.PlaylistSourceState.Ready,QS.PlaylistSourceAction.OriginSwitch,this.acquireNewContentSource),this.stateMachine.onTransition(XS.PlaylistSourceState.SwitchingOrigins,QS.PlaylistSourceAction.Ready,this.handleOriginSwitchContentSourceAcquired),this.stateMachine.onIllegalTransition(freeOnUnref(function(e,t,n){R.error("IllegalTransitionError from action ["+QS.PlaylistSourceAction[t]+"] while in state ["+XS.PlaylistSourceState[e]+"]")})),this.stateMachine.onUncaughtException(this.onStateChangeError)}),e.prototype.registerFragmentDownloadReporterCallbacks=freeOnUnref(function(e){e.on("fragmentDownloaded",this.reportFragmentDownloadSuccess),e.on("fragmentDownloadFailed",this.reportFragmentDownloadFailure)}),e.prototype.deregisterFragmentDownloadReporterCallbacks=freeOnUnref(function(e){e.off("fragmentDownloaded",this.reportFragmentDownloadSuccess),e.off("fragmentDownloadFailed",this.reportFragmentDownloadFailure)}),e.prototype.deregisterRepresentationSourceDownloadReporterCallbacks=freeOnUnref(function(e){e.off("downloadComplete",this.reportRepresentationSourceDownloadSuccess),e.off("failure",this.reportRepresentationSourceDownloadFailure)}),e.prototype.createLiveEventTimelineMetadata=freeOnUnref(function(){var e=this.sourceUrlStore.getCurrentManifestData(),t={};return null!=e.startTime&&(t.startTimeMs=new Date(e.startTime).getTime()),null!=e.duration&&(t.durationMs=e.duration),t}),e.prototype.registerHdcpComplianceCallbacks=freeOnUnref(function(e){e.on("streamRestartNeeded",this.onStreamRestartNeeded)}),e.prototype.deregisterHdcpComplianceCallbacks=freeOnUnref(function(e){e.off("streamRestartNeeded",this.onStreamRestartNeeded)}),e.prototype.shouldTriggerStreamRestart=freeOnUnref(function(e){return e instanceof ct.XpError&&-1!==e.code.indexOf("drm_service.session_handoff_mismatch")}),e})();t.PlaybackUrlsPlaylistSourceHandler=n}));e(YS);YS.getPlaybackResourceTypeFromContentConfig,YS.isLiveChannelStream,YS.extractMetadata,YS.createPlaylistItem,YS.PlaybackUrlsPlaylistSourceHandler;var JS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.formatPlaylistedMediaRepresentation=function(e){var a=new au.TableFormatterGeneric;return e.periods.contents.forEach(freeOnUnref(function(e,t){var n=e.startMs,r=e.endMs,i=r-n,o=e.periodType;a.addRow({index:t,type:o,timeMs:"{"+n+", "+r+"}",durationMs:i,duration:jr.millisecondsToExtendedLimitedIso8601TimeFormat(i),id:e.id})})),a.renderString()},t.formatPlaylist=function(s){var l=new au.TableFormatterGeneric;return s.getItems().forEach(freeOnUnref(function(e,t){var n=e.start,r=null!=e.end?e.end:1/0,i=r-n,o=null;null!=e.playlistedItemId&&(o=e.playlistedItemId);var a=e.hasUnresolvedAdBreakBefore?"(*)":"";l.addRow({index:(t===s.getCurrentItemIndex()?"> ":"  ")+t,type:""+e.type+a,timeMs:"{"+n+", "+r+"}",timelineMs:"{"+e.timelineStart+", "+e.timelineEnd+"}",durationMs:i,duration:jr.millisecondsToExtendedLimitedIso8601TimeFormat(i),playlistedItemId:o})})),l.renderString()},t.formatTimeline=function(s){var l=new au.TableFormatterGeneric;return s.items.forEach(freeOnUnref(function(e,t){var n=e.startTime,r=e.endTime,i=null;null!=n&&null!=r&&(i=r-n);var o=s.contentInfos[e.contentId].contentType,a=null!=s.timeData?s.timeData.currentTimelineItemIndex:-1;l.addRow({index:(t===a?"> ":"  ")+t,type:o,timeMs:"{"+n+", "+r+"}",durationMs:i,duration:null!=i?jr.millisecondsToExtendedLimitedIso8601TimeFormat(i):null})})),l.renderString()}}));e(JS);JS.formatPlaylistedMediaRepresentation,JS.formatPlaylist,JS.formatTimeline;var ZS=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.playbackUrls=e,this.currentUrlSet=this.playbackUrls.urlSets[this.playbackUrls.defaultUrlSetId]}return e.prototype.get=freeOnUnref(function(){return this.toSourceUrl(this.currentUrlSet)}),e.prototype.resourceAcquired=freeOnUnref(function(e){}),e.prototype.resourceAcquisitionFailed=freeOnUnref(function(e,t,n,r){return!0}),e.prototype.on=freeOnUnref(function(e,t){}),e.prototype.off=freeOnUnref(function(e,t){}),e.prototype.toSourceUrl=freeOnUnref(function(e){return{url:e.urls.manifest.url,urlId:e.urlSetId,headers:{},adsTrackingEndpoint:e.urls.adsTrackingEndpoint,getAccessToken:freeOnUnref(function(){return{type:"NoToken"}})}}),e})();t.OfflineSourceUrlStore=n}));e(ZS);ZS.OfflineSourceUrlStore;var $S=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("OfflineContentPlaylistSource"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v){var O=this;this.audioTrackMetadata=null,this.cancelContentSourceCreation=null,this.contentSource=null,this.frontBufferSetter=null,this.mainContentView=null,this.mediaRepresentation=null,this.representationSource=null,this.timeWindowController=null,this.timeWindowEnforcingSeekInterceptor=null,this.onContentSourceFatalError=freeOnUnref(function(e){e instanceof ct.XpError&&"content_src.manifest.parse"===e.code?O.mediaEventController.reportError(!0,e,"Player","ManifestParse"):O.mediaEventController.reportError(!0,e,"Player","Error"),O.globalStreamControl.onStreamFatalError(e)}),this.contentConfig=e,this.contentMetadata=t,this.downloadOperationId=n,this.globalStreamControl=r,this.hdcpStore=i,this.mediaEventController=o,this.mpPlayer=a,this.playbackSettingsProvider=s,this.licenseAcquirer=f,this.mediaKeysManager=g,this.prioritizationSystem=u,this.playerBufferManager=c,this.playlistEngine=d,this.resolutionCappingStrategy=y,this.streamFeature=h,this.videoPreviewFeature=m,this.titleIdView=p,this.suggestedPictureModes=v,this.sourceUrlStore=new ZS.OfflineSourceUrlStore(l),this.audioTrackMetadata=Hf.mapAudioTracks(l.audioTracks),this.fallbackLanguageStreamMatchers=Hf.fromPlaybackUrls(l)}return e.prototype.initializeContent=freeOnUnref(function(i){var o=this,a=Jy.PlaylistRelativeView.fromView(this.titleIdView,{type:"Main"});this.mainContentView=a,i.promise.then(freeOnUnref(function(){o.cleanupPlaylistSource()}));var e=Ty.ContentSourceFactory.create(freeOnUnref(function(e,t,n){return o.licenseAcquirer.acquireLicense(e,t,n)}),this.fallbackLanguageStreamMatchers,this.playbackSettingsProvider,this.prioritizationSystem,this.playerBufferManager,this.sourceUrlStore,"DASH",this.contentMetadata.playbackData.videoMaterialType,this.audioTrackMetadata,this.contentMetadata.staticTimedTextStreams,this.hdcpStore,this.mediaKeysManager,this.downloadOperationId,this.resolutionCappingStrategy,this.videoPreviewFeature.getSeekPreviewRestriction(),1,this.streamFeature.getCurrentMatchers(),void 0,this.suggestedPictureModes),t=e.cancel,n=e.contentSourceContextPromise;return this.cancelContentSourceCreation=t,n.then(freeOnUnref(function(e){i.throwIfRequested();var t=e.representationSource,n=e.mediaRepresentation,r=e.contentSource;return o.initializePlaylistSourceComponents(r,n,r.availabilityTimeWindow),o.initializeContentSource(r),o.representationSource=t,o.mediaRepresentation=n,o.contentSource=r,a}))}),e.prototype.cleanupPlaylistSource=freeOnUnref(function(){null!=this.timeWindowController&&this.timeWindowController.terminate(),null!=this.timeWindowEnforcingSeekInterceptor&&this.playlistEngine.deregisterSeekInterceptor(this.timeWindowEnforcingSeekInterceptor),null!=this.frontBufferSetter&&this.frontBufferSetter.terminate(),null!=this.contentSource&&(this.contentSource.off("fatalError",this.onContentSourceFatalError),this.contentSource.stop()),null!=this.mediaRepresentation&&this.mediaRepresentation.stop(),null!=this.representationSource?this.representationSource.stop():null!=this.cancelContentSourceCreation&&this.cancelContentSourceCreation()}),e.prototype.initializeContentSource=freeOnUnref(function(e){for(var t=this.streamFeature.getCurrentMaxBitrateThresholds(),n=0,r=Object.keys(t);n<r.length;n++){var i=t[l=r[n]];null!=i&&e.setMaxBitrateThreshold(l,"External",i)}for(var o=this.streamFeature.getCurrentUnsupportedCodecs(),a=0,s=Object.keys(o);a<s.length;a++){var l,f=o[l=s[a]];null!=f&&e.setUnsupportedCodecs(l,f)}e.on("fatalError",this.onContentSourceFatalError),this.frontBufferSetter=new wS.FrontBufferSetter(this.titleIdView,this.mpPlayer,e,this.playbackSettingsProvider),this.frontBufferSetter.initialize()}),e.prototype.initializePlaylistSourceComponents=freeOnUnref(function(e,t,n){var r=new _S.TimeWindowProxy(n,0),i=YS.createPlaylistItem(this.contentConfig,this.contentMetadata,e,this.sourceUrlStore,{},t,r,"Main",this.downloadOperationId);this.mainContentView.appendItem(i),o.info("Playlist created:\n"+JS.formatPlaylist(this.mainContentView.playlistEngine)),this.timeWindowEnforcingSeekInterceptor=new IS.TimeWindowEnforcingSeekInterceptor(r,this.playlistEngine,this.mainContentView),this.playlistEngine.registerSeekInterceptor(this.timeWindowEnforcingSeekInterceptor),this.timeWindowController=new RS.TimeWindowController(t,this.mpPlayer,this.playlistEngine,this.mainContentView),this.timeWindowController.initialize()}),e})();t.OfflineContentPlaylistSource=n}));e($S);$S.OfflineContentPlaylistSource;var eU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("ResolutionCappingStrategyTypeMap");t.mapToContentSourceResolutionCappingStrategy=function(e){switch(e){case"PlayerViewportSize":return"PlayerViewportSize";case"ApplicationViewportSize":return"ApplicationViewportSize";default:return n.warn("Non-standard resolution strategy:",e),"ApplicationViewportSize"}}}));e(eU);eU.mapToContentSourceResolutionCappingStrategy;var tU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(e){var i=t.call(this,[])||this;return i.calculateAndUpdateAdBreaks=freeOnUnref(function(){for(var e=[],t=0,n=i.playlistEngine.getItems();t<n.length;t++){var r=n[t];"Ad"!==r.type&&"AdTransition"!==r.type&&"Aux"!==r.type||e.push({timestampMs:r.start,durationMs:r.end-r.start})}i.updateAdBreaks(e)}),i.playlistEngine=e,i.calculateAndUpdateAdBreaks(),i.playlistEngine.on("PlaylistUpdate",i.calculateAndUpdateAdBreaks),i}return n(e,t),e.prototype.terminate=freeOnUnref(function(){this.playlistEngine.off("PlaylistUpdate",this.calculateAndUpdateAdBreaks)}),e})(OS.MainContentTimeTranslator);t.PlaylistedMainContentTimeTranslator=r}));e(tU);tU.PlaylistedMainContentTimeTranslator;var nU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.getMediaPlayerConfig=function(e,t){var n=e.videoMaterialType,r=e.titleId,i=e.allowFrameRateMatching,o=e.hlsMinimumBitrateKbps,a={};if(null!=i&&(a.allowFrameRateMatching=i),null!=o&&(a.hlsMinimumBitrateKbps=o),"LiveStreaming"===n){var s=L.configurationStore.configuration,l=Qe.nestedValue(zt.deviceInformation,"hardware.model.name"),f=["elementaryStream","mediaBufferSizeMs"],u=null!=t?t.multiviewMetadata:null,c=null!=u&&0<u.length?2e3:null,d=Qe.nestedValue(s,f.concat([l,r]))||Qe.nestedValue(s,f.concat([r]))||Qe.nestedValue(s,f.concat([l]))||Qe.nestedValue(s,f)||c;null!=d&&"number"==typeof d&&(a.mediaBufferSizeMs={audio:d})}return a}}));e(nU);nU.getMediaPlayerConfig;var rU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l;freeOnUnref(function(e){e[e.Start=1]="Start",e[e.End=3]="End"})(l||(l={}));var f=de.get("AuditPingListener"),n=freeOnUnref(function(){function e(e,t,n,r,i){var o=this;this.hasReportedStart=!1,this.hasReportedStop=!1,this.onEnterView=freeOnUnref(function(){o.hasReportedStop&&(o.hasReportedStart=!1,o.hasReportedStop=!1),f.info("Audit Ping Stream ID:",o.streamId),o.mediaEventController.updateAuditPings(o.auditPings,o.streamId),o.mpPlayer.on("contentStateChange",o.onContentStateChange),o.mpPlayer.on("playbackStateChange",o.onPlaybackStateChange),o.tryReportAuditPingStart()}),this.onExitView=freeOnUnref(function(){if(o.mpPlayer.off("contentStateChange",o.onContentStateChange),o.mpPlayer.off("playbackStateChange",o.onPlaybackStateChange),!o.titleView.isActive()&&o.hasReportedStart&&!o.hasReportedStop){for(var e=0,t=o.auditPings;e<t.length;e++){var n=t[e];o.reportAuditPing(n.url,3)}o.hasReportedStop=!0}o.mediaEventController.updateAuditPings(null,null)}),this.onContentStateChange=freeOnUnref(function(e){o.tryReportAuditPingStart()}),this.onPlaybackStateChange=freeOnUnref(function(e){o.tryReportAuditPingStart()}),this.hashedPlayerSessionId=this.hash(e),this.streamId=Vy.UUID.v4(),this.hashedStreamSessionId=this.hash(this.streamId),this.mpPlayer=t,this.auditPings=n,this.titleView=r,this.mediaEventController=i,this.beaconServiceClient=new $y.BeaconServiceClient}return e.prototype.initialize=freeOnUnref(function(){this.titleView.on("EnterView",this.onEnterView),this.titleView.on("ExitView",this.onExitView)}),e.prototype.terminate=freeOnUnref(function(){this.titleView.off("EnterView",this.onEnterView),this.titleView.off("ExitView",this.onExitView),this.onExitView()}),e.prototype.tryReportAuditPingStart=freeOnUnref(function(){if("ready"===this.mpPlayer.contentState&&"playing"===this.mpPlayer.playbackState&&!this.hasReportedStart){for(var e=0,t=this.auditPings;e<t.length;e++){var n=t[e];this.reportAuditPing(n.url,1)}this.hasReportedStart=!0}}),e.prototype.reportAuditPing=freeOnUnref(function(i,o){var a=this;f.info("Reporting audit pings with url "+i+" and ping type "+o);var s=Math.floor(Date.now()/1e3);(new _n.ExponentialBackoffRetry).withMaxAttempts(4).withInitialIntervalMs(100).withExponentialFactor(2).withRandomizationFactor(1e3).onAttempt(freeOnUnref(function(e,t,n,r){f.info("Audit ping attempt "+e+" for "+l[o]+": "+i),a.sendRequest(i,o,s,freeOnUnref(function(){return n(null)}),t,r)})).onError(freeOnUnref(function(e){f.error("Failed to send audit ping after 4 attempts for "+i,e)})).onSuccess(freeOnUnref(function(){f.info("Successfully sent audit ping for url "+i+" with ping type "+l[o])})).execute()}),e.prototype.sendRequest=freeOnUnref(function(e,t,n,r,i,o){var a=new mt.URL(e),s={sessionid:this.hashedPlayerSessionId,streamid:this.hashedStreamSessionId,pingtype:t,uoo:0,createtm:n};mt.URLUtils.appendQueryParams(a,s),f.info("Sending audit ping "+a.toString()),this.beaconServiceClient.sendAuditPing(a.toString(),r,i,o)}),e.prototype.hash=freeOnUnref(function(e){return Ot.hex_sha256(e)}),e})();t.AuditPingListener=n}));e(rU);rU.AuditPingListener;var iU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("LiveMetadataPlaylistUpdater"),n=freeOnUnref(function(){function e(e){this.playlistRelativeView=e}return e.prototype.updateLiveMetadata=freeOnUnref(function(e,t){null!=e&&(this.liveSchedule=e,this.updateViewWithSchedule(e)),null!=t&&this.updateViewWithRestrictions(t,this.liveSchedule),i.info("Playlist after updating live metadata:\n"+JS.formatPlaylist(this.playlistRelativeView.playlistEngine))}),e.prototype.updateViewWithSchedule=freeOnUnref(function(e){if(0!==e.scheduled.length){for(var t=this.playlistRelativeView.getItems()[0].start,n=0,r=e.scheduled;n<r.length;n++){var i=r[n],o=1e3*i.time.startTime,a=1e3*i.time.endTime;o!==t&&this.updateView(t,o,{timelineStart:t,timelineEnd:o,timelineUnit:ka.TimeUnit.EpochMillis},"Live schedule gap"),this.updateView(o,a,{catalogMetadata:i.title,liveScheduleTitleId:i.titleId,liveScheduleChannelID:e.channelID,timelineStart:o,timelineEnd:a,timelineUnit:ka.TimeUnit.EpochMillis},"Live schedule update"),t=a}this.updateView(t,1/0,{timelineStart:t,timelineEnd:1/0,timelineUnit:ka.TimeUnit.EpochMillis},"Live schedule future timeline")}}),e.prototype.updateView=freeOnUnref(function(e,t,n,r){try{this.playlistRelativeView.update(e,t,n)}catch(e){i.error(r+". Failed to update main content view:",e)}}),e.prototype.updateViewWithRestrictions=freeOnUnref(function(o,a){if(null!=a)for(var e=freeOnUnref(function(n){var r=n.startTime;if(null==n.restriction)return"continue";var e=x.find(a.scheduled,freeOnUnref(function(e){var t=1e3*e.time.startTime;return x.contains(n.identifiers,e.titleId)&&In.isApprxEqual(t,r,9e5)}));if(null!=e){var t=1e3*e.time.startTime,i=1e3*e.time.endTime;s.updateView(t,i,{pinRestrictions:{pinLength:o.metadata.customerPin.length,restrictions:[n.restriction]}},"LinearRestrictions")}}),s=this,t=0,n=o.programs;t<n.length;t++){e(n[t])}var r={};null!=o.defaultRestriction.restriction&&(r={pinLength:o.metadata.customerPin.length,restrictions:[o.defaultRestriction.restriction]});for(var i=0,l=this.playlistRelativeView.getItems();i<l.length;i++){var f=l[i];if(null==f.pinRestrictions){var u=f.start,c=null===f.end?1/0:f.end;this.updateView(u,c,{pinRestrictions:r},"DefaultRestrictions")}}}),e})();t.LiveMetadataPlaylistUpdater=n}));e(iU);iU.LiveMetadataPlaylistUpdater;var oU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("LiveMetadataRequestScheduler"),r=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.onEnterView=freeOnUnref(function(){i.scheduleRefresher.start(36e5)}),this.onNewSchedule=freeOnUnref(function(e){e.liveSchedule.ok||i.reportResourceFailure(e.liveSchedule.error,"LiveSchedule"),e.linearRestrictions.ok||i.reportResourceFailure(e.linearRestrictions.error,"LinearRestrictions"),i.liveMetadataPlaylistUpdater.updateLiveMetadata(Hf.PlaybackResourceUtils.valueOrUndefined(e.liveSchedule),Hf.PlaybackResourceUtils.valueOrUndefined(e.linearRestrictions))}),this.onRefreshError=freeOnUnref(function(e){i.mediaEventController.reportError(!1,e,"Service","Error")}),this.view=t,this.liveMetadataPlaylistUpdater=n,this.mediaEventController=r,this.scheduleRefresher=e,this.scheduleRefresher.on("schedule",this.onNewSchedule),this.scheduleRefresher.on("error",this.onRefreshError)}return e.prototype.initialize=freeOnUnref(function(){this.view.on("EnterView",this.onEnterView)}),e.prototype.terminate=freeOnUnref(function(){this.view.off("EnterView",this.onEnterView),this.scheduleRefresher.stop()}),e.prototype.reportResourceFailure=freeOnUnref(function(e,t){n.error("Resource request failure",e),q.metrics.putMetric("ServiceRequest.PRS."+t+".Error"),this.mediaEventController.reportError(!1,e,"Service","Error")}),e})();t.LiveMetadataRequestScheduler=r}));e(oU);oU.LiveMetadataRequestScheduler;var aU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.onEnterView=freeOnUnref(function(){i.applyPlaybackSettings(i.playbackSettingsProvider.playbackSettings),i.playbackSettingsProvider.start(),i.playbackSettingsProvider.onUpdate(i.onPlaybackSettingsUpdated)}),this.onExitView=freeOnUnref(function(){i.playbackSettingsProvider.offUpdate(i.onPlaybackSettingsUpdated),i.playbackSettingsProvider.stop()}),this.onPlaybackSettingsUpdated=freeOnUnref(function(e){i.applyPlaybackSettings(e)}),this.mediaEventController=e,this.titleView=t,this.playbackSettingsId=n,this.playbackSettingsProvider=r}return e.prototype.initialize=freeOnUnref(function(){this.titleView.on("EnterView",this.onEnterView),this.titleView.on("ExitView",this.onExitView)}),e.prototype.terminate=freeOnUnref(function(){this.titleView.off("EnterView",this.onEnterView),this.titleView.off("ExitView",this.onExitView),this.onExitView()}),e.prototype.applyPlaybackSettings=freeOnUnref(function(e){var t,n,r,i,o,a,s,l,f,u,c,d;this.mediaEventController.updateBufferSettings(e.buffer),this.mediaEventController.updatePlaybackSettings(this.playbackSettingsId,e),n=(t=e).bandwidthPredictor,r=t.latencyPredictor,i=t.retention,o=t.scheduler,a=n.averageFragmentWindow,s=n.stdDevFragmentWindow,l=r.averageFragmentWindow,f=r.stdDevFragmentWindow,u=i.fragmentsToRetain,c=o.maxConcurrentRequests,d=o.linearizationPotential,_c.getInstance().updateConfig({networkStatisticsWindows:{bandwidthAverageWindow:a,bandwidthStdDevWindow:s,latencyAvgWindow:l,latencyStdDevWindow:f},eventStorageToRetain:u,maxConcurrentRequests:c,linearizationPotential:d})}),e})();t.PlaybackSettingsPlaylistListener=n}));e(aU);aU.PlaybackSettingsPlaylistListener;var sU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("SonarPlaylistListener"),n=freeOnUnref(function(){function e(e,t){var n=this;this.onEnterView=freeOnUnref(function(){n.sonarEventAdapter.updateTitleId(n.titlePerContentView.id.titleId);var e=n.titlePerContentView.getItems()[0];null!=e&&(null!=e.initializeContentCallback?e.initializeContentCallback().then(freeOnUnref(function(){n.cancelToken.throwIfRequested(),n.onTitleViewUpdate(e)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||a.error("Error happened when processing a deferred content",e)})):n.onTitleViewUpdate(e))}),this.onExitView=freeOnUnref(function(){n.sonarEventAdapter.removeContentSource()}),this.sonarEventAdapter=e,this.titlePerContentView=t;var r=lt.CancelToken.source(),i=r.token,o=r.cancel;this.cancelFunction=o,this.cancelToken=i}return e.prototype.initialize=freeOnUnref(function(){this.titlePerContentView.on("EnterView",this.onEnterView),this.titlePerContentView.on("ExitView",this.onExitView)}),e.prototype.terminate=freeOnUnref(function(){this.cancelFunction(),this.titlePerContentView.off("EnterView",this.onEnterView),this.titlePerContentView.off("ExitView",this.onExitView)}),e.prototype.onTitleViewUpdate=freeOnUnref(function(e){e.contentSource instanceof nf.LiveLowLatencyContentSource&&this.sonarEventAdapter.setContentSource(e.contentSource)}),e})();t.SonarPlaylistListener=n}));e(sU);sU.SonarPlaylistListener;var lU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("VmapTrackingEventListener"),r=freeOnUnref(function(){function e(e,t,n,r,i,o){var a=this;this.lastReportedStartAdBreak=null,this.onEnterView=freeOnUnref(function(){a.isInAdBreakOfCurrentTitle()&&("playing"===a.mpPlayer.playbackState&&"ready"===a.mpPlayer.contentState&&a.tryReportVmapBreakStartEvent(),a.mpPlayer.on("playbackStateChange",a.onPlaybackStateChange),a.mpPlayer.on("contentStateChange",a.onContentStateChange))}),this.onExitView=freeOnUnref(function(){a.mpPlayer.off("playbackStateChange",a.onPlaybackStateChange),a.mpPlayer.off("contentStateChange",a.onContentStateChange),a.isInAdBreakOfCurrentTitle()||a.reportVmapTrackingEventEnd()}),this.onPlaybackStateChange=freeOnUnref(function(e){a.tryReportVmapBreakStartEvent()}),this.onContentStateChange=freeOnUnref(function(e){a.tryReportVmapBreakStartEvent()}),this.playlistEngine=e,this.mpPlayer=t,this.adBreakInfos=n,this.titleIdView=r,this.mainContentView=i,this.adEventReporter=o}return e.prototype.initialize=freeOnUnref(function(){for(var e=0,t=this.adBreakInfos;e<t.length;e++){var n=t[e];0!==n.vmapTrackingEvents.length&&(n.view.on("EnterView",this.onEnterView),n.view.on("ExitView",this.onExitView))}}),e.prototype.terminate=freeOnUnref(function(){for(var e=0,t=this.adBreakInfos;e<t.length;e++){var n=t[e];0!==n.vmapTrackingEvents.length&&(n.view.off("EnterView",this.onEnterView),n.view.off("ExitView",this.onExitView))}}),e.prototype.tryReportVmapBreakStartEvent=freeOnUnref(function(){if("ready"===this.mpPlayer.contentState&&"playing"===this.mpPlayer.playbackState){var e=this.playlistEngine.getCurrentItem();if(null!=e&&null!=e.breakId){var t=e.breakId;if(null==this.lastReportedStartAdBreak||this.lastReportedStartAdBreak.breakId!==t){var n=x.find(this.adBreakInfos,freeOnUnref(function(e){return e.breakId===t}));null!=n&&this.reportVmapTrackingEventStart(n)}}}}),e.prototype.reportVmapTrackingEventStart=freeOnUnref(function(e){var t=this.getCurrentConsumptionId();null!=t&&(this.findAndReportTrackingEvents(e,"breakStart",t),this.lastReportedStartAdBreak=e)}),e.prototype.reportVmapTrackingEventEnd=freeOnUnref(function(){if(null!=this.lastReportedStartAdBreak){var e=this.getCurrentConsumptionId();null!=e&&this.findAndReportTrackingEvents(this.lastReportedStartAdBreak,"breakEnd",e),this.lastReportedStartAdBreak=null}else n.warn("vmap:TrackingEvent breakStart wasn't reported correctly for the finished ad break.")}),e.prototype.findAndReportTrackingEvents=freeOnUnref(function(e,t,n){var r=e.vmapTrackingEvents.filter(freeOnUnref(function(e){return e.name===t}));if(0!==r.length){for(var i=[],o=0,a=r;o<a.length;o++){var s={url:a[o].uri,method:"GET"};i.push(s)}this.adEventReporter.send(i,{CONSUMPTIONID:n})}}),e.prototype.isInAdBreakOfCurrentTitle=freeOnUnref(function(){return!(!this.titleIdView.isActive()||this.mainContentView.isActive())}),e.prototype.getCurrentConsumptionId=freeOnUnref(function(){var e=this.playlistEngine.getCurrentItem();if(null==e)return null;var t=e.sourceUrlStore;return null==t?null:t.get().urlId}),e})();t.VmapTrackingEventListener=r}));e(lU);lU.VmapTrackingEventListener;var fU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var h=de.get("XpAdPlaylistInterceptor"),n=freeOnUnref(function(){function e(e,t,n,r,i){var o=this;if(this.adBreakInfos=[],this.viewedAdBreaks={},this.savedSeekPosition=null,this.onEnterItem=freeOnUnref(function(e){var t=e.item;x.contains(o.titleIdView.getItems(),t)&&null!=t.breakId&&"Ad"===t.type&&(o.viewedAdBreaks[t.breakId]=!0)}),this.onEnterTitleView=freeOnUnref(function(){"playing"===o.mpPlayer.playbackState&&null!=o.prerollAdBreakInfo?(o.viewedAdBreaks[o.prerollAdBreakInfo.breakId]=!0,o.removeTitleViewListeners()):o.mpPlayer.on("playbackStateChange",o.onPlaybackStateChange)}),this.onExitTitleView=freeOnUnref(function(){o.mpPlayer.off("playbackStateChange",o.onPlaybackStateChange)}),this.onPlaybackStateChange=freeOnUnref(function(e){o.titleIdView.isActive()&&"playing"===e.playbackState&&null!=o.prerollAdBreakInfo&&(o.viewedAdBreaks[o.prerollAdBreakInfo.breakId]=!0,o.removeTitleViewListeners(),o.mpPlayer.off("playbackStateChange",o.onPlaybackStateChange))}),this.playlistEngine=e,this.titleIdView=t,this.mainContentView=n,this.mpPlayer=r,0===i.length)this.adBreakInfos=[];else{var a=i.sort(freeOnUnref(function(e,t){return e.timestamp-t.timestamp}));this.adBreakInfos=a.filter(freeOnUnref(function(e){var t=x.find(e.view.getItems(),freeOnUnref(function(e){return"Ad"===e.type}));return 0!==e.timestamp&&null!=t})),0===a[0].timestamp&&(this.prerollAdBreakInfo=a[0])}}return e.prototype.initialize=freeOnUnref(function(){this.playlistEngine.on("EnterItem",this.onEnterItem),this.titleIdView.on("EnterView",this.onEnterTitleView),this.titleIdView.on("ExitView",this.onExitTitleView)}),e.prototype.terminate=freeOnUnref(function(){this.playlistEngine.off("EnterItem",this.onEnterItem),this.removeTitleViewListeners(),this.mpPlayer.off("playbackStateChange",this.onPlaybackStateChange)}),e.prototype.appendAdBreakView=freeOnUnref(function(e){this.adBreakInfos.push(e),this.adBreakInfos.sort(freeOnUnref(function(e,t){return e.timestamp-t.timestamp}))}),e.prototype.getNewSeekTarget=freeOnUnref(function(e,t,n){var r=this.playlistEngine.getItems()[t];if(!x.contains(this.titleIdView.getItems(),r))return{newPosition:e,newItemIndex:t};var i=this.playlistEngine.getCurrentItem();if(null!=i&&!this.isSkippableAfterSeek(i)&&!0!==n)return h.warn("Current item not skippable. Blocking seek"),null;var o=this.playlistEngine.getCurrentItem(),a=this.mainContentView.getItems()[0];if(r===a&&e===a.start&&null!=this.prerollAdBreakInfo&&!this.viewedAdBreaks[this.prerollAdBreakInfo.breakId]){var s=this.prerollAdBreakInfo.view.getItems()[0];if(null==s){var l=this.prerollAdBreakInfo.breakId;return h.error("Failed to find any preroll item (breakId="+l+"). Not intercepting seek. TitleView: "+this.getTitleViewString()),{newPosition:e,newItemIndex:t}}return-1===(c=this.playlistEngine.getItems().indexOf(s))?(h.error("Failed to find preroll item in playlist. Not intercepting seek."),{newPosition:e,newItemIndex:t}):(h.info("Intercepting seek to "+e+" to go to preroll"),{newPosition:0,newItemIndex:c})}if(!0===n)return{newPosition:e,newItemIndex:t};for(var f=this.adBreakInfos.length-1;0<=f;f--){var u=this.adBreakInfos[f];if(!(u.timestamp>e)){if(null===o)return{newPosition:e,newItemIndex:t};if(x.contains(this.getChapterItemsOfAdBreak(u.breakId),o))return{newPosition:e,newItemIndex:t};if(this.viewedAdBreaks[u.breakId])return{newPosition:e,newItemIndex:t};var c,d=u.view,p=x.find(d.getItems(),freeOnUnref(function(e){return"Ad"===e.type}));return null==p?(h.error("Failed to find any item for break "+u.breakId+". Not intercepting seek."),{newPosition:e,newItemIndex:t}):-1===(c=this.playlistEngine.getItems().indexOf(p))?(h.error("Failed to find break item "+u.breakId+" in playlist. Not intercepting seek."),{newPosition:e,newItemIndex:t}):(this.isSeekingIntoAdBreak(d,e)||(this.savedSeekPosition=e),h.info("Intercepting seek to "+e+" to go to midroll: "+u.breakId),{newPosition:p.start,newItemIndex:c})}}return{newPosition:e,newItemIndex:t}}),e.prototype.getNewPositionTarget=freeOnUnref(function(e){if(!this.titleIdView.isActive())return null;var t=this.playlistEngine.getCurrentItem();if(null===t)return h.warn("Position update without a current item"),null;var n=this.playlistEngine.getItems(),r=this.playlistEngine.getCurrentItemIndex(),i=n[r+1],o=null===t.end?1/0:t.end;if(this.mainContentView.isActive()){if(o<=e&&null!=i&&this.isSkippableItemAfterViewed(i.type)&&this.viewedAdBreaks[i.breakId])for(var a=r+2;null!=n[a];){var s=n[a];if(!this.isSkippableItemAfterViewed(s.type))return h.info("Already played proceeding ad break. Seeking to next chapter"),{newPosition:s.start,newItemIndex:a};a++}}else{if(null===this.savedSeekPosition)return null;if(o<=e&&null!=i&&"Main"===i.type){var l=this.savedSeekPosition;return this.savedSeekPosition=null,h.info("Ad break complete. Seeking to previously requested seek position "+l),{newPosition:l,newItemIndex:r+1}}}return null}),e.prototype.isSeekingIntoAdBreak=freeOnUnref(function(e,t){var n=x.find(e.getItems(),freeOnUnref(function(e){return"Ad"===e.type})),r=x.findLastIndex(e.getItems(),freeOnUnref(function(e){return"Ad"===e.type})),i=e.getItems()[r];return null!=n&&null!=i&&(n.start<=t&&(null==i.end||t<=i.end))}),e.prototype.isSkippableItemAfterViewed=freeOnUnref(function(e){return"Ad"===e||"AdTransition"===e}),e.prototype.isSkippableAfterSeek=freeOnUnref(function(e){if("Ad"!==e.type)return!0;var t=e.catalogMetadata;if(null==t)return h.warn("Metadata unavailable for current item. Blocking seek"),!1;var n=t.skipOffset;if(null==n)return h.warn("Disallowing seek while in ad without skip offset"),!1;var r=this.playlistEngine.getCurrentPosition();return r-e.start<n?(h.warn("Disallowing seek: current position "+r+"ms < "+e.type+" skip offset threshold "+n+"ms"),!1):(h.info("Allowing seek during "+e.type+": current position "+r+"ms >= "+e.type+" skip offset threshold "+n+"ms"),!0)}),e.prototype.removeTitleViewListeners=freeOnUnref(function(){this.titleIdView.off("EnterView",this.onEnterTitleView),this.titleIdView.off("ExitView",this.onExitTitleView)}),e.prototype.getChapterItemsOfAdBreak=freeOnUnref(function(t){var e=x.find(this.adBreakInfos,freeOnUnref(function(e){return e.breakId===t}));if(null==e)return[];var n=this.playlistEngine.getItems(),r=x.last(e.view.getItems());if(null==r)return[];for(var i=x.findIndex(n,r)+1,o=[];null!=n[i]&&"Ad"!==n[i].type;)o.push(n[i]),i++;return o}),e.prototype.getTitleViewString=freeOnUnref(function(){return JSON.stringify(this.titleIdView.getItems().map(freeOnUnref(function(e){return{type:e.type,startMs:e.start,breakId:e.breakId}})))}),e})();t.XpAdPlaylistInterceptor=n}));e(fU);fU.XpAdPlaylistInterceptor;var uU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("TrackingEventReporter"),n=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.hasStartedPlayback=!1,this.playedToTime=0,this.playlistItem=null,this.onEnterView=freeOnUnref(function(){i.view.isActive()&&(i.playlistItem=i.view.playlistEngine.getCurrentItem(),i.playedToTime=0,i.hasStartedPlayback=i.isReadyAndPlaying(),i.mpPlayer.on("contentStateChange",i.onContentStateChange),i.mpPlayer.on("playbackStateChange",i.onPlaybackStateChange),i.timeDataManager.on("TimeDataChange",i.onTimeDataChange))}),this.onExitView=freeOnUnref(function(){var e=null===i.playlistItem?null:i.playlistItem.trackingEvents;if(null!=e){var t=e.filter(freeOnUnref(function(e){return e.reported})).map(freeOnUnref(function(e){return e.name}));o.info("Reported events ["+t+"] for ad="+(null==i.playlistItem?"<unknown>":i.playlistItem.adInstanceId)+" on break="+(null==i.playlistItem?"<unknown>":i.playlistItem.breakId))}i.mpPlayer.off("contentStateChange",i.onContentStateChange),i.mpPlayer.off("playbackStateChange",i.onPlaybackStateChange),i.timeDataManager.off("TimeDataChange",i.onTimeDataChange),i.playlistItem=null}),this.onContentStateChange=freeOnUnref(function(e){"error"===e.contentState&&i.reportEventByName("error"),i.hasStartedPlayback=i.hasStartedPlayback||i.isReadyAndPlaying();var t=i.timeDataManager.getTimeData();i.onTimeDataChange(t)}),this.onPlaybackStateChange=freeOnUnref(function(e){i.hasStartedPlayback&&("paused"===e.playbackState?i.reportEventByName("pause"):"playing"===e.playbackState&&i.reportEventByName("resume")),i.hasStartedPlayback=i.hasStartedPlayback||i.isReadyAndPlaying();var t=i.timeDataManager.getTimeData();i.onTimeDataChange(t)}),this.onTimeDataChange=freeOnUnref(function(e){e.currentPosition>i.playedToTime&&(i.playedToTime=e.currentPosition),i.isReadyAndPlaying()&&i.reportEventsForNewTimeData(e)}),this.view=e,this.mpPlayer=t,this.timeDataManager=n,this.adEventReporter=r,e.on("EnterView",this.onEnterView),e.on("ExitView",this.onExitView)}return e.prototype.destroy=freeOnUnref(function(){this.onExitView(),this.view.off("EnterView",this.onEnterView),this.view.off("ExitView",this.onExitView)}),e.prototype.reportSkipOrComplete=freeOnUnref(function(e){null!==this.playlistItem&&null!==this.playlistItem.start&&null!==this.playlistItem.end&&(e?this.reportEventByName("skip"):this.reportEventByName("complete"))}),e.prototype.reportClose=freeOnUnref(function(){if(null!==this.playlistItem&&null!=this.playlistItem.trackingEvents&&this.hasStartedPlayback){var e=this.playlistItem.trackingEvents.some(freeOnUnref(function(e){return"closeLinear"===e.name}));this.reportEventByName(e?"closeLinear":"close")}this.onExitView()}),e.prototype.reportMuteOrUnmute=freeOnUnref(function(e){e?this.reportEventByName("mute"):this.reportEventByName("unmute")}),e.prototype.isReadyAndPlaying=freeOnUnref(function(){return"playing"===this.mpPlayer.playbackState&&"ready"===this.mpPlayer.contentState}),e.prototype.reportEventsForNewTimeData=freeOnUnref(function(e){var t=null===this.playlistItem?null:this.playlistItem.trackingEvents,n=e.playableRanges[e.currentTimelineItemIndex];if(null!==this.playlistItem&&null!=t&&null!=n&&null!=n.start){var r=this.getItemConsumptionId();if(null!=r)for(var i=e.currentPosition-n.start,o=0,a=t.filter(freeOnUnref(function(e){return!e.reported&&null!=e.position&&i>=e.position}));o<a.length;o++){var s=a[o];this.reportEvent(s,r)}}}),e.prototype.reportEventByName=freeOnUnref(function(t){var e=null===this.playlistItem?null:this.playlistItem.trackingEvents;if(null!==this.playlistItem&&null!=e){var n=this.getItemConsumptionId();if(null!=n)for(var r=0,i=e.filter(freeOnUnref(function(e){return e.name===t}));r<i.length;r++){var o=i[r];this.reportEvent(o,n)}}}),e.prototype.reportEvent=freeOnUnref(function(e,t){o.info('Reporting "'+e.name+'" tracking event.');var n=[{url:e.uri,method:null!=e.httpMethod?e.httpMethod:"GET",data:e.data}];this.adEventReporter.send(n,{CONSUMPTIONID:t}),e.reported=!0}),e.prototype.getItemConsumptionId=freeOnUnref(function(){return null===this.playlistItem?null:null!=this.playlistItem.sourceUrlStore?this.playlistItem.sourceUrlStore.get().urlId:null!=this.playlistItem.consumptionIdUpdater&&null!=this.playlistItem.consumptionIdUpdater.consumptionId?this.playlistItem.consumptionIdUpdater.consumptionId:null}),e})();t.TrackingEventReporter=n}));e(uU);uU.TrackingEventReporter;var cU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"AdSystem"}),t.prototype.onElementStart=freeOnUnref(function(e,t){var n=e();this.adSystem={name:"unknown"},bp.Utilities.optionallyCopyString(n,this.adSystem,"version")}),t.prototype.onText=freeOnUnref(function(e){this.adSystem.name=e().trim()}),t.prototype.onElementEnd=freeOnUnref(function(){return this.adSystem}),t})(bp.LeafElementHandler);t.AdSystemHandler=r}));e(cU);cU.AdSystemHandler;var dU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"UniversalAdId"}),t.prototype.onElementStart=freeOnUnref(function(e,t){var n=e();this.universalAdId={idValue:n.idValue,idRegistry:n.idRegistry}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.universalAdId}),t})(bp.LeafElementHandler);t.UniversalAdIdHandler=r}));e(dU);dU.UniversalAdIdHandler;var pU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(){var t=null!==r&&r.apply(this,arguments)||this;return t.characterContents="",t.onCData=freeOnUnref(function(e){t.characterContents+=e()}),t}return n(e,r),e.prototype.onElementStart=freeOnUnref(function(e,t,n){r.prototype.onElementStart.call(this,e,t,n),this.characterContents=""}),e.prototype.onText=freeOnUnref(function(e){this.characterContents+=e()}),e})(bp.LeafElementHandler);t.TextualContentsHandler=r}));e(pU);pU.TextualContentsHandler;var hU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(p){function e(){return null!==p&&p.apply(this,arguments)||this}return n(e,p),e.prototype.getElementName=freeOnUnref(function(){return"MediaFile"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){p.prototype.onElementStart.call(this,e,t,n);var r=e();this.mediaFile={delivery:r.delivery,type:r.type};for(var i=0,o=["height","width","bitrate","minBitrate","maxBitrate"];i<o.length;i++){var a=o[i];bp.Utilities.optionallyCopyNumber(r,this.mediaFile,a)}for(var s=0,l=["scalable","maintainAspectRatio"];s<l.length;s++){var f=l[s];bp.Utilities.optionallyCopyBoolean(r,this.mediaFile,f)}for(var u=0,c=["codec","id"];u<c.length;u++){var d=c[u];bp.Utilities.optionallyCopyString(r,this.mediaFile,d)}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.mediaFile.uri=this.characterContents.trim(),this.mediaFile}),e})(pU.TextualContentsHandler);t.MediaFileHandler=r}));e(hU);hU.MediaFileHandler;var mU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new hU.MediaFileHandler])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"MediaFiles"}),t.prototype.onElementStart=freeOnUnref(function(e,t){this.mediaFiles={files:[]}}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"MediaFile":this.mediaFiles.files.push(e.onElementEnd())}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.mediaFiles}),t})(bp.ParentElementHandler);t.MediaFilesHandler=r}));e(mU);mU.MediaFilesHandler;var yU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"Tracking"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.trackingEvent={name:r.event}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.trackingEvent.uri=this.characterContents.trim(),this.trackingEvent}),e})(pU.TextualContentsHandler);t.TrackingHandler=r}));e(yU);yU.TrackingHandler;var gU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new yU.TrackingHandler])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"TrackingEvents"}),t.prototype.onElementStart=freeOnUnref(function(e,t){this.trackingEvents=[]}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"Tracking":this.trackingEvents.push(e.onElementEnd())}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.trackingEvents}),t})(bp.ParentElementHandler);t.TrackingEventsHandler=r}));e(gU);gU.TrackingEventsHandler;var vU=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this)||this;return t.elementName=e,t}return r(e,n),e.prototype.getElementName=freeOnUnref(function(){return this.elementName}),e.prototype.onElementStart=freeOnUnref(function(e,t){var n=e();this.genericClickResult={},bp.Utilities.optionallyCopyString(n,this.genericClickResult,"id")}),e.prototype.onElementEnd=freeOnUnref(function(){return this.genericClickResult}),e.prototype.onText=freeOnUnref(function(e){this.genericClickResult.uri=e().trim()}),e})(bp.LeafElementHandler);t.GenericClickHandler=n}));e(vU);vU.GenericClickHandler;var OU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new vU.GenericClickHandler("ClickThrough"),new vU.GenericClickHandler("ClickTracking"),new vU.GenericClickHandler("CustomClick")])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"VideoClicks"}),t.prototype.onElementStart=freeOnUnref(function(e,t){this.videoClicks={clickTracking:[],customClicks:[]}}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"ClickThrough":this.videoClicks.clickThrough=e.onElementEnd();break;case"ClickTracking":this.videoClicks.clickTracking.push(e.onElementEnd());break;case"CustomClick":this.videoClicks.customClicks.push(e.onElementEnd())}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.videoClicks}),t})(bp.ParentElementHandler);t.VideoClicksHandler=r}));e(OU);OU.VideoClicksHandler;var SU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new bp.TextOnlyLeafHandler("Duration"),new mU.MediaFilesHandler,new gU.TrackingEventsHandler,new OU.VideoClicksHandler])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"Linear"}),t.prototype.onElementStart=freeOnUnref(function(e,t){var n=e();this.linear={},bp.Utilities.optionallyCopyString(n,this.linear,"skipoffset")}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"Duration":this.linear.duration=e.onElementEnd();break;case"MediaFiles":this.linear.mediaFiles=e.onElementEnd();break;case"TrackingEvents":this.linear.trackingEvents=e.onElementEnd();break;case"VideoClicks":this.linear.videoClicks=e.onElementEnd()}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.linear}),t})(bp.ParentElementHandler);t.LinearHandler=r}));e(SU);SU.LinearHandler;var UU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new dU.UniversalAdIdHandler,new SU.LinearHandler])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"Creative"}),t.prototype.onElementStart=freeOnUnref(function(e,t){var n=e();this.creative={},bp.Utilities.optionallyCopyNumber(n,this.creative,"sequence"),bp.Utilities.optionallyCopyString(n,this.creative,"adId"),bp.Utilities.optionallyCopyString(n,this.creative,"apiFramework"),bp.Utilities.optionallyCopyString(n,this.creative,"id"),n.AdID&&(this.creative.adId=n.AdID)}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"UniversalAdId":this.creative.universalAdId=e.onElementEnd();break;case"Linear":this.creative.linear=e.onElementEnd()}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.creative}),t})(bp.ParentElementHandler);t.CreativeHandler=r}));e(UU);UU.CreativeHandler;var bU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new bp.TextOnlyLeafHandler("ContentType"),new bp.TextOnlyLeafHandler("ContentSubType")])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"ContentMetadata"}),t.prototype.onElementStart=freeOnUnref(function(e,t,n){this.contentMetadata={}}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"ContentType":this.contentMetadata.contentType=e.onElementEnd();break;case"ContentSubType":this.contentMetadata.contentSubType=e.onElementEnd()}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.contentMetadata}),t})(bp.ParentElementHandler);t.ContentMetadataHandler=r}));e(bU);bU.ContentMetadataHandler;var PU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new bU.ContentMetadataHandler])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"Extension"}),t.prototype.onElementStart=freeOnUnref(function(e,t){this.contentMetadataExtension={type:"contentMetadata"}}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"ContentMetadata":var t=e.onElementEnd();null!=t.contentType&&(this.contentMetadataExtension.contentType=t.contentType),null!=t.contentSubType&&(this.contentMetadataExtension.contentSubType=t.contentSubType)}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.contentMetadataExtension}),t})(bp.ParentElementHandler);t.ContentMetadataExtensionHandler=r}));e(PU);PU.ContentMetadataExtensionHandler;var MU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"SkipOffset"}),t.prototype.onElementStart=freeOnUnref(function(e,t){var n=e();this.skipOffset={},bp.Utilities.optionallyCopyBoolean(n,this.skipOffset,"showTimer")}),t.prototype.onText=freeOnUnref(function(e){this.skipOffset.offset=e().trim()}),t.prototype.onElementEnd=freeOnUnref(function(){return this.skipOffset}),t})(bp.LeafElementHandler);t.SkipOffsetHandler=r}));e(MU);MU.SkipOffsetHandler;var CU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new MU.SkipOffsetHandler,new bp.TextOnlyLeafHandler("MinAdLength"),new bp.TextOnlyLeafHandler("ButtonShowtimeMs")])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"Extension"}),t.prototype.onElementStart=freeOnUnref(function(e,t){this.skippableExtension={type:"skippable"}}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"MinAdLength":this.skippableExtension.minAdLength=e.onElementEnd();break;case"SkipOffset":this.skippableExtension.skipOffset=e.onElementEnd();break;case"ButtonShowtimeMs":this.skippableExtension.buttonShowTimeMs=parseInt(e.onElementEnd())}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.skippableExtension}),t})(bp.ParentElementHandler);t.SkippableExtensionHandler=r}));e(CU);CU.SkippableExtensionHandler;var EU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new bp.TextOnlyLeafHandler("ShowAdDurationTimer")])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"Timer"}),t.prototype.onElementStart=freeOnUnref(function(e,t){this.timerExtension={type:"timer",showAdDurationTimer:!1}}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"ShowAdDurationTimer":this.timerExtension.showAdDurationTimer="true"===e.onElementEnd()}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.timerExtension}),t})(bp.ParentElementHandler);t.TimerExtensionHandler=r}));e(EU);EU.TimerExtensionHandler;var TU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"Extension"}),t.prototype.onElementStart=freeOnUnref(function(e,t){this.watchlist={type:"watchlist"}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.watchlist}),t})(bp.LeafElementHandler);t.WatchlistExtensionHandler=r}));e(TU);TU.WatchlistExtensionHandler;var wU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(){var e=t.call(this,[])||this;return e.extensionMap={contentMetadata:new PU.ContentMetadataExtensionHandler,skippable:new CU.SkippableExtensionHandler,timer:new EU.TimerExtensionHandler,watchlist:new TU.WatchlistExtensionHandler},e}return n(e,t),e.prototype.getElementName=freeOnUnref(function(){return"Extension"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){var r=e().type;this.currentHandler=this.extensionMap[r],null==this.currentHandler&&(this.currentHandler=new bp.ElementNodeHandler(this.getElementName())),this.currentHandler.onElementStart(e,t,n)}),e.prototype.onChildElementStart=freeOnUnref(function(e,t,n){return this.currentHandler?this.currentHandler.onChildElementStart(e,t,n):null}),e.prototype.onChildElementEnd=freeOnUnref(function(e){this.currentHandler&&this.currentHandler.onChildElementEnd(e)}),e.prototype.onElementEnd=freeOnUnref(function(){return null==this.currentHandler?null:this.currentHandler instanceof bp.ElementNodeHandler?{type:"elementNode",extension:this.currentHandler.onElementEnd()}:this.currentHandler.onElementEnd()}),e})(bp.ParentElementHandler);t.ExtensionHandler=r}));e(wU);wU.ExtensionHandler;var IU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"Impression"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.impression={},bp.Utilities.optionallyCopyString(r,this.impression,"id")}),e.prototype.onElementEnd=freeOnUnref(function(){return this.impression.uri=this.characterContents.trim(),this.impression}),e})(pU.TextualContentsHandler);t.ImpressionHandler=r}));e(IU);IU.ImpressionHandler;var kU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new cU.AdSystemHandler,new UU.CreativeHandler,new wU.ExtensionHandler,new IU.ImpressionHandler,new bp.TextOnlyLeafHandler("AdTitle"),new bp.TextOnlyLeafHandler("Error")])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"InLine"}),t.prototype.onElementStart=freeOnUnref(function(e,t){this.inLine={creatives:[],extensions:[],impressions:[]}}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"AdSystem":this.inLine.adSystem=e.onElementEnd();break;case"AdTitle":this.inLine.adTitle=e.onElementEnd();break;case"Error":this.inLine.errorUri=e.onElementEnd();break;case"Impression":this.inLine.impressions.push(e.onElementEnd());break;case"Creative":this.inLine.creatives.push(e.onElementEnd());break;case"Extension":var t=e.onElementEnd();null!==t&&this.inLine.extensions.push(t)}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.inLine}),t})(bp.ParentElementHandler);t.InLineHandler=r}));e(kU);kU.InLineHandler;var _U=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new kU.InLineHandler])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"Ad"}),t.prototype.onElementStart=freeOnUnref(function(e,t){var n=e();this.ad={id:n.id},bp.Utilities.optionallyCopyNumber(n,this.ad,"sequence"),bp.Utilities.optionallyCopyBoolean(n,this.ad,"conditionalAd")}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"InLine":this.ad.inLine=e.onElementEnd()}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.ad}),t})(bp.ParentElementHandler);t.AdHandler=r}));e(_U);_U.AdHandler;var RU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new bp.TextOnlyLeafHandler("Error"),new _U.AdHandler])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"VAST"}),t.prototype.onElementStart=freeOnUnref(function(e,t){this.adData={ads:[]}}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"Error":this.adData.errorUri=e.onElementEnd();break;case"Ad":this.adData.ads.push(e.onElementEnd())}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.adData}),t})(bp.ParentElementHandler);t.VASTHandler=r}));e(RU);RU.VASTHandler;var AU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new RU.VASTHandler])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"vmap:AdSource"}),t.prototype.onElementStart=freeOnUnref(function(e,t){var n=e();this.adSource={id:n.id,allowMultipleAds:"false"!==n.allowMultipleAds,followRedirects:"false"!==n.followRedirects},bp.Utilities.optionallyCopyString(n,this.adSource,"adTagUri")}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"VAST":this.adSource.vastAdData=e.onElementEnd()}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.adSource}),t})(bp.ParentElementHandler);t.AdSourceHandler=r}));e(AU);AU.AdSourceHandler;var DU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.getElementName=freeOnUnref(function(){return"vmap:Tracking"}),e.prototype.onElementStart=freeOnUnref(function(e,t,n){i.prototype.onElementStart.call(this,e,t,n);var r=e();this.trackingEvent={name:r.event}}),e.prototype.onElementEnd=freeOnUnref(function(){return this.trackingEvent.uri=this.characterContents.trim(),this.trackingEvent}),e})(pU.TextualContentsHandler);t.VmapTrackingHandler=r}));e(DU);DU.VmapTrackingHandler;var xU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new DU.VmapTrackingHandler])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"vmap:TrackingEvents"}),t.prototype.onElementStart=freeOnUnref(function(e,t){this.trackingEvents=[]}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"vmap:Tracking":this.trackingEvents.push(e.onElementEnd())}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.trackingEvents}),t})(bp.ParentElementHandler);t.VmapTrackingEventsHandler=r}));e(xU);xU.VmapTrackingEventsHandler;var FU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new AU.AdSourceHandler,new xU.VmapTrackingEventsHandler])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"vmap:AdBreak"}),t.prototype.onElementStart=freeOnUnref(function(e,t){var n=e();this.adBreak={timeOffset:n.timeOffset,breakId:n.breakId,breakType:n.breakType,adSources:[],trackingEvents:[]}}),t.prototype.onChildElementEnd=freeOnUnref(function(e){switch(e.getElementName()){case"vmap:AdSource":this.adBreak.adSources.push(e.onElementEnd());break;case"vmap:TrackingEvents":this.adBreak.trackingEvents=e.onElementEnd()}}),t.prototype.onElementEnd=freeOnUnref(function(){return this.adBreak}),t})(bp.ParentElementHandler);t.AdBreakHandler=r}));e(FU);FU.AdBreakHandler;var BU=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,[new FU.AdBreakHandler])||this}return n(t,e),t.prototype.getElementName=freeOnUnref(function(){return"vmap:VMAP"}),t.prototype.onElementStart=freeOnUnref(function(e,t){this.adBreaks=[]}),t.prototype.onChildElementEnd=freeOnUnref(function(e){"vmap:AdBreak"===e.getElementName()&&this.adBreaks.push(e.onElementEnd())}),t.prototype.onElementEnd=freeOnUnref(function(){return this.adBreaks}),t})(bp.ParentElementHandler);t.VMAPHandler=r}));e(BU);BU.VMAPHandler;var LU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.xmlParser=new bp.Parser,this.vmapHandler=new BU.VMAPHandler}return e.prototype.parse=freeOnUnref(function(e){return this.xmlParser.parse(this.vmapHandler,e)}),e})();t.VmapParser=n}));e(LU);LU.VmapParser;var NU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.VmapParser=LU.VmapParser}));e(NU);NU.VmapParser;var VU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.normalize=freeOnUnref(function(e){for(var t=[],n=0,r=0,i=e;r<i.length;r++){var o=i[r];t.push({timestampMs:o.timestampMs+n,durationMs:o.durationMs,vmapTrackingEvents:o.vmapTrackingEvents,adBreakId:o.adBreakId,ads:o.ads}),n+=o.durationMs}return t}),e})();t.MssVmapNormalizer=n}));e(VU);VU.MssVmapNormalizer;var jU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.calculateEventPositionMap={impression:freeOnUnref(function(e){return 0}),start:freeOnUnref(function(e){return 0}),firstQuartile:freeOnUnref(function(e){return e/4}),midpoint:freeOnUnref(function(e){return e/2}),thirdQuartile:freeOnUnref(function(e){return e/4*3})}}return e.prototype.transform=freeOnUnref(function(e,r){var i=this;return e.map(freeOnUnref(function(e){var t=i.adSourcesToAds(e.adSources);e.trackingEvents.forEach(freeOnUnref(function(e){return e.uri=x.unescape(e.uri)}));var n=t.reduce(freeOnUnref(function(e,t){return e+t.durationMs}),0);return{adBreakId:e.breakId,timestampMs:i.vmapTimestampMs(e.timeOffset,r,n),durationMs:n,vmapTrackingEvents:e.trackingEvents,ads:t}})).sort(freeOnUnref(function(e,t){return e.timestampMs-t.timestampMs}))}),e.prototype.adSourcesToAds=freeOnUnref(function(e){var t=this;return x.chain(e).map(freeOnUnref(function(e){return null==e.vastAdData?[]:t.vastAdsToSimplifiedAds(e.vastAdData.ads)})).flatten().value()}),e.prototype.vastAdsToSimplifiedAds=freeOnUnref(function(e){var t=this;return x.chain(e).map(freeOnUnref(function(e){return null==e.inLine?[]:t.creativesToSimplifiedAds(e.inLine.creatives,e.inLine.impressions,e.inLine.extensions,e.inLine.adSystem,e.inLine.errorUri,e.id)})).flatten().value()}),e.prototype.creativesToSimplifiedAds=freeOnUnref(function(e,c,t,d,p,h){var m,y,g=this;void 0===t&&(t=[]);for(var v,O=[],n=0,r=t;n<r.length;n++){var i=r[n];"skippable"===i.type?m=i:"contentMetadata"===i.type?y=i:"timer"===i.type?v=i:"elementNode"===i.type&&O.push(i.extension)}return e.filter(freeOnUnref(function(e){return null!=e.linear})).map(freeOnUnref(function(e){var t=e.linear,r=jr.extendedLimitedIso8601TimeFormatToMilliseconds(t.duration),n={durationMs:r,adSystem:d,creativeId:e.id,extensions:O,adId:h},i=function(e,t){if(null!=e&&t>=jr.extendedLimitedIso8601TimeFormatToMilliseconds(e.minAdLength))return{skipOffsetMs:jr.extendedLimitedIso8601TimeFormatToMilliseconds(e.skipOffset.offset),showTimer:e.skipOffset.showTimer,buttonShowTimeMs:e.buttonShowTimeMs}}(m,r);if(null!=i&&(n.skipOptions=i),null!=v&&(n.showAdDurationTimer=v.showAdDurationTimer),null!=y&&(n.contentType=y.contentType,n.contentSubType=y.contentSubType),null!=t.videoClicks){var o=function(e,t){if(null!=e){var n=null!=t?t:[];return{clickThroughUri:x.unescape(e.uri),clickTrackingUris:n.map(freeOnUnref(function(e){return x.unescape(e.uri)}))}}}(t.videoClicks.clickThrough,t.videoClicks.clickTracking);null!=o&&(n.clickThrough=o);var a=function(e){if(null!=e)return e.map(freeOnUnref(function(e){return{id:e.id,uri:x.unescape(e.uri)}}))}(t.videoClicks.customClicks);null!=a&&(n.customClicks=a)}null!=t.trackingEvents&&0<t.trackingEvents.length&&(n.trackingEvents=t.trackingEvents.map(freeOnUnref(function(e){var t={name:e.name,uri:x.unescape(e.uri),reported:!1},n=g.calculateEventPositionMap[e.name];return null!=n&&(t.position=n(r)),t}))),null!=p&&(null==n.trackingEvents&&(n.trackingEvents=[]),n.trackingEvents.push({name:"error",uri:x.unescape(p),reported:!1}));for(var s=g.calculateEventPositionMap.impression(r),l=0,f=c;l<f.length;l++){var u=f[l];null==n.trackingEvents&&(n.trackingEvents=[]),n.trackingEvents.push({name:"impression",uri:x.unescape(u.uri),reported:!1,position:s})}return n}))}),e.prototype.vmapTimestampMs=freeOnUnref(function(e,t,n){if("start"===e)return 0;if("end"===e)return t-n;if(-1<e.indexOf("%")||-1<e.indexOf("#"))throw new Error("Unsupported 'timeOffset' format: "+e);return jr.extendedLimitedIso8601TimeFormatToMilliseconds(e)}),e})();t.VastVmapTransformer=n}));e(jU);jU.VastVmapTransformer;var qU=t(freeOnUnref(function(e,c){var y=ce&&ce.__assign||freeOnUnref(function(){return(y=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(c,"__esModule",{value:!0});c.UNKNOWN_AD_TYPE="Unknown",c.IVA_AD_TYPE="IVA",c.SFX_AD_TYPE="SFX",c.DRAPER_AD_TYPE="Draper",c.AUX_AD_TYPE="Aux",c.TRANSITION_AD_TYPE="AdTransition",c.LINEAR_AD_TYPE="Linear",c.AD_TYPE="Ad";var g=[c.UNKNOWN_AD_TYPE,c.TRANSITION_AD_TYPE,c.AUX_AD_TYPE];c.DRAPER_AD_SERVERS=[c.DRAPER_AD_TYPE,"ATVDraperSchedulingService"],c.IVA_EXTENSION_TYPE="ava.amazon.com/actionable",c.ELEMENT_NODE_EXTENSION_TYPE="elementNode";var v=de.get("CuepointPlaylistPlaylistSource"),t=freeOnUnref(function(){function e(){this.vmapParser=new NU.VmapParser,this.vastVmapTransformer=new jU.VastVmapTransformer,this.diagnostics=nn.Diagnostics.create("CuepointPlaylistProcessor")}return e.prototype.process=freeOnUnref(function(e,t){if(null==e.encodedManifest)return[];var n=Date.now(),r=Lr.decodeString(e.encodedManifest),i=Date.now(),o=i-n;q.metrics.putMetric("Asset.VastVmap.DecodeTime",o,"ms");var a=Date.now(),s=this.vmapParser.parse(r),l=Date.now(),f=l-n;q.metrics.putMetric("Asset.VastVmap.ParseTime",f,"ms"),250<f&&v.warn("VAST-VMAP parse and decoding took "+f+" ms");var u=this.getAdInfo(s);(null!=u.IVA&&0<u.IVA||null!=u.SFX&&0<u.SFX)&&(q.metrics.putMetric("Asset.VastVmap.Iva.DecodeTime",o,"ms"),q.metrics.putMetric("Asset.VastVmap.Iva.ParseTime",f,"ms"));for(var c={},d=0,p=Object.keys(u);d<p.length;d++){var h=p[d];c["adCount"+h]=u[h].toString()}this.diagnostics.report("ttff",y({vastVmapDecodeStart:n,vastVmapDecodeEnd:i,vastVmapParseStart:a,vastVmapParseEnd:l},c));var m=this.vastVmapTransformer.transform(s,t);return m=VU.MssVmapNormalizer.normalize(m)}),e.prototype.getAdType=freeOnUnref(function(e){if(null==e.extensions)return c.UNKNOWN_AD_TYPE;var t=x.find(e.extensions,freeOnUnref(function(e){return"contentMetadata"===e.type}));if(null==t)return c.UNKNOWN_AD_TYPE;if(t.contentType===c.AUX_AD_TYPE)return c.AUX_AD_TYPE;if(t.contentType===c.TRANSITION_AD_TYPE)return c.TRANSITION_AD_TYPE;if(t.contentType===c.AD_TYPE){if(x.contains(c.DRAPER_AD_SERVERS,e.adSystem.name))return c.DRAPER_AD_TYPE;var n=this.ivaExtensionPresent(e.extensions);return n.hasExtension?n.hasSFXExtension?c.SFX_AD_TYPE:c.IVA_AD_TYPE:c.LINEAR_AD_TYPE}return c.UNKNOWN_AD_TYPE}),e.prototype.ivaExtensionPresent=freeOnUnref(function(e){var t={hasExtension:!1,hasSFXExtension:!1};if(null!=e)for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i.type===c.ELEMENT_NODE_EXTENSION_TYPE){var o=i.extension;if(null!=o.attributes&&o.attributes.type===c.IVA_EXTENSION_TYPE&&(t.hasExtension=!0,o.children&&0<o.children.length))for(var a=0,s=o.children.filter(freeOnUnref(function(e){return"ActionableAd"===e.name}));a<s.length;a++)for(var l=0,f=s[a].children.filter(freeOnUnref(function(e){return"InteractiveCreativeFile"===e.name}));l<f.length;l++){var u=f[l];if(u.attributes&&"SFX"===u.attributes.apiFramework)return t.hasSFXExtension=!0,t}}}return t}),e.prototype.getAdInfo=freeOnUnref(function(e){for(var t=Date.now(),n={},r=0,i=e;r<i.length;r++)for(var o=0,a=i[r].adSources;o<a.length;o++){var s=a[o];if(null!=s.vastAdData&&null!=s.vastAdData.ads)for(var l=0,f=s.vastAdData.ads;l<f.length;l++){var u=f[l];if(null!=u.inLine){var c=n[m=this.getAdType(u.inLine)];n[m]=null==c?1:c+1}}}if(v.enabledFor(de.INFO)){for(var d=0,p=0,h=Object.keys(n);p<h.length;p++){var m=h[p];x.find(g,m)||(d+=n[m])}v.info("Total ad count = "+d+", ad counts = "+JSON.stringify(n)+", time to calculate = "+(Date.now()-t)+" ms")}return n}),e})();c.CuepointPlaylistProcessor=t}));e(qU);qU.UNKNOWN_AD_TYPE,qU.IVA_AD_TYPE,qU.SFX_AD_TYPE,qU.DRAPER_AD_TYPE,qU.AUX_AD_TYPE,qU.TRANSITION_AD_TYPE,qU.LINEAR_AD_TYPE,qU.AD_TYPE,qU.DRAPER_AD_SERVERS,qU.IVA_EXTENSION_TYPE,qU.ELEMENT_NODE_EXTENSION_TYPE,qU.CuepointPlaylistProcessor;var HU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.process=freeOnUnref(function(e){for(var t=[],n=null,r=0,i=e.periods.contents;r<i.length;r++){var o=i[r],a=o.endMs-o.startMs,s=void 0;"Aux"===o.contentType||"Ad"===o.contentType||"AdTransition"===o.contentType?(s={durationMs:a,adSystem:{name:"UNKNOWN"},extensions:[],contentType:o.contentType,contentSubType:o.contentSubType},null==n&&(n={timestampMs:o.startMs,durationMs:0,ads:[],vmapTrackingEvents:[]},t.push(n)),n.durationMs+=a,n.ads.push(s)):n=null}return t}),e})();t.MediaRepresentationProcessor=n}));e(HU);HU.MediaRepresentationProcessor;var zU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("CuepointPlaylistPlaylistSource"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l){this.cuepointPlaylistProcessor=new qU.CuepointPlaylistProcessor,this.mediaRepresentationProcessor=new HU.MediaRepresentationProcessor,this.trackingEventReporters=[],this.cuepoints=e,this.playlistEngine=t,this.playlistTrackingEventReporter=n,this.mpPlayer=r,this.timeDataManager=i,this.titleIdView=o,this.mainContentView=a,this.mediaEventReportingPlaylistListener=s,this.adEventReporter=l}return e.prototype.getMainContentDurationMs=freeOnUnref(function(){var e=this.mainContentView.getItems(),t=e[e.length-1];return null===t.end?1/0:t.end}),e.prototype.resolveFromCuepoints=freeOnUnref(function(e){var t=this.cuepointPlaylistProcessor.process(this.cuepoints,this.getMainContentDurationMs());return this.resolveWithAdBreaks(e,t)}),e.prototype.resolveFromMediaRepresentation=freeOnUnref(function(e,t){var n=this.mediaRepresentationProcessor.process(t);return this.resolveWithAdBreaks(e,n)}),e.prototype.resolveWithAdBreaks=freeOnUnref(function(e,t){var n=this;if(0===t.length||__HOMEBREW_NOADS)return lt.Promise.resolve([]);var r=this.getMainContentDurationMs(),i=this.splitMainContent(t,r),o=new fU.XpAdPlaylistInterceptor(this.playlistEngine,this.titleIdView,this.mainContentView,this.mpPlayer,i);o.initialize(),this.playlistEngine.registerOnPositionInterceptor(o),this.playlistEngine.registerSeekInterceptor(o);var a=new lU.VmapTrackingEventListener(this.playlistEngine,this.mpPlayer,i,this.titleIdView,this.mainContentView,this.adEventReporter);return a.initialize(),e.promise.then(freeOnUnref(function(){n.playlistEngine.deregisterOnPositionInterceptor(o),n.playlistEngine.deregisterSeekInterceptor(o),o.terminate(),a.terminate();for(var e=0,t=n.trackingEventReporters;e<t.length;e++){t[e].destroy()}n.trackingEventReporters=[]})),s.info("Playlist after inserting ad breaks:\n"+JS.formatPlaylist(this.playlistEngine)),lt.Promise.resolve(t)}),e.prototype.createAdMetadata=freeOnUnref(function(e,t,n,r,i,o){var a={showCountdownTimer:!0===this.cuepoints.showCountdownTimer||null==this.cuepoints.showCountdownTimer&&"Ad"===e.contentType&&(null==e.adSystem||"ATVDraperSchedulingService"!==e.adSystem.name),adSystem:e.adSystem,adInstanceId:n,extensions:e.extensions,breakNumber:r,adNumberWithinBreak:i,breakType:o};if(null!=e.skipOptions&&(a.showSkipCountdownTimer=null!=e.skipOptions.showTimer&&e.skipOptions.showTimer,a.skipOffset=e.skipOptions.skipOffsetMs,a.buttonShowTimeMs=e.skipOptions.buttonShowTimeMs),null!=e.clickThrough&&(a.clickThroughUri=e.clickThrough.clickThroughUri),null!=e.customClicks){for(var s=[],l=0,f=e.customClicks;l<f.length;l++){var u=f[l];s.push(u.id)}a.customClicks=s}return null!=e.creativeId&&(a.creativeId=e.creativeId),null!=t.adBreakId&&(a.adBreakId=t.adBreakId),null!=e.adId&&(a.adId=e.adId),a}),e.prototype.createAuxiliaryMetadata=freeOnUnref(function(e){var t={showCountdownTimer:!1,extensions:e.extensions};return null!=e.adId&&(t.adId=e.adId),null!=e.contentSubType&&(t.contentSubType=e.contentSubType),null!=e.skipOptions&&(t.showSkipCountdownTimer=null!=e.skipOptions.showTimer&&e.skipOptions.showTimer,t.skipOffset=e.skipOptions.skipOffsetMs,t.buttonShowTimeMs=e.skipOptions.buttonShowTimeMs),t}),e.prototype.splitMainContent=freeOnUnref(function(e,t){for(var n=[],r=0,i=0,g=0,o=0,a=e;o<a.length;o++){var v=a[o],O=v.timestampMs,S=this.getBreakType(t,v);if(O!==r){var s=(d=r-i)+(O-r);this.mainContentView.update(r,O,{timelineStart:d,timelineEnd:s,timelineUnit:ka.TimeUnit.ContentMillis})}for(var U=Vy.UUID.v4(),b=0,P=0,M=0,l=freeOnUnref(function(e){var t=Vy.UUID.v4(),n=O+b,r=n+e.durationMs,i=L.configurationStore.configuration,o=null==i||null==i.timeline||!0!==i.timeline.exposeAuxiliaryAsAd,a=null==i||null==i.timeline||!0!==i.timeline.exposeAdTransitionAsAd,s=void 0,l=void 0;"Aux"===e.contentType&&o?(s=C.createAuxiliaryMetadata(e),l="Aux"):"AdTransition"===e.contentType&&a?(s=C.createAdMetadata(e,v,t,g,M,S),l="AdTransition"):(s=C.createAdMetadata(e,v,t,g,M,S),l="Ad"),M++;var f={clickThroughTrackingUris:null!=e.clickThrough?e.clickThrough.clickTrackingUris:void 0,customClicks:e.customClicks},u=lt.CancelToken.source(),c=u.token,d=u.cancel,p=void 0,h=void 0;"Ad"===l?(h=(p=P)+e.durationMs,P+=e.durationMs):(p=0,h=e.durationMs),C.mainContentView.update(n,r,{type:l,breakId:U,adInstanceId:t,timelineStart:p,timelineEnd:h,timelineUnit:ka.TimeUnit.ContentMillis,catalogMetadata:s,videoPreviewAssets:[],transitionTimecodes:void 0,staticTimedTextStreams:[],trackingEvents:e.trackingEvents,adVideoClickTrackingUris:f,internalCancelToken:c,pauseBehavior:void 0,internalCancelFunction:d,destroy:freeOnUnref(function(){d()})});var m=Jy.PlaylistRelativeView.fromView(C.titleIdView,{adInstanceId:t}),y=new uU.TrackingEventReporter(m,C.mpPlayer,C.timeDataManager,C.adEventReporter);C.trackingEventReporters.push(y),C.playlistTrackingEventReporter.registerAdTrackingEventReporter(t,y),b+=e.durationMs}),C=this,f=0,u=v.ads;f<u.length;f++){l(u[f])}r=O+b,i+=b;var c=Jy.ItemRelativeView.fromView(this.titleIdView,{breakId:U});n.push({timestamp:O,breakId:U,view:c,vmapTrackingEvents:v.vmapTrackingEvents}),g++,this.mediaEventReportingPlaylistListener.appendAdBreakView(c)}if(r!==t){var d;s=(d=r-i)+(t-r);this.mainContentView.update(r,t,{timelineStart:d,timelineEnd:s,timelineUnit:ka.TimeUnit.ContentMillis})}return n}),e.prototype.getBreakType=freeOnUnref(function(e,t){return 0===t.timestampMs?"Pre-Roll":t.timestampMs+t.durationMs===e?"Post-Roll":"Mid-Roll"}),e})();t.CuepointPlaylistPlaylistSource=n}));e(zU);zU.CuepointPlaylistPlaylistSource;var WU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("RecapPlaylistSource"),n=freeOnUnref(function(){function e(e,t,n){this.catalogMetadata=e,this.playlistEngine=t,this.mainContentView=n}return e.prototype.resolve=freeOnUnref(function(){for(var e=this.mainContentView.getItems()[0].mediaRepresentation.periods,t=null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.playlistSource&&!0===L.configurationStore.configuration.playlistSource.enforceRecapSequentialItems,n=e.contents[0].startMs,r=0,i=e.contents;r<i.length;r++){var o=i[r];"Highlight"!==o.primeVideoContentType&&f.warn("Rapid Recap period id: "+o.id+' is not tagged as "Highlight". This is likely a publishing error, still assuming it is a recap highlight.');var a=t?n:o.startMs,s=o.endMs,l=Vy.UUID.v4();this.mainContentView.update(a,s,{type:"Recap",recapInstanceId:l,timelineStart:a,timelineEnd:s,timelineUnit:ka.TimeUnit.ContentMillis,videoPreviewAssets:[],transitionTimecodes:void 0,staticTimedTextStreams:[],catalogMetadata:this.catalogMetadata}),n=o.endMs}f.info("Playlist after inserting Rapid Recap items:\n"+JS.formatPlaylist(this.playlistEngine))}),e})();t.RecapPlaylistSource=n}));e(WU);WU.RecapPlaylistSource;var KU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=Qe,a=de.get("RegolithClient"),u=yr.createCDPResponseProcessor(function(e,t,n,r){t(e)});var n=freeOnUnref(function(){function e(e,t,n,r,i,o){void 0===n&&(n=2),void 0===r&&(r=4e3),this.regolithMetricsEventEmitter=new A.EventEmitter,this.adUrls=t,this.type=e,this.maxRetryCountPerUrl=n,this.timeoutPerUrlInMs=r,this.serviceClientFactory=i,this.traceEventController=o}return e.prototype.send=freeOnUnref(function(t){var e,n,r=this;this.traceEventController.reportTraceStart("PlaybackStartup","Regolith","ResourceLookup",{adUrlCount:this.adUrls.length.toString(),maxRetryCountPerUrl:this.maxRetryCountPerUrl.toString(),timeoutPerUrlInMs:this.timeoutPerUrlInMs.toString(),type:this.type}),e="STANDALONE"==(n=this.adUrls[0],o.Strings.startsWith(n,"https://",!1)||o.Strings.startsWith(n,"http://",!1)?"STANDALONE":"PVNE")?this.sendStandaloneRequest(t):this.sendNetworkEdgeRequest(t);var i=0;return e.then(freeOnUnref(function(e){return t.throwIfRequested(),e.on("latency",freeOnUnref(function(e){a.info("Regolith latency: "+e+"ms"),q.metrics.putMetric("Regolith.RequestLatencyTime",e,"ms"),r.regolithMetricsEventEmitter.emit("latency",e)})),e.on("attempt",freeOnUnref(function(e){i=e})),e.response()})).then(freeOnUnref(function(e){return a.info("Request succeeded after "+i+" attempts."),q.metrics.putMetric("Regolith.Resolution.Attempts",i),a.info("Regolith successful response received with "+e.playlist.length+" playlist item(s), adDeliverySessionId: "+e.description.adDeliverySessionId),q.metrics.putMetric("Regolith.Resolution",1),r.regolithMetricsEventEmitter.emit("resolutionSuccess",!0),r.traceEventController.reportTraceStop("PlaybackStartup","Regolith","Success","ResourceLookup",{adCount:e.playlist.length.toString(),attemptCount:i.toString(),adDeliverySessionId:e.description.adDeliverySessionId,type:r.type}),e})).catch(freeOnUnref(function(e){throw a.info("Request failed after "+i+" attempts."),q.metrics.putMetric("Regolith.Resolution.Attempts",i),a.error("Regolith request failed with "+r.adUrls.length+" URLs, max "+r.maxRetryCountPerUrl+" retries per URL, "+r.timeoutPerUrlInMs+"ms timeout per URL: "+e.message,e),q.metrics.putMetric("Regolith.Resolution",0),r.regolithMetricsEventEmitter.emit("resolutionSuccess",!1),r.regolithMetricsEventEmitter.emit("error",e),r.traceEventController.reportTraceStop("PlaybackStartup","Regolith","Success","ResourceLookup",{adUrlCount:r.adUrls.length.toString(),attemptCount:i.toString(),error:e.message,type:r.type}),e}))}),e.prototype.sendStandaloneRequest=freeOnUnref(function(e){var n=this,t=this.adUrls.length*this.maxRetryCountPerUrl,r=0,i=freeOnUnref(function(){return(new _n.ExponentialBackoffRetry).withMaxAttempts(t).withRandomizationFactor(200).withMaxElapsedTimeMs(1e4)}),o=freeOnUnref(function(e){r=e+1,n.regolithMetricsEventEmitter.emit("attempt",r);var t=Math.floor(e/n.maxRetryCountPerUrl);return a.info("Regolith attempt "+r+" with adUrl: "+n.adUrls[t]),new pn.HttpRequest("GET",n.adUrls[t]).timeout(n.timeoutPerUrlInMs)});return new yr.RetriableHttpRequest(i,o,u).send(e)}),e.prototype.sendNetworkEdgeRequest=freeOnUnref(function(e){var t=new mt.URL(this.adUrls[0],"https://amazon.com"),n=t.search;"?"===n[0]&&(n=n.substring(1));for(var r=new mt.URLSearchParams(n),i={},o=0,a=r.keys();o<a.length;o++){var s=a[o];i[s]=r.get(s)}var l=this.serviceClientFactory.createServiceClient(t.pathname,{},u),f={method:"GET",headers:{"Content-Type":"application/json"},queryParams:i,body:null,timeoutMs:this.timeoutPerUrlInMs,maxAttempts:this.maxRetryCountPerUrl};return Qe.sanitize(f),l.send(f,e,"BACKGROUND")}),e.prototype.on=freeOnUnref(function(e,t){this.regolithMetricsEventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.regolithMetricsEventEmitter.off(e,t)}),e})();t.RegolithClient=n}));e(KU);KU.RegolithClient;var GU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RegolithClient=KU.RegolithClient}));e(GU);GU.RegolithClient;var QU=t(freeOnUnref(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.IVA_AD_TYPE="IVA",i.SFX_AD_TYPE="SFX",i.DRAPER_AD_TYPE="Draper",i.TRANSITION_AD_TYPE="AdTransition",i.LINEAR_AD_TYPE="Linear";var y={impression:freeOnUnref(function(e){return 0}),start:freeOnUnref(function(e){return 0}),firstQuartile:freeOnUnref(function(e){return e/4}),midpoint:freeOnUnref(function(e){return e/2}),thirdQuartile:freeOnUnref(function(e){return e/4*3})};function f(e,t){if(null==e)return null;var n=e[t];if(null==n)return null;var r=n.metadata;return null==r?null:r}function a(e,t){if(null!=e&&null!=e.clickThroughs){var n=Object.keys(e.clickThroughs);if(!x.isEmpty(n)){var r=e.clickThroughs[n[0]];if(null!=r){var i=[];if(null!=e.clickTracking)for(var o=0,a=Object.keys(e.clickTracking);o<a.length;o++){var s=a[o];i.push(x.unescape(e.clickTracking[s]))}var l=function(e){var t=f(e,"watchlist");if(null==t||null==t.clickTrackings)return null;return t.clickTrackings}(t);if(null!=l&&i.push(x.unescape(l)),!x.isEmpty(i))return{clickThroughUri:x.unescape(r),clickTrackingUris:i}}}}}function s(e,t){var n=[];if(null!=e&&null!=e.customClicks)for(var r=0,i=Object.keys(e.customClicks);r<i.length;r++){var o=i[r];n.push({id:o,uri:x.unescape(e.customClicks[o])})}var a=function(e){var t=f(e,"watchlist");if(null==t||null==t.customClicks)return null;return t.customClicks}(t);if(null!=a&&n.push({id:"watchlist",uri:x.unescape(a)}),!x.isEmpty(n))return n}function l(e){var t,n,r=[],i=null==(n=f(e,"goAdFree"))||null==n.ref?null:null!=n.program&&null!=n.identifier?{type:"Element",name:"Extension",attributes:{type:"GoAdFreeV2",ref:(t=n).ref},children:[{type:"Element",name:"program",attributes:{},children:[{type:"Text",text:t.program}]},{type:"Element",name:"identifier",attributes:{},children:[{type:"Text",text:t.identifier}]}]}:{type:"Element",name:"Extension",attributes:{type:"GoAdFree",ref:n.ref},children:[]};null!=i&&r.push(i);var o=null==f(e,"watchlist")?null:{type:"Element",name:"Extension",attributes:{type:"watchlist"},children:[]};null!=o&&r.push(o);var a,s=null==(a=f(e,"actionable"))||null==a.id||null==a.version||null==a.apiFramework||null==a.adParameters?null:{type:"Element",name:"Extension",attributes:{type:"ava.amazon.com/actionable"},children:[{type:"Element",name:"ActionableAd",attributes:{id:a.id,version:a.version},children:[{type:"Element",name:"InteractiveCreativeFile",attributes:{apiFramework:a.apiFramework},children:null==a.interactiveCreativeFile?[]:[{type:"Text",text:a.interactiveCreativeFile}]},{type:"Element",name:"AdParameters",attributes:{},children:[{type:"Text",text:a.adParameters}]}]}]};null!=s&&r.push(s);var l=null==f(e,"adFeedback")?null:{type:"Element",name:"Extension",attributes:{type:"AdFeedback"},children:[]};return null!=l&&r.push(l),r}function u(e){return"FadeAd"===e?"AdTransition":"Ad"}i.TRACKING_EVENT_POSITION_MAP=y;var t=freeOnUnref(function(){function e(){}return e.transformAdPlaylistItemToSimplifiedAd=freeOnUnref(function(e){var t,n=jr.extendedLimitedIso8601TimeFormatToMilliseconds(e.description.duration),r=e.uiFeatures,i=e.description,o=e.measurement;return{durationMs:n,adId:e.description.adId,creativeId:e.description.creativeId,contentType:u(i.contentType),contentSubType:function(e){switch(e){case"FadeAd":return"FadeAd";case"Bumper":return"Bumper"}}(i.contentType),adSystem:(t=i.componentProvider,{name:t}),extensions:l(r),skipOptions:function(e,t){var n=f(e,"skippable");if(null!=n&&null!=n.skipOffset&&null!=n.minAdLength){var r=n.skipOffset,i=n.minAdLength,o=n.showTimer;if(!(t<jr.extendedLimitedIso8601TimeFormatToMilliseconds(i)))return{skipOffsetMs:jr.extendedLimitedIso8601TimeFormatToMilliseconds(r),showTimer:"true"===o}}}(r,n),showAdDurationTimer:function(e){var t=f(e,"countdown");if(null!=t)return"true"===t.include}(r),customClicks:s(o.videoClicks,r),clickThrough:a(o.videoClicks,r),trackingEvents:function(e,t){var n=[];if(null!=e.trackingEvents)for(var r=0,i=Object.keys(e.trackingEvents);r<i.length;r++)for(var o=i[r],a=0,s=e.trackingEvents[o];a<s.length;a++){var l={name:o,uri:s[a],reported:!1},f=y[o];null!=f&&(l.position=f(t)),n.push(l)}if(null!=e.errorUrls)for(var u=0,c=e.errorUrls;u<c.length;u++){var d=c[u];n.push({name:"error",uri:x.unescape(d),reported:!1})}if(null!=e.impressions)for(var p=0,h=e.impressions;p<h.length;p++){var m=h[p];n.push({name:"impression",uri:x.unescape(m),reported:!1,position:y.impression(t)})}if(0!==n.length)return n}(o,n)}}),e.identifyAdType=freeOnUnref(function(e){var t=e.uiFeatures,n=e.description;if("AdTransition"===u(n.contentType))return i.TRANSITION_AD_TYPE;var r=f(t,"actionable");return null!=r&&null!=r.id&&null!=r.version&&null!=r.apiFramework&&null!=r.adParameters?null!=r.interactiveCreativeFile?i.SFX_AD_TYPE:i.IVA_AD_TYPE:"Draper"===n.contentType?i.DRAPER_AD_TYPE:i.LINEAR_AD_TYPE}),e})();i.RegolithAdPlaylistTransformer=t}));e(QU);QU.IVA_AD_TYPE,QU.SFX_AD_TYPE,QU.DRAPER_AD_TYPE,QU.TRANSITION_AD_TYPE,QU.LINEAR_AD_TYPE,QU.TRACKING_EVENT_POSITION_MAP,QU.RegolithAdPlaylistTransformer;var XU=t(freeOnUnref(function(e,t){function l(e,t){e[t]=Qe.withDefault(e[t],0)+1}Object.defineProperty(t,"__esModule",{value:!0}),t.getMidrollPrefix=function(e,t){return"Midroll_"+(e+(t?0:1))};var u=de.get("AdBreakCustomMetadataReporter"),n=freeOnUnref(function(){function e(e){this.resolutionLatencyTracker={},this.playlistMetadata={TotalAdCount:0},this.mediaEventController=e}return e.prototype.reportAdBreakMetadata=freeOnUnref(function(e,t){for(var n,r=((n={})[e+"_AdCount"]=0,n),i=0,o=t.playlist;i<o.length;i++){var a=o[i];l(r,e+"_AdCount"),l(this.playlistMetadata,"TotalAdCount");var s=QU.RegolithAdPlaylistTransformer.identifyAdType(a);l(r,e+"_"+s+"Count"),l(this.playlistMetadata,"Total"+s+"Count")}this.reportMetadata(r),this.reportMetadata(this.playlistMetadata)}),e.prototype.attachListenersForRegolithMetrics=freeOnUnref(function(t,e){var n=this;e.on("latency",freeOnUnref(function(e){return n.onLatency(t,e)})),e.on("attempt",freeOnUnref(function(e){return n.onAttempt(t,e)})),e.on("error",freeOnUnref(function(e){return n.onError(t,e)})),e.on("resolutionSuccess",freeOnUnref(function(e){return n.onResolutionSuccess(t,e)}))}),e.prototype.onLatency=freeOnUnref(function(e,t){var n,r=Qe.withDefault(this.resolutionLatencyTracker[e],{latency:0,attempt:0});r.latency+=t,r.attempt++,u.info("AdBreakCustomMetadataReporter: "+e+" latencyMs: "+t+" attempt: "+r.attempt);var i=r.latency/r.attempt;this.resolutionLatencyTracker[e]=r;for(var o=0,a=0,s=0,l=Object.keys(this.resolutionLatencyTracker);s<l.length;s++){var f=l[s];a+=this.resolutionLatencyTracker[f].latency,o+=this.resolutionLatencyTracker[f].attempt}this.reportMetadata(((n={})[e+"_RegolithAverageLatencyMs"]=i,n.TotalRegolithAverageLatencyMs=a/o,n))}),e.prototype.onAttempt=freeOnUnref(function(e,t){var n;this.reportMetadata(((n={})[e+"_RegolithRetryCount"]=t,n))}),e.prototype.onError=freeOnUnref(function(e,t){var n;this.reportMetadata(((n={})[e+"_RegolithFailureReason"]=t.message,n))}),e.prototype.onResolutionSuccess=freeOnUnref(function(e,t){var n;this.reportMetadata(((n={})[e+"_RegolithResolveSuccess"]=t?"true":"false",n)),l(this.playlistMetadata,!0===t?"RegolithResolveSuccessCount":"RegolithResolveFailureCount"),this.reportMetadata(this.playlistMetadata)}),e.prototype.reportMetadata=freeOnUnref(function(e){if(!x.isEmpty(e)){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];t[i]=e[i].toString()}this.mediaEventController.reportCustomMetadata(t)}}),e})();t.AdBreakCustomMetadataReporter=n}));e(XU);XU.getMidrollPrefix,XU.AdBreakCustomMetadataReporter;var YU=t(freeOnUnref(function(e,t){function o(e,t){var n=t.items[e];return"UnresolvedAdBreak"===t.contentInfos[n.contentId].contentType}function a(e,t){var n=t.items[e],r=t.contentInfos[n.contentId].contentType;return"UnresolvedAdBreak"===r||"AdTransition"===r||"Advertisement"===r}Object.defineProperty(t,"__esModule",{value:!0}),t.translateClientTimelineIndexToXpPlaylistIndex=function(e,t,n){if(e<0||e>=t.items.length)throw new Error("Invalid client timeline index "+e+" for timeline of length "+t.items.length);for(var r=n.getItems().length-1,i=t.items.length-1;e<i&&0<=r;)o(i,t)||r--,i--;if(0<=i&&e<=i&&o(i,t)&&r++,i!==e||r<0)throw new Error("Client timeline and XP playlist are out of sync: currentClientTimelineIndex="+i+", clientTimelineIndex="+e+", xpPlaylistIndex="+r);return r},t.translateXpPlaylistIndexToClientTimelineIndex=function(e,t){var n=t.getItems();if(e<0||e>=n.length)throw new Error("Invalid XP playlist index "+e+" for playlist of length "+n.length);for(var r=-1,i=0;i<=e;)n[i].hasUnresolvedAdBreakBefore&&r++,r++,i++;if(-1===r)throw new Error("Client timeline and XP playlist out of sync: currentXpPlaylistIndex="+i+", xpPlaylistIndex="+e+", clientTimelineIndex="+r);return r},t.translateClientTimelineToIntraTitleIndex=function(e,t,n){if(e<0||e>=t.items.length)throw new Error("Invalid client timeline index "+e+" for timeline of length "+t.items.length);if(a(e,t))throw new Error("Client timeline item is not a main item or card");for(var r=n.length-1,i=t.items.length-1;e<i;){for(i--,r--;0<=i&&a(i,t);)i--;for(;0<=r&&"Remote"===n[r].type;)r--}return r},t.translateAdBreakIndexToIntraTitlePlaylist=function(e,t){if(e<0||e>=t.length)return-1;for(var n=0,r=0;r<t.length;r++)if("Remote"===t[r].type){if(n===e)return r;n++}return-1},t.translateToRelativeAdBreakIndex=function(e,t){if(e<0||e>=t.length||"Remote"!==t[e].type)return-1;for(var n=-1,r=0;r<=e;r++)"Remote"===t[r].type&&n++;return n},t.translateIntraTitleIndexToXpPlaylistIndex=function(e,t,n){var r=t.getItems();if(e<0||e>=n.length)return-1;for(var i,o,a=0,s=0;s<e;s++)if("Remote"===n[s].type)for(;a<r.length&&(i=a,"Ad"===(o=t.getItems()[i]).type||"AdTransition"===o.type);)a++;else a++;return a>=r.length?-1:a}}));e(YU);YU.translateClientTimelineIndexToXpPlaylistIndex,YU.translateXpPlaylistIndexToClientTimelineIndex,YU.translateClientTimelineToIntraTitleIndex,YU.translateAdBreakIndexToIntraTitlePlaylist,YU.translateToRelativeAdBreakIndex,YU.translateIntraTitleIndexToXpPlaylistIndex;var JU=t(freeOnUnref(function(e,t){var y=ce&&ce.__assign||freeOnUnref(function(){return(y=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("AdBreakManager"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v,O){this.trackingEventReporters=[],this.adBreakWatchTracker={},this.playbackResourcesTimestamp=e,this.playlistedPlaybackUrls=t,this.playlistEngine=n,this.mediaRepresentation=r,this.sourceCdnStore=i,this.resourceAcquirer=o,this.serviceClientFactory=a,this.mainContentView=s,this.titleIdView=l,this.adBreakContextUpdater=f,this.mpPlayer=u,this.timeDataManager=c,this.adEventReporter=d,this.playlistTrackingEventReporter=p,this.mediaEventController=h,this.contentMetadata=m,this.consumptionIdUpdater=y,this.encodePreferences=v,this.adBreakCustomMetadataReporter=g,this.clientId=O,this.intraTitlePlaylist=this.playlistedPlaybackUrls.intraTitlePlaylist,this.resolvedIndices={},this.currentResolution=lt.Promise.resolve();var S=lt.CancelToken.source();this.cancel=S.cancel,this.token=S.token}return e.prototype.terminate=freeOnUnref(function(){this.cancel(),this.trackingEventReporters.forEach(freeOnUnref(function(e){return e.destroy()})),this.trackingEventReporters=[];for(var e=0,t=Object.keys(this.adBreakWatchTracker);e<t.length;e++){var n=t[e],r=this.adBreakWatchTracker[n].exitViewCallback;this.adBreakWatchTracker[n].adBreakView.off("ExitView",r)}}),e.prototype.setAdPodInterceptor=freeOnUnref(function(e){this.adPodInterceptor=e}),e.prototype.resolveAdBreak=freeOnUnref(function(e,t,n){var r=this;u.info("Processing request to resolve midroll "+e),this.logTimelines("before ad break resolution");var i=YU.translateAdBreakIndexToIntraTitlePlaylist(e,this.intraTitlePlaylist);if(-1===i)return lt.Promise.reject(new Error("Invalid ad break index "+e+"."));if(null!=this.resolvedIndices[i])return u.info("Returning existing midroll "+e+" promise."),this.resolvedIndices[i];var o=YU.translateIntraTitleIndexToXpPlaylistIndex(i,this.playlistEngine,this.playlistedPlaybackUrls.intraTitlePlaylist);if(-1===o||!this.playlistEngine.getItems()[o].hasUnresolvedAdBreakBefore)return lt.Promise.reject(new Error("XP playlist out of sync"));var a=XU.getMidrollPrefix(e,"Remote"===this.intraTitlePlaylist[0].type);this.reportResolveReason(n,a);var s=this.intraTitlePlaylist[i],l=this.currentResolution.catch(freeOnUnref(function(){})).then(freeOnUnref(function(){return r.resolveAndInsert(s,r.token,o,e,t,a)}));return this.resolvedIndices[i]=l,this.currentResolution=l}),e.prototype.removeAdBreaksAheadOfPlayhead=freeOnUnref(function(a){if(null==L.configurationStore.configuration||null==L.configurationStore.configuration.extensiblePlaylisting||!0!==L.configurationStore.configuration.extensiblePlaylisting.disableViewedAdBreakRemoval){u.info("Removing ad breaks adhead of "+a),this.logTimelines("before removing viewed ad break");for(var s=this.playlistEngine.getItems(),l=0,e=freeOnUnref(function(t){var e=f.adBreakWatchTracker[t];if(e.isRemoved||!e.hasViewed)return"continue";var n=x.findIndex(s,freeOnUnref(function(e){return e.breakId===t}));if(n<=a)return"continue";for(var r=x.findLastIndex(s,freeOnUnref(function(e){return e.breakId===t})),i=n;i<=r;i++)f.mediaRepresentation.remove(s[i].playlistedItemId);var o=s[r].end-s[n].start;f.playlistEngine.splice(n,s[n].start,r+1,s[r+1].start,[]),f.playlistEngine.shiftPositionsFrom(n,-1*o),l++,e.isRemoved=!0,u.info("Removed ad break: "+t)}),f=this,t=0,n=Object.keys(this.adBreakWatchTracker);t<n.length;t++){e(n[t])}0<l&&this.flushContentSourceIfNeeded(a,!0),u.info("Removed "+l+" adbreaks from playlist"),this.logTimelines("after removing viewed ad break")}}),e.prototype.resolveAndInsert=freeOnUnref(function(e,n,r,i,o,t){var a=this,s=new GU.RegolithClient("Midroll",e.urlsInPriorityOrder,e.resolutionConstraints.maxRetryCountPerUrl,e.resolutionConstraints.timeoutInMs,this.serviceClientFactory,this.mediaEventController.traceEventController);return this.adBreakCustomMetadataReporter.attachListenersForRegolithMetrics(t,s),s.send(n).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)return null;u.error("Error resolving ad break, unblocking timeline at index:",r,e);var t=new ct.XpError("regolith.error","Failed to resolve ad break "+i+": "+e.message,"Regolith Error",!1,e);return a.mediaEventController.reportError(!1,t,"Player","Error"),a.unblockXpPlaylistIndex(r),a.logTimelines("after unblocking player"),null})).then(freeOnUnref(function(e){if(n.throwIfRequested(),null!=e){u.info("Ad break "+i+" resolved with ad count "+e.playlist.length);var t=a.insertIntoMediaRepresentation(e,r,i);u.info("Inserted mid-roll "+i+" into media representation"),a.logTimelines("after inserting mid-roll periods to Media Representation"),a.insertIntoPlaylist(e,t,r,i),a.flushContentSourceIfNeeded(r+e.playlist.length,o),a.unblockXpPlaylistIndex(r+e.playlist.length),u.info("Inserted mid-roll "+i+" into playlist engine and unblocked player"),a.logTimelines("after inserting mid-roll items to Playlist and unblocking player")}}))}),e.prototype.flushContentSourceIfNeeded=freeOnUnref(function(e,t){if(t){var n=this.playlistEngine.getItems()[e];null!=n&&null!=n.contentSource&&(u.info("Flushing content source"),n.contentSource.flush())}}),e.prototype.unblockXpPlaylistIndex=freeOnUnref(function(e){var t=this.playlistEngine.getItems();this.titleIdView.update(t[e].start,t[e].end,{hasUnresolvedAdBreakBefore:!1}),this.mediaRepresentation.periods.contents[e].allowForwardAccess()}),e.prototype.insertIntoPlaylist=freeOnUnref(function(e,t,n,r){var i=this,o=this.createPlaylistItemsFromRegolithResponse(e,t,n,r),a=this.playlistEngine.getItems()[n].start;this.playlistEngine.splice(n,a,n,a,o);var s=o.reduce(freeOnUnref(function(e,t){return e+t.end-t.start}),0);if(this.playlistEngine.shiftPositionsFrom(n+o.length,s),0<o.length){for(var l=0,f=o;l<f.length;l++){var u=f[l].adInstanceId,c=Jy.PlaylistRelativeView.fromView(this.titleIdView,{adInstanceId:u}),d=new uU.TrackingEventReporter(c,this.mpPlayer,this.timeDataManager,this.adEventReporter);this.playlistTrackingEventReporter.registerAdTrackingEventReporter(u,d),this.trackingEventReporters.push(d)}var p=o[0].breakId,h=Jy.ItemRelativeView.fromView(this.titleIdView,{breakId:p}),m=freeOnUnref(function(){return i.onAdBreakExit(p)});h.on("ExitView",m),this.adBreakWatchTracker[p]={breakId:p,adBreakView:h,exitViewCallback:m,hasViewed:!1,isRemoved:!1};var y={timestamp:o[0].start,breakId:p,view:h,vmapTrackingEvents:[]};this.adPodInterceptor.appendAdBreakView(y),this.adBreakContextUpdater.appendAdBreakView(h)}}),e.prototype.createPlaylistItemsFromRegolithResponse=freeOnUnref(function(e,t,n,r){for(var i=[],o=Vy.UUID.v4(),a=this.playlistEngine.getItems()[n],s=a.start,l=0,f=0;f<e.playlist.length;f++){var u=e.playlist[f],c=QU.RegolithAdPlaylistTransformer.transformAdPlaylistItemToSimplifiedAd(u),d=c.durationMs,p=Vy.UUID.v4(),h=rb.createAdMetadata(c,p,r,f,"Mid-Roll",e.description.adDeliverySessionId,e.description.adMarkerId,u.uiFeatures),m=this.mainContentView.createItem(y({},this.contentMetadata,{type:c.contentType,start:s,end:s+d,timelineStart:l,timelineEnd:l+d,timelineUnit:ka.TimeUnit.ContentMillis,breakId:o,adInstanceId:p,catalogMetadata:h,trackingEvents:c.trackingEvents,adVideoClickTrackingUris:{clickThroughTrackingUris:null!=c.clickThrough?c.clickThrough.clickTrackingUris:void 0,customClicks:c.customClicks},videoPreviewAssets:[],transitionTimecodes:void 0,staticTimedTextStreams:[],pauseBehavior:void 0,playlistedItemId:t[f].id,mediaRepresentation:this.mediaRepresentation,contentSource:a.contentSource,internalCancelToken:this.token,internalCancelFunction:this.cancel,consumptionIdUpdater:this.consumptionIdUpdater,encodePreferences:this.encodePreferences,clientId:this.clientId,sourceUrlStore:t[f].sourceUrlStore}));i.push(m),s+=d,l+=d}return i}),e.prototype.insertIntoMediaRepresentation=freeOnUnref(function(e,t,n){for(var r=this,i=[],o=this.mediaRepresentation.periods.contents[t],a=this.intraTitlePlaylist.filter(freeOnUnref(function(e){return"Main"===e.type}))[0],s=a.urls[0].consumptionId,l={},f=0,u=a.urls;f<u.length;f++){var c=u[f];l[c.cdn]=c.consumptionId}for(var d=n+("Remote"===this.intraTitlePlaylist[0].type?0:1),p=0;p<e.playlist.length;p++){for(var h=e.playlist[p],m=jr.extendedLimitedIso8601TimeFormatToMilliseconds(h.description.duration),y=[],g=0,v=h.media.urls;g<v.length;g++){var O=v[g],S=Qe.withDefault(l[O.cdn],s),U=O.consumptionId;y.push({url:O.url,cdn:O.cdn,origin:O.origin,consumptionId:S,assetConsumptionId:U})}var b=new ih.PlaylistedPeriod("AdBreak"+d+"_Ad"+p,m,this.playbackResourcesTimestamp,!1,y,this.sourceCdnStore,this.resourceAcquirer,null,"Remote",this.mediaEventController.traceEventController,freeOnUnref(function(e){r.mediaEventController.reportAccessTokenAcquisition(e)}));i.push(b)}return this.mediaRepresentation.insertBefore(i,o.id),i}),e.prototype.onAdBreakExit=freeOnUnref(function(e){u.info("Ad break "+e+" has been viewed"),this.adBreakWatchTracker[e].hasViewed=!0}),e.prototype.reportResolveReason=freeOnUnref(function(e,t){var n;this.mediaEventController.reportCustomMetadata(((n={})[t+"_ResolveReason"]=e.toString(),n))}),e.prototype.logTimelines=freeOnUnref(function(e){u.info("Playlist "+e+":\n"+JS.formatPlaylist(this.playlistEngine)),u.info("Media Representation "+e+":\n"+JS.formatPlaylistedMediaRepresentation(this.mediaRepresentation))}),e})();t.AdBreakManager=n}));e(JU);JU.AdBreakManager;var ZU=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("ActivePlaylistedPlaybackConsumptionIdTracker"),r=freeOnUnref(function(){function e(e){this.playlistedItemView=[],this.consumptionIdUpdater=e}return Object.defineProperty(e.prototype,"isActive",{get:freeOnUnref(function(){return null!=this.currentPeriod}),enumerable:!0,configurable:!0}),e.prototype.terminate=freeOnUnref(function(){for(var e=0,t=this.playlistedItemView;e<t.length;e++){var n=t[e];n.view.off("EnterView",n.onEnterView)}this.playlistedItemView=[],this.currentPeriod=void 0}),e.prototype.appendPlaylistedItem=freeOnUnref(function(e,t){var n=this,r=freeOnUnref(function(){return n.onItemEnterView(t)});e.on("EnterView",r),this.playlistedItemView.push({view:e,onEnterView:r})}),e.prototype.updateConsumptionId=freeOnUnref(function(){null!=this.currentPeriod?this.consumptionIdUpdater.updateConsumptionId(this.currentPeriod.consumptionId):n.warn("No current period to update consumption id")}),e.prototype.onItemEnterView=freeOnUnref(function(e){this.currentPeriod=e,this.updateConsumptionId()}),e})();t.ActivePlaylistedPlaybackConsumptionIdTracker=r}));e(ZU);ZU.ActivePlaylistedPlaybackConsumptionIdTracker;var $U=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("MediaEventReportingPlaylistListener");var n=freeOnUnref(function(){function e(e){var t=this;this.adBreakViews=[],this.onEnterAdBreakView=freeOnUnref(function(){t.mediaEventController.updatePlaybackContentContext("AdBreak")}),this.onExitAdBreakView=freeOnUnref(function(){t.mediaEventController.updatePlaybackContentContext("Feature")}),this.mediaEventController=e}return e.prototype.destroy=freeOnUnref(function(){var t=this;this.adBreakViews.forEach(freeOnUnref(function(e){e.off("EnterView",t.onEnterAdBreakView),e.off("ExitView",t.onExitAdBreakView)})),this.adBreakViews=[]}),e.prototype.appendAdBreakView=freeOnUnref(function(e){e.getItems().some(freeOnUnref(function(e){return"Ad"===e.type}))&&(e.on("EnterView",this.onEnterAdBreakView),e.on("ExitView",this.onExitAdBreakView),this.adBreakViews.push(e))}),e})();t.AdBreakContextUpdater=n}));e($U);$U.AdBreakContextUpdater;var eb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("AdPreloadMonitor"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s){var l=this;this.isPreloadTriggered=!1,this.handleMainItemEnter=freeOnUnref(function(){l.mpPlayer.on("timeupdate",l.checkPlayheadPosition),l.checkPlayheadPosition()}),this.handleMainItemExit=freeOnUnref(function(){l.mpPlayer.off("timeupdate",l.checkPlayheadPosition)}),this.checkPlayheadPosition=freeOnUnref(function(){if(l.isPreloadTriggered)f.enabledFor(de.DEBUG)&&f.info("Ignoring redundant trigger for playlist item "+l.mainPlaylistItem.playlistedItemId+".");else if(null!=l.mainPlaylistItem.end){var e=l.mpPlayer.currentTimeMs;if(null!=e){if(l.mainPlaylistItem.end-e<=l.resolutionWindowMs){f.info("Triggering ad preload for item "+l.mainPlaylistItem.playlistedItemId),l.adBreakManager.resolveAdBreak(l.associatedRemoteItemIndex,!1,0),l.isPreloadTriggered=!0;var t={};t[XU.getMidrollPrefix(l.associatedRemoteItemIndex,l.hasPrerollAdBreak)+"_ResolutionWindowMs"]=l.resolutionWindowMs.toString(),t.MidrollResolutionWindowMs=l.resolutionWindowMs.toString(),l.mediaEventController.reportCustomMetadata(t)}}else f.warn("Current time is undefined")}else f.warn("Main playlist item end time is not defined")}),this.hasPrerollAdBreak=e,this.mpPlayer=t,this.mainPlaylistItem=n,this.associatedRemoteItemIndex=r,this.itemView=i,this.adBreakManager=o,this.mediaEventController=a,this.resolutionWindowMs=Qe.withDefault(s,3e5),f.info("Created ad preload monitor for ad break index: "+r)}return e.prototype.initialize=freeOnUnref(function(){this.itemView.on("EnterView",this.handleMainItemEnter),this.itemView.on("ExitView",this.handleMainItemExit)}),e.prototype.terminate=freeOnUnref(function(){this.itemView.off("EnterView",this.handleMainItemEnter),this.itemView.off("ExitView",this.handleMainItemExit)}),e})();t.AdPreloadMonitor=n}));e(eb);eb.AdPreloadMonitor;var tb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("AdAwareSeekInterceptor"),n=freeOnUnref(function(){function e(e,t,n,r){this.playlistEngine=e,this.intraTitlePlaylist=t,this.adBreakManager=n,this.hasPrerollAdBreak=r}return e.prototype.interceptSeek=freeOnUnref(function(e,t,n){f.info("Processing seek to "+e+"ms on timeline item index "+t);if(__HOMEBREW_NOADS){var __xpIndex=YU.translateClientTimelineIndexToXpPlaylistIndex(t,n,this.playlistEngine);f.info("debugSimulatedAds: mapping-only seek interceptor returning xp index "+__xpIndex);return lt.Promise.resolve(__xpIndex)}var r=YU.translateClientTimelineToIntraTitleIndex(t,n,this.intraTitlePlaylist),i=YU.translateClientTimelineIndexToXpPlaylistIndex(t,n,this.playlistEngine),o=this.playlistEngine.getCurrentItemIndex()>i;if(this.adBreakManager.removeAdBreaksAheadOfPlayhead(i),this.playlistEngine.getCurrentItemIndex()===i)return f.info("Seeking within current chapter. Not resolving ads and returning original playlist engine index "+i),lt.Promise.resolve(i);if(0===r||"Remote"!==this.intraTitlePlaylist[r-1].type)return f.info("Previous item is not of type Remote or is preroll. Returning index "+i),lt.Promise.resolve(i);var a=this.playlistEngine.getItems(),s=a[i].playlistedItemId,l=YU.translateToRelativeAdBreakIndex(r-1,this.intraTitlePlaylist);return this.hasPrerollAdBreak&&0===l?(f.info("Pre-roll ad break is already resolved. Returning index "+i),lt.Promise.resolve(i)):(f.info("Resolving ad break at index "+l+" for playlist item "+s),this.adBreakManager.resolveAdBreak(l,o,1).then(freeOnUnref(function(){var e=x.findIndex(a,freeOnUnref(function(e){return e.playlistedItemId===s}));return f.info("Resolved ad break. Returning index "+e),lt.Promise.resolve(e)})))}),e})();t.AdAwareSeekInterceptor=n}));e(tb);tb.AdAwareSeekInterceptor;var nb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("PlaylistedPlaybackUrlsSourceCdnStore"),n=freeOnUnref(function(){function e(e,t){this.cdnList=e,this.activeCdnIndex=0,this.failoverTracker=new WS.FailoverTracker,this.eventEmitter=new A.EventEmitter,this.activePlaylistedPlaybackConsumptionIdTracker=t}return e.prototype.get=freeOnUnref(function(){return this.cdnList[this.activeCdnIndex]}),e.prototype.resourceAcquired=freeOnUnref(function(e){this.failoverTracker.resetFailoverCaseCounter()}),e.prototype.resourceAcquisitionFailed=freeOnUnref(function(e,t,n){if(i.warn("Received acquisition error for "+n+", type: "+Ac.AcquisitionResourceType[t]+", error:\n"+GS.formatAcquisitionErrorReasonForLogging(e)),"SourceError"===e.type)return!1;var r=this.failoverTracker.resourceAcquisitionFailed(e,t);return null!=r&&("cdn"===r.failoverAction?this.switchToNextCdn():i.warn("Unexpected failover action: "+r.failoverAction)),!0}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.switchToNextCdn=freeOnUnref(function(){var e=this.activeCdnIndex;return this.activeCdnIndex=(this.activeCdnIndex+1)%this.cdnList.length,this.eventEmitter.emitSync("SourceCdnChange",{previousSourceCdn:this.cdnList[e],newSourceCdn:this.cdnList[this.activeCdnIndex],failoverMode:"seamless"}),i.info("CDN switch from "+this.cdnList[e]+" to "+this.cdnList[this.activeCdnIndex]),q.metrics.putMetric("Failover.CdnSwitch."+this.cdnList[e].toLowerCase()),null!=this.activePlaylistedPlaybackConsumptionIdTracker&&this.activePlaylistedPlaybackConsumptionIdTracker.isActive&&this.activePlaylistedPlaybackConsumptionIdTracker.updateConsumptionId(),"seamless"}),e})();t.PlaylistedPlaybackUrlsSourceCdnStore=n}));e(nb);nb.PlaylistedPlaybackUrlsSourceCdnStore;var __DevSimAdsLog=de.get("SimulatedAdTrackingManager");var __HOMEBREW_DEBUG_LOGS=!1;var __HOMEBREW_DEBUG_LOGS_ENDPOINT="127.0.0.1:8089";var __HOMEBREW_NOADS=!0;var __HOMEBREW_NOTELEMETRY=!1;var __HOMEBREW_NOMETRICS=!1;var rb=t(freeOnUnref(function(e,t){var M=ce&&ce.__assign||freeOnUnref(function(){return(M=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var C=de.get("PlaylistedPlaybackUrlsPlaylistSourceHandler");function E(e,t,n,r,i,o,a,s){var l={showCountdownTimer:!0===e.showAdDurationTimer,adSystem:e.adSystem,adInstanceId:t,extensions:e.extensions,breakNumber:n,adNumberWithinBreak:r,breakType:i,adDeliverySessionId:o,adBreakId:a,uiFeatures:s};if(null!=e.skipOptions&&(l.showSkipCountdownTimer=null!=e.skipOptions.showTimer&&e.skipOptions.showTimer,l.skipOffset=e.skipOptions.skipOffsetMs,l.buttonShowTimeMs=e.skipOptions.buttonShowTimeMs),null!=e.clickThrough&&(l.clickThroughUri=e.clickThrough.clickThroughUri),null!=e.customClicks){for(var f=[],u=0,c=e.customClicks;u<c.length;u++){var d=c[u];f.push(d.id)}l.customClicks=f}return null!=e.creativeId&&(l.creativeId=e.creativeId),null!=e.adId&&(l.adId=e.adId),l}t.createAdMetadata=E;var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v,O,S,U,b,P,M,C,E){var T=this;this.frontBufferSetter=null,this.contentSource=null,this.mainContentView=null,this.adBreakManager=null,this.mediaRepresentation=null,this.adAwareSeekInterceptor=null,this.trackingEventReporters=[],this.adMonitors=[],this.playlistPeriodItemIndexMap={},this.hasPrerollAdBreak=!1,this.onContentSourceFatalError=freeOnUnref(function(e){e instanceof ct.XpError&&"content_src.manifest.parse"===e.code?T.mediaEventController.reportError(!0,e,"Player","ManifestParse"):T.mediaEventController.reportError(!0,e,"Player","Error"),T.globalStreamControl.onStreamFatalError(e)}),this.reportLicenseAcquisitionSuccess=freeOnUnref(function(e){var t=e;t.consumptionId=T.getFirstItemConsumptionId(),t.titleId=T.titleIdView.id.titleId,T.mediaEventController.reportLicenseAcquisitionSuccess(t)}),this.reportLicenseAcquisitionFailure=freeOnUnref(function(e){var t=e;t.consumptionId=T.getFirstItemConsumptionId(),t.titleId=T.titleIdView.id.titleId,T.mediaEventController.reportLicenseAcquisitionFailure(t)}),this.onStreamRestartNeeded=freeOnUnref(function(e){var t=e.videoQuality;T.globalStreamControl.onStreamRestart(T.contentConfig,{videoQuality:t})}),this.reportAccessTokenAcquisition=freeOnUnref(function(e){T.mediaEventController.reportAccessTokenAcquisition(e)}),this.reportFragmentDownloadSuccess=freeOnUnref(function(e){var t=e;t.consumptionId=e.urlId,t.titleId=T.titleIdView.id.titleId,T.mediaEventController.reportFragmentAcquisitionSuccess(t);var n=T.playlistedPlaybackUrls.failoverPolicy.cdnOrder[0];T.sonarEventAdapter.handleFragmentAcquisitionSuccessEvent(e,n)}),this.reportFragmentDownloadFailure=freeOnUnref(function(e){if(null!=e.acquisitionError&&"ParseError"===e.acquisitionError.reason.type){var t=e.acquisitionError.reason.cause;T.mediaEventController.reportError(!1,t,"Player","FragmentParse")}else{var n=e;n.consumptionId=e.urlId,n.titleId=T.titleIdView.id.titleId,T.mediaEventController.reportFragmentAcquisitionFailure(n),T.sonarEventAdapter.handleFragmentAcquisitionFailure(n)}}),this.reportManifestAcquisitionSuccess=freeOnUnref(function(e){var t=e;t.consumptionId=e.sourceUrl.urlId,t.titleId=T.titleIdView.id.titleId,T.mediaEventController.reportManifestAcquisitionSuccess(t),T.sonarEventAdapter.handleManifestFetchedEvent()}),this.reportManifestAcquisitionFailure=freeOnUnref(function(e){var t=e;t.consumptionId=e.sourceUrl.urlId,t.titleId=T.titleIdView.id.titleId,T.mediaEventController.reportManifestAcquisitionFailure(t),T.sonarEventAdapter.handleManifestAcquisitionFailure(t)}),this.contentConfig=e,this.playlistEngine=r,this.mediaKeysManager=p,this.mpPlayer=v,this.contentMetadata=o,this.playbackSettingsProvider=a,this.prioritizationSystem=s,this.playerBufferManager=l,this.streamFeature=f,this.videoPreviewFeature=u,this.hdcpStore=c,this.resolutionCappingStrategy=d,this.downloadOperationId=M,this.licenseAcquirer=i.licenseAcquirer,this.playlistedPlaybackUrls=i.playlistedPlaybackUrls,this.cacheStorageType=C,this.mediaEventController=h,this.titleIdView=m,this.globalStreamControl=y,this.sonarEventAdapter=g,this.consumptionIdUpdater=O,this.timeDataManager=S,this.adEventReporter=U,this.playlistTrackingEventReporter=b,this.suggestedPictureModes=E,this.seekInterceptorManager=P,this.playbackResourcesTimestamp=t,this.serviceClientFactory=n,this.rawIntraTitlePlaylist=this.playlistedPlaybackUrls.intraTitlePlaylist,this.intraTitlePlaylist=this.playlistedPlaybackUrls.intraTitlePlaylist,this.resourceAcquirer=new Ac.ResourceAcquirer,this.adBreakContextUpdater=new $U.AdBreakContextUpdater(this.mediaEventController),this.activePlaylistedPlaybackConsumptionIdTracker=new ZU.ActivePlaylistedPlaybackConsumptionIdTracker(this.consumptionIdUpdater),this.playlistedSourceCdnStore=new nb.PlaylistedPlaybackUrlsSourceCdnStore(this.playlistedPlaybackUrls.failoverPolicy.cdnOrder,this.activePlaylistedPlaybackConsumptionIdTracker),this.registerLicenseAcquisitionReporterCallbacks(this.licenseAcquirer),this.adBreakCustomMetadataReporter=new XU.AdBreakCustomMetadataReporter(this.mediaEventController),this.reportIntraTitlePlaylistPlaylistCustomMetadata(this.playlistedPlaybackUrls),this.reportTokenAuthCustomMetadata();if(__HOMEBREW_NOADS){try{__DevSimAdsLog.info("debugSimulatedAds: normalizing public intraTitlePlaylist to be Remote-free")}catch(e){}try{this.intraTitlePlaylist=this.intraTitlePlaylist.filter(freeOnUnref(function(it){return"Main"===it.type}))}catch(e){try{__DevSimAdsLog.warn("debugSimulatedAds: failed to filter intraTitlePlaylist",e)}catch(e2){}}}}return e.prototype.getStorageAccess=freeOnUnref(function(){return null!=this.downloadOperationId?3:0}),e.prototype.createContent=freeOnUnref(function(e,t){var n=this;t.promise.then(freeOnUnref(function(){n.reset()})),this.mainContentView=e,this.licenseAcquirer.initialize(),this.hasPrerollAdBreak="Remote"===this.playlistedPlaybackUrls.intraTitlePlaylist[0].type;var r=new ih.PlaylistedMediaRepresentation;return(this.mediaRepresentation=r).on("downloadComplete",this.reportManifestAcquisitionSuccess),r.on("failure",this.reportManifestAcquisitionFailure),this.adBreakManager=new JU.AdBreakManager(this.playbackResourcesTimestamp,this.playlistedPlaybackUrls,this.playlistEngine,r,this.playlistedSourceCdnStore,this.resourceAcquirer,this.serviceClientFactory,this.mainContentView,this.titleIdView,this.adBreakContextUpdater,this.mpPlayer,this.timeDataManager,this.adEventReporter,this.playlistTrackingEventReporter,this.mediaEventController,this.contentMetadata,this.consumptionIdUpdater,this.adBreakCustomMetadataReporter,this.contentConfig.encodePreferences,this.contentConfig.clientId),this.adAwareSeekInterceptor=new tb.AdAwareSeekInterceptor(this.playlistEngine,this.playlistedPlaybackUrls.intraTitlePlaylist,this.adBreakManager,this.hasPrerollAdBreak),this.seekInterceptorManager.registerAdAwareSeekInterceptor(this.adAwareSeekInterceptor),lt.Promise.resolve().then(freeOnUnref(function(){return n.resolveAndCreatePrerollPeriods(t,r).then(freeOnUnref(function(){return n.createCardAndMainItemPeriods(r)})).then(freeOnUnref(function(){return n.resolveOneMainContentPeriod(r)})).then(freeOnUnref(function(){return n.createContentSource(r,n.playlistedSourceCdnStore,n.suggestedPictureModes)}))})).then(freeOnUnref(function(){return n.createPlaylistItemsFromMediaRepresentation(r)}))}),e.prototype.resolveAndCreatePrerollPeriods=freeOnUnref(function(n,r){var i=this;if(0!==this.contentConfig.position&&void 0!==this.contentConfig.position)return C.info("Content config position is greater than 0. Skipping pre-roll resolution"),lt.Promise.resolve();var o=this.getPreRollPlaylistItem();return null==o?lt.Promise.resolve():(C.info("Playlist contains a pre-roll. Will start pre-roll resolution"),this.getCachedRegolithResponse().then(freeOnUnref(function(e){if(null==e){var t=new GU.RegolithClient("Preroll",o.urlsInPriorityOrder,o.resolutionConstraints.maxRetryCountPerUrl,o.resolutionConstraints.timeoutInMs,i.serviceClientFactory,i.mediaEventController.traceEventController);return i.adBreakCustomMetadataReporter.attachListenersForRegolithMetrics("Preroll",t),t.send(n).then(freeOnUnref(function(e){i.createPreRollFromRegolithResponse(r,e)})).catch(freeOnUnref(function(e){C.error("An error occurred while attempting to resolve Regolith. Skipping pre-roll resolution.",e)}))}return C.info("Pre-roll found in cache. Creating pre-roll from cache."),i.createPreRollFromRegolithResponse(r,e),lt.Promise.resolve()})))}),e.prototype.getCachedRegolithResponse=freeOnUnref(function(){var r=this;return Pt.localStorage.capabilities.isSupported&&null!=this.downloadOperationId?Pt.localStorage.getText(vu.createCachedRegolithResponseKey(this.downloadOperationId,0)).then(freeOnUnref(function(e){if(null==e)return C.warn("LocalStorage: Retrieve Regolith Response invalid (missing or failed fetch when cached metadata exists). downloadOperationId: "+r.downloadOperationId+", Preroll"),q.metrics.putMetric("XpPlayer.Cache.FetchFatalError"),null;var t,n=JSON.parse(e);return null!=(t=n)&&null!=t.playlist&&null!=t.description&&null!=t.description.adDeliverySessionId?n:(C.error("LocalStorage: Retrieve Regolith Response invalid (missing or failed fetch when cached metadata exists). downloadOperationId: "+r.downloadOperationId+", Preroll"),null)})).catch(freeOnUnref(function(e){return C.error("LocalStorage: getText error. downloadOperationId: "+r.downloadOperationId+", Preroll"),q.metrics.putMetric("XpPlayer.Cache.FetchFatalError"),null})):(C.info("LocalStorage: Retrieve cached content skipped, isSupported: "+Pt.localStorage.capabilities.isSupported),lt.Promise.resolve(null))}),e.prototype.createPreRollFromRegolithResponse=freeOnUnref(function(e,t){this.preRollRegolithResponse=t,this.mediaEventController.reportAssetFulfilment(t),this.adBreakCustomMetadataReporter.reportAdBreakMetadata("Preroll",this.preRollRegolithResponse),this.createPreRollPeriods(e)}),e.prototype.createPlaylistItemsFromMediaRepresentation=freeOnUnref(function(e){var t=lt.CancelToken.source(),n=t.token,r=t.cancel,i=[],o=e.periods.contents;C.info("Creating playlist items from Media Representation. Periods: "+o.map(freeOnUnref(function(e){return e.periodType})).join(", ")+".");for(var a,s,l=0,f=null,u=0,c=0,d=0,p=o;d<p.length;d++){var h=p[d],m=M({},this.contentMetadata,{start:h.startMs,end:h.endMs,clientId:this.contentConfig.clientId,contentSource:this.contentSource,downloadOperationId:this.downloadOperationId,mediaRepresentation:e,internalCancelToken:n,internalCancelFunction:r,encodePreferences:this.contentConfig.encodePreferences,playlistedItemId:h.id,sourceUrlStore:h.sourceUrlStore}),y=Jy.PlaylistRelativeView.fromView(this.titleIdView,{playlistedItemId:h.id});if(this.activePlaylistedPlaybackConsumptionIdTracker.appendPlaylistedItem(y,h),"Main"===h.periodType){var g=this.playlistPeriodItemIndexMap[h.id];m.type="Main",m.timelineStart=c,m.timelineEnd=c+h.durationMs,m.timelineUnit=ka.TimeUnit.ContentMillis,c+=h.durationMs,m.hasUnresolvedAdBreakBefore=this.hasRemoteItemBefore(g),this.createAdPreloadMonitorIfTrailedByRemoteItem(g,m)}else if("Card"===h.periodType){g=this.playlistPeriodItemIndexMap[h.id];null==f&&(f=Vy.UUID.v4()),m.type="Aux",m.timelineStart=0,m.timelineEnd=h.durationMs,m.timelineUnit=ka.TimeUnit.ContentMillis,m.breakId=f,m.adInstanceId=Vy.UUID.v4(),m.catalogMetadata=(a=this.intraTitlePlaylist[g],s=void 0,s={showCountdownTimer:!1},null!=a.contentMetadata&&(s.contentSubType=a.contentMetadata.contentSubType,s.adId=a.contentMetadata.reportingContentId),null!=a.skipInfo&&(s.skipOffset=a.skipInfo.buttonShowOffsetMs,s.buttonShowTimeMs=a.skipInfo.buttonShowTimeMs),s),m.videoPreviewAssets=[],m.staticTimedTextStreams=[],m.transitionTimecodes=void 0,m.hasUnresolvedAdBreakBefore=this.hasRemoteItemBefore(g),this.createAdPreloadMonitorIfTrailedByRemoteItem(g,m)}else if("Remote"===h.periodType){var v=this.preRollRegolithResponse.playlist[l],O=QU.RegolithAdPlaylistTransformer.transformAdPlaylistItemToSimplifiedAd(v);null==f&&(f=Vy.UUID.v4()),m.type=O.contentType,m.timelineStart=u,m.timelineEnd=u+h.durationMs,m.timelineUnit=ka.TimeUnit.ContentMillis,m.breakId=f,m.adInstanceId=Vy.UUID.v4(),m.trackingEvents=O.trackingEvents,m.adVideoClickTrackingUris={clickThroughTrackingUris:null!=O.clickThrough?O.clickThrough.clickTrackingUris:void 0,customClicks:O.customClicks},m.catalogMetadata=E(O,m.adInstanceId,0,l,"Pre-Roll",this.preRollRegolithResponse.description.adDeliverySessionId,this.preRollRegolithResponse.description.adMarkerId,v.uiFeatures),m.videoPreviewAssets=[],m.transitionTimecodes=void 0,m.staticTimedTextStreams=[],m.pauseBehavior=void 0;var S=Jy.PlaylistRelativeView.fromView(this.titleIdView,{adInstanceId:m.adInstanceId}),U=new uU.TrackingEventReporter(S,this.mpPlayer,this.timeDataManager,this.adEventReporter);this.playlistTrackingEventReporter.registerAdTrackingEventReporter(m.adInstanceId,U),this.trackingEventReporters.push(U),l++,u+=h.durationMs}i.push(m)}var b=[];if(null!=f){var P=Jy.ItemRelativeView.fromView(this.titleIdView,{breakId:f});this.adBreakContextUpdater.appendAdBreakView(P),b.push({timestamp:0,breakId:f,view:P,vmapTrackingEvents:[]})}return this.adPodInterceptor=new fU.XpAdPlaylistInterceptor(this.playlistEngine,this.titleIdView,this.mainContentView,this.mpPlayer,b),this.adPodInterceptor.initialize(),this.adBreakManager.setAdPodInterceptor(this.adPodInterceptor),this.playlistEngine.registerOnPositionInterceptor(this.adPodInterceptor),this.playlistEngine.registerSeekInterceptor(this.adPodInterceptor),lt.Promise.resolve({playlistItems:i,playlistItemUpdater:void 0})}),e.prototype.createCardAndMainItemPeriods=freeOnUnref(function(e){var t=this,n=this.intraTitlePlaylist.filter(freeOnUnref(function(e){return"Remote"!==e.type})).map(freeOnUnref(function(e){return e.type})).join(", ");C.info("Creating card and main periods. Card and main content items: "+n+".");for(var r=0;r<this.intraTitlePlaylist.length;r++)if("Remote"!==this.intraTitlePlaylist[r].type){for(var i=this.intraTitlePlaylist[r],o=i.endMs-i.startMs,a=!this.hasRemoteItemBefore(r),s=[],l=0,f=i.urls;l<f.length;l++){var u=f[l];s.push({cdn:u.cdn,url:u.url,origin:u.origin,consumptionId:u.consumptionId,assetConsumptionId:u.consumptionId,edgeDeliveryAuthorization:u.edgeDeliveryAuthorization})}var c=this.intraTitlePlaylist.some(freeOnUnref(function(e){return"Remote"===e.type}));c&&C.warn("Forcing out-of-band subtitles by removing in-band subtitles since there are no ads in the content.");var d=this.getStorageAccess(),p=new ih.PlaylistedPeriod(this.intraTitlePlaylist[r].type+"_"+r,o,this.playbackResourcesTimestamp,r===this.intraTitlePlaylist.length-1,s,this.playlistedSourceCdnStore,this.resourceAcquirer,Hf.mapAudioTracks(i.audioTracks),i.type,this.mediaEventController.traceEventController,freeOnUnref(function(e){t.reportAccessTokenAcquisition(e)}),a,c,d,this.downloadOperationId);e.append(p),this.playlistPeriodItemIndexMap[p.id]=r}}),e.prototype.resolveOneMainContentPeriod=freeOnUnref(function(e){if(null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.extensiblePlaylisting&&L.configurationStore.configuration.extensiblePlaylisting.resolveAllManifests)return lt.Promise.all(e.periods.contents.map(freeOnUnref(function(e){return e.resolve()})));var t=x.find(e.periods.contents,freeOnUnref(function(e){return"Main"===e.periodType}));return t?t.resolve():(C.warn("No main period found in the content."),lt.Promise.resolve())}),e.prototype.createPreRollPeriods=freeOnUnref(function(e){var t=this,n=this.preRollRegolithResponse.playlist;if(null!=n){C.info("Pre-roll resolved with "+n.length+" ad(s)");for(var r=this.intraTitlePlaylist.filter(freeOnUnref(function(e){return"Main"===e.type}))[0],i=r.urls[0].consumptionId,o={},a=0,s=r.urls;a<s.length;a++){var l=s[a];o[l.cdn]=l.consumptionId}for(var f=0;f<n.length;f++){for(var u=n[f],c=jr.extendedLimitedIso8601TimeFormatToMilliseconds(u.description.duration),d=[],p=0,h=u.media.urls;p<h.length;p++){var m=h[p],y=Qe.withDefault(o[m.cdn],i),g=m.consumptionId;d.push({url:m.url,cdn:m.cdn,origin:m.origin,consumptionId:y,assetConsumptionId:g,edgeDeliveryAuthorization:m.edgeDeliveryAuthorization})}var v=this.getStorageAccess(),O=new ih.PlaylistedPeriod("Adbreak0_Ad"+f,c,this.playbackResourcesTimestamp,!1,d,this.playlistedSourceCdnStore,this.resourceAcquirer,null,"Remote",this.mediaEventController.traceEventController,freeOnUnref(function(e){t.reportAccessTokenAcquisition(e)}),!0,!1,v,this.downloadOperationId);e.append(O)}}}),e.prototype.getPreRollPlaylistItem=freeOnUnref(function(){return 0===this.intraTitlePlaylist.length||"Remote"!==this.intraTitlePlaylist[0].type?null:this.intraTitlePlaylist[0]}),e.prototype.createContentSource=freeOnUnref(function(e,t,n){var r=this,i=null!=this.cacheStorageType?this.cacheStorageType:"InMemory",o=new vu.CacheFactory(i,this.downloadOperationId),a=x.find(this.intraTitlePlaylist,freeOnUnref(function(e){return"Main"===e.type})).manifestMetadata.videoQuality,s=new Ty.FragmentContentSource(e,freeOnUnref(function(e,t,n){return r.licenseAcquirer.acquireLicense(e,t,n)}),this.prioritizationSystem,this.playerBufferManager,Hf.fromPlaylistedPlaybackUrls(this.playlistedPlaybackUrls),t,e.timeWindow,this.contentMetadata.playbackData.videoMaterialType,this.playbackSettingsProvider,o,this.streamFeature.getCurrentMatchers(),this.videoPreviewFeature.getSeekPreviewRestriction(),this.resolutionCappingStrategy,this.hdcpStore,this.mediaKeysManager,this.downloadOperationId,void 0,a);s.suggestedPictureModes=n,this.contentSource=s,this.initializeContentSource(this.contentSource)}),e.prototype.initializeContentSource=freeOnUnref(function(e){for(var t=this.streamFeature.getCurrentMaxBitrateThresholds(),n=0,r=Object.keys(t);n<r.length;n++){var i=t[l=r[n]];null!=i&&e.setMaxBitrateThreshold(l,"External",i)}for(var o=this.streamFeature.getCurrentUnsupportedCodecs(),a=0,s=Object.keys(o);a<s.length;a++){var l,f=o[l=s[a]];null!=f&&e.setUnsupportedCodecs(l,f)}this.registerFragmentDownloadReporterCallbacks(e),this.registerHdcpComplianceCallbacks(e),e.on("fatalError",this.onContentSourceFatalError),this.frontBufferSetter=new wS.FrontBufferSetter(this.titleIdView,this.mpPlayer,this.contentSource,this.playbackSettingsProvider),this.frontBufferSetter.initialize()}),e.prototype.createAdPreloadMonitorIfTrailedByRemoteItem=freeOnUnref(function(e,t){if(!(this.intraTitlePlaylist.length<=e+1)){var n=this.intraTitlePlaylist[e+1];if("Remote"===n.type){var r=YU.translateToRelativeAdBreakIndex(e+1,this.intraTitlePlaylist);if(-1===r)throw new Error("Can't calculate ad break index");var i=Jy.PlaylistRelativeView.fromView(this.titleIdView,{playlistedItemId:t.playlistedItemId}),o=new eb.AdPreloadMonitor(this.hasPrerollAdBreak,this.mpPlayer,t,r,i,this.adBreakManager,this.mediaEventController,n.resolutionConstraints.maxMsInAdvance);o.initialize(),this.adMonitors.push(o)}}}),e.prototype.hasRemoteItemBefore=freeOnUnref(function(e){return 1<e&&"Remote"===this.intraTitlePlaylist[e-1].type}),e.prototype.registerLicenseAcquisitionReporterCallbacks=freeOnUnref(function(e){e.on("licenseAcquired",this.reportLicenseAcquisitionSuccess),e.on("licenseAcquisitionFailed",this.reportLicenseAcquisitionFailure)}),e.prototype.deregisterLicenseAcquisitionReporterCallbacks=freeOnUnref(function(e){e.off("licenseAcquired",this.reportLicenseAcquisitionSuccess),e.off("licenseAcquisitionFailed",this.reportLicenseAcquisitionFailure)}),e.prototype.registerHdcpComplianceCallbacks=freeOnUnref(function(e){e.on("streamRestartNeeded",this.onStreamRestartNeeded)}),e.prototype.deregisterHdcpComplianceCallbacks=freeOnUnref(function(e){e.off("streamRestartNeeded",this.onStreamRestartNeeded)}),e.prototype.registerFragmentDownloadReporterCallbacks=freeOnUnref(function(e){e.on("fragmentDownloaded",this.reportFragmentDownloadSuccess),e.on("fragmentDownloadFailed",this.reportFragmentDownloadFailure)}),e.prototype.deregisterFragmentDownloadReporterCallbacks=freeOnUnref(function(e){e.off("fragmentDownloaded",this.reportFragmentDownloadSuccess),e.off("fragmentDownloadFailed",this.reportFragmentDownloadFailure)}),e.prototype.getFirstItemConsumptionId=freeOnUnref(function(){return this.intraTitlePlaylist.filter(freeOnUnref(function(e){return"Main"===e.type||"Card"===e.type}))[0].urls[0].consumptionId}),e.prototype.reset=freeOnUnref(function(){this.deregisterLicenseAcquisitionReporterCallbacks(this.licenseAcquirer),this.activePlaylistedPlaybackConsumptionIdTracker.terminate(),null!=this.mediaRepresentation&&(this.mediaRepresentation.off("downloadComplete",this.reportManifestAcquisitionSuccess),this.mediaRepresentation.off("failure",this.reportManifestAcquisitionFailure),this.mediaRepresentation=null),null!=this.contentSource&&(this.deregisterHdcpComplianceCallbacks(this.contentSource),this.deregisterFragmentDownloadReporterCallbacks(this.contentSource)),null!=this.frontBufferSetter&&this.frontBufferSetter.terminate(),this.trackingEventReporters.forEach(freeOnUnref(function(e){return e.destroy()})),this.trackingEventReporters=[],this.adBreakContextUpdater.destroy(),null!=this.adPodInterceptor&&(this.playlistEngine.deregisterOnPositionInterceptor(this.adPodInterceptor),this.playlistEngine.deregisterSeekInterceptor(this.adPodInterceptor),this.adPodInterceptor.terminate(),this.adPodInterceptor=void 0),this.adMonitors.forEach(freeOnUnref(function(e){return e.terminate()})),this.adMonitors=[],this.seekInterceptorManager.deregisterAdAwareSeekInterceptor(),null!=this.adBreakManager&&this.adBreakManager.terminate()}),e.prototype.reportIntraTitlePlaylistPlaylistCustomMetadata=freeOnUnref(function(e){var t={},n=e.intraTitlePlaylist,r=n.length,i=0<r&&"Remote"===n[0].type,o=n.filter(freeOnUnref(function(e){return"Remote"===e.type})).length,a=n.filter(freeOnUnref(function(e){return"Card"===e.type})).length;t.PlayedByEXPL="true",t.PauseAdsVended=null!=this.contentMetadata.pauseBehavior?"true":"false",t.PlaylistTotalItemCount=r.toString(),t.PlaylistHasPreRoll=i.toString(),t.PlaylistRemoteItemCount=o.toString(),t.PlaylistCardCount=a.toString(),this.mediaEventController.reportCustomMetadata(t)}),e.prototype.reportTokenAuthCustomMetadata=freeOnUnref(function(){for(var e=0,t=this.intraTitlePlaylist;e<t.length;e++){var n=t[e];if("Remote"!==n.type)for(var r=0,i=n.urls;r<i.length;r++){if(null!=i[r].edgeDeliveryAuthorization)return void this.mediaEventController.reportCustomMetadata({TokenAuthEnabled:"true"})}}this.mediaEventController.reportCustomMetadata({TokenAuthEnabled:"false"})}),e})();t.PlaylistedPlaybackUrlsPlaylistSourceHandler=n}));e(rb);rb.createAdMetadata,rb.PlaylistedPlaybackUrlsPlaylistSourceHandler;var ib=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("SyeLiveAdPlaylistSource"),n=freeOnUnref(function(){function e(e,t,n,r){var o=this;this.xmlParser=new bp.Parser,this.onNotificationMessage=freeOnUnref(function(e){var t=e.messageType;switch(a.info("SyeLiveAdPlaylistSource#onNotificationMessage Sye payload: \n "+JSON.stringify(e)),t){case"adMetadata":o.handleAdMetadataNotification(e);break;case"adStart":o.handleAdStartNotification(e);break;case"adEnd":o.handleAdEndNotification(e);break;case"flushMetadata":o.handleFlushMetadataNotificationWithMessage(e);break;case"InsightsReport":o.handleInsightsReportNotification(e)}}),this.handleInsightsReportNotification=freeOnUnref(function(t){var e=null;try{e=JSON.parse(t.data)}catch(e){return void a.error("Failed to handle notification with messageType "+t.messageType+", error: ",e)}var n=t.adjustedMessageTimeMs;null!=n?o.mediaEventController.reportSyeContentMediaEvent(e,n):a.error("Attempt to report Sye Content event with undefined timestamp")}),this.handleAdMetadataNotification=freeOnUnref(function(t){var e,n;try{e=JSON.parse(t.data),n=JSON.parse(e.payload)}catch(e){return void a.error("Failed to handle notification with messageType "+t.messageType+", error: ",e)}var r=[];n.metadata.extensions.forEach(freeOnUnref(function(t){try{var e=o.xmlParser.parse(new bp.ElementNodeHandler("ActionableAd"),t.content);null!=e?r.push(e):a.error("Failed to parse SYE extension of "+t.content)}catch(e){a.error("Failed to parse SYE extension of type "+t.type+", error: ",e)}}));var i={adId:e.id,extensions:r,trackingURL:n.tracker};o.adsTimelineManager.updateAdData(i)}),this.onPlaybackStateChangeCallback=freeOnUnref(function(e){"paused"===e.playbackState&&o.adsTimelineManager.reset()}),this.handleAdStartNotification=freeOnUnref(function(t){var e;try{e=JSON.parse(t.data)}catch(e){return void a.error("Failed to handle notification with messageType "+t.messageType)}if(null!=t.adjustedMessageTimeMs){var n=t.adjustedMessageTimeMs,r={adId:e.id,timeInfo:{startMs:n,endMs:n+e.duration}};o.adsTimelineManager.updateAdData(r)}}),this.handleAdEndNotification=freeOnUnref(function(e){null!=e.adjustedMessageTimeMs&&o.adsTimelineManager.updateAdEndTime(e.adjustedMessageTimeMs)}),this.handleFlushMetadataNotificationWithMessage=freeOnUnref(function(e){var t=null;try{t=JSON.parse(e.data)}catch(e){a.error("Failed to parse flush notification message, defaulting to generic flush")}o.adsTimelineManager.flushLiveAds(null!=t&&null!=t.idsToKeep?t.idsToKeep:[])}),this.contentSource=e,this.adsTimelineManager=t,this.mpPlayer=n,this.mediaEventController=r}return e.prototype.initialize=freeOnUnref(function(){this.contentSource.on("notificationReceived",this.onNotificationMessage),this.mpPlayer.on("playbackStateChange",this.onPlaybackStateChangeCallback)}),e.prototype.uninitialize=freeOnUnref(function(){this.contentSource.off("notificationReceived",this.onNotificationMessage),this.mpPlayer.off("playbackStateChange",this.onPlaybackStateChangeCallback),this.adsTimelineManager.reset()}),e})();t.SyeLiveAdPlaylistSource=n}));e(ib);ib.SyeLiveAdPlaylistSource;var ob=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("SyeLiveEventPlaylistUpdater"),n=freeOnUnref(function(){function e(e,t,n,r,i){var o=this;this.updateIntervalId=null,this.previousStartMs=null,this.previousEndMs=null,this.onLiveAdsUpdate=freeOnUnref(function(e){o.shouldUpdateAdExtensionData=!0,e&&(a.info("onLiveAdsUpdate adEnd received, sending timeline updates."),o.triggerTimelineUpdate())}),this.onTimeWindowAvailable=freeOnUnref(function(){o.contentSource.availabilityTimeWindow.offAvailable(o.onTimeWindowAvailable);var e=o.mainContentView.getItems()[0],t=o.calculateTimeline();o.updatePlaylistTimeline(e.start,t.startTimeMs,t.endTimeMs),o.hasLiveScheduleEntries()||null==o.eventTimelineMetadata.durationMs||o.startUpdater(t)}),this.mainContentView=e,this.contentSource=t,this.eventTimelineMetadata=n,this.liveSchedule=i,this.playlistRelativeTimeWindow=t.availabilityTimeWindow,this.liveAdTimelineManager=r,this.shouldUpdateAdExtensionData=!1}return e.prototype.start=freeOnUnref(function(){this.hasLiveScheduleEntries()||(this.contentSource.availabilityTimeWindow.onAvailable(this.onTimeWindowAvailable),this.liveAdTimelineManager.onUpdate(this.onLiveAdsUpdate))}),e.prototype.stop=freeOnUnref(function(){this.contentSource.availabilityTimeWindow.offAvailable(this.onTimeWindowAvailable),null!==this.updateIntervalId&&(oe.timer.clearInterval(this.updateIntervalId),this.updateIntervalId=null),this.liveAdTimelineManager.offUpdate(this.onLiveAdsUpdate)}),e.prototype.triggerTimelineUpdate=freeOnUnref(function(){if(null!=this.previousStartMs&&null!=this.previousEndMs){var e=this.calculateTimeline();(e.startTimeMs!==this.previousStartMs||e.endTimeMs!==this.previousEndMs||this.shouldUpdateAdExtensionData)&&this.updatePlaylistTimeline(this.previousStartMs,e.startTimeMs,e.endTimeMs),this.previousStartMs=e.startTimeMs,this.previousEndMs=e.endTimeMs}else a.info("triggerTimelineUpdate adEnd event called before the timer can run.")}),e.prototype.startUpdater=freeOnUnref(function(e){var t=this;null!==this.updateIntervalId&&oe.timer.clearInterval(this.updateIntervalId),this.previousStartMs=e.startTimeMs,this.previousEndMs=e.endTimeMs,this.updateIntervalId=oe.timer.setInterval(freeOnUnref(function(){return t.triggerTimelineUpdate()}),2e3)}),e.prototype.updatePlaylistTimeline=freeOnUnref(function(t,e,n){a.info("updatePlaylistTimeline (["+t+", "+e+", "+n+"]):");try{this.mainContentView.update(t,1/0,{start:e,end:1/0,timelineStart:e,timelineEnd:n,liveAds:this.liveAdTimelineManager.getAllAdData()}),this.shouldUpdateAdExtensionData=!1}catch(e){a.error("Live Event playlist update failed (["+t+", Infinity]):",e)}}),e.prototype.calculateTimeline=freeOnUnref(function(){var e=0,t=1/0;return this.hasLiveScheduleEntries()||null==this.eventTimelineMetadata.durationMs||(e=null!=this.eventTimelineMetadata.startTimeMs?Math.min(this.eventTimelineMetadata.startTimeMs,this.playlistRelativeTimeWindow.endMs):this.playlistRelativeTimeWindow.startMs,t=Math.max(e+this.eventTimelineMetadata.durationMs,this.playlistRelativeTimeWindow.endMs+2e3+1e3)),{startTimeMs:e,endTimeMs:t}}),e.prototype.hasLiveScheduleEntries=freeOnUnref(function(){return null!=this.liveSchedule&&0<this.liveSchedule.scheduled.length}),e})();t.SyeLiveEventPlaylistUpdater=n}));e(ob);ob.SyeLiveEventPlaylistUpdater;var ab=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("SingleCdnSyeUrlStore"),r=freeOnUnref(function(){function e(e,t,n,r){this.attemptCount=0,this.syeCdn=e,this.mediaEventController=t,this.activePlaybackConsumptionIdTracker=n,this.playbackStartedTracker=r,this.currentCdn=e.cdnName,this.currentConsumptionId=e.urlSetId}return e.prototype.get=freeOnUnref(function(){return this.toSourceUrl(this.syeCdn)}),e.prototype.onFrontendInfoUpdate=freeOnUnref(function(e){null!=e.consumptionId&&e.consumptionId!==this.currentConsumptionId&&(this.activePlaybackConsumptionIdTracker.updateConsumptionId(e.consumptionId),null!=e.cdn&&e.cdn!==this.currentCdn&&(n.info("Sye CDN switch from "+this.currentCdn+" to "+e.cdn),q.metrics.putMetric("Sye.BackendCdnSwitch."+this.currentCdn.toLowerCase()+", 1"),this.reportFailover(e.consumptionId),this.currentCdn=e.cdn),this.currentConsumptionId=e.consumptionId)}),e.prototype.onError=freeOnUnref(function(){return this.playbackStartedTracker.playbackNotStarted()?(this.attemptCount++,n.info("Sye retry attempt count: "+this.attemptCount),3<this.attemptCount?nf.SyeUrlStoreErrorHandlerResult.Terminate:nf.SyeUrlStoreErrorHandlerResult.Resume):nf.SyeUrlStoreErrorHandlerResult.Resume}),e.prototype.toSourceUrl=freeOnUnref(function(e){return{url:e.frontendUrl,urlId:e.urlSetId,headers:{},cdn:e.cdnName,token:e.token,channelId:e.channelId,isFirstCdn:!0,getAccessToken:freeOnUnref(function(){return{type:"NoToken"}})}}),e.prototype.reportFailover=freeOnUnref(function(e){this.mediaEventController.reportFailover({ruleId:"default",fromConsumptionId:this.currentConsumptionId,toConsumptionId:e})}),e})();t.SingleCdnSyeUrlStore=r}));e(ab);ab.SingleCdnSyeUrlStore;var sb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("MultiCdnSyeUrlStore"),r=freeOnUnref(function(){function e(e,t,n,r){this.syeUrls=e,this.mediaEventController=t,this.activePlaybackConsumptionIdTracker=n,this.playbackStartedTracker=r,this.currentUrlIndex=0}return e.prototype.get=freeOnUnref(function(){var e=this.syeUrls.listOfCdns[this.currentUrlIndex];return this.toSourceUrl(e,this.currentUrlIndex)}),e.prototype.onFrontendInfoUpdate=freeOnUnref(function(e){}),e.prototype.onError=freeOnUnref(function(){if(this.playbackStartedTracker.playbackNotStarted()&&this.currentUrlIndex+1===this.syeUrls.listOfCdns.length)return nf.SyeUrlStoreErrorHandlerResult.Terminate;var e=this.get();this.currentUrlIndex=(this.currentUrlIndex+1)%this.syeUrls.listOfCdns.length;var t=this.get();return n.info("Sye frontend url switch from "+e.cdn+": "+e.url+" to "+t.cdn+": "+t.url),this.activePlaybackConsumptionIdTracker.updateConsumptionId(t.urlId),this.mediaEventController.reportFailover({ruleId:"default",fromConsumptionId:e.urlId,toConsumptionId:t.urlId}),nf.SyeUrlStoreErrorHandlerResult.Restart}),e.prototype.toSourceUrl=freeOnUnref(function(e,t){return{url:e.frontendUrl,urlId:e.urlSetId,headers:{},cdn:e.cdnName,token:e.token,channelId:e.channelId,isFirstCdn:0===t,getAccessToken:freeOnUnref(function(){return{type:"NoToken"}})}}),e})();t.MultiCdnSyeUrlStore=r}));e(sb);sb.MultiCdnSyeUrlStore;var lb=t(freeOnUnref(function(e,t){var a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("SyeUrlsPlaylistSourceHandler"),n=freeOnUnref(function(){function u(e,t,n,r,i,o,a,s,l,f,u,c){var d=this;this.contentSource=null,this.syeLiveAdPlaylistSource=null,this.timeWindowEnforcingSeekInterceptor=null,this.onNonFatalError=freeOnUnref(function(e){d.mediaEventController.reportError(!1,e,"Player","Error")}),this.syeUrls=i,this.vcid=o,this.contentConfig=e,this.contentMetadata=t,this.mediaEventController=n,this.initialPlaybackPositionTracker=a,this.playbackStartedTracker=s,this.playlistEngine=l,this.suggestedPictureModes=c,this.mpPlayer=f,this.activePlaybackConsumptionIdTracker=new bS.ActivePlaybackConsumptionIdTracker(r,u,this.syeUrls.listOfCdns[0].urlSetId),this.activePlaybackConsumptionIdTracker.initialize(),1===this.syeUrls.listOfCdns.length?this.syeUrlsSourceUrlStore=new ab.SingleCdnSyeUrlStore(i.listOfCdns[0],n,this.activePlaybackConsumptionIdTracker,this.playbackStartedTracker):this.syeUrlsSourceUrlStore=new sb.MultiCdnSyeUrlStore(i,n,this.activePlaybackConsumptionIdTracker,this.playbackStartedTracker)}return u.prototype.shutdownContent=freeOnUnref(function(){null!=this.contentSource&&(this.contentSource.off("nonFatalError",this.onNonFatalError),this.contentSource=null),null!=this.syeLiveAdPlaylistSource&&this.syeLiveAdPlaylistSource.uninitialize(),null!=this.timeWindowEnforcingSeekInterceptor&&(this.playlistEngine.deregisterSeekInterceptor(this.timeWindowEnforcingSeekInterceptor),this.timeWindowEnforcingSeekInterceptor=null),this.activePlaybackConsumptionIdTracker.terminate()}),u.prototype.createContent=freeOnUnref(function(s,l){var f=this;return l.promise.then(freeOnUnref(function(){f.shutdownContent()})),lt.Promise.resolve().then(freeOnUnref(function(){l.throwIfRequested();var e=f.syeUrlsSourceUrlStore.get().urlId;f.activePlaybackConsumptionIdTracker.updateConsumptionId(e),f.contentSource=new nf.LiveLowLatencyContentSource(f.syeUrlsSourceUrlStore,f.vcid,f.suggestedPictureModes),f.contentSource.on("nonFatalError",f.onNonFatalError);var t=null!=f.syeUrls.maxBitrateBps&&0<f.syeUrls.maxBitrateBps?f.syeUrls.maxBitrateBps:1/0;f.contentSource.setMaxBitrateThreshold("Video","ExternalNetwork",t);var n=null!=f.syeUrls.startTime?new Date(f.syeUrls.startTime).getTime():0,r=f.createStartTimeConstrainedTimeWindow(n),i=new kS.ConstrainedLookbackTimeWindow(r,f.initialPlaybackPositionTracker,f.contentMetadata.playbackData.liveLookbackPolicy);f.timeWindowEnforcingSeekInterceptor=new IS.TimeWindowEnforcingSeekInterceptor(i,f.playlistEngine,s),f.playlistEngine.registerSeekInterceptor(f.timeWindowEnforcingSeekInterceptor);var o=new VS.LiveAdTimelineManager(f.mpPlayer),a=new ob.SyeLiveEventPlaylistUpdater(s,f.contentSource,u.createLiveEventTimelineMetadata(f.syeUrls),o,f.contentMetadata.liveSchedule);return a.start(),f.syeLiveAdPlaylistSource=new ib.SyeLiveAdPlaylistSource(f.contentSource,o,f.mpPlayer,f.mediaEventController),f.syeLiveAdPlaylistSource.initialize(),f.initialPlaybackPositionTracker.updateContentTimeWindow(f.contentSource.availabilityTimeWindow),{playlistItems:[f.createPlaylistItem(n,i)],playlistItemUpdater:a}}))}),u.prototype.createStartTimeConstrainedTimeWindow=freeOnUnref(function(e){var t="Unrestricted"===this.contentMetadata.playbackData.liveLookbackPolicy.liveLookbackControl;0===e&&(t?r.warn("PRS did not return a startTime for an lookback-unrestricted Sye stream. Seeking will be disabled. This is probably a stream setup error."):r.warn("PRS did not return a startTime for Sye. Seeking may result in unwanted behavior. This is probably a stream setup error."));var n=this.contentSource;return{get startMs(){return 0===e&&t?n.availabilityTimeWindow.endMs:Math.max(n.availabilityTimeWindow.startMs,e)},get endMs(){return n.availabilityTimeWindow.endMs},isUpdating:freeOnUnref(function(){return n.availabilityTimeWindow.isUpdating()})}}),u.prototype.createPlaylistItem=freeOnUnref(function(e,t){var n=lt.CancelToken.source(),r=n.token,i=n.cancel,o=a({},this.contentMetadata,{clientId:this.contentConfig.clientId,contentSource:this.contentSource,encodePreferences:this.contentConfig.encodePreferences,type:"Main",start:0,end:null,timelineStart:0,timelineEnd:null,timelineUnit:ka.TimeUnit.EpochMillis,playlistRelativeConstrainedTimeWindow:t,sourceUrlStore:this.syeUrlsSourceUrlStore,internalCancelToken:r,internalCancelFunction:i,multiviewMetadata:this.syeUrls.multiviewMetadata});return 0!==e&&this.contentSource.seekPreview.setCachingInfo(e,t,this.syeUrls.duration),o}),u.createLiveEventTimelineMetadata=freeOnUnref(function(e){var t={};return null!=e.startTime&&(t.startTimeMs=new Date(e.startTime).getTime(),isNaN(t.startTimeMs)&&r.error("Invalid startTime: '"+e.startTime+"'")),null!=e.duration&&(t.durationMs=1e3*e.duration),t}),u})();t.SyeUrlsPlaylistSourceHandler=n}));e(lb);lb.SyeUrlsPlaylistSourceHandler;var fb=t(freeOnUnref(function(e,t){var F=ce&&ce.__assign||freeOnUnref(function(){return(F=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var B=de.get("PlaylistSource"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v,O,S,U,b,P,M,C,E,T,w,I,k,_,R,A){var D=this;if(this.playlistItemUpdater=void 0,this.createContentSourcePromise=null,this.initContentToken=null,this.handleSyeFailover=freeOnUnref(function(t,f,e){if(wv.SYE_FALLBACK_ERROR_CODES.some(freeOnUnref(function(e){return-1===t.code.indexOf(e)})))return lt.Promise.reject(t);var n=L.configurationStore.configuration,r=null==n||null==n.liveLowLatency||!1!==n.liveLowLatency.enableMidstreamFallback;if(e.hasPlaybackStarted&&!r)return lt.Promise.reject(t);var i=D.playlistSourceContext.playbackUrlsSourceContext;if(null==i){var o=new Error("Failed to fallback from Sye to DASH: No playback URL!");return B.error(o),D.mediaEventController.reportError(!0,o,"Player","Unknown"),lt.Promise.reject(o)}return D.playlistSourceHandler.shutdownContent(),lt.Promise.resolve().then(freeOnUnref(function(){return f.throwIfRequested(),D.playlistSourceHandler=new YS.PlaybackUrlsPlaylistSourceHandler(D.getStreamingTechnology(i.playbackUrls),D.playbackResourcesTimestamp,D.adEventReporter,i,D.mpPlayer,D.playlistEngine,D.titleIdView,D.contentConfig,D.contentMetadata,D.playbackSettingsProvider,D.prioritizationSystem,D.playerBufferManager,D.streamFeature,D.initialPlaybackPositionTracker,D.videoPreviewFeature,D.hdcpStore,D.mediaEventController,D.consumptionIdUpdater,D.globalStreamControl,D.optOutAdTracking,D.resolutionCappingStrategy,D.onOriginFailover,D.sonarEventAdapter,D.mediaKeysManager,D.advertisingId,D.suggestedPictureModes,void 0,void 0,D.mediaPlayerConfig),D.createPlaylistItemContext(!0,f).then(freeOnUnref(function(e){var t=e.playlistItems,n=e.playlistItemUpdater;f.throwIfRequested();var r=t[0];D.initializePlaylistItem(r);var i=Jy.PlaylistRelativeView.fromView(D.titleIdView,{type:D.mainContentType}),o=D.playlistEngine.getCurrentItem(),a=null==o?0:o.start,s=null==o?1/0:null!=o.end?o.end:1/0;if(i.update(a,s,r),B.info("Playlist after DASH fallback:\n"+JS.formatPlaylist(D.playlistEngine)),D.mediaEventController.updateMediaRepresentation(r.mediaRepresentation),null!=r.contentSource?(D.mediaEventController.setContentSource(r.contentSource),D.sonarEventAdapter.setContentSource(r.contentSource)):B.warn("Failed over without a new ContentSource"),null==r.sourceUrlStore)B.warn("Failed over without a new SourceUrlStore");else{var l=r.sourceUrlStore.get().urlId;D.mediaEventController.updateConsumptionId(l),D.mediaEventController.reportFeatureFlag("SyeFallback","Enabled"),D.sonarEventAdapter.updateConsumptionId(l)}D.setPlaylistItemUpdater(n,f)})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;throw B.error("Failed to execute update playlist during Sye->Fragment failover: "+e),e}))}))}),this.deferredInitializeContentCallback=freeOnUnref(function(){var e;return null!==D.createContentSourcePromise||(D.createContentSourcePromise=(e=D.createPlaylistItemContext(!0,D.initContentToken).then(freeOnUnref(function(e){var t=e.playlistItems,n=e.playlistItemUpdater;D.initContentToken.throwIfRequested();var r=t[0],i=Jy.PlaylistRelativeView.fromView(D.titleIdView,{type:D.mainContentType});D.initializePlaylistItem(r),i.update(0,1/0,F({},r,{initializeContentCallback:void 0})),B.info("Playlist after resolving deferred live item:\n"+JS.formatPlaylist(D.mainContentView.playlistEngine)),D.setPlaylistItemUpdater(n,D.initContentToken)})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;throw B.error(e),D.mediaEventController.reportError(!1,e,"Player","Unknown"),e}))).then.apply(e,lt.FINALLY(freeOnUnref(function(){D.createContentSourcePromise=null})))),D.createContentSourcePromise}),this.onOriginFailover=freeOnUnref(function(e){var t=Jy.PlaylistRelativeView.fromView(D.titleIdView,{}),n=t.getItems(),r=n[0].start,i=Qe.withDefault(n[n.length-1].end,1/0);t.update(r,i,F({},e)),D.sonarEventAdapter.reportOriginFailover()}),this.adEventReporter=r,this.advertisingId=k,this.contentConfig=i,this.contentMetadata=o,this.globalStreamControl=a,this.hdcpStore=s,this.mediaKeysManager=C,this.mediaEventController=l,this.consumptionIdUpdater=f,this.mpPlayer=u,this.optOutAdTracking=b,this.playbackSettingsProvider=c,this.playlistEngine=d,this.playlistSourceContext=p,this.prioritizationSystem=h,this.playerBufferManager=m,this.resolutionCappingStrategy=y,this.streamFeature=g,this.suggestedPictureModes=_,this.titleIdView=v,this.initialPlaybackPositionTracker=O,this.vcid=U,this.videoPreviewFeature=S,this.mainContentType=e,this.playbackStartedTracker=P,this.sonarEventAdapter=M,this.playbackResourcesTimestamp=t,this.mainContentView=Jy.PlaylistRelativeView.fromView(this.titleIdView,{type:this.mainContentType}),this.downloadOperationId=R,this.mediaPlayerConfig=A,fl.liveLowLatencyContext.isLiveLowLatencySupported()&&null!=p.syeUrlsSourceContext)this.playlistSourceHandler=new lb.SyeUrlsPlaylistSourceHandler(this.contentConfig,this.contentMetadata,this.mediaEventController,this.consumptionIdUpdater,p.syeUrlsSourceContext.syeUrls,this.vcid,this.initialPlaybackPositionTracker,this.playbackStartedTracker,this.playlistEngine,this.mpPlayer,this.titleIdView,this.suggestedPictureModes);else if(null!=p.playlistedPlaylistSourceContext&&null!=p.playlistedPlaylistSourceContext.playlistedPlaybackUrls)this.playlistSourceHandler=new rb.PlaylistedPlaybackUrlsPlaylistSourceHandler(this.contentConfig,this.playbackResourcesTimestamp,n,this.playlistEngine,p.playlistedPlaylistSourceContext,this.contentMetadata,this.playbackSettingsProvider,this.prioritizationSystem,this.playerBufferManager,this.streamFeature,this.videoPreviewFeature,this.hdcpStore,this.resolutionCappingStrategy,this.mediaKeysManager,this.mediaEventController,this.titleIdView,this.globalStreamControl,this.sonarEventAdapter,this.mpPlayer,this.consumptionIdUpdater,T,this.adEventReporter,E,w,this.downloadOperationId,void 0,this.suggestedPictureModes);else{if(null==p.playbackUrlsSourceContext){var x=new Error("No Sye, HLS, or DASH playback URL available!");throw B.error(x),this.mediaEventController.reportError(!0,x,"Player","Unknown"),x}this.playlistSourceHandler=new YS.PlaybackUrlsPlaylistSourceHandler(this.getStreamingTechnology(p.playbackUrlsSourceContext.playbackUrls),this.playbackResourcesTimestamp,this.adEventReporter,p.playbackUrlsSourceContext,this.mpPlayer,this.playlistEngine,this.titleIdView,this.contentConfig,this.contentMetadata,this.playbackSettingsProvider,this.prioritizationSystem,this.playerBufferManager,this.streamFeature,this.initialPlaybackPositionTracker,this.videoPreviewFeature,this.hdcpStore,this.mediaEventController,this.consumptionIdUpdater,this.globalStreamControl,this.optOutAdTracking,this.resolutionCappingStrategy,this.onOriginFailover,this.sonarEventAdapter,this.mediaKeysManager,this.advertisingId,this.suggestedPictureModes,I,this.downloadOperationId,this.mediaPlayerConfig)}}return e.prototype.initializeContent=freeOnUnref(function(a,e){var s=this;return void 0===e&&(e=!0),this.initContentToken=a,this.createPlaylistItemContext(e,a).then(freeOnUnref(function(e){var t=e.playlistItems,n=e.playlistItemUpdater;a.throwIfRequested();for(var r=0,i=t;r<i.length;r++){var o=i[r];s.titleIdView.appendItem(o)}return B.info("Playlist after inserting initial items:\n"+JS.formatPlaylist(s.mainContentView.playlistEngine)),s.setPlaylistItemUpdater(n,a),s.mainContentView})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;throw B.error(e),s.mediaEventController.reportError(!1,e,"Player","Unknown"),e}))}),e.prototype.createPlaylistItemContext=freeOnUnref(function(e,r){var i=this;return!1===e?lt.Promise.resolve().then(freeOnUnref(function(){return r.throwIfRequested(),{playlistItems:[F({},i.contentMetadata,{clientId:i.contentConfig.clientId,encodePreferences:i.contentConfig.encodePreferences,type:i.mainContentType,start:0,end:1/0,timelineStart:0,timelineEnd:1/0,initializeContentCallback:i.deferredInitializeContentCallback})]}})):this.playlistSourceHandler.createContent(this.mainContentView,r).then(freeOnUnref(function(e){var t=e.playlistItems,n=e.playlistItemUpdater;return r.throwIfRequested(),i.initializePlaylistItem(t[0]),{playlistItems:t,playlistItemUpdater:n}}))}),e.prototype.setPlaylistItemUpdater=freeOnUnref(function(e,t){null!=e&&((this.playlistItemUpdater=e).start(),t.promise.then(freeOnUnref(function(){e.stop()})))}),e.prototype.initializePlaylistItem=freeOnUnref(function(e){var t=this;e.playbackErrorHandler={handleError:this.handleSyeFailover},e.destroy=freeOnUnref(function(){null!=e.internalCancelFunction&&e.internalCancelFunction(),null!=t.playlistItemUpdater&&t.playlistItemUpdater.stop()})}),e.prototype.getStreamingTechnology=freeOnUnref(function(e){return e.urlSets[e.defaultUrlSetId].urls.manifest.streamingTechnology}),e})();t.PlaylistSource=n}));e(fb);fb.PlaylistSource;var ub=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.transform=freeOnUnref(function(e,t){if(null!=e)return{outroCreditsStart:e.outroCreditsStart,autoPlayTimer:e.autoPlayTimer,autoplaySettings:t,skipElements:e.skipElements,matureContentElements:e.matureContentElements}}),e})();t.TransitionTimecodesTransformer=n}));e(ub);ub.TransitionTimecodesTransformer;var cb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("TrickplayUrlTransformer"),n=freeOnUnref(function(){function e(){}return e.toVideoPreviewAssets=freeOnUnref(function(e){if(null==e)return[];for(var r=[],t=0,n=e.trickplayUrlsCdnSets;t<n.length;t++)for(var i=n[t],o=freeOnUnref(function(e){var t;if("480"===e.resolution)t="Low";else{if("720"!==e.resolution)return l.warn("Received unknown resolution "+e.resolution+", ignoring."),"continue";t="Medium"}var n=x.find(r,freeOnUnref(function(e){return e.quality===t}));null==n?(n={urls:[e.url],quality:t,format:"BIF"},r.push(n)):n.urls.push(e.url)}),a=0,s=i.trickplayUrlInfoList;a<s.length;a++){o(s[a])}return r}),e})();t.TrickplayUrlTransformer=n}));e(cb);cb.TrickplayUrlTransformer;var db=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("InitialPlaybackPositionTracker"),n=freeOnUnref(function(){function e(e,t){var n=this;this.contentTimeWindow=null,this.initialPlayPositionMs=null,this.initialLiveHeadPosition=null,this.onPlaylistEngineSeek=freeOnUnref(function(e){n.titleIdView.isActive()&&null==n.initialPlayPositionMs&&(n.initialPlayPositionMs=e,null==n.contentTimeWindow?r.warn("Content time window not known at the beginning of the playback. This should not be possible. It is mostly likely a bug."):n.initialLiveHeadPosition=n.contentTimeWindow.endMs,n.playlistEngine.off("Seek",n.onPlaylistEngineSeek))}),this.titleIdView=e,this.playlistEngine=t}return e.prototype.initialize=freeOnUnref(function(){this.playlistEngine.on("Seek",this.onPlaylistEngineSeek)}),e.prototype.terminate=freeOnUnref(function(){this.playlistEngine.off("Seek",this.onPlaylistEngineSeek)}),e.prototype.getInitialPlayPositionMs=freeOnUnref(function(){return this.initialPlayPositionMs}),e.prototype.getInitialLiveHeadPositionMs=freeOnUnref(function(){return this.initialLiveHeadPosition}),e.prototype.updateContentTimeWindow=freeOnUnref(function(e){this.contentTimeWindow=e}),e})();t.InitialPlaybackPositionTracker=n}));e(db);db.InitialPlaybackPositionTracker;var pb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var R=de.get("PRSResponseHandler"),n={catalog:{}};function r(e){var t=Hf.PlaybackResourceUtils.valueOrUndefined(e.playbackUrls);if(null==t){var n=Hf.PlaybackResourceUtils.valueOrUndefined(e.playlistedPlaybackUrls);if(null!=n)return null!=n.pauseAdsResolution&&null!=n.pauseAdsResolution.pauseAdsResolutionUrl?{adRequestUrl:n.pauseAdsResolution.pauseAdsResolutionUrl}:void 0}else if(null!=t.cuepoints&&null!=t.cuepoints.pauseBehavior)try{return JSON.parse(Lr.decodeString(t.cuepoints.pauseBehavior))}catch(e){return void R.error("failed to decode and parse pauseBehavior",e)}}function A(e,t,n){return{playbackData:{contentId:t.playbackData.contentId,liveLookbackPolicy:t.playbackData.liveLookbackPolicy,videoMaterialType:t.playbackData.videoMaterialType,timeShiftPolicy:t.playbackData.timeShiftPolicy},catalogMetadata:f(t.catalogMetadata),auditPings:Hf.PlaybackResourceUtils.valueOrUndefined(t.auditPings),staticTimedTextStreams:Ef.SubtitleUrlTransformer.toTimedTextStreams(e,Hf.PlaybackResourceUtils.valueOrUndefined(t.subtitleUrls),Hf.PlaybackResourceUtils.valueOrUndefined(t.forcedNarratives)),videoPreviewAssets:cb.TrickplayUrlTransformer.toVideoPreviewAssets(Hf.PlaybackResourceUtils.valueOrUndefined(t.trickplayUrls)),transitionTimecodes:ub.TransitionTimecodesTransformer.transform(Hf.PlaybackResourceUtils.valueOrUndefined(t.transitionTimecodes),n),xrayMetadata:Hf.PlaybackResourceUtils.valueOrUndefined(t.xrayMetadata),liveSchedule:Hf.PlaybackResourceUtils.valueOrUndefined(t.liveSchedule),pauseBehavior:r(t)}}function f(e){var t=Hf.PlaybackResourceUtils.valueOrUndefined(e);return null==t?n:t}t.getPauseBehaviorFromPRSResponse=r,t.getContentMetadataFromPRSResponse=A;var i=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v,O,S,U,b,P){this.adEventReporter=e,this.prsManager=t,this.serviceClientFactory=n,this.advertisingId=b,this.downloadOperationId=P,this.playlistEngine=r,this.playlistAutoplayBarrier=i,this.playlistTrackingEventReporter=o,this.mpPlayer=f,this.mediaEventController=u,this.mediaKeysManager=S,this.playerSessionId=a,this.prioritizationSystem=s,this.playerBufferManager=l,this.streamFeature=c,this.videoPreviewFeature=d,this.hdcpStore=p,this.timeDataManager=m,this.timelineManager=h,this.globalStreamControl=g,this.cleanupCollection=new vS.CleanupCollection,this.playbackStartedTracker=v,this.sonarEventAdapter=O,this.sessionEngagementTracker=U,this.seekInterceptorManager=y,this.useDefaultPlaybackSettings=!1;var M=L.configurationStore.configuration;null!=M&&null!=M.prs&&null!=M.prs.checkToUseDefaultPlaybackSettings&&!0===M.prs.checkToUseDefaultPlaybackSettings&&.9!==Number("9e-1")&&(R.info("This device evaluates "+Number("9e-1")+" as different from 0.9, which is evaluated as 0.9, so will use DefaultPlaybackSettings"),this.useDefaultPlaybackSettings=!0)}return e.prototype.handleResponse=freeOnUnref(function(e,t,n,r,i,o){var a,s=this,l=e.titleId;return i.promise.then(freeOnUnref(function(){s.cleanupCollection.cleanup()})),null==n||n.playbackResources.playbackUrls.ok||(a=n.playbackResources.playbackUrls.error),this.mediaEventController.traceEventController.reportTraceStop("PlaybackStartup","PRS","Success","ResourceLookup",{titleId:l,videoMaterialType:e.videoMaterialType,isEXPL:String(!0===e.enablePlaylisting)}),t.playbackResources.playbackUrls.ok||null!=t.playbackResources.playlistedPlaybackUrls&&t.playbackResources.playlistedPlaybackUrls.ok||(null!=t.playbackResources.syeUrls&&t.playbackResources.syeUrls.ok?this.mediaEventController.reportError(!1,t.playbackResources.playbackUrls.error,"Service","Unknown"):a=t.playbackResources.playbackUrls.error),null!=a?(this.timelineManager.appendPseudoEntry({timeUnit:ka.TimeUnit.ContentMillis,startTime:null,endTime:null,error:a,contentId:l,groupId:l},{titleId:l,contentType:"Feature",metadata:f(t.playbackResources.catalogMetadata),videoPreviewAssets:[]}),lt.Promise.reject(a)):(null!=n?this.initializeRecapContent(e,n,i):lt.Promise.resolve()).then(freeOnUnref(function(){return i.throwIfRequested(),s.initializeMainContent(e,t,r,o,i,null==n)}))}),e.prototype.initializeMainContent=freeOnUnref(function(d,p,h,e,m,t){var n,y=this,g=d.titleId,r=d.optOutAdTracking,i=d.resolutionCappingStrategy,v=d.videoMaterialType,O=0===this.playlistEngine.getItems().length,a=Hf.PlaybackResourceUtils.valueOrUndefined(p.playbackResources.playbackUrls),s=Hf.PlaybackResourceUtils.valueOrUndefined(p.playbackResources.playlistedPlaybackUrls),o=Hf.PlaybackResourceUtils.valueOrUndefined(p.playbackResources.syeUrls),l=null;if(null==a)if(null==s){if(null==o)return lt.Promise.reject(new Error("No PlaybackUrls, PlaylistedPlaybackUrls or SyeUrls"));n=o.listOfCdns[0].urlSetId,R.warn("PlaybackUrls null. Falling back to SyeUrls-only. defaultUrlSetId:",n)}else n=this.getFirstItemConsumptionId(s),l=Hf.PlaybackResourceUtils.valueOrNull(s.playbackSettings);else n=a.defaultUrlSetId,l=Hf.PlaybackResourceUtils.valueOrNull(a.playbackSettings);R.info("Main content default URL SET ID:",n);var f=null,u=null;null!==l&&(f=l.playbackSettings,u=l.id);var c=Ly.PlaybackSettingsProviderFactory.createFromEncodedPlaybackSettingsResponse(f,this.useDefaultPlaybackSettings),S=new Jy.ItemRelativeView(this.playlistEngine,{titleId:g,group:"Main"}),U=new aU.PlaybackSettingsPlaylistListener(this.mediaEventController,S,u,c);U.initialize(),this.cleanupCollection.push(U);var b=new sU.SonarPlaylistListener(this.sonarEventAdapter,S);b.initialize(),this.cleanupCollection.push(b);var P=new US.ConsumptionIdUpdater(this.mediaEventController,this.sonarEventAdapter,S),M=A(g,p.playbackResources,e);null!=M.playbackData.timeShiftPolicy?this.mediaEventController.reportCustomMetadata({TimeShiftPolicyVended:"true"}):this.mediaEventController.reportCustomMetadata({TimeShiftPolicyVended:"false"});var C=p.playbackResources.playbackData.contentId;this.mediaEventController.setVcid(C);var E={};null!=a?E.playbackUrlsSourceContext={playbackUrls:a,licenseAcquirer:p.licenseAcquirer}:null!=s&&(E.playlistedPlaylistSourceContext={playlistedPlaybackUrls:s,licenseAcquirer:p.licenseAcquirer}),null!=o&&(E.syeUrlsSourceContext={syeUrls:o});var T=eU.mapToContentSourceResolutionCappingStrategy(i),w=new db.InitialPlaybackPositionTracker(S,this.playlistEngine);w.initialize(),this.cleanupCollection.push(w);var I,k="None";null!=a?k=a.urlSets[a.defaultUrlSetId].urls.manifest.dynamicRange:null!=s&&(k=this.getFirstFixedItemDynamicRange(s)),I=new Hf.SuggestedPictureModeStrategy(d,k).getSuggestedPictureModes();var _=Hf.PlaybackResourceUtils.valueOrUndefined(p.playbackResources.fairPlayApplicationCertificate);return new fb.PlaylistSource("Main",p.playbackResources.timestamp,this.serviceClientFactory,this.adEventReporter,d,M,this.globalStreamControl,this.hdcpStore,this.mediaEventController,P,this.mpPlayer,c,this.playlistEngine,E,this.prioritizationSystem,this.playerBufferManager,T,this.streamFeature,S,w,this.videoPreviewFeature,C,!0===r,this.playbackStartedTracker,this.sonarEventAdapter,this.mediaKeysManager,this.playlistTrackingEventReporter,this.timeDataManager,this.seekInterceptorManager,_,this.advertisingId,I,this.downloadOperationId,nU.getMediaPlayerConfig(d,a)).initializeContent(m,t).then(freeOnUnref(function(t){m.throwIfRequested();var e=null!=a?a.cuepoints:null,n=t.getItems()[0].mediaRepresentation,r=new PS.MediaEventReportingPlaylistListener(y.mediaEventController,S,d.videoMaterialType);if(r.initialize(),y.cleanupCollection.push(r),null==a||null!=e&&null!=e.encodedManifest||null==n||"Feature"!==v?null!=e&&null==e.encodedManifest&&(e=null):e={},null!=e){var i=new zU.CuepointPlaylistPlaylistSource(e,y.playlistEngine,y.playlistTrackingEventReporter,y.mpPlayer,y.timeDataManager,S,t,r,y.adEventReporter);return(null!=e.encodedManifest?i.resolveFromCuepoints(m):i.resolveFromMediaRepresentation(m,n)).then(freeOnUnref(function(e){return y.reportServerInsertedAdBreakCustomMetadata(e),{mainContentView:t,timeTranslator:new SS.CuepointMainContentTimeTranslator(e)}}))}if(null!=s){var o=new tU.PlaylistedMainContentTimeTranslator(y.playlistEngine);return y.cleanupCollection.push(o),lt.Promise.resolve({mainContentView:t,timeTranslator:o})}return lt.Promise.resolve({mainContentView:t,timeTranslator:new SS.CuepointMainContentTimeTranslator([])})})).then(freeOnUnref(function(e){var t=e.mainContentView,n=e.timeTranslator;m.throwIfRequested();var r=0<=g.search(/^com\.amazon\.playback\.object\./);if("Feature"===v&&!r&&!0!==d.disableContinuousPlayDiscovery){var i=new ES.NextTitlePlaylistListener(d,y.serviceClientFactory,y.prsManager,S,h,y.playlistAutoplayBarrier,y.mediaEventController,y.mpPlayer);i.initialize(),y.cleanupCollection.push(i)}var o=new TS.SessionTrackingListener(g,d,S,t,n,y.mpPlayer,p.playbackSession,y.globalStreamControl,y.mediaEventController,y.sessionEngagementTracker,O);o.initialize(),y.cleanupCollection.push(o);var a=Hf.PlaybackResourceUtils.valueOrNull(p.playbackResources.auditPings);if(null!=a){var s=new rU.AuditPingListener(y.playerSessionId,y.mpPlayer,a,S,y.mediaEventController);s.initialize(),y.cleanupCollection.push(s)}if(null!=p.liveScheduleRefresher){var l=Hf.PlaybackResourceUtils.valueOrUndefined(p.playbackResources.liveSchedule),f=Hf.PlaybackResourceUtils.valueOrUndefined(p.playbackResources.linearRestrictions),u=new iU.LiveMetadataPlaylistUpdater(t);u.updateLiveMetadata(l,f);var c=new oU.LiveMetadataRequestScheduler(p.liveScheduleRefresher,t,u,y.mediaEventController);c.initialize(),y.cleanupCollection.push(c)}}))}),e.prototype.reportServerInsertedAdBreakCustomMetadata=freeOnUnref(function(e){if(0!==e.length){var t={},n=x.findIndex(e,freeOnUnref(function(e){return 0===e.timestampMs})),r=-1!==n;t.ServerInsertedAdBreaksCount=e.length.toString(),t.ServerInsertedHasPreRoll=r.toString(),r&&(t.ServerInserted_Preroll_AdCount=e[n].ads.length.toString()),this.mediaEventController.reportCustomMetadata(t)}}),e.prototype.initializeRecapContent=freeOnUnref(function(i,o,a){var s=this,l=i.titleId,e=i.resolutionCappingStrategy,f=0===this.playlistEngine.getItems().length,t=o.playbackResources.playbackUrls.value,n=new Jy.ItemRelativeView(this.playlistEngine,{titleId:l,group:"Main"}),u=Jy.PlaylistRelativeView.fromView(n,{type:"Recap",group:"Recap"}),r=null,c=null;null!=t.playbackSettings&&t.playbackSettings.ok&&(c=t.playbackSettings.value.id,r=t.playbackSettings.value.playbackSettings);var d=Ly.PlaybackSettingsProviderFactory.createFromEncodedPlaybackSettingsResponse(r,this.useDefaultPlaybackSettings),p=new aU.PlaybackSettingsPlaylistListener(this.mediaEventController,u,c,d);p.initialize(),this.cleanupCollection.push(p);var h=new sU.SonarPlaylistListener(this.sonarEventAdapter,u);h.initialize(),this.cleanupCollection.push(h);var m=new US.ConsumptionIdUpdater(this.mediaEventController,this.sonarEventAdapter,u),y=new db.InitialPlaybackPositionTracker(u,this.playlistEngine);y.initialize(),this.cleanupCollection.push(y);var g=function(e){if(null==e.slates||!e.slates.ok)throw new ct.XpError("prs.missing_slates");var t={},n=e.slates.value;return null!=n.intro&&null!=n.intro.url&&(t.introSlate={url:n.intro.url,minDurationSec:n.intro.minDisplayDuration,maxDurationSec:n.intro.maxDisplayDuration}),null!=n.outro&&null!=n.outro.url&&(t.outroSlate={url:n.outro.url,minDurationSec:n.outro.minDisplayDuration,maxDurationSec:n.outro.maxDisplayDuration}),{playbackData:e.playbackData,catalogMetadata:t,staticTimedTextStreams:[],videoPreviewAssets:[]}}(o.playbackResources),v={playbackUrlsSourceContext:{playbackUrls:t,licenseAcquirer:o.licenseAcquirer}},O=Hf.PlaybackResourceUtils.valueOrUndefined(o.playbackResources.fairPlayApplicationCertificate);return new fb.PlaylistSource("Recap",o.playbackResources.timestamp,this.serviceClientFactory,this.adEventReporter,i,g,this.globalStreamControl,this.hdcpStore,this.mediaEventController,m,this.mpPlayer,d,this.playlistEngine,v,this.prioritizationSystem,this.playerBufferManager,eU.mapToContentSourceResolutionCappingStrategy(e),this.streamFeature,u,y,this.videoPreviewFeature,g.playbackData.contentId,!0===i.optOutAdTracking,this.playbackStartedTracker,this.sonarEventAdapter,this.mediaKeysManager,this.playlistTrackingEventReporter,this.timeDataManager,this.seekInterceptorManager,O,this.advertisingId).initializeContent(a).then(freeOnUnref(function(e){a.throwIfRequested();var t=new PS.MediaEventReportingPlaylistListener(s.mediaEventController,u,i.videoMaterialType);t.initialize(),s.cleanupCollection.push(t),new WU.RecapPlaylistSource(g.catalogMetadata,s.playlistEngine,e).resolve();var n=new SS.CuepointMainContentTimeTranslator([]),r=new TS.SessionTrackingListener(l,void 0,u,e,n,s.mpPlayer,o.playbackSession,s.globalStreamControl,s.mediaEventController,s.sessionEngagementTracker,f);r.initialize(),s.cleanupCollection.push(r)}))}),e.prototype.getFirstItemConsumptionId=freeOnUnref(function(e){return e.intraTitlePlaylist.filter(freeOnUnref(function(e){return"Main"===e.type||"Card"===e.type}))[0].urls[0].consumptionId}),e.prototype.getFirstFixedItemDynamicRange=freeOnUnref(function(e){return e.intraTitlePlaylist.filter(freeOnUnref(function(e){return"Main"===e.type||"Card"===e.type}))[0].manifestMetadata.dynamicRange}),e})();t.PRSResponseHandler=i}));e(pb);pb.getPauseBehaviorFromPRSResponse,pb.getContentMetadataFromPRSResponse,pb.PRSResponseHandler;var hb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m){this.globalStreamControl=e,this.hdcpStore=t,this.mediaEventController=n,this.mediaKeysManager=h,this.mpPlayer=r,this.prioritizationSystem=i,this.playerBufferManager=o,this.playlistAutoplayBarrier=a,this.playlistEngine=s,this.prsManager=l,this.serviceClientFactory=f,this.streamFeature=u,this.videoPreviewFeature=c,this.timelineManager=d,this.sonarEventAdapter=p,this.sessionEngagementTracker=m}return e.prototype.handleResponse=freeOnUnref(function(o,a,s,l,f,e){var u=this,c=a.titleId,d=a.videoMaterialType,t=a.resolutionCappingStrategy,p=0===this.playlistEngine.getItems().length,h=new vS.CleanupCollection;if(o.promise.then(freeOnUnref(function(){h.cleanup()})),!l.playbackResources.playbackUrls.ok){var n=l.playbackResources.playbackUrls.error;return this.timelineManager.appendPseudoEntry({timeUnit:ka.TimeUnit.ContentMillis,startTime:null,endTime:null,error:n,contentId:c,groupId:c},{titleId:c,contentType:"Feature",metadata:Hf.PlaybackResourceUtils.valueOrUndefined(l.playbackResources.catalogMetadata),videoPreviewAssets:[]}),lt.Promise.reject(n)}var r=l.playbackResources.playbackUrls.value,i=pb.getContentMetadataFromPRSResponse(c,l.playbackResources,e),m=new Jy.ItemRelativeView(this.playlistEngine,{titleId:c}),y=Hf.PlaybackResourceUtils.valueOrNull(r.playbackSettings),g=null;null!=y&&(g=y.playbackSettings);var v=Ly.PlaybackSettingsProviderFactory.createFromEncodedPlaybackSettingsResponse(g),O=new US.ConsumptionIdUpdater(this.mediaEventController,this.sonarEventAdapter,m),S=new bS.ActivePlaybackConsumptionIdTracker(O,m,r.defaultUrlSetId);S.initialize(),h.push(S);var U=eU.mapToContentSourceResolutionCappingStrategy(t),b=r.urlSets[r.defaultUrlSetId].urls.manifest.dynamicRange,P=new Hf.SuggestedPictureModeStrategy(a,b).getSuggestedPictureModes();return new $S.OfflineContentPlaylistSource(a,i,c+"_"+d,this.globalStreamControl,this.hdcpStore,this.mediaEventController,this.mpPlayer,v,r,l.licenseAcquirer,this.prioritizationSystem,this.playerBufferManager,this.playlistEngine,m,this.streamFeature,this.videoPreviewFeature,U,this.mediaKeysManager,P).initializeContent(o).then(freeOnUnref(function(e){if(o.throwIfRequested(),"Feature"===d){var t=new ES.NextTitlePlaylistListener(a,u.serviceClientFactory,u.prsManager,m,f,u.playlistAutoplayBarrier,u.mediaEventController,u.mpPlayer,s);t.initialize(),h.push(t)}var n=new PS.MediaEventReportingPlaylistListener(u.mediaEventController,m,a.videoMaterialType);n.initialize(),h.push(n);var r=new SS.CuepointMainContentTimeTranslator([]),i=new TS.SessionTrackingListener(c,a,m,e,r,u.mpPlayer,l.playbackSession,u.globalStreamControl,u.mediaEventController,u.sessionEngagementTracker,p);i.initialize(),h.push(i)}))}),e})();t.OfflinePRSResponseHandler=n}));e(hb);hb.OfflinePRSResponseHandler;var mb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("TitleRequestTracker"),n=freeOnUnref(function(){function e(){this.inFlightRequests={}}return e.prototype.addTitle=freeOnUnref(function(e,t){this.inFlightRequests[e]=t}),e.prototype.get=freeOnUnref(function(e){return this.inFlightRequests[e]}),e.prototype.updateTitlePosition=freeOnUnref(function(e,t){void 0!==this.get(e)?this.inFlightRequests[e].positionMs=t:o.warn("Attempted to update position of non-existent title '"+e+"'")}),e.prototype.cancel=freeOnUnref(function(e){var t=this.inFlightRequests;null!=t[e]?(t[e].cancel(),delete t[e]):o.warn("Attempted to unload non-existent title '"+e+"'")}),e.prototype.cancelAll=freeOnUnref(function(e){void 0===e&&(e=!1);for(var t=this.inFlightRequests,n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];e&&o.info("Cancelling request for "+i),t[i].cancel()}this.inFlightRequests={}}),e.prototype.size=freeOnUnref(function(){return Object.keys(this.inFlightRequests).length}),e})();t.TitleRequestTracker=n}));e(mb);mb.TitleRequestTracker;var yb=t(freeOnUnref(function(e,t){function d(e){return e.titleId+"_"+e.videoMaterialType}Object.defineProperty(t,"__esModule",{value:!0});var E=de.get("PRSManager"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v,O,S,U,b){this.prsResponseHistory={},this.titleRequestTracker=new mb.TitleRequestTracker,this.getCacheDownloadOperationId=freeOnUnref(function(e,t){var n=null!=e.playbackExperiences&&e.playbackExperiences.some(freeOnUnref(function(e){return e===ka.PlaybackExperience.RapidRecap}));return null==e.playbackEnvelope||null==e.playbackEnvelope.correlationId?(E.info("Bypassing cache: Playback envelope is null or does not have correlation id."),null):Hf.isPlaybackEnvelopeExpired(e.playbackEnvelope)?(E.info("Bypassing cache: Playback envelope is expired."),null):null!=t&&!0===t.bypassCache?(E.info("Bypassing cache: Stream restart with bypassCache flag."),null):n?(E.info("Bypassing cache: Request contains RapidRecap."),null):!0===e.enablePlaylisting&&null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.cacheFeature&&!1===L.configurationStore.configuration.cacheFeature.enableCachingForPlaylistedContent?(E.info("Bypassing cache: EXPL caching is disabled in configuration."),null):Ot.hex_sha256(e.playbackEnvelope.correlationId)}),this.serviceClientFactory=e,this.prsClient=new Pr.PlaybackResourceClient(e,Hf.createPrsGeneralApiParameters(o));var P=new _r.LivePlaybackResourceClient(e),M=new _r.VodPlaybackResourceClient(e),C=new _r.LiveLinearPlaybackResourceClient(e);this.playlistEngine=t,this.playlistAutoplayBarrier=n,this.playlistTrackingEventReporter=r,this.mediaKeysManager=U,this.mpPlayer=i,this.clientPrsParameters=o,this.mediaEventController=a,this.prioritizationSystem=s,this.playerBufferManager=l,this.streamFeature=f,this.videoPreviewFeature=u,this.hdcpStore=c,this.timeDataManager=p,this.timelineManager=d,this.globalStreamControl=m,this.playerSessionId=y,this.adEventReporter=v,this.playbackStartedTracker=O,this.sonarEventAdapter=S,this.sessionEngagementTracker=b,this.seekInterceptorManager=h,this.prsResolver=new Hf.PRSResolver(this.prsClient,P,C,M,this.serviceClientFactory,this.clientPrsParameters),this.videoQualityOverrideStorage=g}return e.prototype.resolve=freeOnUnref(function(n,r,i,o,a,s,e,l){var f=this;if(null!=e)return E.info("Requesting playback resources for multiplayer with overrides. Skip cache. Overrides: ",JSON.stringify(e)),this.requestPlaybackResources(n,r,i,o,null!=s?s:this.videoQualityOverrideStorage,a,e);var t=n.titleId,u=(n.videoMaterialType,n.advertisingId);this.advertisingId=u;var c=this.prsResponseHistory[t];return null!=c?(E.info("Apply existing prsResponse and prsResponseHandler for titleId: "+t),c.prsResponseHandler.handleResponse(n,c.main,c.recap,i,o,a)):this.getOfflinePrsResponse(n).then(freeOnUnref(function(e){if(null!=e){var t=d(n);return E.info("Local PRS response found for downloadOperationId: "+t),f.retrieveLocalPlaybackResources(o,n,t,e,i,a)}return f.getCachedPrsResponse(n,l).then(freeOnUnref(function(e){var t=f.getCacheDownloadOperationId(n,l);return null!=e&&null!=t?(E.info("Cached playback resources found for downloadOperationId: "+t),f.retrieveCachedPlaybackResources(o,n,t,e,i,a)):(E.info("Requesting playback resources"),f.requestPlaybackResources(n,r,i,o,null!=s?s:f.videoQualityOverrideStorage,a))}))}))}),e.prototype.getOfflinePrsResponse=freeOnUnref(function(e){return Jo.metadataStorage.capabilities.isSupported?null!=e.playbackEnvelope?lt.Promise.resolve(null):Jo.metadataStorage.get(gS.createPlaybackResourceResponseKey(d(e))).then(freeOnUnref(function(e){return e})).catch(freeOnUnref(function(){return null})):lt.Promise.resolve(null)}),e.prototype.getCachedPrsResponse=freeOnUnref(function(e,t){var n=this.getCacheDownloadOperationId(e,t),r=", cacheDownloadOperationId: "+n;if(!Pt.localStorage.capabilities.isSupported||null==n)return E.info("LocalStorage: Retrieve cached content skipped, isSupported: "+Pt.localStorage.capabilities.isSupported+r),lt.Promise.resolve(null);var i=L.configurationStore.configuration;if(null!=i&&null!=i.cacheFeature&&!0===i.cacheFeature.disableCaching)return E.info("LocalStorage: Retrieve cached content skipped via configuration disable"),lt.Promise.resolve(null);var o=vu.createCachedContentMetadataKey(n);return this.fetchCachedContentMetadataAndReportResult(n).then(freeOnUnref(function(e){return null==e?null:Pt.localStorage.getText(vu.createCachedPlaybackResourcesKey(n)).then(freeOnUnref(function(e){if(null==e)return E.warn("LocalStorage: Retrieve PRS invalid (missing or failed fetch when cached metadata exists)"+r),q.metrics.putMetric("XpPlayer.Cache.FetchFatalError"),null;var t=JSON.parse(e);return E.info("LocalStorage: Retrieve PRS success, session: "+t.session+r),t}))})).catch(freeOnUnref(function(e){return E.error("LocalStorage: Retrieve PRS failed, cachedContentMetadataKey: "+o+", error: "+e.message+r),q.metrics.putMetric("XpPlayer.Cache.FetchFatalError"),null}))}),e.prototype.fetchCachedContentMetadataAndReportResult=freeOnUnref(function(e){var t=this,n=vu.createCachedContentMetadataKey(e),r=", cachedContentMetadataKey: "+n+", cacheDownloadOperationId: "+e;return Jo.metadataStorage.get(n).then(freeOnUnref(function(e){return null==e?(E.info("LocalStorage: Retrieve cached content miss (missing metadata or failed fetch), cachedContentMetadataKey: "+n+r),q.metrics.putMetric("XpPlayer.Cache.Miss"),null):e.expirationTimeMs<=Date.now()?(E.info("LocalStorage: Retrieve cached content metadata invalid (expired), cachedContentMetadataKey: "+n+", expirationTimeMs: "+e.expirationTimeMs+r),q.metrics.putMetric("XpPlayer.Cache.Miss"),null):"Completed"===e.state?(E.info("LocalStorage: Retrieve cached content hit"+r),q.metrics.putMetric("XpPlayer.Cache.HitSuccess"),ip.CacheStatusTracker.reportCacheHit("Prs"),e):"Downloading"===e.state?(E.info("LocalStorage: Retrieve cached content partial hit"+r),q.metrics.putMetric("XpPlayer.Cache.PartialHit"),ip.CacheStatusTracker.reportCacheHit("Prs"),e):(E.error("LocalStorage: Retrieve cached content unknown state, state: "+e.state+r),null)})).catch(freeOnUnref(function(e){return E.error("LocalStorage: Retrieve cached content failed, cachedContentMetadataKey: "+n+", error: "+e.message+r),t.mediaEventController.reportPlayerCacheStatus("Miss"),q.metrics.putMetric("XpPlayer.Cache.FetchFatalError"),null}))}),e.prototype.retrieveLocalPlaybackResources=freeOnUnref(function(a,s,l,f,u,c){var d,p=this;return this.prsResolver.createBaseRequestBuilder(s,u,a,this.videoQualityOverrideStorage).then(freeOnUnref(function(e){return d=e,p.prsResolver.createImmediateConsumptionRequest(d,s,a)})).then(freeOnUnref(function(e){var t=new hb.OfflinePRSResponseHandler(p.globalStreamControl,p.hdcpStore,p.mediaEventController,p.mpPlayer,p.prioritizationSystem,p.playerBufferManager,p.playlistAutoplayBarrier,p.playlistEngine,p,p.serviceClientFactory,p.streamFeature,p.videoPreviewFeature,p.timelineManager,p.sonarEventAdapter,p.mediaKeysManager,p.sessionEngagementTracker),n=null!=f.playbackUrls?f.playbackUrls.cacheKey:void 0,r=Hf.PlaybackResourcesConverter.transformPRSv1Response(f),i=new Hf.UpdateStreamPlaybackSessionTracker(p.serviceClientFactory,u,r.session,s.titleId,p.prsClient,e,n,!0),o={licenseAcquirer:new Hf.LicenseAcquirerV1(p.prsClient,d),playbackResources:r,liveScheduleRefresher:void 0,playbackSession:i};return t.handleResponse(a,s,l,o,u,c)}))}),e.prototype.retrieveCachedPlaybackResources=freeOnUnref(function(e,t,n,r,i,o){var a=new Hf.PlaybackEnvelopeRefreshController(t);a.initialize();var s=r.session,l=new Hf.SessionApiPlaybackSessionTracker(this.serviceClientFactory,s,a,i),f={main:{licenseAcquirer:new Hf.LicenseAcquirerV2(this.serviceClientFactory,t,a,s.sessionHandoffToken),playbackResources:r,liveScheduleRefresher:void 0,playbackSession:l},recap:void 0};return this.handleResponse(t,f,i,e,o,n)}),e.prototype.requestPlaybackResources=freeOnUnref(function(t,e,n,r,i,o,a){var s=this;return this.resolveForConfig(t,e,n,r,i,a).then(freeOnUnref(function(e){return r.throwIfRequested(),s.handleBookmarkPosition(t,e),s.handleResponse(t,e,n,r,o)}))}),e.prototype.handleResponse=freeOnUnref(function(e,t,n,r,i,o){var a=this,s=e.titleId,l=new pb.PRSResponseHandler(this.adEventReporter,this,this.serviceClientFactory,this.playlistEngine,this.playlistAutoplayBarrier,this.playlistTrackingEventReporter,this.playerSessionId,this.prioritizationSystem,this.playerBufferManager,this.mpPlayer,this.mediaEventController,this.streamFeature,this.videoPreviewFeature,this.hdcpStore,this.timelineManager,this.timeDataManager,this.seekInterceptorManager,this.globalStreamControl,this.playbackStartedTracker,this.sonarEventAdapter,this.mediaKeysManager,this.sessionEngagementTracker,this.advertisingId,o);return l.handleResponse(e,t.main,t.recap,n,r,i).then(freeOnUnref(function(){null!=t.main.playbackResources.syeUrls&&t.main.playbackResources.syeUrls.ok&&fl.liveLowLatencyContext.isLiveLowLatencySupported()&&(a.prsResponseHistory[s]={main:t.main,recap:t.recap,prsResponseHandler:l})}))}),e.prototype.resolveForConfig=freeOnUnref(function(e,t,n,r,i,o){return null==e.playbackEnvelope?this.prsResolver.resolve(e,t,n,r,i,o):null!=e.playbackEnvelope.playbackResourceType&&"LINEAR"===e.playbackEnvelope.playbackResourceType?this.prsResolver.resolveLiveLinearV2(e,n,r,i):"LiveStreaming"!==e.videoMaterialType?this.prsResolver.resolveVodV2(e,n,r,i):this.prsResolver.resolveLiveV2(e,n,r,i,o)}),e.prototype.handleBookmarkPosition=freeOnUnref(function(e,t){if(e.useBookmarkStartPosition){var n=Hf.PlaybackResourceUtils.valueOrUndefined(t.main.playbackResources.whisperSyncBookmark);if(null!=n&&0<=n.timecodeSec){var r=1e3*n.timecodeSec;this.titleRequestTracker.updateTitlePosition(e.titleId,r)}}}),e.prototype.clearHistory=freeOnUnref(function(){this.prsResponseHistory={}}),e})();t.PRSManager=n}));e(yb);yb.PRSManager;var gb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("SeamlessSwitchLatencyDataSink"),n=freeOnUnref(function(){function e(e){this.MIN_SWITCH_INTERVAL_MS=1e4,this.currentSwitchStartTimeMs=null,this.lastSwitchTimeMs=0,this.mediaEventController=e}return e.prototype.onEvent=freeOnUnref(function(e,t,n){"seamlessSwitchLatency"===t&&(this.isSwitchStartData(n)?this.handleSwitchStart(n):this.isSwitchCompletionData(n)?this.handleSwitchCompletion(n):i.warn("Invalid switch data format received",JSON.stringify(n)))}),e.prototype.handleSwitchStart=freeOnUnref(function(e){var t=Date.now();t-this.lastSwitchTimeMs>this.MIN_SWITCH_INTERVAL_MS?(this.currentSwitchStartTimeMs=e.switchStartTimeMs,this.lastSwitchTimeMs=t):i.info("Switch start ignored due to throttling, last switch was "+(t-this.lastSwitchTimeMs)+"ms ago")}),e.prototype.handleSwitchCompletion=freeOnUnref(function(e){if(null!=this.currentSwitchStartTimeMs){var t=e.replacedSampleFeedTimeMs-this.currentSwitchStartTimeMs,n=e.replacedSamplePositionMs-e.currentPlaybackPositionMs;if(t<0||n<0)i.error("Invalid switch timing - timeDiff: "+t+"ms, positionDiff: "+n+"ms");else{var r=Math.round(t+n);i.info("Reporting latency - timeDifferenceMs: "+t+", positionDifferenceMs: "+n),this.mediaEventController.reportCustomMetrics({seamlessSwitchLatencyMs:r}),this.currentSwitchStartTimeMs=null}}}),e.prototype.isSwitchStartData=freeOnUnref(function(e){return"object"==typeof e&&"number"==typeof e.switchStartTimeMs}),e.prototype.isSwitchCompletionData=freeOnUnref(function(e){return"object"==typeof e&&"number"==typeof e.replacedSampleFeedTimeMs&&"number"==typeof e.currentPlaybackPositionMs&&"number"==typeof e.replacedSamplePositionMs}),e})();t.SeamlessSwitchLatencyDataSink=n}));e(gb);gb.SeamlessSwitchLatencyDataSink;var vb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("LiveMetadataPlaylistUpdaterV2"),n=freeOnUnref(function(){function e(e,t){this.playlistRelativeView=null,this.titleId=t,this.playlistEngine=e,null!=this.titleId&&this.updatePlayListRelativeView(this.titleId)}return e.prototype.updatePlayListRelativeView=freeOnUnref(function(e){var t=new Jy.ItemRelativeView(this.playlistEngine,{titleId:e,group:"Main"});this.playlistRelativeView=Jy.PlaylistRelativeView.fromView(t,{type:"Main"})}),e.prototype.updateTitleForLiveMetadata=freeOnUnref(function(e){this.titleId!==e&&(this.titleId=e,this.updatePlayListRelativeView(this.titleId))}),e.prototype.updateLinearScheduleTimeline=freeOnUnref(function(e){if(null!==this.titleId&&null!==this.playlistRelativeView)if(e.titleId===this.titleId)if(0!==e.programs.length)if(0!==this.playlistRelativeView.getItems().length){for(var t=this.playlistRelativeView.getItems()[0].start,n=0,r=e.programs;n<r.length;n++){var i=r[n],o=i.startTime,a=i.endTime;o!==t&&this.updateView(t,o,{timelineStart:t,timelineEnd:o,timelineUnit:ka.TimeUnit.EpochMillis},"Filling gap in the timeline"),this.updateView(o,a,{liveScheduleTitleId:i.airingId,timelineStart:o,timelineEnd:a,timelineUnit:ka.TimeUnit.EpochMillis},"Updating program in the timeline"),t=a}this.updateView(t,1/0,{timelineStart:t,timelineEnd:1/0,timelineUnit:ka.TimeUnit.EpochMillis},"Extending future in the timeline"),s.info("Playlist after updating schedule:\n"+JS.formatPlaylist(this.playlistRelativeView.playlistEngine))}else s.error("updateLinearScheduleTimeline there is no items in the current playList");else s.error("updateLinearScheduleTimeline without a valid program.");else s.error("updateLinearScheduleTimeline with a different title "+e.titleId+" than the updater title "+this.titleId);else s.error("updateLinearScheduleTimeline to a player without valid titleId")}),e.prototype.updateView=freeOnUnref(function(e,t,n,r){try{this.playlistRelativeView&&this.playlistRelativeView.update(e,t,n)}catch(e){s.error(r+". Failed to update main content view:",e)}}),e})();t.LiveMetadataPlaylistUpdaterV2=n}));e(vb);vb.LiveMetadataPlaylistUpdaterV2;var Ob=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("LoadMetricsCalculator"),n=freeOnUnref(function(){function e(e,t){var i=this;this.loadTime=null,this.loadedTime=null,this.startTime=null,this.videoMaterialType=null,this.tryLogMetrics=freeOnUnref(function(){if(null!==i.loadTime){if("ready"===i.mpPlayer.contentState&&(null===i.loadedTime&&(i.loadedTime=Date.now()-i.loadTime,o.info("Time to become Ready took "+i.loadedTime+" ms"),q.metrics.putMetric("ReadyToWatchTime",i.loadedTime,"ms"),i.diagnostics.report("ttff",{readyToWatchMs:i.loadedTime}),i.traceEventController.reportTraceStart("PlaybackStartup","mediaPlayerRender","OS",null)),"playing"===i.mpPlayer.playbackState)){if(i.traceEventController.reportTraceStop("PlaybackStartup","mediaPlayerRender","Success","OS",null),null===i.startTime)return void o.warn("Attempted to log TTFF without start time");var e=Date.now(),t=i.loadTime+i.loadedTime,n=e-i.loadTime-Math.max(0,i.startTime-t),r=e-i.startTime;o.info("Player-calculated TTFF took "+r+" ms, LoadToPlayingTime took "+n+" ms"),q.metrics.putMetric("LoadToPlayingTime",n,"ms"),q.metrics.putMetric("TTFF",r,"ms"),null!=i.videoMaterialType&&(q.metrics.putMetric("TTFF."+i.videoMaterialType,r,"ms"),q.metrics.putMetric("LoadToPlayingTime."+i.videoMaterialType,n,"ms")),i.diagnostics.report("ttff",{playerCalculatedTtffMs:r}),i.traceEventController.playbackStarted(),i.removeMpPlayerListeners()}}else o.warn("Attempted to log metrics without load time")}),this.mpPlayer=e,this.traceEventController=t,this.diagnostics=nn.Diagnostics.create("LoadMetricsCalculator")}return e.prototype.load=freeOnUnref(function(e){null===this.loadTime&&this.mpPlayer.on("contentStateChange",this.tryLogMetrics),this.loadTime=Date.now(),this.videoMaterialType=e,q.metrics.putMetric("LoadCalled"),q.metrics.putMetric("LoadCalled."+e),this.diagnostics.report("ttff",{loadTime:this.loadTime})}),e.prototype.play=freeOnUnref(function(){null===this.startTime&&(this.startTime=Date.now(),this.mpPlayer.on("playbackStateChange",this.tryLogMetrics),this.diagnostics.report("ttff",{playTime:this.startTime}))}),e.prototype.unload=freeOnUnref(function(){this.removeMpPlayerListeners(),this.loadTime=null,this.loadedTime=null,this.startTime=null,this.videoMaterialType=null,this.traceEventController.unload()}),e.prototype.removeMpPlayerListeners=freeOnUnref(function(){this.mpPlayer.off("contentStateChange",this.tryLogMetrics),this.mpPlayer.off("playbackStateChange",this.tryLogMetrics)}),e})();t.LoadMetricsCalculator=n}));e(Ob);Ob.LoadMetricsCalculator;var Sb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){var r=this;this.eventEmitter=new A.EventEmitter,this.getAudioTrackById=freeOnUnref(function(e){return null}),this.addEventListener=freeOnUnref(function(e,t,n){r.eventEmitter.on(e,t)}),this.dispatchEvent=freeOnUnref(function(e){return r.eventEmitter.emitSync(e.type,e),!0}),this.removeEventListener=freeOnUnref(function(e,t,n){r.eventEmitter.off(e,t)}),this.wrappedValue={length:0,getTrackById:this.getAudioTrackById,item:null,addEventListener:this.addEventListener,removeEventListener:this.removeEventListener,dispatchEvent:this.dispatchEvent,onaddtrack:null,onchange:null,onremovetrack:null}}return e.prototype.add=freeOnUnref(function(e){this.wrappedValue[this.wrappedValue.length]=e,this.wrappedValue.length++,this.eventEmitter.emit("addtrack",{type:"addtrack",track:e})}),e.prototype.remove=freeOnUnref(function(e){for(var t=null,n=0;n<this.wrappedValue.length;n++)if(this.wrappedValue[n]===e){t=n;break}null!==t&&(Array.prototype.splice.call(this.wrappedValue,t,1),this.eventEmitter.emit("removetrack",{type:"removetrack",track:e}))}),e.prototype.getTrackList=freeOnUnref(function(){return this.wrappedValue}),e})();t.AudioTrackListWrapper=n}));e(Sb);Sb.AudioTrackListWrapper;var Ub=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.TEXT=2]="TEXT"})(n||(n={})),t.TrackType=n}));e(Ub);Ub.TrackType;var bb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("BaseAudioDataExtractor"),n=freeOnUnref(function(){function e(){}return e.prototype.extractData=freeOnUnref(function(e,t,n,r){if(n.type!==Ub.TrackType.AUDIO)return a.warn("Expected track type AUDIO, but encountered "+Ub.TrackType[n.type]),n;var i=n,o=e;return i.sampleRate=o.entries[0].sampleRate>>>16,i.numChannels=o.entries[0].channelCount,i}),e})();t.BaseAudioDataExtractor=n}));e(bb);bb.BaseAudioDataExtractor;var Pb=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var s=[48e3,44100,32e3,-1],l=[48e3,44100,32e3,-1],f=[2,1,2,3,3,4,4,5],r=freeOnUnref(function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return n(e,a),e.prototype.extractData=freeOnUnref(function(e,t,n,r){(n=a.prototype.extractData.call(this,e,t,n,r)).codecType="AUDIO_CODEC_EAC3";var i=n;if("ec-3"===n.fourCC){if(null==(o=Ao.Boxes.find(e.entries[0],Ao.Boxes.ofType("dec3"))))throw new Error("Missing EC-3 configuration box!");i.sampleRate=s[o.independentSubstreams[0].fscod],i.numChannels=f[o.independentSubstreams[0].acmod],o.independentSubstreams[0].lfeon&&i.numChannels++}else if("ac-3"===n.fourCC){var o;if(null==(o=Ao.Boxes.find(e.entries[0],Ao.Boxes.ofType("dac3"))))throw new Error("Missing AC-3 configuration box!");i.sampleRate=l[o.fscod],i.numChannels=f[o.acmod],o.lfeon&&i.numChannels++}return i}),e})(bb.BaseAudioDataExtractor);t.Ac3DataExtractor=r}));e(Pb);Pb.Ac3DataExtractor;var Mb=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.extractData=freeOnUnref(function(e,t,n,r){return(n=i.prototype.extractData.call(this,e,t,n,r)).codecType="AUDIO_CODEC_AAC",n}),e})(bb.BaseAudioDataExtractor);t.AacDataExtractor=r}));e(Mb);Mb.AacDataExtractor;var Cb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("BaseVideoDataExtractor"),n=freeOnUnref(function(){function e(){}return e.prototype.extractData=freeOnUnref(function(e,t,n,r){if(n.type!==Ub.TrackType.VIDEO)return a.warn("Expected track type VIDEO, but encountered "+Ub.TrackType[n.type]),n;var i=n,o=e;return i.resolution={width:o.entries[0].width,height:o.entries[0].height},i.maxResolution=this.parseMaxResolution(r["max-resolution"]),i.frameRate=this.parseFrameRate(r["frame-rate"]),n.baseSample.resolution=i.resolution,i}),e.prototype.parseMaxResolution=freeOnUnref(function(e){if(null==e)throw new Error("Required parameter max-resolution is missing");var t=e.split("x"),n=t[0],r=t[1];if(0<t.slice(2).length)throw new Error('Required parameter max-resolution malformed as "'+e+'"');var i=parseInt(n),o=parseInt(r);if(0<i&&0<o)return{width:i,height:o};throw new Error('Required parameter max-resolution "'+e+'" contains non-positive numbers')}),e.prototype.parseFrameRate=freeOnUnref(function(e){if(null==e)throw new Error("Required parameter frame-rate is missing");var t=-1!==e.indexOf("/")?this.evaluateFrameRate(e):parseFloat(e);if(0<t)return t;throw new Error("Parameter frame-rate value "+e+" is not a positive number")}),e.prototype.evaluateFrameRate=freeOnUnref(function(e){var t=e.split("/");if(2!==t.length)throw new Error("Invalid frame-rate parameter: "+e);var n=t.map(freeOnUnref(function(e){return parseFloat(e)})),r=n[0],i=n[1];if(0===i)throw new Error("Frame-rate division by zero: ("+r+") / ("+i+") ");var o=r/i;return o=Math.floor(100*o)/100}),e})();t.BaseVideoDataExtractor=n}));e(Cb);Cb.BaseVideoDataExtractor;var Eb=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return n(e,a),e.prototype.extractData=freeOnUnref(function(e,t,n,r){(n=a.prototype.extractData.call(this,e,t,n,r)).codecType="VIDEO_CODEC_AVC";var i=Ao.Boxes.find(e.entries[0],Ao.Boxes.ofType("avcC"));if(null==i)throw new Error("Missing AVC configuration box!");var o=n;return o.codecSpecificData=this.extractAvcData(i),o}),e.prototype.extractAvcData=freeOnUnref(function(e){if(null!=e){var t=0<e.SPSs.length?e.SPSs[0]:null,n=0<e.PPSs.length?e.PPSs[0]:null;if(null!=t||null!=n){var r=null!=t&&0<t.length?4+t.length:0,i=null!=n&&0<n.length?4+n.length:0;if(0!==r||0!==i){var o=new Uint8Array(r+i);return 0<r&&null!=t&&(o.set([0,0,0,1]),o.set(t,4)),0<i&&null!=n&&(o.set([0,0,0,1],r),o.set(n,r+4)),o}}}}),e})(Cb.BaseVideoDataExtractor);t.AvcDataExtractor=r}));e(Eb);Eb.AvcDataExtractor;var Tb=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.extractData=freeOnUnref(function(e,t,n,r){return(n=i.prototype.extractData.call(this,e,t,n,r)).codecType="VIDEO_CODEC_AV1",n.baseSample.visualPresentationSize={width:t.width,height:t.height},n}),e})(Cb.BaseVideoDataExtractor);t.Av1DataExtractor=r}));e(Tb);Tb.Av1DataExtractor;var wb=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("HevcDataExtractor"),r=freeOnUnref(function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return n(e,a),e.prototype.extractData=freeOnUnref(function(e,t,n,r){(n=a.prototype.extractData.call(this,e,t,n,r)).codecType="VIDEO_CODEC_HEVC";var i=Ao.Boxes.find(e.entries[0],Ao.Boxes.ofType("hvcC"));if(null==i)throw new Error("Missing HEVC configuration box!");var o=n;return o.codecSpecificData=this.extractHevcData(i),o}),e.prototype.extractHevcData=freeOnUnref(function(e){if(null!=e){var t=e.arrays.reduce(freeOnUnref(function(e,t){return e+t.nals.reduce(freeOnUnref(function(e,t){return e+t.byteLength+4}),0)}),0);t<0&&f.warn("[neguintarray] Creating new Uint8Array for HEVC initData of negative length: "+t);for(var n=new Uint8Array(t),r=0,i=0,o=e.arrays;i<o.length;i++)for(var a=0,s=o[i].nals;a<s.length;a++){var l=s[a];n.set([0,0,0,1],r),n.set(l,r+4),r+=l.byteLength+4}return n}}),e})(Cb.BaseVideoDataExtractor);t.HevcDataExtractor=r}));e(wb);wb.HevcDataExtractor;var Ib=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var c=de.get("DvheDataExtractor"),r={4:"DTR",5:"STN",7:"DTB",8:"ST",9:"SE"},i=freeOnUnref(function(u){function e(){return null!==u&&u.apply(this,arguments)||this}return n(e,u),e.prototype.extractData=freeOnUnref(function(e,t,n,r){var i;n=u.prototype.extractData.call(this,e,t,n,r);var o=e.entries[0];if("dvhe"===n.fourCC||"dvh1"===n.fourCC||"hev1"===n.fourCC||"hvc1"===n.fourCC){if(null==(n=(new wb.HevcDataExtractor).extractData(e,t,n,r)))return c.error("HevcDataExtractor returned "+n+" trackInitInfo"),n;i=n;for(var a=void 0,s=0,l=["dvcC","dvvC"];s<l.length;s++){var f=l[s];if(null!=(a=Ao.Boxes.find(o,Ao.Boxes.ofType(f)))){i.codecType=this.buildCodecType(a);break}}return i}return n}),e.prototype.buildCodecType=freeOnUnref(function(e){return"VIDEO_CODEC_DVHE_"+this.getProfileString(e.profile)}),e.prototype.getProfileString=freeOnUnref(function(e){var t=r[e];if(null==t)throw new Error("Not supported DVHE profile "+e);return t}),e})(Cb.BaseVideoDataExtractor);t.DvheDataExtractor=i}));e(Ib);Ib.DvheDataExtractor;var kb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("BaseTextDataExtractor"),n=freeOnUnref(function(){function e(){}return e.prototype.extractData=freeOnUnref(function(e,t,n,r){return n.type!==Ub.TrackType.TEXT&&i.warn("Expected track type TEXT, but encountered "+Ub.TrackType[n.type]),n}),e})();t.BaseTextDataExtractor=n}));e(kb);kb.BaseTextDataExtractor;var _b=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a){void 0===e&&(e=Eb.AvcDataExtractor),void 0===t&&(t=Pb.Ac3DataExtractor),void 0===n&&(n=Mb.AacDataExtractor),void 0===r&&(r=Tb.Av1DataExtractor),void 0===i&&(i=wb.HevcDataExtractor),void 0===o&&(o=Ib.DvheDataExtractor),void 0===a&&(a=kb.BaseTextDataExtractor),this.extractorMap={},this.extractorMap["ac-3"]=this.extractorMap["ec-3"]=new t,this.extractorMap.avc1=new e,this.extractorMap.av01=new r,this.extractorMap.hev1=this.extractorMap.hvc1=new i,this.extractorMap.dvhe=new o,this.extractorMap.mp4a=new n,this.extractorMap.stpp=new a}return e.prototype.selectExtractor=freeOnUnref(function(e){return this.extractorMap[e]}),e})();t.CodecSpecificDataExtractorSelector=n}));e(_b);_b.CodecSpecificDataExtractorSelector;var Rb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var p=Ao.Boxes.fourCCToNumber("seig"),h=Ao.Boxes.fourCCToNumber("cenc"),n=freeOnUnref(function(){function e(e){void 0===e&&(e=new Ao.CencParser),this.cencParser=e}return e.prototype.processTrackInitInfo=freeOnUnref(function(e,t){var n=Ao.Boxes.getPath(t,"sinf[0]/schi[0]/tenc[0]");if(null==n)throw new Error("Track is protected with scheme "+e.protectionSchemeType.toString(16)+", but is missing the TENC box");var r=e.containerSpecificData;r.defaultIsEncrypted=n.defaultIsEncrypted,r.defaultIvSize=n.defaultIvSize,r.defaultKID=n.defaultKID}),e.prototype.processTrackMedia=freeOnUnref(function(e,t){for(var n=e.containerSpecificData,r=0,i=t.sampleRuns;r<i.length;r++)for(var o=0,a=i[r].samples;o<a.length;o++){var s=a[o],l=s.containerSpecificData,f=null!=l.groupInformation[p]?l.groupInformation[p].entry:null;if(null!=f?f.isEncrypted:n.defaultIsEncrypted){s.isEncrypted=!0;var u=void 0;u=null==f?{sessionId:"",keyId:n.defaultKID,ivSize:n.defaultIvSize,initializationVector:new Uint8Array(0),encryptedRegions:[]}:{sessionId:"",keyId:f.KID,ivSize:f.ivSize,initializationVector:new Uint8Array(0),encryptedRegions:[]},s.encryptionInfo=u;var c=l.auxiliaryInfos[h][0],d=this.cencParser.parseSampleAuxiliaryInfo(c,u.ivSize);u.initializationVector=d.initializationVector,0<d.entries.length?s.encryptionInfo.encryptedRegions=d.entries.map(freeOnUnref(function(e){return{bytesOfClearData:e.bytesOfClearData,bytesOfEncryptedData:e.bytesOfProtectedData}})):s.encryptionInfo.encryptedRegions.push({bytesOfClearData:0,bytesOfEncryptedData:s.data.byteLength})}}}),e})();t.CencProcessor=n}));e(Rb);Rb.CencProcessor;var Ab=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=["enca","encs","enct","encv"],i=((n={})[Ao.Boxes.fourCCToNumber("cenc")]=new Rb.CencProcessor,n),o=freeOnUnref(function(){function e(e){void 0===e&&(e=i),this.processorMap=e}return e.prototype.isProtectedTrack=freeOnUnref(function(e){return-1!==r.indexOf(e)}),e.prototype.processTrackInitInfo=freeOnUnref(function(e,t){if(this.isProtectedTrack(t.type)){var n=Ao.Boxes.find(t,Ao.Boxes.ofType("sinf"));if(null==n)throw new Error("Protected sample type "+t.type+' is missing the "sinf" box');var r=Ao.Boxes.find(n,Ao.Boxes.ofType("schm"));if(null==r)throw new Error("Protected sample type "+t.type+' is missing the "schm" box');var i=Ao.Boxes.find(n,Ao.Boxes.ofType("frma"));if(null==i)throw new Error("Protected sample type "+t.type+' is missing the "frma" box');e.fourCC=Ao.Boxes.numberToFourCC(i.dataFormat),e.protectionSchemeType=r.schemeType,null!=this.processorMap[e.protectionSchemeType]&&this.processorMap[e.protectionSchemeType].processTrackInitInfo(e,t)}}),e.prototype.processTrackMedia=freeOnUnref(function(e,t){null!=this.processorMap[e.protectionSchemeType]&&this.processorMap[e.protectionSchemeType].processTrackMedia(e,t)}),e})();t.ProtectedStreamProcessor=o}));e(Ab);Ab.ProtectedStreamProcessor;var Db=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("AuxiliaryInfoExtractor"),n=freeOnUnref(function(){function e(e,t,n,r,i){this.auxInfos={},this.data=e,this.moofAbsolutePosition=t,this.defaultAuxInfoType=n,this.saios=r;for(var o=0,a=this.saizs=i;o<a.length;o++){var s=a[o],l=null!=s.auxInfoType?s.auxInfoType:this.defaultAuxInfoType,f=null!=s.auxInfoTypeParameter?s.auxInfoTypeParameter:0,u=this.findMatchingOffsets(l,f);if(null==u)throw new Error("Could not find corresponding offset box!");null==this.auxInfos[l]&&(this.auxInfos[l]={}),this.auxInfos[l][f]={saio:u,saiz:s,start:-1}}this.currentRun=-1,this.globalSampleNumber=-1}return e.prototype.startTrackRun=freeOnUnref(function(){this.currentRun++;for(var e=0,t=this.saios;e<t.length;e++){var n=t[e];if(0===this.currentRun||1<n.offset.length){var r=null!=n.auxInfoType?n.auxInfoType:this.defaultAuxInfoType,i=null!=n.auxInfoTypeParameter?n.auxInfoTypeParameter:0;this.auxInfos[r][i].start=n.offset[this.currentRun]}}}),e.prototype.nextSample=freeOnUnref(function(){this.globalSampleNumber++;for(var e={},t=0,n=this.saizs;t<n.length;t++){var r=n[t];if(!(r.sampleCount<=this.globalSampleNumber)){var i=null!=r.auxInfoType?r.auxInfoType:this.defaultAuxInfoType,o=null!=r.auxInfoTypeParameter?r.auxInfoTypeParameter:0;if(null==this.auxInfos[i][o].saio)throw new Error("Could not find matching offset box!");var a=this.auxInfos[i][o].start;null==e[i]&&(e[i]={}),this.moofAbsolutePosition+a<0&&s.warn("[neguintarray] Negative offset for Uint8Array: moofAbsolutePosition: "+this.moofAbsolutePosition+" and auxInfoOffset: "+a),r.sampleInfoSize[this.globalSampleNumber]<0&&s.warn("[neguintarray] Negative size for Uint8Array: saiz.sampleInfoSize[this.globalSampleNumber]: "+r.sampleInfoSize[this.globalSampleNumber]),e[i][o]=new Uint8Array(this.data,this.moofAbsolutePosition+a,r.sampleInfoSize[this.globalSampleNumber]),this.auxInfos[i][o].start+=r.sampleInfoSize[this.globalSampleNumber]}}return e}),e.prototype.findMatchingOffsets=freeOnUnref(function(t,n){var r=this;return x.find(this.saios,freeOnUnref(function(e){return null!=e.auxInfoType?t===e.auxInfoType&&n===e.auxInfoTypeParameter:t===r.defaultAuxInfoType&&0===n}))}),e})();t.AuxiliaryInfoExtractor=n}));e(Db);Db.AuxiliaryInfoExtractor;var xb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.initGroups=e,this.mediaGroups=t,this.sbgps=n,this.currentSampleToGroupMap={};for(var r=0,i=this.sbgps;r<i.length;r++){var o=i[r];this.currentSampleToGroupMap[o.groupingType]={entryIndex:0,groupDescriptionIndex:o.entries[0].groupDescriptionIndex,remainingSamples:o.entries[0].sampleCount}}}return e.prototype.nextSample=freeOnUnref(function(){for(var e={},t=0,n=this.sbgps;t<n.length;t++){var r=n[t],i=r.groupingType,o=this.currentSampleToGroupMap[i];0===o.remainingSamples&&(o.entryIndex++,o.groupDescriptionIndex=r.entries[o.entryIndex].groupDescriptionIndex,o.remainingSamples=r.entries[o.entryIndex].sampleCount);r.entries[o.entryIndex];var a=null;65536<o.groupDescriptionIndex?a=this.mediaGroups[i].entries[o.groupDescriptionIndex-65537]:0<o.groupDescriptionIndex&&(a=this.initGroups[i].entries[o.groupDescriptionIndex-1]),null!==a&&(e[i]={parameter:r.groupingTypeParameters,entry:a}),o.remainingSamples--}return e}),e})();t.GroupDataExtractor=n}));e(xb);xb.GroupDataExtractor;var Fb=t(freeOnUnref(function(e,t){var ne=ce&&ce.__assign||freeOnUnref(function(){return(ne=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var re=de.get("MP4SegmentParser"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a){void 0===n&&(n=new Ao.BmffParser),void 0===r&&(r=new _b.CodecSpecificDataExtractorSelector),void 0===i&&(i=new Ab.ProtectedStreamProcessor),void 0===o&&(o=Db.AuxiliaryInfoExtractor),void 0===a&&(a=xb.GroupDataExtractor),this.mimeTypeParameters=e,this.parser=n,this.codecDataExtractorSelector=r,this.protectedStreamProcessor=i,this.auxiliaryInfoExtractorType=o,this.groupDataExtractorType=a,this.codecs=this.validateCodecs(t)}return e.prototype.parse=freeOnUnref(function(t,e){for(var n=[],r=this.parser.parseBoxes(t),i=0,o=r.boxes;i<o.length;i++){var a=o[i],s=void 0,l=void 0;if("moov"===a.type)s=this.parseInitSegment(r,a),l=Ao.Boxes.all(a,Ao.Boxes.ofType("pssh")),e=s,n.push(s);else{if("moof"!==a.type)continue;if(null==e)throw new Error("Received media segment but did not receive first initialization segment");s=this.parseMediaSegment(e,r,t,a),l=Ao.Boxes.all(a,Ao.Boxes.ofType("pssh")),n.push(s)}for(var f=[],u=0,c=l;u<c.length;u++){var d=c[u],p=x.last(f);null!=p&&p.end===d.absoluteStartPosition?p.end+=d.size:f.push({start:d.absoluteStartPosition,end:d.absoluteStartPosition+d.size})}s.initializationDatas=f.map(freeOnUnref(function(e){return{type:"cenc",data:new Uint8Array(t.slice(e.start,e.end))}}))}return n}),e.prototype.parseInitSegment=freeOnUnref(function(e,t){var n,r={},i=Ao.Boxes.find(t,Ao.Boxes.ofType("mvhd"));if(null==i)throw new Error("Segment is missing the MVHD box");var o=Ao.Boxes.all(t,Ao.Boxes.ofType("trak"));if(0===o.length)throw new Error("Segment is missing the TRAK box");for(var a=0,s=o;a<s.length;a++){var l=s[a],f=Ao.Boxes.find(l,Ao.Boxes.ofType("tkhd"));if(null==f)throw new Error("Segment is missing the TKHD box");var u=f.trackId,c=Ao.Boxes.find(l,Ao.Boxes.ofType("mdia"));if(null==c)throw new Error("Segment is missing the MDIA box");var d=Ao.Boxes.find(c,Ao.Boxes.ofType("mdhd"));if(null==d)throw new Error("Segment is missing the MDHD box");var p=Ao.Boxes.find(c,Ao.Boxes.ofType("minf"));if(null==p)throw new Error("Segment is missing the MINF box");var h=d.timescale,m=Ao.Boxes.find(c,Ao.Boxes.ofType("hdlr"));if(null==m)throw new Error("Segment is missing the HDLR box");var y=void 0;if(m.handlerType===Ao.Boxes.fourCCToNumber("soun"))y=Ub.TrackType.AUDIO;else if(m.handlerType===Ao.Boxes.fourCCToNumber("vide"))y=Ub.TrackType.VIDEO;else{if(m.handlerType!==Ao.Boxes.fourCCToNumber("subt"))throw new Error("Unknown track type "+m.handlerType);y=Ub.TrackType.TEXT}var g=Ao.Boxes.find(p,Ao.Boxes.ofType("stbl"));if(null==g)throw new Error("Segment is missing the STBL box");var v=Ao.Boxes.find(g,Ao.Boxes.ofType("stsd"));if(null==v)throw new Error("Segment is missing the STSD box");var O={defaultSampleFlags:0,defaultSampleDuration:0,defaultSampleSize:0,defaultSampleDescriptionIndex:0,isProtected:!1,groups:{}},S=void 0;if(0<v.entryCount)S=v.entries[0].type;else{if(y!==Ub.TrackType.TEXT)throw new Error("Unable to determine a fourCC");S=this.codecs[0]}var U={type:y,trackId:u,timescale:h,fourCC:S,codecType:"",containerSpecificData:O,baseSample:{timescale:h},codecSpecificData:new Uint8Array(0),durationSeconds:f.duration/h};this.protectedStreamProcessor.isProtectedTrack(U.fourCC)&&(O.isProtected=!0,this.protectedStreamProcessor.processTrackInitInfo(U,v.entries[0])),x.find(this.codecs,U.fourCC)&&re.warn('FourCC from segment is "'+U.fourCC+'", but got "'+this.codecs+'" from MIME type');var b=this.codecDataExtractorSelector.selectExtractor(U.fourCC);if(null==b)throw new Error('Encountered unknown codec fourCC "'+U.fourCC+'"');U=b.extractData(v,f,U,this.mimeTypeParameters);var P=Ao.Boxes.all(g,Ao.Boxes.ofType("sgpd"));if(null!=P)for(var M=0,C=P;M<C.length;M++){var E=C[M];O.groups[E.groupingType]=E}r[u]=U}var T=Ao.Boxes.find(t,Ao.Boxes.ofType("mvex"));if(null==T)throw new Error("Segment is missing the MVEX box");var w=Ao.Boxes.find(T,Ao.Boxes.ofType("mehd"));null!=w&&(n=w.fragmentDuration);var I=Ao.Boxes.all(T,Ao.Boxes.ofType("trex"));if(0===I.length)throw new Error("Segment is missing the TREX box");for(var k=0,_=I;k<_.length;k++){var R=_[k];if(null==r[R.trackId])throw new Error("Track "+R.trackId+" does not exist on TRAK box but exists on TREX box");var A=r[R.trackId].containerSpecificData;A.defaultSampleDuration=R.defaultSampleDuration;var D=R.defaultSampleFlags;r[R.trackId].type===Ub.TrackType.VIDEO&&null!=D&&(D|=65536),A.defaultSampleFlags=D,A.defaultSampleSize=R.defaultSampleSize,A.defaultSampleDescriptionIndex=R.defaultSampleDescriptionIndex,r[R.trackId].baseSample.duration=A.defaultSampleDuration}return{type:"init",totalDurationSec:null!=n?n/i.timescale:void 0,tracks:r,containerSpecificData:null,initializationDatas:[]}}),e.prototype.parseMediaSegment=freeOnUnref(function(e,t,n,r){var i={},o=Ao.Boxes.all(r,Ao.Boxes.ofType("traf"));if(0===o.length)throw new Error("Missing TRAF box in media segment");for(var a=0;a<o.length;a++){var s=this.parseMediaTrack(e,t,n,r,a,o.length,o[a]);i[s.trackId]=s}return{type:"media",tracks:i,containerSpecificData:null,initializationDatas:[]}}),e.prototype.parseMediaTrack=freeOnUnref(function(e,t,n,r,i,o,a){var s=Ao.Boxes.find(a,Ao.Boxes.ofType("tfhd")),l=Ao.Boxes.find(a,Ao.Boxes.ofType("tfdt")),f=Ao.Boxes.all(a,Ao.Boxes.ofType("trun"));if(null==s)throw new Error('Missing "tfhd" box for track entry '+i);if((1!==o||s.baseDataOffsetPresent)&&!s.defaultBaseIsMoof)throw new Error("Movie fragment is not using movie-fragment relative addressing: track "+s.trackId+" has a baseDataOffset");var u=e.tracks[s.trackId],c=u.containerSpecificData;if(null==u)throw new Error("Track "+s.trackId+" on media segment does not exist in the last init segment.");if(null==l)throw new Error('Missing "tfdt" box for track '+s.trackId);if(0===f.length)throw new Error('No "trun" boxes for track '+s.trackId);for(var d=f.reduce(freeOnUnref(function(e,t){return e+t.samples.length}),0),p=Ao.Boxes.all(a,Ao.Boxes.ofType("saio")),h=0,m=p;h<m.length;h++){var y=m[h];if(1!==y.entryCount&&y.entryCount!==f.length)throw new Error("Sample Auxiliary Info Offsets box with type  "+y.auxInfoType+"-"+y.auxInfoTypeParameter+" has "+y.entryCount+" entries, but there are "+f.length+" trun boxes.")}for(var g=Ao.Boxes.all(a,Ao.Boxes.ofType("saiz")),v=0,O=g;v<O.length;v++){var S=O[v];if(S.sampleCount>d)throw new Error("Sample Auxiliary Info Sizes box with type "+S.auxInfoType+"-"+S.auxInfoTypeParameter+" has "+S.sampleCount+" samples, but total samples in fragment is "+d)}for(var U=Ao.Boxes.all(a,Ao.Boxes.ofType("sbgp")),b=0,P=U;b<P.length;b++){var M=P[b],C=M.entries.reduce(freeOnUnref(function(e,t){return e+t.sampleCount}),0);if(C!==d)throw new Error("Sample-to-Group box with groupingType "+M.groupingType+" has "+C+" samples, but total samples in fragment is "+d)}var E={groups:{}},T=Ao.Boxes.all(a,Ao.Boxes.ofType("sgpd"));if(null!=T)for(var w=0,I=T;w<I.length;w++){var k=I[w];E.groups[k.groupingType]=k}for(var _=l.baseMediaDecodeTime,R=null!=u.protectionSchemeType?u.protectionSchemeType:Ao.Boxes.fourCCToNumber(u.fourCC),A=new this.auxiliaryInfoExtractorType(n,r.absoluteStartPosition,R,p,g),D=new this.groupDataExtractorType(c.groups,E.groups,U),x=0,F=[],B=0;B<f.length;B++){A.startTrackRun();var L=f[B];if(0===B&&null==L.dataOffset)throw new Error("Movie fragment is not using movie-fragment relative addressing: first trun for track "+s.trackId+" does not have a dataOffset");null!=L.dataOffset&&(x=L.dataOffset);for(var N=[],V=s.defaultSampleSizePresent?s.defaultSampleSize:c.defaultSampleSize,j=s.defaultSampleDurationPresent?s.defaultSampleDuration:c.defaultSampleDuration,q=L.samples,H=0;H<q.length;H++){var z=q[H],W=void 0;null!=z.flags?W=z.flags:0===H&&null!=L.firstSampleFlags?W=L.firstSampleFlags:s.defaultSampleFlagsPresent?(W=s.defaultSampleFlags,u.type===Ub.TrackType.VIDEO&&(W|=65536)):W=c.defaultSampleFlags;var K=null!=z.size?z.size:V,G=null!=z.duration?z.duration:j,Q=_,X=Q+(null!=z.compositionTimeOffset?z.compositionTimeOffset:0),Y=r.absoluteStartPosition+x;Y<0&&re.warn("[neguintarray] Creating a Uint8Array with negative offset: sampleStart is "+Y),K<0&&re.warn("[neguintarray] Create a Uint8Array with negative size: size is "+K);var J=new Uint8Array(n,Y,K),Z=A.nextSample(),$=D.nextSample(),ee=ne({},u.baseSample,{dts:Q,pts:X,isRandomAccessPoint:this.isRandomAccessPoint(W),duration:G,isCodecPrivateData:!1,data:J,isEncrypted:!1,containerSpecificData:{auxiliaryInfos:Z,groupInformation:$}});N.push(ee),_+=G,x+=K}F.push({samples:N})}var te={trackId:s.trackId,containerSpecificData:E,sampleRuns:F};return c.isProtected&&this.protectedStreamProcessor.processTrackMedia(u,te),te}),e.prototype.validateCodecs=freeOnUnref(function(e){if(x.isEmpty(e))throw new Error('Required parameter "codecs" is empty');for(var t=0,n=e;t<n.length;t++){var r=n[t];if(null==this.codecDataExtractorSelector.selectExtractor(r))throw new Error('Encountered unknown codec fourCC "'+r+'"')}return e}),e.prototype.isRandomAccessPoint=freeOnUnref(function(e){return 0==(16842752&e)}),e})();t.MP4SegmentParser=n}));e(Fb);Fb.MP4SegmentParser;var Bb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=Fb.MP4SegmentParser),this.mp4SegmentParserType=e}return e.prototype.createSegmentParser=freeOnUnref(function(e){var t=this.extractCodecs(e.parameters.codecs);switch(e.subtype){case"mp4":return new this.mp4SegmentParserType(e.parameters,t);default:return null}}),e.prototype.extractCodecs=freeOnUnref(function(e){return null==e?[]:e.split(",").map(freeOnUnref(function(e){return e.trim().substring(0,4)}))}),e})();t.SegmentParserFactory=n}));e(Bb);Bb.SegmentParserFactory;var Lb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TrackType=Ub.TrackType,t.SegmentParserFactory=Bb.SegmentParserFactory}));e(Lb);Lb.TrackType,Lb.SegmentParserFactory;var Nb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){void 0===e&&(e=new In.NumberLine),this.ranges=e}return Object.defineProperty(e.prototype,"length",{get:freeOnUnref(function(){return this.ranges.getIntervals().length}),enumerable:!0,configurable:!0}),e.prototype.start=freeOnUnref(function(e){var t=this.ranges.getIntervals();if(e>=t.length)throw ct.Errors.newError("IndexSizeError","Index "+e+" is out of range");return t[e].start}),e.prototype.end=freeOnUnref(function(e){var t=this.ranges.getIntervals();if(e>=t.length)throw ct.Errors.newError("IndexSizeError","Index "+e+" is out of range");return t[e].end}),Object.defineProperty(e.prototype,"numberLine",{get:freeOnUnref(function(){return this.ranges}),set:freeOnUnref(function(e){this.ranges=e}),enumerable:!0,configurable:!0}),e})();t.JSTimeRanges=n}));e(Nb);Nb.JSTimeRanges;var Vb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var v=de.get("TrackBuffer"),O=-20,S=40,n=freeOnUnref(function(){function e(e){this.timescale=1e6,this.buffered=new Nb.JSTimeRanges,this.diagnostics=nn.Diagnostics.create("TrackBuffer"),this.eventEmitter=new A.EventEmitter,this.index=[],this.isEnded=!1,this.needsRandomAccessPoint=!0,this.state={addedSamples:!1,lastProcessedSampleDuration:null,lastProcessedSamplePTS:null,replacedSamples:!1,sampleGroupsCount:0,timestamp:Date.now(),trackInfo:null},this.type=e,this.driftTicks=0,this.discardedSamples=[]}return Object.defineProperty(e.prototype,"trackInitInfo",{get:freeOnUnref(function(){return this.trackInfo}),set:freeOnUnref(function(e){this.trackInfo=e,this.state.trackInfo=e,this.needsRandomAccessPoint=!0}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"streamEnded",{get:freeOnUnref(function(){return this.isEnded}),set:freeOnUnref(function(e){this.isEnded=e,this.eventEmitter.emit("sampleAdded")}),enumerable:!0,configurable:!0}),e.prototype.addSamples=freeOnUnref(function(e,t,n,r){var d=this,p=Math.floor(n*this.timescale),h=Math.ceil(r*this.timescale),m=Math.round(t*this.timescale),y=!1,g=!1;return this.type===Lb.TrackType.AUDIO&&v.enabledFor(de.DEBUG),e.forEach(freeOnUnref(function(e,t){var n=e.dts,r=e.pts,i=e.timescale;if(e.dts=d.getAdjustedTicks(e.dts),e.pts=d.getAdjustedTicks(e.pts),e.duration=d.getAdjustedTicks(e.duration+r)-e.pts,e.timescale=1e6,e.pts+=m,e.dts+=m,e.pts+e.duration<p)return v.warn("Dropping "+Lb.TrackType[d.type]+" sample with pts "+e.pts+" and end pts "+(e.pts+e.duration)+" -- it ends before the start of the append window "+p+". TimestampOffsetTicks:"+m+". RawSample: dts="+n+",pts:"+r+",timescale:"+i+"; TrackInfo.timescale="+d.trackInfo.timescale),d.needsRandomAccessPoint=!0,void(e.isRandomAccessPoint&&d.discardedSamples.push(e));if(e.pts>h)return v.warn("Dropping "+Lb.TrackType[d.type]+" sample with pts "+e.pts+" -- it starts after the end of the append window "+h),d.needsRandomAccessPoint=!0,void(e.isRandomAccessPoint&&d.discardedSamples.push(e));if(e.pts+=d.driftTicks,e.dts+=d.driftTicks,d.needsRandomAccessPoint){if(!e.isRandomAccessPoint)return void v.warn("Dropping "+Lb.TrackType[d.type]+" sample with pts "+e.pts+" -- We need a random access point sample.");d.needsRandomAccessPoint=!1}var o=x.last(d.index);if(e.isRandomAccessPoint&&null!=o&&null!=o.baseSample){var a=o.endPTS-e.pts;if(1===Math.abs(a)&&(e.pts+=a,e.duration-=a,a=0),d.type===Lb.TrackType.VIDEO)d.driftTicks+=a,0<Math.abs(a)&&v.error("Video gap/overlap detected! New sample has pts of "+e.pts+" but last sample (in presentation order) has an end pts of "+o.endPTS+". THIS WILL CAUSE A/V SYNC ISSUES!!! Current drift is "+d.driftTicks+" ticks"),e.pts+=a,e.dts+=a;else if(d.type===Lb.TrackType.AUDIO)if(a<0){for(var s=o.endPTS;a<0&&0<d.discardedSamples.length;){var l=d.discardedSamples.shift(),f=s-l.pts;l.pts+=f,l.dts+=f,d.addOneSample(l),s=l.pts+l.duration,a+=l.duration}d.driftTicks+=a,e.pts+=a,e.dts+=a,d.driftTicks<O*d.timescale/1e3&&v.error("Audio is now leading video by "+1e3*d.driftTicks/d.timescale+"ms, which is above the detectability threshold of "+O+"ms")}else{if(null!=o&&null!=o.baseSample&&e.pts+e.duration<=o.endPTS){var u=d.findGroupForPosition(e.pts);return void(-1!==u?d.index[u].startPTS===e.pts&&d.index[u].endPTS===e.pts+e.duration?(v.enabledFor(de.DEBUG),d.replaceAudioSample(e,d.index[u]),g=!0,d.state.lastProcessedSamplePTS=e.pts,d.state.lastProcessedSampleDuration=e.duration):v.warn("Dropping the "+t+"th sample to be replaced due to startPTS "+e.pts+" or endPTS "+(e.pts+e.duration)+" do not exact match."):v.warn("Dropping the "+t+"th sample to be replaced due to startPTS "+e.pts+" is smaller than the first sample group startPTS "+d.index[0].startPTS+"."))}var c=d.driftTicks;if(d.driftTicks+=a,0<a&&v.info("Audio drift increase: "+c+" ("+1e3*c/d.timescale+"ms) -> "+d.driftTicks+" ("+1e3*d.driftTicks/d.timescale+"ms)"),d.driftTicks>=e.duration)return d.driftTicks-=e.duration,d.discardedSamples.push(e),void v.warn("Dropped sample at "+e.pts+" with duration "+e.duration+". Drift is now "+1e3*d.driftTicks/d.timescale+"ms");d.driftTicks>S*d.timescale/1e3&&v.error("Audio is now lagging video by "+1e3*d.driftTicks/d.timescale+"ms, which is above the detectability threshold of "+S+"ms"),e.pts+=a,e.dts+=a}}d.addOneSample(e),y=!0,d.state.lastProcessedSamplePTS=e.pts,d.state.lastProcessedSampleDuration=e.duration})),y&&(this.discardedSamples=[],this.eventEmitter.emitSync("sampleAdded")),this.state.addedSamples=y,this.state.replacedSamples=g,this.reportDiagnostics(),y}),e.prototype.addOneSample=freeOnUnref(function(e){var t={sample:e,initInfo:this.trackInfo,next:null,prev:null,isReplacedSample:!1},n=x.last(this.index),r=null!=n?n.lastDecodeSample:null;!e.isRandomAccessPoint||null!=n&&null==n.baseSample||(n={initInfo:this.trackInfo,startPTS:e.pts,endPTS:e.pts+e.duration,baseSample:t,lastDecodeSample:t},this.index.push(n)),null!=r&&((r.next=t).prev=r),n.lastDecodeSample=t,e.pts+e.duration>n.endPTS&&(n.endPTS=e.pts+e.duration),this.buffered.numberLine.add({start:e.pts/e.timescale,end:(e.pts+e.duration)/e.timescale})}),e.prototype.replaceAudioSample=freeOnUnref(function(e,t){t.baseSample.sample=e,t.lastDecodeSample.sample=e,t.baseSample.isReplacedSample=!0,t.lastDecodeSample.isReplacedSample=!0}),e.prototype.remove=freeOnUnref(function(e,t){if(!x.isEmpty(this.index)){var n=Math.max(e*this.timescale/1e3,x.first(this.index).startPTS),r=Math.min(t*this.timescale/1e3,x.last(this.index).endPTS),i={startTicks:n,endTicks:r};if(!(r<=n)){var o=this.findGroupForPosition(n);if(-1!==o){if(this.index[o].baseSample.sample.pts+this.index[o].baseSample.sample.duration<n){for(var a=this.index[o].baseSample,s=a.next,l=a.sample.pts+s.sample.duration;null!==s&&s.sample.pts+s.sample.duration<n;)s.sample.pts+s.sample.duration>l&&(l=a.sample.pts+s.sample.duration),s=(a=s).next;this.index[o].lastDecodeSample=a,this.index[o].endPTS=l;for(var f=o+1<this.index.length?this.index[o+1].baseSample:null;s!==f;)s.prev&&(s.prev.next=null),this.buffered.numberLine.remove({start:s.sample.pts/s.sample.timescale,end:(s.sample.pts+s.sample.duration)/s.sample.timescale}),i.startTicks=Math.min(i.startTicks,s.sample.pts),i.endTicks=Math.max(i.endTicks,s.sample.pts+s.sample.duration),s=s.next;null!=f&&(f.prev=null),o++}for(var u=o;u<this.index.length&&this.index[u].startPTS<r;){var c=this.index[u];this.buffered.numberLine.remove({start:c.startPTS/this.timescale,end:c.endPTS/this.timescale}),i.startTicks=Math.min(i.startTicks,c.startPTS),i.endTicks=Math.max(i.endTicks,c.endPTS),u++}0<o&&o<this.index.length&&(this.index[o-1].lastDecodeSample.next=null),u<this.index.length&&(this.index[u].baseSample.prev=null);for(var d=o;d<u;d++){for(s=(c=this.index[d]).baseSample;null!=s.prev&&(s.prev.next=null,s.prev=null),s!==c.lastDecodeSample;)s=s.next;null!=s.next&&(s.next.prev=null,s.next=null)}this.index.splice(o,u-o),0===this.index.length&&(this.driftTicks=0),this.eventEmitter.emit("samplesRemoved",i)}else v.warn("Removal start not in buffer. Ignoring entire removal.")}}}),e.prototype.getSampleAt=freeOnUnref(function(e){var t=Math.floor(e*this.timescale/1e3),n=this.findGroupForPosition(t);return-1!==n?this.index[n].baseSample:null}),e.prototype.getNextSample=freeOnUnref(function(e){return e.next}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.findGroupForPosition=freeOnUnref(function(t){return Pn.binarySearchIndexOf(this.index,freeOnUnref(function(e){return t<e.startPTS?-1:t>=e.endPTS?1:0}))}),e.prototype.getAdjustedTicks=freeOnUnref(function(e){return Math.round(e*this.timescale/this.trackInfo.timescale)}),e.prototype.reportDiagnostics=freeOnUnref(function(){this.state.timestamp=Date.now(),this.state.sampleGroupsCount=x.size(this.index),0<this.state.sampleGroupsCount&&(this.state.sampleGroupsStartPTS=x.first(this.index).startPTS,this.state.sampleGroupsEndPTS=x.last(this.index).endPTS),this.diagnostics.report("state",this.state)}),e})();t.TrackBuffer=n}));e(Vb);Vb.TrackBuffer;var jb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i){this.trackId=e,this.trackLabel=t,this.trackLanguage=n,this.trackKind=r,this.trackSourceBuffer=i}return Object.defineProperty(e.prototype,"id",{get:freeOnUnref(function(){return this.trackId}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kind",{get:freeOnUnref(function(){return this.trackKind}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:freeOnUnref(function(){return this.trackLabel}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:freeOnUnref(function(){return this.trackLanguage}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceBuffer",{get:freeOnUnref(function(){return this.trackSourceBuffer}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:freeOnUnref(function(){return!0}),set:freeOnUnref(function(e){}),enumerable:!0,configurable:!0}),e})();t.JSAudioTrack=n}));e(jb);jb.JSAudioTrack;var qb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i){this.DISABLED=0,this.ERROR=1,this.HIDDEN=2,this.LOADED=3,this.LOADING=4,this.NONE=5,this.SHOWING=6,this.trackId=e,this.trackLabel=t,this.trackLanguage=n,this.trackKind=r,this.trackSourceBuffer=i}return Object.defineProperty(e.prototype,"id",{get:freeOnUnref(function(){return this.trackId}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kind",{get:freeOnUnref(function(){return this.trackKind}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:freeOnUnref(function(){return this.trackLabel}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:freeOnUnref(function(){return this.trackLanguage}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceBuffer",{get:freeOnUnref(function(){return this.trackSourceBuffer}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:freeOnUnref(function(){return!1}),set:freeOnUnref(function(e){}),enumerable:!0,configurable:!0}),e.prototype.addCue=freeOnUnref(function(e){}),e.prototype.removeCue=freeOnUnref(function(e){}),e.prototype.addEventListener=freeOnUnref(function(e,t,n){}),e.prototype.dispatchEvent=freeOnUnref(function(e){return!1}),e.prototype.removeEventListener=freeOnUnref(function(e,t,n){}),e})();t.JSTextTrack=n}));e(qb);qb.JSTextTrack;var Hb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("JSVideoTrack"),r=freeOnUnref(function(){function e(e,t,n,r,i){this.trackId=e,this.trackLabel=t,this.trackLanguage=n,this.trackKind=r,this.trackSourceBuffer=i,this.changeCallback=new A.MulticastCallback}return Object.defineProperty(e.prototype,"id",{get:freeOnUnref(function(){return this.trackId}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kind",{get:freeOnUnref(function(){return this.trackKind}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:freeOnUnref(function(){return this.trackLabel}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:freeOnUnref(function(){return this.trackLanguage}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceBuffer",{get:freeOnUnref(function(){return this.trackSourceBuffer}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:freeOnUnref(function(){return n.info("Video track "+this.trackId+" is currently "+(this.isSelected?"":"in")+"active"),this.isSelected}),set:freeOnUnref(function(e){n.info("Video track "+this.trackId+" is now "+(e?"":"in")+"active"),this.isSelected=!0,this.changeCallback.invoke(this)}),enumerable:!0,configurable:!0}),e.prototype.onChange=freeOnUnref(function(e){this.changeCallback.add(e)}),e.prototype.offChange=freeOnUnref(function(e){this.changeCallback.remove(e)}),e})();t.JSVideoTrack=r}));e(Hb);Hb.JSVideoTrack;var zb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){var r=this;this.eventEmitter=new A.EventEmitter,this.addEventListener=freeOnUnref(function(e,t,n){r.eventEmitter.on(e,t)}),this.dispatchEvent=freeOnUnref(function(e){return r.eventEmitter.emitSync(e.type,e),!0}),this.removeEventListener=freeOnUnref(function(e,t,n){r.eventEmitter.off(e,t)}),this.getTextTrackById=freeOnUnref(function(e){for(var t=0;t<r.wrappedValue.length;t++)if(r.wrappedValue[t].id===e)return r.wrappedValue[t];return null}),this.wrappedValue={length:0,getTrackById:this.getTextTrackById,item:null,addEventListener:this.addEventListener,removeEventListener:this.removeEventListener,dispatchEvent:this.dispatchEvent,onaddtrack:null,onchange:null,onremovetrack:null}}return e.prototype.add=freeOnUnref(function(e){this.wrappedValue[this.wrappedValue.length]=e,this.wrappedValue.length++,this.eventEmitter.emit("addtrack",{type:"addtrack",track:e})}),e.prototype.remove=freeOnUnref(function(e){for(var t=null,n=0;n<this.wrappedValue.length;n++)if(this.wrappedValue[n]===e){t=n;break}null!==t&&(Array.prototype.splice.call(this.wrappedValue,t,1),this.eventEmitter.emit("removetrack",{type:"removetrack",track:e}))}),e.prototype.getTrackList=freeOnUnref(function(){return this.wrappedValue}),e})();t.TextTrackListWrapper=n}));e(zb);zb.TextTrackListWrapper;var Wb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){var r=this;this.eventEmitter=new A.EventEmitter,this.getTrackById=freeOnUnref(function(e){return null}),this.addEventListener=freeOnUnref(function(e,t,n){r.eventEmitter.on(e,t)}),this.dispatchEvent=freeOnUnref(function(e){return r.eventEmitter.emitSync(e.type,e),!0}),this.removeEventListener=freeOnUnref(function(e,t,n){r.eventEmitter.off(e,t)}),this.trackChanged=freeOnUnref(function(e){}),this.wrappedValue={length:0,getTrackById:this.getTrackById,item:null,addEventListener:this.addEventListener,removeEventListener:this.removeEventListener,dispatchEvent:this.dispatchEvent,selectedIndex:null,onaddtrack:null,onchange:null,onremovetrack:null}}return e.prototype.add=freeOnUnref(function(e){e.onChange(this.trackChanged),this.wrappedValue[this.wrappedValue.length]=e,this.wrappedValue.length++,this.eventEmitter.emit("addtrack",{type:"addtrack",track:e})}),e.prototype.remove=freeOnUnref(function(e){for(var t=null,n=0;n<this.wrappedValue.length;n++)if(this.wrappedValue[n]===e){t=n;break}null!==t&&(Array.prototype.splice.call(this.wrappedValue,t,1),e.offChange(this.trackChanged),this.eventEmitter.emit("removetrack",{type:"removetrack",track:e}))}),e.prototype.getTrackList=freeOnUnref(function(){return this.wrappedValue}),e})();t.VideoTrackListWrapper=n}));e(Wb);Wb.VideoTrackListWrapper;var Kb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("JSSourceBuffer"),r=freeOnUnref(function(){function e(e,t,n){var r;void 0===n&&(n=oe.timer),this.trackBuffers={},this.eventEmitter=new A.EventEmitter,this.isUpdating=!1,this.bufferAppendImmediate=null,this.audioTrackListWrapper=new Sb.AudioTrackListWrapper,this.videoTrackListWrapper=new Wb.VideoTrackListWrapper,this.textTrackListWrapper=new zb.TextTrackListWrapper,this.appendWindowEndSec=1/0,this.appendWindowStartSec=0,this.timestampOffsetSec=0,this.trackCountPerType=((r={})[Lb.TrackType.AUDIO]=0,r[Lb.TrackType.TEXT]=0,r[Lb.TrackType.VIDEO]=0,r),this.cachedBufferedRanges=null,this.mediaSource=e,this.timer=n;var i=new Lb.SegmentParserFactory;if(this.segmentParser=i.createSegmentParser(t),null==this.segmentParser)throw ct.Errors.newError("NotSupportedError",'Unsupported MIME type "'+t.type+"/"+t.subtype+'"')}return Object.defineProperty(e.prototype,"appendWindowEnd",{get:freeOnUnref(function(){return this.appendWindowEndSec}),set:freeOnUnref(function(e){if(null==this.mediaSource)throw ct.Errors.newError("InvalidStateError","SourceBuffer was removed from parent media source");if(this.isUpdating)throw ct.Errors.newError("InvalidStateError","SourceBuffer is currently updating");if(isNaN(e))throw new TypeError("Invalid value for appendWindowEnd: NaN");if(e<=this.appendWindowStartSec)throw new TypeError("Invalid value for appendWindowEnd: "+e);this.appendWindowEndSec=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appendWindowStart",{get:freeOnUnref(function(){return this.appendWindowStartSec}),set:freeOnUnref(function(e){if(null==this.mediaSource)throw ct.Errors.newError("InvalidStateError","SourceBuffer was removed from parent media source");if(this.isUpdating)throw ct.Errors.newError("InvalidStateError","SourceBuffer is currently updating");if(e<0||e>=this.appendWindowEndSec)throw new TypeError("Invalid value for appendWindowStart: "+e);this.appendWindowStartSec=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioTracks",{get:freeOnUnref(function(){return this.audioTrackListWrapper.getTrackList()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:freeOnUnref(function(){if(null==this.mediaSource)throw ct.Errors.newError("InvalidStateError","SourceBuffer was removed from parent media source");if(this.cachedBufferedRanges)return this.cachedBufferedRanges;for(var e=-1,t=0,n=x.values(this.trackBuffers);t<n.length;t++){0<(a=n[t]).buffered.length&&(e=Math.max(e,a.buffered.end(a.buffered.length-1)))}if(-1===e)return new Nb.JSTimeRanges;var r=new In.NumberLine;r.add({start:0,end:e});for(var i=0,o=x.values(this.trackBuffers);i<o.length;i++){var a;if((a=o[i]).type!==Lb.TrackType.TEXT){var s=a.buffered.numberLine;"ended"===this.mediaSource.readyState&&(s=s.clone()).extendTo(e),r=r.intersection(s)}}return new Nb.JSTimeRanges(r)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:freeOnUnref(function(){return"segments"}),set:freeOnUnref(function(e){}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textTracks",{get:freeOnUnref(function(){return this.textTrackListWrapper.getTrackList()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timestampOffset",{get:freeOnUnref(function(){return this.timestampOffsetSec}),set:freeOnUnref(function(e){if(null==this.mediaSource)throw ct.Errors.newError("InvalidStateError","SourceBuffer was removed from parent media source");if(this.isUpdating)throw ct.Errors.newError("InvalidStateError","SourceBuffer is currently updating");"ended"===this.mediaSource.readyState&&this.mediaSource.setOpen(),this.timestampOffsetSec=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updating",{get:freeOnUnref(function(){return this.isUpdating}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoTracks",{get:freeOnUnref(function(){return this.videoTrackListWrapper.getTrackList()}),enumerable:!0,configurable:!0}),e.prototype.abort=freeOnUnref(function(){if(null==this.mediaSource)throw ct.Errors.newError("InvalidStateError","SourceBuffer was removed from parent media source");if("open"!==this.mediaSource.readyState)throw ct.Errors.newError("InvalidStateError","Parent media source is not open");if(this.isUpdating&&null===this.bufferAppendImmediate)throw ct.Errors.newError("InvalidStateError","Cannot abort a remove operation");this.isUpdating&&(this.timer.clearImmediate(this.bufferAppendImmediate),this.bufferAppendImmediate=null,this.updateAborted()),this.appendWindowStartSec=0,this.appendWindowEndSec=1/0}),e.prototype.appendBuffer=freeOnUnref(function(e){var t=this;if(null==this.mediaSource||!this.mediaSource.containsSourceBuffer(this))throw ct.Errors.newError("InvalidStateError","SourceBuffer was removed from parent media source");if(this.updating)throw ct.Errors.newError("InvalidStateError","SourceBuffer is updating");if(null!=this.mediaSource.mediaPlayerBridge.error)throw ct.Errors.newError("InvalidStateError","The error attribute of the HTMLMediaElement is not null");if("ended"===this.mediaSource.readyState&&this.mediaSource.setOpen(),this.evictFrames(),this.isBufferFull())throw ct.Errors.newError("QuotaExceededError","The source buffer is full");this.inputBuffer=e,this.updateStart(),this.timer.setImmediate(freeOnUnref(function(){try{t.bufferAppend()}catch(e){t.appendError("Error when processing append: "+e)}}))}),e.prototype.appendStream=freeOnUnref(function(e,t){}),e.prototype.remove=freeOnUnref(function(n,r){var i=this;if(null==this.mediaSource||!this.mediaSource.containsSourceBuffer(this))throw ct.Errors.newError("InvalidStateError","SourceBuffer was removed from parent media source");if(this.updating)throw ct.Errors.newError("InvalidStateError","SourceBuffer is updating");var e=this.mediaSource.duration;if(isNaN(e))throw ct.Errors.newError("TypeError","Media duration was never set");if(n<0||e<n)throw ct.Errors.newError("TypeError","startSec ("+n+") must be inside range [0, "+e+"]");if(isNaN(r)||r<=n)throw ct.Errors.newError("TypeError","endSec ("+r+") must be a number greater than startSec ("+n+")");"ended"===this.mediaSource.readyState&&this.mediaSource.setOpen(),this.updateStart(),this.timer.setImmediate(freeOnUnref(function(){try{for(var e=0,t=x.values(i.trackBuffers);e<t.length;e++){t[e].remove(1e3*n,1e3*r)}i.updateEnd()}catch(e){i.appendError("Error when processing range removal: "+e)}}))}),e.prototype.addEventListener=freeOnUnref(function(e,t,n){this.eventEmitter.on(e,t)}),e.prototype.dispatchEvent=freeOnUnref(function(e){return this.eventEmitter.emitSync(e.type,e),!0}),e.prototype.removeEventListener=freeOnUnref(function(e,t,n){this.eventEmitter.off(e,t)}),e.prototype.getTrackBuffer=freeOnUnref(function(e){return this.trackBuffers[e]}),e.prototype.bufferAppend=freeOnUnref(function(){var e;try{e=this.segmentParser.parse(this.inputBuffer,this.lastInitSegment)}catch(e){return void this.appendError("Failed to parse segment: "+e)}this.inputBuffer=null;for(var t=0,n=e;t<n.length;t++){var r=n[t];if("init"===r.type)this.initializationSegmentReceived(r);else{if(null==this.lastInitSegment)return void this.appendError("Got a media segment without an init segment");var i=r;for(var o in i.tracks)if(i.tracks.hasOwnProperty(o)){var a=i.tracks[o];if(null!=a.sampleRuns){for(var s=0,l=a.sampleRuns;s<l.length;s++){var f=l[s];this.trackBuffers[o].addSamples(f.samples,this.timestampOffsetSec,this.appendWindowStartSec,this.appendWindowEndSec)}var u=this.trackBuffers[o].buffered;if(0<u.length){var c=u.end(u.length-1);this.mediaSource.duration<c&&this.mediaSource.setDuration(c)}}}}0<r.initializationDatas.length&&this.mediaSource.onInitializationData(r.initializationDatas)}this.updateEnd()}),e.prototype.evictFrames=freeOnUnref(function(){var e=1e3*(this.mediaSource.mediaPlayerBridge.currentTime-6);if(!(e<=0))for(var t=0,n=x.values(this.trackBuffers);t<n.length;t++){var r=n[t],i=r.getSampleAt(e);null!=i&&r.remove(0,1e3*(i.sample.pts-i.sample.duration)/i.sample.timescale)}}),e.prototype.isBufferFull=freeOnUnref(function(){return!1}),e.prototype.appendError=freeOnUnref(function(e){var t=this;this.isUpdating=!1,this.timer.setImmediate(freeOnUnref(function(){t.dispatchEvent({type:"error"})})),this.timer.setImmediate(freeOnUnref(function(){t.dispatchEvent({type:"updateend"})})),n.error("Error when processing segment data: "+e),this.mediaSource.endOfStreamAlgorithm("decode",e)}),e.prototype.updateStart=freeOnUnref(function(){var e=this;this.isUpdating=!0,this.timer.setImmediate(freeOnUnref(function(){e.dispatchEvent({type:"updatestart"})}))}),e.prototype.updateEnd=freeOnUnref(function(){var e=this;this.cachedBufferedRanges=null,this.bufferAppendImmediate=null,this.isUpdating=!1,this.timer.setImmediate(freeOnUnref(function(){e.dispatchEvent({type:"update"})})),this.timer.setImmediate(freeOnUnref(function(){e.dispatchEvent({type:"updateend"})}))}),e.prototype.updateAborted=freeOnUnref(function(){var e=this;this.isUpdating=!1,this.timer.setImmediate(freeOnUnref(function(){e.dispatchEvent({type:"abort"})})),this.timer.setImmediate(freeOnUnref(function(){e.dispatchEvent({type:"updateend"})}))}),e.prototype.initializationSegmentReceived=freeOnUnref(function(e){var t;isNaN(this.mediaSource.duration)&&this.mediaSource.setDuration(Qe.withDefault(e.totalDurationSec,1/0));var n=((t={})[Lb.TrackType.AUDIO]=0,t[Lb.TrackType.TEXT]=0,t[Lb.TrackType.VIDEO]=0,t);for(var r in e.tracks){if(e.tracks.hasOwnProperty(r))n[e.tracks[r].type]++}if(0!==n[Lb.TrackType.AUDIO]||0!==n[Lb.TrackType.TEXT]||0!==n[Lb.TrackType.VIDEO]){if(null!=this.lastInitSegment){if(n[Lb.TrackType.AUDIO]!==this.trackCountPerType[Lb.TrackType.AUDIO]||n[Lb.TrackType.TEXT]!==this.trackCountPerType[Lb.TrackType.TEXT]||n[Lb.TrackType.VIDEO]!==this.trackCountPerType[Lb.TrackType.VIDEO])return void this.appendError("Init segment has a different number of audio, video and/or text tracks than previous init segment");for(var r in e.tracks)if(e.tracks.hasOwnProperty(r)){if(e.tracks[r].codecType!==this.lastInitSegment.tracks[r].codecType)return void this.appendError(Lb.TrackType[e.tracks[r].type]+" track has changed codec from "+this.lastInitSegment.tracks[r].codecType+" to "+e.tracks[r].codecType+"!");this.trackBuffers[r].trackInitInfo=e.tracks[r]}}if(null==this.lastInitSegment){for(var r in e.tracks)e.tracks.hasOwnProperty(r)&&this.addTrack(e.tracks[r]);this.trackCountPerType=n}this.lastInitSegment=e}else this.appendError("Init segment has no audio, video or text tracks")}),e.prototype.addTrack=freeOnUnref(function(e){var t=e.trackId,n=Qe.withDefault(e.language,"");"und"===n&&(n="");for(var r=Qe.withDefault(e.label,""),i=0,o=Qe.withDefault(e.kinds,[""]);i<o.length;i++){var a=o[i],s=void 0,l=void 0;switch(e.type){case Lb.TrackType.AUDIO:l=this.audioTrackListWrapper,s=new jb.JSAudioTrack(""+e.trackId,n,r,a,this);break;case Lb.TrackType.VIDEO:l=this.videoTrackListWrapper,s=new Hb.JSVideoTrack(""+e.trackId,n,r,a,this);break;case Lb.TrackType.TEXT:l=this.textTrackListWrapper,s=new qb.JSTextTrack(""+e.trackId,n,r,a,this)}l.add(s)}this.trackBuffers[t]=new Vb.TrackBuffer(e.type),this.trackBuffers[t].trackInitInfo=e}),e})();t.JSSourceBuffer=r}));e(Kb);Kb.JSSourceBuffer;var Gb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){var r=this;this.eventEmitter=new A.EventEmitter,this.addEventListener=freeOnUnref(function(e,t,n){r.eventEmitter.on(e,t)}),this.dispatchEvent=freeOnUnref(function(e){return r.eventEmitter.emitSync(e.type,e),!0}),this.removeEventListener=freeOnUnref(function(e,t,n){r.eventEmitter.off(e,t)});var e={length:0,item:freeOnUnref(function(e){return r.wrappedValue[e]}),addEventListener:this.addEventListener,removeEventListener:this.removeEventListener,dispatchEvent:this.dispatchEvent};this.wrappedValue=e}return e.prototype.addBuffer=freeOnUnref(function(e){this.insertBuffer(e,this.wrappedValue.length)}),e.prototype.insertBuffer=freeOnUnref(function(e,t){Array.prototype.splice.call(this.wrappedValue,t,0,e),this.eventEmitter.emit("addsourcebuffer",{type:"addsourcebuffer"})}),e.prototype.findBuffer=freeOnUnref(function(e){for(var t=0;t<this.wrappedValue.length;t++)if(this.wrappedValue[t]===e)return t;return null}),e.prototype.removeBufferAt=freeOnUnref(function(e){Array.prototype.splice.call(this.wrappedValue,e,1),this.eventEmitter.emit("removesourcebuffer",{type:"removesourcebuffer"})}),e.prototype.removeBuffer=freeOnUnref(function(e){var t=this.findBuffer(e);null!==t&&this.removeBufferAt(t)}),e.prototype.removeAllBuffers=freeOnUnref(function(){Array.prototype.splice.call(this.wrappedValue,0),this.eventEmitter.emit("removesourcebuffer",{type:"removesourcebuffer"})}),e.prototype.getSourceBufferList=freeOnUnref(function(){return this.wrappedValue}),e})();t.SourceBufferListWrapper=n}));e(Gb);Gb.SourceBufferListWrapper;var Qb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("JSMediaSource");var n=freeOnUnref(function(){function e(e,t){void 0===e&&(e=oe.timer),void 0===t&&(t=new pi.MimeTypeParser);var n=this;this.onAudioTrackChanged=freeOnUnref(function(e){}),this.onVideoTrackChanged=freeOnUnref(function(e){}),this.onTextTrackChanged=freeOnUnref(function(e){}),this.onAudioTrackAdded=freeOnUnref(function(e){var t=e.track;n.audioTrackListWrapper.add(t),n.enableFirstAudioTrackEver(t),n.updateBufferActiveState(t.sourceBuffer)}),this.onVideoTrackAdded=freeOnUnref(function(e){var t=e.track;n.videoTrackListWrapper.add(t),n.selectFirstVideoTrackEver(t),n.updateBufferActiveState(t.sourceBuffer)}),this.onTextTrackAdded=freeOnUnref(function(e){}),this.onAudioTrackRemoved=freeOnUnref(function(e){var t=e.track;n.audioTrackListWrapper.remove(t),n.updateBufferActiveState(t.sourceBuffer)}),this.onVideoTrackRemoved=freeOnUnref(function(e){var t=e.track;n.videoTrackListWrapper.remove(t),n.updateBufferActiveState(t.sourceBuffer)}),this.onTextTrackRemoved=freeOnUnref(function(e){}),this.timer=e,this.eventEmitter=new A.EventEmitter,this.mimeTypeParser=t,this.sourceBuffersWrapper=new Gb.SourceBufferListWrapper,this.activeSourceBuffersWrapper=new Gb.SourceBufferListWrapper,this.internalReadyState="closed",this.mediaDuration=NaN,this.bridge=null,this.audioTrackListWrapper=new Sb.AudioTrackListWrapper,this.videoTrackListWrapper=new Wb.VideoTrackListWrapper}return Object.defineProperty(e.prototype,"activeSourceBuffers",{get:freeOnUnref(function(){return this.activeSourceBuffersWrapper.getSourceBufferList()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:freeOnUnref(function(){return this.mediaDuration}),set:freeOnUnref(function(e){if(e<0||isNaN(e))throw new TypeError("duration must be a positive number");if("open"!==this.internalReadyState)throw ct.Errors.newError("InvalidStateError","MediaSource is not open");for(var t=0;t<this.sourceBuffers.length;t++)if(this.sourceBuffers[t].updating)throw ct.Errors.newError("InvalidStateError","A source buffer update is in progress");this.setDuration(e)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:freeOnUnref(function(){return this.internalReadyState}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceBuffers",{get:freeOnUnref(function(){return this.sourceBuffersWrapper.getSourceBufferList()}),enumerable:!0,configurable:!0}),e.prototype.addSourceBuffer=freeOnUnref(function(e){if(x.isEmpty(e))throw new TypeError('"type" cannot be empty');var t=this.mimeTypeParser.parse(e);if(this.validateType(t),"open"!==this.internalReadyState)throw ct.Errors.newError("InvalidStateError","MediaSource is not open");var n=new Kb.JSSourceBuffer(this,t);return this.sourceBuffersWrapper.addBuffer(n),n.audioTracks.addEventListener("change",this.onAudioTrackChanged),n.audioTracks.addEventListener("addtrack",this.onAudioTrackAdded),n.audioTracks.addEventListener("removetrack",this.onAudioTrackRemoved),n.videoTracks.addEventListener("change",this.onVideoTrackChanged),n.videoTracks.addEventListener("addtrack",this.onVideoTrackAdded),n.videoTracks.addEventListener("removetrack",this.onVideoTrackRemoved),n.textTracks.addEventListener("change",this.onTextTrackChanged),n.textTracks.addEventListener("addtrack",this.onTextTrackAdded),n.textTracks.addEventListener("removetrack",this.onTextTrackRemoved),n}),e.prototype.endOfStream=freeOnUnref(function(e,t){if("open"!==this.readyState)throw ct.Errors.newError("InvalidStateError","MediaSource is not open");for(var n=0;n<this.sourceBuffers.length;n++)if(this.sourceBuffers[n].updating)throw ct.Errors.newError("InvalidStateError","A source buffer update is in progress");this.endOfStreamAlgorithm(e,t)}),e.prototype.endOfStreamAlgorithm=freeOnUnref(function(e,t){var n=this;this.internalReadyState="ended",this.timer.setImmediate(freeOnUnref(function(){n.dispatchEvent({type:"sourceended"})})),null==e||("network"===e?this.bridge.onError("network",new Error(t)):"decode"===e&&this.bridge.onError("decode",new Error(t))),this.setBuffersToEnded(!0)}),e.prototype.removeSourceBuffer=freeOnUnref(function(e){}),e.prototype.setLiveSeekableRange=freeOnUnref(function(e,t){}),e.prototype.clearLiveSeekableRange=freeOnUnref(function(){}),e.prototype.addEventListener=freeOnUnref(function(e,t,n){this.eventEmitter.on(e,t)}),e.prototype.dispatchEvent=freeOnUnref(function(e){return this.eventEmitter.emitSync(e.type,e),!1}),e.prototype.removeEventListener=freeOnUnref(function(e,t,n){this.eventEmitter.off(e,t)}),e.isTypeSupported=freeOnUnref(function(e){return!0}),Object.defineProperty(e.prototype,"audioTracks",{get:freeOnUnref(function(){return this.audioTrackListWrapper.getTrackList()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoTracks",{get:freeOnUnref(function(){return this.videoTrackListWrapper.getTrackList()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mediaPlayerBridge",{get:freeOnUnref(function(){return this.bridge}),enumerable:!0,configurable:!0}),e.prototype.open=freeOnUnref(function(e){this.bridge=e,this.setOpen()}),e.prototype.close=freeOnUnref(function(){var e=this;this.internalReadyState="closed",this.bridge=null,this.mediaDuration=NaN,this.activeSourceBuffersWrapper.removeAllBuffers(),this.sourceBuffersWrapper.removeAllBuffers(),this.timer.setImmediate(freeOnUnref(function(){e.dispatchEvent({type:"sourceclose"})}))}),e.prototype.setOpen=freeOnUnref(function(){var e=this;this.setBuffersToEnded(!1),this.internalReadyState="open",this.timer.setImmediate(freeOnUnref(function(){e.dispatchEvent({type:"sourceopen"})}))}),e.prototype.containsSourceBuffer=freeOnUnref(function(e){return null!==this.sourceBuffersWrapper.findBuffer(e)}),e.prototype.setDuration=freeOnUnref(function(e){this.mediaDuration!==e&&(this.mediaDuration=e)}),e.prototype.onInitializationData=freeOnUnref(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.bridge.onEncryptionInitDataFound(r.type,r.data)}}),e.prototype.updateBufferActiveState=freeOnUnref(function(e){for(var t=!1,n=0;n<e.audioTracks.length;n++)if(e.audioTracks[n].enabled){t=!0;break}if(!t)for(n=0;n<e.videoTracks.length;n++)if(e.videoTracks[n].selected){t=!0;break}var r=this.activeSourceBuffersWrapper.findBuffer(e),i=null!==r;if(!i&&t){var o=0;for(n=0;this.sourceBuffers[n]!==e;)this.sourceBuffers[n]===this.activeSourceBuffers[o]&&o++,n++;this.activeSourceBuffersWrapper.insertBuffer(e,o)}else i&&!t&&this.activeSourceBuffersWrapper.removeBufferAt(r)}),e.prototype.enableFirstAudioTrackEver=freeOnUnref(function(e){}),e.prototype.selectFirstVideoTrackEver=freeOnUnref(function(e){e.selected=!0}),e.prototype.validateType=freeOnUnref(function(e){switch(e.type){case"video":case"audio":case"application":break;default:throw ct.Errors.newError("NotSupportedError",'Unsupported type "'+e.type+'"')}}),e.prototype.setBuffersToEnded=freeOnUnref(function(e){for(var t=0;t<this.sourceBuffers.length;t++){for(var n=this.sourceBuffers[t],r=this.sourceBuffers[t].videoTracks,i=0;i<r.length;i++){var o=r[i];n.getTrackBuffer(o.id).streamEnded=e}var a=this.sourceBuffers[t].audioTracks;for(i=0;i<a.length;i++){var s=a[i];n.getTrackBuffer(s.id).streamEnded=e}}}),e})();t.JSMediaSource=n}));e(Qb);Qb.JSMediaSource;var Xb=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaSource=Qb.JSMediaSource,t.SourceBuffer=Kb.JSSourceBuffer,t.JSTimeRanges=Nb.JSTimeRanges,t.TrackBuffer=Vb.TrackBuffer}));e(Xb);Xb.MediaSource,Xb.SourceBuffer,Xb.JSTimeRanges,Xb.TrackBuffer;var Yb=t(freeOnUnref(function(V,j){freeOnUnref(function(){function Yo(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Jo(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(r,a,n(a),e)}return r}function Zo(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function $o(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function ea(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}function ta(e,t){return!(null==e||!e.length)&&-1<ua(e,t,0)}function na(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function ra(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function ia(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function oa(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function aa(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function sa(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function la(e,r,t){var i;return t(e,freeOnUnref(function(e,t,n){if(r(e,t,n))return i=t,!1})),i}function fa(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function ua(e,t,n){return t==t?function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):fa(e,da,n)}function ca(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}function da(e){return e!=e}function pa(e,t){var n=null==e?0:e.length;return n?ya(e,t)/n:La}function ha(t){return freeOnUnref(function(e){return null==e?Aa:e[t]})}function e(t){return freeOnUnref(function(e){return null==t?Aa:t[e]})}function ma(e,r,i,o,t){return t(e,freeOnUnref(function(e,t,n){i=o?(o=!1,e):r(i,e,t,n)})),i}function ya(e,t){for(var n,r=-1,i=e.length;++r<i;){var o=t(e[r]);o!==Aa&&(n=n===Aa?o:n+o)}return n}function ga(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function va(e){return e?e.slice(0,Ra(e)+1).replace(Is,""):e}function Oa(t){return freeOnUnref(function(e){return t(e)})}function Sa(t,e){return ra(e,freeOnUnref(function(e){return t[e]}))}function Ua(e,t){return e.has(t)}function ba(e,t){for(var n=-1,r=e.length;++n<r&&-1<ua(t,e[n],0););return n}function Pa(e,t){for(var n=e.length;n--&&-1<ua(t,e[n],0););return n}function Ma(e){return"\\"+R[e]}function Ca(e){return _.test(e)}function Ea(e){var n=-1,r=Array(e.size);return e.forEach(freeOnUnref(function(e,t){r[++n]=[t,e]})),r}function Ta(t,n){return freeOnUnref(function(e){return t(n(e))})}function wa(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n];a!==t&&a!==Fa||(e[n]=Fa,o[i++]=n)}return o}function Ia(e){var t=-1,n=Array(e.size);return e.forEach(freeOnUnref(function(e){n[++t]=e})),n}function ka(e){return Ca(e)?function(e){for(var t=k.lastIndex=0;k.test(e);)++t;return t}(e):N(e)}function _a(e){return Ca(e)?e.match(k)||[]:e.split("")}function Ra(e){for(var t=e.length;t--&&n.test(e.charAt(t)););return t}var Aa,Da="Expected a function",xa="__lodash_hash_undefined__",Fa="__lodash_placeholder__",Ba=9007199254740991,La=NaN,Na=4294967295,Va=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],ja="[object Arguments]",qa="[object Array]",Ha="[object Boolean]",za="[object Date]",Wa="[object Error]",Ka="[object Function]",Ga="[object GeneratorFunction]",Qa="[object Map]",Xa="[object Number]",Ya="[object Object]",Ja="[object Promise]",Za="[object RegExp]",$a="[object Set]",es="[object String]",ts="[object Symbol]",ns="[object WeakMap]",rs="[object ArrayBuffer]",is="[object DataView]",os="[object Float32Array]",as="[object Float64Array]",ss="[object Int8Array]",ls="[object Int16Array]",fs="[object Int32Array]",us="[object Uint8Array]",cs="[object Uint8ClampedArray]",ds="[object Uint16Array]",ps="[object Uint32Array]",hs=/\b__p \+= '';/g,ms=/\b(__p \+=) '' \+/g,ys=/(__e\(.*?\)|\b__t\)) \+\n'';/g,gs=/&(?:amp|lt|gt|quot|#39);/g,vs=/[&<>"']/g,Os=RegExp(gs.source),Ss=RegExp(vs.source),Us=/<%-([\s\S]+?)%>/g,bs=/<%([\s\S]+?)%>/g,Ps=/<%=([\s\S]+?)%>/g,Ms=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Cs=/^\w*$/,Es=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ts=/[\\^$.*+?()[\]{}|]/g,ws=RegExp(Ts.source),Is=/^\s+/,n=/\s/,ks=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,_s=/\{\n\/\* \[wrapped with (.+)\] \*/,Rs=/,? & /,As=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ds=/[()=,{}\[\]\/\s]/,xs=/\\(\\)?/g,Fs=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Bs=/\w*$/,Ls=/^[-+]0x[0-9a-f]+$/i,Ns=/^0b[01]+$/i,Vs=/^\[object .+?Constructor\]$/,js=/^0o[0-7]+$/i,qs=/^(?:0|[1-9]\d*)$/,Hs=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,zs=/($^)/,Ws=/['\n\r\u2028\u2029\\]/g,t="\\ud800-\\udfff",r="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",i="\\u2700-\\u27bf",o="a-z\\xdf-\\xf6\\xf8-\\xff",a="A-Z\\xc0-\\xd6\\xd8-\\xde",s="\\ufe0e\\ufe0f",l="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",f="["+t+"]",u="["+l+"]",c="["+r+"]",d="\\d+",p="["+i+"]",h="["+o+"]",m="[^"+t+l+d+i+o+a+"]",y="\\ud83c[\\udffb-\\udfff]",g="[^"+t+"]",v="(?:\\ud83c[\\udde6-\\uddff]){2}",O="[\\ud800-\\udbff][\\udc00-\\udfff]",S="["+a+"]",U="(?:"+h+"|"+m+")",b="(?:"+S+"|"+m+")",P="(?:['’](?:d|ll|m|re|s|t|ve))?",M="(?:['’](?:D|LL|M|RE|S|T|VE))?",C="(?:"+c+"|"+y+")"+"?",E="["+s+"]?",T=E+C+("(?:\\u200d(?:"+[g,v,O].join("|")+")"+E+C+")*"),w="(?:"+[p,v,O].join("|")+")"+T,I="(?:"+[g+c+"?",c,v,O,f].join("|")+")",Ks=RegExp("['’]","g"),Gs=RegExp(c,"g"),k=RegExp(y+"(?="+y+")|"+I+T,"g"),Qs=RegExp([S+"?"+h+"+"+P+"(?="+[u,S,"$"].join("|")+")",b+"+"+M+"(?="+[u,S+U,"$"].join("|")+")",S+"?"+U+"+"+P,S+"+"+M,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",d,w].join("|"),"g"),_=RegExp("[\\u200d"+t+r+s+"]"),Xs=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ys=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Js=-1,Zs={};Zs[os]=Zs[as]=Zs[ss]=Zs[ls]=Zs[fs]=Zs[us]=Zs[cs]=Zs[ds]=Zs[ps]=!0,Zs[ja]=Zs[qa]=Zs[rs]=Zs[Ha]=Zs[is]=Zs[za]=Zs[Wa]=Zs[Ka]=Zs[Qa]=Zs[Xa]=Zs[Ya]=Zs[Za]=Zs[$a]=Zs[es]=Zs[ns]=!1;var $s={};$s[ja]=$s[qa]=$s[rs]=$s[is]=$s[Ha]=$s[za]=$s[os]=$s[as]=$s[ss]=$s[ls]=$s[fs]=$s[Qa]=$s[Xa]=$s[Ya]=$s[Za]=$s[$a]=$s[es]=$s[ts]=$s[us]=$s[cs]=$s[ds]=$s[ps]=!0,$s[Wa]=$s[Ka]=$s[ns]=!1;var R={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},el=parseFloat,tl=parseInt,A="object"==typeof ce&&ce&&ce.Object===Object&&ce,D="object"==typeof self&&self&&self.Object===Object&&self,nl=A||D||Function("return this")(),x=j&&!j.nodeType&&j,F=x&&V&&!V.nodeType&&V,rl=F&&F.exports===x,B=rl&&A.process,L=freeOnUnref(function(){try{var e=F&&F.require&&F.require("util").types;return e||B&&B.binding&&B.binding("util")}catch(e){}})(),il=L&&L.isArrayBuffer,ol=L&&L.isDate,al=L&&L.isMap,sl=L&&L.isRegExp,ll=L&&L.isSet,fl=L&&L.isTypedArray,N=ha("length"),ul=e({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),cl=e({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),dl=e({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),pl=function e(t){function y(e){if(on(e)&&!Ji(e)&&!(e instanceof v)){if(e instanceof g)return e;if(Qn.call(e,"__wrapped__"))return kt(e)}return new g(e)}function o(){}function g(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=Aa}function v(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Na,this.__views__=[]}function n(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function i(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function O(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new s;++t<n;)this.add(e[t])}function M(e){this.size=(this.__data__=new i(e)).size}function r(e,t){var n=Ji(e),r=!n&&Yi(e),i=!n&&!r&&$i(e),o=!n&&!r&&!i&&io(e),a=n||r||i||o,s=a?ga(e.length,jn):[],l=s.length;for(var f in e)!t&&!Qn.call(e,f)||a&&("length"==f||i&&("offset"==f||"parent"==f)||o&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||mt(f,l))||s.push(f);return s}function a(e){var t=e.length;return t?e[re(0,t-1)]:Aa}function m(e,t,n){(n===Aa||Yt(e[t],n))&&(n!==Aa||t in e)||u(e,t,n)}function C(e,t,n){var r=e[t];Qn.call(e,t)&&Yt(r,n)&&(n!==Aa||t in e)||u(e,t,n)}function l(e,t){for(var n=e.length;n--;)if(Yt(e[n][0],t))return n;return-1}function f(e,r,i,o){return Kr(e,freeOnUnref(function(e,t,n){r(o,e,i(e),n)})),o}function E(e,t){return e&&Re(t,On(t),e)}function u(e,t,n){"__proto__"==t&&dr?dr(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function c(e,t){for(var n=-1,r=t.length,i=Dn(r),o=null==e;++n<r;)i[n]=o?Aa:gn(e,t[n]);return i}function d(e,t,n){return e==e&&(n!==Aa&&(e=e<=n?e:n),t!==Aa&&(e=t<=e?e:t)),e}function T(n,r,i,e,t,o){var a,s=1&r,l=2&r,f=4&r;if(i&&(a=t?i(n,e,t,o):i(n)),a!==Aa)return a;if(!rn(n))return n;var u,c,d,p,h,m,y,g,v,O=Ji(n);if(O){if(g=(y=n).length,v=new y.constructor(g),g&&"string"==typeof y[0]&&Qn.call(y,"index")&&(v.index=y.index,v.input=y.input),a=v,!s)return _e(n,a)}else{var S=ii(n),U=S==Ka||S==Ga;if($i(n))return Ce(n,s);if(S==Ya||S==ja||U&&!t){if(a=l||U?{}:pt(n),!s)return l?(m=d=n,p=(h=a)&&Re(m,Sn(m),h),Re(d,ri(d),p)):(c=E(a,u=n),Re(u,ni(u),c))}else{if(!$s[S])return t?n:{};a=function(e,t,n){var r,i,o,a,s,l=e.constructor;switch(t){case rs:return Ee(e);case Ha:case za:return new l(+e);case is:return s=n,new(a=e).constructor(s?Ee(a.buffer):a.buffer,a.byteOffset,a.byteLength);case os:case as:case ss:case ls:case fs:case us:case cs:case ds:case ps:return Te(e,n);case Qa:return new l;case Xa:case es:return new l(e);case Za:return(o=new(i=e).constructor(i.source,Bs.exec(i))).lastIndex=i.lastIndex,o;case $a:return new l;case ts:return r=e,Hr?Nn(Hr.call(r)):{}}}(n,S,s)}}o||(o=new M);var b=o.get(n);if(b)return b;o.set(n,a),ro(n)?n.forEach(freeOnUnref(function(e){a.add(T(e,r,i,e,n,o))})):to(n)&&n.forEach(freeOnUnref(function(e,t){a.set(t,T(e,r,i,t,n,o))}));var P=O?Aa:(f?l?ot:it:l?Sn:On)(n);return Zo(P||n,freeOnUnref(function(e,t){P&&(e=n[t=e]),C(a,t,T(e,r,i,t,n,o))})),a}function p(e,t,n){var r=n.length;if(null==e)return!r;for(e=Nn(e);r--;){var i=n[r],o=t[i],a=e[i];if(a===Aa&&!(i in e)||!o(a))return!1}return!0}function h(e,t,n){if("function"!=typeof e)throw new qn(Da);return ui(freeOnUnref(function(){e.apply(Aa,n)}),t)}function S(e,t,n,r){var i=-1,o=ta,a=!0,s=e.length,l=[],f=t.length;if(!s)return l;n&&(t=ra(t,Oa(n))),r?(o=na,a=!1):200<=t.length&&(o=Ua,a=!1,t=new O(t));e:for(;++i<s;){var u=e[i],c=null==n?u:n(u);if(u=r||0!==u?u:0,a&&c==c){for(var d=f;d--;)if(t[d]===c)continue e;l.push(u)}else o(t,c,r)||l.push(u)}return l}function U(e,r){var i=!0;return Kr(e,freeOnUnref(function(e,t,n){return i=!!r(e,t,n)})),i}function b(e,t,n){for(var r=-1,i=e.length;++r<i;){var o=e[r],a=t(o);if(null!=a&&(s===Aa?a==a&&!fn(a):n(a,s)))var s=a,l=o}return l}function P(e,r){var i=[];return Kr(e,freeOnUnref(function(e,t,n){r(e,t,n)&&i.push(e)})),i}function w(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=ht),i||(i=[]);++o<a;){var s=e[o];0<t&&n(s)?1<t?w(s,t-1,n,r,i):ia(i,s):r||(i[i.length]=s)}return i}function I(e,t){return e&&Qr(e,t,On)}function k(e,t){return e&&Xr(e,t,On)}function _(t,e){return ea(e,freeOnUnref(function(e){return en(t[e])}))}function R(e,t){for(var n=0,r=(t=Pe(t,e)).length;null!=e&&n<r;)e=e[wt(t[n++])];return n&&n==r?e:Aa}function A(e,t,n){var r=t(e);return Ji(e)?r:ia(r,n(e))}function D(e){return null==e?e===Aa?"[object Undefined]":"[object Null]":cr&&cr in Nn(e)?function(e){var t=Qn.call(e,cr),n=e[cr];try{e[cr]=Aa;var r=!0}catch(e){}var i=Jn.call(e);return r&&(t?e[cr]=n:delete e[cr]),i}(e):(t=e,Jn.call(t));var t}function x(e,t){return t<e}function F(e,t){return null!=e&&Qn.call(e,t)}function B(e,t){return null!=e&&t in Nn(e)}function L(e,t,n){for(var r=n?na:ta,i=e[0].length,o=e.length,a=o,s=Dn(o),l=1/0,f=[];a--;){var u=e[a];a&&t&&(u=ra(u,Oa(t))),l=Mr(u.length,l),s[a]=!n&&(t||120<=i&&120<=u.length)?new O(a&&u):Aa}u=e[0];var c=-1,d=s[0];e:for(;++c<i&&f.length<l;){var p=u[c],h=t?t(p):p;if(p=n||0!==p?p:0,!(d?Ua(d,h):r(f,h,n))){for(a=o;--a;){var m=s[a];if(!(m?Ua(m,h):r(e[a],h,n)))continue e}d&&d.push(h),f.push(p)}}return f}function N(e,t,n){var r=null==(e=Pt(e,t=Pe(t,e)))?e:e[wt(xt(t))];return null==r?Aa:Yo(r,e,n)}function V(e){return on(e)&&D(e)==ja}function j(e,t,n,r,i){return e===t||(null==e||null==t||!on(e)&&!on(t)?e!=e&&t!=t:function(e,t,n,r,i,o){var a=Ji(e),s=Ji(t),l=a?qa:ii(e),f=s?qa:ii(t),u=(l=l==ja?Ya:l)==Ya,c=(f=f==ja?Ya:f)==Ya,d=l==f;if(d&&$i(e)){if(!$i(t))return!1;u=!(a=!0)}if(d&&!u)return o||(o=new M),a||io(e)?nt(e,t,n,r,i,o):function(e,t,n,r,i,o,a){switch(n){case is:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case rs:return!(e.byteLength!=t.byteLength||!o(new rr(e),new rr(t)));case Ha:case za:case Xa:return Yt(+e,+t);case Wa:return e.name==t.name&&e.message==t.message;case Za:case es:return e==t+"";case Qa:var s=Ea;case $a:var l=1&r;if(s||(s=Ia),e.size!=t.size&&!l)return!1;var f=a.get(e);if(f)return f==t;r|=2,a.set(e,t);var u=nt(s(e),s(t),r,i,o,a);return a.delete(e),u;case ts:if(Hr)return Hr.call(e)==Hr.call(t)}return!1}(e,t,l,n,r,i,o);if(!(1&n)){var p=u&&Qn.call(e,"__wrapped__"),h=c&&Qn.call(t,"__wrapped__");if(p||h){var m=p?e.value():e,y=h?t.value():t;return o||(o=new M),i(m,y,n,r,o)}}return!!d&&(o||(o=new M),function(e,t,n,r,i,o){var a=1&n,s=it(e),l=s.length;if(l!=it(t).length&&!a)return!1;for(var f=l;f--;){var u=s[f];if(!(a?u in t:Qn.call(t,u)))return!1}var c=o.get(e),d=o.get(t);if(c&&d)return c==t&&d==e;var p=!0;o.set(e,t),o.set(t,e);for(var h=a;++f<l;){u=s[f];var m=e[u],y=t[u];if(r)var g=a?r(y,m,u,t,e,o):r(m,y,u,e,t,o);if(!(g===Aa?m===y||i(m,y,n,r,o):g)){p=!1;break}h||(h="constructor"==u)}if(p&&!h){var v=e.constructor,O=t.constructor;v!=O&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof O&&O instanceof O)&&(p=!1)}return o.delete(e),o.delete(t),p}(e,t,n,r,i,o))}(e,t,n,r,j,i))}function q(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Nn(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var l=(s=n[i])[0],f=e[l],u=s[1];if(a&&s[2]){if(f===Aa&&!(l in e))return!1}else{var c=new M;if(r)var d=r(f,u,l,e,t,c);if(!(d===Aa?j(u,f,3,r,c):d))return!1}}return!0}function H(e){return!(!rn(e)||(t=e,Yn&&Yn in t))&&(en(e)?er:Vs).test(It(e));var t}function z(e){return"function"==typeof e?e:null==e?Tn:"object"==typeof e?Ji(e)?Y(e[0],e[1]):X(e):_n(e)}function W(e){if(!Ot(e))return br(e);var t=[];for(var n in Nn(e))Qn.call(e,n)&&"constructor"!=n&&t.push(n);return t}function K(e){if(!rn(e))return function(e){var t=[];if(null!=e)for(var n in Nn(e))t.push(n);return t}(e);var t=Ot(e),n=[];for(var r in e)("constructor"!=r||!t&&Qn.call(e,r))&&n.push(r);return n}function G(e,t){return e<t}function Q(e,r){var i=-1,o=Jt(e)?Dn(e.length):[];return Kr(e,freeOnUnref(function(e,t,n){o[++i]=r(e,t,n)})),o}function X(t){var n=ut(t);return 1==n.length&&n[0][2]?Ut(n[0][0],n[0][1]):freeOnUnref(function(e){return e===t||q(e,t,n)})}function Y(n,r){return gt(n)&&St(r)?Ut(wt(n),r):freeOnUnref(function(e){var t=gn(e,n);return t===Aa&&t===r?vn(e,n):j(r,t,3)})}function J(r,i,o,a,s){r!==i&&Qr(i,freeOnUnref(function(e,t){if(s||(s=new M),rn(e))!function(e,t,n,r,i,o,a){var s=Mt(e,n),l=Mt(t,n),f=a.get(l);if(f)return m(e,n,f);var u=o?o(s,l,n+"",e,t,a):Aa,c=u===Aa;if(c){var d=Ji(l),p=!d&&$i(l),h=!d&&!p&&io(l);u=l,d||p||h?u=Ji(s)?s:Zt(s)?_e(s):p?Ce(l,!(c=!1)):h?Te(l,!(c=!1)):[]:sn(l)||Yi(l)?Yi(u=s)?u=mn(s):rn(s)&&!en(s)||(u=pt(l)):c=!1}c&&(a.set(l,u),i(u,l,r,o,a),a.delete(l)),m(e,n,u)}(r,i,t,o,J,a,s);else{var n=a?a(Mt(r,t),e,t+"",r,i,s):Aa;n===Aa&&(n=e),m(r,t,n)}}),Sn)}function Z(e,t){var n=e.length;if(n)return mt(t+=t<0?n:0,n)?e[t]:Aa}function $(e,r,n){r=r.length?ra(r,freeOnUnref(function(t){return Ji(t)?freeOnUnref(function(e){return R(e,1===t.length?t[0]:t)}):t})):[Tn];var i=-1;return r=ra(r,Oa(lt())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(Q(e,freeOnUnref(function(t,e,n){return{criteria:ra(r,freeOnUnref(function(e){return e(t)})),index:++i,value:t}})),freeOnUnref(function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;++r<a;){var l=we(i[r],o[r]);if(l)return s<=r?l:l*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)}))}function ee(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var a=t[r],s=R(e,a);n(s,a)&&ae(o,Pe(a,e),s)}return o}function te(e,t,n,r){var i=r?ca:ua,o=-1,a=t.length,s=e;for(e===t&&(t=_e(t)),n&&(s=ra(e,Oa(n)));++o<a;)for(var l=0,f=t[o],u=n?n(f):f;-1<(l=i(s,u,l,r));)s!==e&&lr.call(s,l,1),lr.call(e,l,1);return e}function ne(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==o){var o=i;mt(i)?lr.call(e,i,1):me(e,i)}}return e}function re(e,t){return e+gr(Tr()*(t-e+1))}function ie(e,t){var n="";if(!e||t<1||Ba<t)return n;for(;t%2&&(n+=e),(t=gr(t/2))&&(e+=e),t;);return n}function oe(e,t){return ci(bt(e,t,Tn),e+"")}function ae(e,t,n,r){if(!rn(e))return e;for(var i=-1,o=(t=Pe(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var l=wt(t[i]),f=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(i!=a){var u=s[l];(f=r?r(u,l,s):Aa)===Aa&&(f=rn(u)?u:mt(t[i+1])?[]:{})}C(s,l,f),s=s[l]}return e}function se(e,t,n){var r=-1,i=e.length;t<0&&(t=i<-t?0:i+t),(n=i<n?i:n)<0&&(n+=i),i=n<t?0:n-t>>>0,t>>>=0;for(var o=Dn(i);++r<i;)o[r]=e[r+t];return o}function le(e,r){var i;return Kr(e,freeOnUnref(function(e,t,n){return!(i=r(e,t,n))})),!!i}function fe(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=e[o];null!==a&&!fn(a)&&(n?a<=t:a<t)?r=o+1:i=o}return i}return ue(e,t,Tn,n)}function ue(e,t,n,r){var i=0,o=null==e?0:e.length;if(0===o)return 0;for(var a=(t=n(t))!=t,s=null===t,l=fn(t),f=t===Aa;i<o;){var u=gr((i+o)/2),c=n(e[u]),d=c!==Aa,p=null===c,h=c==c,m=fn(c);if(a)var y=r||h;else y=f?h&&(r||d):s?h&&d&&(r||!p):l?h&&d&&!p&&(r||!m):!p&&!m&&(r?c<=t:c<t);y?i=u+1:o=u}return Mr(o,4294967294)}function ce(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n],s=t?t(a):a;if(!n||!Yt(s,l)){var l=s;o[i++]=0===a?0:a}}return o}function de(e){return"number"==typeof e?e:fn(e)?La:+e}function pe(e){if("string"==typeof e)return e;if(Ji(e))return ra(e,pe)+"";if(fn(e))return zr?zr.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function he(e,t,n){var r=-1,i=ta,o=e.length,a=!0,s=[],l=s;if(n)a=!1,i=na;else if(200<=o){var f=t?null:ei(e);if(f)return Ia(f);a=!1,i=Ua,l=new O}else l=t?[]:s;e:for(;++r<o;){var u=e[r],c=t?t(u):u;if(u=n||0!==u?u:0,a&&c==c){for(var d=l.length;d--;)if(l[d]===c)continue e;t&&l.push(c),s.push(u)}else i(l,c,n)||(l!==s&&l.push(c),s.push(u))}return s}function me(e,t){return null==(e=Pt(e,t=Pe(t,e)))||delete e[wt(xt(t))]}function ye(e,t,n,r){return ae(e,t,n(R(e,t)),r)}function ge(e,t,n,r){for(var i=e.length,o=r?i:-1;(r?o--:++o<i)&&t(e[o],o,e););return n?se(e,r?0:o,r?o+1:i):se(e,r?o+1:0,r?i:o)}function ve(e,t){var n=e;return n instanceof v&&(n=n.value()),oa(t,freeOnUnref(function(e,t){return t.func.apply(t.thisArg,ia([e],t.args))}),n)}function Oe(e,t,n){var r=e.length;if(r<2)return r?he(e[0]):[];for(var i=-1,o=Dn(r);++i<r;)for(var a=e[i],s=-1;++s<r;)s!=i&&(o[i]=S(o[i]||a,e[s],t,n));return he(w(o,1),t,n)}function Se(e,t,n){for(var r=-1,i=e.length,o=t.length,a={};++r<i;)n(a,e[r],r<o?t[r]:Aa);return a}function Ue(e){return Zt(e)?e:[]}function be(e){return"function"==typeof e?e:Tn}function Pe(e,t){return Ji(e)?e:gt(e,t)?[e]:di(yn(e))}function Me(e,t,n){var r=e.length;return n=n===Aa?r:n,!t&&r<=n?e:se(e,t,n)}function Ce(e,t){if(t)return e.slice();var n=e.length,r=ir?ir(n):new e.constructor(n);return e.copy(r),r}function Ee(e){var t=new e.constructor(e.byteLength);return new rr(t).set(new rr(e)),t}function Te(e,t){return new e.constructor(t?Ee(e.buffer):e.buffer,e.byteOffset,e.length)}function we(e,t){if(e!==t){var n=e!==Aa,r=null===e,i=e==e,o=fn(e),a=t!==Aa,s=null===t,l=t==t,f=fn(t);if(!s&&!f&&!o&&t<e||o&&a&&l&&!s&&!f||r&&a&&l||!n&&l||!i)return 1;if(!r&&!o&&!f&&e<t||f&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!l)return-1}return 0}function Ie(e,t,n,r){for(var i=-1,o=e.length,a=n.length,s=-1,l=t.length,f=Pr(o-a,0),u=Dn(l+f),c=!r;++s<l;)u[s]=t[s];for(;++i<a;)(c||i<o)&&(u[n[i]]=e[i]);for(;f--;)u[s++]=e[i++];return u}function ke(e,t,n,r){for(var i=-1,o=e.length,a=-1,s=n.length,l=-1,f=t.length,u=Pr(o-s,0),c=Dn(u+f),d=!r;++i<u;)c[i]=e[i];for(var p=i;++l<f;)c[p+l]=t[l];for(;++a<s;)(d||i<o)&&(c[p+n[a]]=e[i++]);return c}function _e(e,t){var n=-1,r=e.length;for(t||(t=Dn(r));++n<r;)t[n]=e[n];return t}function Re(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=r?r(n[s],e[s],s,n,e):Aa;l===Aa&&(l=e[s]),i?u(n,s,l):C(n,s,l)}return n}function Ae(i,o){return freeOnUnref(function(e,t){var n=Ji(e)?Jo:f,r=o?o():{};return n(e,i,lt(t,2),r)})}function De(s){return oe(freeOnUnref(function(e,t){var n=-1,r=t.length,i=1<r?t[r-1]:Aa,o=2<r?t[2]:Aa;for(i=3<s.length&&"function"==typeof i?(r--,i):Aa,o&&yt(t[0],t[1],o)&&(i=r<3?Aa:i,r=1),e=Nn(e);++n<r;){var a=t[n];a&&s(e,a,n,i)}return e}))}function xe(o,a){return freeOnUnref(function(e,t){if(null==e)return e;if(!Jt(e))return o(e,t);for(var n=e.length,r=a?n:-1,i=Nn(e);(a?r--:++r<n)&&!1!==t(i[r],r,i););return e})}function Fe(l){return freeOnUnref(function(e,t,n){for(var r=-1,i=Nn(e),o=n(e),a=o.length;a--;){var s=o[l?a:++r];if(!1===t(i[s],s,i))break}return e})}function Be(i){return freeOnUnref(function(e){var t=Ca(e=yn(e))?_a(e):Aa,n=t?t[0]:e.charAt(0),r=t?Me(t,1).join(""):e.slice(1);return n[i]()+r})}function Le(t){return freeOnUnref(function(e){return oa(Cn(Mn(e).replace(Ks,"")),t,"")})}function Ne(r){return freeOnUnref(function(){var e=arguments;switch(e.length){case 0:return new r;case 1:return new r(e[0]);case 2:return new r(e[0],e[1]);case 3:return new r(e[0],e[1],e[2]);case 4:return new r(e[0],e[1],e[2],e[3]);case 5:return new r(e[0],e[1],e[2],e[3],e[4]);case 6:return new r(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new r(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var t=Wr(r.prototype),n=r.apply(t,e);return rn(n)?n:t})}function Ve(a){return freeOnUnref(function(e,t,n){var r=Nn(e);if(!Jt(e)){var i=lt(t,3);e=On(e),t=function(e){return i(r[e],e,r)}}var o=a(e,t,n);return-1<o?r[i?e[o]:o]:Aa})}function je(l){return rt(freeOnUnref(function(i){var o=i.length,e=o,t=g.prototype.thru;for(l&&i.reverse();e--;){var n=i[e];if("function"!=typeof n)throw new qn(Da);if(t&&!a&&"wrapper"==at(n))var a=new g([],!0)}for(e=a?e:o;++e<o;){var r=at(n=i[e]),s="wrapper"==r?ti(n):Aa;a=s&&vt(s[0])&&424==s[1]&&!s[4].length&&1==s[9]?a[at(s[0])].apply(a,s[3]):1==n.length&&vt(n)?a[r]():a.thru(n)}return freeOnUnref(function(){var e=arguments,t=e[0];if(a&&1==e.length&&Ji(t))return a.plant(t).value();for(var n=0,r=o?i[n].apply(this,e):t;++n<o;)r=i[n].call(this,r);return r})}))}function qe(l,f,u,c,d,p,h,m,y,g){var v=128&f,O=1&f,S=2&f,U=24&f,b=512&f,P=S?Aa:Ne(l);return function e(){for(var t=arguments.length,n=Dn(t),r=t;r--;)n[r]=arguments[r];if(U)var i=st(e),o=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(n,i);if(c&&(n=Ie(n,c,d,U)),p&&(n=ke(n,p,h,U)),t-=o,U&&t<g)return Xe(l,f,qe,e.placeholder,u,n,wa(n,i),m,y,g-t);var a=O?u:this,s=S?a[l]:l;return t=n.length,m?n=function(e,t){for(var n=e.length,r=Mr(t.length,n),i=_e(e);r--;){var o=t[r];e[r]=mt(o,n)?i[o]:Aa}return e}(n,m):b&&1<t&&n.reverse(),v&&y<t&&(n.length=y),this&&this!==nl&&this instanceof e&&(s=P||Ne(s)),s.apply(a,n)}}function He(a,s){return freeOnUnref(function(e,t){return n=e,r=a,i=s(t),o={},I(n,freeOnUnref(function(e,t,n){r(o,i(e),t,n)})),o;var n,r,i,o})}function ze(r,i){return freeOnUnref(function(e,t){var n;if(e===Aa&&t===Aa)return i;if(e!==Aa&&(n=e),t!==Aa){if(n===Aa)return t;"string"==typeof e||"string"==typeof t?(e=pe(e),t=pe(t)):(e=de(e),t=de(t)),n=r(e,t)}return n})}function We(r){return rt(freeOnUnref(function(e){return e=ra(e,Oa(lt())),oe(freeOnUnref(function(t){var n=this;return r(e,freeOnUnref(function(e){return Yo(e,n,t)}))}))}))}function Ke(e,t){var n=(t=t===Aa?" ":pe(t)).length;if(n<2)return n?ie(t,e):t;var r=ie(t,yr(e/ka(t)));return Ca(t)?Me(_a(r),0,e).join(""):r.slice(0,e)}function Ge(r){return freeOnUnref(function(e,t,n){return n&&"number"!=typeof n&&yt(e,t,n)&&(t=n=Aa),e=cn(e),t===Aa?(t=e,e=0):t=cn(t),function(e,t,n,r){for(var i=-1,o=Pr(yr((t-e)/(n||1)),0),a=Dn(o);o--;)a[r?o:++i]=e,e+=n;return a}(e,t,n=n===Aa?e<t?1:-1:cn(n),r)})}function Qe(n){return freeOnUnref(function(e,t){return"string"==typeof e&&"string"==typeof t||(e=hn(e),t=hn(t)),n(e,t)})}function Xe(e,t,n,r,i,o,a,s,l,f){var u=8&t;t|=u?32:64,4&(t&=~(u?64:32))||(t&=-4);var c=[e,t,i,u?o:Aa,u?a:Aa,u?Aa:o,u?Aa:a,s,l,f],d=n.apply(Aa,c);return vt(e)&&fi(d,c),d.placeholder=r,Ct(d,e,t)}function Ye(e){var r=Ln[e];return freeOnUnref(function(e,t){if(e=hn(e),(t=null==t?0:Mr(dn(t),292))&&Sr(e)){var n=(yn(e)+"e").split("e");return+((n=(yn(r(n[0]+"e"+(+n[1]+t)))+"e").split("e"))[0]+"e"+(+n[1]-t))}return r(e)})}function Je(a){return freeOnUnref(function(e){var t,n,r,i,o=ii(e);return o==Qa?Ea(e):o==$a?(n=e,r=-1,i=Array(n.size),n.forEach(freeOnUnref(function(e){i[++r]=[e,e]})),i):ra(a(t=e),freeOnUnref(function(e){return[e,t[e]]}))})}function Ze(e,t,n,r,i,o,a,s){var l=2&t;if(!l&&"function"!=typeof e)throw new qn(Da);var f=r?r.length:0;if(f||(t&=-97,r=i=Aa),a=a===Aa?a:Pr(dn(a),0),s=s===Aa?s:dn(s),f-=i?i.length:0,64&t){var u=r,c=i;r=i=Aa}var d,p,h,m,y,g,v,O,S,U,b,P,M,C=l?Aa:ti(e),E=[e,t,n,r,i,u,c,o,a,s];if(C&&function(e,t){var n=e[1],r=t[1],i=n|r,o=i<131,a=128==r&&8==n||128==r&&256==n&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(o||a){1&r&&(e[2]=t[2],i|=1&n?0:4);var s=t[3];if(s){var l=e[3];e[3]=l?Ie(l,s,t[4]):s,e[4]=l?wa(e[3],Fa):t[4]}(s=t[5])&&(l=e[5],e[5]=l?ke(l,s,t[6]):s,e[6]=l?wa(e[5],Fa):t[6]),(s=t[7])&&(e[7]=s),128&r&&(e[8]=null==e[8]?t[8]:Mr(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}}(E,C),e=E[0],t=E[1],n=E[2],r=E[3],i=E[4],!(s=E[9]=E[9]===Aa?l?0:e.length:Pr(E[9]-f,0))&&24&t&&(t&=-25),t&&1!=t)T=8==t||16==t?(b=t,P=s,M=Ne(U=e),function e(){for(var t=arguments.length,n=Dn(t),r=t,i=st(e);r--;)n[r]=arguments[r];var o=t<3&&n[0]!==i&&n[t-1]!==i?[]:wa(n,i);return(t-=o.length)<P?Xe(U,b,qe,e.placeholder,Aa,n,o,Aa,Aa,P-t):Yo(this&&this!==nl&&this instanceof e?M:U,this,n)}):32!=t&&33!=t||i.length?qe.apply(Aa,E):(g=n,v=r,O=1&t,S=Ne(y=e),function e(){for(var t=-1,n=arguments.length,r=-1,i=v.length,o=Dn(i+n),a=this&&this!==nl&&this instanceof e?S:y;++r<i;)o[r]=v[r];for(;n--;)o[r++]=arguments[++t];return Yo(a,O?g:this,o)});else var T=(p=n,h=1&t,m=Ne(d=e),function e(){return(this&&this!==nl&&this instanceof e?m:d).apply(h?p:this,arguments)});return Ct((C?Yr:fi)(T,E),e,t)}function $e(e,t,n,r){return e===Aa||Yt(e,Wn[n])&&!Qn.call(r,n)?t:e}function et(e,t,n,r,i,o){return rn(e)&&rn(t)&&(o.set(t,e),J(e,t,Aa,et,o),o.delete(t)),e}function tt(e){return sn(e)?Aa:e}function nt(e,t,n,r,i,o){var a=1&n,s=e.length,l=t.length;if(s!=l&&!(a&&s<l))return!1;var f=o.get(e),u=o.get(t);if(f&&u)return f==t&&u==e;var c=-1,d=!0,p=2&n?new O:Aa;for(o.set(e,t),o.set(t,e);++c<s;){var h=e[c],m=t[c];if(r)var y=a?r(m,h,c,t,e,o):r(h,m,c,e,t,o);if(y!==Aa){if(y)continue;d=!1;break}if(p){if(!sa(t,freeOnUnref(function(e,t){if(!Ua(p,t)&&(h===e||i(h,e,n,r,o)))return p.push(t)}))){d=!1;break}}else if(h!==m&&!i(h,m,n,r,o)){d=!1;break}}return o.delete(e),o.delete(t),d}function rt(e){return ci(bt(e,Aa,At),e+"")}function it(e){return A(e,On,ni)}function ot(e){return A(e,Sn,ri)}function at(e){for(var t=e.name+"",n=Fr[t],r=Qn.call(Fr,t)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function st(e){return(Qn.call(y,"placeholder")?y:e).placeholder}function lt(){var e=y.iteratee||wn;return e=e===wn?z:e,arguments.length?e(arguments[0],arguments[1]):e}function ft(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function ut(e){for(var t=On(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,St(i)]}return t}function ct(e,t){var n,r,i=(r=t,null==(n=e)?Aa:n[r]);return H(i)?i:Aa}function dt(e,t,n){for(var r=-1,i=(t=Pe(t,e)).length,o=!1;++r<i;){var a=wt(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&nn(i)&&mt(a,i)&&(Ji(e)||Yi(e))}function pt(e){return"function"!=typeof e.constructor||Ot(e)?{}:Wr(or(e))}function ht(e){return Ji(e)||Yi(e)||!!(fr&&e&&e[fr])}function mt(e,t){var n=typeof e;return!!(t=null==t?Ba:t)&&("number"==n||"symbol"!=n&&qs.test(e))&&-1<e&&e%1==0&&e<t}function yt(e,t,n){if(!rn(n))return!1;var r=typeof t;return!!("number"==r?Jt(n)&&mt(t,n.length):"string"==r&&t in n)&&Yt(n[t],e)}function gt(e,t){if(Ji(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!fn(e))||Cs.test(e)||!Ms.test(e)||null!=t&&e in Nn(t)}function vt(e){var t=at(e),n=y[t];if("function"!=typeof n||!(t in v.prototype))return!1;if(e===n)return!0;var r=ti(n);return!!r&&e===r[0]}function Ot(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Wn)}function St(e){return e==e&&!rn(e)}function Ut(t,n){return freeOnUnref(function(e){return null!=e&&e[t]===n&&(n!==Aa||t in Nn(e))})}function bt(o,a,s){return a=Pr(a===Aa?o.length-1:a,0),freeOnUnref(function(){for(var e=arguments,t=-1,n=Pr(e.length-a,0),r=Dn(n);++t<n;)r[t]=e[a+t];t=-1;for(var i=Dn(a+1);++t<a;)i[t]=e[t];return i[a]=s(r),Yo(o,this,i)})}function Pt(e,t){return t.length<2?e:R(e,se(t,0,-1))}function Mt(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function Ct(e,t,n){var r,i,o,a=t+"";return ci(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(1<n?"& ":"")+t[r],t=t.join(2<n?", ":" "),e.replace(ks,"{\n/* [wrapped with "+t+"] */\n")}(a,(o=a.match(_s),r=o?o[1].split(Rs):[],i=n,Zo(Va,freeOnUnref(function(e){var t="_."+e[0];i&e[1]&&!ta(r,t)&&r.push(t)})),r.sort())))}function Et(n){var r=0,i=0;return freeOnUnref(function(){var e=Cr(),t=16-(e-i);if(i=e,0<t){if(800<=++r)return arguments[0]}else r=0;return n.apply(Aa,arguments)})}function Tt(e,t){var n=-1,r=e.length,i=r-1;for(t=t===Aa?r:t;++n<t;){var o=re(n,i),a=e[o];e[o]=e[n],e[n]=a}return e.length=t,e}function wt(e){if("string"==typeof e||fn(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function It(e){if(null!=e){try{return Gn.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function kt(e){if(e instanceof v)return e.clone();var t=new g(e.__wrapped__,e.__chain__);return t.__actions__=_e(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function _t(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:dn(n);return i<0&&(i=Pr(r+i,0)),fa(e,lt(t,3),i)}function Rt(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r-1;return n!==Aa&&(i=dn(n),i=n<0?Pr(r+i,0):Mr(i,r-1)),fa(e,lt(t,3),i,!0)}function At(e){return null!=e&&e.length?w(e,1):[]}function Dt(e){return e&&e.length?e[0]:Aa}function xt(e){var t=null==e?0:e.length;return t?e[t-1]:Aa}function Ft(e,t){return e&&e.length&&t&&t.length?te(e,t):e}function Bt(e){return null==e?e:wr.call(e)}function Lt(t){if(!t||!t.length)return[];var n=0;return t=ea(t,freeOnUnref(function(e){if(Zt(e))return n=Pr(e.length,n),!0})),ga(n,freeOnUnref(function(e){return ra(t,ha(e))}))}function Nt(e,t){if(!e||!e.length)return[];var n=Lt(e);return null==t?n:ra(n,freeOnUnref(function(e){return Yo(t,Aa,e)}))}function Vt(e){var t=y(e);return t.__chain__=!0,t}function jt(e,t){return t(e)}function qt(e,t){return(Ji(e)?Zo:Kr)(e,lt(t,3))}function Ht(e,t){return(Ji(e)?function(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}:Gr)(e,lt(t,3))}function zt(e,t){return(Ji(e)?ra:Q)(e,lt(t,3))}function Wt(e,t,n){return t=n?Aa:t,t=e&&null==t?e.length:t,Ze(e,128,Aa,Aa,Aa,Aa,t)}function Kt(e,t){var n;if("function"!=typeof t)throw new qn(Da);return e=dn(e),freeOnUnref(function(){return 0<--e&&(n=t.apply(this,arguments)),e<=1&&(t=Aa),n})}function Gt(r,i,e){function o(e){var t=f,n=u;return f=u=Aa,m=e,d=r.apply(n,t)}function a(e){var t=e-h;return h===Aa||i<=t||t<0||g&&c<=e-m}function s(){var e,t,n=Ni();return a(n)?l(n):(p=ui(s,(t=i-((e=n)-h),g?Mr(t,c-(e-m)):t)),Aa)}function l(e){return p=Aa,n&&f?o(e):(f=u=Aa,d)}function t(){var e,t=Ni(),n=a(t);if(f=arguments,u=this,h=t,n){if(p===Aa)return m=e=h,p=ui(s,i),y?o(e):d;if(g)return $r(p),p=ui(s,i),o(h)}return p===Aa&&(p=ui(s,i)),d}var f,u,c,d,p,h,m=0,y=!1,g=!1,n=!0;if("function"!=typeof r)throw new qn(Da);return i=hn(i)||0,rn(e)&&(y=!!e.leading,c=(g="maxWait"in e)?Pr(hn(e.maxWait)||0,i):c,n="trailing"in e?!!e.trailing:n),t.cancel=function(){p!==Aa&&$r(p),m=0,f=h=u=p=Aa},t.flush=function(){return p===Aa?d:l(Ni())},t}function Qt(i,o){if("function"!=typeof i||null!=o&&"function"!=typeof o)throw new qn(Da);var a=freeOnUnref(function(){var e=arguments,t=o?o.apply(this,e):e[0],n=a.cache;if(n.has(t))return n.get(t);var r=i.apply(this,e);return a.cache=n.set(t,r)||n,r});return a.cache=new(Qt.Cache||s),a}function Xt(t){if("function"!=typeof t)throw new qn(Da);return freeOnUnref(function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)})}function Yt(e,t){return e===t||e!=e&&t!=t}function Jt(e){return null!=e&&nn(e.length)&&!en(e)}function Zt(e){return on(e)&&Jt(e)}function $t(e){if(!on(e))return!1;var t=D(e);return t==Wa||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!sn(e)}function en(e){if(!rn(e))return!1;var t=D(e);return t==Ka||t==Ga||"[object AsyncFunction]"==t||"[object Proxy]"==t}function tn(e){return"number"==typeof e&&e==dn(e)}function nn(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=Ba}function rn(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function on(e){return null!=e&&"object"==typeof e}function an(e){return"number"==typeof e||on(e)&&D(e)==Xa}function sn(e){if(!on(e)||D(e)!=Ya)return!1;var t=or(e);if(null===t)return!0;var n=Qn.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Gn.call(n)==Zn}function ln(e){return"string"==typeof e||!Ji(e)&&on(e)&&D(e)==es}function fn(e){return"symbol"==typeof e||on(e)&&D(e)==ts}function un(e){if(!e)return[];if(Jt(e))return ln(e)?_a(e):_e(e);if(ur&&e[ur])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[ur]());var t=ii(e);return(t==Qa?Ea:t==$a?Ia:bn)(e)}function cn(e){return e?(e=hn(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function dn(e){var t=cn(e),n=t%1;return t==t?n?t-n:t:0}function pn(e){return e?d(dn(e),0,Na):0}function hn(e){if("number"==typeof e)return e;if(fn(e))return La;if(rn(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=rn(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=va(e);var n=Ns.test(e);return n||js.test(e)?tl(e.slice(2),n?2:8):Ls.test(e)?La:+e}function mn(e){return Re(e,Sn(e))}function yn(e){return null==e?"":pe(e)}function gn(e,t,n){var r=null==e?Aa:R(e,t);return r===Aa?n:r}function vn(e,t){return null!=e&&dt(e,t,B)}function On(e){return Jt(e)?r(e):W(e)}function Sn(e){return Jt(e)?r(e,!0):K(e)}function Un(e,n){if(null==e)return{};var t=ra(ot(e),freeOnUnref(function(e){return[e]}));return n=lt(n),ee(e,t,freeOnUnref(function(e,t){return n(e,t[0])}))}function bn(e){return null==e?[]:Sa(e,On(e))}function Pn(e){return _o(yn(e).toLowerCase())}function Mn(e){return(e=yn(e))&&e.replace(Hs,ul).replace(Gs,"")}function Cn(e,t,n){return e=yn(e),(t=n?Aa:t)===Aa?(r=e,Xs.test(r)?e.match(Qs)||[]:e.match(As)||[]):e.match(t)||[];var r}function En(e){return freeOnUnref(function(){return e})}function Tn(e){return e}function wn(e){return z("function"==typeof e?e:T(e,1))}function In(r,t,e){var n=On(t),i=_(t,n);null!=e||rn(t)&&(i.length||!n.length)||(e=t,t=r,r=this,i=_(t,On(t)));var o=!(rn(e)&&"chain"in e&&!e.chain),a=en(r);return Zo(i,freeOnUnref(function(e){var n=t[e];r[e]=n,a&&(r.prototype[e]=freeOnUnref(function(){var e=this.__chain__;if(o||e){var t=r(this.__wrapped__);return(t.__actions__=_e(this.__actions__)).push({func:n,args:arguments,thisArg:r}),t.__chain__=e,t}return n.apply(r,ia([this.value()],arguments))}))})),r}function kn(){}function _n(e){return gt(e)?ha(wt(e)):(t=e,freeOnUnref(function(e){return R(e,t)}));var t}function Rn(){return[]}function An(){return!1}var Dn=(t=null==t?nl:pl.defaults(nl.Object(),t,pl.pick(nl,Ys))).Array,xn=t.Date,Fn=t.Error,Bn=t.Function,Ln=t.Math,Nn=t.Object,Vn=t.RegExp,jn=t.String,qn=t.TypeError,Hn=Dn.prototype,zn=Bn.prototype,Wn=Nn.prototype,Kn=t["__core-js_shared__"],Gn=zn.toString,Qn=Wn.hasOwnProperty,Xn=0,Yn=freeOnUnref(function(){var e=/[^.]+$/.exec(Kn&&Kn.keys&&Kn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""})(),Jn=Wn.toString,Zn=Gn.call(Nn),$n=nl._,er=Vn("^"+Gn.call(Qn).replace(Ts,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),tr=rl?t.Buffer:Aa,nr=t.Symbol,rr=t.Uint8Array,ir=tr?tr.allocUnsafe:Aa,or=Ta(Nn.getPrototypeOf,Nn),ar=Nn.create,sr=Wn.propertyIsEnumerable,lr=Hn.splice,fr=nr?nr.isConcatSpreadable:Aa,ur=nr?nr.iterator:Aa,cr=nr?nr.toStringTag:Aa,dr=freeOnUnref(function(){try{var e=ct(Nn,"defineProperty");return e({},"",{}),e}catch(e){}})(),pr=t.clearTimeout!==nl.clearTimeout&&t.clearTimeout,hr=xn&&xn.now!==nl.Date.now&&xn.now,mr=t.setTimeout!==nl.setTimeout&&t.setTimeout,yr=Ln.ceil,gr=Ln.floor,vr=Nn.getOwnPropertySymbols,Or=tr?tr.isBuffer:Aa,Sr=t.isFinite,Ur=Hn.join,br=Ta(Nn.keys,Nn),Pr=Ln.max,Mr=Ln.min,Cr=xn.now,Er=t.parseInt,Tr=Ln.random,wr=Hn.reverse,Ir=ct(t,"DataView"),kr=ct(t,"Map"),_r=ct(t,"Promise"),Rr=ct(t,"Set"),Ar=ct(t,"WeakMap"),Dr=ct(Nn,"create"),xr=Ar&&new Ar,Fr={},Br=It(Ir),Lr=It(kr),Nr=It(_r),Vr=It(Rr),jr=It(Ar),qr=nr?nr.prototype:Aa,Hr=qr?qr.valueOf:Aa,zr=qr?qr.toString:Aa,Wr=freeOnUnref(function(){function n(){}return freeOnUnref(function(e){if(!rn(e))return{};if(ar)return ar(e);n.prototype=e;var t=new n;return n.prototype=Aa,t})})();y.templateSettings={escape:Us,evaluate:bs,interpolate:Ps,variable:"",imports:{_:y}},(y.prototype=o.prototype).constructor=y,(g.prototype=Wr(o.prototype)).constructor=g,(v.prototype=Wr(o.prototype)).constructor=v,n.prototype.clear=function(){this.__data__=Dr?Dr(null):{},this.size=0},n.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},n.prototype.get=function(e){var t=this.__data__;if(Dr){var n=t[e];return n===xa?Aa:n}return Qn.call(t,e)?t[e]:Aa},n.prototype.has=function(e){var t=this.__data__;return Dr?t[e]!==Aa:Qn.call(t,e)},n.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Dr&&t===Aa?xa:t,this},i.prototype.clear=function(){this.__data__=[],this.size=0},i.prototype.delete=function(e){var t=this.__data__,n=l(t,e);return!(n<0||(n==t.length-1?t.pop():lr.call(t,n,1),--this.size,0))},i.prototype.get=function(e){var t=this.__data__,n=l(t,e);return n<0?Aa:t[n][1]},i.prototype.has=function(e){return-1<l(this.__data__,e)},i.prototype.set=function(e,t){var n=this.__data__,r=l(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},s.prototype.clear=function(){this.size=0,this.__data__={hash:new n,map:new(kr||i),string:new n}},s.prototype.delete=function(e){var t=ft(this,e).delete(e);return this.size-=t?1:0,t},s.prototype.get=function(e){return ft(this,e).get(e)},s.prototype.has=function(e){return ft(this,e).has(e)},s.prototype.set=function(e,t){var n=ft(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},O.prototype.add=O.prototype.push=function(e){return this.__data__.set(e,xa),this},O.prototype.has=function(e){return this.__data__.has(e)},M.prototype.clear=function(){this.__data__=new i,this.size=0},M.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},M.prototype.get=function(e){return this.__data__.get(e)},M.prototype.has=function(e){return this.__data__.has(e)},M.prototype.set=function(e,t){var n=this.__data__;if(n instanceof i){var r=n.__data__;if(!kr||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new s(r)}return n.set(e,t),this.size=n.size,this};var Kr=xe(I),Gr=xe(k,!0),Qr=Fe(),Xr=Fe(!0),Yr=xr?freeOnUnref(function(e,t){return xr.set(e,t),e}):Tn,Jr=dr?freeOnUnref(function(e,t){return dr(e,"toString",{configurable:!0,enumerable:!1,value:En(t),writable:!0})}):Tn,Zr=oe,$r=pr||freeOnUnref(function(e){return nl.clearTimeout(e)}),ei=Rr&&1/Ia(new Rr([,-0]))[1]==1/0?freeOnUnref(function(e){return new Rr(e)}):kn,ti=xr?freeOnUnref(function(e){return xr.get(e)}):kn,ni=vr?freeOnUnref(function(t){return null==t?[]:(t=Nn(t),ea(vr(t),freeOnUnref(function(e){return sr.call(t,e)})))}):Rn,ri=vr?freeOnUnref(function(e){for(var t=[];e;)ia(t,ni(e)),e=or(e);return t}):Rn,ii=D;(Ir&&ii(new Ir(new ArrayBuffer(1)))!=is||kr&&ii(new kr)!=Qa||_r&&ii(_r.resolve())!=Ja||Rr&&ii(new Rr)!=$a||Ar&&ii(new Ar)!=ns)&&(ii=freeOnUnref(function(e){var t=D(e),n=t==Ya?e.constructor:Aa,r=n?It(n):"";if(r)switch(r){case Br:return is;case Lr:return Qa;case Nr:return Ja;case Vr:return $a;case jr:return ns}return t}));var oi,ai,si,li=Kn?en:An,fi=Et(Yr),ui=mr||freeOnUnref(function(e,t){return nl.setTimeout(e,t)}),ci=Et(Jr),di=(oi=freeOnUnref(function(e){var i=[];return 46===e.charCodeAt(0)&&i.push(""),e.replace(Es,freeOnUnref(function(e,t,n,r){i.push(n?r.replace(xs,"$1"):t||e)})),i}),si=(ai=Qt(oi,freeOnUnref(function(e){return 500===si.size&&si.clear(),e}))).cache,ai),pi=oe(freeOnUnref(function(e,t){return Zt(e)?S(e,w(t,1,Zt,!0)):[]})),hi=oe(freeOnUnref(function(e,t){var n=xt(t);return Zt(n)&&(n=Aa),Zt(e)?S(e,w(t,1,Zt,!0),lt(n,2)):[]})),mi=oe(freeOnUnref(function(e,t){var n=xt(t);return Zt(n)&&(n=Aa),Zt(e)?S(e,w(t,1,Zt,!0),Aa,n):[]})),yi=oe(freeOnUnref(function(e){var t=ra(e,Ue);return t.length&&t[0]===e[0]?L(t):[]})),gi=oe(freeOnUnref(function(e){var t=xt(e),n=ra(e,Ue);return t===xt(n)?t=Aa:n.pop(),n.length&&n[0]===e[0]?L(n,lt(t,2)):[]})),vi=oe(freeOnUnref(function(e){var t=xt(e),n=ra(e,Ue);return(t="function"==typeof t?t:Aa)&&n.pop(),n.length&&n[0]===e[0]?L(n,Aa,t):[]})),Oi=oe(Ft),Si=rt(freeOnUnref(function(e,t){var n=null==e?0:e.length,r=c(e,t);return ne(e,ra(t,freeOnUnref(function(e){return mt(e,n)?+e:e})).sort(we)),r})),Ui=oe(freeOnUnref(function(e){return he(w(e,1,Zt,!0))})),bi=oe(freeOnUnref(function(e){var t=xt(e);return Zt(t)&&(t=Aa),he(w(e,1,Zt,!0),lt(t,2))})),Pi=oe(freeOnUnref(function(e){var t=xt(e);return t="function"==typeof t?t:Aa,he(w(e,1,Zt,!0),Aa,t)})),Mi=oe(freeOnUnref(function(e,t){return Zt(e)?S(e,t):[]})),Ci=oe(freeOnUnref(function(e){return Oe(ea(e,Zt))})),Ei=oe(freeOnUnref(function(e){var t=xt(e);return Zt(t)&&(t=Aa),Oe(ea(e,Zt),lt(t,2))})),Ti=oe(freeOnUnref(function(e){var t=xt(e);return t="function"==typeof t?t:Aa,Oe(ea(e,Zt),Aa,t)})),wi=oe(Lt),Ii=oe(freeOnUnref(function(e){var t=e.length,n=1<t?e[t-1]:Aa;return Nt(e,n="function"==typeof n?(e.pop(),n):Aa)})),ki=rt(freeOnUnref(function(t){var n=t.length,e=n?t[0]:0,r=this.__wrapped__,i=freeOnUnref(function(e){return c(e,t)});return!(1<n||this.__actions__.length)&&r instanceof v&&mt(e)?((r=r.slice(e,+e+(n?1:0))).__actions__.push({func:jt,args:[i],thisArg:Aa}),new g(r,this.__chain__).thru(freeOnUnref(function(e){return n&&!e.length&&e.push(Aa),e}))):this.thru(i)})),_i=Ae(freeOnUnref(function(e,t,n){Qn.call(e,n)?++e[n]:u(e,n,1)})),Ri=Ve(_t),Ai=Ve(Rt),Di=Ae(freeOnUnref(function(e,t,n){Qn.call(e,n)?e[n].push(t):u(e,n,[t])})),xi=oe(freeOnUnref(function(e,t,n){var r=-1,i="function"==typeof t,o=Jt(e)?Dn(e.length):[];return Kr(e,freeOnUnref(function(e){o[++r]=i?Yo(t,e,n):N(e,t,n)})),o})),Fi=Ae(freeOnUnref(function(e,t,n){u(e,n,t)})),Bi=Ae(freeOnUnref(function(e,t,n){e[n?0:1].push(t)}),freeOnUnref(function(){return[[],[]]})),Li=oe(freeOnUnref(function(e,t){if(null==e)return[];var n=t.length;return 1<n&&yt(e,t[0],t[1])?t=[]:2<n&&yt(t[0],t[1],t[2])&&(t=[t[0]]),$(e,w(t,1),[])})),Ni=hr||freeOnUnref(function(){return nl.Date.now()}),Vi=oe(freeOnUnref(function(e,t,n){var r=1;if(n.length){var i=wa(n,st(Vi));r|=32}return Ze(e,r,t,n,i)})),ji=oe(freeOnUnref(function(e,t,n){var r=3;if(n.length){var i=wa(n,st(ji));r|=32}return Ze(t,r,e,n,i)})),qi=oe(freeOnUnref(function(e,t){return h(e,1,t)})),Hi=oe(freeOnUnref(function(e,t,n){return h(e,hn(t)||0,n)}));Qt.Cache=s;var zi=Zr(freeOnUnref(function(r,i){var o=(i=1==i.length&&Ji(i[0])?ra(i[0],Oa(lt())):ra(w(i,1),Oa(lt()))).length;return oe(freeOnUnref(function(e){for(var t=-1,n=Mr(e.length,o);++t<n;)e[t]=i[t].call(this,e[t]);return Yo(r,this,e)}))})),Wi=oe(freeOnUnref(function(e,t){return Ze(e,32,Aa,t,wa(t,st(Wi)))})),Ki=oe(freeOnUnref(function(e,t){return Ze(e,64,Aa,t,wa(t,st(Ki)))})),Gi=rt(freeOnUnref(function(e,t){return Ze(e,256,Aa,Aa,Aa,t)})),Qi=Qe(x),Xi=Qe(freeOnUnref(function(e,t){return t<=e})),Yi=V(freeOnUnref(function(){return arguments})())?V:freeOnUnref(function(e){return on(e)&&Qn.call(e,"callee")&&!sr.call(e,"callee")}),Ji=Dn.isArray,Zi=il?Oa(il):function(e){return on(e)&&D(e)==rs},$i=Or||An,eo=ol?Oa(ol):function(e){return on(e)&&D(e)==za},to=al?Oa(al):function(e){return on(e)&&ii(e)==Qa},no=sl?Oa(sl):function(e){return on(e)&&D(e)==Za},ro=ll?Oa(ll):function(e){return on(e)&&ii(e)==$a},io=fl?Oa(fl):function(e){return on(e)&&nn(e.length)&&!!Zs[D(e)]},oo=Qe(G),ao=Qe(freeOnUnref(function(e,t){return e<=t})),so=De(freeOnUnref(function(e,t){if(Ot(t)||Jt(t))return Re(t,On(t),e),Aa;for(var n in t)Qn.call(t,n)&&C(e,n,t[n])})),lo=De(freeOnUnref(function(e,t){Re(t,Sn(t),e)})),fo=De(freeOnUnref(function(e,t,n,r){Re(t,Sn(t),e,r)})),uo=De(freeOnUnref(function(e,t,n,r){Re(t,On(t),e,r)})),co=rt(c),po=oe(freeOnUnref(function(e,t){e=Nn(e);var n=-1,r=t.length,i=2<r?t[2]:Aa;for(i&&yt(t[0],t[1],i)&&(r=1);++n<r;)for(var o=t[n],a=Sn(o),s=-1,l=a.length;++s<l;){var f=a[s],u=e[f];(u===Aa||Yt(u,Wn[f])&&!Qn.call(e,f))&&(e[f]=o[f])}return e})),ho=oe(freeOnUnref(function(e){return e.push(Aa,et),Yo(Oo,Aa,e)})),mo=He(freeOnUnref(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Jn.call(t)),e[t]=n}),En(Tn)),yo=He(freeOnUnref(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Jn.call(t)),Qn.call(e,t)?e[t].push(n):e[t]=[n]}),lt),go=oe(N),vo=De(freeOnUnref(function(e,t,n){J(e,t,n)})),Oo=De(freeOnUnref(function(e,t,n,r){J(e,t,n,r)})),So=rt(freeOnUnref(function(t,e){var n={};if(null==t)return n;var r=!1;e=ra(e,freeOnUnref(function(e){return e=Pe(e,t),r||(r=1<e.length),e})),Re(t,ot(t),n),r&&(n=T(n,7,tt));for(var i=e.length;i--;)me(n,e[i]);return n})),Uo=rt(freeOnUnref(function(e,t){return null==e?{}:ee(n=e,t,freeOnUnref(function(e,t){return vn(n,t)}));var n})),bo=Je(On),Po=Je(Sn),Mo=Le(freeOnUnref(function(e,t,n){return t=t.toLowerCase(),e+(n?Pn(t):t)})),Co=Le(freeOnUnref(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Eo=Le(freeOnUnref(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),To=Be("toLowerCase"),wo=Le(freeOnUnref(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()})),Io=Le(freeOnUnref(function(e,t,n){return e+(n?" ":"")+_o(t)})),ko=Le(freeOnUnref(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),_o=Be("toUpperCase"),Ro=oe(freeOnUnref(function(e,t){try{return Yo(e,Aa,t)}catch(e){return $t(e)?e:new Fn(e)}})),Ao=rt(freeOnUnref(function(t,e){return Zo(e,freeOnUnref(function(e){e=wt(e),u(t,e,Vi(t[e],t))})),t})),Do=je(),xo=je(!0),Fo=oe(freeOnUnref(function(t,n){return freeOnUnref(function(e){return N(e,t,n)})})),Bo=oe(freeOnUnref(function(t,n){return freeOnUnref(function(e){return N(t,e,n)})})),Lo=We(ra),No=We($o),Vo=We(sa),jo=Ge(),qo=Ge(!0),Ho=ze(freeOnUnref(function(e,t){return e+t}),0),zo=Ye("ceil"),Wo=ze(freeOnUnref(function(e,t){return e/t}),1),Ko=Ye("floor"),Go=ze(freeOnUnref(function(e,t){return e*t}),1),Qo=Ye("round"),Xo=ze(freeOnUnref(function(e,t){return e-t}),0);return y.after=function(e,t){if("function"!=typeof t)throw new qn(Da);return e=dn(e),freeOnUnref(function(){if(--e<1)return t.apply(this,arguments)})},y.ary=Wt,y.assign=so,y.assignIn=lo,y.assignInWith=fo,y.assignWith=uo,y.at=co,y.before=Kt,y.bind=Vi,y.bindAll=Ao,y.bindKey=ji,y.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Ji(e)?e:[e]},y.chain=Vt,y.chunk=function(e,t,n){t=(n?yt(e,t,n):t===Aa)?1:Pr(dn(t),0);var r=null==e?0:e.length;if(!r||t<1)return[];for(var i=0,o=0,a=Dn(yr(r/t));i<r;)a[o++]=se(e,i,i+=t);return a},y.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i},y.concat=function(){var e=arguments.length;if(!e)return[];for(var t=Dn(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return ia(Ji(n)?_e(n):[n],w(t,1))},y.cond=function(r){var i=null==r?0:r.length,t=lt();return r=i?ra(r,freeOnUnref(function(e){if("function"!=typeof e[1])throw new qn(Da);return[t(e[0]),e[1]]})):[],oe(freeOnUnref(function(e){for(var t=-1;++t<i;){var n=r[t];if(Yo(n[0],this,e))return Yo(n[1],this,e)}}))},y.conforms=function(e){return t=T(e,1),n=On(t),freeOnUnref(function(e){return p(e,t,n)});var t,n},y.constant=En,y.countBy=_i,y.create=function(e,t){var n=Wr(e);return null==t?n:E(n,t)},y.curry=function e(t,n,r){var i=Ze(t,8,Aa,Aa,Aa,Aa,Aa,n=r?Aa:n);return i.placeholder=e.placeholder,i},y.curryRight=function e(t,n,r){var i=Ze(t,16,Aa,Aa,Aa,Aa,Aa,n=r?Aa:n);return i.placeholder=e.placeholder,i},y.debounce=Gt,y.defaults=po,y.defaultsDeep=ho,y.defer=qi,y.delay=Hi,y.difference=pi,y.differenceBy=hi,y.differenceWith=mi,y.drop=function(e,t,n){var r=null==e?0:e.length;return r?se(e,(t=n||t===Aa?1:dn(t))<0?0:t,r):[]},y.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?se(e,0,(t=r-(t=n||t===Aa?1:dn(t)))<0?0:t):[]},y.dropRightWhile=function(e,t){return e&&e.length?ge(e,lt(t,3),!0,!0):[]},y.dropWhile=function(e,t){return e&&e.length?ge(e,lt(t,3),!0):[]},y.fill=function(e,t,n,r){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&yt(e,t,n)&&(n=0,r=i),function(e,t,n,r){var i=e.length;for((n=dn(n))<0&&(n=i<-n?0:i+n),(r=r===Aa||i<r?i:dn(r))<0&&(r+=i),r=r<n?0:pn(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},y.filter=function(e,t){return(Ji(e)?ea:P)(e,lt(t,3))},y.flatMap=function(e,t){return w(zt(e,t),1)},y.flatMapDeep=function(e,t){return w(zt(e,t),1/0)},y.flatMapDepth=function(e,t,n){return n=n===Aa?1:dn(n),w(zt(e,t),n)},y.flatten=At,y.flattenDeep=function(e){return null!=e&&e.length?w(e,1/0):[]},y.flattenDepth=function(e,t){return null!=e&&e.length?w(e,t=t===Aa?1:dn(t)):[]},y.flip=function(e){return Ze(e,512)},y.flow=Do,y.flowRight=xo,y.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},y.functions=function(e){return null==e?[]:_(e,On(e))},y.functionsIn=function(e){return null==e?[]:_(e,Sn(e))},y.groupBy=Di,y.initial=function(e){return null!=e&&e.length?se(e,0,-1):[]},y.intersection=yi,y.intersectionBy=gi,y.intersectionWith=vi,y.invert=mo,y.invertBy=yo,y.invokeMap=xi,y.iteratee=wn,y.keyBy=Fi,y.keys=On,y.keysIn=Sn,y.map=zt,y.mapKeys=function(e,r){var i={};return r=lt(r,3),I(e,freeOnUnref(function(e,t,n){u(i,r(e,t,n),e)})),i},y.mapValues=function(e,r){var i={};return r=lt(r,3),I(e,freeOnUnref(function(e,t,n){u(i,t,r(e,t,n))})),i},y.matches=function(e){return X(T(e,1))},y.matchesProperty=function(e,t){return Y(e,T(t,1))},y.memoize=Qt,y.merge=vo,y.mergeWith=Oo,y.method=Fo,y.methodOf=Bo,y.mixin=In,y.negate=Xt,y.nthArg=function(t){return t=dn(t),oe(freeOnUnref(function(e){return Z(e,t)}))},y.omit=So,y.omitBy=function(e,t){return Un(e,Xt(lt(t)))},y.once=function(e){return Kt(2,e)},y.orderBy=function(e,t,n,r){return null==e?[]:(Ji(t)||(t=null==t?[]:[t]),Ji(n=r?Aa:n)||(n=null==n?[]:[n]),$(e,t,n))},y.over=Lo,y.overArgs=zi,y.overEvery=No,y.overSome=Vo,y.partial=Wi,y.partialRight=Ki,y.partition=Bi,y.pick=Uo,y.pickBy=Un,y.property=_n,y.propertyOf=function(t){return freeOnUnref(function(e){return null==t?Aa:R(t,e)})},y.pull=Oi,y.pullAll=Ft,y.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?te(e,t,lt(n,2)):e},y.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?te(e,t,Aa,n):e},y.pullAt=Si,y.range=jo,y.rangeRight=qo,y.rearg=Gi,y.reject=function(e,t){return(Ji(e)?ea:P)(e,Xt(lt(t,3)))},y.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],o=e.length;for(t=lt(t,3);++r<o;){var a=e[r];t(a,r,e)&&(n.push(a),i.push(r))}return ne(e,i),n},y.rest=function(e,t){if("function"!=typeof e)throw new qn(Da);return oe(e,t=t===Aa?t:dn(t))},y.reverse=Bt,y.sampleSize=function(e,t,n){return t=(n?yt(e,t,n):t===Aa)?1:dn(t),(Ji(e)?function(e,t){return Tt(_e(e),d(t,0,e.length))}:function(e,t){var n=bn(e);return Tt(n,d(t,0,n.length))})(e,t)},y.set=function(e,t,n){return null==e?e:ae(e,t,n)},y.setWith=function(e,t,n,r){return r="function"==typeof r?r:Aa,null==e?e:ae(e,t,n,r)},y.shuffle=function(e){return(Ji(e)?function(e){return Tt(_e(e))}:function(e){return Tt(bn(e))})(e)},y.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&yt(e,t,n)?(t=0,n=r):(t=null==t?0:dn(t),n=n===Aa?r:dn(n)),se(e,t,n)):[]},y.sortBy=Li,y.sortedUniq=function(e){return e&&e.length?ce(e):[]},y.sortedUniqBy=function(e,t){return e&&e.length?ce(e,lt(t,2)):[]},y.split=function(e,t,n){return n&&"number"!=typeof n&&yt(e,t,n)&&(t=n=Aa),(n=n===Aa?Na:n>>>0)?(e=yn(e))&&("string"==typeof t||null!=t&&!no(t))&&!(t=pe(t))&&Ca(e)?Me(_a(e),0,n):e.split(t,n):[]},y.spread=function(r,i){if("function"!=typeof r)throw new qn(Da);return i=null==i?0:Pr(dn(i),0),oe(freeOnUnref(function(e){var t=e[i],n=Me(e,0,i);return t&&ia(n,t),Yo(r,this,n)}))},y.tail=function(e){var t=null==e?0:e.length;return t?se(e,1,t):[]},y.take=function(e,t,n){return e&&e.length?se(e,0,(t=n||t===Aa?1:dn(t))<0?0:t):[]},y.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?se(e,(t=r-(t=n||t===Aa?1:dn(t)))<0?0:t,r):[]},y.takeRightWhile=function(e,t){return e&&e.length?ge(e,lt(t,3),!1,!0):[]},y.takeWhile=function(e,t){return e&&e.length?ge(e,lt(t,3)):[]},y.tap=function(e,t){return t(e),e},y.throttle=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new qn(Da);return rn(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),Gt(e,t,{leading:r,maxWait:t,trailing:i})},y.thru=jt,y.toArray=un,y.toPairs=bo,y.toPairsIn=Po,y.toPath=function(e){return Ji(e)?ra(e,wt):fn(e)?[e]:_e(di(yn(e)))},y.toPlainObject=mn,y.transform=function(e,r,i){var t=Ji(e),n=t||$i(e)||io(e);if(r=lt(r,4),null==i){var o=e&&e.constructor;i=n?t?new o:[]:rn(e)&&en(o)?Wr(or(e)):{}}return(n?Zo:I)(e,freeOnUnref(function(e,t,n){return r(i,e,t,n)})),i},y.unary=function(e){return Wt(e,1)},y.union=Ui,y.unionBy=bi,y.unionWith=Pi,y.uniq=function(e){return e&&e.length?he(e):[]},y.uniqBy=function(e,t){return e&&e.length?he(e,lt(t,2)):[]},y.uniqWith=function(e,t){return t="function"==typeof t?t:Aa,e&&e.length?he(e,Aa,t):[]},y.unset=function(e,t){return null==e||me(e,t)},y.unzip=Lt,y.unzipWith=Nt,y.update=function(e,t,n){return null==e?e:ye(e,t,be(n))},y.updateWith=function(e,t,n,r){return r="function"==typeof r?r:Aa,null==e?e:ye(e,t,be(n),r)},y.values=bn,y.valuesIn=function(e){return null==e?[]:Sa(e,Sn(e))},y.without=Mi,y.words=Cn,y.wrap=function(e,t){return Wi(be(t),e)},y.xor=Ci,y.xorBy=Ei,y.xorWith=Ti,y.zip=wi,y.zipObject=function(e,t){return Se(e||[],t||[],C)},y.zipObjectDeep=function(e,t){return Se(e||[],t||[],ae)},y.zipWith=Ii,y.entries=bo,y.entriesIn=Po,y.extend=lo,y.extendWith=fo,In(y,y),y.add=Ho,y.attempt=Ro,y.camelCase=Mo,y.capitalize=Pn,y.ceil=zo,y.clamp=function(e,t,n){return n===Aa&&(n=t,t=Aa),n!==Aa&&(n=(n=hn(n))==n?n:0),t!==Aa&&(t=(t=hn(t))==t?t:0),d(hn(e),t,n)},y.clone=function(e){return T(e,4)},y.cloneDeep=function(e){return T(e,5)},y.cloneDeepWith=function(e,t){return T(e,5,t="function"==typeof t?t:Aa)},y.cloneWith=function(e,t){return T(e,4,t="function"==typeof t?t:Aa)},y.conformsTo=function(e,t){return null==t||p(e,t,On(t))},y.deburr=Mn,y.defaultTo=function(e,t){return null==e||e!=e?t:e},y.divide=Wo,y.endsWith=function(e,t,n){e=yn(e),t=pe(t);var r=e.length,i=n=n===Aa?r:d(dn(n),0,r);return 0<=(n-=t.length)&&e.slice(n,i)==t},y.eq=Yt,y.escape=function(e){return(e=yn(e))&&Ss.test(e)?e.replace(vs,cl):e},y.escapeRegExp=function(e){return(e=yn(e))&&ws.test(e)?e.replace(Ts,"\\$&"):e},y.every=function(e,t,n){var r=Ji(e)?$o:U;return n&&yt(e,t,n)&&(t=Aa),r(e,lt(t,3))},y.find=Ri,y.findIndex=_t,y.findKey=function(e,t){return la(e,lt(t,3),I)},y.findLast=Ai,y.findLastIndex=Rt,y.findLastKey=function(e,t){return la(e,lt(t,3),k)},y.floor=Ko,y.forEach=qt,y.forEachRight=Ht,y.forIn=function(e,t){return null==e?e:Qr(e,lt(t,3),Sn)},y.forInRight=function(e,t){return null==e?e:Xr(e,lt(t,3),Sn)},y.forOwn=function(e,t){return e&&I(e,lt(t,3))},y.forOwnRight=function(e,t){return e&&k(e,lt(t,3))},y.get=gn,y.gt=Qi,y.gte=Xi,y.has=function(e,t){return null!=e&&dt(e,t,F)},y.hasIn=vn,y.head=Dt,y.identity=Tn,y.includes=function(e,t,n,r){e=Jt(e)?e:bn(e),n=n&&!r?dn(n):0;var i=e.length;return n<0&&(n=Pr(i+n,0)),ln(e)?n<=i&&-1<e.indexOf(t,n):!!i&&-1<ua(e,t,n)},y.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:dn(n);return i<0&&(i=Pr(r+i,0)),ua(e,t,i)},y.inRange=function(e,t,n){return t=cn(t),n===Aa?(n=t,t=0):n=cn(n),e=hn(e),(r=e)>=Mr(i=t,o=n)&&r<Pr(i,o);var r,i,o},y.invoke=go,y.isArguments=Yi,y.isArray=Ji,y.isArrayBuffer=Zi,y.isArrayLike=Jt,y.isArrayLikeObject=Zt,y.isBoolean=function(e){return!0===e||!1===e||on(e)&&D(e)==Ha},y.isBuffer=$i,y.isDate=eo,y.isElement=function(e){return on(e)&&1===e.nodeType&&!sn(e)},y.isEmpty=function(e){if(null==e)return!0;if(Jt(e)&&(Ji(e)||"string"==typeof e||"function"==typeof e.splice||$i(e)||io(e)||Yi(e)))return!e.length;var t=ii(e);if(t==Qa||t==$a)return!e.size;if(Ot(e))return!W(e).length;for(var n in e)if(Qn.call(e,n))return!1;return!0},y.isEqual=function(e,t){return j(e,t)},y.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:Aa)?n(e,t):Aa;return r===Aa?j(e,t,Aa,n):!!r},y.isError=$t,y.isFinite=function(e){return"number"==typeof e&&Sr(e)},y.isFunction=en,y.isInteger=tn,y.isLength=nn,y.isMap=to,y.isMatch=function(e,t){return e===t||q(e,t,ut(t))},y.isMatchWith=function(e,t,n){return n="function"==typeof n?n:Aa,q(e,t,ut(t),n)},y.isNaN=function(e){return an(e)&&e!=+e},y.isNative=function(e){if(li(e))throw new Fn("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return H(e)},y.isNil=function(e){return null==e},y.isNull=function(e){return null===e},y.isNumber=an,y.isObject=rn,y.isObjectLike=on,y.isPlainObject=sn,y.isRegExp=no,y.isSafeInteger=function(e){return tn(e)&&-Ba<=e&&e<=Ba},y.isSet=ro,y.isString=ln,y.isSymbol=fn,y.isTypedArray=io,y.isUndefined=function(e){return e===Aa},y.isWeakMap=function(e){return on(e)&&ii(e)==ns},y.isWeakSet=function(e){return on(e)&&"[object WeakSet]"==D(e)},y.join=function(e,t){return null==e?"":Ur.call(e,t)},y.kebabCase=Co,y.last=xt,y.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r;return n!==Aa&&(i=(i=dn(n))<0?Pr(r+i,0):Mr(i,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,i):fa(e,da,i,!0)},y.lowerCase=Eo,y.lowerFirst=To,y.lt=oo,y.lte=ao,y.max=function(e){return e&&e.length?b(e,Tn,x):Aa},y.maxBy=function(e,t){return e&&e.length?b(e,lt(t,2),x):Aa},y.mean=function(e){return pa(e,Tn)},y.meanBy=function(e,t){return pa(e,lt(t,2))},y.min=function(e){return e&&e.length?b(e,Tn,G):Aa},y.minBy=function(e,t){return e&&e.length?b(e,lt(t,2),G):Aa},y.stubArray=Rn,y.stubFalse=An,y.stubObject=function(){return{}},y.stubString=function(){return""},y.stubTrue=function(){return!0},y.multiply=Go,y.nth=function(e,t){return e&&e.length?Z(e,dn(t)):Aa},y.noConflict=function(){return nl._===this&&(nl._=$n),this},y.noop=kn,y.now=Ni,y.pad=function(e,t,n){e=yn(e);var r=(t=dn(t))?ka(e):0;if(!t||t<=r)return e;var i=(t-r)/2;return Ke(gr(i),n)+e+Ke(yr(i),n)},y.padEnd=function(e,t,n){e=yn(e);var r=(t=dn(t))?ka(e):0;return t&&r<t?e+Ke(t-r,n):e},y.padStart=function(e,t,n){e=yn(e);var r=(t=dn(t))?ka(e):0;return t&&r<t?Ke(t-r,n)+e:e},y.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),Er(yn(e).replace(Is,""),t||0)},y.random=function(e,t,n){if(n&&"boolean"!=typeof n&&yt(e,t,n)&&(t=n=Aa),n===Aa&&("boolean"==typeof t?(n=t,t=Aa):"boolean"==typeof e&&(n=e,e=Aa)),e===Aa&&t===Aa?(e=0,t=1):(e=cn(e),t===Aa?(t=e,e=0):t=cn(t)),t<e){var r=e;e=t,t=r}if(n||e%1||t%1){var i=Tr();return Mr(e+i*(t-e+el("1e-"+((i+"").length-1))),t)}return re(e,t)},y.reduce=function(e,t,n){var r=Ji(e)?oa:ma,i=arguments.length<3;return r(e,lt(t,4),n,i,Kr)},y.reduceRight=function(e,t,n){var r=Ji(e)?aa:ma,i=arguments.length<3;return r(e,lt(t,4),n,i,Gr)},y.repeat=function(e,t,n){return t=(n?yt(e,t,n):t===Aa)?1:dn(t),ie(yn(e),t)},y.replace=function(){var e=arguments,t=yn(e[0]);return e.length<3?t:t.replace(e[1],e[2])},y.result=function(e,t,n){var r=-1,i=(t=Pe(t,e)).length;for(i||(i=1,e=Aa);++r<i;){var o=null==e?Aa:e[wt(t[r])];o===Aa&&(r=i,o=n),e=en(o)?o.call(e):o}return e},y.round=Qo,y.runInContext=e,y.sample=function(e){return(Ji(e)?a:function(e){return a(bn(e))})(e)},y.size=function(e){if(null==e)return 0;if(Jt(e))return ln(e)?ka(e):e.length;var t=ii(e);return t==Qa||t==$a?e.size:W(e).length},y.snakeCase=wo,y.some=function(e,t,n){var r=Ji(e)?sa:le;return n&&yt(e,t,n)&&(t=Aa),r(e,lt(t,3))},y.sortedIndex=function(e,t){return fe(e,t)},y.sortedIndexBy=function(e,t,n){return ue(e,t,lt(n,2))},y.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=fe(e,t);if(r<n&&Yt(e[r],t))return r}return-1},y.sortedLastIndex=function(e,t){return fe(e,t,!0)},y.sortedLastIndexBy=function(e,t,n){return ue(e,t,lt(n,2),!0)},y.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=fe(e,t,!0)-1;if(Yt(e[n],t))return n}return-1},y.startCase=Io,y.startsWith=function(e,t,n){return e=yn(e),n=null==n?0:d(dn(n),0,e.length),t=pe(t),e.slice(n,n+t.length)==t},y.subtract=Xo,y.sum=function(e){return e&&e.length?ya(e,Tn):0},y.sumBy=function(e,t){return e&&e.length?ya(e,lt(t,2)):0},y.template=function(a,e,t){var n=y.templateSettings;t&&yt(a,e,t)&&(e=Aa),a=yn(a),e=fo({},e,n,$e);var s,l,r=fo({},e.imports,n.imports,$e),i=On(r),o=Sa(r,i),f=0,u=e.interpolate||zs,c="__p += '",d=Vn((e.escape||zs).source+"|"+u.source+"|"+(u===Ps?Fs:zs).source+"|"+(e.evaluate||zs).source+"|$","g"),p="//# sourceURL="+(Qn.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Js+"]")+"\n";a.replace(d,freeOnUnref(function(e,t,n,r,i,o){return n||(n=r),c+=a.slice(f,o).replace(Ws,Ma),t&&(s=!0,c+="' +\n__e("+t+") +\n'"),i&&(l=!0,c+="';\n"+i+";\n__p += '"),n&&(c+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),f=o+e.length,e})),c+="';\n";var h=Qn.call(e,"variable")&&e.variable;if(h){if(Ds.test(h))throw new Fn("Invalid `variable` option passed into `_.template`")}else c="with (obj) {\n"+c+"\n}\n";c=(l?c.replace(hs,""):c).replace(ms,"$1").replace(ys,"$1;"),c="function("+(h||"obj")+") {\n"+(h?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(l?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+c+"return __p\n}";var m=Ro(freeOnUnref(function(){return Bn(i,p+"return "+c).apply(Aa,o)}));if(m.source=c,$t(m))throw m;return m},y.times=function(e,t){if((e=dn(e))<1||Ba<e)return[];var n=Na,r=Mr(e,Na);t=lt(t),e-=Na;for(var i=ga(r,t);++n<e;)t(n);return i},y.toFinite=cn,y.toInteger=dn,y.toLength=pn,y.toLower=function(e){return yn(e).toLowerCase()},y.toNumber=hn,y.toSafeInteger=function(e){return e?d(dn(e),-Ba,Ba):0===e?e:0},y.toString=yn,y.toUpper=function(e){return yn(e).toUpperCase()},y.trim=function(e,t,n){if((e=yn(e))&&(n||t===Aa))return va(e);if(!e||!(t=pe(t)))return e;var r=_a(e),i=_a(t);return Me(r,ba(r,i),Pa(r,i)+1).join("")},y.trimEnd=function(e,t,n){if((e=yn(e))&&(n||t===Aa))return e.slice(0,Ra(e)+1);if(!e||!(t=pe(t)))return e;var r=_a(e);return Me(r,0,Pa(r,_a(t))+1).join("")},y.trimStart=function(e,t,n){if((e=yn(e))&&(n||t===Aa))return e.replace(Is,"");if(!e||!(t=pe(t)))return e;var r=_a(e);return Me(r,ba(r,_a(t))).join("")},y.truncate=function(e,t){var n=30,r="...";if(rn(t)){var i="separator"in t?t.separator:i;n="length"in t?dn(t.length):n,r="omission"in t?pe(t.omission):r}var o=(e=yn(e)).length;if(Ca(e)){var a=_a(e);o=a.length}if(o<=n)return e;var s=n-ka(r);if(s<1)return r;var l=a?Me(a,0,s).join(""):e.slice(0,s);if(i===Aa)return l+r;if(a&&(s+=l.length-s),no(i)){if(e.slice(s).search(i)){var f,u=l;for(i.global||(i=Vn(i.source,yn(Bs.exec(i))+"g")),i.lastIndex=0;f=i.exec(u);)var c=f.index;l=l.slice(0,c===Aa?s:c)}}else if(e.indexOf(pe(i),s)!=s){var d=l.lastIndexOf(i);-1<d&&(l=l.slice(0,d))}return l+r},y.unescape=function(e){return(e=yn(e))&&Os.test(e)?e.replace(gs,dl):e},y.uniqueId=function(e){var t=++Xn;return yn(e)+t},y.upperCase=ko,y.upperFirst=_o,y.each=qt,y.eachRight=Ht,y.first=Dt,In(y,freeOnUnref(function(){var n={};return I(y,freeOnUnref(function(e,t){Qn.call(y.prototype,t)||(n[t]=e)})),n})(),{chain:!1}),y.VERSION="4.17.21",Zo(["bind","bindKey","curry","curryRight","partial","partialRight"],freeOnUnref(function(e){y[e].placeholder=y})),Zo(["drop","take"],freeOnUnref(function(n,r){v.prototype[n]=freeOnUnref(function(e){e=e===Aa?1:Pr(dn(e),0);var t=this.__filtered__&&!r?new v(this):this.clone();return t.__filtered__?t.__takeCount__=Mr(e,t.__takeCount__):t.__views__.push({size:Mr(e,Na),type:n+(t.__dir__<0?"Right":"")}),t}),v.prototype[n+"Right"]=freeOnUnref(function(e){return this.reverse()[n](e).reverse()})})),Zo(["filter","map","takeWhile"],freeOnUnref(function(e,t){var n=t+1,r=1==n||3==n;v.prototype[e]=freeOnUnref(function(e){var t=this.clone();return t.__iteratees__.push({iteratee:lt(e,3),type:n}),t.__filtered__=t.__filtered__||r,t})})),Zo(["head","last"],freeOnUnref(function(e,t){var n="take"+(t?"Right":"");v.prototype[e]=freeOnUnref(function(){return this[n](1).value()[0]})})),Zo(["initial","tail"],freeOnUnref(function(e,t){var n="drop"+(t?"":"Right");v.prototype[e]=freeOnUnref(function(){return this.__filtered__?new v(this):this[n](1)})})),v.prototype.compact=freeOnUnref(function(){return this.filter(Tn)}),v.prototype.find=freeOnUnref(function(e){return this.filter(e).head()}),v.prototype.findLast=freeOnUnref(function(e){return this.reverse().find(e)}),v.prototype.invokeMap=oe(freeOnUnref(function(t,n){return"function"==typeof t?new v(this):this.map(freeOnUnref(function(e){return N(e,t,n)}))})),v.prototype.reject=freeOnUnref(function(e){return this.filter(Xt(lt(e)))}),v.prototype.slice=freeOnUnref(function(e,t){e=dn(e);var n=this;return n.__filtered__&&(0<e||t<0)?new v(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==Aa&&(n=(t=dn(t))<0?n.dropRight(-t):n.take(t-e)),n)}),v.prototype.takeRightWhile=freeOnUnref(function(e){return this.reverse().takeWhile(e).reverse()}),v.prototype.toArray=freeOnUnref(function(){return this.take(Na)}),I(v.prototype,freeOnUnref(function(c,e){var d=/^(?:filter|find|map|reject)|While$/.test(e),p=/^(?:head|last)$/.test(e),h=y[p?"take"+("last"==e?"Right":""):e],m=p||/^find/.test(e);h&&(y.prototype[e]=freeOnUnref(function(){var e=this.__wrapped__,n=p?[1]:arguments,t=e instanceof v,r=n[0],i=t||Ji(e),o=freeOnUnref(function(e){var t=h.apply(y,ia([e],n));return p&&a?t[0]:t});i&&d&&"function"==typeof r&&1!=r.length&&(t=i=!1);var a=this.__chain__,s=!!this.__actions__.length,l=m&&!a,f=t&&!s;if(!m&&i){e=f?e:new v(this);var u=c.apply(e,n);return u.__actions__.push({func:jt,args:[o],thisArg:Aa}),new g(u,a)}return l&&f?c.apply(this,n):(u=this.thru(o),l?p?u.value()[0]:u.value():u)}))})),Zo(["pop","push","shift","sort","splice","unshift"],freeOnUnref(function(e){var n=Hn[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);y.prototype[e]=freeOnUnref(function(){var t=arguments;if(i&&!this.__chain__){var e=this.value();return n.apply(Ji(e)?e:[],t)}return this[r](freeOnUnref(function(e){return n.apply(Ji(e)?e:[],t)}))})})),I(v.prototype,freeOnUnref(function(e,t){var n=y[t];if(n){var r=n.name+"";Qn.call(Fr,r)||(Fr[r]=[]),Fr[r].push({name:t,func:n})}})),Fr[qe(Aa,2).name]=[{name:"wrapper",func:Aa}],v.prototype.clone=function(){var e=new v(this.__wrapped__);return e.__actions__=_e(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=_e(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=_e(this.__views__),e},v.prototype.reverse=function(){if(this.__filtered__){var e=new v(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},v.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Ji(e),r=t<0,i=n?e.length:0,o=function(e,t,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=Mr(t,e+a);break;case"takeRight":e=Pr(e,t-a)}}return{start:e,end:t}}(0,i,this.__views__),a=o.start,s=o.end,l=s-a,f=r?s:a-1,u=this.__iteratees__,c=u.length,d=0,p=Mr(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return ve(e,this.__actions__);var h=[];e:for(;l--&&d<p;){for(var m=-1,y=e[f+=t];++m<c;){var g=u[m],v=g.iteratee,O=g.type,S=v(y);if(2==O)y=S;else if(!S){if(1==O)continue e;break e}}h[d++]=y}return h},y.prototype.at=ki,y.prototype.chain=function(){return Vt(this)},y.prototype.commit=function(){return new g(this.value(),this.__chain__)},y.prototype.next=function(){this.__values__===Aa&&(this.__values__=un(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?Aa:this.__values__[this.__index__++]}},y.prototype.plant=function(e){for(var t,n=this;n instanceof o;){var r=kt(n);r.__index__=0,r.__values__=Aa,t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t},y.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof v){var t=e;return this.__actions__.length&&(t=new v(this)),(t=t.reverse()).__actions__.push({func:jt,args:[Bt],thisArg:Aa}),new g(t,this.__chain__)}return this.thru(Bt)},y.prototype.toJSON=y.prototype.valueOf=y.prototype.value=function(){return ve(this.__wrapped__,this.__actions__)},y.prototype.first=y.prototype.head,ur&&(y.prototype[ur]=function(){return this}),y}();F?((F.exports=pl)._=pl,x._=pl):nl._=pl}).call(ce)})),Jb=t(freeOnUnref(function(e,o){o.aliasToReal={each:"forEach",eachRight:"forEachRight",entries:"toPairs",entriesIn:"toPairsIn",extend:"assignIn",extendAll:"assignInAll",extendAllWith:"assignInAllWith",extendWith:"assignInWith",first:"head",conforms:"conformsTo",matches:"isMatch",property:"get",__:"placeholder",F:"stubFalse",T:"stubTrue",all:"every",allPass:"overEvery",always:"constant",any:"some",anyPass:"overSome",apply:"spread",assoc:"set",assocPath:"set",complement:"negate",compose:"flowRight",contains:"includes",dissoc:"unset",dissocPath:"unset",dropLast:"dropRight",dropLastWhile:"dropRightWhile",equals:"isEqual",identical:"eq",indexBy:"keyBy",init:"initial",invertObj:"invert",juxt:"over",omitAll:"omit",nAry:"ary",path:"get",pathEq:"matchesProperty",pathOr:"getOr",paths:"at",pickAll:"pick",pipe:"flow",pluck:"map",prop:"get",propEq:"matchesProperty",propOr:"getOr",props:"at",symmetricDifference:"xor",symmetricDifferenceBy:"xorBy",symmetricDifferenceWith:"xorWith",takeLast:"takeRight",takeLastWhile:"takeRightWhile",unapply:"rest",unnest:"flatten",useWith:"overArgs",where:"conformsTo",whereEq:"isMatch",zipObj:"zipObject"},o.aryMethod={1:["assignAll","assignInAll","attempt","castArray","ceil","create","curry","curryRight","defaultsAll","defaultsDeepAll","floor","flow","flowRight","fromPairs","invert","iteratee","memoize","method","mergeAll","methodOf","mixin","nthArg","over","overEvery","overSome","rest","reverse","round","runInContext","spread","template","trim","trimEnd","trimStart","uniqueId","words","zipAll"],2:["add","after","ary","assign","assignAllWith","assignIn","assignInAllWith","at","before","bind","bindAll","bindKey","chunk","cloneDeepWith","cloneWith","concat","conformsTo","countBy","curryN","curryRightN","debounce","defaults","defaultsDeep","defaultTo","delay","difference","divide","drop","dropRight","dropRightWhile","dropWhile","endsWith","eq","every","filter","find","findIndex","findKey","findLast","findLastIndex","findLastKey","flatMap","flatMapDeep","flattenDepth","forEach","forEachRight","forIn","forInRight","forOwn","forOwnRight","get","groupBy","gt","gte","has","hasIn","includes","indexOf","intersection","invertBy","invoke","invokeMap","isEqual","isMatch","join","keyBy","lastIndexOf","lt","lte","map","mapKeys","mapValues","matchesProperty","maxBy","meanBy","merge","mergeAllWith","minBy","multiply","nth","omit","omitBy","overArgs","pad","padEnd","padStart","parseInt","partial","partialRight","partition","pick","pickBy","propertyOf","pull","pullAll","pullAt","random","range","rangeRight","rearg","reject","remove","repeat","restFrom","result","sampleSize","some","sortBy","sortedIndex","sortedIndexOf","sortedLastIndex","sortedLastIndexOf","sortedUniqBy","split","spreadFrom","startsWith","subtract","sumBy","take","takeRight","takeRightWhile","takeWhile","tap","throttle","thru","times","trimChars","trimCharsEnd","trimCharsStart","truncate","union","uniqBy","uniqWith","unset","unzipWith","without","wrap","xor","zip","zipObject","zipObjectDeep"],3:["assignInWith","assignWith","clamp","differenceBy","differenceWith","findFrom","findIndexFrom","findLastFrom","findLastIndexFrom","getOr","includesFrom","indexOfFrom","inRange","intersectionBy","intersectionWith","invokeArgs","invokeArgsMap","isEqualWith","isMatchWith","flatMapDepth","lastIndexOfFrom","mergeWith","orderBy","padChars","padCharsEnd","padCharsStart","pullAllBy","pullAllWith","rangeStep","rangeStepRight","reduce","reduceRight","replace","set","slice","sortedIndexBy","sortedLastIndexBy","transform","unionBy","unionWith","update","xorBy","xorWith","zipWith"],4:["fill","setWith","updateWith"]},o.aryRearg={2:[1,0],3:[2,0,1],4:[3,2,0,1]},o.iterateeAry={dropRightWhile:1,dropWhile:1,every:1,filter:1,find:1,findFrom:1,findIndex:1,findIndexFrom:1,findKey:1,findLast:1,findLastFrom:1,findLastIndex:1,findLastIndexFrom:1,findLastKey:1,flatMap:1,flatMapDeep:1,flatMapDepth:1,forEach:1,forEachRight:1,forIn:1,forInRight:1,forOwn:1,forOwnRight:1,map:1,mapKeys:1,mapValues:1,partition:1,reduce:2,reduceRight:2,reject:1,remove:1,some:1,takeRightWhile:1,takeWhile:1,times:1,transform:2},o.iterateeRearg={mapKeys:[1],reduceRight:[1,0]},o.methodRearg={assignInAllWith:[1,0],assignInWith:[1,2,0],assignAllWith:[1,0],assignWith:[1,2,0],differenceBy:[1,2,0],differenceWith:[1,2,0],getOr:[2,1,0],intersectionBy:[1,2,0],intersectionWith:[1,2,0],isEqualWith:[1,2,0],isMatchWith:[2,1,0],mergeAllWith:[1,0],mergeWith:[1,2,0],padChars:[2,1,0],padCharsEnd:[2,1,0],padCharsStart:[2,1,0],pullAllBy:[2,1,0],pullAllWith:[2,1,0],rangeStep:[1,2,0],rangeStepRight:[1,2,0],setWith:[3,1,2,0],sortedIndexBy:[2,1,0],sortedLastIndexBy:[2,1,0],unionBy:[1,2,0],unionWith:[1,2,0],updateWith:[3,1,2,0],xorBy:[1,2,0],xorWith:[1,2,0],zipWith:[1,2,0]},o.methodSpread={assignAll:{start:0},assignAllWith:{start:0},assignInAll:{start:0},assignInAllWith:{start:0},defaultsAll:{start:0},defaultsDeepAll:{start:0},invokeArgs:{start:2},invokeArgsMap:{start:2},mergeAll:{start:0},mergeAllWith:{start:0},partial:{start:1},partialRight:{start:1},without:{start:1},zipAll:{start:0}},o.mutate={array:{fill:!0,pull:!0,pullAll:!0,pullAllBy:!0,pullAllWith:!0,pullAt:!0,remove:!0,reverse:!0},object:{assign:!0,assignAll:!0,assignAllWith:!0,assignIn:!0,assignInAll:!0,assignInAllWith:!0,assignInWith:!0,assignWith:!0,defaults:!0,defaultsAll:!0,defaultsDeep:!0,defaultsDeepAll:!0,merge:!0,mergeAll:!0,mergeAllWith:!0,mergeWith:!0},set:{set:!0,setWith:!0,unset:!0,update:!0,updateWith:!0}},o.realToAlias=freeOnUnref(function(){var e=Object.prototype.hasOwnProperty,t=o.aliasToReal,n={};for(var r in t){var i=t[r];e.call(n,i)?n[i].push(r):n[i]=[r]}return n})(),o.remap={assignAll:"assign",assignAllWith:"assignWith",assignInAll:"assignIn",assignInAllWith:"assignInWith",curryN:"curry",curryRightN:"curryRight",defaultsAll:"defaults",defaultsDeepAll:"defaultsDeep",findFrom:"find",findIndexFrom:"findIndex",findLastFrom:"findLast",findLastIndexFrom:"findLastIndex",getOr:"get",includesFrom:"includes",indexOfFrom:"indexOf",invokeArgs:"invoke",invokeArgsMap:"invokeMap",lastIndexOfFrom:"lastIndexOf",mergeAll:"merge",mergeAllWith:"mergeWith",padChars:"pad",padCharsEnd:"padEnd",padCharsStart:"padStart",propertyOf:"get",rangeStep:"range",rangeStepRight:"rangeRight",restFrom:"rest",spreadFrom:"spread",trimChars:"trim",trimCharsEnd:"trimEnd",trimCharsStart:"trimStart",zipAll:"zip"},o.skipFixed={castArray:!0,flow:!0,flowRight:!0,iteratee:!0,mixin:!0,rearg:!0,runInContext:!0},o.skipRearg={add:!0,assign:!0,assignIn:!0,bind:!0,bindKey:!0,concat:!0,difference:!0,divide:!0,eq:!0,gt:!0,gte:!0,isEqual:!0,lt:!0,lte:!0,matchesProperty:!0,merge:!0,multiply:!0,overArgs:!0,partial:!0,partialRight:!0,propertyOf:!0,random:!0,range:!0,rangeRight:!0,subtract:!0,zip:!0,zipObject:!0,zipObjectDeep:!0}})),Zb=(Jb.aliasToReal,Jb.aryMethod,Jb.aryRearg,Jb.iterateeAry,Jb.iterateeRearg,Jb.methodRearg,Jb.methodSpread,Jb.mutate,Jb.realToAlias,Jb.remap,Jb.skipFixed,Jb.skipRearg,{}),$b=Array.prototype.push;function eP(n,e){return freeOnUnref(2==e?function(e,t){return n(e,t)}:function(e){return n(e)})}function tP(e){for(var t=e?e.length:0,n=Array(t);t--;)n[t]=e[t];return n}function nP(r,i){return freeOnUnref(function(){var e=arguments.length;if(e){for(var t=Array(e);e--;)t[e]=arguments[e];var n=t[0]=i.apply(void 0,t);return r.apply(void 0,t),n}})}var rP=function l(n,e,t,r){var f="function"==typeof e,i=e===Object(e);if(i&&(r=t,t=e,e=void 0),null==t)throw new TypeError;r||(r={});var u={cap:!("cap"in r)||r.cap,curry:!("curry"in r)||r.curry,fixed:!("fixed"in r)||r.fixed,immutable:!("immutable"in r)||r.immutable,rearg:!("rearg"in r)||r.rearg},o=f?t:Zb,c="curry"in r&&r.curry,s="fixed"in r&&r.fixed,a="rearg"in r&&r.rearg,d=f?t.runInContext():void 0,p=f?t:{ary:n.ary,assign:n.assign,clone:n.clone,curry:n.curry,forEach:n.forEach,isArray:n.isArray,isError:n.isError,isFunction:n.isFunction,isWeakMap:n.isWeakMap,iteratee:n.iteratee,keys:n.keys,rearg:n.rearg,toInteger:n.toInteger,toPath:n.toPath},h=p.ary,m=p.assign,y=p.clone,g=p.curry,v=p.forEach,O=p.isArray,S=p.isError,U=p.isFunction,b=p.isWeakMap,P=p.keys,M=p.rearg,C=p.toInteger,E=p.toPath,T=P(Jb.aryMethod),w={castArray:freeOnUnref(function(t){return freeOnUnref(function(){var e=arguments[0];return O(e)?t(tP(e)):t.apply(void 0,arguments)})}),iteratee:freeOnUnref(function(i){return freeOnUnref(function(){var e=arguments[0],t=arguments[1],n=i(e,t),r=n.length;return u.cap&&"number"==typeof t?(t=2<t?t-2:1,r&&r<=t?n:eP(n,t)):n})}),mixin:freeOnUnref(function(e){return freeOnUnref(function(t){var n=this;if(!U(n))return e(n,Object(t));var r=[];return v(P(t),function(e){U(t[e])&&r.push([e,n.prototype[e]])}),e(n,Object(t)),v(r,function(e){var t=e[1];U(t)?n.prototype[e[0]]=t:delete n.prototype[e[0]]}),n})}),nthArg:freeOnUnref(function(n){return freeOnUnref(function(e){var t=e<0?1:C(e)+1;return g(n(e),t)})}),rearg:freeOnUnref(function(r){return freeOnUnref(function(e,t){var n=t?t.length:0;return g(r(e,t),n)})}),runInContext:freeOnUnref(function(t){return freeOnUnref(function(e){return l(n,t(e),r)})})};function I(e,t){if(u.cap){var n=Jb.iterateeRearg[e];if(n)return o=n,D(t,freeOnUnref(function(e){var n,t=o.length;return n=M(eP(e,t),o),freeOnUnref(2==t?function(e,t){return n.apply(void 0,arguments)}:function(e){return n.apply(void 0,arguments)})}));var r=!f&&Jb.iterateeAry[e];if(r)return i=r,D(t,freeOnUnref(function(e){return"function"==typeof e?eP(e,i):e}))}var i,o;return t}function k(e,t,n){if(u.fixed&&(s||!Jb.skipFixed[e])){var r=Jb.methodSpread[e],i=r&&r.start;return void 0===i?h(t,n):(o=t,a=i,freeOnUnref(function(){for(var e=arguments.length,t=e-1,n=Array(e);e--;)n[e]=arguments[e];var r=n[a],i=n.slice(0,a);return r&&$b.apply(i,r),a!=t&&$b.apply(i,n.slice(a+1)),o.apply(this,i)}))}var o,a;return t}function _(e,t,n){return u.rearg&&1<n&&(a||!Jb.skipRearg[e])?M(t,Jb.methodRearg[e]||Jb.aryRearg[n]):t}function R(e,t){for(var n=-1,r=(t=E(t)).length,i=r-1,o=y(Object(e)),a=o;null!=a&&++n<r;){var s=t[n],l=a[s];null==l||U(l)||S(l)||b(l)||(a[s]=y(n==i?l:Object(l))),a=a[s]}return o}function A(e,i){var o=Jb.aliasToReal[e]||e,a=Jb.remap[o]||o,s=r;return freeOnUnref(function(e){var t=f?d:p,n=f?d[a]:i,r=m(m({},s),e);return l(t,o,n,r)})}function D(r,i){return freeOnUnref(function(){var e=arguments.length;if(!e)return r();for(var t=Array(e);e--;)t[e]=arguments[e];var n=u.rearg?0:e-1;return t[n]=i(t[n]),r.apply(void 0,t)})}function x(e,t,n){var a,r,s=Jb.aliasToReal[e]||e,l=t,i=w[s];return i?l=i(t):u.immutable&&(Jb.mutate.array[s]?l=nP(t,tP):Jb.mutate.object[s]?l=nP(t,(r=t,freeOnUnref(function(e){return r({},e)}))):Jb.mutate.set[s]&&(l=nP(t,R))),v(T,freeOnUnref(function(o){return v(Jb.aryMethod[o],freeOnUnref(function(e){if(s==e){var t=Jb.methodSpread[s],n=t&&t.afterRearg;return a=n?k(s,_(s,l,o),o):_(s,k(s,l,o),o),a=I(s,a),r=a,i=o,a=c||u.curry&&1<i?g(r,i):r,!1}var r,i})),!a})),a||(a=l),a==t&&(a=c?g(a,1):freeOnUnref(function(){return t.apply(this,arguments)})),a.convert=A(s,t),a.placeholder=t.placeholder=n,a}if(!i)return x(e,t,o);var F=t,B=[];return v(T,freeOnUnref(function(e){v(Jb.aryMethod[e],freeOnUnref(function(e){var t=F[Jb.remap[e]||e];t&&B.push([e,x(e,t,F)])}))})),v(P(F),freeOnUnref(function(e){var t=F[e];if("function"==typeof t){for(var n=B.length;n--;)if(B[n][0]==e)return;t.convert=A(e,t),B.push([e,t])}})),v(B,freeOnUnref(function(e){F[e[0]]=e[1]})),F.convert=function(e){return F.runInContext.convert(e)(void 0)},F.placeholder=F,v(P(F),freeOnUnref(function(t){v(Jb.realToAlias[t]||[],freeOnUnref(function(e){F[e]=F[t]}))})),F},iP=Yb.runInContext(),oP=rP(iP,iP),aP=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=f.of("MediaBufferAdapterBase"),n=freeOnUnref(function(){function l(e,t,n,r,i,o,a){var s=this;this.NATIVE_FLUSHED_AU_CODE=60337,this.stateInternal=0,this.onStateChangeCallback=oP.noop,this.pendingFlushCallbacks=[],this.deferredFlushCallbacks=[],this.nativeAUCallback=freeOnUnref(function(e){if(0<s.enqueuedAUs&&(s.enqueuedAUs-=1),0===s.enqueuedAUs){for(var t=0,n=s.deferredFlushCallbacks;t<n.length;t++){(0,n[t])(l.NATIVE_SUCCESS_CODE)}-1!==s.flushWatchdogTimerId&&(s.timer.clearTimeout(s.flushWatchdogTimerId),s.flushWatchdogTimerId=-1),s.deferredFlushCallbacks=[]}if(e!==l.NATIVE_SUCCESS_CODE&&e!==s.NATIVE_FLUSHED_AU_CODE){var r="Native error code: "+e+" received in access unit callback";s.errorInternal=new Error(r),s.errorInternal.code=e,s.log.error("Will change state to Error due to "+r),s.updateState(6)&&s.onStateChangeCallback(s.stateInternal)}}),this.deferFlushCallback=freeOnUnref(function(e){var t=s.pendingFlushCallbacks.shift();null!=t&&(e!==l.NATIVE_SUCCESS_CODE||0===s.enqueuedAUs?t(e):(-1!==s.flushWatchdogTimerId&&s.timer.clearTimeout(s.flushWatchdogTimerId),s.flushWatchdogTimerId=s.timer.setTimeout(freeOnUnref(function(){s.flushWatchdogTimerId=-1;for(var e=0,t=s.deferredFlushCallbacks;e<t.length;e++){(0,t[e])(-3)}s.deferredFlushCallbacks=[]}),s.flushWatchdogTimeoutMs),s.deferredFlushCallbacks.push(t)))}),this.endOfStreamCalled=!1,this.hasEnqueuedAU=!1,this.maxEnqueuedAUs=0,this.enqueuedAUs=0,this.flushWatchdogTimerId=-1,this.sendEOSWhenReady=!1,this.nativeBuffer=e,this.nativeControl=t,this.timer=n,this.limitCapacity=r,this.queuedSamples=[],this.hasEnqueuedAUSinceFlush=!1,this.pendingReadyToPlay=!1,this.NATIVE_FLUSHED_AU_CODE=i.MPBCommandFlushed(),this.flushWatchdogTimeoutMs=o,this.enableFlushDeferral=null!=a&&null!=a.device&&!0===a.device.enableFlushDeferral}return l.prototype.init=freeOnUnref(function(e,t){r(0<=e,"capacityAus >= 0").is.true(),r(t,"handler").exists(),this.log.info("init capacity "+e),this.maxEnqueuedAUs=e,this.endOfStreamCalled=!1,this.hasEnqueuedAU=!1,this.enqueuedAUs=0,this.queuedSamples=[],this.deferredFlushCallbacks=[],this.pendingFlushCallbacks=[],-1!==this.flushWatchdogTimerId&&(this.timer.clearTimeout(this.flushWatchdogTimerId),this.flushWatchdogTimerId=-1);var n=this.adaptCallback("init",t,1);this.timer.setImmediate(freeOnUnref(function(){n(l.NATIVE_SUCCESS_CODE)}))}),l.prototype.onBufferAttached=freeOnUnref(function(e){this.mpbState=e}),l.prototype.shutdown=freeOnUnref(function(e){r(e,"handler").exists(),this.checkNotUninitialized("shutdown()"),this.log.info("shutdown"),this.pendingReadyToPlay=!1,this.sendEOSWhenReady=!1;var t=this.adaptCallback("shutdown",e,0);this.hasEnqueuedAU?this.doFlush(t):this.timer.setImmediate(freeOnUnref(function(){t(l.NATIVE_SUCCESS_CODE)})),null!=this.mpbState&&this.mpbState.reset()}),l.prototype.flush=freeOnUnref(function(e){if(r(e,"handler").exists(),this.checkNotUninitialized("flush()"),this.checkEndOfStreamNotCalled("flush()"),this.log.info("flush"),this.hasEnqueuedAUSinceFlush=!1,this.pendingReadyToPlay=!1,3===this.mpbState.status)this.log.info("MPB status is Ready. Executing flush()"),this.doFlush(this.adaptCallback("flush",e,3));else if(0===this.mpbState.status)this.log.info("MPB status is Uninitialized. Resetting buffer state to not ready"),this.queuedSamples.length=0,this.mpbState.setBufferReady(!1),e();else{if(null!=this.mpbState.pendingFlush)throw new Error("flush() called while a previous flush is still pending");this.log.info("MPB status is Initializing. Saving flush for later"),this.queuedSamples.length=0,this.mpbState.pendingFlush=this.adaptCallback("flush",e,3)}}),l.prototype.performPendingFlush=freeOnUnref(function(e){var n=this;if(null!=this.mpbState.pendingFlush){var r=this.mpbState.pendingFlush;if(delete this.mpbState.pendingFlush,this.enableFlushDeferral){var t=new lt.Promise(freeOnUnref(function(t){n.pendingFlushCallbacks.push(freeOnUnref(function(e){r(e),t()}))}));return this.deferFlushCallback(e),t}return r(e),lt.Promise.resolve()}return lt.Promise.resolve()}),l.prototype.endOfStream=freeOnUnref(function(){this.checkNotUninitialized("endOfStream()"),this.log.info("endOfStream"),this.hasEnqueuedAU||0!==this.queuedSamples.length||this.switchToErrorStateAndRaiseError({message:"endOfStream() called before any AUs have been fed",errorCode:-1}),this.endOfStreamCalled=!0,3!==this.mpbState.status?(this.log.info("MPB is not yet ready. Saving `endOfStream` call for later"),this.sendEOSWhenReady=!0):this.checkMPBErrorCode(this.nativeBuffer.streamFinish(this.adaptNativeBufferErrorCallback("nativeBuffer.streamFinish")))}),l.prototype.onStateChange=freeOnUnref(function(e){r(e,"callback").exists(),this.onStateChangeCallback=e}),l.prototype.offStateChange=freeOnUnref(function(){this.onStateChangeCallback=oP.noop}),Object.defineProperty(l.prototype,"state",{get:freeOnUnref(function(){return this.stateInternal}),enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"error",{get:freeOnUnref(function(){return this.errorInternal}),enumerable:!0,configurable:!0}),l.prototype.enqueueSample=freeOnUnref(function(e){if(r(e,"sample").exists(),0===e.data.byteLength)return this.log.info("Enqueued sample at pts "+e.pts+" with duration "+e.duration+", had zero bytes, ignoring. encrypted="+e.isEncrypted),"Success";if(this.checkNotUninitialized("enqueueSample()"),this.checkEndOfStreamNotCalled("enqueueSample()"),3===this.mpbState.status)return this.doEnqueueSample(e);if((1===this.mpbState.status||2===this.mpbState.status)&&null!=this.mpbState.pendingFlush)throw new Error("Attempting to enqueue a sample while a flush is pending!");return this.queuedSamples.length<this.maxEnqueuedAUs?(this.queuedSamples.push(e),0===this.mpbState.status&&!this.mpbState.isBufferReady&&this.canInitializeMPB()?(this.log.info("Buffer is now ready"),this.mpbState.setBufferReady(!0)):2===this.mpbState.status&&null==this.mpbState.pendingFlush&&this.doSendSamples(),"Success"):"BufferFull"}),l.prototype.doSendSamples=freeOnUnref(function(){var e=this.queuedSamples;this.queuedSamples=[];for(var t=0,n=e;t<n.length;t++){var r=n[t];this.doEnqueueSample(r)}}),l.prototype.onReadyToPlay=freeOnUnref(function(){var e=this;if(this.checkNotUninitialized("onReadyToPlay"),this.hasEnqueuedAUSinceFlush){if(this.sendEOSWhenReady&&3===this.mpbState.status){this.log.info("Invoking streamFinish: MPB is Ready"),this.sendEOSWhenReady=!1;var t=this.nativeBuffer.streamFinish(this.adaptNativeBufferErrorCallback("nativeBuffer.streamFinish"));t!==l.NATIVE_SUCCESS_CODE&&(this.errorInternal=new Error("Native error code: "+t+" received as return value of nativeBuffer.streamFinish"),this.errorInternal.code=t,this.log.error("Switching to error state with code: "+t+" and message: "+this.errorInternal.message),this.updateState(6)&&this.timer.setImmediate(freeOnUnref(function(){e.onStateChangeCallback(e.stateInternal)})))}this.updateState(4)&&this.onStateChangeCallback(this.stateInternal)}else this.pendingReadyToPlay=!0}),l.prototype.onUnderrun=freeOnUnref(function(){this.checkNotUninitialized("onUnderrun"),this.pendingReadyToPlay=!1,this.updateState(3)&&this.onStateChangeCallback(this.stateInternal)}),l.prototype.onEndOfStream=freeOnUnref(function(){this.checkNotUninitialized("onEndOfStream"),this.updateState(5)&&this.onStateChangeCallback(this.stateInternal)}),l.prototype.adaptNativeBufferErrorCallback=freeOnUnref(function(n,r){var i=this;return void 0===r&&(r=!1),freeOnUnref(function(e){if(e!==l.NATIVE_SUCCESS_CODE){if(e===i.NATIVE_FLUSHED_AU_CODE)return i.log.warn("Native error code: "+e+" received in callback for native function "+n+": ignoring."),void(r&&(i.log.info("Setting hasEnqueuedAU to false since startStream was flushed, so next AU will send streamStart again"),i.hasEnqueuedAU=!1));var t="Native error code: "+e+" received in callback for native function "+n;i.log.error("Will change to Error state due to "+t),i.errorInternal=new Error(t),i.errorInternal.code=e,i.updateState(6)&&i.onStateChangeCallback(i.stateInternal)}})}),l.prototype.adaptNativeBufferErrorCallbackStreamStart=freeOnUnref(function(){return this.adaptNativeBufferErrorCallback("nativeBuffer.streamStart",!0)}),l.prototype.adaptCallback=freeOnUnref(function(i,o,a){var s=this;return freeOnUnref(function(e){var t=!1;if(0===e)t=s.updateState(a),o();else{var n="Native error code: "+e+" received in "+i+" callback while transferring to state "+a,r=new Error(n);r.code=e,s.errorInternal=r,s.log.error(n),t=s.updateState(6),o(r)}t&&s.onStateChangeCallback(s.stateInternal)})}),l.prototype.doFlush=freeOnUnref(function(e){this.enableFlushDeferral?(this.pendingFlushCallbacks.push(e),this.checkMPBErrorCode(this.nativeControl.flush(this.deferFlushCallback))):this.checkMPBErrorCode(this.nativeControl.flush(e))}),l.prototype.checkNotUninitialized=freeOnUnref(function(e){if(0===this.stateInternal){var t=new Error("Cannot call "+e+" on an Uninitialized buffer");throw t.code=-1,t}}),l.prototype.checkEndOfStreamNotCalled=freeOnUnref(function(e){if(this.endOfStreamCalled){var t=new Error("Cannot call "+e+" after end of stream has been called");throw t.code=-2,t}}),l.prototype.switchToErrorStateAndRaiseError=freeOnUnref(function(e){var t=this;throw this.errorInternal=new Error(e.message),this.errorInternal.code=e.errorCode,this.log.error("Switching to error state with code: "+e.errorCode+" and message: "+e.message),this.updateState(6)&&this.timer.setImmediate(freeOnUnref(function(){t.onStateChangeCallback(t.stateInternal)})),this.errorInternal}),l.prototype.checkMPBErrorCode=freeOnUnref(function(e){e!==l.NATIVE_SUCCESS_CODE&&this.switchToErrorStateAndRaiseError({errorCode:e,message:"Native error code: "+e+" received as return value"})}),l.prototype.updateState=freeOnUnref(function(e){var t=this.stateInternal!==e;return t&&this.log.info("Changing state to "+e+", previous state was "+this.stateInternal),this.stateInternal=e,t}),l.getEncryptedRegionsAsUint8Array=freeOnUnref(function(e){for(var t=new Uint32Array(2*e.length),n=0;n<e.length;n++)t[2*n]=e[n].bytesOfClearData,t[2*n+1]=e[n].bytesOfEncryptedData;return new Uint8Array(t.buffer,0,t.buffer.byteLength/Uint8Array.BYTES_PER_ELEMENT)}),l.prototype.canInitializeMPB=freeOnUnref(function(){return 1<this.queuedSamples.length&&this.queuedSamples.some(freeOnUnref(function(e){return!e.isCodecPrivateData}))}),l.prototype.tryReportPendingReadyToPlay=freeOnUnref(function(){this.pendingReadyToPlay&&(this.onReadyToPlay(),this.pendingReadyToPlay=!1)}),l.NATIVE_SUCCESS_CODE=0,l})();t.MediaBufferAdapterBase=n}));e(aP);aP.MediaBufferAdapterBase;var sP=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var i=f.of("AudioBufferAdapter"),n=freeOnUnref(function(s){function n(e,t,n,r,i,o){void 0===e&&(e=re.connector.mpbFactoryAPI),void 0===t&&(t=oe.timer),void 0===n&&(n=!1),void 0===r&&(r=re.connector.errorCodeAPI),void 0===i&&(i=1e4),void 0===o&&(o=L.configurationStore);var a=s.call(this,e.getMPBAudioBufferAPI(),e.getMPBCommandAPI(),t,n,r,i,o.configuration)||this;return a.log=de.get("AudioBufferAdapter"),a}return r(n,s),n.prototype.initializeCodec=freeOnUnref(function(e,t){i(t,"handler").exists(),i(e,"metadata").exists(),this.checkNotUninitialized("initializeCodec()"),this.checkEndOfStreamNotCalled("initializeCodec()"),this.log.info("initializeCodec codecType "+JSON.stringify(e)),this.checkMPBErrorCode(this.nativeControl.onAudioMetadata(e.codecType,e.sampleRate,e.numChannels,this.adaptCallback("onAudioMetadata",t,2)))}),n.prototype.doEnqueueSample=freeOnUnref(function(e){return this.hasEnqueuedAU||(this.log.info("enqueuing first sample"),this.checkMPBErrorCode(this.nativeBuffer.streamStart(this.adaptNativeBufferErrorCallbackStreamStart()))),this.limitCapacity&&this.enqueuedAUs>=this.maxEnqueuedAUs?"BufferFull":(t=null!=e.encryptionInfo?e.encryptionInfo:{initializationVector:new Uint8Array([]),encryptedRegions:[],sessionId:"",keyId:new Uint8Array([])},this.checkMPBErrorCode(this.nativeBuffer.onAudioAccessUnit(e.pts,e.duration,e.timescale,e.data,e.isEncrypted,t.initializationVector,t.encryptedRegions.length,n.getEncryptedRegionsAsUint8Array(t.encryptedRegions),t.keyId,t.sessionId,this.nativeAUCallback)),this.enqueuedAUs+=1,this.hasEnqueuedAU=!0,this.hasEnqueuedAUSinceFlush=!0,this.tryReportPendingReadyToPlay(),"Success");var t}),n})(aP.MediaBufferAdapterBase);t.AudioBufferAdapter=n}));e(sP);sP.AudioBufferAdapter;var lP=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var i=f.of("VideoBufferAdapter"),n=freeOnUnref(function(s){function n(e,t,n,r,i,o){void 0===e&&(e=re.connector.mpbFactoryAPI),void 0===t&&(t=oe.timer),void 0===n&&(n=!1),void 0===r&&(r=re.connector.errorCodeAPI),void 0===i&&(i=1e4),void 0===o&&(o=L.configurationStore);var a=s.call(this,e.getMPBVideoBufferAPI(),e.getMPBCommandAPI(),t,n,r,i,o.configuration)||this;return a.onCodecInitializedCb=oP.noop,a.log=de.get("VideoBufferAdapter"),a}return r(n,s),n.prototype.initializeCodec=freeOnUnref(function(e,t){i(t,"handler").exists(),i(e,"metadata").exists(),this.checkNotUninitialized("initializeCodec()"),this.checkEndOfStreamNotCalled("initializeCodec()"),this.log.info("initializeCodec codecType "+JSON.stringify(e)),this.videoMetadata=e,this.checkMPBErrorCode(this.nativeControl.onVideoMetadata(e.codecType,e.maxResolution.width,e.maxResolution.height,e.frameRate,this.adaptCallback("onVideoMetadata",t,2))),this.onCodecInitializedCb(e)}),n.prototype.onCodecInitialized=freeOnUnref(function(e){this.onCodecInitializedCb=e,0!==this.state&&1!==this.state&&this.onCodecInitializedCb(this.videoMetadata)}),n.convertFromPrefixLengthToPrefixCode=freeOnUnref(function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=0;if(1!==t.getUint32(0))for(;n<t.byteLength;){var r=t.getUint32(n);t.setUint32(n,1),n+=r+4}}),n.prototype.doEnqueueSample=freeOnUnref(function(e){return this.hasEnqueuedAU||(this.log.info("enqueuing first sample"),this.checkMPBErrorCode(this.nativeBuffer.streamStart(this.adaptNativeBufferErrorCallbackStreamStart()))),this.limitCapacity&&this.enqueuedAUs>=this.maxEnqueuedAUs?"BufferFull":(void 0!==this.videoMetadata&&"VIDEO_CODEC_AV1"!==this.videoMetadata.codecType&&n.convertFromPrefixLengthToPrefixCode(e.data),t=null!=e.encryptionInfo?e.encryptionInfo:{initializationVector:new Uint8Array([]),encryptedRegions:[],sessionId:"",keyId:new Uint8Array([])},this.checkMPBErrorCode(this.nativeBuffer.onVideoAccessUnit(e.pts,e.duration,e.timescale,e.resolution.width,e.resolution.height,e.isCodecPrivateData,e.data,e.isEncrypted,t.initializationVector,t.encryptedRegions.length,n.getEncryptedRegionsAsUint8Array(t.encryptedRegions),t.keyId,t.sessionId,this.nativeAUCallback)),this.enqueuedAUs+=1,this.hasEnqueuedAU=!0,this.hasEnqueuedAUSinceFlush=!0,this.tryReportPendingReadyToPlay(),"Success");var t}),n})(aP.MediaBufferAdapterBase);t.VideoBufferAdapter=n}));e(lP);lP.VideoBufferAdapter;var fP=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioBuffer=sP.AudioBufferAdapter,t.VideoBuffer=lP.VideoBufferAdapter}));e(fP);fP.AudioBuffer,fP.VideoBuffer;var uP=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=f.of("MediaBufferAdapterBase"),n=freeOnUnref(function(){function e(e,t,n){this.timer=e,this.log=t,this.bufferConnector=n,this.stateInternal=0,this.onStateChangeCallback=l.noop,this.endOfStreamCalled=!1,this.hasEnqueuedSample=!1,this.notReadyToReceiveSamplesLogCount=0}return Object.defineProperty(e.prototype,"state",{get:freeOnUnref(function(){return this.stateInternal}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:freeOnUnref(function(){return this.errorInternal}),enumerable:!0,configurable:!0}),e.prototype.setBufferConnector=freeOnUnref(function(e){if(0!==this.stateInternal)throw new Error("Can only set new buffer connector when state is 0, current state is "+this.stateInternal);this.bufferConnector=e}),e.prototype.init=freeOnUnref(function(e,t){var n=this;r(t,"handler").exists(),this.log.info("init"),this.endOfStreamCalled=!1,this.hasEnqueuedSample=!1,this.timer.setImmediate(freeOnUnref(function(){return n.resolveHandlerAfterUpdatingState(t,1)}))}),e.prototype.shutdown=freeOnUnref(function(e){var t=this;r(e,"handler").exists(),this.checkNotUninitialized("shutdown()"),this.log.info("shutdown"),this.bufferConnector=void 0,this.timer.setImmediate(freeOnUnref(function(){return t.resolveHandlerAfterUpdatingState(e,0)}))}),e.prototype.flush=freeOnUnref(function(e){var t=this;this.checkNotUninitialized("flush (no-op for MML)"),this.log.info("flush (no-op for MML)"),this.timer.setImmediate(freeOnUnref(function(){return t.resolveHandlerAfterUpdatingState(e,3)}))}),e.prototype.endOfStream=freeOnUnref(function(){var e=this;this.checkNotUninitialized("endOfStream()"),this.log.info("endOfStream"),this.hasEnqueuedSample||this.raiseError({message:"endOfStream() called before any AUs have been fed",code:-1}),this.endOfStreamCalled=!0;var t=this.doEndOfStream();t!==p.MPBErrors.OK&&this.timer.setImmediate(freeOnUnref(function(){e.switchToErrorState({message:"Native error code: "+t+" received during endOfStream",code:t})}))}),e.prototype.onReadyToPlay=freeOnUnref(function(){this.checkNotUninitialized("onReadyToPlay"),this.updateState(4)&&this.onStateChangeCallback(this.stateInternal)}),e.prototype.onUnderrun=freeOnUnref(function(){this.checkNotUninitialized("onUnderrun"),this.updateState(3)&&this.onStateChangeCallback(this.stateInternal)}),e.prototype.onEndOfStream=freeOnUnref(function(){this.checkNotUninitialized("onEndOfStream"),this.updateState(5)&&this.onStateChangeCallback(this.stateInternal)}),e.prototype.onStateChange=freeOnUnref(function(e){r(e,"callback").exists(),this.onStateChangeCallback=e}),e.prototype.offStateChange=freeOnUnref(function(){this.onStateChangeCallback=l.noop}),e.prototype.initializeCodec=freeOnUnref(function(e,t){this.checkNotUninitialized("initializeCodec"),this.checkEndOfStreamNotCalled("initializeCodec"),this.log.info("initializeCodec "+JSON.stringify(e));var n=this.doSetMetadata(e),r=this.adaptCallback(t,2);this.timer.setImmediate(freeOnUnref(function(){return r(n)}))}),e.prototype.enqueueSample=freeOnUnref(function(e){this.checkNotUninitialized("enqueueSample()"),this.checkEndOfStreamNotCalled("enqueueSample()");var t=this.doEnqueueSample(e);return this.handleEnqueueSampleResult(t)}),e.prototype.resolveHandlerAfterUpdatingState=freeOnUnref(function(e,t){var n=this.updateState(t);e(),n&&this.onStateChangeCallback(this.stateInternal)}),e.prototype.adaptCallback=freeOnUnref(function(r,i){var o=this;return freeOnUnref(function(e){var t=!1;if(e===p.MPBErrors.OK)t=o.updateState(i),r();else{t=o.updateState(6);var n=new Error("Native error code: "+e+" received in callback while transferring to state "+i);n.code=e,o.errorInternal=n,r(n)}t&&o.onStateChangeCallback(o.stateInternal)})}),e.prototype.checkNotUninitialized=freeOnUnref(function(e){if(0===this.stateInternal){var t=new Error("Cannot call "+e+" on an Uninitialized buffer");throw t.code=-1,t}}),e.prototype.checkEndOfStreamNotCalled=freeOnUnref(function(e){if(this.endOfStreamCalled){var t=new Error("Cannot call "+e+" after end of stream has been called");throw t.code=-2,t}}),e.prototype.switchToErrorState=freeOnUnref(function(e){this.errorInternal=new Error(e.message),this.errorInternal.code=e.code,this.updateState(6)&&this.onStateChangeCallback(this.stateInternal)}),e.prototype.raiseError=freeOnUnref(function(e){throw this.switchToErrorState(e),this.errorInternal}),e.prototype.updateState=freeOnUnref(function(e){var t=this.stateInternal!==e;return t&&this.log.info("Changing state to "+e+", previous state was "+this.stateInternal),this.stateInternal=e,t}),e.prototype.getEncryptedRegionsAsUint8Array=freeOnUnref(function(e){e.length<0&&this.log.error("[neguintarray] Negative size "+e.length+" constructing EncryptedRegionsArray");for(var t=new Uint32Array(2*e.length),n=0;n<e.length;n++)t[2*n]=e[n].bytesOfClearData,t[2*n+1]=e[n].bytesOfEncryptedData;return new Uint8Array(t.buffer,0,t.buffer.byteLength/Uint8Array.BYTES_PER_ELEMENT)}),e.prototype.handleEnqueueSampleResult=freeOnUnref(function(e){var t=this;if(e===p.MPBErrors.OK)return this.hasEnqueuedSample=!0,"Success";if(e===p.MPBErrors.BUFFER_FULL)return"BufferFull";if(e===p.MPBErrors.NOT_READY_TO_RECEIVE_SAMPLES)return this.notReadyToReceiveSamplesLogCount%10==0&&(this.log.warn("MPB is not ready to receive samples"),this.notReadyToReceiveSamplesLogCount=0),this.notReadyToReceiveSamplesLogCount++,"NotReady";var n="Native error code: "+e+" received as return value in enqueueSample";return this.timer.setImmediate(freeOnUnref(function(){t.switchToErrorState({message:n,code:e})})),"Success"}),e})();t.MediaBufferAdapterBase=n}));e(uP);uP.MediaBufferAdapterBase;var cP=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e,t){return void 0===t&&(t=oe.timer),n.call(this,t,de.get("MMLAudioBufferAdapter"),e)||this}return r(e,n),e.prototype.doEnqueueSample=freeOnUnref(function(e){if(0===e.data.byteLength)return this.log.info("Enqueued audio sample at pts "+e.pts+" with duration "+e.duration+" had zero bytes, ignoring. encrypted="+e.isEncrypted),p.MPBErrors.OK;var t=e;if(t.isEncrypted){if(null==t.encryptionInfo)throw new Error("Encrypted audio sample is missing encryptionInfo "+t.encryptionInfo);var n=this.getEncryptedRegionsAsUint8Array(t.encryptionInfo.encryptedRegions);return this.bufferConnector.encryptedAudioSample(t.data,t.pts,t.duration,t.timescale,t.encryptionInfo.initializationVector,t.encryptionInfo.encryptedRegions.length,n,t.encryptionInfo.keyId,t.encryptionInfo.sessionId)}return this.bufferConnector.audioSample(t.data,t.pts,t.duration,t.timescale)}),e.prototype.doSetMetadata=freeOnUnref(function(e){var t=e;return this.bufferConnector.audioMetadata(t.codecType,t.sampleRate,t.numChannels)}),e.prototype.doEndOfStream=freeOnUnref(function(){return this.bufferConnector.audioEndOfStream()}),e})(uP.MediaBufferAdapterBase);t.AudioBufferAdapter=n}));e(cP);cP.AudioBufferAdapter;var dP=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function o(e,t){void 0===t&&(t=oe.timer);var n=r.call(this,t,de.get("MMLVideoBufferAdapter"),e)||this;return n.onCodecInitializedCb=l.noop,n}return n(o,r),o.prototype.init=freeOnUnref(function(e,t){r.prototype.init.call(this,e,t),this.lastDisplayAspectRatio=0}),o.prototype.onCodecInitialized=freeOnUnref(function(e){this.onCodecInitializedCb=e,0!==this.state&&1!==this.state&&this.onCodecInitializedCb(this.videoMetadata)}),o.convertFromPrefixLengthToPrefixCode=freeOnUnref(function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=0;if(1!==t.getUint32(0))for(;n<t.byteLength;){var r=t.getUint32(n);t.setUint32(n,1),n+=r+4}}),o.prototype.doEnqueueSample=freeOnUnref(function(e){var t=e,n=t.visualPresentationSize;if(null!=this.videoMetadata&&"VIDEO_CODEC_AV1"===this.videoMetadata.codecType&&null!=n&&1<=n.width&&1<=n.height&&n.width<=65535&&n.height<=65535){var r=n.width/n.height;if(0<r&&r!==this.lastDisplayAspectRatio){var i=this.doSendDisplayAspectRatio(r);i!==p.MPBErrors.OK&&i!==p.MPBErrors.KEY_NOT_FOUND&&this.log.error("Failed to send display aspect ratio "+r+", error code: "+i),this.lastDisplayAspectRatio=r}}if(0===t.data.byteLength)return this.log.info("Enqueued video sample at pts "+e.pts+" with duration "+e.duration+" had zero bytes, ignoring. encrypted="+e.isEncrypted),p.MPBErrors.OK;if(void 0!==this.videoMetadata&&"VIDEO_CODEC_AV1"!==this.videoMetadata.codecType&&o.convertFromPrefixLengthToPrefixCode(t.data),t.isEncrypted){if(null==t.encryptionInfo)throw new Error("Encrypted video sample is missing encryptionInfo "+e.encryptionInfo);return this.bufferConnector.encryptedVideoSample(t.data,t.pts,t.duration,t.timescale,t.resolution.width,t.resolution.height,t.isCodecPrivateData,t.encryptionInfo.initializationVector,t.encryptionInfo.encryptedRegions.length,this.getEncryptedRegionsAsUint8Array(t.encryptionInfo.encryptedRegions),t.encryptionInfo.keyId,t.encryptionInfo.sessionId)}return this.bufferConnector.videoSample(t.data,t.pts,t.duration,t.timescale,t.resolution.width,t.resolution.height,t.isCodecPrivateData)}),o.prototype.doSetMetadata=freeOnUnref(function(e){var t=this,n=e;this.videoMetadata=n;var r=this.bufferConnector.videoMetadata(n.codecType,n.maxResolution.width,n.maxResolution.height,n.frameRate);return r===p.MPBErrors.OK&&this.timer.setImmediate(freeOnUnref(function(){return t.onCodecInitializedCb(n)})),r}),o.prototype.doEndOfStream=freeOnUnref(function(){return this.bufferConnector.videoEndOfStream()}),o.prototype.doSendDisplayAspectRatio=freeOnUnref(function(e){return this.bufferConnector.setDisplayAspectRatio(e)}),o})(uP.MediaBufferAdapterBase);t.VideoBufferAdapter=r}));e(dP);dP.VideoBufferAdapter;var pP=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioBuffer=cP.AudioBufferAdapter,t.VideoBuffer=dP.VideoBufferAdapter}));e(pP);pP.AudioBuffer,pP.VideoBuffer;var hP=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(){return new(Si.chooseImplementation(fP.AudioBuffer,pP.AudioBuffer))}})();t.AudioBufferInterceptor=n}));e(hP);hP.AudioBufferInterceptor;var mP=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(){return new(Si.chooseImplementation(fP.VideoBuffer,pP.VideoBuffer))}})();t.VideoBufferInterceptor=n}));e(mP);mP.VideoBufferInterceptor;var yP=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioBuffer=hP.AudioBufferInterceptor,t.VideoBuffer=mP.VideoBufferInterceptor}));e(yP);yP.AudioBuffer,yP.VideoBuffer;var gP=function(e){return e},vP="object"==typeof ce&&ce&&ce.Object===Object&&ce,OP="object"==typeof self&&self&&self.Object===Object&&self,SP=vP||OP||Function("return this")(),UP=SP.Symbol,bP=Object.prototype,PP=bP.hasOwnProperty,MP=bP.toString,CP=UP?UP.toStringTag:void 0;var EP=function(e){var t=PP.call(e,CP),n=e[CP];try{var r=!(e[CP]=void 0)}catch(e){}var i=MP.call(e);return r&&(t?e[CP]=n:delete e[CP]),i},TP=Object.prototype.toString;var wP=function(e){return TP.call(e)},IP=UP?UP.toStringTag:void 0;var kP=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":IP&&IP in Object(e)?EP(e):wP(e)};var _P=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var RP=function(e){if(!_P(e))return!1;var t=kP(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},AP=SP["__core-js_shared__"],DP=freeOnUnref(function(){var e=/[^.]+$/.exec(AP&&AP.keys&&AP.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""})();var xP=function(e){return!!DP&&DP in e},FP=Function.prototype.toString;var BP=function(e){if(null!=e){try{return FP.call(e)}catch(e){}try{return e+""}catch(e){}}return""},LP=/^\[object .+?Constructor\]$/,NP=Function.prototype,VP=Object.prototype,jP=NP.toString,qP=VP.hasOwnProperty,HP=RegExp("^"+jP.call(qP).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var zP=function(e){return!(!_P(e)||xP(e))&&(RP(e)?HP:LP).test(BP(e))};var WP=function(e,t){return null==e?void 0:e[t]};var KP=function(e,t){var n=WP(e,t);return zP(n)?n:void 0},GP=KP(SP,"WeakMap"),QP=GP&&new GP,XP=QP?freeOnUnref(function(e,t){return QP.set(e,t),e}):gP,YP=Object.create,JP=freeOnUnref(function(){function n(){}return freeOnUnref(function(e){if(!_P(e))return{};if(YP)return YP(e);n.prototype=e;var t=new n;return n.prototype=void 0,t})})();var ZP=function(r){return freeOnUnref(function(){var e=arguments;switch(e.length){case 0:return new r;case 1:return new r(e[0]);case 2:return new r(e[0],e[1]);case 3:return new r(e[0],e[1],e[2]);case 4:return new r(e[0],e[1],e[2],e[3]);case 5:return new r(e[0],e[1],e[2],e[3],e[4]);case 6:return new r(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new r(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var t=JP(r.prototype),n=r.apply(t,e);return _P(n)?n:t})};var $P=function(t,e,n){var r=1&e,i=ZP(t);return function e(){return(this&&this!==SP&&this instanceof e?i:t).apply(r?n:this,arguments)}};var eM=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},tM=Math.max;var nM=function(e,t,n,r){for(var i=-1,o=e.length,a=n.length,s=-1,l=t.length,f=tM(o-a,0),u=Array(l+f),c=!r;++s<l;)u[s]=t[s];for(;++i<a;)(c||i<o)&&(u[n[i]]=e[i]);for(;f--;)u[s++]=e[i++];return u},rM=Math.max;var iM=function(e,t,n,r){for(var i=-1,o=e.length,a=-1,s=n.length,l=-1,f=t.length,u=rM(o-s,0),c=Array(u+f),d=!r;++i<u;)c[i]=e[i];for(var p=i;++l<f;)c[p+l]=t[l];for(;++a<s;)(d||i<o)&&(c[p+n[a]]=e[i++]);return c};var oM=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r};var aM=function(){};function sM(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}var lM=(sM.prototype=JP(aM.prototype)).constructor=sM;var fM=function(){},uM=QP?freeOnUnref(function(e){return QP.get(e)}):fM,cM={},dM=Object.prototype.hasOwnProperty;var pM=function(e){for(var t=e.name+"",n=cM[t],r=dM.call(cM,t)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t};function hM(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}var mM=(hM.prototype=JP(aM.prototype)).constructor=hM,yM=Array.isArray;var gM=function(e){return null!=e&&"object"==typeof e};var vM=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t};var OM=function(e){if(e instanceof lM)return e.clone();var t=new mM(e.__wrapped__,e.__chain__);return t.__actions__=vM(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t},SM=Object.prototype.hasOwnProperty;function UM(e){if(gM(e)&&!yM(e)&&!(e instanceof lM)){if(e instanceof mM)return e;if(SM.call(e,"__wrapped__"))return OM(e)}return new mM(e)}var bM=(UM.prototype=aM.prototype).constructor=UM;var PM=function(e){var t=pM(e),n=bM[t];if("function"!=typeof n||!(t in lM.prototype))return!1;if(e===n)return!0;var r=uM(n);return!!r&&e===r[0]},MM=Date.now;var CM=function(n){var r=0,i=0;return freeOnUnref(function(){var e=MM(),t=16-(e-i);if(i=e,0<t){if(800<=++r)return arguments[0]}else r=0;return n.apply(void 0,arguments)})},EM=CM(XP),TM=/\{\n\/\* \[wrapped with (.+)\] \*/,wM=/,? & /;var IM=function(e){var t=e.match(TM);return t?t[1].split(wM):[]},kM=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;var _M=function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(1<n?"& ":"")+t[r],t=t.join(2<n?", ":" "),e.replace(kM,"{\n/* [wrapped with "+t+"] */\n")};var RM=function(e){return freeOnUnref(function(){return e})},AM=freeOnUnref(function(){try{var e=KP(Object,"defineProperty");return e({},"",{}),e}catch(e){}})(),DM=CM(AM?freeOnUnref(function(e,t){return AM(e,"toString",{configurable:!0,enumerable:!1,value:RM(t),writable:!0})}):gP);var xM=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e};var FM=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1};var BM=function(e){return e!=e};var LM=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1};var NM=function(e,t,n){return t==t?LM(e,t,n):FM(e,BM,n)};var VM=function(e,t){return!(null==e||!e.length)&&-1<NM(e,t,0)},jM=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];var qM=function(n,r){return xM(jM,freeOnUnref(function(e){var t="_."+e[0];r&e[1]&&!VM(n,t)&&n.push(t)})),n.sort()};var HM=function(e,t,n){var r=t+"";return DM(e,_M(r,qM(IM(r),n)))};var zM=function(e,t,n,r,i,o,a,s,l,f){var u=8&t;t|=u?32:64,4&(t&=~(u?64:32))||(t&=-4);var c=[e,t,i,u?o:void 0,u?a:void 0,u?void 0:o,u?void 0:a,s,l,f],d=n.apply(void 0,c);return PM(e)&&EM(d,c),d.placeholder=r,HM(d,e,t)};var WM=function(e){return e.placeholder},KM=/^(?:0|[1-9]\d*)$/;var GM=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&KM.test(e))&&-1<e&&e%1==0&&e<t},QM=Math.min;var XM=function(e,t){for(var n=e.length,r=QM(t.length,n),i=vM(e);r--;){var o=t[r];e[r]=GM(o,n)?i[o]:void 0}return e},YM="__lodash_placeholder__";var JM=function(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n];a!==t&&a!==YM||(e[n]=YM,o[i++]=n)}return o},ZM=1,$M=2,eC=8,tC=16,nC=128,rC=512;var iC=function f(u,c,d,p,h,m,y,g,v,O){var S=c&nC,U=c&ZM,b=c&$M,P=c&(eC|tC),M=c&rC,C=b?void 0:ZP(u);return function e(){for(var t=arguments.length,n=Array(t),r=t;r--;)n[r]=arguments[r];if(P)var i=WM(e),o=oM(n,i);if(p&&(n=nM(n,p,h,P)),m&&(n=iM(n,m,y,P)),t-=o,P&&t<O){var a=JM(n,i);return zM(u,c,f,e.placeholder,d,n,a,g,v,O-t)}var s=U?d:this,l=b?s[u]:u;return t=n.length,g?n=XM(n,g):M&&1<t&&n.reverse(),S&&v<t&&(n.length=v),this&&this!==SP&&this instanceof e&&(l=C||ZP(l)),l.apply(s,n)}};var oC=function(a,s,l){var f=ZP(a);return function e(){for(var t=arguments.length,n=Array(t),r=t,i=WM(e);r--;)n[r]=arguments[r];var o=t<3&&n[0]!==i&&n[t-1]!==i?[]:JM(n,i);return(t-=o.length)<l?zM(a,s,iC,e.placeholder,void 0,n,o,void 0,void 0,l-t):eM(this&&this!==SP&&this instanceof e?f:a,this,n)}};var aC=function(s,e,l,f){var u=1&e,c=ZP(s);return function e(){for(var t=-1,n=arguments.length,r=-1,i=f.length,o=Array(i+n),a=this&&this!==SP&&this instanceof e?c:s;++r<i;)o[r]=f[r];for(;n--;)o[r++]=arguments[++t];return eM(a,u?l:this,o)}},sC="__lodash_placeholder__",lC=Math.min;var fC=function(e,t){var n=e[1],r=t[1],i=n|r,o=i<131,a=128==r&&8==n||128==r&&256==n&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(!o&&!a)return e;1&r&&(e[2]=t[2],i|=1&n?0:4);var s=t[3];if(s){var l=e[3];e[3]=l?nM(l,s,t[4]):s,e[4]=l?JM(e[3],sC):t[4]}return(s=t[5])&&(l=e[5],e[5]=l?iM(l,s,t[6]):s,e[6]=l?JM(e[5],sC):t[6]),(s=t[7])&&(e[7]=s),128&r&&(e[8]=null==e[8]?t[8]:lC(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i,e},uC=/\s/;var cC=function(e){for(var t=e.length;t--&&uC.test(e.charAt(t)););return t},dC=/^\s+/;var pC=function(e){return e?e.slice(0,cC(e)+1).replace(dC,""):e};var hC=function(e){return"symbol"==typeof e||gM(e)&&"[object Symbol]"==kP(e)},mC=/^[-+]0x[0-9a-f]+$/i,yC=/^0b[01]+$/i,gC=/^0o[0-7]+$/i,vC=parseInt;var OC=function(e){if("number"==typeof e)return e;if(hC(e))return NaN;if(_P(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=_P(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=pC(e);var n=yC.test(e);return n||gC.test(e)?vC(e.slice(2),n?2:8):mC.test(e)?NaN:+e};var SC=function(e){return e?(e=OC(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};var UC=function(e){var t=SC(e),n=t%1;return t==t?n?t-n:t:0},bC=Math.max;var PC=function(e,t,n,r,i,o,a,s){var l=2&t;if(!l&&"function"!=typeof e)throw new TypeError("Expected a function");var f=r?r.length:0;if(f||(t&=-97,r=i=void 0),a=void 0===a?a:bC(UC(a),0),s=void 0===s?s:UC(s),f-=i?i.length:0,64&t){var u=r,c=i;r=i=void 0}var d=l?void 0:uM(e),p=[e,t,n,r,i,u,c,o,a,s];if(d&&fC(p,d),e=p[0],t=p[1],n=p[2],r=p[3],i=p[4],!(s=p[9]=void 0===p[9]?l?0:e.length:bC(p[9]-f,0))&&24&t&&(t&=-25),t&&1!=t)h=8==t||16==t?oC(e,t,s):32!=t&&33!=t||i.length?iC.apply(void 0,p):aC(e,t,n,r);else var h=$P(e,t,n);return HM((d?XP:EM)(h,p),e,t)};var MC=function(e,t,n){return t=n?void 0:t,t=e&&null==t?e.length:t,PC(e,128,void 0,void 0,void 0,void 0,t)};var CC=function(e,t,n){"__proto__"==t&&AM?AM(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var EC=function(e,t){return e===t||e!=e&&t!=t},TC=Object.prototype.hasOwnProperty;var wC=function(e,t,n){var r=e[t];TC.call(e,t)&&EC(r,n)&&(void 0!==n||t in e)||CC(e,t,n)};var IC=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=r?r(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),i?CC(n,s,l):wC(n,s,l)}return n};var kC=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};var _C=function(e){return gM(e)&&"[object Arguments]"==kP(e)},RC=Object.prototype,AC=RC.hasOwnProperty,DC=RC.propertyIsEnumerable,xC=_C(freeOnUnref(function(){return arguments})())?_C:freeOnUnref(function(e){return gM(e)&&AC.call(e,"callee")&&!DC.call(e,"callee")});var FC=function(){return!1},BC=t(freeOnUnref(function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?SP.Buffer:void 0,o=(i?i.isBuffer:void 0)||FC;e.exports=o}));var LC=function(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=9007199254740991},NC={};NC["[object Float32Array]"]=NC["[object Float64Array]"]=NC["[object Int8Array]"]=NC["[object Int16Array]"]=NC["[object Int32Array]"]=NC["[object Uint8Array]"]=NC["[object Uint8ClampedArray]"]=NC["[object Uint16Array]"]=NC["[object Uint32Array]"]=!0,NC["[object Arguments]"]=NC["[object Array]"]=NC["[object ArrayBuffer]"]=NC["[object Boolean]"]=NC["[object DataView]"]=NC["[object Date]"]=NC["[object Error]"]=NC["[object Function]"]=NC["[object Map]"]=NC["[object Number]"]=NC["[object Object]"]=NC["[object RegExp]"]=NC["[object Set]"]=NC["[object String]"]=NC["[object WeakMap]"]=!1;var VC=function(e){return gM(e)&&LC(e.length)&&!!NC[kP(e)]};var jC=function(t){return freeOnUnref(function(e){return t(e)})},qC=t(freeOnUnref(function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n&&vP.process,o=freeOnUnref(function(){try{var e=r&&r.require&&r.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}})();e.exports=o})),HC=qC&&qC.isTypedArray,zC=HC?jC(HC):VC,WC=Object.prototype.hasOwnProperty;var KC=function(e,t){var n=yM(e),r=!n&&xC(e),i=!n&&!r&&BC(e),o=!n&&!r&&!i&&zC(e),a=n||r||i||o,s=a?kC(e.length,String):[],l=s.length;for(var f in e)!t&&!WC.call(e,f)||a&&("length"==f||i&&("offset"==f||"parent"==f)||o&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||GM(f,l))||s.push(f);return s},GC=Object.prototype;var QC=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||GC)};var XC=function(t,n){return freeOnUnref(function(e){return t(n(e))})},YC=XC(Object.keys,Object),JC=Object.prototype.hasOwnProperty;var ZC=function(e){if(!QC(e))return YC(e);var t=[];for(var n in Object(e))JC.call(e,n)&&"constructor"!=n&&t.push(n);return t};var $C=function(e){return null!=e&&LC(e.length)&&!RP(e)};var eE=function(e){return $C(e)?KC(e):ZC(e)};var tE=function(e,t){return e&&IC(t,eE(t),e)};var nE=function(){this.__data__=[],this.size=0};var rE=function(e,t){for(var n=e.length;n--;)if(EC(e[n][0],t))return n;return-1},iE=Array.prototype.splice;var oE=function(e){var t=this.__data__,n=rE(t,e);return!(n<0||(n==t.length-1?t.pop():iE.call(t,n,1),--this.size,0))};var aE=function(e){var t=this.__data__,n=rE(t,e);return n<0?void 0:t[n][1]};var sE=function(e){return-1<rE(this.__data__,e)};var lE=function(e,t){var n=this.__data__,r=rE(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function fE(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}fE.prototype.clear=nE,fE.prototype.delete=oE,fE.prototype.get=aE,fE.prototype.has=sE,fE.prototype.set=lE;var uE=fE;var cE=function(){this.__data__=new uE,this.size=0};var dE=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var pE=function(e){return this.__data__.get(e)};var hE=function(e){return this.__data__.has(e)},mE=KP(SP,"Map"),yE=KP(Object,"create");var gE=function(){this.__data__=yE?yE(null):{},this.size=0};var vE=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},OE=Object.prototype.hasOwnProperty;var SE=function(e){var t=this.__data__;if(yE){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return OE.call(t,e)?t[e]:void 0},UE=Object.prototype.hasOwnProperty;var bE=function(e){var t=this.__data__;return yE?void 0!==t[e]:UE.call(t,e)};var PE=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=yE&&void 0===t?"__lodash_hash_undefined__":t,this};function ME(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ME.prototype.clear=gE,ME.prototype.delete=vE,ME.prototype.get=SE,ME.prototype.has=bE,ME.prototype.set=PE;var CE=ME;var EE=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var TE=function(e,t){var n=e.__data__;return EE(t)?n["string"==typeof t?"string":"hash"]:n.map};var wE=function(e){var t=TE(this,e).delete(e);return this.size-=t?1:0,t};var IE=function(e){return TE(this,e).get(e)};var kE=function(e){return TE(this,e).has(e)};var _E=function(e,t){var n=TE(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function RE(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}RE.prototype.clear=function(){this.size=0,this.__data__={hash:new CE,map:new(mE||uE),string:new CE}},RE.prototype.delete=wE,RE.prototype.get=IE,RE.prototype.has=kE,RE.prototype.set=_E;var AE=RE;var DE=function(e,t){var n=this.__data__;if(n instanceof uE){var r=n.__data__;if(!mE||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new AE(r)}return n.set(e,t),this.size=n.size,this};function xE(e){var t=this.__data__=new uE(e);this.size=t.size}xE.prototype.clear=cE,xE.prototype.delete=dE,xE.prototype.get=pE,xE.prototype.has=hE,xE.prototype.set=DE;var FE=xE;var BE=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},LE=Object.prototype.hasOwnProperty;var NE=function(e){if(!_P(e))return BE(e);var t=QC(e),n=[];for(var r in e)("constructor"!=r||!t&&LE.call(e,r))&&n.push(r);return n};var VE=function(e){return $C(e)?KC(e,!0):NE(e)};var jE=function(e,t){return e&&IC(t,VE(t),e)},qE=t(freeOnUnref(function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?SP.Buffer:void 0,o=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=o?o(n):new e.constructor(n);return e.copy(r),r}}));var HE=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o};var zE=function(){return[]},WE=Object.prototype.propertyIsEnumerable,KE=Object.getOwnPropertySymbols,GE=KE?freeOnUnref(function(t){return null==t?[]:(t=Object(t),HE(KE(t),freeOnUnref(function(e){return WE.call(t,e)})))}):zE;var QE=function(e,t){return IC(e,GE(e),t)};var XE=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},YE=XC(Object.getPrototypeOf,Object),JE=Object.getOwnPropertySymbols?freeOnUnref(function(e){for(var t=[];e;)XE(t,GE(e)),e=YE(e);return t}):zE;var ZE=function(e,t){return IC(e,JE(e),t)};var $E=function(e,t,n){var r=t(e);return yM(e)?r:XE(r,n(e))};var eT=function(e){return $E(e,eE,GE)};var tT=function(e){return $E(e,VE,JE)},nT=KP(SP,"DataView"),rT=KP(SP,"Promise"),iT=KP(SP,"Set"),oT="[object Map]",aT="[object Promise]",sT="[object Set]",lT="[object WeakMap]",fT="[object DataView]",uT=BP(nT),cT=BP(mE),dT=BP(rT),pT=BP(iT),hT=BP(GP),mT=kP;(nT&&mT(new nT(new ArrayBuffer(1)))!=fT||mE&&mT(new mE)!=oT||rT&&mT(rT.resolve())!=aT||iT&&mT(new iT)!=sT||GP&&mT(new GP)!=lT)&&(mT=freeOnUnref(function(e){var t=kP(e),n="[object Object]"==t?e.constructor:void 0,r=n?BP(n):"";if(r)switch(r){case uT:return fT;case cT:return oT;case dT:return aT;case pT:return sT;case hT:return lT}return t}));var yT=mT,gT=Object.prototype.hasOwnProperty;var vT=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&gT.call(e,"index")&&(n.index=e.index,n.input=e.input),n},OT=SP.Uint8Array;var ST=function(e){var t=new e.constructor(e.byteLength);return new OT(t).set(new OT(e)),t};var UT=function(e,t){var n=t?ST(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},bT=/\w*$/;var PT=function(e){var t=new e.constructor(e.source,bT.exec(e));return t.lastIndex=e.lastIndex,t},MT=UP?UP.prototype:void 0,CT=MT?MT.valueOf:void 0;var ET=function(e){return CT?Object(CT.call(e)):{}};var TT=function(e,t){var n=t?ST(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var wT=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return ST(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return UT(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return TT(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return PT(e);case"[object Set]":return new r;case"[object Symbol]":return ET(e)}};var IT=function(e){return"function"!=typeof e.constructor||QC(e)?{}:JP(YE(e))};var kT=function(e){return gM(e)&&"[object Map]"==yT(e)},_T=qC&&qC.isMap,RT=_T?jC(_T):kT;var AT=function(e){return gM(e)&&"[object Set]"==yT(e)},DT=qC&&qC.isSet,xT=DT?jC(DT):AT,FT=1,BT=2,LT=4,NT="[object Arguments]",VT="[object Function]",jT="[object GeneratorFunction]",qT="[object Object]",HT={};HT[NT]=HT["[object Array]"]=HT["[object ArrayBuffer]"]=HT["[object DataView]"]=HT["[object Boolean]"]=HT["[object Date]"]=HT["[object Float32Array]"]=HT["[object Float64Array]"]=HT["[object Int8Array]"]=HT["[object Int16Array]"]=HT["[object Int32Array]"]=HT["[object Map]"]=HT["[object Number]"]=HT[qT]=HT["[object RegExp]"]=HT["[object Set]"]=HT["[object String]"]=HT["[object Symbol]"]=HT["[object Uint8Array]"]=HT["[object Uint8ClampedArray]"]=HT["[object Uint16Array]"]=HT["[object Uint32Array]"]=!0,HT["[object Error]"]=HT[VT]=HT["[object WeakMap]"]=!1;var zT=function n(r,i,o,e,t,a){var s,l=i&FT,f=i&BT,u=i&LT;if(o&&(s=t?o(r,e,t,a):o(r)),void 0!==s)return s;if(!_P(r))return r;var c=yM(r);if(c){if(s=vT(r),!l)return vM(r,s)}else{var d=yT(r),p=d==VT||d==jT;if(BC(r))return qE(r,l);if(d==qT||d==NT||p&&!t){if(s=f||p?{}:IT(r),!l)return f?ZE(r,jE(s,r)):QE(r,tE(s,r))}else{if(!HT[d])return t?r:{};s=wT(r,d,l)}}a||(a=new FE);var h=a.get(r);if(h)return h;a.set(r,s),xT(r)?r.forEach(freeOnUnref(function(e){s.add(n(e,i,o,e,r,a))})):RT(r)&&r.forEach(freeOnUnref(function(e,t){s.set(t,n(e,i,o,t,r,a))}));var m=c?void 0:(u?f?tT:eT:f?VE:eE)(r);return xM(m||r,freeOnUnref(function(e,t){m&&(e=r[t=e]),wC(s,t,n(e,i,o,t,r,a))})),s};var WT=function(e){return zT(e,4)},KT=8;function GT(e,t,n){var r=PC(e,KT,void 0,void 0,void 0,void 0,void 0,t=n?void 0:t);return r.placeholder=GT.placeholder,r}GT.placeholder={};var QT=GT,XT=Function.prototype,YT=Object.prototype,JT=XT.toString,ZT=YT.hasOwnProperty,$T=JT.call(Object);var ew=function(e){if(!gM(e)||"[object Object]"!=kP(e))return!1;var t=YE(e);if(null===t)return!0;var n=ZT.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&JT.call(n)==$T};var tw=function(e){if(!gM(e))return!1;var t=kP(e);return"[object Error]"==t||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!ew(e)};var nw=function(e){return gM(e)&&"[object WeakMap]"==yT(e)};var rw=function(e){return this.__data__.has(e)};function iw(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new AE;++t<n;)this.add(e[t])}iw.prototype.add=iw.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},iw.prototype.has=rw;var ow=iw;var aw=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};var sw=function(e,t){return e.has(t)};var lw=function(e,t,n,r,i,o){var a=1&n,s=e.length,l=t.length;if(s!=l&&!(a&&s<l))return!1;var f=o.get(e),u=o.get(t);if(f&&u)return f==t&&u==e;var c=-1,d=!0,p=2&n?new ow:void 0;for(o.set(e,t),o.set(t,e);++c<s;){var h=e[c],m=t[c];if(r)var y=a?r(m,h,c,t,e,o):r(h,m,c,e,t,o);if(void 0!==y){if(y)continue;d=!1;break}if(p){if(!aw(t,freeOnUnref(function(e,t){if(!sw(p,t)&&(h===e||i(h,e,n,r,o)))return p.push(t)}))){d=!1;break}}else if(h!==m&&!i(h,m,n,r,o)){d=!1;break}}return o.delete(e),o.delete(t),d};var fw=function(e){var n=-1,r=Array(e.size);return e.forEach(freeOnUnref(function(e,t){r[++n]=[t,e]})),r};var uw=function(e){var t=-1,n=Array(e.size);return e.forEach(freeOnUnref(function(e){n[++t]=e})),n},cw=UP?UP.prototype:void 0,dw=cw?cw.valueOf:void 0;var pw=function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new OT(e),new OT(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return EC(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=fw;case"[object Set]":var l=1&r;if(s||(s=uw),e.size!=t.size&&!l)return!1;var f=a.get(e);if(f)return f==t;r|=2,a.set(e,t);var u=lw(s(e),s(t),r,i,o,a);return a.delete(e),u;case"[object Symbol]":if(dw)return dw.call(e)==dw.call(t)}return!1},hw=Object.prototype.hasOwnProperty;var mw=function(e,t,n,r,i,o){var a=1&n,s=eT(e),l=s.length;if(l!=eT(t).length&&!a)return!1;for(var f=l;f--;){var u=s[f];if(!(a?u in t:hw.call(t,u)))return!1}var c=o.get(e),d=o.get(t);if(c&&d)return c==t&&d==e;var p=!0;o.set(e,t),o.set(t,e);for(var h=a;++f<l;){var m=e[u=s[f]],y=t[u];if(r)var g=a?r(y,m,u,t,e,o):r(m,y,u,e,t,o);if(!(void 0===g?m===y||i(m,y,n,r,o):g)){p=!1;break}h||(h="constructor"==u)}if(p&&!h){var v=e.constructor,O=t.constructor;v!=O&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof O&&O instanceof O)&&(p=!1)}return o.delete(e),o.delete(t),p},yw="[object Arguments]",gw="[object Array]",vw="[object Object]",Ow=Object.prototype.hasOwnProperty;var Sw=function(e,t,n,r,i,o){var a=yM(e),s=yM(t),l=a?gw:yT(e),f=s?gw:yT(t),u=(l=l==yw?vw:l)==vw,c=(f=f==yw?vw:f)==vw,d=l==f;if(d&&BC(e)){if(!BC(t))return!1;u=!(a=!0)}if(d&&!u)return o||(o=new FE),a||zC(e)?lw(e,t,n,r,i,o):pw(e,t,l,n,r,i,o);if(!(1&n)){var p=u&&Ow.call(e,"__wrapped__"),h=c&&Ow.call(t,"__wrapped__");if(p||h){var m=p?e.value():e,y=h?t.value():t;return o||(o=new FE),i(m,y,n,r,o)}}return!!d&&(o||(o=new FE),mw(e,t,n,r,i,o))};var Uw=function e(t,n,r,i,o){return t===n||(null==t||null==n||!gM(t)&&!gM(n)?t!=t&&n!=n:Sw(t,n,r,i,e,o))};var bw=function(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var l=(s=n[i])[0],f=e[l],u=s[1];if(a&&s[2]){if(void 0===f&&!(l in e))return!1}else{var c=new FE;if(r)var d=r(f,u,l,e,t,c);if(!(void 0===d?Uw(u,f,3,r,c):d))return!1}}return!0};var Pw=function(e){return e==e&&!_P(e)};var Mw=function(e){for(var t=eE(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Pw(i)]}return t};var Cw=function(t,n){return freeOnUnref(function(e){return null!=e&&e[t]===n&&(void 0!==n||t in Object(e))})};var Ew=function(t){var n=Mw(t);return 1==n.length&&n[0][2]?Cw(n[0][0],n[0][1]):freeOnUnref(function(e){return e===t||bw(e,t,n)})},Tw=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ww=/^\w*$/;var Iw=function(e,t){if(yM(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!hC(e))||ww.test(e)||!Tw.test(e)||null!=t&&e in Object(t)},kw="Expected a function";function _w(i,o){if("function"!=typeof i||null!=o&&"function"!=typeof o)throw new TypeError(kw);var a=freeOnUnref(function(){var e=arguments,t=o?o.apply(this,e):e[0],n=a.cache;if(n.has(t))return n.get(t);var r=i.apply(this,e);return a.cache=n.set(t,r)||n,r});return a.cache=new(_w.Cache||AE),a}_w.Cache=AE;var Rw=_w;var Aw=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Dw=/\\(\\)?/g,xw=function(e){var t=Rw(e,freeOnUnref(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}(freeOnUnref(function(e){var i=[];return 46===e.charCodeAt(0)&&i.push(""),e.replace(Aw,freeOnUnref(function(e,t,n,r){i.push(n?r.replace(Dw,"$1"):t||e)})),i}));var Fw=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i},Bw=1/0,Lw=UP?UP.prototype:void 0,Nw=Lw?Lw.toString:void 0;var Vw=function e(t){if("string"==typeof t)return t;if(yM(t))return Fw(t,e)+"";if(hC(t))return Nw?Nw.call(t):"";var n=t+"";return"0"==n&&1/t==-Bw?"-0":n};var jw=function(e){return null==e?"":Vw(e)};var qw=function(e,t){return yM(e)?e:Iw(e,t)?[e]:xw(jw(e))};var Hw=function(e){if("string"==typeof e||hC(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t};var zw=function(e,t){for(var n=0,r=(t=qw(t,e)).length;null!=e&&n<r;)e=e[Hw(t[n++])];return n&&n==r?e:void 0};var Ww=function(e,t,n){var r=null==e?void 0:zw(e,t);return void 0===r?n:r};var Kw=function(e,t){return null!=e&&t in Object(e)};var Gw=function(e,t,n){for(var r=-1,i=(t=qw(t,e)).length,o=!1;++r<i;){var a=Hw(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&LC(i)&&GM(a,i)&&(yM(e)||xC(e))};var Qw=function(e,t){return null!=e&&Gw(e,t,Kw)};var Xw=function(n,r){return Iw(n)&&Pw(r)?Cw(Hw(n),r):freeOnUnref(function(e){var t=Ww(e,n);return void 0===t&&t===r?Qw(e,n):Uw(r,t,3)})};var Yw=function(t){return freeOnUnref(function(e){return null==e?void 0:e[t]})};var Jw=function(t){return freeOnUnref(function(e){return zw(e,t)})};var Zw=function(e){return Iw(e)?Yw(Hw(e)):Jw(e)};var $w=function(e){return"function"==typeof e?e:null==e?gP:"object"==typeof e?yM(e)?Xw(e[0],e[1]):Ew(e):Zw(e)};var eI=function(e){return $w("function"==typeof e?e:zT(e,1))},tI=UP?UP.isConcatSpreadable:void 0;var nI=function(e){return yM(e)||xC(e)||!!(tI&&e&&e[tI])};var rI=function e(t,n,r,i,o){var a=-1,s=t.length;for(r||(r=nI),o||(o=[]);++a<s;){var l=t[a];0<n&&r(l)?1<n?e(l,n-1,r,i,o):XE(o,l):i||(o[o.length]=l)}return o};var iI=function(e){return null!=e&&e.length?rI(e,1):[]},oI=Math.max;var aI=function(o,a,s){return a=oI(void 0===a?o.length-1:a,0),freeOnUnref(function(){for(var e=arguments,t=-1,n=oI(e.length-a,0),r=Array(n);++t<n;)r[t]=e[a+t];t=-1;for(var i=Array(a+1);++t<a;)i[t]=e[t];return i[a]=s(r),eM(o,this,i)})};var sI=function(e){return DM(aI(e,void 0,iI),e+"")},lI=sI(freeOnUnref(function(e,t){return PC(e,256,void 0,void 0,void 0,t)}));var fI=function(e){return yM(e)?Fw(e,Hw):hC(e)?[e]:vM(xw(jw(e)))},uI={ary:MC,assign:tE,clone:WT,curry:QT,forEach:xM,isArray:yM,isError:tw,isFunction:RP,isWeakMap:nw,iteratee:eI,keys:ZC,rearg:lI,toInteger:UC,toPath:fI};var cI=function(e,t,n){return rP(uI,e,t,n)};var dI=cI("flowRight",function(l){return sI(freeOnUnref(function(i){var o=i.length,e=o,t=mM.prototype.thru;for(l&&i.reverse();e--;){var n=i[e];if("function"!=typeof n)throw new TypeError("Expected a function");if(t&&!a&&"wrapper"==pM(n))var a=new mM([],!0)}for(e=a?e:o;++e<o;){n=i[e];var r=pM(n),s="wrapper"==r?uM(n):void 0;a=s&&PM(s[0])&&424==s[1]&&!s[4].length&&1==s[9]?a[pM(s[0])].apply(a,s[3]):1==n.length&&PM(n)?a[r]():a.thru(n)}return freeOnUnref(function(){var e=arguments,t=e[0];if(a&&1==e.length&&yM(t))return a.plant(t).value();for(var n=0,r=o?i[n].apply(this,e):t;++n<o;)r=i[n].call(this,r);return r})}))}(!0));dI.placeholder=Zb;var pI=dI,hI=cI("noop",fM,{cap:!1,curry:!1,fixed:!1,immutable:!1,rearg:!1});hI.placeholder=Zb;var mI=hI;var yI=function(e){return"string"==typeof e||!yM(e)&&gM(e)&&"[object String]"==kP(e)};var gI=function(t,e){return Fw(e,freeOnUnref(function(e){return t[e]}))};var vI=function(e){return null==e?[]:gI(e,eE(e))},OI=Math.max;var SI=function(e,t,n,r){e=$C(e)?e:vI(e),n=n&&!r?UC(n):0;var i=e.length;return n<0&&(n=OI(i+n,0)),yI(e)?n<=i&&-1<e.indexOf(t,n):!!i&&-1<NM(e,t,n)};var UI=function(l){return freeOnUnref(function(e,t,n){for(var r=-1,i=Object(e),o=n(e),a=o.length;a--;){var s=o[l?a:++r];if(!1===t(i[s],s,i))break}return e})}();var bI=function(o,a){return freeOnUnref(function(e,t){if(null==e)return e;if(!$C(e))return o(e,t);for(var n=e.length,r=a?n:-1,i=Object(e);(a?r--:++r<n)&&!1!==t(i[r],r,i););return e})}(function(e,t){return e&&UI(e,t,eE)});var PI=function(e,r){var i=-1,o=$C(e)?Array(e.length):[];return bI(e,freeOnUnref(function(e,t,n){o[++i]=r(e,t,n)})),o};var MI=function(e,t){return(yM(e)?Fw:PI)(e,$w(t))},CI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.compose=pI,t.noop=mI,t.includes=SI,t.map=MI}));e(CI);CI.compose,CI.noop,CI.includes,CI.map;var EI=t(freeOnUnref(function(e,t){var n,r,i;Object.defineProperty(t,"__esModule",{value:!0});var o=freeOnUnref(function(){function e(){}return e.MEDIA_CONTROL_TO_CONNECTOR=((n={}).Filmmaker=1,n.CalibratedCinematic=3,n.CalibratedBroadcast=2,n.None=0,n),e.MEDIA_CONTROL_TO_DEVICE_INFORMATION=((r={}).Filmmaker="Filmmaker",r.CalibratedCinematic="CalibratedCinematic",r.CalibratedBroadcast="CalibratedBroadcast",r.None=void 0,r),e.DEVICE_INFORMATION_TO_MEDIA_CONTROL=((i={}).Filmmaker="Filmmaker",i.CalibratedCinematic="CalibratedCinematic",i.CalibratedBroadcast="CalibratedBroadcast",i),e})();t.PictureModeMappings=o}));e(EI);EI.PictureModeMappings;var TI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("PictureModeControl"),n=freeOnUnref(function(){function e(e,t,n,r,i,o,a){this.deviceInitServiceEnabledPictureModes=[],this.pictureModeLastSet=null,this.playerSuggestedPictureModes=e,this.deviceSupportedPictureModes=t,this.mediaControlImpl=n,this.eventEmitter=r,this.isFullScreen=i,this.metrics=o,!0===Qe.nestedValue(a,"device.isFmmEnabled")&&this.deviceInitServiceEnabledPictureModes.push("Filmmaker"),!0===Qe.nestedValue(a,"device.isCalibratedModeEnabled")&&(this.deviceInitServiceEnabledPictureModes.push("CalibratedBroadcast"),this.deviceInitServiceEnabledPictureModes.push("CalibratedCinematic")),this.enablementToPictureModeCountMap={Enabled:{CalibratedBroadcast:0,CalibratedCinematic:0,Filmmaker:0,None:0},Disabled:{CalibratedBroadcast:0,CalibratedCinematic:0,Filmmaker:0,None:0}}}return e.prototype.handlePictureMode=freeOnUnref(function(e){switch(e){case 1:this.enablementToPictureModeCountMap.Enabled.Filmmaker++,r.info("Picture mode set to filmmaker on the device by the native layer"),this.eventEmitter.emitSync("PictureModeChange","Filmmaker"),this.pictureModeLastSet="Filmmaker";break;case 3:r.info("Picture mode set to calibrated cinematic on the device by the native layer"),this.enablementToPictureModeCountMap.Enabled.CalibratedCinematic++,this.eventEmitter.emitSync("PictureModeChange","CalibratedCinematic"),this.pictureModeLastSet="CalibratedCinematic";break;case 2:r.info("Picture mode set to calibrated broadcast on the device by the native layer"),this.enablementToPictureModeCountMap.Enabled.CalibratedBroadcast++,this.eventEmitter.emitSync("PictureModeChange","CalibratedBroadcast"),this.pictureModeLastSet="CalibratedBroadcast";break;case 0:this.updatePictureModeDisabledCount(),r.info("Picture mode set to None on the device by the native layer"),this.eventEmitter.emitSync("PictureModeChange","None"),this.pictureModeLastSet="None";break;default:this.updatePictureModeDisabledCount(),r.info("Unknown picture mode: "+e+" set on the device by the native layer"),this.eventEmitter.emitSync("PictureModeChange","None"),this.pictureModeLastSet="None"}}),e.prototype.setPictureModeIfRequired=freeOnUnref(function(){var t=this;r.info("Player suggested picture modes: ["+this.playerSuggestedPictureModes+"], DIS enabled picture modes: ["+this.deviceInitServiceEnabledPictureModes+"], Device supported picture modes: ["+this.deviceSupportedPictureModes+"], Full-screen: "+this.isFullScreen),this.deviceSupportedPictureModes.forEach(freeOnUnref(function(e){t.tryToSetPictureMode(EI.PictureModeMappings.DEVICE_INFORMATION_TO_MEDIA_CONTROL[e])}))}),e.prototype.reportEnablementCounts=freeOnUnref(function(){var e,t=this.enablementToPictureModeCountMap.Enabled;for(e in t){if(t.hasOwnProperty(e))0<(r=t[e])&&this.metrics.putMetric("PictureMode."+e+".EnabledByUser.Count",r),this.enablementToPictureModeCountMap.Enabled[e]=0}var n=this.enablementToPictureModeCountMap.Disabled;for(e in n){var r;if(n.hasOwnProperty(e))0<(r=n[e])&&this.metrics.putMetric("PictureMode."+e+".DisabledByUser.Count",r),this.enablementToPictureModeCountMap.Disabled[e]=0}}),e.prototype.updatePictureModeDisabledCount=freeOnUnref(function(){null!=this.pictureModeLastSet&&(this.enablementToPictureModeCountMap.Disabled.CalibratedBroadcast+="CalibratedBroadcast"===this.pictureModeLastSet?1:0,this.enablementToPictureModeCountMap.Disabled.CalibratedCinematic+="CalibratedCinematic"===this.pictureModeLastSet?1:0,this.enablementToPictureModeCountMap.Disabled.Filmmaker+="Filmmaker"===this.pictureModeLastSet?1:0,this.pictureModeLastSet=null)}),e.prototype.tryToSetPictureMode=freeOnUnref(function(t){var n=this;if(this.shouldEnablePictureMode(t)){r.info("Making the native call to set the picture mode to "+t+" on the device"),this.metrics.putMetric("PictureMode."+t+".Enabled",1);var e=this.mediaControlImpl.setPictureMode(EI.PictureModeMappings.MEDIA_CONTROL_TO_CONNECTOR[t],freeOnUnref(function(e){n.handleSetPictureModeReturnCode(e,t)}));e!==wI.MediaControlAdapter.NATIVE_SUCCESS_CODE&&50800!==e&&r.error("setPictureMode failed with error code "+e+" returned from the native function for picture mode "+t)}else this.metrics.putMetric("PictureMode."+t+".Enabled",0),r.info("Picture mode is not set to "+t+", not all requirements are met")}),e.prototype.handleSetPictureModeReturnCode=freeOnUnref(function(e,t){switch(e){case wI.MediaControlAdapter.NATIVE_SUCCESS_CODE:r.info("Picture mode set to "+t+" mode successfully"),this.metrics.putMetric("PictureMode."+t+".Success"),this.eventEmitter.emitSync("PictureModeChange",t),this.pictureModeLastSet=t;break;case 50800:this.metrics.putMetric("PictureMode."+t+".Failure.AutoSettingDisabled"),r.warn("Picture mode not set to "+t+": Automatic "+t+" mode not enabled on the device");break;case-1:this.metrics.putMetric("PictureMode."+t+".NotEnabled.NotImplemented"),r.warn("Picture mode not set to "+t+": Native function for setting picture mode not implemented");break;default:this.metrics.putMetric("PictureMode."+t+".Failure.Error"),r.error("Picture mode not set to "+t+": Native error code: "+e+" received in setPictureMode callback")}}),e.prototype.shouldEnablePictureMode=freeOnUnref(function(e){return this.playerSuggestedPictureModes&&-1!==this.playerSuggestedPictureModes.indexOf(e)?this.isFullScreen?-1!==this.deviceInitServiceEnabledPictureModes.indexOf(e)||(this.metrics.putMetric("PictureMode."+e+".NotEnabled.DisabledByConfig"),!1):(this.metrics.putMetric("PictureMode."+e+".NotEnabled.NotFullscreen"),!1):(this.metrics.putMetric("PictureMode."+e+".NotEnabled.NotSuggested"),!1)}),e})();t.PictureModeControl=n}));e(TI);TI.PictureModeControl;var wI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l,u=de.get("MediaControlAdapter"),c=f.of("MediaControlAdapter");freeOnUnref(function(e){e[e.POLL=0]="POLL",e[e.RESOLVE=1]="RESOLVE",e[e.REJECT=2]="REJECT"})(l||(l={}));var n=freeOnUnref(function(){function f(e,t,n,r,i){void 0===e&&(e=re.connector.mpbFactoryAPI.getMPBCommandAPI()),void 0===t&&(t=oe.timer),void 0===n&&(n=zt.deviceInformation),void 0===r&&(r=zt.deviceCapabilities),void 0===i&&(i=L.configurationStore);var s=this;if(this.handleBackendCallback=CI.compose(this.adaptNativeError,this.handleStateChange),this.callReadyToPlay=freeOnUnref(function(e){return e.buffer.onReadyToPlay()}),this.callBufferUnderrun=freeOnUnref(function(e){return e.buffer.onUnderrun()}),this.callEndOfStream=freeOnUnref(function(e){return e.buffer.onEndOfStream()}),this.buffers=[],this.mpbConfiguration=null,this.pictureModeControl=null,this.onCodecInitialized=freeOnUnref(function(e){c(e).exists(),s.maxVideoResolution=e.maxResolution,null!==s.drmSystem&&s.drmSystem.startHdcpPolling(s.maxVideoResolution)}),this.resizeFnc=freeOnUnref(function(e){var r=e.x,i=e.y,o=e.width,a=e.height;return u.info("Calling setVideoOutputPosition for dynamic resize with viewport: "+JSON.stringify({x:r,y:i,width:o,height:a})),new lt.Promise(freeOnUnref(function(t,n){var e=freeOnUnref(function(e){e===f.NATIVE_SUCCESS_CODE?(q.metrics.putMetric("Resize.Success.Unf"),u.info("Dynamic Player viewport resize succeeded on UNF MPB"),t("surface.resize.success")):(q.metrics.putMetric("Resize.Fail.Unf.PlatformError"),u.error("Dynamic player viewport resize failed on UNF MPB due to an error: "+e),n("surface.resize.platform"))});s.mediaControlImpl.setVideoOutputPosition(r,i,o,a,e)}))}),this.eventEmitter=new A.EventEmitter,this.mediaControlImpl=e,this.timer=t,this.deviceInformation=n,this.deviceCapabilities=r,this.internalState=0,this.listenersBound=!1,this.drmSystem=null,this.maxVideoResolution=null,this.minPlaybackTimeToSwitchToPlayingMs=0,this.playbackTimePollingHandle=-1,this.endOfStreamReceived=!1,this.mpbStatus=0,this.pendingSeek=null,this.pendingStop=null,this.ignoreUnseekedZeroPts=!1,this.prevPlaybackTimeMs=null,this.suggestedPictureModes=void 0,this.playCalled=!1,this.playbackStartedPollingState=l.POLL,this.backgroundedErrorMessageRegExs=[],this.mpbConfiguration={mpbConfig:{readyToPlay:{algorithm:"DURATION",audioThreshold:2e3,videoThreshold:1e3},bufferUnderrun:{audioThreshold:0,videoThreshold:0}}},this.xpConfiguration=i.configuration,null!=this.xpConfiguration&&null!=this.xpConfiguration.device&&(this.ignoreUnseekedZeroPts=null!=this.xpConfiguration.device.ignoreUnseekedZeroPts&&!0===this.xpConfiguration.device.ignoreUnseekedZeroPts,null!=this.xpConfiguration.device.backgroundedErrorMessagePatterns&&Array.isArray(this.xpConfiguration.device.backgroundedErrorMessagePatterns))){var o=this.xpConfiguration.device.backgroundedErrorMessagePatterns;this.backgroundedErrorMessageRegExs=o.map(freeOnUnref(function(e){try{return new RegExp(e,"i")}catch(e){return u.warn("Invalid regular expression pattern: ${pattern}"),new RegExp("$.")}}))}}return f.prototype.attachAudioBuffer=freeOnUnref(function(e){c(e,"buffer").exists(),u.info("attachAudioBuffer");var t=this.createMPBState();e.onBufferAttached(t),this.buffers.push({buffer:e,state:t})}),f.prototype.attachVideoBuffer=freeOnUnref(function(e){c(e,"buffer").exists(),u.info("attachVideoBuffer"),e.onCodecInitialized(this.onCodecInitialized);var t=this.createMPBState();e.onBufferAttached(t),this.buffers.push({buffer:e,state:t})}),f.prototype.init=freeOnUnref(function(r,e,t){var i=this;c(r,"handler").exists(),this.checkStateIn([0,1]),this.suggestedPictureModes=[],this.minPlaybackTimeToSwitchToPlayingMs=0,this.endOfStreamReceived=!1;var o=_t.surfaceRefManager.getSurfaceRef();this.prevPlaybackTimeMs=null,t&&t.suggestedPictureModes&&(this.suggestedPictureModes=t.suggestedPictureModes),this.pictureModeControl=new TI.PictureModeControl(this.suggestedPictureModes,this.getDeviceSupportedPictureModes(),this.mediaControlImpl,this.eventEmitter,this.isFullScreenPlayback(o),q.metrics,this.xpConfiguration);var a=null!=this.mpbConfiguration?JSON.stringify(this.mpbConfiguration):"";if(u.info("init surfaceRef="+JSON.stringify(o)+", mediaControlConfig="+JSON.stringify(t)+", mpbConfig="+a),!this.listenersBound){var n=freeOnUnref(function(e){return i.onMediaBufferEvent(e)}),s=freeOnUnref(function(e,t,n,r){return i.handleMpbError(e,t,n,r)}),l=freeOnUnref(function(e){null!=i.pictureModeControl?i.pictureModeControl.handlePictureMode(e):u.warn("Cannot handle picture mode change because pictureModeControl is null")});this.checkMPBErrorCode("bindListeners",this.mediaControlImpl.bindListeners(s,n,l)),this.listenersBound=!0}this.checkMPBErrorCode("init",this.mediaControlImpl.init(a,freeOnUnref(function(t){var e=null==o?r:freeOnUnref(function(e){null==e?(u.info("Init succeeded, set setResizeViewportFunction for surface ref adapter"),i.trySetVideoOutputPosition(o,r),_t.surfaceRefManager.setResizeViewportFunction(i.resizeFnc)):r(e)}),n=i.handleNativeInit(1,e);t===f.NATIVE_SUCCESS_CODE?n(t):(u.error("Init call failed. Try to shutdown media pipeline backend"),i.mediaControlImpl.shutdown(freeOnUnref(function(e){e===f.NATIVE_SUCCESS_CODE?(u.info("Shutdown call successful. Re-initializing MPB again"),_t.surfaceRefManager.setResizeViewportFunction(void 0),u.info("Re-initializing mediaControlImpl after successful shutdown"),i.mediaControlImpl.init(a,n)):(u.error("Failed to shutdown mediaControlImpl. Failing with initial error: "+t),n(t))})))})))}),f.prototype.play=freeOnUnref(function(n){var r=this;c(n,"handler").exists(),this.checkStateIn([1,3]),this.playCalled||(null!=this.pictureModeControl?this.pictureModeControl.setPictureModeIfRequired():u.warn("Cannot try setting a picture mode because pictureModeControl is null"),this.playCalled=!0);var i=Date.now();this.playbackStartedPollingState=l.POLL,this.playbackTimePollingHandle=this.timer.setInterval(freeOnUnref(function(){var e=r.playbackTimeMs;switch(r.playbackStartedPollingState){case l.RESOLVE:u.info("Abandoning playback-started polling after "+(Date.now()-i)+"ms, calling handler to resolve play promise"),r.resetPlaybackTimePollingHandle(),n();break;case l.REJECT:u.info("Abandoning playback-started polling after "+(Date.now()-i)+"ms, calling handler to reject play promise"),r.resetPlaybackTimePollingHandle();var t=new Error("Playback Polling Interrupted");t.code=0,n(t);break;case l.POLL:e>r.minPlaybackTimeToSwitchToPlayingMs||r.endOfStreamReceived?(r.resetPlaybackTimePollingHandle(),r.internalState=2,n(),r.eventEmitter.emitSync("MediaControlStateChange",2)):5e3<Date.now()-i&&(u.error("Playback polling did not complete in "+(Date.now()-i)+"ms. playbackTimeMs is "+e+" (needed it to be > "+r.minPlaybackTimeToSwitchToPlayingMs+") and endOfStreamReceived is "+r.endOfStreamReceived),r.internalError=new Error("MediaControlError: playback did not start in 5000ms"),r.internalError.code=1,r.internalState=4,r.resetPlaybackTimePollingHandle(),n(r.internalError),r.eventEmitter.emitSync("MediaControlStateChange",4))}}),50),u.info("play");var e=this.mediaControlImpl.play(freeOnUnref(function(e){0!==e&&(r.resetPlaybackTimePollingHandle(),r.internalError=new Error("MediaControlError: "+e),r.internalError.code=e,r.internalState=4,n(r.internalError),r.eventEmitter.emitSync("MediaControlStateChange",4))}));0!==e&&(this.resetPlaybackTimePollingHandle(),this.switchToErrorStateAndRaiseError("play",{errorCode:e}))}),f.prototype.pause=freeOnUnref(function(t){var n=this;c(t,"handler").exists(),this.checkStateIn([2]),u.info("pause"),this.checkMPBErrorCode("pause",this.mediaControlImpl.pause(this.handleBackendCallback(3,freeOnUnref(function(e){n.minPlaybackTimeToSwitchToPlayingMs=n.playbackTimeMs,t(e)}))))}),f.prototype.seek=freeOnUnref(function(e,t){var n=this;if(c(t,"handler").exists(),c(0<=e,"non-negative timestamp").is.true(),this.checkStateIn([2,3,1]),this.blockSeekToCurrentPosition()&&Math.abs(e-this.playbackTimeMs)<1)return u.warn("NOT seeking to "+e+" -- too close to current playbackTimeMs("+this.playbackTimeMs+") and may cause problems to current platform"),void t();u.info("seek to "+e+"."),this.minPlaybackTimeToSwitchToPlayingMs=e;var r=freeOnUnref(function(e){n.prevPlaybackTimeMs=null,t(e)});if(3===this.mpbStatus)u.info("Executing seek to "+e+": MPB is ready"),this.checkMPBErrorCode("seek",this.mediaControlImpl.seek(e,f.MS_TIMESCALE,this.adaptNativeError(r)));else if(1===this.mpbStatus||2===this.mpbStatus){if(u.info("Saving seek to "+e+" for later: MPB is Initializing"),null!=this.pendingSeek)throw new Error("Attempting to seek while a previous seek is still pending");this.pendingSeek={timestampMs:e,handler:this.adaptNativeError(r)}}else u.info("Saving seek to "+e+" for later: MPB is Uninitialized. Invoking callback."),this.pendingSeek={timestampMs:e},r()}),f.prototype.stop=freeOnUnref(function(e){if(c(e,"handler").exists(),this.checkStateIn([0,1,2,3,4,5]),u.info("stop"),this.abandonPlaybackPolling(l.RESOLVE),3===this.mpbStatus)u.info("Executing stop. MPB is ready"),2===this.state||3===this.state||1===this.state?this.checkMPBErrorCode("stop",this.mediaControlImpl.stop(this.handleBackendCallback(1,e))):(u.info("Stop called in state "+this.state+", skipping and invoking handler"),this.timer.setImmediate(e));else if(1===this.mpbStatus||2===this.mpbStatus){if(null!=this.pendingStop)throw new Error("stop() called while a previous stop() is still pending");u.info("MPB is initializing. Saving stop() call for later"),this.internalState=1,this.pendingStop=this.handleBackendCallback(1,e)}else u.info("MPB is waiting to initialize. Not executing stop"),this.internalState=1,e()}),f.prototype.shutdown=freeOnUnref(function(e){c(e,"handler").exists(),u.info("shutdown"),_t.surfaceRefManager.setResizeViewportFunction(void 0),this.internalState=5,this.checkMPBErrorCode("shutdown",this.mediaControlImpl.shutdown(this.handleBackendCallback(0,e))),this.maxVideoResolution=null,this.mpbStatus=0,null!==this.drmSystem&&this.drmSystem.stopHdcpPolling(),this.pendingSeek=null,this.pendingStop=null;for(var t=0,n=this.buffers;t<n.length;t++){n[t].state.reset()}this.playCalled=!1,null!=this.pictureModeControl?(this.pictureModeControl.reportEnablementCounts(),this.pictureModeControl=null):u.warn("Cannot report picture mode enablement counts because pictureModeControl is null")}),f.prototype.setDrmSystem=freeOnUnref(function(e,t){c(t,"handler").exists(),c(e instanceof oo.DrmSystem||null===e,"valid drmSystem").is.true(),u.info("setDrmSystem"),this.drmSystem=e;var n=null!==this.drmSystem?this.drmSystem.getNativeDrmSystem():null;this.checkMPBErrorCode("setDrmSystem",this.mediaControlImpl.setDrmSystem(n,this.adaptNativeError(t))),null!==this.drmSystem&&null!==this.maxVideoResolution&&this.drmSystem.startHdcpPolling(this.maxVideoResolution)}),f.prototype.onStateChange=freeOnUnref(function(e){c(e,"handler").exists(),this.eventEmitter.removeAllListeners("MediaControlStateChange"),this.on("MediaControlStateChange",e)}),f.prototype.offStateChange=freeOnUnref(function(){this.eventEmitter.removeAllListeners("MediaControlStateChange")}),f.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),f.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),f.prototype.getDiagnosticInfo=freeOnUnref(function(){var e=this.mediaControlImpl.getDiagnosticInfo();return this.checkMPBErrorCode("getDiagnosticInfo",e.getErrorCode()),{numVideoDroppedFrames:e.getNumDroppedFrames()}}),Object.defineProperty(f.prototype,"playbackTimeMs",{get:freeOnUnref(function(){if(3===this.mpbStatus||null==this.pendingSeek){var e=this.mediaControlImpl.getPlaybackTime();this.checkMPBErrorCode("playbackTimeMs",e.getErrorCode());var t=e.getTicks(),n=e.getTimescale();return 0===t&&null!=this.prevPlaybackTimeMs&&0!==this.prevPlaybackTimeMs&&this.ignoreUnseekedZeroPts?u.info("getPlaybackTimeMs: Ignoring ticks: "+t+" and timescale: "+n+", reporting "+this.prevPlaybackTimeMs+" instead"):(n===f.MS_TIMESCALE&&(this.prevPlaybackTimeMs=t),this.prevPlaybackTimeMs=0===n?0:t/n*f.MS_TIMESCALE),this.prevPlaybackTimeMs}return this.prevPlaybackTimeMs=this.pendingSeek.timestampMs,this.pendingSeek.timestampMs}),enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"viewport",{get:freeOnUnref(function(){var e=_t.surfaceRefManager.getSurfaceRef();if(this.isSurfaceRefValid(e)&&_t.isViewportValid(e.viewport))return{width:e.viewport.width,height:e.viewport.height}}),enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"state",{get:freeOnUnref(function(){return this.internalState}),enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"error",{get:freeOnUnref(function(){return this.internalError}),enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"metadata",{get:freeOnUnref(function(){return{nativePlaybackStack:"UNF"}}),enumerable:!0,configurable:!0}),f.capabilities=freeOnUnref(function(){return{supportsAudioVolume:!1}}),f.prototype.setMpbConfiguration=freeOnUnref(function(e){this.mpbConfiguration=e}),f.prototype.createMPBState=freeOnUnref(function(){var t=this;return{reset:freeOnUnref(function(){this.isBufferReady=!1,delete this.pendingFlush}),get status(){return t.mpbStatus},isBufferReady:!1,setBufferReady:freeOnUnref(function(e){(this.isBufferReady=e)&&t.bufferIsReady()})}}),f.prototype.sendPendingSeek=freeOnUnref(function(t){if(null!=this.pendingSeek){var n=this.pendingSeek;this.pendingSeek=null,u.info("Executing pending seek to "+n.timestampMs+"ms");var e=this.mediaControlImpl.seek(n.timestampMs,f.MS_TIMESCALE,freeOnUnref(function(e){u.info("Pending seek to "+n.timestampMs+"ms completed with code "+e),t(e),null!=n.handler&&n.handler(e)}));0!==e&&(u.info("Pending seek to "+n.timestampMs+"ms failed with result "+e),t(e),null!=n.handler&&n.handler(e))}else t(0)}),f.prototype.sendPendingStop=freeOnUnref(function(t){if(null!=this.pendingStop){var n=this.pendingStop;this.pendingStop=null,u.info("Executing pending stop");var e=this.mediaControlImpl.stop(freeOnUnref(function(e){u.info("Pending stop completed with code "+e),t(e),n(e)}));0!==e&&(u.info("Pending stop failed with result "+e),t(e),n(e))}else t(0)}),f.prototype.sendPendingFlush=freeOnUnref(function(n){var r=this;if(this.buffers.some(freeOnUnref(function(e){return null!=e.state.pendingFlush}))){u.info("Executing pending flush");var t=this.mediaControlImpl.flush(freeOnUnref(function(t){u.info("Pending flush completed with code "+t);var e=r.buffers.map(freeOnUnref(function(e){return e.buffer.performPendingFlush(t)}));lt.Promise.all(e).then(freeOnUnref(function(){n(t)}))}));if(0!==t){u.info("Pending flush failed with result "+t);var e=this.buffers.map(freeOnUnref(function(e){return e.buffer.performPendingFlush(t)}));lt.Promise.all(e).then(freeOnUnref(function(){n(t)}))}}else n(0)}),f.prototype.bufferIsReady=freeOnUnref(function(){var r=this;0===this.mpbStatus&&(this.buffers.every(freeOnUnref(function(e){return e.state.isBufferReady}))&&(this.mpbStatus=1,this.sendPendingSeek(freeOnUnref(function(e){if(0===e){r.mpbStatus=2;for(var t=0,n=r.buffers;t<n.length;t++){n[t].buffer.doSendSamples()}}else r.handleMpbError(e,"Seek failed with code ["+e+"] while initializing MPB","MediaControlAdapter",1)}))))}),f.prototype.resetPlaybackTimePollingHandle=freeOnUnref(function(){-1!==this.playbackTimePollingHandle&&(this.timer.clearInterval(this.playbackTimePollingHandle),this.playbackTimePollingHandle=-1)}),f.prototype.checkStateIn=freeOnUnref(function(e){c(CI.includes(e,this.internalState),"MediaControl state "+this.internalState+" not in expected states ["+e+"]").is.true()}),f.prototype.handleStateChange=freeOnUnref(function(r,i){var o=this;return freeOnUnref(function(e){var t=e?4:r,n=o.internalState;u.info("Changing MediaControl state to "+t+", previous state was "+n),o.internalState=t,o.internalError=e,i(e),n!==t&&o.eventEmitter.emitSync("MediaControlStateChange",t)})}),f.prototype.handleNativeInit=freeOnUnref(function(i,o){var a=this;return freeOnUnref(function(e){var t=void 0;0!==e&&((t=new Error("MediaControlError: "+e)).code=e),_t.surfaceRefManager.setResizeViewportFunction(a.resizeFnc);var n=t?4:i,r=a.internalState;a.internalState=n,a.internalError=t,4!==a.internalState&&null!==a.drmSystem?a.setDrmSystem(a.drmSystem,o):o(t),r!==n&&a.eventEmitter.emitSync("MediaControlStateChange",n)})}),f.prototype.adaptNativeError=freeOnUnref(function(t){var n=this;return freeOnUnref(function(e){0===e?t():(n.internalError=new Error("Native error code: "+e+" received in callback"),n.internalError.code=e,4!==n.internalState&&(n.internalState=4,n.eventEmitter.emitSync("MediaControlStateChange",4)),t(n.internalError))})}),f.prototype.switchToErrorStateAndRaiseError=freeOnUnref(function(e,t){var n=this;throw this.internalError=Error("MediaControl method "+e+" failed with message "+t.message+" and error code "+t.errorCode),this.internalError.code=t.errorCode,4!==this.internalState&&(this.internalState=4,this.timer.setImmediate(freeOnUnref(function(){return n.eventEmitter.emitSync("MediaControlStateChange",4)}))),this.internalError}),f.prototype.checkMPBErrorCode=freeOnUnref(function(e,t){0!==t&&this.switchToErrorStateAndRaiseError(e,{errorCode:t,message:"Error code returned from native function"})}),f.prototype.abandonPlaybackPolling=freeOnUnref(function(e){-1!==this.playbackTimePollingHandle&&this.playbackStartedPollingState===l.POLL&&(u.info("Triggering playback-started polling to be abandoned using new PollingState "+e),this.playbackStartedPollingState=e)}),f.prototype.handleMpbError=freeOnUnref(function(e,t,n,r){if(this.abandonPlaybackPolling(l.REJECT),null==this.drmSystem||!this.drmSystem.handleMpbError(e,t,n,r)){var i="[MPB ERROR]["+n+"]["+r+"]["+e+"] "+t,o=new Error(i);null!=t&&this.backgroundedErrorMessageRegExs.some(freeOnUnref(function(e){return e.test(t)}))?(o.code=50801,u.info('Description "'+t+'" matched backgrounded pattern so error '+e+" has been transformed to "+o.code)):o.code=e,this.internalError=o,u.error("Changing state to Error due to "+i);var a=this.internalState;(this.internalState=4)!==a&&this.eventEmitter.emitSync("MediaControlStateChange",4)}}),f.prototype.onMediaBufferEvent=freeOnUnref(function(e){var t=this;switch(e){case"ReadyToPlay":if(3!==this.mpbStatus&&(u.info("Received ReadyToPlay when MPB status is "+this.mpbStatus),this.mpbStatus=3,null!=this.pendingStop||this.buffers.some(freeOnUnref(function(e){return null!=e.state.pendingFlush}))||null!=this.pendingSeek)){this.sendPendingStop(freeOnUnref(function(e){0===e?t.sendPendingFlush(freeOnUnref(function(e){0===e?t.sendPendingSeek(freeOnUnref(function(e){})):t.sendError("Failed to execute pending flush: "+e)})):t.sendError("Failed to execute pending stop: "+e)}));break}u.info("onMediaBufferEvent READY_TO_PLAY - current state "+this.internalState),this.buffers.map(this.callReadyToPlay);break;case"BufferUnderrun":5!==this.internalState&&0!==this.internalState&&4!==this.internalState?(u.info("onMediaBufferEvent MEDIA_BUFFER_UNDERRUN - current state "+this.internalState+": state is now Paused"),this.internalState=3,this.abandonPlaybackPolling(l.RESOLVE),this.minPlaybackTimeToSwitchToPlayingMs=this.playbackTimeMs,CI.map(this.buffers,this.callBufferUnderrun),this.eventEmitter.emitSync("MediaControlStateChange",this.internalState)):u.info("onMediaBufferEvent MEDIA_BUFFER_UNDERRUN - current state "+this.internalState+": ignoring");break;case"EndOfStream":u.info("onMediaBufferEvent MEDIA_END_OF_STREAM - current state "+this.internalState),CI.map(this.buffers,this.callEndOfStream),this.endOfStreamReceived=!0;break;case"PlaybackStarted":u.info("onMediaBufferEvent RENDERING_STARTED - current state "+this.internalState);break;default:this.sendError("MediaControl received onMediaBufferEvent with incorrect code")}}),f.prototype.sendError=freeOnUnref(function(e){var t=new Error(e);u.error("Changing state to Error due to "+e),this.internalState=4,this.internalError=t,this.eventEmitter.emitSync("MediaControlStateChange",4)}),f.prototype.blockSeekToCurrentPosition=freeOnUnref(function(){return null!=this.deviceInformation.hardware&&null!=this.deviceInformation.hardware.manufacturer?"SAMSUNG"===this.deviceInformation.hardware.manufacturer.toUpperCase():(u.warn("Unable to determine manufacturer. Assuming double seeking is SUPPORTED"),!1)}),f.prototype.trySetVideoOutputPosition=freeOnUnref(function(e,t){if(!this.isSurfaceRefValid(e))return this.internalError=new Error("Expected surfaceRef to be an object but got "+JSON.stringify(e)+" instead"),this.internalError.code=50005,this.internalState=4,this.eventEmitter.emitSync("MediaControlStateChange",4),void t(this.internalError);var n=this.mediaControlImpl.isResizingSupported();if(!_t.isViewportValid(e.viewport))return u.info("Skipping static resize as resizing is "+(n?"":"not")+" supported and viewport is invalid "+JSON.stringify(e.viewport)),void t();if(!n)return this.internalError=new Error("Trying to set position/size of the player but operation is not supported"),this.internalError.code=50007,this.internalState=4,this.eventEmitter.emitSync("MediaControlStateChange",4),void t(this.internalError);var r=e.viewport,i=r.x,o=r.y,a=r.width,s=r.height;u.info("Calling setVideoOutputPosition for static resize with viewport: "+JSON.stringify({x:i,y:o,width:a,height:s}));var l=this.mediaControlImpl.setVideoOutputPosition(i,o,a,s,this.adaptNativeError(t));this.checkMPBErrorCode("setVideoOutputPosition",l)}),f.prototype.isSurfaceRefValid=freeOnUnref(function(e){return null!=e&&"object"==typeof e}),f.prototype.isFullScreenPlayback=freeOnUnref(function(e){if(!this.isSurfaceRefValid(e)||!_t.isViewportValid(e.viewport))return!0;var t=Qe.nestedValue(this.deviceCapabilities,"output.video.display.width",-1),n=Qe.nestedValue(this.deviceCapabilities,"output.video.display.height",-1),r=e.viewport,i=r.x,o=r.y,a=r.width,s=r.height;return 0===i&&0===o&&s===n&&a===t}),f.prototype.getDeviceSupportedPictureModes=freeOnUnref(function(){return Qe.nestedValue(this.deviceCapabilities,"output.video.display.supportedPictureModes",[])}),f.MS_TIMESCALE=1e3,f.NATIVE_SUCCESS_CODE=0,f})();t.MediaControlAdapter=n}));e(wI);wI.MediaControlAdapter;var II=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaControl=wI.MediaControlAdapter}));e(II);II.MediaControl;var kI=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.MEDIA_CONTROL_STATE_MAP=((n={})[0]="Uninitialized",n[1]="Idle",n[2]="Playing",n[3]="Paused",n[4]="Error",n[5]="Uninitializing",n)}));e(kI);kI.MEDIA_CONTROL_STATE_MAP;var _I=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("PlaybackStartedMonitor"),a="displayModeChanging",r=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.timer=e,this.mmlMediaControl=t,this.timeoutMs=n,this.displayModeChangeTimeoutMs=r,this.internalState="idle",this.eventEmitter=new A.EventEmitter,this.internalState="pending";var o=t.getProperty(a);this.isDisplayModeChanging=o.error_code===p.MPBErrors.OK&&"true"===o.value,t.on("property-changed",freeOnUnref(function(e){e.key===a&&i.onDisplayModeChanging("true"===e.value)})),t.once("playback-started",freeOnUnref(function(){i.isPending()&&(i.internalState="idle",i.eventEmitter.emitSync("finished"))})),this.startTimeoutWatchdog(),this.once("cancelled",freeOnUnref(function(){return i.clear()})),this.once("finished",freeOnUnref(function(){return i.clear()}))}return e.prototype.once=freeOnUnref(function(e,t){this.eventEmitter.once(e,t)}),e.prototype.isPending=freeOnUnref(function(){return"pending"===this.internalState}),e.prototype.cancel=freeOnUnref(function(){this.isPending()&&(n.info("cancelling pending playback started monitor"),this.internalState="cancelled",this.eventEmitter.emit("cancelled"),this.clear())}),e.prototype.onDisplayModeChanging=freeOnUnref(function(e){n.info("Display mode is now changing="+e+" (previously "+this.isDisplayModeChanging+")"),e!==this.isDisplayModeChanging&&(this.isDisplayModeChanging=e,null!=this.timeoutWatchdog&&(this.clearTimeoutWatchdog(),this.startTimeoutWatchdog()))}),e.prototype.startTimeoutWatchdog=freeOnUnref(function(){var e=this,t=this.isDisplayModeChanging?this.displayModeChangeTimeoutMs:this.timeoutMs;this.timeoutWatchdog=this.timer.setTimeout(freeOnUnref(function(){n.warn("PlaybackStartedMonitor watchdog timed out"),e.isPending()&&(e.internalState="idle",e.eventEmitter.emitSync("timed-out",e.timeoutMs))}),t)}),e.prototype.clearTimeoutWatchdog=freeOnUnref(function(){null!=this.timeoutWatchdog&&(this.timer.clearTimeout(this.timeoutWatchdog),this.timeoutWatchdog=void 0)}),e.prototype.clear=freeOnUnref(function(){this.clearTimeoutWatchdog(),this.mmlMediaControl.off("property-changed",this.propertyChangedListener)}),e})();t.PlaybackStartedMonitor=r}));e(_I);_I.PlaybackStartedMonitor;var RI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=p,d=de.get("MMLMediaControlAdapter"),o=f.of("MMLMediaControlAdapter"),n=freeOnUnref(function(){function r(){var a=this;if(this.buffers=[],this.playbackStartedTimeoutMs=5e3,this.displayModeChangeTimeoutMs=2e4,this.mpbV3Config="",this.pictureModeManager=null,this.pictureModeSet=!1,this.timer=oe.timer,this.metrics=q.metrics,this.configuration=L.configurationStore.configuration,this.onError=freeOnUnref(function(e){null!=a.playbackStartedMonitor&&a.playbackStartedMonitor.cancel();var t=e.component_name,n=e.severity,r=e.error_code,i=e.description;if(null==a.drmSystem||!a.drmSystem.handleMpbError(r,i,t,n))if(null!=i&&0<a.backgroundedErrorMessageRegExs.length&&a.backgroundedErrorMessageRegExs.some(freeOnUnref(function(e){return e.test(i)})))d.info('Description "'+i+'" matched backgrounded error pattern so error '+r+" has been suppressed.");else{var o=new Error("[MPB ERROR]["+t+"]["+n+"]["+r+"] "+i);o.code=r,d.error("MediaControl transitioning to error state from "+a.internalState+": received MPB error callback: "+o.message),a.setNextState(4,l.noop,o)}}),this.onReadyToPlay=freeOnUnref(function(){d.info("onMediaBufferEvent READY_TO_PLAY - current state "+a.internalState),a.buffers.forEach(freeOnUnref(function(e){return e.onReadyToPlay()}))}),this.onBufferUnderrun=freeOnUnref(function(){5!==a.internalState&&0!==a.internalState&&4!==a.internalState?(d.info("onMediaBufferEvent MEDIA_BUFFER_UNDERRUN - current state "+a.internalState+": state is now Paused"),null!=a.playbackStartedMonitor&&a.playbackStartedMonitor.cancel(),a.internalState=3,a.buffers.forEach(freeOnUnref(function(e){return e.onUnderrun()})),a.eventEmitter.emitSync("MediaControlStateChange",a.internalState)):d.info("onMediaBufferEvent MEDIA_BUFFER_UNDERRUN - current state "+a.internalState+": ignoring")}),this.onEndOfStream=freeOnUnref(function(){d.info("onMediaBufferEvent MEDIA_END_OF_STREAM - current state "+a.internalState),a.buffers.forEach(freeOnUnref(function(e){return e.onEndOfStream()}))}),this.onPropertyChanged=freeOnUnref(function(e){var t=e.value,n=e.key;d.info("onPropertyChanged MEDIA_PROPERTY_CHANGED "+t+" "+n)}),this.onPictureModeChanged=freeOnUnref(function(e){d.info("API level MEDIA_PROPERTY_CHANGED: "+e),null!=a.pictureModeManager&&a.pictureModeManager.handlePictureMode(Ns.PictureModeMappings.NATIVE_TO_MEDIA_CONTROL[e])}),this.onCodecInitialized=freeOnUnref(function(e){a.maxVideoResolution=e.maxResolution,null!=a.drmSystem&&a.drmSystem.startHdcpPolling(a.maxVideoResolution)}),this.instanceManager=T.getInstanceManager("DASH",this.metrics),this.eventEmitter=new A.EventEmitter,this.internalState=0,this.playerSuggestedPictureModes=[],this.pictureModeSet=!1,null!=this.configuration){this.playbackStartedTimeoutMs=Qe.nestedValue(this.configuration,"device.MediaControl.maxPlaybackStartPollTimeMs",5e3),this.displayModeChangeTimeoutMs=Qe.nestedValue(this.configuration,"device.MediaControl.displayModeChangeTimeoutMs",2e4);var e=Qe.nestedValue(this.configuration,"device.backgroundedErrorMessagePatterns",[]);this.backgroundedErrorMessageRegExs=Array.isArray(e)&&0<e.length?e.map(freeOnUnref(function(t){try{return"string"==typeof t?new RegExp(t,"i"):(d.error("Invalid pattern, expected type string but got: "+typeof t+", value: "+t),new RegExp("$."))}catch(e){return d.warn("Invalid regular expression pattern: "+t),new RegExp("$.")}})):[];var t=Qe.nestedValue(this.configuration,"device.mpbv3Config","");this.mpbV3Config=this.processMpbV3Config(t)}}return r.capabilities=freeOnUnref(function(){var e=T.getInstanceManager("DASH",q.metrics).getCapabilities(),t=e.errorCode,n=e.capabilities;return t!==p.MPBErrors.OK?(d.warn("capabilities, error reading MPB capabilities = "+t+" defaulting to safe values"),{supportsAudioVolume:!1}):{supportsAudioVolume:Qe.withDefault(n.supportsAudioVolume,!1)}}),Object.defineProperty(r.prototype,"state",{get:freeOnUnref(function(){return this.internalState}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"playbackTimeMs",{get:freeOnUnref(function(){0===this.state&&this.handleSyncErrorCode("getPlaybackTime",p.MPBErrors.NOT_INITIALIZED);var e=this.mmlMediaControl.getPlaybackTime();this.handleSyncErrorCode("getPlaybackTime",e.error_code);var t=e.ticks,n=e.timescale;return n===r.MS_TIMESCALE?t:0===n?0:t/n*r.MS_TIMESCALE}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"error",{get:freeOnUnref(function(){return this.internalError}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"viewport",{get:freeOnUnref(function(){if(null!=this.mmlInstanceController&&null!=this.mmlInstanceController.viewport)return l.pick(this.mmlInstanceController.viewport,["width","height"])}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"metadata",{get:freeOnUnref(function(){return{nativePlaybackStack:"MML"}}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"volume",{get:freeOnUnref(function(){return this.checkStateIn([1,2,3]),this.mmlMediaControl.volume}),set:freeOnUnref(function(e){this.checkStateIn([1,2,3]),this.mmlMediaControl.volume=e}),enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mute",{get:freeOnUnref(function(){return this.checkStateIn([1,2,3]),this.mmlMediaControl.mute}),set:freeOnUnref(function(e){this.checkStateIn([1,2,3]),this.mmlMediaControl.mute=e}),enumerable:!0,configurable:!0}),r.prototype.getDiagnosticInfo=freeOnUnref(function(){0!==this.state&&null!=this.mmlMediaControl||this.handleSyncErrorCode("getDiagnostics",p.MPBErrors.NOT_INITIALIZED);var e=this.mmlMediaControl.getDiagnostics();return e.error_code!==p.MPBErrors.OK&&this.handleSyncErrorCode("getDiagnostics",e.error_code),{numVideoDroppedFrames:e.num_dropped_frames}}),r.prototype.attachAudioBuffer=freeOnUnref(function(e){d.info("attachAudioBuffer"),this.buffers.push(e)}),r.prototype.attachVideoBuffer=freeOnUnref(function(e){d.info("attachVideoBuffer"),e.onCodecInitialized(this.onCodecInitialized),this.buffers.push(e)}),r.prototype.init=freeOnUnref(function(t,e,n){var r=this;if(this.checkStateIn([0,1]),1===this.internalState)return d.info("skipping init since state is Idle"),void this.timer.setImmediate(freeOnUnref(function(){return t()}));d.info("init, controlConfig="+JSON.stringify(n)+", initConfig="+this.mpbV3Config);try{var i=null!=n&&null!=n.surfaceRefId?n.surfaceRefId:null;this.mmlInstanceController=xs.createMediaControlSurface(i,_t.surfaceRefRegistry,this.instanceManager,this.metrics,"Mml")}catch(e){return d.error("error creating media object",e),void this.handleAsyncErrorCode("createMediaObject",p.MPBErrors.INVALID_STATE,t)}for(var o=freeOnUnref(function(){null!=r.mmlInstanceController&&(r.mmlInstanceController.destroy(),r.mmlInstanceController=void 0)}),a=0,s=this.buffers;a<s.length;a++){s[a].setBufferConnector(this.mmlInstanceController.buffer)}var l=this.mmlInstanceController.mediaControl;l.on("error",this.onError),l.on("ready-to-play",this.onReadyToPlay),l.on("buffer-underrun",this.onBufferUnderrun),l.on("end-of-stream",this.onEndOfStream),l.on("property-changed",this.onPropertyChanged);var f=this.mmlInstanceController.init(this.mpbV3Config);if(f===p.MPBErrors.INVALID_STATE){d.info("MPB init returned INVALID_STATE error code "+p.MPBErrors.INVALID_STATE+", attempting shutdown then re-init");var u=this.mmlInstanceController.shutdown();if(u!==p.MPBErrors.OK)return o(),void this.handleAsyncErrorCode("shutdown of init-shutdown-init",u,t);d.info("shutdown success, attempting re-init"),f=this.mmlInstanceController.init(this.mpbV3Config)}if(f!==p.MPBErrors.OK)return o(),void this.handleAsyncErrorCode("init",f,t);if(null!=this.drmSystem){var c=this.doSetDRMSystem(this.drmSystem);if(c!==p.MPBErrors.OK)return o(),void this.handleAsyncErrorCode("setDrmSystem during init",c,t)}this.playerSuggestedPictureModes=Qe.nestedValue(n,"suggestedPictureModes",[]),this.pictureModeManager=new Ns.PictureModeManager(this.playerSuggestedPictureModes,this.eventEmitter),this.instanceManager.on("picture-mode-changed",this.onPictureModeChanged),this.controlConfig=n,this.handleAsync("init",1,p.MPBErrors.OK,t)}),r.prototype.play=freeOnUnref(function(n){var r=this;if(this.checkStateIn([1,3]),d.info("play"),null!=this.playbackStartedMonitor&&this.playbackStartedMonitor.isPending())return d.info("skipping play since playback started is pending"),void this.timer.setImmediate(n);null!=this.controlConfig&&this.controlConfig.allowFrameRateMatching&&(d.info("set matchRefreshRate property in media control connector"),this.mmlMediaControl.setProperty("matchRefreshRate","true")),this.setPictureMode();var e=this.mmlMediaControl.play();if(e!==p.MPBErrors.OK)return this.resetPictureMode(),void this.handleAsyncErrorCode("play",e,n);this.playbackStartedMonitor=new _I.PlaybackStartedMonitor(this.timer,this.mmlMediaControl,this.playbackStartedTimeoutMs,this.displayModeChangeTimeoutMs),this.playbackStartedMonitor.once("finished",freeOnUnref(function(){r.setNextState(2,n),d.info("onMediaBufferEvent RENDERING_STARTED - current state "+r.internalState),r.playbackStartedMonitor=void 0})),this.playbackStartedMonitor.once("cancelled",freeOnUnref(function(){d.warn("playback started callback received but playback was cancelled, calling handler"),n(),r.playbackStartedMonitor=void 0,r.resetPictureMode()})),this.playbackStartedMonitor.once("timed-out",freeOnUnref(function(e){d.error("playback started callback monitor timed out, calling handler with error");var t=new Error("MediaControlError: playback did not start in "+e+"ms");t.code=1,r.setNextState(4,n,t),r.playbackStartedMonitor=void 0,r.resetPictureMode()}))}),r.prototype.pause=freeOnUnref(function(e){this.checkStateIn([2]),d.info("pause");var t=this.mmlMediaControl.pause();this.handleAsync("pause",3,t,e)}),r.prototype.seek=freeOnUnref(function(e,t){o(0<=e,"non-negative timestamp").is.true(),this.checkStateIn([3,1]),d.info("seek to "+e+".");var n=this.mmlMediaControl.seek(e,r.MS_TIMESCALE);this.handleAsync("seek",this.internalState,n,t)}),r.prototype.stop=freeOnUnref(function(e){if(d.info("stop"),2===this.state||3===this.state||1===this.state){null!=this.playbackStartedMonitor&&this.playbackStartedMonitor.cancel();var t=this.mmlMediaControl.stop();this.handleAsync("stop",1,t,e)}else d.info("Stop called in state "+this.state+", skipping and invoking handler"),this.timer.setImmediate(e)}),r.prototype.onStateChange=freeOnUnref(function(e){this.eventEmitter.removeAllListeners("MediaControlStateChange"),this.on("MediaControlStateChange",e)}),r.prototype.offStateChange=freeOnUnref(function(){this.eventEmitter.removeAllListeners("MediaControlStateChange")}),r.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),r.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),r.prototype.shutdown=freeOnUnref(function(e){if(d.info("shutdown"),this.checkStateIn([1,2,3,4]),null==this.mmlInstanceController)throw new Error("mml media control is undefined");this.internalState=5;var t=this.mmlInstanceController.shutdown();t===p.MPBErrors.NOT_INITIALIZED&&(d.warn("MPB shutdown returned with native error code "+t+" - MPB was not initialised, ignoring"),t=p.MPBErrors.OK),this.resetPictureMode(),this.pictureModeSet=!1,this.instanceManager.off("picture-mode-changed",this.onPictureModeChanged),(this.pictureModeManager=null)!=this.drmSystem&&this.drmSystem.stopHdcpPolling(),null!=this.playbackStartedMonitor&&this.playbackStartedMonitor.cancel();var n=this.mmlInstanceController.destroy();n!==p.MPBErrors.OK&&d.warn("instance destroy error code "+n+" during media control shutdown, ignoring"),this.mmlInstanceController=void 0,this.maxVideoResolution=void 0,t===p.MPBErrors.OK?this.handleAsync("shutdown",0,t,e):this.handleAsyncErrorCode("instance shutdown during media control shutdown",t,e)}),r.prototype.setDrmSystem=freeOnUnref(function(e,t){this.checkStateIn([1,2,3]),d.info("setDrmSystem"),this.drmSystem=e;var n=this.doSetDRMSystem(this.drmSystem);this.handleAsync("setDrmSystem",this.internalState,n,t)}),Object.defineProperty(r.prototype,"mmlMediaControl",{get:freeOnUnref(function(){return null==this.mmlInstanceController?null:this.mmlInstanceController.mediaControl}),enumerable:!0,configurable:!0}),r.prototype.setPictureMode=freeOnUnref(function(){var t=this;this.pictureModeSet||this.playerSuggestedPictureModes.forEach(freeOnUnref(function(e){d.info("Trying to setPictureMode: "+e),t.tryToSetPictureMode(e)}))}),r.prototype.resetPictureMode=freeOnUnref(function(){if(this.pictureModeSet)if(null!=this.pictureModeManager){var e=this.instanceManager.setProperty(i.PICTURE_MODE_PROPERTY_KEY,"none");this.pictureModeManager.handleSetPictureModeReturnCode(e,"None"),e===p.MPBErrors.OK?(this.metrics.putMetric("PictureMode.None.Enabled",0),d.info("setPictureMode for None succeeded with error code "+e)):d.error("None setPictureMode failed with native error code "+e)}else d.warn("Cannot resetPictureMode, picture mode manager instance is "+this.pictureModeManager);else d.info("Picture mode was not set, skipping reset")}),r.prototype.doSetDRMSystem=freeOnUnref(function(e){var t=this.mmlMediaControl.setDRMSystem(e.getDrmSystemManager());return t===p.MPBErrors.OK&&null!=this.maxVideoResolution&&e.startHdcpPolling(this.maxVideoResolution),t}),r.prototype.handleAsync=freeOnUnref(function(e,t,n,r){var i=this;n===p.MPBErrors.OK?this.timer.setImmediate(freeOnUnref(function(){return i.setNextState(t,r)})):this.handleAsyncErrorCode(e,n,r)}),r.prototype.handleAsyncErrorCode=freeOnUnref(function(e,t,n){var r=this,i=new Error("Native error "+t+" returned from "+e);i.code=t,this.timer.setImmediate(freeOnUnref(function(){return r.setNextState(4,n,i)}))}),r.prototype.handleSyncErrorCode=freeOnUnref(function(e,t){if(t!==p.MPBErrors.OK){var n=Error("MediaControl method "+e+' failed with message: "Error code returned from native function" and error code "'+t+'"');throw n.code=t,this.setNextState(4,l.noop,n),this.internalError}}),r.prototype.setNextState=freeOnUnref(function(e,t,n){var r=this.internalState;this.internalState=e,this.internalError=4===e?n:void 0,t(this.internalError),r!==e&&(d.info("Changing MediaControl state to "+kI.MEDIA_CONTROL_STATE_MAP[e]+", previous state was "+kI.MEDIA_CONTROL_STATE_MAP[r]),this.eventEmitter.emitSync("MediaControlStateChange",this.internalState)),n&&d.info(""+n.stack)}),r.prototype.checkStateIn=freeOnUnref(function(e){var t=l.includes(e,this.internalState);o(t,"MediaControl state "+this.internalState+" not in expected states ["+JSON.stringify(e)+"]").is.true()}),r.prototype.tryToSetPictureMode=freeOnUnref(function(e){if(null!=this.pictureModeManager){if(!this.pictureModeManager.shouldEnablePictureMode(e,this.isFullScreenPlayback()))return this.metrics.putMetric("PictureMode."+e+".Enabled",0),void d.info(e+" picture mode not set, not all requirements are met");var t=Ns.PictureModeMappings.MEDIA_CONTROL_TO_NATIVE[e];if(null==t)return this.metrics.putMetric("PictureMode."+e+".Enabled",0),d.error("setPictureMode for "+e+" failed due to media control to native picture mode conversion failed"),void this.pictureModeManager.handleSetPictureModeReturnCode(p.MPBErrors.VALUE_NOT_SUPPORTED,e);var n=this.instanceManager.setProperty(i.PICTURE_MODE_PROPERTY_KEY,t);this.pictureModeManager.handleSetPictureModeReturnCode(n,e),n===p.MPBErrors.OK?(this.pictureModeSet=!0,this.metrics.putMetric("PictureMode."+e+".Enabled",1),d.info("setPictureMode for "+e+" succeeded with error code "+n)):d.error(e+" setPictureMode failed with native error code "+n)}else d.error("PictureModeManager not initialized")}),r.prototype.isFullScreenPlayback=freeOnUnref(function(){if(null==this.mmlInstanceController||null==this.mmlInstanceController.viewport)return!0;var e=this.mmlInstanceController.viewport,t=e.x,n=e.y,r=e.width,i=e.height,o=Qe.nestedValue(zt.deviceCapabilities,"output.video.display.width",-1),a=Qe.nestedValue(zt.deviceCapabilities,"output.video.display.height",-1);return 0===t&&0===n&&r===o&&i===a}),r.prototype.processMpbV3Config=freeOnUnref(function(e){if(!e||"object"!=typeof e||0===Object.keys(e).length)return"";var t=Qe.nestedValue(zt.deviceInformation,"hardware.model.name"),n=t&&e[t];return n&&"object"==typeof n&&0<Object.keys(n).length?JSON.stringify(n):JSON.stringify(e)}),r.MS_TIMESCALE=1e3,r})();t.MediaControlAdapter=n}));e(RI);RI.MediaControlAdapter;var AI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaControl=RI.MediaControlAdapter}));e(AI);AI.MediaControl;var DI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){var e=Si.chooseImplementation(II.MediaControl,AI.MediaControl);return e===II.MediaControl?q.metrics.putMetric("MediaControlInterceptor.DASH.UNF"):q.metrics.putMetric("MediaControlInterceptor.DASH.MML"),new e}return e.capabilities=freeOnUnref(function(){return Si.chooseImplementation(II.MediaControl,AI.MediaControl)===II.MediaControl?II.MediaControl.capabilities():AI.MediaControl.capabilities()}),e})();t.MediaControlInterceptor=n}));e(DI);DI.MediaControlInterceptor;var xI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaControl=DI.MediaControlInterceptor}));e(xI);xI.MediaControl;var FI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.promisify=function(i,o){for(var a=[],e=2;e<arguments.length;e++)a[e-2]=arguments[e];return new lt.Promise(freeOnUnref(function(t,n){var e=freeOnUnref(function(e){null!=e?n(e):t()}),r=Array.prototype.slice.call(a);r.push(e),o.apply(i,r)}))}}));e(FI);FI.promisify;var BI=t(freeOnUnref(function(e,t){function n(e,t){var n=new Error(t);return n.code=e,n}Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(){function e(e){this.isReadyForUse=!1,this.buffer=e}return e.prototype.init=freeOnUnref(function(e,t){throw new Error("init called on BufferWrapper, this should not happen!")}),e.prototype.shutdown=freeOnUnref(function(e){throw new Error("shutdown called on BufferWrapper, this should not happen!")}),Object.defineProperty(e.prototype,"state",{get:freeOnUnref(function(){return this.isReadyForUse?this.buffer.state:0}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:freeOnUnref(function(){return this.buffer.error}),enumerable:!0,configurable:!0}),e.prototype.flush=freeOnUnref(function(e){this.isReadyForUse?this.buffer.flush(e):e(n(-1,"Attempting to flush buffer, but it is not in an usable state!"))}),e.prototype.endOfStream=freeOnUnref(function(){if(!this.isReadyForUse)throw n(-1,"Attempting to signal end of stream on buffer, but it is not in an usable state!");this.buffer.endOfStream()}),e.prototype.onStateChange=freeOnUnref(function(e){this.buffer.onStateChange(e)}),e.prototype.offStateChange=freeOnUnref(function(){this.buffer.offStateChange()}),e.prototype.initializeCodec=freeOnUnref(function(e,t){this.isReadyForUse?this.buffer.initializeCodec(e,t):t(n(-1,"Attempting to initialize buffer codec, but it is not in an usable state!"))}),e.prototype.enqueueSample=freeOnUnref(function(e){if(this.isReadyForUse)return this.buffer.enqueueSample(e);throw n(-1,"Attempting to enqueue a sample, but buffer is not in an usable state!")}),e})();t.BufferWrapper=r}));e(BI);BI.BufferWrapper;var LI=t(freeOnUnref(function(e,t){function n(e,t){var n=new Error(t);return n.code=e,n}Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(){function e(e){this.isReadyForUse=!1,this.mediaControl=e}return e.prototype.attachAudioBuffer=freeOnUnref(function(e){throw new Error("attachAudioBuffer called on ControlWrapper, this should not happen!")}),e.prototype.attachVideoBuffer=freeOnUnref(function(e){throw new Error("attachVideoBuffer called on ControlWrapper, this should not happen!")}),e.prototype.init=freeOnUnref(function(e,t,n){throw new Error("init called on ControlWrapper, this should not happen!")}),e.prototype.shutdown=freeOnUnref(function(e){throw new Error("shutdown called on ControlWrapper, this should not happen!")}),e.prototype.setDrmSystem=freeOnUnref(function(e,t){this.mediaControl.setDrmSystem(e,t)}),Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){return this.mediaControl.volume}),set:freeOnUnref(function(e){void 0!==e&&(this.mediaControl.volume=e)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mute",{get:freeOnUnref(function(){return this.mediaControl.mute}),set:freeOnUnref(function(e){void 0!==e&&(this.mediaControl.mute=e)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:freeOnUnref(function(){return this.isReadyForUse?this.mediaControl.state:0}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackTimeMs",{get:freeOnUnref(function(){return this.isReadyForUse?this.mediaControl.playbackTimeMs:0}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:freeOnUnref(function(){return this.mediaControl.error}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:freeOnUnref(function(){return this.mediaControl.viewport}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:freeOnUnref(function(){return this.mediaControl.metadata}),enumerable:!0,configurable:!0}),e.prototype.getDiagnosticInfo=freeOnUnref(function(){return this.isReadyForUse?this.mediaControl.getDiagnosticInfo():{numVideoDroppedFrames:0}}),e.prototype.play=freeOnUnref(function(e){this.isReadyForUse?this.mediaControl.play(e):e(n(-1,"Attempted to play on a MediaControl that is not ready!"))}),e.prototype.pause=freeOnUnref(function(e){this.isReadyForUse?this.mediaControl.pause(e):e(n(-1,"Attempted to pause on a MediaControl that is not ready!"))}),e.prototype.seek=freeOnUnref(function(e,t){this.isReadyForUse?this.mediaControl.seek(e,t):t(n(-1,"Attempted to seek on a MediaControl that is not ready!"))}),e.prototype.stop=freeOnUnref(function(e){this.isReadyForUse?this.mediaControl.stop(e):e(n(-1,"Attempted to stop a MediaControl that is not ready!"))}),e.prototype.onStateChange=freeOnUnref(function(e){this.mediaControl.onStateChange(e)}),e.prototype.offStateChange=freeOnUnref(function(){this.mediaControl.offStateChange()}),e.prototype.on=freeOnUnref(function(e,t){this.mediaControl.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.mediaControl.off(e,t)}),e})();t.ControlWrapper=r}));e(LI);LI.ControlWrapper;var NI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("MediaObject"),n=freeOnUnref(function(){function e(){var t=this;this.pendingInitializeDeferred=null,this.activeInitializeDeferred=null,this.onInitializeError=freeOnUnref(function(e){null!=t.activeInitializeDeferred&&(t.activeInitializeDeferred.reject(e),t.activeInitializeDeferred=null)}),this.onShutdownDuringError=freeOnUnref(function(){null!=t.shutdownDeferred&&(t.shutdownDeferred.reject("Shutdown while in error"),t.shutdownDeferred=null)}),this.realMediaControl=new xI.MediaControl,this.realAudioBuffer=new yP.AudioBuffer,this.realVideoBuffer=new yP.VideoBuffer,this.realMediaControl.attachAudioBuffer(this.realAudioBuffer),this.realMediaControl.attachVideoBuffer(this.realVideoBuffer),this.mediaControl=new LI.ControlWrapper(this.realMediaControl),this.audioBuffer=new BI.BufferWrapper(this.realAudioBuffer),this.videoBuffer=new BI.BufferWrapper(this.realVideoBuffer),this.shutdownDeferred=new lt.Deferred,this.shutdownDeferred.resolve(),this.pendingFlush=[],this.eventEmitter=new A.EventEmitter,this.stateMachine=new ml.FiniteStateMachine(0),this.setupStateMachine()}return e.capabilities=freeOnUnref(function(){return{supportsAudioVolume:xI.MediaControl.capabilities().supportsAudioVolume}}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),Object.defineProperty(e.prototype,"isReady",{get:freeOnUnref(function(){return 3===this.stateMachine.state}),enumerable:!0,configurable:!0}),e.prototype.initialize=freeOnUnref(function(e){return null==this.pendingInitializeDeferred&&null==this.activeInitializeDeferred&&(this.pendingInitializeDeferred=new lt.Deferred,this.stateMachine.act(0),this.mediaControlConfig=e),null!=this.activeInitializeDeferred?this.activeInitializeDeferred.promise:this.pendingInitializeDeferred.promise}),e.prototype.shutdown=freeOnUnref(function(){return null!=this.activeInitializeDeferred&&(this.activeInitializeDeferred.reject(new lt.CancelError),this.activeInitializeDeferred=null),null!=this.pendingInitializeDeferred&&(this.pendingInitializeDeferred.reject(new lt.CancelError),this.pendingInitializeDeferred=null),null==this.shutdownDeferred&&(this.shutdownDeferred=new lt.Deferred),this.stateMachine.act(3),this.shutdownDeferred.promise}),e.prototype.returnToPool=freeOnUnref(function(){this.mediaControl.isReadyForUse=!1,this.audioBuffer.isReadyForUse=!1,this.videoBuffer.isReadyForUse=!1,this.mediaControl=new LI.ControlWrapper(this.realMediaControl),this.audioBuffer=new BI.BufferWrapper(this.realAudioBuffer),this.videoBuffer=new BI.BufferWrapper(this.realVideoBuffer)}),e.prototype.setupStateMachine=freeOnUnref(function(){var o=this;this.stateMachine.addTransition(0,0,1),this.stateMachine.addTransition(1,1,2),this.stateMachine.addTransition(1,3,7),this.stateMachine.addTransition(1,7,10),this.stateMachine.addTransition(2,2,3),this.stateMachine.addTransition(2,3,8),this.stateMachine.addTransition(2,7,9),this.stateMachine.addTransition(3,3,4),this.stateMachine.addTransition(4,4,5),this.stateMachine.addTransition(4,3,4),this.stateMachine.addTransition(4,0,4),this.stateMachine.addTransition(4,7,5),this.stateMachine.addTransition(5,5,6),this.stateMachine.addTransition(5,3,5),this.stateMachine.addTransition(5,0,5),this.stateMachine.addTransition(5,7,6),this.stateMachine.addTransition(6,6,0),this.stateMachine.addTransition(6,3,6),this.stateMachine.addTransition(6,0,6),this.stateMachine.addTransition(6,7,11),this.stateMachine.addTransition(7,1,6),this.stateMachine.addTransition(7,3,7),this.stateMachine.addTransition(7,0,1),this.stateMachine.addTransition(7,7,6),this.stateMachine.addTransition(8,2,5),this.stateMachine.addTransition(8,3,8),this.stateMachine.addTransition(8,0,2),this.stateMachine.addTransition(8,7,5),this.stateMachine.addTransition(9,5,10),this.stateMachine.addTransition(9,7,10),this.stateMachine.addTransition(10,6,0),this.stateMachine.addTransition(10,7,11),this.stateMachine.addTransition(11,3,11),this.stateMachine.onTransition(1,7,this.onInitializeError),this.stateMachine.onTransition(2,7,this.onInitializeError),this.stateMachine.onTransition(11,3,this.onShutdownDuringError),this.stateMachine.onTransition(7,0,freeOnUnref(function(){null!=o.shutdownDeferred&&o.shutdownDeferred.resolve()})),this.stateMachine.onEnterState(0,freeOnUnref(function(){null!=o.shutdownDeferred&&o.shutdownDeferred.resolve(),null!=o.pendingInitializeDeferred?o.stateMachine.act(0):null==o.shutdownDeferred&&(o.shutdownDeferred=new lt.Deferred,o.shutdownDeferred.resolve()),o.eventEmitter.emit("shutdown")})),this.stateMachine.onEnterState(3,freeOnUnref(function(){o.mediaControl.isReadyForUse=!0,o.audioBuffer.isReadyForUse=!0,o.videoBuffer.isReadyForUse=!0,null!=o.activeInitializeDeferred?o.activeInitializeDeferred.resolve():a.error("MediaObject is ready, but without an active initialize promise!"),o.eventEmitter.emit("ready")})),this.stateMachine.onEnterState(1,freeOnUnref(function(){o.activeInitializeDeferred=o.pendingInitializeDeferred,(o.pendingInitializeDeferred=null)!=o.shutdownDeferred&&o.shutdownDeferred.resolve(),o.shutdownDeferred=null})),this.stateMachine.onTransition(0,0,freeOnUnref(function(){4===o.realMediaControl.state?(a.error("MediaControl is already in an error state, not initializing mediaControl",o.realMediaControl.error),o.stateMachine.actNow(7,o.realMediaControl.error)):0!==o.realMediaControl.state?(a.warn("Not initializing mediaControl -- current state is "+o.realMediaControl.state),o.stateMachine.act(1)):o.realMediaControl.init(freeOnUnref(function(e){null!=e?(a.error("Error when initializing MediaControl: ",e),o.stateMachine.actNow(7,e)):o.stateMachine.actNow(1)}),void 0,o.mediaControlConfig)})),this.stateMachine.onTransition(8,0,freeOnUnref(function(){o.activeInitializeDeferred=o.pendingInitializeDeferred,(o.pendingInitializeDeferred=null)!=o.shutdownDeferred&&o.shutdownDeferred.resolve(),o.shutdownDeferred=null})),this.stateMachine.onTransition(1,1,freeOnUnref(function(){var e,t;if(null!=zt.deviceInformation&&null!=zt.deviceInformation.mediaSource&&null!=zt.deviceInformation.mediaSource.requestedFrontBufferLengthMs){var n=Math.ceil(zt.deviceInformation.mediaSource.requestedFrontBufferLengthMs/1e3);e=47*n,t=30*n}else e=500,t=300;lt.Promise.all([o.initBuffer(o.realAudioBuffer,e).catch(freeOnUnref(function(e){return e})),o.initBuffer(o.realVideoBuffer,t).catch(freeOnUnref(function(e){return e}))]).then(freeOnUnref(function(e){var t=e[0],n=e[1];if(null!=t||null!=n)throw new Error("Failed to initialize MediaBuffers. AudioBuffer error: "+t+" and VideoBuffer error: "+n);o.stateMachine.actNow(2)})).catch(freeOnUnref(function(e){a.error("Error when initializing at least one MediaBuffer: ",e),o.stateMachine.actNow(7,e)}))})),this.stateMachine.onEnterState(4,freeOnUnref(function(){o.mediaControl.isReadyForUse=!1,o.audioBuffer.isReadyForUse=!1,o.videoBuffer.isReadyForUse=!1,FI.promisify(o.realMediaControl,o.realMediaControl.stop).catch(freeOnUnref(function(e){a.warn("Error when stopping MediaControl: ",e),o.stateMachine.actNow(7,e)})).then(freeOnUnref(function(){o.stateMachine.actNow(4)}))})),this.stateMachine.onEnterState(5,freeOnUnref(function(){lt.Promise.all([o.shutdownBuffer(o.realAudioBuffer).catch(freeOnUnref(function(e){return e})),o.shutdownBuffer(o.realVideoBuffer).catch(freeOnUnref(function(e){return e}))]).then(freeOnUnref(function(e){var t=e[0],n=e[1];a.info("Resolving "+o.pendingFlush.length+" pending flush promises: Both buffers have been shutdown");for(var r=0,i=o.pendingFlush;r<i.length;r++){i[r].resolve()}if(o.pendingFlush.length=0,null!=t||null!=n)throw new Error("Failed to shut down MediaBuffers. AudioBuffer error: "+t+" and VideoBuffer error: "+n);o.stateMachine.actNow(5)})).catch(freeOnUnref(function(e){a.warn("Error when uninitializing at least one MediaBuffer: ",e),o.stateMachine.actNow(7,e)}))})),this.stateMachine.onEnterState(6,freeOnUnref(function(){0!==o.realMediaControl.state?FI.promisify(o.realMediaControl,o.realMediaControl.shutdown).catch(freeOnUnref(function(e){a.error("Error when shutting down MediaControl: ",e),o.stateMachine.actNow(7,e)})).then(freeOnUnref(function(){o.stateMachine.actNow(6)})):o.stateMachine.act(6)})),this.stateMachine.onEnterState(9,freeOnUnref(function(){lt.Promise.all([o.shutdownBuffer(o.realAudioBuffer).catch(freeOnUnref(function(e){a.error("Failed to shutdown AudioBuffer after failing to initialize it. Ignoring.",e)})),o.shutdownBuffer(o.realVideoBuffer).catch(freeOnUnref(function(e){a.error("Failed to shutdown VideoBuffer after failing to initialize it. Ignoring.",e)}))]).then(freeOnUnref(function(){a.info("Resolving "+o.pendingFlush.length+" pending flush promises: Both buffers have been shutdown");for(var e=0,t=o.pendingFlush;e<t.length;e++){t[e].resolve()}o.pendingFlush.length=0,o.stateMachine.actNow(5)}))})),this.stateMachine.onEnterState(10,freeOnUnref(function(){FI.promisify(o.realMediaControl,o.realMediaControl.shutdown).catch(freeOnUnref(function(e){a.error("Error when uninitializing MediaControl: ",e),o.stateMachine.actNow(7,e)})).then(freeOnUnref(function(){o.stateMachine.actNow(6)}))}))}),e.prototype.initBuffer=freeOnUnref(function(e,t){return FI.promisify(e,e.init,t)}),e.prototype.shutdownBuffer=freeOnUnref(function(e){return 0===e.state?lt.Promise.resolve():FI.promisify(e,e.shutdown)}),e})();t.MediaObjectImpl=n}));e(NI);NI.MediaObjectImpl;var VI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.wrappedValue=e,this.isValid=!0}return e.prototype.on=freeOnUnref(function(e,t){this.wrappedValue.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.wrappedValue.off(e,t)}),Object.defineProperty(e.prototype,"audioBuffer",{get:freeOnUnref(function(){if(this.isValid)return this.wrappedValue.audioBuffer;throw new Error("Attempted to read audioBuffer from a MediaObject that was already returned to the pool!")}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoBuffer",{get:freeOnUnref(function(){if(this.isValid)return this.wrappedValue.videoBuffer;throw new Error("Attempted to read videoBuffer from a MediaObject that was already returned to the pool!")}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mediaControl",{get:freeOnUnref(function(){if(this.isValid)return this.wrappedValue.mediaControl;throw new Error("Attempted to read mediaControl from a MediaObject that was already returned to the pool!")}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:freeOnUnref(function(){if(this.isValid)return this.wrappedValue.isReady;throw new Error("Attempted to read isReady from a MediaObject that was already returned to the pool!")}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pendingFlush",{get:freeOnUnref(function(){if(this.isValid)return this.wrappedValue.pendingFlush;throw new Error("Attempted to read pendingFlush from a MediaObject that was already returned to the pool!")}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attachedDrmSystem",{get:freeOnUnref(function(){if(this.isValid)return this.wrappedValue.attachedDrmSystem;throw new Error("Attempted to read attachedDrmSystem from a MediaObject that was already returned to the pool!")}),set:freeOnUnref(function(e){if(!this.isValid)throw new Error("Attempted to set attachedDrmSystem on a MediaObject that was already returned to the pool!");this.wrappedValue.attachedDrmSystem=e}),enumerable:!0,configurable:!0}),e.prototype.initialize=freeOnUnref(function(e){return this.isValid?this.wrappedValue.initialize(e):lt.Promise.reject("Attempted to initialize a MediaObject that was already returned to the pool!")}),e.prototype.shutdown=freeOnUnref(function(){return this.isValid?this.wrappedValue.shutdown():lt.Promise.reject("Attempted to shutdown a MediaObject that was already returned to the pool!")}),e})();t.MediaObjectWrapper=n}));e(VI);VI.MediaObjectWrapper;var jI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("MediaObjectPool");var n=freeOnUnref(function(){function e(){this.mediaObjects=[],this.availableMediaObjects=[],this.activeWrappers=[]}return e.prototype.acquire=freeOnUnref(function(){if(0===this.availableMediaObjects.length){if(1===this.mediaObjects.length)throw new Error("All renderers are currently in use");var e=new NI.MediaObjectImpl;this.availableMediaObjects.push(e),this.mediaObjects.push(e)}var t=this.availableMediaObjects.shift(),n=new VI.MediaObjectWrapper(t);return this.activeWrappers.push(n),n}),e.prototype.release=freeOnUnref(function(e){var t=e;if(!t.isValid)throw new Error("Attempting to return a MediaObjectWrapper that was already returned!");t.isValid=!1;for(var n=0,r=this.availableMediaObjects;n<r.length;n++){if(r[n]===t.wrappedValue)throw new Error("Attempted to return a MediaObject that is already available in the pool!")}for(var i=0;i<this.activeWrappers.length;i++)if(this.activeWrappers[i]===e){this.activeWrappers.splice(i,1);break}this.availableMediaObjects.push(t.wrappedValue)}),e.prototype.shutdown=freeOnUnref(function(){for(var e=0,t=this.activeWrappers;e<t.length;e++){t[e].isValid=!1}return this.activeWrappers.length=0,lt.Promise.all(this.mediaObjects.map(freeOnUnref(function(e){return e.shutdown()}))).then(freeOnUnref(function(){}))}),e})();t.MediaObjectPool=n}));e(jI);jI.MediaObjectPool;var qI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.bufferedRegions=[]}return e.prototype.addRegion=freeOnUnref(function(e,t,n){for(var r=this.bufferedRegions.length-1,i=0;i<this.bufferedRegions.length;i++){if(this.bufferedRegions[i].startMs>e){r=i-1;break}}var o=0<=r&&r<this.bufferedRegions.length?this.bufferedRegions[r]:null,a=r+1<this.bufferedRegions.length?this.bufferedRegions[r+1]:null,s=null!=o&&o.sessionId===n&&In.isApprxEqual(o.endMs,e,.1),l=null!=a&&a.sessionId===n&&In.isApprxEqual(a.startMs,t,.1);s&&l?(o.endMs=a.endMs,this.bufferedRegions.splice(r+1,1)):s?o.endMs=t:l?a.startMs=e:this.bufferedRegions.splice(r+1,0,{startMs:e,endMs:t,sessionId:n})}),Object.defineProperty(e.prototype,"regions",{get:freeOnUnref(function(){return this.bufferedRegions}),enumerable:!0,configurable:!0}),e.prototype.removeTo=freeOnUnref(function(e){for(;0<this.bufferedRegions.length;){if(!(this.bufferedRegions[0].endMs<e-.1)){this.bufferedRegions[0].startMs<e&&(this.bufferedRegions[0].startMs=e);break}this.bufferedRegions.splice(0,1)}}),e.prototype.clear=freeOnUnref(function(){this.bufferedRegions=[]}),e.prototype.hasSessionId=freeOnUnref(function(e){for(var t=0,n=this.bufferedRegions;t<n.length;t++){if(n[t].sessionId===e)return!0}return!1}),e})();t.BufferedRegionList=n}));e(qI);qI.BufferedRegionList;var HI=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing_Paused=1]="Initializing_Paused",e[e.Initializing=2]="Initializing",e[e.WaitingMediaKeys_Paused=3]="WaitingMediaKeys_Paused",e[e.WaitingMediaKeys=4]="WaitingMediaKeys",e[e.WaitingLicense=5]="WaitingLicense",e[e.WaitingSample=6]="WaitingSample",e[e.BufferNotReady=7]="BufferNotReady",e[e.Full=8]="Full",e[e.Paused=9]="Paused",e[e.Resetting=10]="Resetting",e[e.Ended=11]="Ended",e[e.Error=12]="Error",e[e.PendingDestroy=13]="PendingDestroy"})(n||(n={})),t.SampleConsumerState=n}));e(HI);HI.SampleConsumerState;var zI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function t(e,t,n,r,i){var l=this;if(this.shouldAppendInChunks=!1,this.shouldRetryOnBufferFull=!1,this.maxEnqueuedSamples=void 0,this.defaultMaxEnqueuedSamples=void 0,this.bufferNotReadyTimerInterval=null,this.bufferFullTimerInterval=null,this.trackBuffer=null,this.lastInitInfo=null,this.lastConsumedSample=null,this.lastKeyId=null,this.lastSessionId=null,this.lastPositionMs=null,this.pendingDestroy=null,this.onSeeking=freeOnUnref(function(){!0===l.shouldAppendInChunks&&(l.maxEnqueuedSamples=l.defaultMaxEnqueuedSamples)}),this.storeTrackBuffer=freeOnUnref(function(e){null!=l.trackBuffer&&l.trackBuffer.off("samplesRemoved",l.onSamplesRemoved);var t=e;l.trackBuffer=t,l.trackBuffer.on("samplesRemoved",l.onSamplesRemoved)}),this.initializeMediaBuffer=freeOnUnref(function(){l.handleMediaBufferInitialization()}),this.hardResetMediaBuffer=freeOnUnref(function(){l.lastConsumedSample=null,l.lastInitInfo=null,l.lastKeyId=null,l.lastSessionId=null,l.bufferedRegions.clear(),l.bufferNotReadyTimerStop(),l.handleMediaBufferInitialization(),l.reportDiagnostics(l.stateMachine.state)}),this.emptyBuffer=freeOnUnref(function(){l.lastConsumedSample=null,l.lastInitInfo=null,l.lastKeyId=null,l.lastSessionId=null,l.bufferedRegions.clear(),l.reportDiagnostics(l.stateMachine.state),l.stateMachine.act(13),l.eventEmitter.emit("flushed")}),this.feedSamples=freeOnUnref(function(){if((!0!==l.shouldAppendInChunks||l.stateMachine.state!==HI.SampleConsumerState.Paused&&l.stateMachine.state!==HI.SampleConsumerState.Ended)&&null!=l.trackBuffer){var e=void 0;null==l.lastConsumedSample&&null!=l.lastPositionMs?null==(e=l.trackBuffer.getSampleAt(l.lastPositionMs))&&l.enableSampleLookAhead&&null!=(e=l.trackBuffer.getSampleAt(l.lastPositionMs+1))&&l.log.info("Sample at position "+l.lastPositionMs+" not found, but found a sample at "+(l.lastPositionMs+1)):null!=l.lastConsumedSample&&(e=l.trackBuffer.getNextSample(l.lastConsumedSample));for(var t=0;null!=e;){if(null!=l.maxEnqueuedSamples&&!0===l.shouldAppendInChunks&&t>=l.maxEnqueuedSamples){new Date;return void oe.timer.setImmediate(freeOnUnref(function(){return l.feedSamples()}))}var n=1e3*e.sample.pts/e.sample.timescale;if(null!=l.lastPositionMs&&null!=l.mediaBufferSizeMs&&n>l.lastPositionMs+l.mediaBufferSizeMs&&3!==l.mediaBuffer.state)break;var r=!(e.initInfo===l.lastInitInfo)&&null!=e.initInfo.codecSpecificData,i=r?l.createInitSample(e):e.sample;if(i.isEncrypted&&null!=i.encryptionInfo){if(i.encryptionInfo.keyId!==l.lastKeyId&&(l.lastKeyId=i.encryptionInfo.keyId,l.lastSessionId=l.keyStore.getSessionForKeyId(i.encryptionInfo.keyId)),null===l.lastSessionId)return l.lastKeyId=null,void l.stateMachine.act(6);i.encryptionInfo.sessionId=l.lastSessionId}try{var o=i,a=l.mediaBuffer.enqueueSample(o);if("BufferFull"===a){if(l.stateMachine.act(7),null!=l.maxEnqueuedSamples)new Date;return}if("NotReady"===a)return void l.stateMachine.act(4);if(e.isReplacedSample&&l.diagnostics.report("seamlessSwitchLatency",{replacedSampleFeedTimeMs:Date.now(),currentPlaybackPositionMs:null!=l.lastPositionMs?l.lastPositionMs:void 0,replacedSamplePositionMs:n}),r)l.lastInitInfo=e.initInfo;else{var s=1e3*(e.sample.pts+e.sample.duration)/e.sample.timescale;l.bufferedRegions.addRegion(n,s,l.lastSessionId),l.lastConsumedSample=e,e=l.trackBuffer.getNextSample(l.lastConsumedSample)}t+=1}catch(e){return void l.stateMachine.act(14,e)}}null!=l.lastConsumedSample&&l.trackBuffer.streamEnded?l.stateMachine.act(12):l.stateMachine.act(5)}}),this.onError=freeOnUnref(function(e){null!=l.pendingDestroy&&l.pendingDestroy.reject(e),l.bufferNotReadyTimerStop(),l.eventEmitter.emit("error",e)}),this.onEnterWaitingSample=freeOnUnref(function(){null!=l.trackBuffer&&(l.positionChanged.add(l.feedSamples),l.trackBuffer.on("sampleAdded",l.feedSamples),l.feedSamples())}),this.onLeaveWaitingSample=freeOnUnref(function(){null!=l.trackBuffer&&(l.positionChanged.remove(l.feedSamples),l.trackBuffer.off("sampleAdded",l.feedSamples))}),this.onStillNeedSample=freeOnUnref(function(){l.reportDiagnostics(l.stateMachine.state)}),this.onEnterBufferNotReady=freeOnUnref(function(){l.bufferNotReadyTimerStart()}),this.onLeaveBufferNotReady=freeOnUnref(function(){l.bufferNotReadyTimerStop()}),this.onEnterBufferFull=freeOnUnref(function(){l.maxEnqueuedSamples=void 0,l.positionChanged.add(l.feedSamples),l.shouldRetryOnBufferFull&&l.bufferFullTimerStart()}),this.onLeaveBufferFull=freeOnUnref(function(){l.positionChanged.remove(l.feedSamples),l.shouldRetryOnBufferFull&&l.bufferFullTimerStop()}),this.onStreamEnd=freeOnUnref(function(){l.mediaBuffer.endOfStream()}),this.onDestroyed=freeOnUnref(function(){!0===l.shouldAppendInChunks&&l.mediaPlayerEventEmitter.off("seeking",l.onSeeking),null!=l.pendingDestroy&&(l.pendingDestroy.resolve(),l.pendingDestroy=null),l.shouldRetryOnBufferFull&&l.bufferFullTimerStop()}),this.onEnterWaitingLicense=freeOnUnref(function(){l.eventEmitter.emit("needkey"),l.keyStore.onKeyLoaded(l.feedSamples),l.feedSamples()}),this.onLeaveWaitingLicense=freeOnUnref(function(){l.keyStore.offKeyLoaded(l.feedSamples)}),this.checkMediaKeysSet=freeOnUnref(function(){l.keyStore.hasMediaKeys&&l.stateMachine.act(3)}),this.onEnterWaitMediaKeys=freeOnUnref(function(){l.eventEmitter.emit("needkey"),l.keyStore.onKeyLoaded(l.checkMediaKeysSet)}),this.onLeaveWaitMediaKeys=freeOnUnref(function(){l.keyStore.offKeyLoaded(l.checkMediaKeysSet)}),this.onSamplesRemoved=freeOnUnref(function(e){null!=l.trackBuffer&&null!=l.lastPositionMs&&(null==l.lastConsumedSample||e.startTicks>l.lastConsumedSample.sample.pts+l.lastConsumedSample.sample.duration||1e3*e.endTicks/l.trackBuffer.timescale<l.lastPositionMs||(l.pause(),l.eventEmitter.emit("flush")))}),this.log=new Ka.EphemeralJSLogger("SampleConsumer"),this.mediaBuffer=t,this.keyStore=n,this.mediaPlayerEventEmitter=r,this.eventEmitter=new A.EventEmitter,this.positionChanged=new A.MulticastCallback,this.bufferedRegions=new qI.BufferedRegionList,this.timeToReadyInMs=0,this.mediaBufferSizeMs=i,null!=this.mediaBufferSizeMs&&this.log.info("Media buffer size limited to: "+this.mediaBufferSizeMs+"Ms"),this.diagnostics=nn.Diagnostics.create("SampleConsumer."+Lb.TrackType[e]),this.stateMachine=new ml.FiniteStateMachine(HI.SampleConsumerState.Uninitialized),this.setupStateMachine(e),null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.elementaryStream){this.enableSampleLookAhead="disabled"!==L.configurationStore.configuration.elementaryStream.sampleLookAhead,this.shouldRetryOnBufferFull=!0===L.configurationStore.configuration.elementaryStream.retryOnBufferFull;var o=L.configurationStore.configuration.elementaryStream.maxEnqueuedSamples;this.defaultMaxEnqueuedSamples=Math.max(null!=o?o:100,25),this.maxEnqueuedSamples=this.defaultMaxEnqueuedSamples,this.shouldAppendInChunks=!0}else this.enableSampleLookAhead=!0;!0===this.shouldAppendInChunks&&this.mediaPlayerEventEmitter.on("seeking",this.onSeeking),this.log.info("Sample look-ahead by 1ms is "+(this.enableSampleLookAhead?"":"not ")+"enabled")}return t.prototype.setupStateMachine=freeOnUnref(function(t){var n=this;this.stateMachine.onStateChange(freeOnUnref(function(e){n.log.setId(Lb.TrackType[t],HI.SampleConsumerState[e]),n.reportDiagnostics(e)})),this.stateMachine.onIllegalTransition(freeOnUnref(function(e,t){n.log.warn("Illegal State transition attempted from state : "+e+" with action : "+t)})),this.stateMachine.addTransition(HI.SampleConsumerState.Uninitialized,0,HI.SampleConsumerState.Initializing_Paused),this.stateMachine.addTransition(HI.SampleConsumerState.Uninitialized,14,HI.SampleConsumerState.Error),this.stateMachine.addTransition(HI.SampleConsumerState.Uninitialized,10,HI.SampleConsumerState.Uninitialized),this.stateMachine.addTransition(HI.SampleConsumerState.Uninitialized,15,HI.SampleConsumerState.Uninitialized),this.stateMachine.onTransition(HI.SampleConsumerState.Uninitialized,0,this.storeTrackBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.Uninitialized,0,this.initializeMediaBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.Uninitialized,14,this.onError),this.stateMachine.onTransition(HI.SampleConsumerState.Uninitialized,15,this.onDestroyed),this.stateMachine.onEnterState(HI.SampleConsumerState.Uninitialized,this.onDestroyed),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing_Paused,0,HI.SampleConsumerState.Initializing_Paused),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing_Paused,10,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing_Paused,2,HI.SampleConsumerState.WaitingMediaKeys_Paused),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing_Paused,1,HI.SampleConsumerState.Paused),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing_Paused,14,HI.SampleConsumerState.Error),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing_Paused,15,HI.SampleConsumerState.PendingDestroy),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing_Paused,9,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing,0,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing,10,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing,2,HI.SampleConsumerState.WaitingMediaKeys),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing,1,HI.SampleConsumerState.WaitingSample),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing,14,HI.SampleConsumerState.Error),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing,15,HI.SampleConsumerState.PendingDestroy),this.stateMachine.addTransition(HI.SampleConsumerState.Initializing,8,HI.SampleConsumerState.Initializing_Paused),this.stateMachine.onTransition(HI.SampleConsumerState.Initializing_Paused,0,this.storeTrackBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.Initializing_Paused,14,this.onError),this.stateMachine.onTransition(HI.SampleConsumerState.Initializing,0,this.storeTrackBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.Initializing,14,this.onError),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys_Paused,0,HI.SampleConsumerState.WaitingMediaKeys_Paused),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys_Paused,10,HI.SampleConsumerState.WaitingMediaKeys_Paused),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys_Paused,3,HI.SampleConsumerState.Initializing_Paused),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys_Paused,14,HI.SampleConsumerState.Error),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys_Paused,15,HI.SampleConsumerState.PendingDestroy),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys_Paused,9,HI.SampleConsumerState.WaitingMediaKeys),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys,0,HI.SampleConsumerState.WaitingMediaKeys),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys,10,HI.SampleConsumerState.WaitingMediaKeys_Paused),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys,3,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys,14,HI.SampleConsumerState.Error),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys,15,HI.SampleConsumerState.PendingDestroy),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingMediaKeys,8,HI.SampleConsumerState.WaitingMediaKeys_Paused),this.stateMachine.onEnterState(HI.SampleConsumerState.WaitingMediaKeys,this.onEnterWaitMediaKeys),this.stateMachine.onLeaveState(HI.SampleConsumerState.WaitingMediaKeys,this.onLeaveWaitMediaKeys),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingMediaKeys,3,this.initializeMediaBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingMediaKeys,0,this.storeTrackBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingMediaKeys,14,this.onError),this.stateMachine.onEnterState(HI.SampleConsumerState.WaitingMediaKeys_Paused,this.onEnterWaitMediaKeys),this.stateMachine.onLeaveState(HI.SampleConsumerState.WaitingMediaKeys_Paused,this.onLeaveWaitMediaKeys),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingMediaKeys_Paused,3,this.initializeMediaBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingMediaKeys_Paused,0,this.storeTrackBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingMediaKeys_Paused,14,this.onError),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingSample,4,HI.SampleConsumerState.BufferNotReady),this.stateMachine.addTransition(HI.SampleConsumerState.BufferNotReady,4,HI.SampleConsumerState.BufferNotReady),this.stateMachine.addTransition(HI.SampleConsumerState.BufferNotReady,5,HI.SampleConsumerState.WaitingSample),this.stateMachine.addTransition(HI.SampleConsumerState.BufferNotReady,12,HI.SampleConsumerState.Ended),this.stateMachine.addTransition(HI.SampleConsumerState.BufferNotReady,6,HI.SampleConsumerState.WaitingLicense),this.stateMachine.addTransition(HI.SampleConsumerState.BufferNotReady,10,HI.SampleConsumerState.Resetting),this.stateMachine.addTransition(HI.SampleConsumerState.BufferNotReady,11,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.BufferNotReady,0,HI.SampleConsumerState.Resetting),this.stateMachine.addTransition(HI.SampleConsumerState.BufferNotReady,14,HI.SampleConsumerState.Error),this.stateMachine.addTransition(HI.SampleConsumerState.BufferNotReady,15,HI.SampleConsumerState.Uninitialized),this.stateMachine.addTransition(HI.SampleConsumerState.BufferNotReady,8,HI.SampleConsumerState.Paused),this.stateMachine.addTransition(HI.SampleConsumerState.BufferNotReady,7,HI.SampleConsumerState.Full),this.stateMachine.onTransition(HI.SampleConsumerState.BufferNotReady,0,this.storeTrackBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.BufferNotReady,11,this.hardResetMediaBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.BufferNotReady,14,this.onError),this.stateMachine.onEnterState(HI.SampleConsumerState.BufferNotReady,this.onEnterBufferNotReady),this.stateMachine.onLeaveState(HI.SampleConsumerState.BufferNotReady,this.onLeaveBufferNotReady),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingSample,12,HI.SampleConsumerState.Ended),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingSample,5,HI.SampleConsumerState.WaitingSample),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingSample,6,HI.SampleConsumerState.WaitingLicense),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingSample,7,HI.SampleConsumerState.Full),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingSample,10,HI.SampleConsumerState.Resetting),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingSample,11,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingSample,0,HI.SampleConsumerState.Resetting),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingSample,14,HI.SampleConsumerState.Error),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingSample,15,HI.SampleConsumerState.Uninitialized),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingSample,8,HI.SampleConsumerState.Paused),this.stateMachine.onEnterState(HI.SampleConsumerState.WaitingSample,this.onEnterWaitingSample),this.stateMachine.onLeaveState(HI.SampleConsumerState.WaitingSample,this.onLeaveWaitingSample),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingSample,0,this.storeTrackBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingSample,11,this.hardResetMediaBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingSample,14,this.onError),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingSample,5,this.onStillNeedSample),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingLicense,12,HI.SampleConsumerState.Ended),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingLicense,5,HI.SampleConsumerState.WaitingSample),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingLicense,6,HI.SampleConsumerState.WaitingLicense),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingLicense,7,HI.SampleConsumerState.Full),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingLicense,4,HI.SampleConsumerState.BufferNotReady),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingLicense,10,HI.SampleConsumerState.Resetting),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingLicense,11,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingLicense,0,HI.SampleConsumerState.Resetting),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingLicense,14,HI.SampleConsumerState.Error),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingLicense,15,HI.SampleConsumerState.Uninitialized),this.stateMachine.addTransition(HI.SampleConsumerState.WaitingLicense,8,HI.SampleConsumerState.Paused),this.stateMachine.onEnterState(HI.SampleConsumerState.WaitingLicense,this.onEnterWaitingLicense),this.stateMachine.onLeaveState(HI.SampleConsumerState.WaitingLicense,this.onLeaveWaitingLicense),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingLicense,0,this.storeTrackBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingLicense,11,this.hardResetMediaBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.WaitingLicense,14,this.onError),this.stateMachine.addTransition(HI.SampleConsumerState.Full,12,HI.SampleConsumerState.Ended),this.stateMachine.addTransition(HI.SampleConsumerState.Full,5,HI.SampleConsumerState.WaitingSample),this.stateMachine.addTransition(HI.SampleConsumerState.Full,6,HI.SampleConsumerState.WaitingLicense),this.stateMachine.addTransition(HI.SampleConsumerState.Full,7,HI.SampleConsumerState.Full),this.stateMachine.addTransition(HI.SampleConsumerState.Full,10,HI.SampleConsumerState.Resetting),this.stateMachine.addTransition(HI.SampleConsumerState.Full,11,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.Full,0,HI.SampleConsumerState.Resetting),this.stateMachine.addTransition(HI.SampleConsumerState.Full,14,HI.SampleConsumerState.Error),this.stateMachine.addTransition(HI.SampleConsumerState.Full,15,HI.SampleConsumerState.Uninitialized),this.stateMachine.addTransition(HI.SampleConsumerState.Full,8,HI.SampleConsumerState.Paused),this.stateMachine.onEnterState(HI.SampleConsumerState.Full,this.onEnterBufferFull),this.stateMachine.onLeaveState(HI.SampleConsumerState.Full,this.onLeaveBufferFull),this.stateMachine.onTransition(HI.SampleConsumerState.Full,0,this.storeTrackBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.Full,11,this.hardResetMediaBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.Full,14,this.onError),this.stateMachine.addTransition(HI.SampleConsumerState.Paused,9,HI.SampleConsumerState.WaitingSample),this.stateMachine.addTransition(HI.SampleConsumerState.Paused,10,HI.SampleConsumerState.Resetting),this.stateMachine.addTransition(HI.SampleConsumerState.Paused,11,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.Paused,0,HI.SampleConsumerState.Resetting),this.stateMachine.addTransition(HI.SampleConsumerState.Paused,15,HI.SampleConsumerState.Uninitialized),this.stateMachine.addTransition(HI.SampleConsumerState.Paused,14,HI.SampleConsumerState.Error),this.stateMachine.onTransition(HI.SampleConsumerState.Paused,14,this.onError),this.stateMachine.onTransition(HI.SampleConsumerState.Paused,0,this.storeTrackBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.Paused,11,this.hardResetMediaBuffer),this.stateMachine.addTransition(HI.SampleConsumerState.Ended,11,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.Ended,14,HI.SampleConsumerState.Error),this.stateMachine.addTransition(HI.SampleConsumerState.Ended,15,HI.SampleConsumerState.Uninitialized),this.stateMachine.addTransition(HI.SampleConsumerState.Ended,10,HI.SampleConsumerState.Ended),this.stateMachine.onEnterState(HI.SampleConsumerState.Ended,this.onStreamEnd),this.stateMachine.onTransition(HI.SampleConsumerState.Ended,11,this.hardResetMediaBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.Ended,14,this.onError),this.stateMachine.onTransition(HI.SampleConsumerState.Ended,10,this.emptyBuffer),this.stateMachine.addTransition(HI.SampleConsumerState.Resetting,13,HI.SampleConsumerState.WaitingSample),this.stateMachine.addTransition(HI.SampleConsumerState.Resetting,11,HI.SampleConsumerState.Initializing),this.stateMachine.addTransition(HI.SampleConsumerState.Resetting,0,HI.SampleConsumerState.Resetting),this.stateMachine.addTransition(HI.SampleConsumerState.Resetting,14,HI.SampleConsumerState.Error),this.stateMachine.addTransition(HI.SampleConsumerState.Resetting,15,HI.SampleConsumerState.PendingDestroy),this.stateMachine.onEnterState(HI.SampleConsumerState.Resetting,this.emptyBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.Resetting,11,this.hardResetMediaBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.Resetting,0,this.storeTrackBuffer),this.stateMachine.onTransition(HI.SampleConsumerState.Resetting,14,this.onError),this.stateMachine.addTransition(HI.SampleConsumerState.PendingDestroy,13,HI.SampleConsumerState.Uninitialized),this.stateMachine.addTransition(HI.SampleConsumerState.PendingDestroy,1,HI.SampleConsumerState.Uninitialized),this.stateMachine.addTransition(HI.SampleConsumerState.PendingDestroy,15,HI.SampleConsumerState.PendingDestroy),this.stateMachine.addTransition(HI.SampleConsumerState.Error,15,HI.SampleConsumerState.Uninitialized)}),t.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),t.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),t.prototype.setTrackBuffer=freeOnUnref(function(e){this.trackBuffer!==e&&(this.hasData()&&this.eventEmitter.emit("flush"),this.stateMachine.act(0,e))}),t.prototype.reset=freeOnUnref(function(){return this.log.info(">> reset"),this.lastPositionMs=null,this.bufferNotReadyTimerStop(),this.reportDiagnostics(this.stateMachine.state),this.hasData()||this.stateMachine.state===HI.SampleConsumerState.Resetting?(this.stateMachine.act(10),!0):(this.stateMachine.act(9),!1)}),t.prototype.hardReset=freeOnUnref(function(){this.log.info(">> hardReset"),1===this.mediaBuffer.state?(this.lastPositionMs=null,this.bufferNotReadyTimerStop(),this.stateMachine.act(11)):this.stateMachine.act(14,new Error("The MediaBuffer is not Initialized"))}),t.prototype.updatePosition=freeOnUnref(function(e){this.lastPositionMs=e,this.positionChanged.invoke(),this.bufferedRegions.removeTo(e)}),t.prototype.hasData=freeOnUnref(function(){return null!=this.lastConsumedSample||null!=this.lastInitInfo}),Object.defineProperty(t.prototype,"isWaitingKey",{get:freeOnUnref(function(){return this.stateMachine.state===HI.SampleConsumerState.WaitingMediaKeys||this.stateMachine.state===HI.SampleConsumerState.WaitingLicense}),enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:freeOnUnref(function(){return this.stateMachine.state===HI.SampleConsumerState.Ended}),enumerable:!0,configurable:!0}),t.prototype.pause=freeOnUnref(function(){this.stateMachine.act(8)}),t.prototype.resume=freeOnUnref(function(){this.stateMachine.act(9)}),t.prototype.tryResume=freeOnUnref(function(){!0===this.shouldAppendInChunks&&this.stateMachine.state===HI.SampleConsumerState.Paused&&(this.resume(),this.feedSamples())}),t.prototype.tryPause=freeOnUnref(function(){!0===this.shouldAppendInChunks&&this.pause()}),t.prototype.destroy=freeOnUnref(function(){return this.log.info(">> destroy"),null==this.pendingDestroy&&(this.pendingDestroy=new lt.Deferred,this.stateMachine.act(15)),this.pendingDestroy.promise}),t.prototype.isSessionIdInUse=freeOnUnref(function(e){return this.bufferedRegions.hasSessionId(e)}),t.prototype.handleMediaBufferInitialization=freeOnUnref(function(){var t=this;if(null!=this.trackBuffer)if(null==this.trackBuffer.trackInitInfo.protectionSchemeType||this.keyStore.hasMediaKeys)try{this.mediaBuffer.initializeCodec(this.trackBuffer.trackInitInfo,freeOnUnref(function(e){null!=e?t.stateMachine.act(14,e):(t.eventEmitter.emit("mediaBufferCodecInitialized"),t.stateMachine.act(1))}))}catch(e){this.stateMachine.act(14,e)}else this.stateMachine.act(2)}),t.prototype.createInitSample=freeOnUnref(function(e){return x.extend({},e.sample,{data:e.initInfo.codecSpecificData,isCodecPrivateData:!0,isEncrypted:!1,encryptionInfo:null})}),t.prototype.reportDiagnostics=freeOnUnref(function(e){var t=null;if(null!=this.lastConsumedSample){var n=this.lastConsumedSample.sample;t={isEncrypted:n.isEncrypted,ptsTicks:n.pts,durationTicks:n.duration,timescale:n.timescale,ptsStartMs:1e3*n.pts/n.timescale,ptsEndMs:1e3*(n.pts+n.duration)/n.timescale}}var r={state:e,lastConsumedSample:t,lastPositionMs:this.lastPositionMs,trackBuffer:null==this.trackBuffer?null:{buffered:this.trackBuffer.buffered.numberLine.getIntervals(),isEnded:this.trackBuffer.streamEnded},bufferedRegions:this.bufferedRegions.regions,timestamp:Date.now()};this.diagnostics.report("state",r)}),t.prototype.bufferNotReadyTimerStart=freeOnUnref(function(){var e=this;null===this.bufferNotReadyTimerInterval&&(this.timeToReadyInMs=Date.now(),this.bufferNotReadyTimerInterval=oe.timer.setInterval(freeOnUnref(function(){return e.feedSamples()}),t.BUFFER_NOT_READY_INTERVAL_MS))}),t.prototype.bufferNotReadyTimerStop=freeOnUnref(function(){if(null!==this.bufferNotReadyTimerInterval){var e=Date.now()-this.timeToReadyInMs;this.log.info("Media buffer took time to ready: "+e+"ms"),oe.timer.clearInterval(this.bufferNotReadyTimerInterval),this.bufferNotReadyTimerInterval=null,this.timeToReadyInMs=0}}),t.prototype.bufferFullTimerStart=freeOnUnref(function(){var e=this;null===this.bufferFullTimerInterval&&(this.bufferFullTimerInterval=oe.timer.setInterval(freeOnUnref(function(){return e.feedSamples()}),t.BUFFER_FULL_INTERVAL_MS))}),t.prototype.bufferFullTimerStop=freeOnUnref(function(){null!==this.bufferFullTimerInterval&&(oe.timer.clearInterval(this.bufferFullTimerInterval),this.bufferFullTimerInterval=null)}),t.BUFFER_NOT_READY_INTERVAL_MS=15,t.BUFFER_FULL_INTERVAL_MS=1e3,t})();t.SampleConsumer=n}));e(zI);zI.SampleConsumer;var WI=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("AttachActivity"),a=((n={}).None="None",n.Filmmaker="Filmmaker",n.CalibratedCinematic="CalibratedCinematic",n.CalibratedBroadcast="CalibratedBroadcast",n),r=freeOnUnref(function(){function e(e,n,r){var t=this;this.flushConsumer=freeOnUnref(function(){t.mediaPlayer.seek(1e3*t.mediaPlayer.currentTime,!0)}),this.context=r,this.mediaPlayer=e,this.stateMachine=n,this.bridge={get currentTime(){return e.currentTime},get error(){return e.error},onError:freeOnUnref(function(e,t){n.raiseMediaError(t)}),onEncryptionInitDataFound:freeOnUnref(function(e,t){r.eventEmitter.emit("encrypted",{initDataType:e,initData:t})})}}return e.prototype.attach=freeOnUnref(function(e){var t=this,n=e;null!==this.context.cancelAttach&&(this.context.cancelAttach(),(this.context.cancelAttach=null)===this.context.source&&s.warn("Cancelling attach process before source was set")),null!==this.context.source&&this.detach();var r=lt.CancelToken.source(),i=r.token,o=r.cancel;this.context.cancelAttach=o;var a=null!==this.context.detachPromise?this.context.detachPromise:lt.Promise.resolve();return this.context.attachPromise=a.then(freeOnUnref(function(){return i.throwIfRequested(),t.resourceSelection(n,i)})),this.context.attachPromise}),e.prototype.detach=freeOnUnref(function(){var t=this;if(null===this.context.detachPromise){var e=null==this.context.attachPromise?lt.Promise.resolve():this.context.attachPromise.catch(freeOnUnref(function(e){s.warn("Attach promise rejected",e)}));this.context.detachPromise=e.then(freeOnUnref(function(){return t.stateMachine.detach()})).then(freeOnUnref(function(){if(null!==t.context.audioConsumer||null!==t.context.videoConsumer)return lt.Promise.all([t.context.audioConsumer,t.context.videoConsumer].map(freeOnUnref(function(e){return null===e?lt.Promise.resolve():e.destroy().then(freeOnUnref(function(){e.off("error",t.context.fatalErrorCallback),e.off("needkey",t.context.needKeyCallback),e.off("flush",t.flushConsumer)}))}))).then(freeOnUnref(function(){t.context.audioConsumer=null,t.context.videoConsumer=null}))})).then(freeOnUnref(function(){return t.context.audioTrackBuffer=null,(t.context.videoTrackBuffer=null)!==t.context.source&&"closed"!==t.context.source.readyState&&t.context.source.close(),null!==t.context.mediaObject?t.context.mediaObject.shutdown():lt.Promise.resolve()})).then(freeOnUnref(function(){null!==t.context.mediaObject&&(t.context.mediaObjectPool.release(t.context.mediaObject),t.context.mediaObject=null),t.context.source=null,t.context.detachPromise=null,t.context.eventEmitter.emit("emptied")})).catch(freeOnUnref(function(e){throw s.error("Failed to detach MediaSource",e),e}))}}),e.prototype.getTrackBuffer=freeOnUnref(function(e,i){return new lt.Promise(freeOnUnref(function(n,t){var r=freeOnUnref(function(e){var t=e.track.sourceBuffer.getTrackBuffer(e.track.id);i.removeEventListener("addtrack",r),n(t)});i.addEventListener("addtrack",r),e.promise.then(freeOnUnref(function(e){i.removeEventListener("addtrack",r),t(e)}))}))}),e.prototype.setDrmSystem=freeOnUnref(function(e,r){return new lt.Promise(freeOnUnref(function(t,n){null!==r&&r!==e.attachedDrmSystem?(e.attachedDrmSystem=r,e.mediaControl.setDrmSystem(r,freeOnUnref(function(e){null!=e?n(e):t()}))):t()}))}),e.prototype.resourceSelection=freeOnUnref(function(n,r){var i=this;if(null===(this.context.source=n))return lt.Promise.resolve();try{this.context.mediaObject=this.context.mediaObjectPool.acquire()}catch(e){return lt.Promise.reject(e)}var e=[];null!=this.context.suggestedPictureModes&&(e=this.context.suggestedPictureModes.filter(freeOnUnref(function(e){return null!=e})).map(freeOnUnref(function(e){return a[e]})));var o=this.context.mediaPlayerConfig,t={suggestedPictureModes:e};return null!=o&&(t.allowFrameRateMatching=o.allowFrameRateMatching),null!=this.context.surfaceRef&&(t.surfaceRefId=this.context.surfaceRef),this.context.mediaObject.initialize(t).then(freeOnUnref(function(){return r.throwIfRequested(),i.setDrmSystem(i.context.mediaObject,i.context.drmSystem)})).then(freeOnUnref(function(){r.throwIfRequested();var e=new zI.SampleConsumer(Lb.TrackType.AUDIO,i.context.mediaObject.audioBuffer,i.context.keyStore,i.context.eventEmitter,null!=o&&null!=o.mediaBufferSizeMs?o.mediaBufferSizeMs.audio:void 0);e.on("error",i.context.fatalErrorCallback),e.on("needkey",i.context.needKeyCallback),e.on("flush",i.flushConsumer);var t=new zI.SampleConsumer(Lb.TrackType.VIDEO,i.context.mediaObject.videoBuffer,i.context.keyStore,i.context.eventEmitter,null!=o&&null!=o.mediaBufferSizeMs?o.mediaBufferSizeMs.video:void 0);return t.on("error",i.context.fatalErrorCallback),t.on("needkey",i.context.needKeyCallback),t.on("flush",i.flushConsumer),i.context.audioConsumer=e,i.context.videoConsumer=t,n.open(i.bridge),lt.Promise.all([i.getTrackBuffer(r,n.audioTracks),i.getTrackBuffer(r,n.videoTracks)])})).then(freeOnUnref(function(e){var t=e[0],n=e[1];r.throwIfRequested(),i.context.audioTrackBuffer=t,i.context.videoTrackBuffer=n,i.context.audioConsumer.setTrackBuffer(t),i.context.videoConsumer.setTrackBuffer(n),i.context.cancelAttach=null,i.stateMachine.act(0)})).catch(freeOnUnref(function(e){return i.context.mediaObject.shutdown().catch(freeOnUnref(function(e){s.error("Failed to shutdown MediaObject",e)})).then(freeOnUnref(function(){throw i.context.mediaObjectPool.release(i.context.mediaObject),i.context.mediaObject=null,e}))}))}),e})();t.AttachActivity=r}));e(WI);WI.AttachActivity;var KI=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.Detached=0]="Detached",e[e.Waiting=1]="Waiting",e[e.Ready=2]="Ready",e[e.Stopping=3]="Stopping",e[e.Ended=4]="Ended",e[e.Error=5]="Error",e[e.Detaching=6]="Detaching"})(n||(n={})),t.ContentState=n}));e(KI);KI.ContentState;var GI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("MediaBufferMonitor"),n=freeOnUnref(function(){function e(){this.eventEmitter=new A.EventEmitter,this.listeners=[],this.diagnostics=nn.Diagnostics.create("MediaBufferMonitor"),this.state={bufferStates:[],timestamp:Date.now()}}return e.prototype.initialize=freeOnUnref(function(e,t){this.registerListener(e,"Audio"),this.registerListener(t,"Video"),this.reportDiagnostics()}),e.prototype.shutdown=freeOnUnref(function(){for(var e=0,t=this.listeners;e<t.length;e++){var n=t[e];f.info("Removing state change callback from buffer("+n.type+")"),n.buffer.offStateChange()}this.listeners=[],this.state.lastEmittedEvent=void 0,this.state.lastEmittedEventTimestamp=void 0,this.state.lastReceivedBufferState=void 0,this.state.lastReceivedBufferStateType=void 0,this.reportDiagnostics()}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.emit=freeOnUnref(function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];(t=this.eventEmitter).emit.apply(t,[e].concat(n)),this.state.lastEmittedEvent=e,this.state.lastEmittedEventTimestamp=Date.now()}),e.prototype.onBufferStateChange=freeOnUnref(function(e,t,n){var r=!0;switch(this.state.lastReceivedBufferState=n,this.state.lastReceivedBufferStateType=t,n){case 3:this.emit("underrun");break;case 4:for(var i=0,o=this.listeners;i<o.length;i++){if(4!==(l=o[i]).buffer.state){r=!1,f.info("BufferType:"+l.type+' is not ReadyToPlay. Not emitting "readyToPlay"');break}}r&&this.emit("readyToPlay");break;case 5:for(var a=0,s=this.listeners;a<s.length;a++){var l;if(5!==(l=s[a]).buffer.state){r=!1,f.info("BufferType:"+l.type+' is not EndOfStream. Not emitting "endOfStream"');break}}r&&this.emit("endOfStream");break;case 6:this.emit("error",e.error)}this.reportDiagnostics()}),e.prototype.registerListener=freeOnUnref(function(t,n){var r=this,e=freeOnUnref(function(e){r.onBufferStateChange(t,n,e)});t.onStateChange(e),this.listeners.push({buffer:t,type:n,listener:e})}),e.prototype.reportDiagnostics=freeOnUnref(function(){this.state.bufferStates=this.listeners.map(freeOnUnref(function(e){return{state:e.buffer.state,type:e.type,error:e.buffer.error}})),this.state.timestamp=Date.now(),this.diagnostics.report("state",this.state)}),e})();t.MediaBufferMonitor=n}));e(GI);GI.MediaBufferMonitor;var QI=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={}).None="None",n.Filmmaker="Filmmaker",n.CalibratedBroadcast="CalibratedBroadcast",n.CalibratedCinematic="CalibratedCinematic",n),i=freeOnUnref(function(){function e(e){var t=this;this.mediaControl=null,this.onPictureModeChange=freeOnUnref(function(e){t.eventEmitter.emit("pictureModeChange",r[e])}),this.eventEmitter=e}return e.prototype.initialize=freeOnUnref(function(e){this.mediaControl=e,this.mediaControl.on("PictureModeChange",this.onPictureModeChange)}),e.prototype.shutdown=freeOnUnref(function(){null!==this.mediaControl&&this.mediaControl.off("PictureModeChange",this.onPictureModeChange)}),e})();t.PictureModeMonitor=i}));e(QI);QI.PictureModeMonitor;var XI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){var n=this;this.doPause=freeOnUnref(function(){n.taskQueue.queue({name:"pause MediaControl",promiseAction:0,promises:[],invoke:freeOnUnref(function(){return 2!==n.mediaControl.state?lt.Promise.resolve():FI.promisify(n.mediaControl,n.mediaControl.pause).catch(freeOnUnref(function(e){return n.stateMachine.act(5,e)}))})})}),this.doPlay=freeOnUnref(function(){n.taskQueue.queue({name:"play mediaControl",promiseAction:0,promises:[],invoke:freeOnUnref(function(){return 2===n.mediaControl.state?lt.Promise.resolve():FI.promisify(n.mediaControl,n.mediaControl.play).catch(freeOnUnref(function(e){return n.stateMachine.act(5,e)}))})})}),this.checkIfPlaying=freeOnUnref(function(){2===n.mediaControl.state&&n.stateMachine.act(1)}),this.checkIfPaused=freeOnUnref(function(){3===n.mediaControl.state&&n.stateMachine.act(3)}),this.onStateChanged=freeOnUnref(function(e){switch(e){case 2:n.stateMachine.act(1);break;case 1:case 3:n.stateMachine.act(3);break;case 4:n.stateMachine.act(5,n.mediaControl.error)}}),this.emitPlaying=freeOnUnref(function(){n.eventEmitter.emit("playing")}),this.emitPaused=freeOnUnref(function(){n.eventEmitter.emit("paused")}),this.onError=freeOnUnref(function(e){n.eventEmitter.emit("error",e)}),this.mediaControl=e,this.taskQueue=t,this.eventEmitter=new A.EventEmitter,this.stateMachine=new ml.FiniteStateMachine(0),this.setupStateMachine(),this.stateMachine.onTransition(0,0,this.doPlay),this.stateMachine.onTransition(2,3,this.doPlay),this.stateMachine.onTransition(3,2,this.doPause),this.stateMachine.onTransition(5,1,this.doPause),this.stateMachine.onTransition(4,1,this.emitPlaying),this.stateMachine.onTransition(5,1,this.emitPlaying),this.stateMachine.onReenterState(3,this.emitPlaying),this.stateMachine.onTransition(1,3,this.emitPaused),this.stateMachine.onTransition(2,3,this.emitPaused),this.stateMachine.onReenterState(0,this.emitPaused),this.stateMachine.onEnterState(4,this.checkIfPlaying),this.stateMachine.onEnterState(5,this.checkIfPlaying),this.stateMachine.onEnterState(1,this.checkIfPaused),this.stateMachine.onEnterState(2,this.checkIfPaused),this.stateMachine.onTransition(0,5,this.onError),this.stateMachine.onTransition(1,5,this.onError),this.stateMachine.onTransition(2,5,this.onError),this.stateMachine.onTransition(3,5,this.onError),this.stateMachine.onTransition(4,5,this.onError),this.stateMachine.onTransition(5,5,this.onError),this.mediaControl.on("MediaControlStateChange",this.onStateChanged)}return e.prototype.play=freeOnUnref(function(){this.stateMachine.act(0)}),e.prototype.pause=freeOnUnref(function(){this.stateMachine.act(2)}),e.prototype.stop=freeOnUnref(function(){this.mediaControl.off("MediaControlStateChange",this.onStateChanged),this.stateMachine.act(4)}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),Object.defineProperty(e.prototype,"playing",{get:freeOnUnref(function(){return 3===this.stateMachine.state}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:freeOnUnref(function(){return 0===this.stateMachine.state}),enumerable:!0,configurable:!0}),e.prototype.setupStateMachine=freeOnUnref(function(){this.stateMachine.addTransition(0,0,4),this.stateMachine.addTransition(0,2,0),this.stateMachine.addTransition(4,0,4),this.stateMachine.addTransition(4,2,5),this.stateMachine.addTransition(4,1,3),this.stateMachine.addTransition(4,3,0),this.stateMachine.addTransition(5,0,4),this.stateMachine.addTransition(5,2,5),this.stateMachine.addTransition(5,1,1),this.stateMachine.addTransition(3,0,3),this.stateMachine.addTransition(3,2,1),this.stateMachine.addTransition(3,3,0),this.stateMachine.addTransition(1,0,2),this.stateMachine.addTransition(1,2,1),this.stateMachine.addTransition(1,3,0),this.stateMachine.addTransition(2,0,2),this.stateMachine.addTransition(2,2,1),this.stateMachine.addTransition(2,3,4),this.stateMachine.addTransition(0,4,7),this.stateMachine.addTransition(1,4,7),this.stateMachine.addTransition(2,4,7),this.stateMachine.addTransition(3,4,7),this.stateMachine.addTransition(4,4,7),this.stateMachine.addTransition(5,4,7),this.stateMachine.addTransition(0,5,6),this.stateMachine.addTransition(1,5,6),this.stateMachine.addTransition(2,5,6),this.stateMachine.addTransition(3,5,6),this.stateMachine.addTransition(4,5,6),this.stateMachine.addTransition(5,5,6)}),e})();t.PlaybackStateMachine=n}));e(XI);XI.PlaybackStateMachine;var YI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("PlaybackStateController"),r=freeOnUnref(function(){function e(e,t){var n=this;this.onPlaying=freeOnUnref(function(){if(n.context.playbackTimer.start(),n.notifyAboutPlaying){n.notifyAboutPlaying=!1;var e=n.context.pendingPlayStore.take();n.taskQueue.queue({name:"Resolve play promises on onPlaying: we are now playing",promiseAction:1,promises:e,invoke:freeOnUnref(function(){n.context.eventEmitter.emit("playing"),n.context.pendingPlayStore.resolve(e)})})}}),this.onPaused=freeOnUnref(function(){if(n.context.playbackTimer.stop(),n.needsInternalPause){n.needsInternalPause=!1;var e=n.context.pendingPlayStore.take();n.taskQueue.queue({name:"Reject play promises: we got paused",promiseAction:2,promises:e,invoke:freeOnUnref(function(){n.context.eventEmitter.emit("timeupdate"),n.context.eventEmitter.emit("pause"),n.context.pendingPlayStore.reject(e,new Error("Play call aborted by a pause call"))})})}}),this.onError=freeOnUnref(function(e){n.context.fatalErrorCallback(e)}),this.notifyAboutPlaying=!1,this.needsInternalPause=!1,this.holdCount=0,this.pausedValue=!0,this.playbackStateMachine=null,this.context=e,this.taskQueue=t}return e.prototype.initialize=freeOnUnref(function(e){this.playbackStateMachine=new XI.PlaybackStateMachine(e,this.taskQueue),this.playbackStateMachine.on("playing",this.onPlaying),this.playbackStateMachine.on("paused",this.onPaused),this.playbackStateMachine.on("error",this.onError),this.pausedValue||0!==this.holdCount||this.doPlay()}),e.prototype.terminate=freeOnUnref(function(){if(this.context.playbackTimer.stop(),null!==this.playbackStateMachine&&(this.playbackStateMachine.off("playing",this.onPlaying),this.playbackStateMachine.off("paused",this.onPaused),this.playbackStateMachine.off("error",this.onError),this.playbackStateMachine=null),!this.pausedValue){var e=this.context.pendingPlayStore.take();this.context.pendingPlayStore.reject(e,new Error("MediaSource detached")),this.pausedValue=!0}this.notifyAboutPlaying=!1,this.needsInternalPause=!1,this.holdCount=0}),e.prototype.ended=freeOnUnref(function(){if(this.context.playbackTimer.stop(),!this.pausedValue){this.pausedValue=!0,this.context.eventEmitter.emit("pause");var e=this.context.pendingPlayStore.take();this.context.pendingPlayStore.reject(e,new Error("Playback ended"))}}),Object.defineProperty(e.prototype,"paused",{get:freeOnUnref(function(){return this.pausedValue}),enumerable:!0,configurable:!0}),e.prototype.play=freeOnUnref(function(){var e=this;if(this.pausedValue)this.notifyAboutPlaying=!0,this.needsInternalPause=!1,this.pausedValue=!1,0===this.holdCount&&this.doPlay();else if(null!==this.playbackStateMachine&&this.playbackStateMachine.playing){var t=this.context.pendingPlayStore.take();this.taskQueue.queue({name:"Resolve play promises on play: already playing",promiseAction:1,promises:t,invoke:freeOnUnref(function(){e.context.pendingPlayStore.resolve(t)})})}}),e.prototype.pause=freeOnUnref(function(){this.pausedValue||(this.notifyAboutPlaying=!1,this.needsInternalPause=!0,this.pausedValue=!0,this.doPause())}),e.prototype.hold=freeOnUnref(function(e){var r=this;return this.holdCount++,this.notifyAboutPlaying=this.notifyAboutPlaying||e,null===this.playbackStateMachine?lt.Promise.resolve():new lt.Promise(freeOnUnref(function(e,t){var n=freeOnUnref(function(){null!==r.playbackStateMachine&&r.playbackStateMachine.off("paused",n),e()});r.playbackStateMachine.on("paused",n),r.doPause()}))}),e.prototype.release=freeOnUnref(function(){0!==this.holdCount?(this.holdCount--,0!==this.holdCount||this.pausedValue||this.doPlay()):n.warn("Release invoked when playback is not on hold")}),e.prototype.doPlay=freeOnUnref(function(){null!==this.playbackStateMachine&&this.playbackStateMachine.play(),null!=this.context.audioConsumer&&this.context.audioConsumer.tryResume(),null!=this.context.videoConsumer&&this.context.videoConsumer.tryResume()}),e.prototype.doPause=freeOnUnref(function(){null!==this.playbackStateMachine?this.playbackStateMachine.pause():this.onPaused()}),e})();t.PlaybackStateController=r}));e(YI);YI.PlaybackStateController;var JI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("TaskQueue"),n=freeOnUnref(function(){function e(e){var t=this;this.executor=freeOnUnref(function(){if(0===t.taskQueue.length)return t.currentTask=null,void(t.idle=!0);t.idle=!1,t.lastTaskPromise=t.executeTask(t.taskQueue.shift())}),this.idle=!0,this.onError=e,this.taskQueue=[],this.currentTask=null,this.lastTaskPromise=lt.Promise.resolve()}return e.prototype.stop=freeOnUnref(function(){var e=this.taskQueue;return this.taskQueue=[],this.idle||r.info('TaskQueue is not idle (current task is "'+(null==this.currentTask?"null":this.currentTask.name)+'".'),this.lastTaskPromise.then(freeOnUnref(function(){return e}))}),e.prototype.queue=freeOnUnref(function(e){this.taskQueue.push(e),this.idle&&this.executor()}),e.prototype.executeTask=freeOnUnref(function(t){var n=this;return this.currentTask=t,this.createImmediatePromise().then(freeOnUnref(function(){return t.invoke()})).catch(freeOnUnref(function(e){return n.onError(t,e)})).catch(freeOnUnref(function(e){r.error("Task execution error handler threw another error!",e)})).then(freeOnUnref(function(){return n.executor()}))}),e.prototype.createImmediatePromise=freeOnUnref(function(){return new lt.Promise(freeOnUnref(function(e,t){oe.timer.setImmediate(e)}))}),e})();t.TaskQueue=n}));e(JI);JI.TaskQueue;var ZI=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("SeekMachine"),n=freeOnUnref(function(){function e(e,t,n,r,i){void 0===i&&(i=zt.deviceInformation);var o=this;this.onIdle=freeOnUnref(function(){o.terminated||(o.context.seeking=!1,o.seeking=!1,o.computedSeekPositionMs=null,o.context.seekTargetPositionMs=null,o.playbackStateController.release(),o.context.eventEmitter.emit("timeupdate"),o.context.eventEmitter.emit("seeked"),o.forced=!1,f.info(">> Seek completed"))}),this.onPausing=freeOnUnref(function(){o.terminated||o.playbackStateController.hold(!1).then(freeOnUnref(function(){o.playbackStateController.release(),o.terminated||o.stateMachine.act(1)}))}),this.calculateSeekPosition=freeOnUnref(function(){if(!o.terminated){if(o.forced=o.forced||o.pendingForced,o.pendingForced=!1,o.forced&&(f.info("Forced seek to "+o.context.seekTargetPositionMs+"ms. Flushing all SampleConsumers"),o.flushAllConsumers()),o.isIntraChunkSeekSupported)o.computedSeekPositionMs=o.context.seekTargetPositionMs;else{var e=o.getVideoSampleAt(o.context.seekTargetPositionMs);if(null===e)return f.info("No video sample found at "+o.context.seekTargetPositionMs+". Waiting for one to be appended"),void o.stateMachine.act(2);var t=1e3*e.sample.pts/o.context.videoTrackBuffer.timescale,n=o.context.mediaObject.isReady?o.context.mediaObject.mediaControl.playbackTimeMs:null;if(f.info("Base video sample PTS: "+t+"ms, current playbackTimeMs: "+n+"ms"),!o.forced&&null!==n&&o.context.seekTargetPositionMs>n&&t<n)return f.info("Not a forced seek and a forward seek would cause a backwards seek. Ignoring seek"),void o.stateMachine.act(7);o.computedSeekPositionMs=t}o.computedSeekPositionMs=Math.ceil(o.computedSeekPositionMs),o.context.seekTargetPositionMs=o.computedSeekPositionMs,o.stateMachine.act(4)}}),this.onSampleAdded=freeOnUnref(function(){return!o.terminated&&(null!==o.getVideoSampleAt(o.context.seekTargetPositionMs)&&(f.info("Video sample for seek position was added"),o.stateMachine.act(3),!0))}),this.onEnterWaitForSample=freeOnUnref(function(){o.terminated||(o.context.videoTrackBuffer.on("sampleAdded",o.onSampleAdded),o.onSampleAdded()||o.contentStateMachine.act(2))}),this.onLeaveWaitForSample=freeOnUnref(function(){o.terminated||o.context.videoTrackBuffer.off("sampleAdded",o.onSampleAdded)}),this.onFlushing=freeOnUnref(function(){o.terminated||o.flushAllConsumers().then(freeOnUnref(function(){o.terminated||(f.info("All SampleConsumers flushed"),o.flushAllConsumersPromise=null,o.stateMachine.act(5))}))}),this.onSeeking=freeOnUnref(function(){o.terminated||(f.info("Queuing task to execute seek"),o.taskQueue.queue({name:"seek on MediaControl",promises:[],promiseAction:0,invoke:freeOnUnref(function(){return o.terminated?lt.Promise.resolve():FI.promisify(o.context.mediaObject.mediaControl,o.context.mediaObject.mediaControl.seek,o.computedSeekPositionMs).then(freeOnUnref(function(){o.terminated||(f.info("MediaControl seek completed, updating SampleConsumers position to "+o.computedSeekPositionMs),o.forced=!1,o.context.audioConsumer.updatePosition(o.computedSeekPositionMs),o.context.videoConsumer.updatePosition(o.computedSeekPositionMs),o.stateMachine.act(8))}))})}))}),this.context=e,this.playbackStateController=t,this.contentStateMachine=n,this.taskQueue=r,this.seeking=!1,this.computedSeekPositionMs=null,this.pendingForced=!1,this.forced=!1,this.terminated=!1,this.flushAllConsumersPromise=null,this.deviceInformation=i,this.isIntraChunkSeekSupported=this.checkIntraChunkSeekSupport(),this.diagnostics=nn.Diagnostics.create("SeekMachine"),this.stateMachine=new ml.FiniteStateMachine("Idle"),this.setupStateMachine(),this.stateMachine.onEnterState("Idle",this.onIdle),this.stateMachine.onEnterState("Pausing",this.onPausing),this.stateMachine.onEnterState("CalculatingPosition",this.calculateSeekPosition),this.stateMachine.onEnterState("WaitingSample",this.onEnterWaitForSample),this.stateMachine.onLeaveState("WaitingSample",this.onLeaveWaitForSample),this.stateMachine.onEnterState("Flushing",this.onFlushing),this.stateMachine.onEnterState("SeekingMediaControl",this.onSeeking),this.stateMachine.onStateChange(freeOnUnref(function(e){var t="Idle"===e?null:{computedSeekPositionMs:o.computedSeekPositionMs,pendingForced:o.pendingForced,seekState:e,targetSeekPositionMs:o.context.seekTargetPositionMs,terminated:o.terminated,timestamp:Date.now()};o.diagnostics.report("state",t)}))}return e.prototype.terminate=freeOnUnref(function(){f.info("SeekMachine terminated"),this.terminated=!0,this.reportDiagnostics("Idle")}),e.prototype.seek=freeOnUnref(function(e){void 0===e&&(e=!1),f.info(">> Seeking to "+this.context.seekTargetPositionMs+"ms, forced: "+e),this.pendingForced=e,this.seeking||(f.info("Not interrupting a previous seek. Putting playback on hold"),this.seeking=!0,this.playbackStateController.hold(!1)),this.stateMachine.act(0)}),e.prototype.setupStateMachine=freeOnUnref(function(){this.stateMachine.addTransition("Idle",0,"Pausing"),this.stateMachine.addTransition("Pausing",0,"Pausing"),this.stateMachine.addTransition("Pausing",1,"CalculatingPosition"),this.stateMachine.addTransition("CalculatingPosition",0,"CalculatingPosition"),this.stateMachine.addTransition("CalculatingPosition",2,"WaitingSample"),this.stateMachine.addTransition("CalculatingPosition",4,"Flushing"),this.stateMachine.addTransition("CalculatingPosition",6,"SeekingMediaControl"),this.stateMachine.addTransition("CalculatingPosition",7,"Idle"),this.stateMachine.addTransition("WaitingSample",0,"CalculatingPosition"),this.stateMachine.addTransition("WaitingSample",3,"CalculatingPosition"),this.stateMachine.addTransition("Flushing",5,"SeekingMediaControl"),this.stateMachine.addTransition("Flushing",0,"AwaitingFlushedToSeek"),this.stateMachine.addTransition("AwaitingFlushedToSeek",5,"CalculatingPosition"),this.stateMachine.addTransition("SeekingMediaControl",8,"Idle"),this.stateMachine.addTransition("SeekingMediaControl",0,"AwaitingSeekedToSeekAgain"),this.stateMachine.addTransition("AwaitingSeekedToSeekAgain",8,"CalculatingPosition")}),e.prototype.getVideoSampleAt=freeOnUnref(function(e){if(this.terminated)return null;var t=this.context.videoTrackBuffer.getSampleAt(e);return null===t&&(t=this.context.videoTrackBuffer.getSampleAt(e+150)),t}),e.prototype.flushAllConsumers=freeOnUnref(function(){var n=this;if(null!==this.flushAllConsumersPromise)return this.flushAllConsumersPromise;this.contentStateMachine.act(2);var e,t=this.context.mediaObject,r=t.mediaControl,i=lt.Promise.resolve().then(freeOnUnref(function(){return n.terminated?[]:lt.Promise.all([n.flushConsumer(n.context.audioConsumer,!1),n.flushConsumer(n.context.videoConsumer,!1)])})),o=this.context.audioConsumer.ended||this.context.videoConsumer.ended;return o?(f.info("Final sample already fed to buffer. Sample consumer ended: { audio: "+this.context.audioConsumer.ended+", video: "+this.context.videoConsumer.ended+" }. Reinitializing MediaObject."),e=i.then(freeOnUnref(function(){return t.shutdown()})).then(freeOnUnref(function(){if(n.terminated)throw new lt.CancelError;return t.initialize()})).then(freeOnUnref(function(){return n.terminated?[]:lt.Promise.all([n.flushConsumer(n.context.audioConsumer,!0),n.flushConsumer(n.context.videoConsumer,!0)])})).then(freeOnUnref(function(){}))):e=i.then(freeOnUnref(function(){return FI.promisify(r,r.stop)})).then(freeOnUnref(function(){return n.terminated||o?[]:(f.info("Flushing MediaBuffer objects now."),lt.Promise.all([FI.promisify(n.context.mediaObject.audioBuffer,n.context.mediaObject.audioBuffer.flush),FI.promisify(n.context.mediaObject.videoBuffer,n.context.mediaObject.videoBuffer.flush)]))})).then(freeOnUnref(function(){})),this.flushAllConsumersPromise=e.then(freeOnUnref(function(){if(!n.terminated){f.info("Resolving pending flush deferreds: Flush completed");for(var e=0,t=n.context.mediaObject.pendingFlush;e<t.length;e++){t[e].resolve()}n.context.mediaObject.pendingFlush.length=0}})).catch(freeOnUnref(function(e){if(!n.terminated)throw f.error("Failed to flush all consumers.",e),n.context.fatalErrorCallback(e),e})),this.flushAllConsumersPromise}),e.prototype.flushConsumer=freeOnUnref(function(a,s){var l=this;return this.terminated?(f.info("SeekMachine was terminated. Cancelling flush promise"),lt.Promise.reject(new lt.CancelError)):new lt.Promise(freeOnUnref(function(e,t){var n=s?"reinitializing":"flushing",r=freeOnUnref(function(){o(),l.terminated?t(new lt.CancelError):(f.info("SampleConsumer finished "+n),e())}),i=freeOnUnref(function(e){o(),f.error("SampleConsumer failed "+n+" with error:",e),t(e)});function o(){a.off("flushed",r),a.off("mediaBufferCodecInitialized",r),a.off("error",i)}a.on("error",i),s?(a.on("mediaBufferCodecInitialized",r),a.hardReset()):(a.on("flushed",r),a.reset()||(f.info("SampleConsumer already empty, continuing"),a.off("flushed",r),a.off("error",i),e()))}))}),e.prototype.reportDiagnostics=freeOnUnref(function(e){var t="Idle"===e?null:{computedSeekPositionMs:this.computedSeekPositionMs,pendingForced:this.pendingForced,seekState:e,targetSeekPositionMs:this.context.seekTargetPositionMs,terminated:this.terminated,timestamp:Date.now()};this.diagnostics.report("state",t)}),e.prototype.checkIntraChunkSeekSupport=freeOnUnref(function(){if(null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.elementaryStream&&!0===L.configurationStore.configuration.elementaryStream.disableIntraChunkSeeking)return f.info("Intra chunk seeking is explicitly disabled"),!1;var e=this.deviceInformation.mediaPlayer,t=null!=e&&!0===e.supportsIntraChunkSeeking;return f.info("Intra chunk seeking is "+(t?"":"NOT ")+"supported"),t}),e})();t.SeekMachine=n}));e(ZI);ZI.SeekMachine;var $I=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Ka.EphemeralJSLogger("ContentStateMachine"),n=freeOnUnref(function(){function e(e){var i=this;this.errorHandler=freeOnUnref(function(e,t){i.context.pendingPlayStore.reject(e.promises,t),i.stateMachine.act(7,t)}),this.onError=freeOnUnref(function(e){r.info(">> onError",e),i.context.playbackTimer.stop(),i.mediaBufferMonitor.shutdown(),null==i.context.error&&(r.error("Setting MediaPlayer.error based on ",e),e instanceof lt.CancelError?i.context.error=new ct.XpError("media.cancelled",void 0,"Fatal error from CancelError"):i.isBackgroundedError(e)?i.context.error=new ct.XpError(Ni.codes.xp.system.backgrounded,void 0,e.message,!1,e):i.context.error=ct.XpError.generatePrefixedError(e,"media"),i.emit("error"))}),this.onEndOfPlayback=freeOnUnref(function(){i.isEnded=!0;var e=freeOnUnref(function(){i.emit("timeupdate"),i.playbackStateController.ended(),i.emit("ended"),i.emitState()});i.taskQueue.queue({name:"Stop MediaControl after EOS",promiseAction:0,promises:[],invoke:freeOnUnref(function(){return FI.promisify(i.context.mediaObject.mediaControl,i.context.mediaObject.mediaControl.stop).then(e)})})}),this.onDetach=freeOnUnref(function(){i.taskQueue.stop().then(freeOnUnref(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];switch(r.promiseAction){case 1:i.context.pendingPlayStore.resolve(r.promises);break;case 2:i.context.pendingPlayStore.reject(r.promises,new Error("Source is being detached"))}}})).then(freeOnUnref(function(){i.stateMachine.act(6)})),i.currentReadyState=0,i.playbackStateController.terminate(),i.context.seeking=!1,(i.context.seekTargetPositionMs=null)!==i.seekMachine&&(i.seekMachine.terminate(),i.seekMachine=null),i.context.error=null,i.context.waitingForKeyEmitted=!1,i.mediaBufferMonitor.shutdown(),i.pictureModeMonitor.shutdown()}),this.onDetached=freeOnUnref(function(){i.isEnded=!1,null!==i.detachDeferred?(null!==i.seekMachine&&i.seekMachine.terminate(),i.seekMachine=null,i.detachDeferred.resolve(void 0),i.detachDeferred=null):r.warn("ContentStateMachine is now detached, but there is no detach promise pending!")}),this.context=e,this.seekMachine=null,this.isEnded=!1,this.currentReadyState=0,this.detachDeferred=null,this.taskQueue=new JI.TaskQueue(this.errorHandler),this.mediaBufferMonitor=new GI.MediaBufferMonitor,this.bufferEventTracker=new A.EventTracker(this.mediaBufferMonitor),this.playbackStateController=new YI.PlaybackStateController(this.context,this.taskQueue),this.pictureModeMonitor=new QI.PictureModeMonitor(this.context.eventEmitter);var t=L.configurationStore.configuration;null!=t&&null!=t.elementaryStream&&null!=t.elementaryStream.backgroundedErrors&&Array.isArray(t.elementaryStream.backgroundedErrors)?this.backgroundedErrors=[50801].concat(t.elementaryStream.backgroundedErrors):this.backgroundedErrors=[50801],r.info("Backgrounded error codes: "+this.backgroundedErrors),this.stateMachine=new ml.FiniteStateMachine(KI.ContentState.Detached),this.stateMachine.onStateChange(freeOnUnref(function(e){return r.setId(KI.ContentState[e])})),this.setupStateMachine(),this.stateMachine.onTransition(KI.ContentState.Detached,0,freeOnUnref(function(){i.currentReadyState=1,i.emit("loadedmetadata"),i.mediaBufferMonitor.initialize(i.context.mediaObject.audioBuffer,i.context.mediaObject.videoBuffer),i.playbackStateController.hold(!1),i.playbackStateController.initialize(i.context.mediaObject.mediaControl),i.pictureModeMonitor.initialize(i.context.mediaObject.mediaControl),i.seekMachine=new ZI.SeekMachine(i.context,i.playbackStateController,i,i.taskQueue),i.context.seekTargetPositionMs=i.context.defaultPlaybackStartPositionMs,i.context.defaultPlaybackStartPositionMs=0,i.seekMachine.seek()})),this.stateMachine.onTransition(KI.ContentState.Waiting,3,freeOnUnref(function(){i.context.waitingForKeyEmitted||(i.emit("waitingforkey"),i.context.waitingForKeyEmitted=!0)})),this.stateMachine.onTransition(KI.ContentState.Waiting,5,this.onDetach),this.stateMachine.onEnterState(KI.ContentState.Waiting,freeOnUnref(function(){i.context.playbackTimer.stop()})),this.stateMachine.onLeaveState(KI.ContentState.Waiting,freeOnUnref(function(){i.context.waitingForKeyEmitted=!1})),this.stateMachine.onTransition(KI.ContentState.Waiting,1,freeOnUnref(function(){i.currentReadyState=2,i.emit("canplay"),i.playbackStateController.release()})),this.stateMachine.onTransition(KI.ContentState.Ready,2,freeOnUnref(function(){i.currentReadyState=1,i.playbackStateController.paused||null!=i.context.error||i.isEnded||(i.emit("timeupdate"),i.emit("waiting")),i.isWaitingForKey()&&!i.context.waitingForKeyEmitted&&(i.emit("waitingforkey"),i.context.waitingForKeyEmitted=!0),i.playbackStateController.hold(!i.playbackStateController.paused)})),this.stateMachine.onTransition(KI.ContentState.Ready,5,this.onDetach),this.stateMachine.onEnterState(KI.ContentState.Ended,this.onEndOfPlayback),this.stateMachine.onTransition(KI.ContentState.Ended,5,this.onDetach),this.stateMachine.onTransition(KI.ContentState.Detaching,7,freeOnUnref(function(e){r.error("Error during detaching sequence",e)})),this.stateMachine.onTransition(KI.ContentState.Detached,7,this.onError),this.stateMachine.onTransition(KI.ContentState.Waiting,7,this.onError),this.stateMachine.onTransition(KI.ContentState.Ready,7,this.onError),this.stateMachine.onTransition(KI.ContentState.Ended,7,this.onError),this.stateMachine.onTransition(KI.ContentState.Error,7,this.onError),this.stateMachine.onTransition(KI.ContentState.Error,5,this.onDetach),this.diagnostics=nn.Diagnostics.create("MediaPlayer.ContentStateMachine"),this.state={contentState:KI.ContentState[KI.ContentState.Detached],lastContentStateChangeTimestamp:Date.now(),isEnded:this.isEnded,currentReadyState:this.currentReadyState,isPendingDetachedDeferredResolution:!1,lastEmittedEvent:null,lastEmittedEventTimestamp:0},this.stateMachine.onStateChange(freeOnUnref(function(e){i.state.lastContentStateChangeTimestamp=Date.now(),i.emitState()})),this.listenForBufferEvents()}return e.prototype.act=freeOnUnref(function(e,t){this.stateMachine.act(e,t)}),e.prototype.seek=freeOnUnref(function(e){null!==this.seekMachine&&this.seekMachine.seek(e)}),Object.defineProperty(e.prototype,"paused",{get:freeOnUnref(function(){return this.playbackStateController.paused}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:freeOnUnref(function(){return this.isEnded}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:freeOnUnref(function(){return this.currentReadyState}),enumerable:!0,configurable:!0}),e.prototype.pause=freeOnUnref(function(){this.playbackStateController.pause()}),e.prototype.detach=freeOnUnref(function(){return null!==this.detachDeferred||(this.detachDeferred=new lt.Deferred,this.stateMachine.act(5)),this.detachDeferred.promise}),e.prototype.play=freeOnUnref(function(){this.paused&&(this.emit("play"),this.emitState()),this.playbackStateController.play()}),e.prototype.raiseMediaError=freeOnUnref(function(e){this.stateMachine.act(7,e)}),e.prototype.isBackgroundedError=freeOnUnref(function(e){if(e.hasOwnProperty("code")){var t=e.code;return-1<this.backgroundedErrors.indexOf(t)}return!1}),e.prototype.isWaitingForKey=freeOnUnref(function(){return this.context.audioConsumer.isWaitingKey||this.context.videoConsumer.isWaitingKey}),e.prototype.emit=freeOnUnref(function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];(t=this.context.eventEmitter).emit.apply(t,[e].concat(n)),this.state.lastEmittedEvent=e,this.state.lastEmittedEventTimestamp=Date.now()}),e.prototype.listenForBufferEvents=freeOnUnref(function(){var t=this;this.bufferEventTracker.on("underrun",freeOnUnref(function(){t.stateMachine.act(2)})),this.bufferEventTracker.on("readyToPlay",freeOnUnref(function(){null!=t.context.audioConsumer&&t.context.audioConsumer.tryPause(),null!=t.context.videoConsumer&&t.context.videoConsumer.tryPause(),t.stateMachine.act(1)})),this.bufferEventTracker.on("endOfStream",freeOnUnref(function(){t.stateMachine.act(4)})),this.bufferEventTracker.on("error",freeOnUnref(function(e){t.stateMachine.act(7,e)}))}),e.prototype.setupStateMachine=freeOnUnref(function(){this.stateMachine.addTransition(KI.ContentState.Detached,5,KI.ContentState.Detached),this.stateMachine.addTransition(KI.ContentState.Detached,0,KI.ContentState.Waiting),this.stateMachine.addTransition(KI.ContentState.Detached,7,KI.ContentState.Error),this.stateMachine.onEnterState(KI.ContentState.Detached,this.onDetached),this.stateMachine.onReenterState(KI.ContentState.Detached,this.onDetached),this.stateMachine.addTransition(KI.ContentState.Waiting,3,KI.ContentState.Waiting),this.stateMachine.addTransition(KI.ContentState.Waiting,1,KI.ContentState.Ready),this.stateMachine.addTransition(KI.ContentState.Waiting,2,KI.ContentState.Waiting),this.stateMachine.addTransition(KI.ContentState.Waiting,5,KI.ContentState.Detaching),this.stateMachine.addTransition(KI.ContentState.Waiting,7,KI.ContentState.Error),this.stateMachine.addTransition(KI.ContentState.Ready,3,KI.ContentState.Ready),this.stateMachine.addTransition(KI.ContentState.Ready,2,KI.ContentState.Waiting),this.stateMachine.addTransition(KI.ContentState.Ready,1,KI.ContentState.Ready),this.stateMachine.addTransition(KI.ContentState.Ready,4,KI.ContentState.Ended),this.stateMachine.addTransition(KI.ContentState.Ready,5,KI.ContentState.Detaching),this.stateMachine.addTransition(KI.ContentState.Ready,7,KI.ContentState.Error),this.stateMachine.addTransition(KI.ContentState.Ended,7,KI.ContentState.Error),this.stateMachine.addTransition(KI.ContentState.Ended,5,KI.ContentState.Detaching),this.stateMachine.addTransition(KI.ContentState.Detaching,6,KI.ContentState.Detached),this.stateMachine.addTransition(KI.ContentState.Detaching,7,KI.ContentState.Detaching),this.stateMachine.addTransition(KI.ContentState.Error,7,KI.ContentState.Error),this.stateMachine.addTransition(KI.ContentState.Error,5,KI.ContentState.Detaching),this.stateMachine.onIllegalTransition(freeOnUnref(function(e,t,n){r.error("IllegalTransitionError",e," :: ",t)}))}),e.prototype.emitState=freeOnUnref(function(){this.state.contentState=KI.ContentState[this.stateMachine.state],this.state.isEnded=this.isEnded,this.state.currentReadyState=this.currentReadyState,this.state.isPendingDetachedDeferredResolution=null!==this.detachDeferred,this.diagnostics.report("state",this.state)}),e})();t.ContentStateMachine=n}));e($I);$I.ContentStateMachine;var ek=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){var e=this;this.mediaKeys=null,this.onNewKey=new A.MulticastCallback,this.keyLoadedCallback=freeOnUnref(function(){oe.timer.setImmediate(freeOnUnref(function(){e.onNewKey.invoke()}))})}return Object.defineProperty(e.prototype,"hasMediaKeys",{get:freeOnUnref(function(){return null!==this.mediaKeys}),enumerable:!0,configurable:!0}),e.prototype.getSessionForKeyId=freeOnUnref(function(e){return null===this.mediaKeys?null:this.mediaKeys.getSessionForKeyId(e)}),e.prototype.onKeyLoaded=freeOnUnref(function(e){this.onNewKey.add(e)}),e.prototype.offKeyLoaded=freeOnUnref(function(e){this.onNewKey.remove(e)}),e.prototype.setMediaKeys=freeOnUnref(function(e){null!==this.mediaKeys&&this.mediaKeys.offKeyLoaded(this.keyLoadedCallback),this.mediaKeys=e,null!==this.mediaKeys&&this.mediaKeys.onKeyLoaded(this.keyLoadedCallback),this.keyLoadedCallback()}),e})();t.KeyStoreProxy=n}));e(ek);ek.KeyStoreProxy;var tk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.promises=[]}return e.prototype.add=freeOnUnref(function(){var e=new lt.Deferred;return this.promises.push(e),e.promise}),e.prototype.take=freeOnUnref(function(){var e=this.promises;return this.promises=[],e}),e.prototype.resolve=freeOnUnref(function(e){for(var t=0,n=e;t<n.length;t++){n[t].resolve(void 0)}}),e.prototype.reject=freeOnUnref(function(e,t){for(var n=0,r=e;n<r.length;n++){r[n].reject(t)}}),e})();t.PendingPlayStore=n}));e(tk);tk.PendingPlayStore;var nk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.onTick=e,this.interval=null}return e.prototype.start=freeOnUnref(function(){var e=this;null===this.interval&&(this.interval=oe.timer.setInterval(freeOnUnref(function(){return e.onTick(!0)}),250))}),e.prototype.stop=freeOnUnref(function(){null!==this.interval&&(oe.timer.clearInterval(this.interval),this.interval=null)}),e.prototype.tick=freeOnUnref(function(){this.onTick(!1)}),e})();t.PlaybackTimer=n}));e(nk);nk.PlaybackTimer;var rk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("MediaPlayerVolumeFeature"),r=freeOnUnref(function(){function e(){var e=this;this.pendingVolumeUpdate=!1,this.lastRequestedVolume=1,this.lastNonZeroVolume=1,this.onMediaObjectShutdown=freeOnUnref(function(){e.destroy()}),this.onMediaObjectReady=freeOnUnref(function(){e.isReady()?e.pendingVolumeUpdate&&(e.volume=e.lastRequestedVolume,e.pendingVolumeUpdate=!1):n.warn("onMediaObjectReady, but mediaObject is not ready")})}return e.isSupported=freeOnUnref(function(){if(null==L.configurationStore.configuration)return n.info("VolumeFeature is not supported - no configuration available"),!1;if(!Qe.nestedValue(L.configurationStore.configuration,"device.volumeFeatureEnabled",!1))return n.info("VolumeFeature is not enabled in device configuration"),!1;var e=NI.MediaObjectImpl.capabilities().supportsAudioVolume;return n.info("VolumeFeature isSupported returned: "+e),e}),Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){return this.isReady()?this.mediaObject.mediaControl.volume:this.lastRequestedVolume}),set:freeOnUnref(function(e){0<(this.lastRequestedVolume=e)&&(this.lastNonZeroVolume=e),this.isReady()?this.mediaObject.mediaControl.volume=e:this.pendingVolumeUpdate=!0}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:freeOnUnref(function(){return 0===this.volume}),set:freeOnUnref(function(e){this.volume=e?0:this.lastNonZeroVolume}),enumerable:!0,configurable:!0}),e.prototype.onChange=freeOnUnref(function(e){}),e.prototype.offChange=freeOnUnref(function(e){}),e.prototype.setMediaObject=freeOnUnref(function(e){this.destroy(),this.mediaObject=e,this.mediaObject.on("ready",this.onMediaObjectReady),this.mediaObject.on("shutdown",this.onMediaObjectShutdown)}),e.prototype.destroy=freeOnUnref(function(){this.mediaObject&&(this.mediaObject.off("ready",this.onMediaObjectReady),this.mediaObject.off("shutdown",this.onMediaObjectShutdown)),this.mediaObject=void 0}),e.prototype.isReady=freeOnUnref(function(){try{return null!=this.mediaObject&&this.mediaObject.isReady}catch(e){return!1}}),e})();t.MediaPlayerVolumeFeature=r}));e(rk);rk.MediaPlayerVolumeFeature;var ik=t(freeOnUnref(function(e,t){var r=ce&&ce.__assign||freeOnUnref(function(){return(r=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("MediaPlayerElementaryStream"),n=freeOnUnref(function(){function e(e){var n=this;this.droppedVideoFramesOfCurrentMedia=0,this.textTracks=null,this.onTick=freeOnUnref(function(e){if(e&&n.playbackContext.eventEmitter.emit("timeupdate"),null!=n.playbackContext.audioConsumer&&null!=n.playbackContext.videoConsumer&&null!=n.playbackContext.mediaObject&&n.playbackContext.mediaObject.isReady){var t=n.playbackContext.mediaObject.mediaControl.playbackTimeMs;n.playbackContext.audioConsumer.updatePosition(t),n.playbackContext.videoConsumer.updatePosition(t)}}),this.onNeedKey=freeOnUnref(function(){n.stateMachine.act(3)}),this.onFatalError=freeOnUnref(function(e){n.stateMachine.act(7,e)}),this.ensureSessionNotInUse=freeOnUnref(function(e){if(0===n.stateMachine.readyState)return lt.Promise.resolve();if(null==n.playbackContext.mediaObject||null==n.playbackContext.audioConsumer||null==n.playbackContext.videoConsumer)return lt.Promise.resolve();if(n.playbackContext.audioConsumer.isSessionIdInUse(e)||n.playbackContext.videoConsumer.isSessionIdInUse(e)){n.seek(1e3*n.currentTime,!0);var t=new lt.Deferred;return n.playbackContext.mediaObject.pendingFlush.push(t),t.promise}return lt.Promise.resolve()}),this.attachingMediaKeys=!1,this.attachedMediaKeys=null,this.diagnostics=nn.Diagnostics.create("MediaPlayerElementaryStream"),this.playbackContext={suggestedPictureModes:void 0,surfaceRef:e,eventEmitter:new A.EventEmitter,mediaObjectPool:new jI.MediaObjectPool,fatalErrorCallback:this.onFatalError,needKeyCallback:this.onNeedKey,pendingPlayStore:new tk.PendingPlayStore,playbackTimer:new nk.PlaybackTimer(this.onTick),keyStore:new ek.KeyStoreProxy,source:null,cancelAttach:null,attachPromise:null,detachPromise:null,mediaObject:null,drmSystem:null,audioConsumer:null,audioTrackBuffer:null,videoConsumer:null,videoTrackBuffer:null,error:null,waitingForKeyEmitted:!1,seeking:!1,seekTargetPositionMs:null,defaultPlaybackStartPositionMs:0,cachedPlaybackPositionMs:0,playbackPositionQueryTimeMs:null},rk.MediaPlayerVolumeFeature.isSupported()&&(this.volumeFeature=new rk.MediaPlayerVolumeFeature),this.stateMachine=new $I.ContentStateMachine(this.playbackContext),this.attachActivity=new WI.AttachActivity(this,this.stateMachine,this.playbackContext)}return Object.defineProperty(e.prototype,"ended",{get:freeOnUnref(function(){return this.stateMachine.ended}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:freeOnUnref(function(){return Qe.withDefault(this.playbackContext.error,void 0)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:freeOnUnref(function(){return this.stateMachine.paused}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:freeOnUnref(function(){return this.stateMachine.readyState}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:freeOnUnref(function(){if(null==this.playbackContext.source)return new Xb.JSTimeRanges;var e=this.playbackContext.source.activeSourceBuffers;if(0===e.length)return new Xb.JSTimeRanges;for(var t=e.item(0).buffered.numberLine,n=1;n<e.length;n++)t=t.intersection(e.item(n).buffered.numberLine);return new Xb.JSTimeRanges(t)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seekable",{get:freeOnUnref(function(){if(null==this.playbackContext.source)return new Xb.JSTimeRanges;if(isFinite(this.playbackContext.source.duration)){var e=new In.NumberLine;return e.add({start:0,end:this.playbackContext.source.duration}),new Xb.JSTimeRanges(e)}return this.buffered}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seeking",{get:freeOnUnref(function(){return this.playbackContext.seeking}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:freeOnUnref(function(){return null!=this.playbackContext.source?this.playbackContext.source.duration:NaN}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:freeOnUnref(function(){return(0===this.playbackContext.defaultPlaybackStartPositionMs?this.getOfficialPlaybackPosition():this.playbackContext.defaultPlaybackStartPositionMs)/1e3}),set:freeOnUnref(function(e){i.info(">> Setting currentTime: "+e+"s"),0===this.stateMachine.readyState?(this.playbackContext.defaultPlaybackStartPositionMs=1e3*e,this.reportDiagnostics(),i.info("Not calling #seek() due to readyState being HAVE_NOTHING")):this.seek(1e3*e)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerViewport",{get:freeOnUnref(function(){if(null!=this.playbackContext.mediaObject&&0!==this.playbackContext.mediaObject.mediaControl.state&&5!==this.playbackContext.mediaObject.mediaControl.state&&4!==this.playbackContext.mediaObject.mediaControl.state)return this.playbackContext.mediaObject.mediaControl.viewport}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:freeOnUnref(function(){var e=this.playbackContext.mediaObject;if(null!=e){var t=e.mediaControl;if(null!=t){var n=t.metadata;return r({},n)}}}),enumerable:!0,configurable:!0}),e.prototype.getOfficialPlaybackPosition=freeOnUnref(function(){return 0===this.stateMachine.readyState?0:null!=this.playbackContext.seekTargetPositionMs?this.playbackContext.seekTargetPositionMs:((null==this.playbackContext.playbackPositionQueryTimeMs||Date.now()>this.playbackContext.playbackPositionQueryTimeMs+50)&&(this.playbackContext.cachedPlaybackPositionMs=this.playbackContext.mediaObject.mediaControl.playbackTimeMs,this.playbackContext.playbackPositionQueryTimeMs=Date.now()),this.playbackContext.cachedPlaybackPositionMs)}),e.prototype.seek=freeOnUnref(function(e,t){if(void 0===t&&(t=!1),i.info(">> seek to newPlaybackPositionMs: "+e+", forced: "+t),0!==this.stateMachine.readyState){if(i.info("Setting playbackContext.seeking to true"),this.playbackContext.seeking=!0,this.playbackContext.playbackPositionQueryTimeMs=null,!t){e=Math.min(e,1e3*this.duration),e=Math.max(e,0);var n=this.seekable.numberLine;if(0===n.getIntervals().length)return this.playbackContext.seeking=!1,this.reportDiagnostics(),void i.info("Not emitting a 'seeking' event due to seekableRanges having empty intervals");e=this.findClosestSeekablePosition(e,n)}i.info("Emitting a 'seeking' event"),this.playbackContext.eventEmitter.emit("seeking"),this.playbackContext.seekTargetPositionMs=e,this.stateMachine.seek(t),this.reportDiagnostics()}}),e.prototype.findClosestSeekablePosition=freeOnUnref(function(e,t){return e}),Object.defineProperty(e.prototype,"mediaSource",{get:freeOnUnref(function(){return this.playbackContext.source}),set:freeOnUnref(function(e){var t=this;this.attachActivity.attach(e).then(freeOnUnref(function(){t.onTick(!1),null!=e&&null!=t.playbackContext.mediaObject&&null!=t.volumeFeature&&t.volumeFeature.setMediaObject(t.playbackContext.mediaObject),t.droppedVideoFramesOfCurrentMedia=0,t.reportDiagnostics()})).catch(freeOnUnref(function(e){t.reportDiagnostics(),e instanceof lt.CancelError||t.onFatalError(e)}))}),enumerable:!0,configurable:!0}),e.prototype.destroy=freeOnUnref(function(){var e=this;this.attachActivity.attach(null).then(freeOnUnref(function(){null!=e.volumeFeature&&e.volumeFeature.destroy(),e.playbackContext.mediaObjectPool.shutdown(),e.reportDiagnostics()}))}),Object.defineProperty(e.prototype,"mediaKeys",{get:freeOnUnref(function(){return this.attachedMediaKeys}),enumerable:!0,configurable:!0}),e.prototype.setMediaKeys=freeOnUnref(function(i){var o=this;return this.attachingMediaKeys?lt.Promise.reject(new Error("setMediaKeys is already in progress.")):this.attachedMediaKeys===i?lt.Promise.resolve():(this.attachingMediaKeys=!0,this.reportDiagnostics(),new lt.Promise(freeOnUnref(function(t,n){if(null!==o.attachedMediaKeys)return o.attachingMediaKeys=!1,o.reportDiagnostics(),void n(new Error("Detaching a MediaKeys from a MediaPlayer is not supported"));var r=null===i?null:i;(null===r?lt.Promise.resolve(null):r.systemPromise).then(freeOnUnref(function(e){o.setDrmSystem(e).then(freeOnUnref(function(){null!=r&&r.attach({ensureDrmSessionNotInUse:o.ensureSessionNotInUse}),o.playbackContext.keyStore.setMediaKeys(r),o.attachedMediaKeys=i,o.attachingMediaKeys=!1,o.reportDiagnostics(),t()}),freeOnUnref(function(e){o.attachedMediaKeys=null,o.attachingMediaKeys=!1,o.reportDiagnostics(),n(e)}))}),freeOnUnref(function(e){o.attachedMediaKeys=null,o.attachingMediaKeys=!1,o.reportDiagnostics(),n(e)}))})))}),e.prototype.on=freeOnUnref(function(e,t){this.playbackContext.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.playbackContext.eventEmitter.off(e,t)}),e.prototype.pause=freeOnUnref(function(){this.stateMachine.pause(),this.reportDiagnostics()}),e.prototype.play=freeOnUnref(function(){var e=this.playbackContext.pendingPlayStore.add();return this.stateMachine.play(),this.reportDiagnostics(),e}),Object.defineProperty(e.prototype,"playbackRate",{get:freeOnUnref(function(){return 1}),set:freeOnUnref(function(e){i.warn("setPlaybackRate is not supported")}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suggestedPictureModes",{get:freeOnUnref(function(){return this.playbackContext.suggestedPictureModes}),set:freeOnUnref(function(e){this.playbackContext.suggestedPictureModes=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mediaPlayerConfig",{set:freeOnUnref(function(e){this.playbackContext.mediaPlayerConfig=e}),enumerable:!0,configurable:!0}),e.prototype.getVideoPlaybackQuality=freeOnUnref(function(){if(null===this.playbackContext.mediaObject||0===this.playbackContext.mediaObject.mediaControl.state||5===this.playbackContext.mediaObject.mediaControl.state||4===this.playbackContext.mediaObject.mediaControl.state)return{creationTime:Date.now(),droppedVideoFrames:this.droppedVideoFramesOfCurrentMedia,totalVideoFrames:-1};try{this.droppedVideoFramesOfCurrentMedia+=this.playbackContext.mediaObject.mediaControl.getDiagnosticInfo().numVideoDroppedFrames,this.reportDiagnostics()}catch(e){return i.warn("Fail to get diagnostic info",e),null}return{creationTime:Date.now(),droppedVideoFrames:this.droppedVideoFramesOfCurrentMedia,totalVideoFrames:-1}}),Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){return this.volumeFeature}),enumerable:!0,configurable:!0}),e.prototype.show=freeOnUnref(function(){}),e.prototype.hide=freeOnUnref(function(){}),e.prototype.reportDiagnostics=freeOnUnref(function(){var e={attachingMediaKeys:this.attachingMediaKeys,droppedVideoFramesOfCurrentMedia:this.droppedVideoFramesOfCurrentMedia,playbackContextState:{defaultPlaybackStartPositionMs:this.playbackContext.defaultPlaybackStartPositionMs,error:this.playbackContext.error,hasAttachedMediaSource:null!=this.playbackContext.source,seeking:this.playbackContext.seeking,seekTargetPositionMs:this.playbackContext.seekTargetPositionMs,waitingForKeyEmitted:this.playbackContext.waitingForKeyEmitted},timestamp:Date.now()};this.diagnostics.report("state",e)}),e.prototype.setDrmSystem=freeOnUnref(function(e){var r=this;return new lt.Promise(freeOnUnref(function(t,n){null===e||null===r.playbackContext.mediaObject||e===r.playbackContext.mediaObject.attachedDrmSystem?(r.playbackContext.drmSystem=e,t()):r.playbackContext.mediaObject.mediaControl.setDrmSystem(e,freeOnUnref(function(e){null!=e?n(e):t()}))}))}),e})();t.MediaPlayerElementaryStream=n}));e(ik);ik.MediaPlayerElementaryStream;var ok=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaPlayer=ik.MediaPlayerElementaryStream}));e(ok);ok.MediaPlayer;var ak=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.MAX_PLAY_HEAD_GAP_ALLOWED_MS=1;t.NATIVE_TIMESTAMP_PADDING_SEC=0}));e(ak);ak.MAX_PLAY_HEAD_GAP_ALLOWED_MS,ak.NATIVE_TIMESTAMP_PADDING_SEC;var sk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){var n=this;this.contentSource=null,this.fcsBufferInformationCalculator=null,this.streamTypes=[],this.positionMs=null,this.getBufferedRanges=freeOnUnref(function(e){return null===n.fcsBufferInformationCalculator?new In.NumberLine:n.fcsBufferInformationCalculator.getBufferedRanges(e).union(n.contentLevelAdapter.getBufferedRanges(e))}),this.getInMemoryBufferedRanges=freeOnUnref(function(e){return null===n.fcsBufferInformationCalculator?new In.NumberLine:n.fcsBufferInformationCalculator.getBufferedRanges(e)}),this.getSourceBufferedRanges=freeOnUnref(function(e){return n.contentLevelAdapter.getBufferedRanges(e)}),this.mediaPlayer=e,this.contentLevelAdapter=t}return e.prototype.load=freeOnUnref(function(e){this.contentSource=e,this.streamTypes=e.streamTypes,this.fcsBufferInformationCalculator=e.getBufferInformationCalculator()}),e.prototype.unload=freeOnUnref(function(){this.contentSource=null,this.fcsBufferInformationCalculator=null}),e.prototype.onPosition=freeOnUnref(function(e){this.positionMs=e}),e.prototype.getAggregateBufferedRanges=freeOnUnref(function(e){void 0===e&&(e=this.streamTypes);for(var t=null,n=0,r=e;n<r.length;n++){var i=r[n];if(this.isActiveStream(i)){var o=this.getBufferedRanges(i);t=null!=t?t.intersection(o):o}}return null==t?new In.NumberLine:t}),e.prototype.getFrontBufferLengthMs=freeOnUnref(function(e){if(void 0===e&&(e=this.streamTypes),null===this.positionMs)return 0;var t=this.getAggregateBufferedRanges(e).find(this.positionMs,ak.MAX_PLAY_HEAD_GAP_ALLOWED_MS);return null!=t?t.end-this.positionMs:0}),e.prototype.isBufferedToEnd=freeOnUnref(function(e){if(void 0===e&&(e=this.streamTypes),null===this.fcsBufferInformationCalculator)return!1;for(var t=!0,n=1e3*this.mediaPlayer.currentTime,r=0,i=e;r<i.length;r++){var o=i[r];if(this.isActiveStream(o)){var a=n;if(null!=this.contentSource&&this.contentSource.flushConsumedFragments){var s=this.contentLevelAdapter.getBufferedRanges(o).find(n,ak.MAX_PLAY_HEAD_GAP_ALLOWED_MS);null!=s&&(a=s.end)}t=t&&this.fcsBufferInformationCalculator.isBufferedToEnd(a,o)}}return t}),e.prototype.getBufferInformation=freeOnUnref(function(){var e=1e3*this.mediaPlayer.currentTime,t=null!=this.fcsBufferInformationCalculator?this.fcsBufferInformationCalculator.getBufferInformation(e):null;return this.getBufferInformationForBufferType(this.getBufferedRanges,e,t)}),e.prototype.getInMemoryBufferInformation=freeOnUnref(function(){var e=1e3*this.mediaPlayer.currentTime,t=null!=this.fcsBufferInformationCalculator?this.fcsBufferInformationCalculator.getBufferInformation(e):null;return this.getBufferInformationForBufferType(this.getInMemoryBufferedRanges,e,t)}),e.prototype.getSourceBufferInformation=freeOnUnref(function(){var e=1e3*this.mediaPlayer.currentTime;return this.getBufferInformationForBufferType(this.getSourceBufferedRanges,e)}),e.prototype.getBufferInformationForBufferType=freeOnUnref(function(e,t,n){for(var r={},i=0,o=this.streamTypes;i<o.length;i++){var a=o[i],s=e(a).find(t,ak.MAX_PLAY_HEAD_GAP_ALLOWED_MS),l=null!=s?s.end:t,f=null!=s?s.start:t;r[a]={front:{startTimeMs:t,endTimeMs:l,sizeBytes:null!=n?n[a].front.sizeBytes:0},back:{startTimeMs:f,endTimeMs:t,sizeBytes:null!=n?n[a].back.sizeBytes:0}}}return r}),e.prototype.isActiveStream=freeOnUnref(function(e){return null!==this.contentSource&&0<=this.contentSource.activeStreamTypes.indexOf(e)}),e})();t.MpPlayerBufferInfoProvider=n}));e(sk);sk.MpPlayerBufferInfoProvider;var lk=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.Initialize=0]="Initialize",e[e.Initialized=1]="Initialized",e[e.CreateFragmentLoaders=2]="CreateFragmentLoaders",e[e.AttachContent=3]="AttachContent",e[e.Ready=4]="Ready",e[e.DetachContent=5]="DetachContent",e[e.Stop=6]="Stop",e[e.Uninitialize=7]="Uninitialize",e[e.Error=8]="Error"})(n||(n={})),t.MSEWrapperAction=n}));e(lk);lk.MSEWrapperAction;var fk=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized",e[e.NeedsContent=3]="NeedsContent",e[e.Loading=4]="Loading",e[e.Ready=5]="Ready",e[e.Error=6]="Error"})(n||(n={})),t.MSEWrapperState=n}));e(fk);fk.MSEWrapperState;var uk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l="sourceopen",n=freeOnUnref(function(){function e(e,t){void 0===e&&(e=lt.Promise),void 0===t&&(t=Xb.MediaSource),this.promiseType=e,this.mediaSourceType=t}return e.prototype.createMediaSource=freeOnUnref(function(o,a){var s=this;return new this.promiseType(freeOnUnref(function(e,t){var n,r=new s.mediaSourceType,i=freeOnUnref(function(){r.removeEventListener(l,n)});n=freeOnUnref(function(){i(),e(r)}),a.promise.then(freeOnUnref(function(e){i(),t(e)})),r.addEventListener(l,n),o.mediaSource=r}))}),e})();t.MediaSourceFactory=n}));e(uk);uk.MediaSourceFactory;var ck=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){void 0===n&&(n=new uk.MediaSourceFactory);var i=this;this.cancelInitialize=null,this.doInitialize=freeOnUnref(function(e){var t=lt.CancelToken.source(),n=t.token,r=t.cancel;i.cancelInitialize=r,i.mediaSourceFactory.createMediaSource(i.stateContext.mediaPlayer,n).then(freeOnUnref(function(e){n.throwIfRequested(),(i.stateContext.mediaSource=e).addEventListener("sourceclose",i.onMediaSourceClosed),i.stateMachine.act(lk.MSEWrapperAction.Initialized)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||i.stateMachine.act(lk.MSEWrapperAction.Error,e)}))}),this.doUninitialize=freeOnUnref(function(e){null!=i.stateContext.mediaSource&&i.stateContext.mediaSource.removeEventListener("sourceclose",i.onMediaSourceClosed),null!==i.cancelInitialize&&(i.cancelInitialize(),i.cancelInitialize=null),i.stateContext.mediaPlayer.mediaSource=null,delete i.stateContext.mediaSource}),this.onMediaSourceClosed=freeOnUnref(function(){var e=i.stateContext.mediaSource;null!=e&&e.removeEventListener("sourceclose",i.onMediaSourceClosed),i.stateMachine.act(lk.MSEWrapperAction.Error,new ct.XpError("media.source_closed",void 0,"MediaSource unexpectedly closed"))}),this.stateMachine=e,this.stateContext=t,this.mediaSourceFactory=n}return e.prototype.initialize=freeOnUnref(function(){this.stateMachine.onTransition(fk.MSEWrapperState.Uninitialized,lk.MSEWrapperAction.Initialize,this.doInitialize),this.stateMachine.onTransition(fk.MSEWrapperState.Initializing,lk.MSEWrapperAction.Uninitialize,this.doUninitialize),this.stateMachine.onTransition(fk.MSEWrapperState.Initialized,lk.MSEWrapperAction.Uninitialize,this.doUninitialize),this.stateMachine.onTransition(fk.MSEWrapperState.NeedsContent,lk.MSEWrapperAction.Uninitialize,this.doUninitialize),this.stateMachine.onTransition(fk.MSEWrapperState.Error,lk.MSEWrapperAction.Uninitialize,this.doUninitialize)}),e})();t.InitializeHandler=n}));e(ck);ck.InitializeHandler;var dk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function n(e,t){this.name="FrontBufferLoadBarrier",this.type=e,this.frontBufferSizeCallback=t,this.maxFrontBufferSizeMs=n.getMaxFrontBufferSizeMs()}return n.getMaxFrontBufferSizeMs=freeOnUnref(function(){var e=L.configurationStore.configuration;return null!=e&&null!=e.fragmentLoaders&&null!=e.fragmentLoaders.sourceBufferFrontBufferLengthOverrideMs?e.fragmentLoaders.sourceBufferFrontBufferLengthOverrideMs:null!=zt.deviceInformation.mediaSource&&null!=zt.deviceInformation.mediaSource.requestedFrontBufferLengthMs?zt.deviceInformation.mediaSource.requestedFrontBufferLengthMs:6e3}),n.prototype.destroy=freeOnUnref(function(){}),n.prototype.canLoadSegment=freeOnUnref(function(e){if(e.isInitSegment)return{canLoad:!0};var t=this.frontBufferSizeCallback();return t<=this.maxFrontBufferSizeMs?{canLoad:!0}:{canLoad:!1,reason:"Front buffer size("+t+"ms) > max front buffer size("+this.maxFrontBufferSizeMs+"ms)"}}),n.prototype.onStateChanged=freeOnUnref(function(e){}),n.prototype.offStateChanged=freeOnUnref(function(e){}),n})();t.FrontBufferLoadBarrier=n}));e(dk);dk.FrontBufferLoadBarrier;var pk=t(freeOnUnref(function(e,t){var n,r,i,o;Object.defineProperty(t,"__esModule",{value:!0});var a=((n={}).Audio={leading:-90,lagging:185},n.Video={leading:0,lagging:0},n.TimedText={leading:-1/0,lagging:-1/0},n);t.ACCEPTABLE_DRIFT_RANGES_MS=a;var s=((r={}).Audio={leading:-45,lagging:125},r.Video={leading:0,lagging:0},r.TimedText={leading:-1/0,lagging:-1/0},r);t.DETECTABLE_DRIFT_RANGES_MS=s;var l=((i={}).Audio={leading:-20,lagging:40},i.Video={leading:0,lagging:0},i.TimedText={leading:-1/0,lagging:-1/0},i);t.SUBCONSCIOUSLY_DISTURBING_DRIFT_RANGES_MS=l;var f=((o={}).Audio={leading:-1e3,lagging:1e3},o.Video={leading:0,lagging:0},o.TimedText={leading:-1/0,lagging:-1/0},o);t.INCONCEIVABLE_DRIFT_RANGES_MS=f}));e(pk);pk.ACCEPTABLE_DRIFT_RANGES_MS,pk.DETECTABLE_DRIFT_RANGES_MS,pk.SUBCONSCIOUSLY_DISTURBING_DRIFT_RANGES_MS,pk.INCONCEIVABLE_DRIFT_RANGES_MS;var hk=t(freeOnUnref(function(e,t){function r(e,t){return e.leading<=t&&t<=e.lagging}Object.defineProperty(t,"__esModule",{value:!0}),t.newlyBreachesRange=function(e,t,n){return r(e,t)&&!r(e,n)}}));e(hk);hk.newlyBreachesRange;var mk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.log=new Ka.EphemeralJSLogger("DriftTracker"),this.streamType=e,this.log.setId(e),this.currentDriftMs=0}return e.prototype.getDriftMs=freeOnUnref(function(){return this.currentDriftMs}),e.prototype.reset=freeOnUnref(function(){this.currentDriftMs=0}),e.prototype.updateDrift=freeOnUnref(function(e,t){var n=t-e;if(1<n){var r=this.currentDriftMs;this.currentDriftMs+=-n;var i="Stream drift change: "+r+"ms -> "+this.currentDriftMs+"ms";this.log.info(i+" after applying a gap of "+n+"ms");var o=!1,a=pk.SUBCONSCIOUSLY_DISTURBING_DRIFT_RANGES_MS[this.streamType];hk.newlyBreachesRange(a,r,this.currentDriftMs)&&this.log.info(i+"; now in detectable range ["+JSON.stringify(a)+"]");var s=pk.DETECTABLE_DRIFT_RANGES_MS[this.streamType];hk.newlyBreachesRange(s,r,this.currentDriftMs)&&(q.metrics.putMetric("Media.DetectableDrift."+this.streamType),this.log.warn(i+"; now in detectable range ["+JSON.stringify(s)+"]"));var l=pk.ACCEPTABLE_DRIFT_RANGES_MS[this.streamType];hk.newlyBreachesRange(l,r,this.currentDriftMs)&&(q.metrics.putMetric("Media.UnacceptableDrift."+this.streamType),this.log.error(i+"; now in unacceptable range ["+JSON.stringify(l)+"]."),o=!0);var f=pk.INCONCEIVABLE_DRIFT_RANGES_MS[this.streamType];return hk.newlyBreachesRange(f,r,this.currentDriftMs)&&(q.metrics.putMetric("Media.InconceivableDrift."+this.streamType),this.log.error(i+"; now in inconceivable range ["+JSON.stringify(f)+"]."),o=!0),o}if(n<-1&&this.currentDriftMs<0){var u=-Math.max(n,this.currentDriftMs);this.currentDriftMs+=u,this.log.info("Drift is "+this.currentDriftMs+"ms after applying a recover value of "+u+"ms")}return!1}),e})();t.DriftTracker=n}));e(mk);mk.DriftTracker;var yk=t(freeOnUnref(function(e,t){function o(e,t){return"number"!=typeof t||isFinite(t)&&!isNaN(t)?t:t.toString()}Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s){void 0===a&&(a=null),void 0===s&&(s=6e3);var C=this;this.log=new Ka.EphemeralJSLogger("FragmentLoader"),this.fragmentHeaderLogger=new Ka.EphemeralJSLogger("FragmentLoader.FragmentHeader"),this.sourceBufferLoadMonitor=null,this.barriers=[],this.fragmentSource=null,this.encrypted=!1,this.needsInitSegment=!1,this.currentPeriodId=null,this.currentStreamId=null,this.currentQualityId=null,this.lastAppendedSegment=null,this.bufferedIntervalsBeforeAppend=null,this.emittedFinalSegment=!1,this.isAppending=!1,this.pendingAction="None",this.isFinalSegmentLoaded=!1,this.waiting=!0,this.backBufferSizeMs=6e3,this.lastTrimToLimitSec=null,this.skippedSegmentRanges=new In.NumberLine(1),this.appendBufferTimerStartMs=null,this.pendingFlushPositionMs=null,this.updateAgain=!1,this.updateActive=!1,this.update=freeOnUnref(function(){if(C.updateActive)return C.log.error("Update was called while updateActive is true!",(new Error).stack),void(C.updateAgain=!0);var e=!1;try{if(C.updateActive=!0,null==C.fragmentSource)return void C.emitState();if(null==C.sourceBuffer)return void C.emitState();if("closed"===C.mediaSource.readyState)return C.log.warn("Parent MediaSource has been closed."),void C.emitState();if(C.getFrontBufferSizeMs()<500&&!C.isFinalSegmentLoaded?C.waiting||(C.waiting=!0,C.eventEmitter.emit("waiting")):C.waiting&&(C.waiting=!1,C.eventEmitter.emit("buffered")),C.sourceBuffer.updating)return void C.emitState();var t=C.sourceBuffer.buffered;if(C.isAppending){C.isAppending=!1,C.checkSourceBufferGap(),C.state.lastFragmentAppended=C.state.lastFragmentAttempted,C.state.lastFragmentAttempted=void 0;var n=Date.now(),r=n-C.appendBufferTimerStartMs;if(C.appendBufferTimerStartMs=null,C.eventEmitter.emit("progress",{fragment:C.lastAppendedSegment,backBufferStartSeconds:0<t.length?t.start(0):null,appendTimeMs:r}),C.eventEmitter.emit("fragmentConsumed",C.lastAppendedSegment),C.log.enabledFor(0)&&C.log.info("Finished appending segment "+C.lastAppendedSegment.index+" at "+JSON.stringify(C.lastAppendedSegment.position)+" with an extra offset of "+C.driftTracker.getDriftMs()+"ms. SourceBuffer buffered ranges are now "+JSON.stringify(C.getBufferedRanges().getIntervals())),C.log.enabledFor(0)){var i={type:C.streamType+": FragmentLoader",startTime:new Date(n-r).toISOString(),endTime:new Date(n).toISOString(),index:C.lastAppendedSegment.index,durationMs:C.lastAppendedSegment.position.durationMs,sizeBytes:null!=C.lastAppendedSegment.data?C.lastAppendedSegment.data.byteLength:null,bitrate:C.lastAppendedSegment.bitrateBps};C.log.info(JSON.stringify(i))}}if("ResetAndFlush"===C.pendingAction)return C.log.info("Attempting a reset and flush"),C.doResetAndFlush(),void C.emitState();"Reset"===C.pendingAction&&(C.log.info("Attempting a reset"),C.doReset(),C.emitState());var o=C.positionTracker.getPositionMs();if(0<t.length&&o<1e3*t.start(0)-ak.MAX_PLAY_HEAD_GAP_ALLOWED_MS){if(!C.isBuffered(o))return void(e=!0);if("Video"===C.streamType){var a=1e3*t.start(0);C.log.warn("positionMs("+o+"ms) is outside of the buffered ranges("+JSON.stringify(C.getBufferedRanges().getIntervals())+"). Setting it to "+a),C.eventEmitter.emit("positionBump",a),C.emitState(),o=a}else if("Audio"===C.streamType)return void(e=!0)}var s=void 0;if(C.isFinalSegmentLoaded)C.emittedFinalSegment||(C.eventEmitter.emit("finalFragmentLoaded"),C.emittedFinalSegment=!0),C.state.lastFragmentAttemptedBlockedReason="Already loaded final segment",s=null;else{if(C.trimBuffer())return void C.emitState();if(null!==C.lastAppendedSegment)null==(s=C.fragmentSource.getNextFragment(C.lastAppendedSegment))&&(C.state.lastFragmentAttemptedBlockedReason="No next segment available yet");else{if(null==(s=C.fragmentSource.getFragmentAt(o))&&"Audio"===C.streamType&&(C.log.info("couldn't find "+C.streamType+" fragment at "+o+", searching with acceptable position error margin "+C.acceptableSegmentPositionErrorMs),null!=(s=C.fragmentSource.getFragmentAt(o+C.acceptableSegmentPositionErrorMs)))){var l=o-s.position.startTimeMs;C.log.info("found "+C.streamType+" fragment for "+o+" with drift "+l),C.driftTracker.updateDrift(o,s.position.startTimeMs)}C.log.enabledFor(0)&&C.log.info(C.streamType+": FragmentLoader - update, segment: "+s+", positionMs: "+C.positionTracker.getPositionMs()),null==s&&(C.state.lastFragmentAttemptedBlockedReason="No segment at position "+o)}}if(null!=s){C.state.lastFragmentAttempted={periodId:s.periodId,streamId:s.streamId,qualityId:s.qualityLevelId,index:s.index,startMs:s.position.startTimeMs,endMs:s.position.endTimeMs,timestamp:Date.now()},C.sourceBuffer.setFragmentMetadata(s),C.bufferedIntervalsBeforeAppend=C.getBufferedRanges().getIntervals(),C.encrypted||null==s.keyId||(C.encrypted=!0,C.eventEmitter.emit("encrypted"));var f=C.canLoadSegment(s);if(f.canLoad){C.fragmentSource.lockFragment(s);var u=s.periodId,c=s.streamId,d=s.qualityLevelId,p=u!==C.currentPeriodId||c!==C.currentStreamId||d!==C.currentQualityId;if(C.needsInitSegment=C.needsInitSegment||p,C.currentPeriodId=u,C.currentStreamId=c,C.currentQualityId=d,p&&null!=C.lastAppendedSegment&&C.appendBitrateSwitchSegment(s))return void C.emitState();if(p){var h=C.fragmentSource.getStitchingInformation(u,c,d),m=s.position.startTimeMs,y=h.appendWindowStartMs;if(null!=C.lastAppendedSegment){var g=C.lastAppendedSegment.position.endTimeMs+C.driftTracker.getDriftMs(),v=C.sourceBuffer.buffered,O=0<v.length?1e3*v.end(v.length-1):0;(O<y||g<y)&&(y=Math.min(O,g)),m+=C.driftTracker.getDriftMs();var S=C.driftTracker.getDriftMs(),U=C.driftTracker.updateDrift(g,m);C.resetOnUnacceptableDrift&&U&&null===C.pendingFlushPositionMs&&(0!==S?(C.log.error("Pending reset at "+m+"ms to remove drift"),C.pendingFlushPositionMs=m):C.log.warn("Not flushing as single-fragment drift is too much"))}var b=Math.max((y-5)/1e3,0),P=(h.appendWindowEndMs+5)/1e3;b>=C.sourceBuffer.appendWindowEnd?(C.sourceBuffer.appendWindowEnd=P,C.sourceBuffer.appendWindowStart=b):(C.sourceBuffer.appendWindowStart=b,C.sourceBuffer.appendWindowEnd=P),C.sourceBuffer.timestampOffset=(h.timestampOffsetMs+C.driftTracker.getDriftMs())/1e3,C.state.lastAppliedStitchingInfo={timestampOffsetMs:1e3*C.sourceBuffer.timestampOffset,appendWindowStartMs:1e3*b,appendWindowEndMs:1e3*P}}if(C.state.lastFragmentAttempted.stitchingInfo=C.state.lastAppliedStitchingInfo,C.needsInitSegment)return C.appendInitSegment(u,c,d,s.index),void C.emitState();if(null==s.data)return C.skippedSegmentRanges.add({start:s.position.startTimeMs,end:s.position.endTimeMs}),C.lastAppendedSegment=s,C.updateAgain=!0,void C.emitState();if(C.appendBuffer(s.data)){if(C.isAppending=!0,C.state.lastFragmentAttemptedBlockedReason=void 0,"Video"!==C.streamType&&null!==C.lastAppendedSegment){var M=s.position.startTimeMs-C.lastAppendedSegment.position.endTimeMs;1<M&&M<=50&&C.log.warn("Buffer gap found and will be collapsed. start: "+C.lastAppendedSegment.position.endTimeMs+" ms, end: "+s.position.startTimeMs+" ms, length: "+M+" ms")}return C.lastAppendedSegment=s,C.setBackBufferSize(Math.max(s.position.durationMs,C.backBufferSizeMs)),s.isFinalSegment&&(C.isFinalSegmentLoaded=!0),void C.emitState()}C.state.lastFragmentAttemptedBlockedReason="QUOTA_EXCEEDED_ERR from appendBuffer"}else C.state.lastFragmentAttemptedBlockedReason=f.reason}else!C.isFinalSegmentLoaded&&null!==C.lastAppendedSegment&&C.fragmentSource.isFinalSegment(C.lastAppendedSegment)&&(C.state.lastFragmentAttemptedBlockedReason="Previous segment appended was the final segment",C.isFinalSegmentLoaded=!0);!C.emittedFinalSegment&&C.isFinalSegmentLoaded&&(C.eventEmitter.emit("finalFragmentLoaded"),C.emittedFinalSegment=!0),C.eventEmitter.emit("idle"),C.emitState()}finally{C.updateActive=!1,C.updateAgain?(C.updateAgain=!1,oe.timer.setImmediate(C.update)):e&&oe.timer.setImmediate(freeOnUnref(function(){return C.reset()}))}}),this.getFrontBufferSizeMs=freeOnUnref(function(){if("None"!==C.pendingAction)return 0;if("closed"===C.mediaSource.readyState)return 0;var e=C.positionTracker.getPositionMs(),t=C.getBufferedRanges().find(e,ak.MAX_PLAY_HEAD_GAP_ALLOWED_MS);return null===t?0:t.end-e}),this.onSourceBufferError=freeOnUnref(function(e){C.log.error("Source buffer has raised an error",e),C.eventEmitter.emit("nonfatalError",new Error("Source buffer for type "+C.streamType+" has raised an error"))}),this.streamType=e,this.mediaSource=t,this.sourceBuffer=n,this.positionTracker=r,this.acceptableSegmentPositionErrorMs=i,"TimedText"!==this.streamType&&(this.sourceBufferLoadMonitor=o.registerStreamType(this.streamType)),this.bufferSizeBarrier=a,this.setBackBufferSize(s),this.frontBufferBarrier=new dk.FrontBufferLoadBarrier(e,this.getFrontBufferSizeMs),this.eventEmitter=new A.EventEmitter,this.state={lastKnownPositionMs:r.getPositionMs(),sourceBufferUpdating:!1,mediaSourceReadyState:"closed",buffered:[],timestamp:Date.now()},this.log.setId(this.streamType),this.fragmentHeaderLogger.setId(this.streamType),this.diagnostics=nn.Diagnostics.create("FragmentLoader."+this.streamType),this.driftTracker=new mk.DriftTracker(e),this.resetOnUnacceptableDrift=!1;var l=L.configurationStore.configuration;null!=l&&null!=l.fragmentLoaders&&(this.resetOnUnacceptableDrift=!0===l.fragmentLoaders.resetOnUnacceptableDrift)}return e.prototype.setBackBufferSize=freeOnUnref(function(e){this.backBufferSizeMs=Math.max(e,6e3)}),e.prototype.initialize=freeOnUnref(function(){this.sourceBuffer.addEventListener("update",this.update),this.sourceBuffer.addEventListener("error",this.onSourceBufferError)}),e.prototype.uninitialize=freeOnUnref(function(){this.stop(),this.frontBufferBarrier.destroy(),this.sourceBuffer.removeEventListener("update",this.update),this.sourceBuffer.removeEventListener("error",this.onSourceBufferError)}),e.prototype.prepare=freeOnUnref(function(e){void 0===e&&(e=[]),this.barriers=e.slice(),this.barriers.push(this.frontBufferBarrier),this.bufferSizeBarrier;for(var t=0,n=this.barriers;t<n.length;t++){n[t].onStateChanged(this.update)}}),e.prototype.stop=freeOnUnref(function(){if(this.detachContent(),null!=this.barriers)for(var e=0,t=this.barriers;e<t.length;e++){t[e].offStateChanged(this.update)}this.isAppending=!1,this.emittedFinalSegment=!1,this.pendingAction="None",this.waiting=!0}),e.prototype.attachContent=freeOnUnref(function(e,t){this.fragmentSource=e,null!=t&&this.log.setId(t,this.streamType),this.reset()}),e.prototype.detachContent=freeOnUnref(function(){this.reset(),this.encrypted=!1,this.currentPeriodId=null,this.currentStreamId=null,this.currentQualityId=null,this.lastAppendedSegment=null,this.waiting=!1,this.fragmentSource=null,this.skippedSegmentRanges=new In.NumberLine(1),this.log.setId(this.streamType)}),e.prototype.reset=freeOnUnref(function(e){void 0===e&&(e=!0),this.pendingAction=e?"ResetAndFlush":"Reset",this.isFinalSegmentLoaded=!1,this.emittedFinalSegment=!1,this.requestUpdate()}),e.prototype.isBuffered=freeOnUnref(function(e){return"ResetAndFlush"!==this.pendingAction&&("closed"!==this.mediaSource.readyState&&(null!==this.getBufferedRanges().find(e,Math.max(this.acceptableSegmentPositionErrorMs,1))||null!==this.lastAppendedSegment&&(gf.SegmentPosition.contains(this.lastAppendedSegment.position,e)||gf.SegmentPosition.contains(this.lastAppendedSegment.position,e+this.acceptableSegmentPositionErrorMs))))}),e.prototype.updatePosition=freeOnUnref(function(){if(null!=this.fragmentSource){var e=this.positionTracker.getPositionMs();if(null!=this.pendingFlushPositionMs&&e>=this.pendingFlushPositionMs)return this.log.warn("Resetting to remove drift"),void this.reset();var t=!0;"ResetAndFlush"===this.pendingAction?t=!1:null===this.lastAppendedSegment?t=!1:this.isBuffered(e)?t=!1:this.isFinalSegmentLoaded&&e>=this.lastAppendedSegment.position.endTimeMs?t=!1:e-this.lastAppendedSegment.position.endTimeMs<2e3&&e>=this.lastAppendedSegment.position.endTimeMs&&this.fragmentSource.isDownloadingRange(this.lastAppendedSegment.position.endTimeMs,e)&&(t=!1),t?(null===this.lastAppendedSegment?this.log.error("Trying to reset when last segment was null"):this.log.info("Seek detected -- flushing buffer\n\t :: lastKnownPositionMs="+e+"\n\t :: buffered="+JSON.stringify(this.getBufferedRanges().getIntervals())+"\n\t :: lastAppendedSegment.end="+this.lastAppendedSegment.position.endTimeMs+"\n\t :: finalSegmentLoaded="+this.isFinalSegmentLoaded+"\n\t :: isDownloadingRange("+this.lastAppendedSegment.position.endTimeMs+", "+e+"): "+this.fragmentSource.isDownloadingRange(this.lastAppendedSegment.position.endTimeMs,e)),this.reset()):this.requestUpdate()}}),e.prototype.isUpdating=freeOnUnref(function(){return"None"!==this.pendingAction||null==this.sourceBuffer||this.sourceBuffer.updating}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.getBufferedRanges=freeOnUnref(function(e){void 0===e&&(e=!1);var t=new In.NumberLine("Video"===this.streamType?1:50);if("ResetAndFlush"===this.pendingAction)return t;if(null==this.sourceBuffer)return t;if("closed"===this.mediaSource.readyState)return this.log.warn("mediaSource is closed -- returning empty buffered ranges"),t;for(var n=this.sourceBuffer.buffered,r=!1,i=0;i<n.length;i++){var o={start:1e3*n.start(i),end:1e3*n.end(i)};o.start<o.end?t.add(o):r=!0}return r&&this.saveInvalidBufferedRangesToState(n),e&&this.sourceBuffer.updating&&null!==this.lastAppendedSegment&&t.add({start:this.lastAppendedSegment.position.startTimeMs,end:this.lastAppendedSegment.position.endTimeMs}),this.skippedSegmentRanges.union(t)}),e.prototype.doResetAndFlush=freeOnUnref(function(){this.pendingAction="None",this.lastAppendedSegment=null,this.isAppending=!1,this.isFinalSegmentLoaded=!1,this.skippedSegmentRanges=new In.NumberLine(1),this.driftTracker.reset(),this.pendingFlushPositionMs=null,this.state.lastFragmentAppended=void 0,this.state.lastFragmentAttempted=void 0,this.state.lastFragmentAttemptedBlockedReason=void 0,this.state.invalidBufferedInterval=void 0,this.currentPeriodId=null,this.currentStreamId=null,this.currentQualityId=null;var e=this.sourceBuffer.buffered;if(0<e.length){var t=e.start(0),n=e.end(e.length-1);try{this.sourceBuffer.remove(t,n),this.state.lastSourceBufferOperation="remove",this.lastTrimToLimitSec=null,this.eventEmitter.emit("flushed"),this.log.info("Flushed buffer")}catch(e){this.log.error("doFlush SourceBuffer.remove("+t+", "+n+") failed:",e,this.getSimpleStateString()),this.updateAgain=!0}}else this.updateAgain=!0}),e.prototype.doReset=freeOnUnref(function(){this.log.info("doReset is called"),this.log.enabledFor(0)&&this.log.info(this.streamType+": FragmentLoader - doReset, lastAppendedSegment: "+this.lastAppendedSegment+", positionMs: "+this.positionTracker.getPositionMs()),this.pendingAction="None",this.lastAppendedSegment=null,this.currentPeriodId=null,this.currentStreamId=null,this.currentQualityId=null,this.isFinalSegmentLoaded=!1}),e.prototype.appendBuffer=freeOnUnref(function(e){try{return null!=e&&(this.sourceBuffer.appendBuffer(e),this.state.lastSourceBufferOperation="appendBuffer",this.appendBufferTimerStartMs=Date.now(),!0)}catch(e){return 22===e.code?this.trimBuffer(!0):(this.log.error("Fatal appendBuffer error:",e,this.getSimpleStateString()),this.eventEmitter.emit("fatalError",e)),!1}}),e.prototype.appendBitrateSwitchSegment=freeOnUnref(function(e){var t=this.fragmentSource.getBitrateSwitchFragment(this.lastAppendedSegment,e);return null!=t&&this.appendBuffer(t)}),e.prototype.appendInitSegment=freeOnUnref(function(e,t,n,r){var i=this.fragmentSource.getInitFragment(e,t,n);if(null!=i){this.state.lastFragmentAttempted={periodId:e,streamId:t,qualityId:n,index:"init",timestamp:Date.now()},this.encrypted||null==i.keyId||(this.encrypted=!0,this.eventEmitter.emit("encrypted"));var o=this.canLoadSegment(i);o.canLoad?(this.log.info("Appending init segment for period "+e+", quality "+n+", at media segment "+r),this.appendBuffer(i.data)&&(this.needsInitSegment=!1)):this.state.lastFragmentAttemptedBlockedReason=o.reason}else this.state.lastFragmentAttemptedBlockedReason="Init segment not available yet",this.log.info("Init segment for period "+e+", quality "+n+" not available yet.")}),e.prototype.canLoadSegment=freeOnUnref(function(e){for(var t=0,n=this.barriers;t<n.length;t++){var r=n[t],i=r.canLoadSegment(e);if(!i.canLoad)return{canLoad:!1,reason:"["+r.name+"] "+i.reason}}return{canLoad:!0}}),e.prototype.trimBuffer=freeOnUnref(function(e){if(void 0===e&&(e=!1),"ended"===this.mediaSource.readyState)return!1;var t=this.sourceBuffer.buffered;if(0===t.length)return!1;for(var n,r=this.positionTracker.getPositionMs(),i=null,o=0;o<t.length;o++)if(t.start(o)<t.end(o)){i=t.start(o);break}if(null===i)return this.log.error("Ignoring fully non-normalized buffered ranges"),!1;if(e)n=Math.min(i+30,(r-this.backBufferSizeMs)/1e3);else{if(r<this.backBufferSizeMs)return!1;n=(r-this.backBufferSizeMs)/1e3}if(n<=i)return!1;if(n-i<2)return!1;if(null!=this.lastTrimToLimitSec&&n-this.lastTrimToLimitSec<2)return!1;try{this.sourceBuffer.remove(0,n),this.state.lastSourceBufferOperation="remove",this.lastTrimToLimitSec=n}catch(e){return this.log.error("trimBuffer SourceBuffer.remove(0, "+n+") failed:",e,this.getSimpleStateString()),!1}return!0}),e.prototype.getBufferRegionIndexForPositionMs=freeOnUnref(function(e,t){for(var n=t/1e3,r=0;r<e.length;r++)if(e.start(r)<=n&&e.end(r)>n)return r;return null}),e.prototype.getSimpleStateString=freeOnUnref(function(){return"mediaSource.readyState: "+this.mediaSource.readyState+", sourceBuffer.updating:"+this.sourceBuffer.updating+", stack:"+(new Error).stack}),e.prototype.saveInvalidBufferedRangesToState=freeOnUnref(function(e){this.state.invalidBufferedInterval={timestamp:Date.now(),sourceBufferBuffered:function(e){for(var t=[],n=0;n<e.length;n++)t.push({start:1e3*e.start(n),end:1e3*e.end(n)});return t}(e)}}),e.prototype.emitState=freeOnUnref(function(){try{this.state.lastKnownPositionMs=this.positionTracker.getPositionMs(),this.state.sourceBufferUpdating=null==this.sourceBuffer||this.sourceBuffer.updating,this.state.mediaSourceReadyState=this.mediaSource.readyState,this.state.buffered=this.getBufferedRanges().getIntervals(),this.state.timestamp=Date.now(),this.diagnostics.report("state",this.state)}catch(e){this.log.warn("emitState() failed:",e,"mediaSource.readyState: "+this.mediaSource.readyState+", updating?: "+(null==this.sourceBuffer?"null":this.sourceBuffer.updating?"true":"false")+", stack: "+e.stack)}}),e.prototype.checkSourceBufferGap=freeOnUnref(function(){var e=this.getBufferedRanges().getIntervals();if(!(e.length<2||null!=this.bufferedIntervalsBeforeAppend&&e.length<=this.bufferedIntervalsBeforeAppend.length)){var t=this.state.lastFragmentAppended,n={gapSegment:t,sourceBufferIntervals:e};if(this.log.warn("New gap detected in the SourceBuffer: "+JSON.stringify(n,o,2)),null!=t&&null!=this.fragmentSource&&null!=t.startMs&&null!=t.endMs){var r=(t.startMs+t.endMs)/2,i=this.fragmentSource.getFragmentAt(r);null==i?this.log.warn("Segment at "+r+"ms already removed from FragmentSource"):null!=i.data&&this.logFragmentHeader(i.data)}}}),e.prototype.logFragmentHeader=freeOnUnref(function(e){var t=(new Ao.BmffParser).parseFragment(e),n=Ao.Boxes.find(t,Ao.Boxes.ofType("mdat"));if(null!=n){var r=e.slice(0,n.absoluteStartPosition);this.fragmentHeaderLogger.warn("Base64-encoded Header: "+Lr.encode(r))}else this.log.warn("Cannot find mdat")}),e.prototype.requestUpdate=freeOnUnref(function(){this.updateActive?(this.log.warn("requestUpdate called when an update is in progress"),this.updateAgain=!0):this.update()}),e})();t.FragmentLoader=n}));e(yk);yk.FragmentLoader;var gk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.bufferedSegments=[],this.totalSizeBytes=0,this.pendingSizeBytes=0,this.streamType=e,this.bufferedRangesCalculator=t}return e.prototype.destroy=freeOnUnref(function(){this.bufferedSegments=[]}),e.prototype.update=freeOnUnref(function(){if(0!==this.bufferedSegments.length){var e=this.bufferedRangesCalculator.getBufferedRanges(this.streamType).getIntervals();if(0===e.length)return this.bufferedSegments=[],void(this.totalSizeBytes=0);var t=e[0].start,n=Pn.binarySearchIndexOfClosestBelow(this.bufferedSegments,freeOnUnref(function(e){return t-e.position.endTimeMs}));if(!(this.bufferedSegments[n].position.endTimeMs>t)){for(var r=0,i=0,o=this.bufferedSegments.splice(0,n+1);i<o.length;i++){r+=o[i].sizeBytes}this.totalSizeBytes-=r}}}),e.prototype.appendCompleted=freeOnUnref(function(e){this.registerSegment(e,!1)}),e.prototype.appendStarted=freeOnUnref(function(e){this.registerSegment(e,!0)}),e.prototype.clearAppending=freeOnUnref(function(){this.pendingSizeBytes=0}),e.prototype.getSourceBufferSizeBytes=freeOnUnref(function(){return this.totalSizeBytes+this.pendingSizeBytes}),e.prototype.registerSegment=freeOnUnref(function(e,t){if(null!=e.data)if(t)this.pendingSizeBytes=e.data.byteLength;else{var n={position:e.position,sizeBytes:e.data.byteLength};this.bufferedSegments.push(n),this.totalSizeBytes+=n.sizeBytes,this.pendingSizeBytes=0}}),e})();t.SourceBufferLoadMonitor=n}));e(gk);gk.SourceBufferLoadMonitor;var vk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var t;this.bufferedRangesCalculator=e,this.streamMonitors=((t={}).Video=null,t.Audio=null,t.TimedText=null,t)}return e.prototype.registerStreamType=freeOnUnref(function(e){var t=new gk.SourceBufferLoadMonitor(e,this.bufferedRangesCalculator);return this.streamMonitors[e]=t}),e.prototype.deregisterStreamType=freeOnUnref(function(e){var t=this.streamMonitors[e];null!=t&&t.destroy(),this.streamMonitors[e]=null}),e.prototype.getSourceBufferSizeBytes=freeOnUnref(function(e){if(null!=e)return null==(i=this.streamMonitors[e])?0:i.getSourceBufferSizeBytes();for(var t=0,n=0,r=Object.keys(this.streamMonitors);n<r.length;n++){var i,o=r[n];null!==(i=this.streamMonitors[o])&&(t+=i.getSourceBufferSizeBytes())}return t}),e})();t.AggregateSourceBufferLoadMonitor=n}));e(vk);vk.AggregateSourceBufferLoadMonitor;var Ok=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r){this.name="BufferSizeLoadBarrier",this.streamType=e,this.useSeparateLimits=t,this.sourceBufferLoadMonitor=n,this.maxSourceBufferSizeBytes=r}return e.prototype.destroy=freeOnUnref(function(){}),e.prototype.canLoadSegment=freeOnUnref(function(e){var t=e.type;return t!==this.streamType?{canLoad:!0}:e.isInitSegment?{canLoad:!0}:null!=e.data?this.checkBufferSizeAndLimit(t,e.data.byteLength):{canLoad:!0}}),e.prototype.onStateChanged=freeOnUnref(function(e){}),e.prototype.offStateChanged=freeOnUnref(function(e){}),e.prototype.checkBufferSizeAndLimit=freeOnUnref(function(e,t){var n=this.sourceBufferLoadMonitor.getSourceBufferSizeBytes(this.useSeparateLimits?e:void 0);return n+t<=this.maxSourceBufferSizeBytes?{canLoad:!0}:{canLoad:!1,reason:"current size("+n+") + fragment size("+t+") > max size("+this.maxSourceBufferSizeBytes+")"}}),e})();t.BufferSizeLoadBarrier=n}));e(Ok);Ok.BufferSizeLoadBarrier;var Sk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var t=this;this.name="SlowSegmentLoadBarrier",this.stateChangedCallback=new A.MulticastCallback,this.fragmentLoaders=[],this.onProgress=freeOnUnref(function(){t.stateChangedCallback.invoke()}),this.maxDistanceToSlowestSegmentMs=e}return e.prototype.destroy=freeOnUnref(function(){for(var e=0,t=this.fragmentLoaders;e<t.length;e++){t[e].off("progress",this.onProgress)}this.fragmentLoaders=[]}),e.prototype.addFragmentLoader=freeOnUnref(function(e){this.fragmentLoaders.push(e),e.on("progress",this.onProgress)}),e.prototype.canLoadSegment=freeOnUnref(function(e){if(e.isInitSegment)return{canLoad:!0};for(var t,n=1/0,r=0,i=this.fragmentLoaders;r<i.length;r++){var o=i[r],a=o.getBufferedRanges(!0).bounds();null!==a&&(n>a.end&&(n=a.end,t=o.streamType))}return e.position.startTimeMs<=n+this.maxDistanceToSlowestSegmentMs?{canLoad:!0}:{canLoad:!1,reason:"Segment at "+e.position.startTimeMs+"ms more than "+this.maxDistanceToSlowestSegmentMs+" ahead of "+t+" buffer, ending at "+n+"ms"}}),e.prototype.onStateChanged=freeOnUnref(function(e){this.stateChangedCallback.add(e)}),e.prototype.offStateChanged=freeOnUnref(function(e){this.stateChangedCallback.remove(e)}),e})();t.SlowSegmentLoadBarrier=n}));e(Sk);Sk.SlowSegmentLoadBarrier;var Uk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){void 0===t&&(t=0),this.wrappedBuffer=e,this.timestampOffsetOverrideSec=t,this.wrappedBuffer.timestampOffset+=t}return Object.defineProperty(e.prototype,"audioTracks",{get:freeOnUnref(function(){return this.wrappedBuffer.audioTracks}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:freeOnUnref(function(){var t=this,n=this.wrappedBuffer.buffered;return{length:n.length,end:freeOnUnref(function(e){return Math.max(n.end(e)-t.timestampOffsetOverrideSec,0)}),start:freeOnUnref(function(e){return Math.max(n.start(e)-t.timestampOffsetOverrideSec,0)})}}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updating",{get:freeOnUnref(function(){return this.wrappedBuffer.updating}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textTracks",{get:freeOnUnref(function(){return this.wrappedBuffer.textTracks}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoTracks",{get:freeOnUnref(function(){return this.wrappedBuffer.videoTracks}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appendWindowEnd",{get:freeOnUnref(function(){return this.wrappedBuffer.appendWindowEnd-this.timestampOffsetOverrideSec}),set:freeOnUnref(function(e){this.wrappedBuffer.appendWindowEnd=Math.max(e+this.timestampOffsetOverrideSec,this.wrappedBuffer.appendWindowStart+1)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appendWindowStart",{get:freeOnUnref(function(){return Math.max(this.wrappedBuffer.appendWindowStart-this.timestampOffsetOverrideSec,0)}),set:freeOnUnref(function(e){this.wrappedBuffer.appendWindowStart=0===e?0:Math.max(e+this.timestampOffsetOverrideSec,0)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:freeOnUnref(function(){return this.wrappedBuffer.mode}),set:freeOnUnref(function(e){this.wrappedBuffer.mode=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timestampOffset",{get:freeOnUnref(function(){return this.wrappedBuffer.timestampOffset-this.timestampOffsetOverrideSec}),set:freeOnUnref(function(e){this.wrappedBuffer.timestampOffset=e+this.timestampOffsetOverrideSec}),enumerable:!0,configurable:!0}),e.prototype.abort=freeOnUnref(function(){throw new Error("Not implemented")}),e.prototype.appendStream=freeOnUnref(function(e,t){this.wrappedBuffer.appendStream(e,t)}),e.prototype.appendBuffer=freeOnUnref(function(e){this.wrappedBuffer.appendBuffer(e)}),e.prototype.setFragmentMetadata=freeOnUnref(function(e){}),e.prototype.remove=freeOnUnref(function(e,t){.01<e&&(e+=this.timestampOffsetOverrideSec),t+=this.timestampOffsetOverrideSec,this.wrappedBuffer.remove(Math.max(e,0),t)}),e.prototype.addEventListener=freeOnUnref(function(e,t,n){this.wrappedBuffer.addEventListener(e,t,n)}),e.prototype.removeEventListener=freeOnUnref(function(e,t){this.wrappedBuffer.removeEventListener(e,t)}),e.prototype.dispatchEvent=freeOnUnref(function(e){return this.wrappedBuffer.dispatchEvent(e)}),e})();t.TimeOffsettingSourceBuffer=n}));e(Uk);Uk.TimeOffsettingSourceBuffer;var bk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.decode=freeOnUnref(function(e){for(var t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=[],r=0;r<t.length;){var i=0,o=0,a=t[r++];if(240==(248&a))i=3,o=7&a;else if(224==(240&a))i=2,o=15&a;else if(192==(224&a))i=1,o=31&a;else{if(0!=(128&a))throw new TypeError("Failed to decode value: "+a.toString(16));i=0,o=127&a}for(;0<i&&r<t.length;)o<<=6,o|=63&t[r++],i--;if(0<i)throw new TypeError("Failed to decode value");if(65536<=o){var s=56320|1023&(o-=65536),l=55296|o>>10&1023;n.push(String.fromCharCode(l,s))}else n.push(String.fromCharCode(o))}return n.join("")}),e})();t.Utf8Decoder=n}));e(bk);bk.Utf8Decoder;var Pk=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8TextDecoder=n,"undefined"!=typeof TextDecoder?t.Utf8TextDecoder=n=freeOnUnref(function(){return new TextDecoder("utf-8")}):t.Utf8TextDecoder=n=bk.Utf8Decoder}));e(Pk);Pk.Utf8TextDecoder;var Mk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.textDecoder=new Pk.Utf8TextDecoder}return e.prototype.decode=freeOnUnref(function(e){return this.textDecoder.decode(e)}),e})();t.TextDecoderCodec=n}));e(Mk);Mk.TextDecoderCodec;var Ck=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.create=freeOnUnref(function(e){if(-1!==e.indexOf("stpp")||-1!==e.indexOf("wvtt"))return new Mk.TextDecoderCodec;throw new Error("Could not create Codec for mime-type '"+e+"'")}),e})();t.CodecFactory=n}));e(Ck);Ck.CodecFactory;var Ek=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.bufferedRanges=new In.NumberLine(.001),this.eventEmitter=new A.EventEmitter,this.trackCues=[]}return Object.defineProperty(e.prototype,"cues",{get:freeOnUnref(function(){return this.trackCues.slice()}),enumerable:!0,configurable:!0}),e.prototype.addCue=freeOnUnref(function(e){this.trackCues.push(e),this.trackCues=x.sortBy(this.cues,freeOnUnref(function(e){return e.startMs})),this.bufferedRanges.add({start:e.startMs,end:e.endMs}),this.eventEmitter.emit("cueupdate"),this.eventEmitter.emit("newcue",e)}),e.prototype.removeCues=freeOnUnref(function(n,r){var i=this;this.trackCues=this.trackCues.filter(freeOnUnref(function(e){var t=e.startMs<n||e.endMs>r;return t||i.bufferedRanges.remove({start:e.startMs,end:e.endMs}),t})),this.eventEmitter.emit("cueupdate")}),e.prototype.getDataAt=freeOnUnref(function(t){var e=Pn.binarySearchIndexOf(this.trackCues,freeOnUnref(function(e){return t<e.startMs?-1:e.startMs<=t&&t<e.endMs?0:1}));return-1!==e?this.trackCues[e].data:null}),Object.defineProperty(e.prototype,"bufferedIntervalsMs",{get:freeOnUnref(function(){return this.bufferedRanges.getIntervals()}),enumerable:!0,configurable:!0}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e})();t.ApplicationSpecificTrack=n}));e(Ek);Ek.ApplicationSpecificTrack;var Tk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("ApplicationSpecificSourceBuffer"),n=freeOnUnref(function(){function e(e,t){var n=this;this.timer=oe.timer,this.sourceBufferEmitter=new A.EventEmitter,this.timescale=1,this.trackId=null,this.lastInitSegment=null,this.applicationTrack=new Ek.ApplicationSpecificTrack,this.timestampOffset=0,this.updating=!1,this.appendWindowStart=0,this.appendWindowEnd=0,this.mode="segments",this.audioTracks=null,this.textTracks=null,this.videoTracks=null,this.expectedTrackType=t;var r=(new pi.MimeTypeParser).parse(e),i=(new Lb.SegmentParserFactory).createSegmentParser(r);if(null===i)throw new Error("Unsupported mimeType: "+r);this.segmentParser=i,this.codec=(new Ck.CodecFactory).create(e);var o=freeOnUnref(function(){return n.timeRanges.getIntervals().length});this.buffered={get length(){return o()},start:freeOnUnref(function(e){return n.timeRanges.getIntervals()[e].start}),end:freeOnUnref(function(e){return n.timeRanges.getIntervals()[e].end})},this.timeRanges=this.createNewTimeRanges()}return e.prototype.appendBuffer=freeOnUnref(function(e){var t=this;try{this.updating=!0;for(var n=this.segmentParser.parse(e,this.lastInitSegment),r=0,i=n;r<i.length;r++){var o=i[r];"init"===o.type?this.processInitSegment(o):"media"===o.type&&this.processMediaSegment(o)}this.timer.setImmediate(freeOnUnref(function(){t.updating=!1,t.dispatchEvent({type:"update"})}))}catch(e){this.mediaError("Failed to append buffer: "+e)}}),e.prototype.remove=freeOnUnref(function(e,t){this.applicationTrack.removeCues(1e3*e,1e3*t),this.timeRanges=this.createNewTimeRanges()}),e.prototype.addEventListener=freeOnUnref(function(e,t){this.sourceBufferEmitter.on(e,t)}),e.prototype.removeEventListener=freeOnUnref(function(e,t){this.sourceBufferEmitter.off(e,t)}),e.prototype.dispatchEvent=freeOnUnref(function(e){return this.sourceBufferEmitter.emit(e.type,e),!1}),e.prototype.abort=freeOnUnref(function(){}),e.prototype.appendStream=freeOnUnref(function(e,t){}),e.prototype.setFragmentMetadata=freeOnUnref(function(e){this.streamId=e.streamId,this.periodId=e.periodId}),e.prototype.processInitSegment=freeOnUnref(function(e){for(var t=0,n=x.values(e.tracks);t<n.length;t++){var r=n[t];if(r.type===this.expectedTrackType){this.trackId=r.trackId;break}}null!==this.trackId?(this.timescale=e.tracks[this.trackId].timescale,this.lastInitSegment=e):i.warn("Could not find trackId for expected track type "+this.expectedTrackType)}),e.prototype.processMediaSegment=freeOnUnref(function(e){if(null!==this.trackId){var t=e.tracks[this.trackId].sampleRuns[0].samples[0],n=this.timestampOffset+t.dts/this.timescale,r=n+t.duration/this.timescale,i=this.decodeSampleData(t.data);if(null!==i){this.applicationTrack.addCue({startMs:1e3*n,endMs:1e3*r,data:i,timeOffsetMs:1e3*this.timestampOffset,streamId:this.streamId,periodId:this.periodId}),this.timeRanges.add({start:n,end:r});var o=this.applicationTrack.cues;100<o.length&&(this.applicationTrack.removeCues(o[0].startMs,o[Math.floor(o.length/2)].endMs),this.timeRanges=this.createNewTimeRanges())}}}),e.prototype.decodeSampleData=freeOnUnref(function(e){if(!Qe.exists(e))throw new Error("Fragment data is null or undefined");var t=null;try{t=this.codec.decode(e)}catch(e){this.decodeError("Failed to parse fragment: "+e)}return t}),e.prototype.decodeError=freeOnUnref(function(e){this.dispatchEvent({type:"decodeError",message:e})}),e.prototype.mediaError=freeOnUnref(function(e){var t=this;this.timer.setImmediate(freeOnUnref(function(){t.updating=!1,t.dispatchEventSync({type:"mediaError",message:e})}))}),e.prototype.createNewTimeRanges=freeOnUnref(function(){for(var e=new In.NumberLine(1e-5),t=0,n=this.applicationTrack.cues;t<n.length;t++){var r=n[t];e.add({start:r.startMs/1e3,end:r.endMs/1e3})}return e}),e.prototype.dispatchEventSync=freeOnUnref(function(e){this.sourceBufferEmitter.emitSync(e.type,e)}),e})();t.ApplicationSpecificSourceBuffer=n}));e(Tk);Tk.ApplicationSpecificSourceBuffer;var wk=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(e){return t.call(this,e,Lb.TrackType.TEXT)||this}return n(e,t),e})(Tk.ApplicationSpecificSourceBuffer);t.TimedTextSourceBuffer=r}));e(wk);wk.TimedTextSourceBuffer;var Ik=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var y=new Ka.EphemeralJSLogger("CreateFragmentLoadersHandler"),g=((n={}).Video=150,n.Audio=25,n.TimedText=0,n),r=freeOnUnref(function(){function e(e,t,n){void 0===n&&(n=yk.FragmentLoader);var m=this;this.eventTrackers={},this.aggregateSourceBufferLoadMonitor=null,this.createFragmentLoaders=freeOnUnref(function(e){m.stateContext.sourceBuffers={},m.stateContext.fragmentLoaders={};var t=new Sk.SlowSegmentLoadBarrier(3e3);m.stateContext.fragmentLoadBarriers={slowSegmentBarrier:t},m.aggregateSourceBufferLoadMonitor=new vk.AggregateSourceBufferLoadMonitor(m.stateContext.bufferedRangesCalculator);for(var n=0,r=Object.keys(e.streamsMetadata);n<r.length;n++){var i=r[n],o=e.streamsMetadata[i],a=o.mimeType+'; codecs="'+o.codecs+'"';"Video"===i&&(a+=';max-resolution="'+o.maxWidth+"x"+o.maxHeight+'";frame-rate="'+o.framerate+'"');var s=void 0;try{if("TimedText"===i){var l=new wk.TimedTextSourceBuffer(a);m.stateContext.textTrackProxy.addTrack(l.applicationTrack),s=l}else{var f=m.stateContext.mediaSource.addSourceBuffer(a);s=new Uk.TimeOffsettingSourceBuffer(f,e.reductionTermSec)}}catch(e){y.error("Could not create "+i+" sourceBuffer for "+a+".",e);continue}m.stateContext.sourceBuffers[i]=s;var u=m.createBufferSizeBarrier(m.aggregateSourceBufferLoadMonitor,i),c=new m.fragmentLoaderType(i,m.stateContext.mediaSource,s,m.stateContext.positionTracker,g[i],m.aggregateSourceBufferLoadMonitor,u);m.stateContext.fragmentLoaders[i]=c,m.attachLoaderListeners(c,i)}for(var d=m.stateContext.fragmentLoaders,p=0,h=Object.keys(d);p<h.length;p++){(c=d[i=h[p]]).initialize(),"TimedText"!==i&&t.addFragmentLoader(c)}m.stateContext.playbackQualityProvider.attachLoaders(m.stateContext.fragmentLoaders)}),this.destroyFragmentLoaders=freeOnUnref(function(){m.stateContext.playbackQualityProvider.detachLoaders();var e=m.stateContext.fragmentLoaders;if(null!=e&&null!=m.aggregateSourceBufferLoadMonitor){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];m.detachLoaderListeners(r),e[r].uninitialize(),m.aggregateSourceBufferLoadMonitor.deregisterStreamType(r)}var i=m.stateContext.fragmentLoadBarriers;null!=i&&i.slowSegmentBarrier.destroy(),m.stateContext.sourceBuffers={},m.stateContext.fragmentLoaders={},delete m.stateContext.fragmentLoadBarriers,m.stateContext.textTrackProxy.removeTrack()}}),this.onLoaderProgress=freeOnUnref(function(e){m.stateContext.eventEmitter.emit("progress",e)}),this.onLoaderError=freeOnUnref(function(e){y.error("Loader error:",e),m.stateContext.eventEmitter.emit("nonfatalError",e)}),this.onLoaderFatalError=freeOnUnref(function(e){y.error("Loader fatal error:",e),m.stateMachine.act(lk.MSEWrapperAction.Error,e)}),this.onLoaderPositionBump=freeOnUnref(function(e){m.stateContext.eventEmitter.emit("positionBump",e)}),this.stateMachine=e,this.stateMachine.onStateChange(freeOnUnref(function(e){return y.setId(fk.MSEWrapperState[e])})),this.stateContext=t,this.fragmentLoaderType=n}return e.prototype.initialize=freeOnUnref(function(){this.stateMachine.onTransition(fk.MSEWrapperState.Initialized,lk.MSEWrapperAction.CreateFragmentLoaders,this.createFragmentLoaders),this.stateMachine.onTransition(fk.MSEWrapperState.Initialized,lk.MSEWrapperAction.Uninitialize,this.destroyFragmentLoaders),this.stateMachine.onTransition(fk.MSEWrapperState.NeedsContent,lk.MSEWrapperAction.Uninitialize,this.destroyFragmentLoaders)}),e.prototype.attachLoaderListeners=freeOnUnref(function(e,t){var n=new A.EventTracker(e);(this.eventTrackers[t]=n).on("progress",this.onLoaderProgress),n.on("nonfatalError",this.onLoaderError),n.on("fatalError",this.onLoaderFatalError),n.on("positionBump",this.onLoaderPositionBump)}),e.prototype.detachLoaderListeners=freeOnUnref(function(e){this.eventTrackers[e].removeAllListeners(),delete this.eventTrackers[e]}),e.prototype.createBufferSizeBarrier=freeOnUnref(function(e,t){if("TimedText"===t)return null;var n=Qe.nestedValue(zt.deviceInformation.mediaSource,"maxSourceBufferSizeBytes");if(null===n)return null;if(x.isNumber(n))return new Ok.BufferSizeLoadBarrier(t,!1,e,n);var r=Qe.nestedValue(n,this.streamTypeToBufferSizeLimitTypeKey(t));return null===r?null:new Ok.BufferSizeLoadBarrier(t,!0,e,r)}),e.prototype.streamTypeToBufferSizeLimitTypeKey=freeOnUnref(function(e){switch(e){case"Video":return"video";case"Audio":return"audio";default:return"unknown"}}),e})();t.CreateFragmentLoadersHandler=r}));e(Ik);Ik.CreateFragmentLoadersHandler;var kk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=new Ka.EphemeralJSLogger("LoadHandler"),n=freeOnUnref(function(){function e(e,t){var l=this;this.cancelAttach=null,this.contentSource=null,this.wasWaiting=!1,this.isEncrypted=!1,this.eventTrackers={},this.fragmentSources={},this.fragmentSourceUpdateCallbacks={},this.finalFragmentAppended={},this.isWaitingMap={},this.attachContent=freeOnUnref(function(i){var e=lt.CancelToken.source(),r=e.token,t=e.cancel;l.cancelAttach=t,(l.contentSource=i).isEncrypted().then(freeOnUnref(function(e){if(r.throwIfRequested(),null!=l.stateContext.mediaSource.configure&&l.stateContext.mediaSource.configure({contentMayBeEncrypted:e}),e)return l.stateContext.drmController.mediaKeysSet})).then(freeOnUnref(function(){r.throwIfRequested(),i.on("streamChange",l.onStreamChange),i.on("streamRestrictionChange",l.onStreamRestrictionChange),l.stateContext.mediaSource.duration=i.getDurationMs()/1e3;for(var e=freeOnUnref(function(e){var t=l.stateContext.fragmentLoaders[e];if(null==t)return"continue";var n=i.getFragmentSource(e),r=freeOnUnref(function(){return l.onSourceUpdate(e)});l.fragmentSourceUpdateCallbacks[e]=r,n.onUpdate(r),l.fragmentSources[e]=n,"TimedText"===e?t.prepare():t.prepare([l.stateContext.fragmentLoadBarriers.slowSegmentBarrier]),t.attachContent(n),l.isWaitingMap[e]=!0,l.finalFragmentAppended[e]=!1,l.attachLoaderListeners(t,e)}),t=0,n=i.streamTypes;t<n.length;t++){e(n[t])}l.wasWaiting=!0,l.stateContext.positionTracker.prepare(i,l.stateContext.fragmentLoaders),l.stateContext.bufferedRangesCalculator.setContent(i,l.stateContext.fragmentLoaders),l.stateMachine.act(lk.MSEWrapperAction.Ready),l.stateContext.eventEmitter.emit("attachedContent")})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||l.stateMachine.act(lk.MSEWrapperAction.Error,e)}))}),this.detachContent=freeOnUnref(function(e){null!==l.cancelAttach&&(l.cancelAttach(),l.cancelAttach=null),l.stateContext.positionTracker.stop(),l.stateContext.bufferedRangesCalculator.clearContent();for(var t=l.contentSource,n=0,r=t.streamTypes;n<r.length;n++){var i=r[n];l.detachLoaderListeners(i)}var o=l.stateContext.fragmentLoaders;for(var i in o){if(o.hasOwnProperty(i))o[i].stop()}for(var a in l.fragmentSources)if(l.fragmentSources.hasOwnProperty(a)){var s=l.fragmentSourceUpdateCallbacks[a];l.fragmentSources[a].offUpdate(s)}l.fragmentSources={},l.fragmentSourceUpdateCallbacks={},l.isWaitingMap={},l.finalFragmentAppended={},t.off("streamChange",l.onStreamChange),t.off("streamRestrictionChange",l.onStreamRestrictionChange),l.contentSource=null,l.stateContext.eventEmitter.emit("detachedContent")}),this.onSourceUpdate=freeOnUnref(function(e){l.stateContext.fragmentLoaders[e].updatePosition()}),this.onLoaderIdle=freeOnUnref(function(){if(null!==l.contentSource){for(var e=!0,t=!0,n=0,r=vu.CRITICAL_STREAM_TYPES;n<r.length;n++){var i=r[n],o=l.stateContext.fragmentLoaders[i];null!=o&&(e=e&&!o.isUpdating(),t=t&&l.finalFragmentAppended[i])}if(t&&e){if("open"!==l.stateContext.mediaSource.readyState)return;a.info("All final fragments appended and all loaders are idle. Signaling end of stream"),l.stateContext.mediaSource.endOfStream(),l.stateContext.eventEmitter.emit("loadedToEnd")}}}),this.onLoaderWaiting=freeOnUnref(function(e){l.isWaitingMap[e]=!0,l.wasWaiting||(l.wasWaiting=!0,l.stateContext.eventEmitter.emit("waiting"))}),this.onLoaderFlushed=freeOnUnref(function(e){l.finalFragmentAppended[e]=!1}),this.onFinalFragmentLoaded=freeOnUnref(function(e){a.info("Loader for type "+e+" has finished"),l.finalFragmentAppended[e]=!0}),this.onLoaderBuffered=freeOnUnref(function(e){l.isWaitingMap[e]=!1,l.checkLoadersBuffered()}),this.checkLoadersBuffered=freeOnUnref(function(){var e=l.isWaiting();l.wasWaiting&&!e&&(l.wasWaiting=!1,l.stateContext.eventEmitter.emit("buffered"))}),this.onLoaderEncrypted=freeOnUnref(function(){l.isEncrypted||(l.isEncrypted=!0,l.stateContext.eventEmitter.emit("encrypted"))}),this.onStreamChange=freeOnUnref(function(e){var t=e.streamType,n=e.seamless,r=l.stateContext.fragmentLoaders[t];null!=r?null!=l.contentSource?(r.reset(!n),l.stateContext.positionTracker.update(),l.checkLoadersBuffered(),x.contains(l.contentSource.activeStreamTypes,t)||l.stateContext.playbackQualityProvider.removeCurrentQualityInfo(t)):a.warn("Received a "+t+" 'streamChange' without an existent ContentSource"):a.warn("Received a "+t+" 'streamChange' without an existent FragmentLoader")}),this.onStreamRestrictionChange=freeOnUnref(function(e){var t=e.streamType,n=l.stateContext.fragmentLoaders[t],r=l.contentSource;null!=n?null!=r?0!==e.restrictions.length?l.stateContext.playbackQualityProvider.validateQualities(e.streamType,r).then(freeOnUnref(function(e){r===l.contentSource?e||(a.info(t+" source buffer contains invalid qualities."),n.reset(),l.stateContext.positionTracker.update()):a.warn("ContentSource already changed before "+t+" buffer validity check completes.")})):a.info(t+" stream is not restricted."):a.warn("Received a "+t+" 'streamRestrictionChange' without an existent ContentSource"):a.warn("Received a "+t+" 'streamRestrictionChange' without an existent FragmentLoader")}),this.stateMachine=e,this.stateMachine.onStateChange(freeOnUnref(function(e){return a.setId(fk.MSEWrapperState[e])})),this.stateContext=t}return e.prototype.initialize=freeOnUnref(function(){this.stateMachine.onTransition(fk.MSEWrapperState.NeedsContent,lk.MSEWrapperAction.AttachContent,this.attachContent),this.stateMachine.onTransition(fk.MSEWrapperState.Loading,lk.MSEWrapperAction.DetachContent,this.detachContent),this.stateMachine.onTransition(fk.MSEWrapperState.Ready,lk.MSEWrapperAction.DetachContent,this.detachContent),this.stateMachine.onTransition(fk.MSEWrapperState.Error,lk.MSEWrapperAction.DetachContent,this.detachContent)}),e.prototype.attachLoaderListeners=freeOnUnref(function(e,t){var n=this,r=this.eventTrackers[t]=new A.EventTracker(e);r.on("flushed",freeOnUnref(function(){return n.onLoaderFlushed(t)})),r.on("finalFragmentLoaded",freeOnUnref(function(){return n.onFinalFragmentLoaded(t)})),r.on("idle",this.onLoaderIdle),r.on("waiting",freeOnUnref(function(){return n.onLoaderWaiting(t)})),r.on("buffered",freeOnUnref(function(){return n.onLoaderBuffered(t)})),r.on("encrypted",this.onLoaderEncrypted),r.on("fragmentConsumed",freeOnUnref(function(e){return n.onLoaderFragmentConsumed(t,e)}))}),e.prototype.detachLoaderListeners=freeOnUnref(function(e){var t=this.eventTrackers[e];null!=t&&(t.removeAllListeners(),delete this.eventTrackers[e])}),e.prototype.isWaiting=freeOnUnref(function(){if(null===this.contentSource)return!0;for(var e=!1,t=0,n=this.contentSource.streamTypes;t<n.length;t++){var r=n[t];"TimedText"!==r&&(e=e||this.isWaitingMap[r])}return e}),e.prototype.onLoaderFragmentConsumed=freeOnUnref(function(e,t){this.fragmentSources[e].fragmentConsumed(t)}),e})();t.LoadHandler=n}));e(kk);kk.LoadHandler;var _k=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.setContent=freeOnUnref(function(e,t){this.content=e,this.fragmentLoaders=t}),e.prototype.clearContent=freeOnUnref(function(){delete this.content,delete this.fragmentLoaders}),e.prototype.getBufferedRanges=freeOnUnref(function(e){if(null==this.content||null==this.fragmentLoaders)return new In.NumberLine;null==e?e=this.content.streamTypes:Array.isArray(e)||(e=[e]);for(var t=null,n=0,r=e;n<r.length;n++){var i=r[n],o=this.fragmentLoaders[i];if(null!=o){var a=o.getBufferedRanges();t=null!=t?t.intersection(a):a}}return null!=t?t:new In.NumberLine}),e})();t.BufferedRangesCalculator=n}));e(_k);_k.BufferedRangesCalculator;var Rk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.contentSource=null,this.fragmentLoaders={},this.getPositionMs=e}return e.prototype.prepare=freeOnUnref(function(e,t){this.contentSource=e,this.fragmentLoaders=t,this.updateFragmentLoaders()}),e.prototype.stop=freeOnUnref(function(){this.contentSource=null,this.fragmentLoaders={}}),e.prototype.update=freeOnUnref(function(){this.updateFragmentLoaders()}),e.prototype.updateFragmentLoaders=freeOnUnref(function(){if(null!=this.contentSource&&null!=this.fragmentLoaders)for(var e=0,t=this.contentSource.activeStreamTypes;e<t.length;e++){var n=t[e],r=this.fragmentLoaders[n];null!=r&&r.updatePosition()}}),e})();t.PositionTracker=n}));e(Rk);Rk.PositionTracker;var Ak=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("TrackProxy"),r=freeOnUnref(function(){function e(){this.multiplexedEventSource=new A.MultiplexedEventSource,this.track=null}return e.prototype.addTrack=freeOnUnref(function(e){null===this.track?(this.track=e,this.multiplexedEventSource.addSource("1",e),this.multiplexedEventSource.selectSource("1")):n.warn("Cannot currently handle multiple concurrent text tracks. Ignoring new track")}),e.prototype.removeTrack=freeOnUnref(function(){Qe.exists(this.track)&&this.multiplexedEventSource.removeSource("1"),this.track=null}),Object.defineProperty(e.prototype,"cues",{get:freeOnUnref(function(){return null!==this.track?this.track.cues:[]}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedIntervalsMs",{get:freeOnUnref(function(){return null!==this.track?this.track.bufferedIntervalsMs:[]}),enumerable:!0,configurable:!0}),e.prototype.on=freeOnUnref(function(e,t){this.multiplexedEventSource.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.multiplexedEventSource.off(e,t)}),e})();t.TrackProxy=r}));e(Ak);Ak.TrackProxy;var Dk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=new Ka.EphemeralJSLogger("ContentLevelAdapterMSE"),n=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.error=null,this.bufferedRangesCalculator=new _k.BufferedRangesCalculator,this.eventEmitter=new A.EventEmitter,this.onInitialized=freeOnUnref(function(){i.eventEmitter.emit("initialized")}),this.onUninitialized=freeOnUnref(function(){i.eventEmitter.emit("uninitialized")}),this.onNeedsContent=freeOnUnref(function(){i.eventEmitter.emit("needsContent")}),this.onReady=freeOnUnref(function(){i.eventEmitter.emit("ready")}),this.mediaPlayer=e,this.positionTracker=new Rk.PositionTracker(r),this.textTrack=new Ak.TrackProxy,this.stateContext={mediaPlayer:e,playbackQualityProvider:n,drmController:t,eventEmitter:this.eventEmitter,positionTracker:this.positionTracker,bufferedRangesCalculator:this.bufferedRangesCalculator,textTrackProxy:this.textTrack},this.stateMachine=new ml.FiniteStateMachine(fk.MSEWrapperState.Uninitialized),this.stateMachine.onStateChange(freeOnUnref(function(e){return u.setId(fk.MSEWrapperState[e])})),this.stateMachine.addTransition(fk.MSEWrapperState.Uninitialized,lk.MSEWrapperAction.Initialize,fk.MSEWrapperState.Initializing),this.stateMachine.addTransition(fk.MSEWrapperState.Initializing,lk.MSEWrapperAction.Initialized,fk.MSEWrapperState.Initialized),this.stateMachine.addTransition(fk.MSEWrapperState.Initialized,lk.MSEWrapperAction.CreateFragmentLoaders,fk.MSEWrapperState.NeedsContent),this.stateMachine.addTransition(fk.MSEWrapperState.NeedsContent,lk.MSEWrapperAction.AttachContent,fk.MSEWrapperState.Loading),this.stateMachine.addTransition(fk.MSEWrapperState.Loading,lk.MSEWrapperAction.Ready,fk.MSEWrapperState.Ready),this.stateMachine.addTransition(fk.MSEWrapperState.Initializing,lk.MSEWrapperAction.Uninitialize,fk.MSEWrapperState.Uninitialized),this.stateMachine.addTransition(fk.MSEWrapperState.Initialized,lk.MSEWrapperAction.Uninitialize,fk.MSEWrapperState.Uninitialized),this.stateMachine.addTransition(fk.MSEWrapperState.NeedsContent,lk.MSEWrapperAction.Uninitialize,fk.MSEWrapperState.Uninitialized),this.stateMachine.addTransition(fk.MSEWrapperState.Loading,lk.MSEWrapperAction.DetachContent,fk.MSEWrapperState.NeedsContent),this.stateMachine.addTransition(fk.MSEWrapperState.Ready,lk.MSEWrapperAction.DetachContent,fk.MSEWrapperState.NeedsContent),this.stateMachine.addTransition(fk.MSEWrapperState.Uninitialized,lk.MSEWrapperAction.Error,fk.MSEWrapperState.Error),this.stateMachine.addTransition(fk.MSEWrapperState.Initializing,lk.MSEWrapperAction.Error,fk.MSEWrapperState.Error),this.stateMachine.addTransition(fk.MSEWrapperState.Initialized,lk.MSEWrapperAction.Error,fk.MSEWrapperState.Error),this.stateMachine.addTransition(fk.MSEWrapperState.NeedsContent,lk.MSEWrapperAction.Error,fk.MSEWrapperState.Error),this.stateMachine.addTransition(fk.MSEWrapperState.Loading,lk.MSEWrapperAction.Error,fk.MSEWrapperState.Error),this.stateMachine.addTransition(fk.MSEWrapperState.Ready,lk.MSEWrapperAction.Error,fk.MSEWrapperState.Error),this.stateMachine.addTransition(fk.MSEWrapperState.Error,lk.MSEWrapperAction.Error,fk.MSEWrapperState.Error),this.stateMachine.addTransition(fk.MSEWrapperState.Error,lk.MSEWrapperAction.DetachContent,fk.MSEWrapperState.Error),this.stateMachine.addTransition(fk.MSEWrapperState.Error,lk.MSEWrapperAction.Uninitialize,fk.MSEWrapperState.Uninitialized);for(var o=0,a=[fk.MSEWrapperState.Uninitialized,fk.MSEWrapperState.Initializing,fk.MSEWrapperState.Initialized,fk.MSEWrapperState.NeedsContent,fk.MSEWrapperState.Loading,fk.MSEWrapperState.Ready,fk.MSEWrapperState.Error];o<a.length;o++){var s=a[o];this.stateMachine.onEnterState(s,freeOnUnref(function(){return null})),this.stateMachine.onTransition(s,lk.MSEWrapperAction.Error,freeOnUnref(function(e){i.error=e}))}for(var l=0,f=[new ck.InitializeHandler(this.stateMachine,this.stateContext),new Ik.CreateFragmentLoadersHandler(this.stateMachine,this.stateContext),new kk.LoadHandler(this.stateMachine,this.stateContext)];l<f.length;l++){f[l].initialize()}this.stateMachine.onEnterState(fk.MSEWrapperState.Initialized,this.onInitialized),this.stateMachine.onEnterState(fk.MSEWrapperState.Uninitialized,this.onUninitialized),this.stateMachine.onEnterState(fk.MSEWrapperState.NeedsContent,this.onNeedsContent),this.stateMachine.onEnterState(fk.MSEWrapperState.Ready,this.onReady),this.stateMachine.onEnterState(fk.MSEWrapperState.Error,freeOnUnref(function(){var e=i.error;null===e&&(e=new Error("ContentLevelAdapterMSE went to Error state without an error set")),u.error("StateMachineError:",e),i.eventEmitter.emit("fatalError",e)})),this.stateMachine.onLeaveState(fk.MSEWrapperState.Error,freeOnUnref(function(){i.error=null})),this.stateMachine.onIllegalTransition(freeOnUnref(function(e,t,n){u.error("IllegalTransitionError from action ["+lk.MSEWrapperAction[t]+"] while in state ["+fk.MSEWrapperState[e]+"]")}))}return e.prototype.initialize=freeOnUnref(function(){this.stateMachine.act(lk.MSEWrapperAction.Initialize)}),e.prototype.terminate=freeOnUnref(function(){this.detachContent(),this.stateMachine.act(lk.MSEWrapperAction.Uninitialize)}),e.prototype.prepare=freeOnUnref(function(e,t){this.stateMachine.act(lk.MSEWrapperAction.CreateFragmentLoaders,{streamsMetadata:e,reductionTermSec:t})}),e.prototype.attachContent=freeOnUnref(function(e){this.stateMachine.act(lk.MSEWrapperAction.AttachContent,e)}),e.prototype.detachContent=freeOnUnref(function(){this.stateMachine.act(lk.MSEWrapperAction.DetachContent)}),e.prototype.onPosition=freeOnUnref(function(){this.positionTracker.update()}),e.prototype.flushStream=freeOnUnref(function(e){var t=this.stateContext;null!=t.fragmentLoaders&&null!=t.fragmentLoaders[e]&&t.fragmentLoaders[e].reset()}),e.prototype.getBufferedRanges=freeOnUnref(function(e){return this.bufferedRangesCalculator.getBufferedRanges(e)}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e})();t.ContentLevelAdapterMSE=n}));e(Dk);Dk.ContentLevelAdapterMSE;var xk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("MpPlayerPlaybackQualityProvider"),n=freeOnUnref(function(){function e(e){var i=this;this.currentPlayingQualities={},this.fragmentLoaderEventTrackers={},this.loaders=null,this.pendingQualities={},this.qualitiesValidationCancelCallbacks={},this.qualityCallbacks={},this.onFragmentConsumed=freeOnUnref(function(e,t){var n={type:e,periodId:t.periodId,streamId:t.streamId,qualityLevelId:t.qualityLevelId,startTimeMs:t.position.startTimeMs,endTimeMs:t.position.endTimeMs,bitrateBitsPerSec:t.bitrateBps,width:"Video"===e?t.width:void 0,height:"Video"===e?t.height:void 0},r=i.currentPlayingQualities[e];!r||r.startTimeMs!==n.startTimeMs||r.endTimeMs!==n.endTimeMs||r.periodId===n.periodId&&r.streamId===n.streamId&&r.qualityLevelId===n.qualityLevelId||(i.currentPlayingQualities[e]=n,i.qualityCallbacks[e]&&i.qualityCallbacks[e].invoke(i.currentPlayingQualities[e])),i.pendingQualities[e].push(n)}),this.onLoaderProgress=freeOnUnref(function(t){null!==t.backBufferStartSeconds&&(i.pendingQualities[t.fragment.type]=i.pendingQualities[t.fragment.type].filter(freeOnUnref(function(e){return e.endTimeMs/1e3>t.backBufferStartSeconds})))}),this.mediaPlayer=e}return e.prototype.attachLoaders=freeOnUnref(function(e){var o=this;this.loaders=e;for(var t=freeOnUnref(function(e){var t=e;a.pendingQualities[e]=[];var n=new A.EventTracker(a.loaders[e]);a.fragmentLoaderEventTrackers[t]=n;var r=freeOnUnref(function(){o.onLoaderFlushed(t)}),i=freeOnUnref(function(e){o.onFragmentConsumed(t,e)});n.on("flushed",r),n.on("fragmentConsumed",i),n.on("progress",a.onLoaderProgress)}),a=this,n=0,r=Object.keys(e);n<r.length;n++){t(r[n])}}),e.prototype.detachLoaders=freeOnUnref(function(){if(null!==this.loaders){for(var e=0,t=Object.keys(this.loaders);e<t.length;e++){var n=o=t[e];this.fragmentLoaderEventTrackers[n].removeAllListeners(),delete this.fragmentLoaderEventTrackers[n]}for(var r=0,i=Object.keys(this.qualitiesValidationCancelCallbacks);r<i.length;r++){var o=i[r],a=this.qualitiesValidationCancelCallbacks[o];null!=a&&a()}this.loaders=null,this.currentPlayingQualities={},this.pendingQualities={},this.qualitiesValidationCancelCallbacks={}}}),e.prototype.getCurrentPeriod=freeOnUnref(function(){return null!=this.currentPlayingQualities.Video?this.currentPlayingQualities.Video.periodId:null}),e.prototype.getCurrentQualityInfo=freeOnUnref(function(e){return Qe.withDefault(this.currentPlayingQualities[e],null)}),e.prototype.getVideoDecodePerformance=freeOnUnref(function(){return this.mediaPlayer.getVideoPlaybackQuality()}),e.prototype.getCurrentResolution=freeOnUnref(function(){var e=this.getCurrentQualityInfo("Video");return null==e||null==e.width||null==e.height?null:{width:e.width,height:e.height}}),e.prototype.validateQualities=freeOnUnref(function(t,n){var r=this,e=this.qualitiesValidationCancelCallbacks[t];null!=e&&(e(),this.qualitiesValidationCancelCallbacks[t]=null);var i=[];null!=this.pendingQualities[t]&&(i=this.pendingQualities[t].map(freeOnUnref(function(e){return n.isSegmentQualityValid(e.type,e.periodId,e.streamId,e.qualityLevelId)})));var o=this.currentPlayingQualities[t];if(null!=o&&i.push(n.isSegmentQualityValid(o.type,o.periodId,o.streamId,o.qualityLevelId)),0===i.length)return lt.Promise.resolve(!0);var a=lt.CancelToken.source(),s=a.token,l=a.cancel;return this.qualitiesValidationCancelCallbacks[t]=l,lt.Promise.all(i).then(freeOnUnref(function(e){return s.throwIfRequested(),r.qualitiesValidationCancelCallbacks[t]=null,e.every(freeOnUnref(function(e){return e}))})).catch(freeOnUnref(function(e){return e instanceof lt.CancelError||f.error(e.message),!0}))}),e.prototype.onPosition=freeOnUnref(function(e){if(null!==this.loaders)for(var t=0,n=Object.keys(this.loaders);t<n.length;t++){var r=n[t],i=this.currentPlayingQualities[r];if(!(null!=i&&i.startTimeMs<=e&&e<i.endTimeMs)){for(var o=0,a=this.pendingQualities[r];o<a.length;o++){var s=a[o];e>=s.startTimeMs-1&&e<s.endTimeMs&&(this.currentPlayingQualities[r]=s)}var l=this.currentPlayingQualities[r];null!=l&&(null==i||l.periodId!==i.periodId||l.streamId!==i.streamId||l.qualityLevelId!==i.qualityLevelId)&&null!=this.qualityCallbacks[r]&&this.qualityCallbacks[r].invoke(this.currentPlayingQualities[r])}}}),e.prototype.on=freeOnUnref(function(e,t,n){"qualityLevel"===t&&(null==this.qualityCallbacks[e]&&(this.qualityCallbacks[e]=new A.MulticastCallback),this.qualityCallbacks[e].add(n))}),e.prototype.off=freeOnUnref(function(e,t,n){"qualityLevel"===t&&null!=this.qualityCallbacks[e]&&this.qualityCallbacks[e].remove(n)}),e.prototype.onStreamGroupChange=freeOnUnref(function(e){}),e.prototype.offStreamGroupChange=freeOnUnref(function(e){}),e.prototype.removeCurrentQualityInfo=freeOnUnref(function(e){delete this.currentPlayingQualities[e],this.pendingQualities[e]=[],null!=this.qualityCallbacks[e]&&this.qualityCallbacks[e].invoke(null)}),e.prototype.onLoaderFlushed=freeOnUnref(function(e){this.pendingQualities[e]=[]}),e})();t.MpPlayerPlaybackQualityProvider=n}));e(xk);xk.MpPlayerPlaybackQualityProvider;var Fk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("LocalLicenseLoader"),s={previouslyRequested:!1,keyMetadata:null},n=freeOnUnref(function(){function e(e){var t=this;this.onLicenseLoaded=freeOnUnref(function(e){null!==t.licenseConsumptionTracker&&t.licenseConsumptionTracker.setExpiration(e)}),this.contentLoadPromise=null,this.licenseMetadataList=[],this.licenseRequested={},this.licenseConsumptionTracker=null,this.mediaKeysManager=e}return e.prototype.load=freeOnUnref(function(e){var n=this;if(void 0===e&&(e=null),null!=e&&Jo.metadataStorage.capabilities.isSupported){null!=this.contentLoadPromise&&(a.warn("New content is loaded without unloading the previous content"),this.contentLoadPromise=null);var t=yd.createPersistentLicenseMetadataKey(e);this.contentLoadPromise=Jo.metadataStorage.get(t).then(freeOnUnref(function(e){if(null!=e){var t=e;n.licenseMetadataList=t.metadataList}})),this.licenseConsumptionTracker=ea.LicenseConsumptionTrackerManager.getInstance().getLicenseConsumptionTracker(e),this.licenseConsumptionTracker.initialize(),this.mediaKeysManager.on("licenseLoaded",this.onLicenseLoaded)}}),e.prototype.unload=freeOnUnref(function(){this.contentLoadPromise=null,this.licenseMetadataList=[],this.licenseRequested={},this.licenseConsumptionTracker=null,this.mediaKeysManager.off("licenseLoaded",this.onLicenseLoaded)}),e.prototype.loadLicenseAndKeyMetadata=freeOnUnref(function(e,n){var r=this;if(null==this.contentLoadPromise)return lt.Promise.resolve(s);var i=null,o=null;return this.contentLoadPromise.then(freeOnUnref(function(){return n.throwIfRequested(),r.mediaKeysManager.extractKeyId(e)})).then(freeOnUnref(function(e){n.throwIfRequested(),o=e;var t=r.findMetadata(e);return null!=t&&(i=t,null!=r.licenseConsumptionTracker&&r.mediaKeysManager.loadPersistentLicense(i.sessionId,i.keyMetadata,r.licenseConsumptionTracker))})).then(freeOnUnref(function(e){if(n.throwIfRequested(),e&&null!=i){var t={previouslyRequested:null!=r.licenseRequested[i.sessionId],keyMetadata:i.keyMetadata};return r.licenseRequested[i.sessionId]=!0,t}return s})).catch(freeOnUnref(function(e){return e instanceof lt.CancelError||a.error("Fail to load license of keyId "+o,e),s}))}),e.prototype.findMetadata=freeOnUnref(function(t){return x.find(this.licenseMetadataList,freeOnUnref(function(e){return e.keyId===t}))}),e})();t.LocalLicenseLoader=n}));e(Fk);Fk.LocalLicenseLoader;var Bk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("DrmController"),n=freeOnUnref(function(){function e(e,t){var n=this;this.internalMediaKeysSet=null,this.cancelSetMediaKeys=null,this.contentCancelTokenPair=null,this.keySystemInternalCode=null,this.contentSource=null,this.onEncryptedEvent=freeOnUnref(function(e){null!=n.contentCancelTokenPair&&n.handleEncryptedContent(e.initDataType,e.initData,n.contentCancelTokenPair.token,e.mimeType).catch(freeOnUnref(function(e){e instanceof lt.CancelError||s.error("Fail to load local license in encrypted event",e)}))}),this.onLicenseAcquired=freeOnUnref(function(e){null!=n.contentSource&&n.contentSource.setKeyMetadata(e.keyMetadata)}),this.onMediaKeysManagerError=freeOnUnref(function(e){var t=n.convertError(e);n.eventEmitter.emit("fatalError",t)}),this.mediaPlayer=e,this.mediaKeysManager=t,this.eventEmitter=new A.EventEmitter,this.mediaKeysSetDeferred=new lt.Deferred,this.localLicenseLoader=new Fk.LocalLicenseLoader(this.mediaKeysManager)}return e.prototype.reset=freeOnUnref(function(){this.unload(),null!=this.cancelSetMediaKeys&&(this.cancelSetMediaKeys(),this.cancelSetMediaKeys=null),this.keySystemInternalCode=null,this.mediaPlayer.setMediaKeys(null),this.internalMediaKeysSet=null,this.mediaKeysSetDeferred.reject(new lt.CancelError),this.mediaKeysSetDeferred=new lt.Deferred}),e.prototype.load=freeOnUnref(function(n){var r=this;this.contentSource=n,this.contentCancelTokenPair=lt.CancelToken.source(),this.mediaPlayer.on("encrypted",this.onEncryptedEvent),this.contentSource.on("encrypted",this.onEncryptedEvent),this.mediaKeysManager.on("licenseAcquired",this.onLicenseAcquired),this.mediaKeysManager.on("error",this.onMediaKeysManagerError),this.localLicenseLoader.load(n.downloadOperationId);var i=this.contentCancelTokenPair.token;n.isEncrypted().then(freeOnUnref(function(e){if(i.throwIfRequested(),e){r.setMediaKeys();var t=n.getInitializationData().map(freeOnUnref(function(e){return r.handleEncryptedContent(e.type,e.data,i,e.mimeType)}));return lt.Promise.all(t).then(freeOnUnref(function(){}))}})).catch(freeOnUnref(function(e){if(!(e instanceof lt.CancelError)){s.error("Failure to handle potentially encrypted content",e);var t=r.convertError(e);r.eventEmitter.emit("fatalError",t)}}))}),e.prototype.unload=freeOnUnref(function(){this.mediaPlayer.off("encrypted",this.onEncryptedEvent),this.mediaKeysManager.off("licenseAcquired",this.onLicenseAcquired),this.mediaKeysManager.off("error",this.onMediaKeysManagerError),null!=this.contentSource&&this.contentSource.off("encrypted",this.onEncryptedEvent),this.localLicenseLoader.unload(),null!=this.contentCancelTokenPair&&(this.contentCancelTokenPair.cancel(),this.contentCancelTokenPair=null),this.contentSource=null}),Object.defineProperty(e.prototype,"mediaKeysSet",{get:freeOnUnref(function(){return this.mediaKeysSetDeferred.promise}),enumerable:!0,configurable:!0}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.handleEncryptedContent=freeOnUnref(function(t,n,r,i){var o=this;this.setMediaKeys();var e,a=this.mediaKeysManager.getKeyMetadata(n);return null!=a?(null!=(e=L.configurationStore.configuration)&&null!=e.drm&&!0===e.drm.useSingleMediaKeySession&&0<a.length&&"pending"===a[0].id?s.info("DRM Session Request is pending for initDataType: "+t+", metadata ID: "+a[0].id):null==this.contentSource||this.contentSource.downloadOperationId||this.contentSource.setKeyMetadata(a),lt.Promise.resolve()):this.localLicenseLoader.loadLicenseAndKeyMetadata(n,r).then(freeOnUnref(function(e){r.throwIfRequested(),null==o.contentSource||e.previouslyRequested||(null!=e.keyMetadata?o.contentSource.setKeyMetadata(e.keyMetadata):o.applyInitData(t,n,i))}))}),e.prototype.setMediaKeys=freeOnUnref(function(){var n=this;if(null==this.internalMediaKeysSet){var e=lt.CancelToken.source(),t=e.token,r=e.cancel;this.cancelSetMediaKeys=r,this.internalMediaKeysSet=ea.MediaKeysManager.getMediaKeys().then(freeOnUnref(function(e){return t.throwIfRequested(),n.keySystemInternalCode=n.getInternalCodeFromKeySystem(e.system),n.mediaPlayer.setMediaKeys(e.mediaKeys)})).then(freeOnUnref(function(){t.throwIfRequested(),n.mediaKeysSetDeferred.resolve()})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;n.mediaKeysSetDeferred.reject(e),s.error("Failed to set MediaKeys with encrypted content",e);var t=n.convertError(e);throw n.eventEmitter.emit("fatalError",t),e}))}}),e.prototype.getInternalCodeFromKeySystem=freeOnUnref(function(e){return 0===e.indexOf("com.microsoft.playready")?"playready":"com.widevine.alpha"===e?"widevine":null}),e.prototype.applyInitData=freeOnUnref(function(t,n,r){var i=this;if(null!==this.contentSource){var o=this.contentCancelTokenPair.token;this.internalMediaKeysSet.then(freeOnUnref(function(){o.throwIfRequested();var e=freeOnUnref(function(e,t){return o.requested?lt.Promise.reject(new lt.CancelError):i.contentSource.getLicense(e,t,o)});i.mediaKeysManager.applyInitData(t,n,e,ea.MediaKeysPurpose.Playback,!1,r).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw e;s.error("Failed to apply initialization data",e);var t=i.convertError(e);i.eventEmitter.emit("fatalError",t)}))})).catch(freeOnUnref(function(){}))}else s.error("Found encrypted content without a content source")}),e.prototype.convertError=freeOnUnref(function(e){if(e instanceof ct.XpError&&-1!==e.code.indexOf("xp.system"))return e;var t=null!=this.keySystemInternalCode?"drm."+this.keySystemInternalCode:"drm";return ct.XpError.generatePrefixedError(e,t)}),e})();t.DrmController=n}));e(Bk);Bk.DrmController;var Lk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("PlaybackQualityMonitor");var n=freeOnUnref(function(){function e(e){this.eventEmitter=new A.EventEmitter,this.lastVideoPlaybackQuality=null,this.monitorIntervalId=null,this.timer=oe.timer,this.playbackQualityProvider=e}return e.prototype.start=freeOnUnref(function(){var i=this;null===this.monitorIntervalId&&(this.lastVideoPlaybackQuality=this.playbackQualityProvider.getVideoDecodePerformance(),this.monitorIntervalId=this.timer.setInterval(freeOnUnref(function(){var e=i.playbackQualityProvider.getVideoDecodePerformance();if(null!==i.lastVideoPlaybackQuality&&null!==e&&-1!==i.lastVideoPlaybackQuality.totalVideoFrames&&-1!==e.totalVideoFrames){var t=e.droppedVideoFrames-i.lastVideoPlaybackQuality.droppedVideoFrames,n=e.totalVideoFrames-i.lastVideoPlaybackQuality.totalVideoFrames,r=e.creationTime-i.lastVideoPlaybackQuality.creationTime;(0<t||0<n)&&i.eventEmitter.emit("frameCountChange",{framesDropped:t,framesDecoded:n,periodMs:r}),i.lastVideoPlaybackQuality=e}else i.lastVideoPlaybackQuality=e}),250))}),e.prototype.stop=freeOnUnref(function(){null!==this.monitorIntervalId&&(this.timer.clearInterval(this.monitorIntervalId),this.monitorIntervalId=null)}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e})();t.PlaybackQualityMonitor=n}));e(Lk);Lk.PlaybackQualityMonitor;var Nk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.windowRatioTracker=new In.WindowSampleTracker(e),this.runningRatioTracker=new In.RunningSampleTracker}return e.prototype.addSample=freeOnUnref(function(e,t){var n=e/t;this.runningRatioTracker.addSample(n),this.windowRatioTracker.addSample(n)}),e})();t.SourceBufferAppendTimeTracker=n}));e(Nk);Nk.SourceBufferAppendTimeTracker;var Vk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("AppendTimeBitrateFilterManager"),n=freeOnUnref(function(){function e(e){var o=this;if(this.contentSource=null,this.lastAppendedVideoBitrateBitsPerSec=null,this.maxBitrateCapBitsPerSec=null,this.onSegmentAppended=freeOnUnref(function(e){if(null!==o.contentSource){var t=e.appendTimeMs,n=e.fragment.position.durationMs,r=e.fragment.type;if(400<t&&a.warn("["+r+"] SourceBuffer.appendBuffer took "+t+"ms to complete"),"Video"===r)o.lastAppendedVideoBitrateBitsPerSec=e.fragment.bitrateBps;else if("Image"===r)return void a.warn("Ignoring unexpected peripheral stream type");var i=o.perStreamTracker[r];i.addSample(t,n),"Video"!==r&&"Audio"!==r||o.aggregateNativeSourceBufferTracker.addSample(t,n),o.checkTracker(o.aggregateNativeSourceBufferTracker,o.contentSource,"Tracker.Aggregate"),"Video"===r&&o.checkTracker(i,o.contentSource,"Tracker.Video")}}),this.contentLevelAdapter=e,this.aggregateNativeSourceBufferTracker=new Nk.SourceBufferAppendTimeTracker(5),this.perStreamTracker=this.createNewPerStreamTrackers(),this.enableBitrateFiltering=!1,this.appendTimeFilterRatio=1,this.bitrateFloorBitsPerSec=2e6,null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.qualityFilters&&null!=L.configurationStore.configuration.qualityFilters.appendTimeRatio){var t=L.configurationStore.configuration.qualityFilters.appendTimeRatio;this.enableBitrateFiltering=t.enabled,null!=t.appendTimeFilterRatio&&(this.appendTimeFilterRatio=t.appendTimeFilterRatio),null!=t.filterBitrateFloorBitsPerSec&&(this.bitrateFloorBitsPerSec=t.filterBitrateFloorBitsPerSec)}}return e.prototype.load=freeOnUnref(function(e){this.contentSource=e,null!==this.maxBitrateCapBitsPerSec&&e.setMaxBitrateThreshold("Video","AppendTimeRatio",this.maxBitrateCapBitsPerSec),this.contentLevelAdapter.on("progress",this.onSegmentAppended)}),e.prototype.unload=freeOnUnref(function(){this.contentLevelAdapter.off("progress",this.onSegmentAppended),this.reportSessionAppendTimeRatioMetrics(),this.aggregateNativeSourceBufferTracker=new Nk.SourceBufferAppendTimeTracker(5),this.perStreamTracker=this.createNewPerStreamTrackers(),this.contentSource=null,this.lastAppendedVideoBitrateBitsPerSec=null}),e.prototype.getWindowedSamples=freeOnUnref(function(e){return this.perStreamTracker[e].windowRatioTracker.getSamples()}),e.prototype.checkTracker=freeOnUnref(function(e,t,n){if(this.enableBitrateFiltering&&!(e.windowRatioTracker.size()<5)&&null!==this.lastAppendedVideoBitrateBitsPerSec){var r=e.windowRatioTracker.average();r>this.appendTimeFilterRatio&&this.lastAppendedVideoBitrateBitsPerSec>this.bitrateFloorBitsPerSec&&(null===this.maxBitrateCapBitsPerSec||this.lastAppendedVideoBitrateBitsPerSec<this.maxBitrateCapBitsPerSec)&&(a.warn(n+" AppendTimeRatio is "+r.toFixed(3)+" (> "+this.appendTimeFilterRatio+"). Capping video to below "+this.lastAppendedVideoBitrateBitsPerSec+" bits/sec"),this.maxBitrateCapBitsPerSec=this.lastAppendedVideoBitrateBitsPerSec-1,t.setMaxBitrateThreshold("Video","AppendTimeRatio",this.maxBitrateCapBitsPerSec),e.windowRatioTracker.reset(),q.metrics.putMetric("StreamRestriction.AppendTimeRatioQualityFilter",this.maxBitrateCapBitsPerSec))}}),e.prototype.createNewPerStreamTrackers=freeOnUnref(function(){var e;return(e={}).Audio=new Nk.SourceBufferAppendTimeTracker(5),e.TimedText=new Nk.SourceBufferAppendTimeTracker(5),e.Video=new Nk.SourceBufferAppendTimeTracker(5),e}),e.prototype.reportSessionAppendTimeRatioMetrics=freeOnUnref(function(){if(null!==this.contentSource)for(var e=0,t=this.contentSource.streamTypes;e<t.length;e++){var n=t[e],r=this.perStreamTracker[n].runningRatioTracker.average();null!==r&&q.metrics.putMetric("Media.SourceBuffer."+n+".SessionAppendTimeRatio.Average",r);var i=this.perStreamTracker[n].runningRatioTracker.stdDev();null!==i&&q.metrics.putMetric("Media.SourceBuffer."+n+".SessionAppendTimeRatio.StdDev",i)}}),e})();t.AppendTimeBitrateFilterManager=n}));e(Vk);Vk.AppendTimeBitrateFilterManager;var jk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("FramerateBasedBitrateCapManager"),n=freeOnUnref(function(){function e(e,t,n,r,i,o){void 0===n&&(n=2e6),void 0===r&&(r=5e3),void 0===i&&(i=.2),void 0===o&&(o=.3);var a=this;this.contentSource=null,this.currentBitrateBitsPerSec=0,this.maxBitrateBitsPerSecThreshold=Number.MAX_VALUE,this.samples=[],this.onPlaybackQualityMetrics=freeOnUnref(function(e){if(null!==a.contentSource){a.samples.push(e);for(var t=a.samples.reduce(freeOnUnref(function(e,t){return e+t.periodMs}),0);0<a.samples.length&&t-a.samples[0].periodMs>=a.timeNeededMs;)t-=a.samples[0].periodMs,a.samples.shift();var n=a.samples.map(freeOnUnref(function(e){return e.framesDropped/Math.max(e.framesDecoded,1)})).sort(freeOnUnref(function(e,t){return e-t})),r=n[Math.floor(n.length*a.samplesPercentileThreshold)];t>=a.timeNeededMs&&r>=a.dropPercentThreshold&&a.currentBitrateBitsPerSec>a.bitrateFloorBitsPerSec&&a.currentBitrateBitsPerSec<=a.maxBitrateBitsPerSecThreshold&&(s.warn("P"+100*a.samplesPercentileThreshold+" of frame drop rate is "+r.toFixed(2)+"in last "+a.timeNeededMs+"ms, downshifting video quality to below "+a.currentBitrateBitsPerSec+"."),a.maxBitrateBitsPerSecThreshold=a.currentBitrateBitsPerSec-1,a.contentSource.setMaxBitrateThreshold("Video","FrameDropRate",a.maxBitrateBitsPerSecThreshold),q.metrics.putMetric("StreamRestriction.FrameDropRateQualityFilter",a.maxBitrateBitsPerSecThreshold),a.samples=[])}}),this.onVideoQualityChanged=freeOnUnref(function(e){null!==e&&(a.currentBitrateBitsPerSec=e.bitrateBitsPerSec)}),this.playbackQualityProvider=e,this.playbackQualityMonitor=t,this.bitrateFloorBitsPerSec=n,this.timeNeededMs=r,this.dropPercentThreshold=i,this.samplesPercentileThreshold=o}return e.prototype.start=freeOnUnref(function(e){this.contentSource=e,this.playbackQualityProvider.on("Video","qualityLevel",this.onVideoQualityChanged),this.playbackQualityMonitor.on("frameCountChange",this.onPlaybackQualityMetrics)}),e.prototype.stop=freeOnUnref(function(){this.contentSource=null,this.playbackQualityProvider.off("Video","qualityLevel",this.onVideoQualityChanged),this.playbackQualityMonitor.off("frameCountChange",this.onPlaybackQualityMetrics),this.samples=[]}),e})();t.FramerateBasedBitrateCapManager=n}));e(jk);jk.FramerateBasedBitrateCapManager;var qk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("PlatformUnexpectedWaitingMonitor"),n=freeOnUnref(function(){function e(e,t,n,r,i,o){void 0===n&&(n=!1),void 0===r&&(r=2e6),void 0===i&&(i=1e4),void 0===o&&(o=10);var a=this;if(this.contentSource=null,this.currentBitrateBitsPerSec=0,this.maxBitrateBitsPerSecThreshold=Number.MAX_VALUE,this.totalWaitingEventCount=0,this.onUnexpectedWaiting=freeOnUnref(function(){a.slidingWindowEventTracker.recordEvent();var e=a.slidingWindowEventTracker.getEventCountInWindow();a.enableBitrateFiltering&&null!==a.contentSource&&a.currentBitrateBitsPerSec>a.bitrateFloorBitsPerSec&&a.currentBitrateBitsPerSec<=a.maxBitrateBitsPerSecThreshold&&e>=a.waitingCountThreshold&&(l.info(e+" unexpected waiting event occurred in last "+a.timeWindowMs+"ms.Downshift video quality to below "+a.currentBitrateBitsPerSec+" bits per sec."),a.maxBitrateBitsPerSecThreshold=a.currentBitrateBitsPerSec-1,a.contentSource.setMaxBitrateThreshold("Video","UnexpectedWaiting",a.maxBitrateBitsPerSecThreshold),q.metrics.putMetric("StreamRestriction.UnexpectedWaitingQualityFilter",a.maxBitrateBitsPerSecThreshold)),a.totalWaitingEventCount++}),this.onVideoQualityChanged=freeOnUnref(function(e){null!==e&&(a.currentBitrateBitsPerSec=e.bitrateBitsPerSec)}),this.playbackQualityProvider=e,this.readyTracker=t,this.enableBitrateFiltering=n,this.bitrateFloorBitsPerSec=r,this.timeWindowMs=i,this.waitingCountThreshold=o,null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.qualityFilters&&null!=L.configurationStore.configuration.qualityFilters.platformUnexpectedWaiting){var s=L.configurationStore.configuration.qualityFilters.platformUnexpectedWaiting;this.enableBitrateFiltering=s.enabled,null!=s.timeWindowMs&&(this.timeWindowMs=s.timeWindowMs),null!=s.waitingCountThreshold&&(this.waitingCountThreshold=s.waitingCountThreshold),null!=s.filterBitrateFloorBitsPerSec&&(this.bitrateFloorBitsPerSec=s.filterBitrateFloorBitsPerSec)}this.slidingWindowEventTracker=new In.SlidingWindowEventTracker(this.timeWindowMs)}return e.prototype.start=freeOnUnref(function(e){this.contentSource=e,this.readyTracker.on("UnexpectedWaiting",this.onUnexpectedWaiting),this.playbackQualityProvider.on("Video","qualityLevel",this.onVideoQualityChanged)}),e.prototype.stop=freeOnUnref(function(){q.metrics.putMetric("Media.UnexpectedWaiting.Count",this.totalWaitingEventCount),this.contentSource=null,this.totalWaitingEventCount=0,this.playbackQualityProvider.off("Video","qualityLevel",this.onVideoQualityChanged),this.readyTracker.off("UnexpectedWaiting",this.onUnexpectedWaiting)}),e})();t.PlatformUnexpectedWaitingMonitor=n}));e(qk);qk.PlatformUnexpectedWaitingMonitor;var Hk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){var r=this;this.log=new Ka.EphemeralJSLogger("PlaybackStateController"),this.playbackState="paused",this.shouldAutoplay=!1,this.cancelInternalMediaPlayerPlay=null,this.pendingPlayPromise=null,this.hasPendingPublicPause=!1,this.publicPauseStartTime=null,this.pendingUnload=!1,this.onPlaybackStateChange=freeOnUnref(function(e){e.playbackState!==r.playbackState&&(r.playbackState=e.playbackState,r.log.info("PlaybackState change:",r.playbackState),r.useEmitSync?r.eventEmitter.emitSync("playbackStateChange",e):r.eventEmitter.emit("playbackStateChange",e),r.notifyContentStateTransition())}),this.onMediaPlayerPlaying=freeOnUnref(function(){r.mediaPlayer.paused?r.log.info('Ignoring a "playing" event -- mediaPlayer is paused'):(r.log.info('MediaPlayer emitted a "playing" event'),r.shouldAutoplay=!0,r.onPlaybackStateChange({playbackState:"playing",playbackPositionMs:1e3*r.mediaPlayer.currentTime}))}),this.onMediaPlayerPaused=freeOnUnref(function(){if(r.mediaPlayer.paused){if(null!=r.publicPauseStartTime){var e=Date.now()-r.publicPauseStartTime;q.metrics.putMetric("MediaPlayer.PauseInvocation.Time",e,"ms"),r.publicPauseStartTime=null}r.log.info('MediaPlayer emitted a "pause" event'),"waiting"!==r.getContentState()&&(r.mediaPlayer.ended||(r.shouldAutoplay=!1,r.onPlaybackStateChange({playbackState:"paused",playbackPositionMs:1e3*r.mediaPlayer.currentTime,platformTriggered:!r.hasPendingPublicPause}),r.hasPendingPublicPause=!1))}else r.log.info('Ignoring a "pause" event -- mediaPlayer is not paused')}),this.mediaPlayer=e,this.eventEmitter=t,this.getContentState=n,this.useEmitSync=null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.mpPlayerFragment&&!0===L.configurationStore.configuration.mpPlayerFragment.playbackStateChangeUseEmitSync}return e.prototype.load=freeOnUnref(function(){this.mediaPlayer.on("playing",this.onMediaPlayerPlaying),this.mediaPlayer.on("pause",this.onMediaPlayerPaused)}),e.prototype.unload=freeOnUnref(function(){this.playbackState="paused",this.mediaPlayer.off("playing",this.onMediaPlayerPlaying),this.mediaPlayer.off("pause",this.onMediaPlayerPaused),"unloaded"!==this.getContentState()&&(this.pendingUnload=!0)}),e.prototype.play=freeOnUnref(function(){return this.shouldAutoplay=!0,"ready"!==this.getContentState()||this.pendingUnload?(null==this.pendingPlayPromise&&(this.pendingPlayPromise=new lt.Deferred),this.pendingPlayPromise.promise):this.internalPlay()}),e.prototype.pause=freeOnUnref(function(){this.shouldAutoplay=!1,this.mediaPlayer.paused||(this.publicPauseStartTime=Date.now(),this.hasPendingPublicPause=!0),this.mediaPlayer.pause(),this.onPlaybackStateChange({playbackState:"paused",playbackPositionMs:1e3*this.mediaPlayer.currentTime}),null!=this.pendingPlayPromise&&(this.pendingPlayPromise.reject(new Error("Play interrupted by pause")),this.pendingPlayPromise=null)}),e.prototype.notifyContentStateTransition=freeOnUnref(function(){var e=this.getContentState();if(this.log.setId(e),"ready"===e){if(this.mediaPlayer.ended)return;this.shouldAutoplay&&this.mediaPlayer.paused?this.internalPlay():this.shouldAutoplay||this.mediaPlayer.paused||this.internalPause()}else"waiting"!==e||this.mediaPlayer.paused?"unloaded"===e&&(this.pendingUnload=!1):this.internalPause()}),e.prototype.internalPlay=freeOnUnref(function(){var t=this;null==this.pendingPlayPromise&&(this.pendingPlayPromise=new lt.Deferred);var e=lt.CancelToken.source(),n=e.token,r=e.cancel;this.cancelInternalMediaPlayerPlay=r;var i=this.pendingPlayPromise;return this.log.info("Invoking mediaPlayer.play()"),this.mediaPlayer.play().then(freeOnUnref(function(){t.log.info("MediaPlayer.play promise resolved"),i===t.pendingPlayPromise&&(t.pendingPlayPromise.resolve(),t.pendingPlayPromise=null),t.onPlaybackStateChange({playbackState:"playing",playbackPositionMs:1e3*t.mediaPlayer.currentTime})})).catch(freeOnUnref(function(e){n.requested||(t.log.warn("MediaPlayer.play rejection. Explicitly setting PlaybackState.Paused:",e),t.onPlaybackStateChange({playbackState:"paused",playbackPositionMs:1e3*t.mediaPlayer.currentTime}),i===t.pendingPlayPromise&&(t.pendingPlayPromise.reject(e),t.pendingPlayPromise=null))})),this.pendingPlayPromise.promise}),e.prototype.internalPause=freeOnUnref(function(){null!=this.cancelInternalMediaPlayerPlay&&(this.cancelInternalMediaPlayerPlay(),this.cancelInternalMediaPlayerPlay=null),this.log.info("Invoking mediaPlayer.pause()"),this.mediaPlayer.pause()}),e})();t.PlaybackStateController=n}));e(Hk);Hk.PlaybackStateController;var zk=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var g=new Ka.EphemeralJSLogger("ReadyTracker"),v=((n={}).waiting="waiting",n.ready="ready",n),r=freeOnUnref(function(){function e(e,t,n,r,i,o,a){var s=this;this.mpBufferInformationProvider=null,this.bufferReason=null,this.contentSource=null,this.eventEmitter=new A.EventEmitter,this.isMediaPlayerWaitingForKey=!1,this.inMemoryReadyBufferSizeThresholdMs=6e3,this.lastBufferLogTimestampMs=0,this.seekAndReadyTimeoutMs=null,this.enableSeekAndReadyTimeout=!1,this.hasReportedBufferedToStart=!1,this.hasReportedMediaPlayerReady=!1,this.readyTrackerStartTime=null,this.onWaiting=freeOnUnref(function(){if(s.contentLevelAdapter.on("progress",s.checkState),null!==s.contentSource)for(var e=0,t=s.contentSource.streamTypes;e<t.length;e++){var n=t[e];s.contentSource.getFragmentSource(n).onUpdate(s.checkState)}}),this.offWaiting=freeOnUnref(function(){if(s.contentLevelAdapter.off("progress",s.checkState),null!==s.contentSource)for(var e=0,t=s.contentSource.streamTypes;e<t.length;e++){var n=t[e];s.contentSource.getFragmentSource(n).offUpdate(s.checkState)}}),this.onMediaPlayerWaiting=freeOnUnref(function(){g.info('MediaPlayer emitted a "waiting" event'),2===s.mediaPlayer.readyState?(g.info('Ignoring MediaPlayer "waiting" event while readyState is sufficient'),q.metrics.putMetric("Media.ReceivedWaitingEventWithSufficientReadyState")):s.internalCheckState(!0)}),this.onMediaPlayerCanPlay=freeOnUnref(function(){g.info('MediaPlayer emitted a "canplay" event'),"waiting"===s.contentStateMachine.state?s.checkState():g.info('Ignoring MediaPlayer "canplay" event when not Waiting')}),this.onMediaPlayerSeeked=freeOnUnref(function(){g.info('MediaPlayer emitted a "seeked" event'),"waiting"===s.contentStateMachine.state?s.checkState():g.info('Ignoring MediaPlayer "seeked" event when not Waiting')}),this.checkState=freeOnUnref(function(){s.internalCheckState(!1)}),this.onWaitingForKey=freeOnUnref(function(){s.isMediaPlayerWaitingForKey=!0}),this.intervalMsToSec=freeOnUnref(function(e){return{start:e.start/1e3,end:e.end/1e3}}),this.mediaPlayer=e,this.contentLevelAdapter=t,this.contentStateMachine=n,this.seekController=r,this.appendTimeBitrateFilterManager=i,this.timestampPaddingSec=o,this.traceEventController=a,this.contentStateMachine.onStateChange(freeOnUnref(function(e){return g.setId(e)})),this.contentStateMachine.onEnterState("waiting",this.onWaiting),this.contentStateMachine.onLeaveState("waiting",this.offWaiting),this.diagnostics=nn.Diagnostics.create("ReadyTracker"),this.sourceBufferReadyLengthMs=Qe.nestedValue(zt.deviceInformation.mediaSource,"sourceBufferReadyLengthMs",500),this.midBufferLogThrottleFrequencyMs=1/0,null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.readyTracker&&null!=L.configurationStore.configuration.readyTracker.midBufferLogThrottleFrequencyMs&&(this.midBufferLogThrottleFrequencyMs=L.configurationStore.configuration.readyTracker.midBufferLogThrottleFrequencyMs),null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.readyTracker&&"enabled"===L.configurationStore.configuration.readyTracker.seekAndReadyTimeout&&(this.enableSeekAndReadyTimeout=!0)}return e.prototype.start=freeOnUnref(function(e,t){this.readyTrackerStartTime=Date.now(),null!==this.contentSource&&g.warn("Started multiple times before stop"),this.contentSource=e,this.mpBufferInformationProvider=t,null!=this.traceEventController&&(this.traceEventController.reportTraceStart("PlaybackStartup","BufferedToStart","BufferFill",{fragmentBufferReadyLengthMs:this.inMemoryReadyBufferSizeThresholdMs.toString(),sourceBufferReadyLength:this.sourceBufferReadyLengthMs.toString()}),this.traceEventController.reportTraceStart("PlaybackStartup","MediaPlayerReady","OS",{fragmentBufferReadyLengthMs:this.inMemoryReadyBufferSizeThresholdMs.toString(),sourceBufferReadyLength:this.sourceBufferReadyLengthMs.toString()}));var n=e.getBufferInformationCalculator().bufferSettings;null!=n&&null!=n.bufferFullnessForPlaybackStartSeconds&&(this.inMemoryReadyBufferSizeThresholdMs=1e3*n.bufferFullnessForPlaybackStartSeconds);var r=this.mediaPlayer;if(r.on("waiting",this.onMediaPlayerWaiting),r.on("canplay",this.onMediaPlayerCanPlay),r.on("seeked",this.onMediaPlayerSeeked),r.on("waitingforkey",this.onWaitingForKey),"waiting"===this.contentStateMachine.state)for(var i=0,o=this.contentSource.streamTypes;i<o.length;i++){var a=o[i];this.contentSource.getFragmentSource(a).onUpdate(this.checkState)}this.diagnostics.report("ttff",{readyTrackerStartTime:this.readyTrackerStartTime,fragmentBufferReadyLengthMs:this.inMemoryReadyBufferSizeThresholdMs,sourceBufferReadyLengthMs:this.sourceBufferReadyLengthMs})}),e.prototype.stop=freeOnUnref(function(){this.contentLevelAdapter.off("progress",this.checkState);var e=this.mediaPlayer;if(e.off("waiting",this.onMediaPlayerWaiting),e.off("canplay",this.onMediaPlayerCanPlay),e.off("seeked",this.onMediaPlayerSeeked),e.off("waitingforkey",this.onWaitingForKey),null!==this.contentSource)for(var t=0,n=this.contentSource.streamTypes;t<n.length;t++){var r=n[t];this.contentSource.getFragmentSource(r).offUpdate(this.checkState)}null!=this.seekAndReadyTimeoutMs&&(oe.timer.clearTimeout(this.seekAndReadyTimeoutMs),this.seekAndReadyTimeoutMs=null),this.mpBufferInformationProvider=null,this.contentSource=null,this.inMemoryReadyBufferSizeThresholdMs=6e3,this.isMediaPlayerWaitingForKey=!1,this.bufferReason=null,this.diagnostics.report("state",null),this.hasReportedBufferedToStart=!1,this.hasReportedMediaPlayerReady=!1,this.readyTrackerStartTime=null}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.internalCheckState=freeOnUnref(function(e){null!==this.contentSource&&(2===this.mediaPlayer.readyState&&(this.isMediaPlayerWaitingForKey=!1),this.contentStateMachine.act(this.getContentActionFromComponents(e)))}),e.prototype.isSourceBufferBufferedToMemoryCapacity=freeOnUnref(function(e){if(null===this.contentSource)return!1;if(!e.isInMemoryBufferedToEnd&&!e.isInMemoryBufferedToCapacity)return!1;var t=1e3*this.mediaPlayer.currentTime,n=this.contentSource.getBufferInformationCalculator().getBufferedRanges(vu.CRITICAL_STREAM_TYPES).find(t,ak.MAX_PLAY_HEAD_GAP_ALLOWED_MS),r=this.contentLevelAdapter.getBufferedRanges(vu.CRITICAL_STREAM_TYPES).find(t,ak.MAX_PLAY_HEAD_GAP_ALLOWED_MS);return null!==n&&null!==r&&Math.abs(r.end-n.end)<150}),e.prototype.isPlayable=freeOnUnref(function(e){return e.inMemoryBufferSizeMs>this.inMemoryReadyBufferSizeThresholdMs&&e.sourceBufferSizeMs>this.sourceBufferReadyLengthMs||!(!e.isInMemoryBufferedToEnd&&!e.isInMemoryBufferedToCapacity||!(e.sourceBufferSizeMs>this.sourceBufferReadyLengthMs||this.isSourceBufferBufferedToMemoryCapacity(e)))}),e.prototype.collectBufferStatus=freeOnUnref(function(){var e={inMemoryBufferSizeMs:0,sourceBufferSizeMs:0,isInMemoryBufferedToEnd:!1,isInMemoryBufferedToCapacity:!1};null!==this.mpBufferInformationProvider&&(e.inMemoryBufferSizeMs=this.mpBufferInformationProvider.getFrontBufferLengthMs(vu.CRITICAL_STREAM_TYPES),e.isInMemoryBufferedToEnd=this.mpBufferInformationProvider.isBufferedToEnd(vu.CRITICAL_STREAM_TYPES));var t=1e3*this.mediaPlayer.currentTime;if(null!==this.contentSource){var n=this.contentSource.getBufferInformationCalculator();e.isInMemoryBufferedToCapacity=n.isBufferedToCapacity(t)}var r=this.contentLevelAdapter.getBufferedRanges(vu.CRITICAL_STREAM_TYPES).find(t,ak.MAX_PLAY_HEAD_GAP_ALLOWED_MS);return null!==r&&(e.sourceBufferSizeMs=r.end-t),e}),e.prototype.getContentActionFromComponents=freeOnUnref(function(e){var t=this;if(null===this.contentSource)return"waiting";var n=!this.mediaPlayer.seeking&&2===this.mediaPlayer.readyState,r=this.collectBufferStatus(),i=this.isPlayable(r),o=n&&i?"ready":"waiting";this.reportTtffProfiling(i,n),"ready"===o&&null!=this.seekAndReadyTimeoutMs&&(oe.timer.clearTimeout(this.seekAndReadyTimeoutMs),this.seekAndReadyTimeoutMs=null),i&&"waiting"===o&&null==this.seekAndReadyTimeoutMs&&this.enableSeekAndReadyTimeout&&(this.seekAndReadyTimeoutMs=oe.timer.setTimeout(freeOnUnref(function(){t.mediaPlayer.seeking?t.contentStateMachine.act("error",new Error("Media player did not finish seeking in 4000 ms")):2!==t.mediaPlayer.readyState&&t.contentStateMachine.act("error",new Error("Media player did not become ready in 4000 ms"))}),4e3)),e&&!this.isMediaPlayerWaitingForKey&&!this.mediaPlayer.seeking&&i&&this.eventEmitter.emit("UnexpectedWaiting");for(var a={},s={},l=0,f=this.contentSource.streamTypes;l<f.length;l++){var u=f[l];a[u]=this.contentSource.getBufferInformationCalculator().getBufferedRanges(u).getIntervals().map(this.intervalMsToSec),s[u]=this.contentLevelAdapter.getBufferedRanges(u).getIntervals().map(this.intervalMsToSec)}for(var c={},d=0,p=this.contentSource.streamTypes;d<p.length;d++){var h=p[d];c[h]=this.appendTimeBitrateFilterManager.getWindowedSamples(h)}"ready"===this.contentStateMachine.state&&"waiting"===o&&(this.bufferReason=this.getBufferReason(r),null!=this.contentSource&&this.contentSource.onRebuffer(),this.eventEmitter.emit("Stall",this.bufferReason));var m={contentAction:o,readyState:this.mediaPlayer.readyState,mediaPlayerCurrentTimeSec:this.mediaPlayer.currentTime,mediaPlayerDurationSec:this.mediaPlayer.duration,mediaPlayerEnded:this.mediaPlayer.ended,playheadTimeSec:this.seekController.getPositionMs()/1e3,isMediaPlayerWaitingForKey:this.isMediaPlayerWaitingForKey,seeking:this.mediaPlayer.seeking,reductionTermSec:this.contentSource.minimumPlayablePositionMs/1e3-this.timestampPaddingSec,inMemoryBufferedSec:a,inMemoryBufferSizeSec:r.inMemoryBufferSizeMs/1e3,inMemoryReadyBufferSizeThresholdSec:this.inMemoryReadyBufferSizeThresholdMs/1e3,sourceBufferRangesSec:s,sourceBufferSizeSec:r.sourceBufferSizeMs/1e3,sourceBufferReadyLengthSec:this.sourceBufferReadyLengthMs/1e3,mediaPlayerBufferSec:this.createIntervals(this.mediaPlayer.buffered),isBufferedToEnd:r.isInMemoryBufferedToEnd,isInMemoryBufferedToCapacity:r.isInMemoryBufferedToCapacity,appendTimeSamples:c,bufferReason:this.bufferReason,timestamp:Date.now()};if("waiting"===this.contentStateMachine.state&&"ready"===o&&(this.bufferReason=null),this.diagnostics.report("state",m),(this.contentStateMachine.state!==v[o]||Date.now()>this.lastBufferLogTimestampMs+this.midBufferLogThrottleFrequencyMs)&&(g.info(JSON.stringify(m)),this.lastBufferLogTimestampMs=Date.now()),"ready"===o){var y=this.contentSource.getBufferInformationCalculator().bufferSettings;null!=y&&null!=y.bufferFullnessForPlaybackResumeSeconds&&(this.inMemoryReadyBufferSizeThresholdMs=1e3*y.bufferFullnessForPlaybackResumeSeconds)}return o}),e.prototype.getBufferReason=freeOnUnref(function(e){if(1<this.mediaPlayer.buffered.length)return"MediaPlayer.BufferedRangesGap";if(this.isMediaPlayerWaitingForKey)return"MediaPlayer.WaitingForKey";if(e.inMemoryBufferSizeMs<500&&!e.isInMemoryBufferedToEnd){for(var t=1e3*this.mediaPlayer.currentTime,n=0,r=vu.CRITICAL_STREAM_TYPES;n<r.length;n++){var i=r[n];if(null===this.contentSource)break;if(0===(s=this.contentSource.getBufferInformationCalculator().getBufferedRanges(i)).getIntervals().length)return"InMemory.EmptyBuffer."+i;if(this.hasGapNearCurrentPosition(t,s))return"InMemory.GapNearPosition."+i}return"InMemory.InsufficientBufferSize"}if(e.sourceBufferSizeMs<500&&!this.isSourceBufferBufferedToMemoryCapacity(e)){t=1e3*this.mediaPlayer.currentTime;for(var o=0,a=vu.CRITICAL_STREAM_TYPES;o<a.length;o++){i=a[o];var s,l=(s=this.contentLevelAdapter.getBufferedRanges(i)).getIntervals();if(0===l.length)return"SourceBuffer.EmptyBuffer."+i;if(this.hasGapNearCurrentPosition(t,s))return"SourceBuffer.GapNearPosition."+i;if(this.seekController.getPositionMs()<l[0].start)return"SourceBuffer.PlayheadBehindBuffer."+i}return"SourceBuffer.InsufficientBufferSize"}return 2!==this.mediaPlayer.readyState?"MediaPlayer.InsufficientReadyState."+this.mediaPlayer.readyState:this.mediaPlayer.seeking?"MediaPlayer.Seeking":e.inMemoryBufferSizeMs<this.inMemoryReadyBufferSizeThresholdMs?"InMemory.BufferBelowReadyThreshold":e.sourceBufferSizeMs<this.sourceBufferReadyLengthMs?"SourceBuffer.BufferBelowReadyThreshold":"Unknown"}),e.prototype.createIntervals=freeOnUnref(function(e){for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}),e.prototype.hasGapNearCurrentPosition=freeOnUnref(function(e,t){var n=t.getIntervals();if(n.length<=1)return!1;for(var r=0;r<n.length-1;r++){var i=n[r];if(Math.abs(i.end-e)<250)return!0}return!1}),e.prototype.reportTtffProfiling=freeOnUnref(function(e,t){if(null!=this.readyTrackerStartTime){if(e&&!this.hasReportedBufferedToStart){var n=Date.now();this.diagnostics.report("ttff",{bufferedToStartTime:n});var r=n-this.readyTrackerStartTime;if(q.metrics.putMetric("MediaPlayer.BufferedToStart.Time",r),g.info("[TTFF] Time for media player to be buffered to start took "+r+" ms"),null!=this.traceEventController){var i=this.collectBufferStatus();this.traceEventController.reportTraceStop("PlaybackStartup","BufferedToStart","Success","BufferFill",{bufferSize:i.inMemoryBufferSizeMs.toString(),readyThreshold:this.inMemoryReadyBufferSizeThresholdMs.toString(),sourceBufferSize:i.sourceBufferSizeMs.toString(),currentTime:this.mediaPlayer.currentTime.toString(),duration:r.toString(),isBufferedToEnd:i.isInMemoryBufferedToEnd.toString()})}this.hasReportedBufferedToStart=!0}if(t&&!this.hasReportedMediaPlayerReady){n=Date.now();this.diagnostics.report("ttff",{mediaPlayerReadyTime:n});var o=n-this.readyTrackerStartTime;if(q.metrics.putMetric("MediaPlayer.Ready.Time",o),g.info("[TTFF] Time for media player to be ready took "+o+" ms"),null!=this.traceEventController){i=this.collectBufferStatus();this.traceEventController.reportTraceStop("PlaybackStartup","MediaPlayerReady","Success","OS",{readyState:this.mediaPlayer.readyState.toString(),currentTime:this.mediaPlayer.currentTime.toString(),mediaDuration:this.mediaPlayer.duration.toString(),ended:this.mediaPlayer.ended.toString(),duration:o.toString(),bufferSize:i.inMemoryBufferSizeMs.toString(),sourceBufferSize:i.sourceBufferSizeMs.toString()})}this.hasReportedMediaPlayerReady=!0}}}),e})();t.ReadyTracker=r}));e(zk);zk.ReadyTracker;var Wk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("SeekController"),n=freeOnUnref(function(){function e(e,t){this.currentPositionMs=null,this.isMpPlayerReinitializing=!1,this.loaded=!1,this.seekPromise=null,this.mediaPlayer=e,this.contentLevelAdapter=t,this.diagnostics=nn.Diagnostics.create("SeekController"),this.state={currentPositionMs:null,isMpPlayerReinitializing:!1,loaded:!1,mediaPlayerBufferSec:[],mediaPlayerCurrentTimeSec:0,mediaPlayerDuration:Number.NaN,mediaPlayerReadyState:0,seeking:!1}}return Object.defineProperty(e.prototype,"isSeeking",{get:freeOnUnref(function(){return null!=this.seekPromise}),enumerable:!0,configurable:!0}),e.prototype.getPositionMs=freeOnUnref(function(){return!this.loaded||this.isSeeking||this.isMpPlayerReinitializing?null!=this.currentPositionMs?this.currentPositionMs:0:1e3*this.mediaPlayer.currentTime}),e.prototype.seek=freeOnUnref(function(e){var t=this;a.info(">> seek with positionMs: "+e);var n=void 0;if(null!=this.seekPromise&&(n=this.seekPromise,this.clearSeekingOperations()),this.currentPositionMs=e,this.loaded){var r=lt.CancelToken.source(),i=r.token,o=r.cancel;this.cancelSetPosition=o,this.seekPromise=lt.Promise.resolve(n).then(freeOnUnref(function(){if(isNaN(t.mediaPlayer.duration)||t.mediaPlayer.duration===1/0||0===t.mediaPlayer.readyState)return t.logOperation("Wait for buffer"),t.waitForBuffer(i).then(freeOnUnref(function(){i.throwIfRequested(),t.mediaPlayer.currentTime=e/1e3,t.seekPromise=null,t.logOperation("Seek on MediaPlayer")})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||(t.seekPromise=null,a.error("Live: Error seeking to new position",e),t.logOperation("Live: Error seeking to new position, "+e))}));t.mediaPlayer.currentTime=e/1e3,t.seekPromise=null,t.logOperation("Seek on MediaPlayer")})).catch(freeOnUnref(function(e){a.error("Error during seek: ",e)}))}}),Object.defineProperty(e.prototype,"isReinitializing",{get:freeOnUnref(function(){return this.isMpPlayerReinitializing}),set:freeOnUnref(function(e){this.isMpPlayerReinitializing=e}),enumerable:!0,configurable:!0}),e.prototype.unload=freeOnUnref(function(){this.loaded=!1,this.isMpPlayerReinitializing=!1,this.clearSeekingOperations(),this.seekPromise=null,this.logOperation("Unload")}),e.prototype.load=freeOnUnref(function(){this.loaded||(this.loaded=!0,null!=this.currentPositionMs&&this.seek(this.currentPositionMs))}),e.prototype.clearSeekingOperations=freeOnUnref(function(){(this.currentPositionMs=null)!=this.cancelSetPosition&&(this.cancelSetPosition(),delete this.cancelSetPosition)}),e.prototype.isLoadedWithBuffer=freeOnUnref(function(){if(this.emitState(),0===this.mediaPlayer.readyState||0===this.mediaPlayer.buffered.length||null===this.currentPositionMs)return!1;for(var e=this.mediaPlayer.buffered,t=0;t<e.length;t++)if(1e3*e.start(t)<=this.currentPositionMs+ak.MAX_PLAY_HEAD_GAP_ALLOWED_MS&&this.currentPositionMs<=1e3*e.end(t))return!0;return!1}),e.prototype.waitForBuffer=freeOnUnref(function(r){var i=this;return new lt.Promise(freeOnUnref(function(e,t){if(i.isLoadedWithBuffer())e();else{var n=freeOnUnref(function(){i.isLoadedWithBuffer()&&(i.contentLevelAdapter.off("progress",n),i.mediaPlayer.off("loadedmetadata",n),e())});r.promise.then(freeOnUnref(function(e){i.contentLevelAdapter.off("progress",n),i.mediaPlayer.off("loadedmetadata",n),t(e)})),i.contentLevelAdapter.on("progress",n),i.mediaPlayer.on("loadedmetadata",n)}}))}),e.prototype.logOperation=freeOnUnref(function(e){try{this.state.lastOperation=e,this.state.lastOperationTimestamp=Date.now(),this.emitState()}catch(e){a.error("Failed to log operation: ",e)}}),e.prototype.emitState=freeOnUnref(function(){this.state.currentPositionMs=this.currentPositionMs,this.state.isMpPlayerReinitializing=this.isMpPlayerReinitializing,this.state.loaded=this.loaded,this.state.mediaPlayerBufferSec=this.createIntervals(this.mediaPlayer.buffered),this.state.mediaPlayerCurrentTimeSec=this.mediaPlayer.currentTime,this.state.mediaPlayerDuration=this.mediaPlayer.duration,this.state.mediaPlayerReadyState=this.mediaPlayer.readyState,this.state.seeking=this.isSeeking,this.diagnostics.report("state",this.state)}),e.prototype.createIntervals=freeOnUnref(function(e){for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}),e})();t.SeekController=n}));e(Wk);Wk.SeekController;var Kk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("TimeOffsettingMediaPlayer"),n=freeOnUnref(function(){function e(e){var r=this;this.onTimeUpdate=freeOnUnref(function(){for(var e=0,t=r.timeUpdateListeners;e<t.length;e++){var n=t[e];try{n()}catch(e){i.error('Listener for the "timeupdate" event threw an error',e)}}}),this.mediaPlayer=e,this.timestampOffsetSec=0,this.timeUpdateListeners=[],this.mediaPlayer.on("timeupdate",this.onTimeUpdate)}return e.prototype.setTimestampOffset=freeOnUnref(function(e){this.timestampOffsetSec=e}),e.prototype.destroy=freeOnUnref(function(){this.mediaPlayer.off("timeupdate",this.onTimeUpdate),this.mediaPlayer.destroy()}),Object.defineProperty(e.prototype,"textTracks",{get:freeOnUnref(function(){return this.mediaPlayer.textTracks}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:freeOnUnref(function(){return this.mediaPlayer.error}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seekable",{get:freeOnUnref(function(){var t=this,n=this.mediaPlayer.seekable;return{length:n.length,end:freeOnUnref(function(e){return n.end(e)-t.timestampOffsetSec}),start:freeOnUnref(function(e){return n.start(e)-t.timestampOffsetSec})}}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seeking",{get:freeOnUnref(function(){return this.mediaPlayer.seeking}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:freeOnUnref(function(){return Math.max(this.mediaPlayer.currentTime-this.timestampOffsetSec,0)}),set:freeOnUnref(function(e){this.mediaPlayer.currentTime=e+this.timestampOffsetSec}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:freeOnUnref(function(){return this.mediaPlayer.duration}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:freeOnUnref(function(){return this.mediaPlayer.ended}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:freeOnUnref(function(){return this.mediaPlayer.readyState}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:freeOnUnref(function(){var t=this,n=this.mediaPlayer.buffered;return{length:n.length,end:freeOnUnref(function(e){return Math.max(n.end(e)-t.timestampOffsetSec,0)}),start:freeOnUnref(function(e){return Math.max(n.start(e)-t.timestampOffsetSec,0)})}}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mediaKeys",{get:freeOnUnref(function(){return this.mediaPlayer.mediaKeys}),enumerable:!0,configurable:!0}),e.prototype.setMediaKeys=freeOnUnref(function(e){return this.mediaPlayer.setMediaKeys(e)}),Object.defineProperty(e.prototype,"mediaSource",{get:freeOnUnref(function(){return this.mediaPlayer.mediaSource}),set:freeOnUnref(function(e){this.mediaPlayer.mediaSource=e}),enumerable:!0,configurable:!0}),e.prototype.pause=freeOnUnref(function(){this.mediaPlayer.pause()}),e.prototype.play=freeOnUnref(function(){return this.mediaPlayer.play()}),Object.defineProperty(e.prototype,"paused",{get:freeOnUnref(function(){return this.mediaPlayer.paused}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:freeOnUnref(function(){return this.mediaPlayer.playbackRate}),set:freeOnUnref(function(e){this.mediaPlayer.playbackRate=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suggestedPictureModes",{get:freeOnUnref(function(){return this.mediaPlayer.suggestedPictureModes}),set:freeOnUnref(function(e){this.mediaPlayer.suggestedPictureModes=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerViewport",{get:freeOnUnref(function(){return this.mediaPlayer.playerViewport}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){return this.mediaPlayer.volume}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pictureInPicture",{get:freeOnUnref(function(){return this.mediaPlayer.pictureInPicture}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:freeOnUnref(function(){return this.mediaPlayer.metadata}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mediaPlayerConfig",{set:freeOnUnref(function(e){this.mediaPlayer.mediaPlayerConfig=e}),enumerable:!0,configurable:!0}),e.prototype.on=freeOnUnref(function(e,t){"timeupdate"===e?this.timeUpdateListeners.push(t):this.mediaPlayer.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){"timeupdate"===e?this.timeUpdateListeners=x.without(this.timeUpdateListeners,t):this.mediaPlayer.off(e,t)}),e.prototype.getVideoPlaybackQuality=freeOnUnref(function(){return this.mediaPlayer.getVideoPlaybackQuality()}),e.prototype.show=freeOnUnref(function(){this.mediaPlayer.show()}),e.prototype.hide=freeOnUnref(function(){this.mediaPlayer.hide()}),e})();t.TimeOffsettingMediaPlayer=n}));e(Kk);Kk.TimeOffsettingMediaPlayer;var Gk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("TimeUpdateFrequencyTracker"),n=freeOnUnref(function(){function e(e){this.lastKnownPositionMs=0,this.lastTimeUpdateTimeMs=Date.now(),this.mediaStallTimeoutId=null,this.mediaPlayer=e,this.frequencyTracker=new In.RunningSampleTracker}return e.prototype.start=freeOnUnref(function(e){this.lastKnownPositionMs=e,this.lastTimeUpdateTimeMs=Date.now()}),e.prototype.stop=freeOnUnref(function(){var e=this.frequencyTracker.average();null!=e&&q.metrics.putMetric("Media.TimeUpdateFrequency.Average",e,"ms");var t=this.frequencyTracker.stdDev();null!=t&&q.metrics.putMetric("Media.TimeUpdateFrequency.StdDev",t,"ms"),this.frequencyTracker=new In.RunningSampleTracker,this.clearMediaStallTimer()}),e.prototype.onTimeUpdate=freeOnUnref(function(e){var t=Date.now()-this.lastTimeUpdateTimeMs,n=e-this.lastKnownPositionMs;2e3<n&&r.warn("'timeupdate' occurred after "+t+"ms with a position change of "+n+"ms between successive updates"),e!==this.lastKnownPositionMs&&this.setMediaStallTimer(),this.lastKnownPositionMs=e,this.lastTimeUpdateTimeMs=Date.now(),this.frequencyTracker.addSample(t)}),e.prototype.setMediaStallTimer=freeOnUnref(function(){var e=this;this.clearMediaStallTimer(),this.mediaStallTimeoutId=oe.timer.setTimeout(freeOnUnref(function(){2!==e.mediaPlayer.readyState||e.mediaPlayer.seeking||e.mediaPlayer.paused||r.warn("Media player should be playing but position is not updated for 2000ms")}),2e3)}),e.prototype.clearMediaStallTimer=freeOnUnref(function(){null!==this.mediaStallTimeoutId&&(oe.timer.clearTimeout(this.mediaStallTimeoutId),this.mediaStallTimeoutId=null)}),e})();t.TimeUpdateFrequencyTracker=n}));e(Gk);Gk.TimeUpdateFrequencyTracker;var Qk=t(freeOnUnref(function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0});var o=((n={}).None="None",n.Filmmaker="Filmmaker",n.CalibratedBroadcast="CalibratedBroadcast",n.CalibratedCinematic="CalibratedCinematic",n),a=((r={}).None="None",r.Filmmaker="Filmmaker",r.CalibratedBroadcast="CalibratedBroadcast",r.CalibratedCinematic="CalibratedCinematic",r),i=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.contentState="unloaded",this.log=new Ka.EphemeralJSLogger("MpPlayerFragment"),this.codecSwitchStreamType=null,this.contentSource=null,this.eventEmitter=new A.EventEmitter,this.reinitializeStartMs=null,this.onLoad=freeOnUnref(function(e){i.bufferInformationProvider.load(e),i.playbackStateController.load(),(i.contentSource=e).on("positionAdjusted",i.onPositionAdjusted),i.contentSource.onContentFlushed=freeOnUnref(function(e){i.contentLevelAdapter.flushStream(e)}),i.contentSource.onStreamMetadataChanged=freeOnUnref(function(e,t){i.onStreamMetadataChanged(e,t)}),i.contentSource.playerViewportCallback=freeOnUnref(function(){var e=i.mediaPlayer.playerViewport;return null!=e?e:null}),i.contentSource.getFrontBufferDurationMsCallback=freeOnUnref(function(e){return i.bufferInformationProvider.getFrontBufferLengthMs([e])}),i.contentSource.getSourceBufferInfoCallback=freeOnUnref(function(){return{maxDurationMs:dk.FrontBufferLoadBarrier.getMaxFrontBufferSizeMs()}}),i.contentSource.onContentDurationChanged=freeOnUnref(function(){i.onContentDurationChanged()});var t=[];null!=e.suggestedPictureModes&&(t=e.suggestedPictureModes.filter(freeOnUnref(function(e){return null!=e})).map(freeOnUnref(function(e){return a[e]}))),i.mediaPlayer.suggestedPictureModes=t,i.mediaPlayer.mediaPlayerConfig=e.mediaPlayerConfig,i.contentLevelAdapter.on("initialized",i.onInitialized),i.contentLevelAdapter.initialize(),i.playbackQualityMonitor.start(),i.framerateBasedBitrateCapManager.start(e),i.platformUnexpectedWaitingMonitor.start(e),i.appendTimeBitrateFilterManager.load(e),i.contentLevelAdapter.on("progress",i.onSegmentAppended),i.timeUpdateFrequencyTracker.start(i.seekController.getPositionMs())}),this.onSegmentAppended=freeOnUnref(function(e){if(null!==i.contentSource){var t=e.appendTimeMs,n=e.fragment.position.durationMs,r=e.fragment.type;"Video"!==r&&"Audio"!==r||i.eventEmitter.emit("fragmentLoad",{streamType:r,durationMs:n,appendTimeMs:t})}}),this.onReinitializing=freeOnUnref(function(e){i.log.info(">> onReinitializing"),i.mediaPlayerEventTracker.removeAllListeners(),null!=e&&i.eventEmitter.emit("stall",{expected:e.expected,reason:e.reason}),i.removeContentLevelAdapterListeners(),i.contentLevelAdapter.on("uninitialized",i.onUninitialized),i.contentLevelAdapter.terminate()}),this.onStreamMetadataChanged=freeOnUnref(function(e,t){i.log.info("Reinitializing the content buffers"),i.codecSwitchStreamType=e,i.reinitializeStartMs=Date.now(),i.seekController.isReinitializing=!0,i.seekController.seek(t),i.mpPlayerStateMachine.act("reinitialize",{expected:!0,reason:"CodecSwitch."+e})}),this.onContentDurationChanged=freeOnUnref(function(){var e=i.mediaPlayer.mediaSource;if(null!=e)if(null!=i.contentSource){var t=e.duration,n=i.contentSource.getDurationMs()/1e3;t!==n&&(i.log.info("Received onContentDurationChanged. Updating MediaSource duration from "+t+"s -> "+n+"s ("+(t<n?"added":"removed")+" "+Math.abs(n-t)+"s)."),e.duration=n)}else i.log.warn("Received onContentDurationChanged but ContentSource is null (likely unloaded already). Ignoring.");else i.log.warn("Received onContentDurationChanged but MediaSource is not set on MediaPlayer. Ignoring.")}),this.onInitialized=freeOnUnref(function(){if(i.contentLevelAdapter.off("initialized",i.onInitialized),null!==i.contentSource){i.readyTracker.start(i.contentSource,i.bufferInformationProvider),i.addMediaPlayerPlaybackListeners(i.contentSource);var e=i.contentSource.minimumPlayablePositionMs-1e3*i.timestampPaddingSec;i.mediaPlayer.setTimestampOffset(-e/1e3),i.drmController.load(i.contentSource),i.contentLevelAdapter.on("needsContent",i.onNeedsContent),i.contentLevelAdapter.prepare(i.contentSource.streamMetadata,-e/1e3)}}),this.onFinishedReinitialization=freeOnUnref(function(){var e=i.seekController.getPositionMs();i.seekController.isReinitializing=!1,i.seek(e),q.metrics.putMetric("MpPlayerRestart.CodecSwitch."+i.codecSwitchStreamType,Date.now()-i.reinitializeStartMs)}),this.onNeedsContent=freeOnUnref(function(){i.contentLevelAdapter.off("needsContent",i.onNeedsContent),null!==i.contentSource&&(i.contentLevelAdapter.on("ready",i.onReady),i.contentLevelAdapter.attachContent(i.contentSource))}),this.onReady=freeOnUnref(function(){i.contentLevelAdapter.off("ready",i.onReady),i.seekController.load(),i.mpPlayerStateMachine.act("contentLevelAdapterReady")}),this.onUninitialized=freeOnUnref(function(){i.contentLevelAdapter.off("uninitialized",i.onUninitialized),i.contentLevelAdapter.on("initialized",i.onInitialized),i.contentLevelAdapter.initialize()}),this.onEnterUnloading=freeOnUnref(function(){if(i.isUnloadedOnRemovedMediaSource&&null==i.mediaPlayer.mediaSource||!i.isUnloadedOnRemovedMediaSource&&0===i.mediaPlayer.readyState)return i.log.info("MediaPlayer already unloaded. mediaSource exists:"+(null!=i.mediaPlayer.mediaSource)+", readyState:"+i.mediaPlayer.readyState),void i.mpPlayerStateMachine.act("unloaded");var e=freeOnUnref(function(){i.log.info("MediaPlayer emptied"),i.mediaPlayer.off("emptied",e),i.mpPlayerStateMachine.act("unloaded")});i.mediaPlayer.on("emptied",e)}),this.onUnload=freeOnUnref(function(){delete i.contentError,null!==i.contentSource&&(i.contentLevelAdapter.off("progress",i.onSegmentAppended),i.appendTimeBitrateFilterManager.unload(),i.timeUpdateFrequencyTracker.stop(),i.playbackStateController.unload(),i.readyTracker.off("Stall",i.onReadyTrackerRebuffer),i.readyTracker.stop(),i.mediaPlayerEventTracker.removeAllListeners(),i.seekController.unload(),i.bufferInformationProvider.unload(),i.playbackQualityMonitor.stop(),i.framerateBasedBitrateCapManager.stop(),i.platformUnexpectedWaitingMonitor.stop(),i.removeContentLevelAdapterListeners(),delete i.contentSource.onContentFlushed,delete i.contentSource.onStreamMetadataChanged,i.contentSource.playerViewportCallback=null,i.contentSource.getFrontBufferDurationMsCallback=null,i.contentSource.getSourceBufferInfoCallback=null,i.contentSource.onContentDurationChanged=null,i.contentSource.off("positionAdjusted",i.onPositionAdjusted),i.contentSource=null,i.contentLevelAdapter.terminate())}),this.onPositionAdjusted=freeOnUnref(function(e){i.log.info("Requested content position adjusted. Seeking to new position "+e+"ms"),i.seek(e)}),this.onPictureModeChange=freeOnUnref(function(e){i.eventEmitter.emit("pictureModeChange",o[e])}),this.onReadyTrackerRebuffer=freeOnUnref(function(e){i.eventEmitter.emit("stall",{expected:!1,reason:e})}),this.mpPlayerStateMachine=this.createContentStateMachine(),this.mediaPlayer=new Kk.TimeOffsettingMediaPlayer(new ok.MediaPlayer(n)),this.hdcpStore=e,this.traceEventController=r,this.drmController=new Bk.DrmController(this.mediaPlayer,t),this.mediaPlayerEventTracker=new A.EventTracker(this.mediaPlayer),this.playbackQualityProvider=new xk.MpPlayerPlaybackQualityProvider(this.mediaPlayer),this.contentLevelAdapter=new Dk.ContentLevelAdapterMSE(this.mediaPlayer,this.drmController,this.playbackQualityProvider,freeOnUnref(function(){return i.seekController.getPositionMs()})),this.textTrack=this.contentLevelAdapter.textTrack,this.bufferInformationProvider=new sk.MpPlayerBufferInfoProvider(this.mediaPlayer,this.contentLevelAdapter),this.seekController=new Wk.SeekController(this.mediaPlayer,this.contentLevelAdapter),null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.timestampOffsetting&&null!=L.configurationStore.configuration.timestampOffsetting.timestampPaddingSec?this.timestampPaddingSec=L.configurationStore.configuration.timestampOffsetting.timestampPaddingSec:this.timestampPaddingSec=ak.NATIVE_TIMESTAMP_PADDING_SEC,null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.mpPlayerFragment?this.isUnloadedOnRemovedMediaSource=!0===L.configurationStore.configuration.mpPlayerFragment.isUnloadedOnRemovedMediaSource:this.isUnloadedOnRemovedMediaSource=!1,this.appendTimeBitrateFilterManager=new Vk.AppendTimeBitrateFilterManager(this.contentLevelAdapter),this.playbackStateController=new Hk.PlaybackStateController(this.mediaPlayer,this.eventEmitter,freeOnUnref(function(){return i.contentState})),this.readyTracker=new zk.ReadyTracker(this.mediaPlayer,this.contentLevelAdapter,this.mpPlayerStateMachine,this.seekController,this.appendTimeBitrateFilterManager,this.timestampPaddingSec,this.traceEventController),this.readyTracker.on("Stall",this.onReadyTrackerRebuffer),this.playbackQualityMonitor=new Lk.PlaybackQualityMonitor(this.playbackQualityProvider),this.framerateBasedBitrateCapManager=new jk.FramerateBasedBitrateCapManager(this.playbackQualityProvider,this.playbackQualityMonitor),this.platformUnexpectedWaitingMonitor=new qk.PlatformUnexpectedWaitingMonitor(this.playbackQualityProvider,this.readyTracker),this.timeUpdateFrequencyTracker=new Gk.TimeUpdateFrequencyTracker(this.mediaPlayer),this.mpPlayerStateMachine.onStateChange(freeOnUnref(function(e){return i.log.setId(e)})),this.mediaPlayer.on("error",freeOnUnref(function(){i.mpPlayerStateMachine.act("error",i.mediaPlayer.error)})),this.mediaPlayer.on("pictureModeChange",this.onPictureModeChange),this.drmController.on("fatalError",freeOnUnref(function(e){i.mpPlayerStateMachine.act("error",e),i.drmController.reset()})),this.drmController.on("nonfatalError",freeOnUnref(function(e){i.eventEmitter.emit("nonfatalError",e)})),this.contentLevelAdapter.on("positionBump",freeOnUnref(function(e){i.log.warn("Bumping position to "+e+"ms due to ContentLevelAdapter bump"),i.seek(e)})),this.contentLevelAdapter.on("nonfatalError",freeOnUnref(function(e){i.eventEmitter.emit("nonfatalError",e)})),this.contentLevelAdapter.on("fatalError",freeOnUnref(function(e){i.mpPlayerStateMachine.act("error",e)}))}return Object.defineProperty(e.prototype,"playbackState",{get:freeOnUnref(function(){return this.playbackStateController.playbackState}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTimeMs",{get:freeOnUnref(function(){return"waiting"===this.contentState||"ready"===this.contentState?this.seekController.getPositionMs():null}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackTime",{get:freeOnUnref(function(){if("waiting"!==this.contentState&&"ready"!==this.contentState)return null;if(null===this.contentSource)return null;var e=this.seekController.getPositionMs(),t=this.playbackQualityProvider.getCurrentPeriod();return null===t?{positionMs:e,periodId:null,manifestTimeMs:null,mediaWallClockUtcTimeMs:null,playheadTimeMs:null}:{positionMs:e,periodId:t,manifestTimeMs:this.contentSource.playbackTimeToManifestTime(t,e),mediaWallClockUtcTimeMs:this.contentSource.contentTimeToWallClockUtcTime(t,e),playheadTimeMs:e-this.contentSource.minimumPlayablePositionMs}}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:freeOnUnref(function(){return this.mediaPlayer.ended}),enumerable:!0,configurable:!0}),e.prototype.destroy=freeOnUnref(function(){var e=this;if(null!=this.mediaPlayer.mediaSource){var t=freeOnUnref(function(){e.drmController.reset(),e.mediaPlayer.off("emptied",t)});this.mediaPlayer.on("emptied",t)}else this.drmController.reset();this.mediaPlayer.off("pictureModeChange",this.onPictureModeChange),this.mediaPlayer.destroy()}),e.prototype.isSupported=freeOnUnref(function(e){return!0}),e.prototype.load=freeOnUnref(function(e,t){this.log.info(">> load"),null!=t&&this.seek(t),this.mpPlayerStateMachine.act("load",e)}),e.prototype.unload=freeOnUnref(function(){this.log.info(">> unload"),this.mpPlayerStateMachine.act("unload")}),e.prototype.pause=freeOnUnref(function(){this.log.info(">> pause"),this.playbackStateController.pause()}),e.prototype.play=freeOnUnref(function(){return this.log.info(">> play"),this.playbackStateController.play()}),e.prototype.seek=freeOnUnref(function(e){this.log.info(">> seek to "+e+"ms");var t=!1;if(null!=this.contentSource){var n=this.contentSource.availabilityTimeWindow,r=In.clamp(e,n.startMs,n.endMs);r!==e&&(this.log.info(">> seek constrained to "+r+"ms"),e=r,t=!0)}var i=this.seekController.getPositionMs();this.seekController.seek(e),this.bufferInformationProvider.onPosition(e),null!=this.contentSource&&(this.contentSource.seek(e),this.mpPlayerStateMachine.act("waiting",i)),this.contentLevelAdapter.onPosition(),t&&this.tryForceTimeUpdate("seek position constrained")}),Object.defineProperty(e.prototype,"playbackRate",{get:freeOnUnref(function(){return this.mediaPlayer.playbackRate}),set:freeOnUnref(function(e){this.mediaPlayer.playbackRate=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suggestedPictureModes",{get:freeOnUnref(function(){var e=this.mediaPlayer.suggestedPictureModes;return null!=e?e.filter(freeOnUnref(function(e){return null!=e})).map(freeOnUnref(function(e){return o[e]})):e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:freeOnUnref(function(){return this.mediaPlayer.metadata}),enumerable:!0,configurable:!0}),e.prototype.getPictureInPictureFeature=freeOnUnref(function(){return Qe.withDefault(this.mediaPlayer.pictureInPicture,null)}),e.prototype.getVolumeFeature=freeOnUnref(function(){return Qe.withDefault(this.mediaPlayer.volume,null)}),e.prototype.getPlaybackQualityProvider=freeOnUnref(function(){return this.playbackQualityProvider}),e.prototype.getBufferInformationProvider=freeOnUnref(function(){return this.bufferInformationProvider}),e.prototype.getDisplayController=freeOnUnref(function(){return null}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.eventEmitter.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.show=freeOnUnref(function(){this.mediaPlayer.show()}),e.prototype.hide=freeOnUnref(function(){this.mediaPlayer.hide()}),e.prototype.addMediaPlayerPlaybackListeners=freeOnUnref(function(n){var r=this;this.mediaPlayerEventTracker.on("ended",freeOnUnref(function(){return r.eventEmitter.emit("ended",r.seekController.getPositionMs())})),this.mediaPlayerEventTracker.on("seeking",freeOnUnref(function(){r.log.info("on mediaPlayerEventTracker's 'seeking' event"),r.eventEmitter.emit("seeking")})),this.mediaPlayerEventTracker.on("seeked",freeOnUnref(function(){return r.eventEmitter.emit("seeked")})),this.mediaPlayerEventTracker.on("timeupdate",freeOnUnref(function(){if(null!==r.contentSource)if(r.seekController.isSeeking)r.log.warn("Received 'timeupdate' while seeking");else{var e=r.seekController.getPositionMs();r.timeUpdateFrequencyTracker.onTimeUpdate(e),r.contentLevelAdapter.onPosition(),n.onPosition(e),r.bufferInformationProvider.onPosition(e),r.playbackQualityProvider.onPosition(e);var t=r.playbackQualityProvider.getCurrentPeriod();r.eventEmitter.emit("timeupdate",{positionMs:e,periodId:t,manifestTimeMs:r.contentSource.playbackTimeToManifestTime(t,e),mediaWallClockUtcTimeMs:r.contentSource.contentTimeToWallClockUtcTime(t,e),playheadTimeMs:e-r.contentSource.minimumPlayablePositionMs})}else r.log.warn("Received 'timeupdate' while unloaded")}))}),e.prototype.createContentStateMachine=freeOnUnref(function(){var r=this,e=new ml.FiniteStateMachine("unloaded");e.addTransition("unloaded","load","waiting"),e.addTransition("unloaded","unload","unloaded"),e.addTransition("waiting","ready","ready"),e.addTransition("waiting","waiting","waiting"),e.addTransition("waiting","reinitialize","reinitializing"),e.addTransition("waiting","contentLevelAdapterReady","waiting"),e.addTransition("ready","waiting","waiting"),e.addTransition("ready","ready","ready"),e.addTransition("ready","reinitialize","reinitializing"),e.addTransition("ready","unload","unloading"),e.addTransition("waiting","unload","unloading"),e.addTransition("reinitializing","unload","unloading"),e.addTransition("reinitializing","contentLevelAdapterReady","waiting"),e.addTransition("reinitializing","reinitialize","reinitializing"),e.addTransition("unloaded","error","error"),e.addTransition("waiting","error","error"),e.addTransition("ready","error","error"),e.addTransition("reinitializing","error","error"),e.addTransition("unloading","error","error"),e.addTransition("error","error","error"),e.onTransition("unloaded","load",this.onLoad),e.onTransition("waiting","unload",this.onUnload),e.onTransition("waiting","reinitialize",this.onReinitializing),e.onTransition("reinitializing","reinitialize",this.onReinitializing),e.onTransition("reinitializing","contentLevelAdapterReady",this.onFinishedReinitialization),e.onTransition("ready","reinitialize",this.onReinitializing),e.onTransition("ready","unload",this.onUnload),e.addTransition("unloading","unloaded","unloaded"),e.onEnterState("unloading",this.onEnterUnloading),e.addTransition("error","unload","unloading"),e.addTransition("error","unloaded","unloaded");var t=void 0,n=freeOnUnref(function(e){t=e});e.onTransition("ready","waiting",n);var i=freeOnUnref(function(e){e instanceof ct.XpError?r.contentError=e:r.contentError=new ct.XpError(e.name,void 0,e.message,!0,e)});return e.onTransition("unloading","error",i),e.onTransition("unloaded","error",i),e.onTransition("waiting","error",i),e.onTransition("ready","error",i),e.onTransition("reinitializing","error",i),e.onTransition("error","error",freeOnUnref(function(e){r.log.error("Received content error while already in error state",e)})),e.onTransition("error","unload",this.onUnload),e.onEnterState("unloaded",freeOnUnref(function(){r.drmController.unload(),r.contentState="unloaded",delete r.contentError,r.log.info("ContentState change:",r.contentState),r.eventEmitter.emit("contentStateChange",{contentState:r.contentState}),r.playbackStateController.notifyContentStateTransition()})),e.onEnterState("waiting",freeOnUnref(function(){r.contentState="waiting",r.log.info("ContentState change:",r.contentState),r.eventEmitter.emit("contentStateChange",{contentState:r.contentState,playbackPositionMs:t}),t=void 0,r.playbackStateController.notifyContentStateTransition()})),e.onEnterState("ready",freeOnUnref(function(){r.contentState="ready",r.log.info("ContentState change:",r.contentState),r.eventEmitter.emit("contentStateChange",{contentState:r.contentState}),r.playbackStateController.notifyContentStateTransition()})),e.onEnterState("reinitializing",freeOnUnref(function(){r.contentState="waiting",r.log.info("ContentState change:",r.contentState),r.eventEmitter.emit("contentStateChange",{contentState:r.contentState}),r.playbackStateController.notifyContentStateTransition()})),e.onEnterState("error",freeOnUnref(function(){r.contentState="error",null!=r.contentError&&r.contentError.code===Ni.codes.xp.system.hdcp_insufficient&&r.hdcpStore.getHdcpStatus().then(freeOnUnref(function(e){r.log.warn("HDCP insufficient error, current HDCP status",e)})),r.log.error("ContentState change:",r.contentState," contentError:",r.contentError),r.eventEmitter.emit("contentStateChange",{contentState:r.contentState})})),e.onIllegalTransition(freeOnUnref(function(e,t,n){r.log.error("IllegalTransitionError",e," :: ",t)})),e}),e.prototype.removeContentLevelAdapterListeners=freeOnUnref(function(){this.contentLevelAdapter.off("initialized",this.onInitialized),this.contentLevelAdapter.off("needsContent",this.onNeedsContent),this.contentLevelAdapter.off("ready",this.onReady),this.contentLevelAdapter.off("uninitialized",this.onUninitialized)}),e.prototype.tryForceTimeUpdate=freeOnUnref(function(e){var t=this.playbackTime;null!=t?null===this.contentSource||this.seekController.isSeeking||this.eventEmitter.emit("timeupdate",t):this.log.warn("["+e+"] PlaybackTime null. Not triggering timeupdate")}),e})();t.MpPlayerFragment=i}));e(Qk);Qk.MpPlayerFragment;var Xk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MpPlayerFragment=Qk.MpPlayerFragment}));e(Xk);Xk.MpPlayerFragment;var Yk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.provider=e}return e.prototype.on=freeOnUnref(function(e,t){if("!streamGroupChange"===e)this.provider.onStreamGroupChange(t);else{var n=e.split("$"),r=n[0],i=n[1];this.provider.on(r,i,t)}}),e.prototype.off=freeOnUnref(function(e,t){if("!streamGroupChange"===e)this.provider.offStreamGroupChange(t);else{var n=e.split("$"),r=n[0],i=n[1];this.provider.off(r,i,t)}}),e})(),r=freeOnUnref(function(){function e(){this.playbackQualityProviders=[],this.activePlaybackQualityProvider=null,this.eventSource=new A.MultiplexedEventSource}return e.prototype.selectSource=freeOnUnref(function(t){var e=x.find(this.playbackQualityProviders,freeOnUnref(function(e){return e.id===t}));this.activePlaybackQualityProvider=null!=e?e.playbackQualityProvider:null,this.eventSource.selectSource(t)}),e.prototype.addSource=freeOnUnref(function(t,e){if(null!=x.find(this.playbackQualityProviders,freeOnUnref(function(e){return e.id===t})))throw new Error("Source with id "+t+" already exist");this.eventSource.addSource(t,new n(e)),this.playbackQualityProviders.push({id:t,playbackQualityProvider:e})}),e.prototype.removeSource=freeOnUnref(function(t){var e=x.partition(this.playbackQualityProviders,freeOnUnref(function(e){return e.id===t})),n=e[0],r=e[1];null!=n.length&&(this.eventSource.removeSource(t),this.playbackQualityProviders=r)}),e.prototype.getCurrentQualityInfo=freeOnUnref(function(e){return null!=this.activePlaybackQualityProvider?this.activePlaybackQualityProvider.getCurrentQualityInfo(e):null}),e.prototype.getVideoDecodePerformance=freeOnUnref(function(){return null!=this.activePlaybackQualityProvider?this.activePlaybackQualityProvider.getVideoDecodePerformance():null}),e.prototype.getCurrentResolution=freeOnUnref(function(){return null!=this.activePlaybackQualityProvider?this.activePlaybackQualityProvider.getCurrentResolution():null}),e.prototype.on=freeOnUnref(function(e,t,n){var r=e+"$"+t;this.eventSource.on(r,n)}),e.prototype.off=freeOnUnref(function(e,t,n){var r=e+"$"+t;this.eventSource.off(r,n)}),e.prototype.onStreamGroupChange=freeOnUnref(function(e){this.eventSource.on("!streamGroupChange",e)}),e.prototype.offStreamGroupChange=freeOnUnref(function(e){this.eventSource.off("!streamGroupChange",e)}),e})();t.MultiplexedPlaybackQualityProvider=r}));e(Yk);Yk.MultiplexedPlaybackQualityProvider;var Jk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.volumeFeatures=[],this.activeVolumeFeature=null,this.allListeners=[]}return e.prototype.selectSource=freeOnUnref(function(t){var e=x.find(this.volumeFeatures,freeOnUnref(function(e){return e.id===t}));this.activeVolumeFeature=null!=e?e.volumeFeature:null}),e.prototype.addSource=freeOnUnref(function(t,e){if(null!=x.find(this.volumeFeatures,freeOnUnref(function(e){return e.id===t})))throw new Error("Source with id "+t+" already exist");this.volumeFeatures.push({id:t,volumeFeature:e})}),e.prototype.removeSource=freeOnUnref(function(t){var e=x.partition(this.volumeFeatures,freeOnUnref(function(e){return e.id===t})),n=e[0],r=e[1];if(0!==n.length){for(var i=0,o=this.allListeners;i<o.length;i++){var a=o[i].originalListener;n[0].volumeFeature.offChange(a)}this.volumeFeatures=r}}),Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){return null==this.activeVolumeFeature?0:this.activeVolumeFeature.volume}),set:freeOnUnref(function(e){null!=this.activeVolumeFeature&&(this.activeVolumeFeature.volume=e)}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:freeOnUnref(function(){return null==this.activeVolumeFeature||this.activeVolumeFeature.muted}),set:freeOnUnref(function(e){null!=this.activeVolumeFeature&&(this.activeVolumeFeature.muted=e)}),enumerable:!0,configurable:!0}),e.prototype.onChange=freeOnUnref(function(t){var n=this;if(null!=this.activeVolumeFeature)for(var e=freeOnUnref(function(e){return freeOnUnref(function(){n.activeVolumeFeature===e&&t()})}),r=0,i=this.volumeFeatures;r<i.length;r++){var o=i[r].volumeFeature,a=e(o);o.onChange(a),this.allListeners.push({wrappedListener:a,originalListener:t})}}),e.prototype.offChange=freeOnUnref(function(e){null!=this.activeVolumeFeature&&this.removeListenerFromVolumeFeatures(e)}),e.prototype.hasActiveVolumeFeature=freeOnUnref(function(){return null!=this.activeVolumeFeature}),e.prototype.removeListenerFromVolumeFeatures=freeOnUnref(function(t){var e=x.findIndex(this.allListeners,freeOnUnref(function(e){return e.originalListener===t}));if(-1!==e){for(var n=this.allListeners[e].wrappedListener,r=0,i=this.volumeFeatures;r<i.length;r++){i[r].volumeFeature.offChange(n)}this.allListeners.splice(e,1)}}),e})();t.MultiplexedVolumeFeature=n}));e(Jk);Jk.MultiplexedVolumeFeature;var Zk=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.pictureInPictureFeatures=[],this.activePictureInPictureFeature=null,this.allListeners=[]}return e.prototype.selectSource=freeOnUnref(function(t){var e=x.find(this.pictureInPictureFeatures,freeOnUnref(function(e){return e.id===t}));this.activePictureInPictureFeature=null!=e?e.pictureInPictureFeature:null}),e.prototype.addSource=freeOnUnref(function(t,e){if(null!=x.find(this.pictureInPictureFeatures,freeOnUnref(function(e){return e.id===t})))throw new Error("Source with id "+t+" already exist");this.pictureInPictureFeatures.push({id:t,pictureInPictureFeature:e})}),e.prototype.removeSource=freeOnUnref(function(t){var e=x.partition(this.pictureInPictureFeatures,freeOnUnref(function(e){return e.id===t})),n=e[0],r=e[1];if(0!==n.length){for(var i=0,o=this.allListeners;i<o.length;i++){var a=o[i].originalListener;n[0].pictureInPictureFeature.offChange(a)}this.pictureInPictureFeatures=r}}),e.prototype.onChange=freeOnUnref(function(t){var n=this;if(null!=this.activePictureInPictureFeature)for(var e=freeOnUnref(function(e){return freeOnUnref(function(){n.activePictureInPictureFeature===e&&t()})}),r=0,i=this.pictureInPictureFeatures;r<i.length;r++){var o=i[r].pictureInPictureFeature,a=e(o);o.onChange(a),this.allListeners.push({wrappedListener:a,originalListener:t})}}),e.prototype.offChange=freeOnUnref(function(e){null!=this.activePictureInPictureFeature&&this.removeListenerFromPictureInPictureFeatures(e)}),e.prototype.isPictureInPicture=freeOnUnref(function(){return null!=this.activePictureInPictureFeature&&this.activePictureInPictureFeature.isPictureInPicture()}),e.prototype.isSupported=freeOnUnref(function(){return null!=this.activePictureInPictureFeature&&this.activePictureInPictureFeature.isSupported()}),e.prototype.requestPictureInPicture=freeOnUnref(function(){return null!=this.activePictureInPictureFeature?this.activePictureInPictureFeature.requestPictureInPicture():Promise.reject("No active Picture-In-Picture Feature")}),e.prototype.exitPictureInPicture=freeOnUnref(function(){return null!=this.activePictureInPictureFeature?this.activePictureInPictureFeature.exitPictureInPicture():Promise.reject("No active Picture-In-Picture Feature")}),e.prototype.removeListenerFromPictureInPictureFeatures=freeOnUnref(function(t){var e=x.findIndex(this.allListeners,freeOnUnref(function(e){return e.originalListener===t}));if(-1!==e){for(var n=this.allListeners[e].wrappedListener,r=0,i=this.pictureInPictureFeatures;r<i.length;r++){i[r].pictureInPictureFeature.offChange(n)}this.allListeners.splice(e,1)}}),e})();t.MultiplexedPictureInPictureFeature=n}));e(Zk);Zk.MultiplexedPictureInPictureFeature;var $k=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("MultiplexedMpPlayer"),n=freeOnUnref(function(){function e(){var t=this;this.internalActivePlayer=null,this.players=[],this.multiplexedPlayerEventSource=new A.MultiplexedEventSource,this.multiplexedTextTrackEventSource=new A.MultiplexedEventSource,this.multiplexedPlaybackQualityProvider=new Yk.MultiplexedPlaybackQualityProvider,this.multiplexedPictureInPictureFeature=new Zk.MultiplexedPictureInPictureFeature,this.multiplexedVolumeFeature=new Jk.MultiplexedVolumeFeature,this.bufferInformationProvider={getBufferedRanges:freeOnUnref(function(e){return t.activePlayer.getBufferInformationProvider().getBufferedRanges(e)}),getAggregateBufferedRanges:freeOnUnref(function(e){return t.activePlayer.getBufferInformationProvider().getAggregateBufferedRanges(e)}),getFrontBufferLengthMs:freeOnUnref(function(e){return t.activePlayer.getBufferInformationProvider().getFrontBufferLengthMs(e)}),isBufferedToEnd:freeOnUnref(function(e){return t.activePlayer.getBufferInformationProvider().isBufferedToEnd(e)}),getBufferInformation:freeOnUnref(function(){return t.activePlayer.getBufferInformationProvider().getBufferInformation()}),getInMemoryBufferInformation:freeOnUnref(function(){return t.activePlayer.getBufferInformationProvider().getInMemoryBufferInformation()}),getSourceBufferInformation:freeOnUnref(function(){return t.activePlayer.getBufferInformationProvider().getSourceBufferInformation()})}}return Object.defineProperty(e.prototype,"activePlayer",{get:freeOnUnref(function(){return this.internalActivePlayer}),enumerable:!0,configurable:!0}),e.prototype.selectSource=freeOnUnref(function(t){var e=x.find(this.players,freeOnUnref(function(e){return e.id===t}));if(null==e)throw new Error("[MultiplexedMpPlayer] Entry with id "+t+" doesn't exist");this.multiplexedPlayerEventSource.selectSource(t),this.multiplexedTextTrackEventSource.selectSource(t),this.multiplexedPlaybackQualityProvider.selectSource(t),this.multiplexedVolumeFeature.selectSource(t),this.multiplexedPictureInPictureFeature.selectSource(t),null!=this.internalActivePlayer&&this.transferPlayerPresets(this.internalActivePlayer,e.player),this.internalActivePlayer=e.player}),e.prototype.addSource=freeOnUnref(function(t,e){if(null!=x.find(this.players,freeOnUnref(function(e){return e.id===t})))throw new Error("Source with id "+t+" already exist");this.multiplexedPlayerEventSource.addSource(t,e),this.multiplexedTextTrackEventSource.addSource(t,e.textTrack),null!=e.getPlaybackQualityProvider()&&this.multiplexedPlaybackQualityProvider.addSource(t,e.getPlaybackQualityProvider()),null!=e.getVolumeFeature()&&this.multiplexedVolumeFeature.addSource(t,e.getVolumeFeature()),null!=e.getPictureInPictureFeature()&&this.multiplexedPictureInPictureFeature.addSource(t,e.getPictureInPictureFeature()),this.players.push({id:t,player:e})}),e.prototype.removeSource=freeOnUnref(function(t){var e=x.partition(this.players,freeOnUnref(function(e){return e.id===t})),n=e[0],r=e[1];if(0===n.length)throw new Error("No source with id "+t+" exists");this.multiplexedPlayerEventSource.removeSource(t),this.multiplexedTextTrackEventSource.removeSource(t),this.multiplexedPlaybackQualityProvider.removeSource(t),this.multiplexedPictureInPictureFeature.removeSource(t),this.multiplexedVolumeFeature.removeSource(t),this.players=r,this.internalActivePlayer!==n[0].player&&(this.internalActivePlayer=null)}),e.prototype.on=freeOnUnref(function(e,t){this.multiplexedPlayerEventSource.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.multiplexedPlayerEventSource.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.multiplexedPlayerEventSource.off(e,t)}),e.prototype.unload=freeOnUnref(function(){for(var e=0,t=this.players;e<t.length;e++){var n=t[e].id;this.multiplexedPlayerEventSource.removeSource(n),this.multiplexedTextTrackEventSource.removeSource(n)}}),e.prototype.getPictureInPictureFeature=freeOnUnref(function(){return this.multiplexedPictureInPictureFeature}),e.prototype.getVolumeFeature=freeOnUnref(function(){return this.multiplexedVolumeFeature.hasActiveVolumeFeature()?this.multiplexedVolumeFeature:null}),e.prototype.getPlaybackQualityProvider=freeOnUnref(function(){return this.multiplexedPlaybackQualityProvider}),e.prototype.getBufferInformationProvider=freeOnUnref(function(){return this.bufferInformationProvider}),Object.defineProperty(e.prototype,"textTrack",{get:freeOnUnref(function(){var n=this;return{get cues(){return n.activePlayer.textTrack.cues},get bufferedIntervalsMs(){return n.activePlayer.textTrack.bufferedIntervalsMs},on:freeOnUnref(function(e,t){n.multiplexedTextTrackEventSource.on(e,t)}),off:freeOnUnref(function(e,t){n.multiplexedTextTrackEventSource.off(e,t)})}}),enumerable:!0,configurable:!0}),e.prototype.transferPlayerPresets=freeOnUnref(function(e,t){this.transferVolumePresets(e,t),this.transferClosedCaptionsLanguageSelection(e,t),this.transferPictureInPicturePresets(e,t)}),e.prototype.transferVolumePresets=freeOnUnref(function(e,t){var n=e.getVolumeFeature(),r=t.getVolumeFeature();null!=n&&null!=r&&(r.volume=n.volume)}),e.prototype.transferPictureInPicturePresets=freeOnUnref(function(e,t){var n=e.getPictureInPictureFeature(),r=t.getPictureInPictureFeature();null!=n&&null!=r&&n.isPictureInPicture()&&r.requestPictureInPicture().catch(freeOnUnref(function(e){return i.error("Failed to request Picture-In-Picture while transfering Picture-In-Picture presets",e)}))}),e.prototype.transferClosedCaptionsLanguageSelection=freeOnUnref(function(e,t){}),e})();t.MultiplexedMpPlayer=n}));e($k);$k.MultiplexedMpPlayer;var e_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.primaryContentMpPlayer=null,this.mpPlayerLiveLowLatency=null,this.nativeWebPlayer=null,this.multiplexedMpPlayer=new $k.MultiplexedMpPlayer,this.activePlayerSourceId=0,this.shouldAutoplay=!1}return Object.defineProperty(e.prototype,"error",{get:freeOnUnref(function(){return this.multiplexedMpPlayer.activePlayer.error}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentError",{get:freeOnUnref(function(){return this.multiplexedMpPlayer.activePlayer.contentError}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentState",{get:freeOnUnref(function(){return this.multiplexedMpPlayer.activePlayer.contentState}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackState",{get:freeOnUnref(function(){return this.multiplexedMpPlayer.activePlayer.playbackState}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTimeMs",{get:freeOnUnref(function(){var e=this.multiplexedMpPlayer.activePlayer;return null==e?null:e.currentTimeMs}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackTime",{get:freeOnUnref(function(){return this.multiplexedMpPlayer.activePlayer.playbackTime}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:freeOnUnref(function(){return this.multiplexedMpPlayer.activePlayer.ended}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textTrack",{get:freeOnUnref(function(){return this.multiplexedMpPlayer.textTrack}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:freeOnUnref(function(){return this.multiplexedMpPlayer.activePlayer.playbackRate}),set:freeOnUnref(function(e){this.multiplexedMpPlayer.activePlayer.playbackRate=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:freeOnUnref(function(){var e=this.multiplexedMpPlayer.activePlayer;if(null!=e)return e.metadata}),enumerable:!0,configurable:!0}),e.prototype.shouldCreateSafariHlsPlayer=freeOnUnref(function(){return null!=zt.deviceInformation&&null!=zt.deviceInformation.software&&null!=zt.deviceInformation.software.browser&&null!=zt.deviceInformation.software.browser.name&&"Safari"===zt.deviceInformation.software.browser.name||null!=zt.deviceInformation&&null!=zt.deviceInformation.software&&null!=zt.deviceInformation.software.operatingSystem&&null!=zt.deviceInformation.software.operatingSystem.name&&"iOS"===zt.deviceInformation.software.operatingSystem.name}),e.prototype.initialize=freeOnUnref(function(e,t,n,r){this.primaryContentMpPlayer=new Xk.MpPlayerFragment(t,n,e,r),this.mpPlayerLiveLowLatency=new nf.MpPlayerLiveLowLatency(e),this.multiplexedMpPlayer.addSource(0,this.primaryContentMpPlayer),this.multiplexedMpPlayer.addSource(1,this.mpPlayerLiveLowLatency),this.shouldCreateSafariHlsPlayer()&&(this.nativeWebPlayer=new Nc.MpPlayerSafariHls(t,e),this.multiplexedMpPlayer.addSource(2,this.nativeWebPlayer)),this.multiplexedMpPlayer.selectSource(0)}),e.prototype.isAutoplayEnabled=freeOnUnref(function(){return this.shouldAutoplay}),e.prototype.isSupported=freeOnUnref(function(e){return!0}),e.prototype.destroy=freeOnUnref(function(){null!=this.primaryContentMpPlayer&&(this.multiplexedMpPlayer.removeSource(0),this.primaryContentMpPlayer.destroy(),this.primaryContentMpPlayer=null),null!=this.mpPlayerLiveLowLatency&&(this.multiplexedMpPlayer.removeSource(1),this.mpPlayerLiveLowLatency.destroy(),this.mpPlayerLiveLowLatency=null),null!=this.nativeWebPlayer&&(this.multiplexedMpPlayer.removeSource(2),this.nativeWebPlayer.destroy(),this.nativeWebPlayer=null)}),e.prototype.load=freeOnUnref(function(e,t){e instanceof Nc.SafariHlsContentSource?(this.setupActivePlayerSource(2),this.multiplexedMpPlayer.activePlayer.load(e,t)):e instanceof nf.LiveLowLatencyContentSource?(this.setupActivePlayerSource(1),this.multiplexedMpPlayer.activePlayer.load(e,t)):this.primaryContentMpPlayer instanceof Xk.MpPlayerFragment&&(this.setupActivePlayerSource(0),this.multiplexedMpPlayer.activePlayer.load(e,t)),this.shouldAutoplay&&this.multiplexedMpPlayer.activePlayer.play()}),e.prototype.unload=freeOnUnref(function(){this.multiplexedMpPlayer.activePlayer.unload()}),e.prototype.play=freeOnUnref(function(){return this.shouldAutoplay=!0,this.multiplexedMpPlayer.activePlayer.play()}),e.prototype.pause=freeOnUnref(function(){this.shouldAutoplay=!1,this.multiplexedMpPlayer.activePlayer.pause()}),e.prototype.seek=freeOnUnref(function(e){this.multiplexedMpPlayer.activePlayer.seek(e)}),e.prototype.getVolumeFeature=freeOnUnref(function(){return this.multiplexedMpPlayer.getVolumeFeature()}),e.prototype.getPictureInPictureFeature=freeOnUnref(function(){return this.multiplexedMpPlayer.getPictureInPictureFeature()}),e.prototype.getPlaybackQualityProvider=freeOnUnref(function(){return this.multiplexedMpPlayer.getPlaybackQualityProvider()}),e.prototype.getBufferInformationProvider=freeOnUnref(function(){return this.multiplexedMpPlayer.getBufferInformationProvider()}),e.prototype.getDisplayController=freeOnUnref(function(){return this.multiplexedMpPlayer.activePlayer.getDisplayController()}),e.prototype.on=freeOnUnref(function(e,t){this.multiplexedMpPlayer.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.multiplexedMpPlayer.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.multiplexedMpPlayer.off(e,t)}),e.prototype.show=freeOnUnref(function(){}),e.prototype.hide=freeOnUnref(function(){}),e.prototype.setupActivePlayerSource=freeOnUnref(function(e){if(this.activePlayerSourceId!==e){var t=this.multiplexedMpPlayer.activePlayer;this.multiplexedMpPlayer.selectSource(e),this.activePlayerSourceId=e,null!=t&&null!=this.multiplexedMpPlayer.activePlayer&&(t.hide(),this.multiplexedMpPlayer.activePlayer.show())}}),e})();t.MpPlayerProxy=n}));e(e_);e_.MpPlayerProxy;var t_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var t=this;this.playbackStarted=!1,this.onPlaybackOrContentStateChange=freeOnUnref(function(){"playing"===t.mpPlayer.playbackState&&"ready"===t.mpPlayer.contentState&&(t.playbackStarted=!0)}),this.mpPlayer=e}return e.prototype.initialize=freeOnUnref(function(){this.mpPlayer.on("playbackStateChange",this.onPlaybackOrContentStateChange),this.mpPlayer.on("contentStateChange",this.onPlaybackOrContentStateChange)}),e.prototype.terminate=freeOnUnref(function(){this.mpPlayer.off("playbackStateChange",this.onPlaybackOrContentStateChange),this.mpPlayer.off("contentStateChange",this.onPlaybackOrContentStateChange)}),e.prototype.playbackNotStarted=freeOnUnref(function(){return!this.playbackStarted}),e.prototype.hasPlaybackStarted=freeOnUnref(function(){return this.playbackStarted}),e.prototype.resetPlaybackStarted=freeOnUnref(function(){this.playbackStarted=!1}),e})();t.PlaybackStartedTracker=n}));e(t_);t_.PlaybackStartedTracker;var n_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.constrainPosition=function(e,t){return Math.max(e.startMs,Math.min(t,e.endMs))},t.isWithinTimeWindow=function(e,t,n){return void 0===n&&(n=0),e.startMs-n<=t&&t<=e.endMs}}));e(n_);n_.constrainPosition,n_.isWithinTimeWindow;var r_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("PlaylistMediaPlaybackController"),n=freeOnUnref(function(){function e(e,t,n,r,i,o){var a=this;this.cancelFunction=null,this.currentItem=null,this.isContentLoaded=!1,this.pendingMpPlayerSeek=!1,this.pendingMpPlayerReset=!1,this.autoloadOnUnloaded=!0,this.groupIdsToPauseOnEnter=[],this.onReset=freeOnUnref(function(){var e=null!=a.currentItem;s.info(">> onReset; current pendingMpPlayerReset="+a.pendingMpPlayerReset+"; shouldReset:"+e),e&&(a.mpPlayer.unload(),a.pendingMpPlayerReset=!0)}),this.onStreamEnd=freeOnUnref(function(){var e=a.mpPlayer.currentTimeMs;if(null!=e){var t=a.playlistEngine.getCurrentItem();if(null!==t&&t===a.currentItem){var n=e,r=new Jy.PlaylistRelativeView(a.playlistEngine,{contentSource:t.contentSource}),i=r.getItems(),o=i[i.length-1].end;null!=o&&o!==1/0||(r.update(t.start,1/0,{end:n}),r.splice(n,1/0,[]),o=n),a.mpPlayer.pause(),a.playlistEngine.onPosition(o),s.info("Stream has finished, closing the player.")}else s.warn("Received 'StreamEnd' with non-existent or mismatched current playlist item")}else s.warn("Stream ended without current media position")}),this.onEnterItem=freeOnUnref(function(e){if(a.autoloadOnUnloaded=!0,null==a.currentItem||e.item.contentSource!==a.currentItem.contentSource)if(null!=a.currentItem){null!=a.currentItem.contentSource&&a.currentItem.contentSource.stop();var t=e.item;if(null!=t&&null!=t.initializeContentCallback){null!=a.cancelFunction&&a.cancelFunction();var n=lt.CancelToken.source(),r=n.token,i=n.cancel;a.cancelFunction=i,t.initializeContentCallback().then(freeOnUnref(function(){r.throwIfRequested(),a.onCurrentItemChange(t),a.playlistEngine.seek(1/0)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||s.error("Error happened when processing a deferred content",e)}))}else a.onCurrentItemChange(t)}else a.load();else a.currentItem=e.item}),this.onPlaylistEngineSeek=freeOnUnref(function(e){if(s.info("<< onPlaylistEngineSeek with positionMs: "+e),null===a.currentItem){var t="Attempted to seek without a current item";return s.error(t),void a.mediaEventController.reportError(!1,new Error(t),"Player","Unknown")}var n=e;a.isContentLoaded&&(a.pendingMpPlayerSeek=!0,a.reportDiagnostics()),a.mpPlayer.seek(n)}),this.onTimeUpdate=freeOnUnref(function(e){if(a.pendingMpPlayerSeek||a.pendingMpPlayerReset)a.trackIgnoredTimeUpdate();else{var t=a.playlistEngine.getCurrentItem();if(null!==t&&t===a.currentItem){var n=e.positionMs;a.playlistEngine.onPosition(n),a.timeDataManager.onTimeUpdate()}else s.warn("Received 'timeupdate' for position "+e.positionMs+"ms for item which does not match current playlist item")}}),this.onSeeking=freeOnUnref(function(){s.info(">> onSeeking"),a.pendingMpPlayerSeek=!1,a.reportDiagnostics()}),this.onEnded=freeOnUnref(function(){var e=a.playlistEngine.getCurrentItem();if(null!==e&&e===a.currentItem){var t=e.end;null!==t&&a.playlistEngine.onPosition(t)}else s.warn("Received 'ended' for item which does not match current playlist item")}),this.onDurationChange=freeOnUnref(function(e){var t=a.playlistEngine.getCurrentItem();if(null!==t&&t===a.currentItem){var n=new Jy.PlaylistRelativeView(a.playlistEngine,{contentSource:t.contentSource}),r=n.getItems(),i=x.last(r);if(null!=i){var o=null!=i.end?i.end:1/0;n.update(i.start,o,{end:e})}}else s.warn("Received 'durationchange' with non-existent or mismatched current playlist item")}),this.onContentStateChange=freeOnUnref(function(e){"unloaded"===e.contentState?(s.info("MpPlayer Unloaded"),a.pendingMpPlayerSeek=!1,a.isContentLoaded=!1,a.autoloadOnUnloaded&&(a.load(),a.pendingMpPlayerReset=!1)):a.isContentLoaded||"waiting"!==e.contentState&&"ready"!==e.contentState||(a.isContentLoaded=!0,a.pendingMpPlayerSeek=!1),a.reportDiagnostics()}),this.playlistEngine=e,this.mpPlayer=t,this.timeDataManager=n,this.timelineManager=r,this.mediaEventController=i,this.playbackStartedTracker=o,this.diagnostics=nn.Diagnostics.create("PlaylistMediaPlaybackController"),this.state={autoloadOnUnloaded:!0,isContentLoaded:!1,pendingMpPlayerSeek:!1,pendingMpPlayerReset:!1,numOfIgnoredTimeUpdatesSinceLastStateChange:0,timestamp:Date.now()}}return e.prototype.initialize=freeOnUnref(function(){this.playlistEngine.on("Seek",this.onPlaylistEngineSeek),this.playlistEngine.on("EnterItem",this.onEnterItem),this.mpPlayer.on("timeupdate",this.onTimeUpdate),this.mpPlayer.on("seeking",this.onSeeking),this.mpPlayer.on("ended",this.onEnded),this.mpPlayer.on("durationchange",this.onDurationChange),this.mpPlayer.on("contentStateChange",this.onContentStateChange)}),e.prototype.terminate=freeOnUnref(function(){this.unloaded(),this.playlistEngine.off("Seek",this.onPlaylistEngineSeek),this.playlistEngine.off("EnterItem",this.onEnterItem),this.mpPlayer.off("timeupdate",this.onTimeUpdate),this.mpPlayer.off("seeking",this.onSeeking),this.mpPlayer.off("ended",this.onEnded),this.mpPlayer.off("durationchange",this.onDurationChange),this.mpPlayer.off("contentStateChange",this.onContentStateChange)}),e.prototype.play=freeOnUnref(function(){if(null!==this.currentItem&&null!=this.currentItem.playlistRelativeConstrainedTimeWindow){var e=this.playlistEngine.getCurrentPosition(),t=this.currentItem.playlistRelativeConstrainedTimeWindow;null===e||n_.isWithinTimeWindow(t,e,1e4)||(s.info("Current position "+e+"ms (playlist time) outside time window ["+t.startMs+", "+t.endMs+"]. Seeking back into time window"),this.playlistEngine.seek(e))}return this.mpPlayer.play()}),e.prototype.unloaded=freeOnUnref(function(){null!=this.cancelFunction&&(this.cancelFunction(),this.cancelFunction=null),this.autoloadOnUnloaded=!1,this.currentItem=null,s.info("Unloading current playlist."),this.mpPlayer.unload(),this.pendingMpPlayerSeek=!1,this.pendingMpPlayerReset=!1,this.reportDiagnostics(),this.groupIdsToPauseOnEnter=[]}),e.prototype.performOnEnter=freeOnUnref(function(e,t){1===t?this.groupIdsToPauseOnEnter.push(e):0===t&&(this.groupIdsToPauseOnEnter=x.without(this.groupIdsToPauseOnEnter,e))}),e.prototype.reload=freeOnUnref(function(){this.autoloadOnUnloaded=!0,this.mpPlayer.unload()}),e.prototype.onCurrentItemChange=freeOnUnref(function(e){for(var t=this.timelineManager.getTimeline().items,n=this.playlistEngine.getItems(),r=null,i=0;i<n.length;i++)if(n[i]===e){null==t||t.length<=i?s.warn("Index of playlist item out of timeline items index range: playlist item index is "+i+", but timeline has "+(null==t?"null":t.length)+" elements"):r=t[i].groupId;break}if(null!=r){var o=this.groupIdsToPauseOnEnter.indexOf(r);-1!==o&&(s.info("Will pause timeline item on load, itemline item group id: "+r),this.groupIdsToPauseOnEnter.splice(o,1),this.mpPlayer.pause())}this.mpPlayer.unload()}),e.prototype.load=freeOnUnref(function(){var e=this.playlistEngine.getCurrentItem();if(null!=(this.currentItem=e))if(null!=e.contentSource){var t=this.playlistEngine.getCurrentPosition(),n=e.contentSource;this.playbackStartedTracker.resetPlaybackStarted(),this.mpPlayer.load(n,t),n.start(t)}else s.warn("No current ContentSource. Not loading anything");else s.warn("No current item in PlaylistEngine. Not loading new content")}),e.prototype.trackIgnoredTimeUpdate=freeOnUnref(function(){this.state.numOfIgnoredTimeUpdatesSinceLastStateChange++,this.reportDiagnostics(!1),25===this.state.numOfIgnoredTimeUpdatesSinceLastStateChange&&s.warn("Ignored a frequent number of 'timeupdate' events: pendingMpPlayerReset="+this.pendingMpPlayerReset+", pendingMpPlayerSeek="+this.pendingMpPlayerSeek)}),e.prototype.reportDiagnostics=freeOnUnref(function(e){void 0===e&&(e=!0),this.state.autoloadOnUnloaded=this.autoloadOnUnloaded,this.state.isContentLoaded=this.isContentLoaded,this.state.pendingMpPlayerSeek=this.pendingMpPlayerSeek,this.state.pendingMpPlayerReset=this.pendingMpPlayerReset,this.state.timestamp=Date.now(),this.diagnostics.report("state",this.state),e&&(this.state.numOfIgnoredTimeUpdatesSinceLastStateChange=0)}),e})();t.PlaylistMediaPlaybackController=n}));e(r_);r_.PlaylistMediaPlaybackController;var i_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("PublicTimeTranslator"),n=freeOnUnref(function(){function e(e){this.playlistEngine=e}return e.prototype.nominalizeRequestPosition=freeOnUnref(function(e,t){if("WallClock"===e.relativity){var n=this.wallClockToPublicPositionMs(e.positionMs,t);return null!=n?(u.info("WallClock-relative request position "+e.positionMs+" -> Nominal position "+n),n):(u.warn("WallClock-relative position unable to be translated. Defaulting position as Nominal"),e.positionMs)}return e.positionMs}),e.prototype.getPlaylistPosition=freeOnUnref(function(e,t){var n=new Jy.PlaylistRelativeView(this.playlistEngine,{titleId:t}).getItems()[0],r=new Jy.PlaylistRelativeView(this.playlistEngine,{titleId:t,type:"Recap"===n.type?"Recap":"Main"}),i=this.getMainContentDurationMs(r),o=this.getBoundPositionMs(r,e,i),a=x.findIndex(r.getItems(),freeOnUnref(function(e){return e.timelineStart<=o&&o<=Qe.withDefault(e.timelineEnd,1/0)})),s=o;-1===a&&(u.error("Cannot find position: "+o+"ms in main content. Seeking to 0ms"),a=s=0);var l=r.getItems()[a],f=this.playlistEngine.getItems().indexOf(l);return{position:s-l.timelineStart+l.start,playlistItemIndex:f}}),e.prototype.getCurrentPublicPositionMs=freeOnUnref(function(){var e=this.playlistEngine.getCurrentPosition(),t=this.playlistEngine.getCurrentItem();if(null==e||null==t)return null;var n=new Jy.PlaylistRelativeView(this.playlistEngine,{titleId:t.titleId}).getItems()[0],r=new Jy.PlaylistRelativeView(this.playlistEngine,{titleId:t.titleId,type:"Recap"===n.type?"Recap":"Main"}).getItems();if(0===r.length)return null;if(r[0].timelineUnit===ka.TimeUnit.EpochMillis)return e;for(var i=0,o=0,a=r;o<a.length;o++){var s=a[o];if(e<s.start)return i;if(s.start<=e&&(null===s.end||e<=s.end))return i+(e-s.start);i+=null!=s.end?s.end-s.start:1/0}return i}),e.prototype.getMainContentDurationMs=freeOnUnref(function(e){var t=e.getItems(),n=t[t.length-1];return Qe.withDefault(n.timelineEnd,1/0)}),e.prototype.getBoundPositionMs=freeOnUnref(function(e,t,n){var r=e.getItems()[0].mediaRepresentation;return null==r?t:null==r.updatePeriodMs&&n-2e3<t?(u.warn("Requested position "+t+"ms near or beyond content end "+n+"ms. Converting to 0ms instead."),0):null!=r.updatePeriodMs&&n<t?(u.warn("Requested starting position "+t+"ms beyond timeline end. Binding to end position: "+n+"ms."),n):t}),e.prototype.wallClockToPublicPositionMs=freeOnUnref(function(e,t){var n=new Jy.PlaylistRelativeView(this.playlistEngine,{titleId:t}).getItems();if(0===n.length)return u.warn("Current title does not have any items to translate wall-clock time"),null;var r=n[0].contentSource;if(null==r)return u.warn("Current title does not have a ContentSource to translate wall-clock time"),null;var i=r.wallClockUtcTimeToContentTime(e);return null==i?(u.warn("Unable to compute content time for wall-clock time "+e),null):i}),e})();t.PublicTimeTranslator=n}));e(i_);i_.PublicTimeTranslator;var o_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.adAwareSeekInterceptor=null}return e.prototype.registerAdAwareSeekInterceptor=freeOnUnref(function(e){this.adAwareSeekInterceptor=e}),e.prototype.getAdAwareSeekInterceptor=freeOnUnref(function(){return this.adAwareSeekInterceptor}),e.prototype.deregisterAdAwareSeekInterceptor=freeOnUnref(function(){this.adAwareSeekInterceptor=null}),e})();t.SeekInterceptorManager=n}));e(o_);o_.SeekInterceptorManager;var a_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){var f=this;this.eventEmitter=new A.EventEmitter,this.createPlayableRange=freeOnUnref(function(e){var t=f.playlistEngine.getCurrentPosition(),n=null!=t?t:0;if(null==e.playlistRelativeConstrainedTimeWindow)return{unit:e.timelineUnit,start:e.timelineStart,end:e.timelineEnd};var r=f.getPlayableRangeOffsetTimeWindow(e.playlistRelativeConstrainedTimeWindow,n),i=e.start,o=e.end;if(null!==o&&o<r.startMs)return{unit:e.timelineUnit,start:null,end:null};if(i>r.endMs)return{unit:e.timelineUnit,start:null,end:null};i=Math.max(i,r.startMs),null!==o&&(o=Math.min(o,r.endMs));var a=e.timelineStart-e.start,s=i+a,l=o;return null!==l&&(l+=a),{unit:e.timelineUnit,start:s,end:l}}),this.playlistEngine=e,this.mpPlayer=t}return e.prototype.getTimeData=freeOnUnref(function(){var e=this.playlistEngine.getCurrentItem(),t=this.playlistEngine.getCurrentItemIndex();if(null===e||null==t)return{unit:ka.TimeUnit.ContentMillis,currentPosition:0,currentTimelineItemIndex:0,playableRanges:this.getPlayableRanges()};var n=this.mpPlayer.playbackTime,r=null!=n?n.manifestTimeMs:null,i=null!=n?n.mediaWallClockUtcTimeMs:null,o=YU.translateXpPlaylistIndexToClientTimelineIndex(t,this.playlistEngine);return{unit:e.timelineUnit,contentRelativeTimeMs:null!=r?r:void 0,currentPosition:this.getTimelineRelativeCurrentPositionMs(e),currentTimelineItemIndex:o,playableRanges:this.getPlayableRanges(),mediaWallClockUtcTime:null!=i?i:void 0}}),e.prototype.onTimeUpdate=freeOnUnref(function(){this.eventEmitter.emit("TimeDataChange",this.getTimeData())}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.getTimelineRelativeCurrentPositionMs=freeOnUnref(function(e){var t=this.playlistEngine.getCurrentPosition(),n=null!=t?t:0;return n+=e.timelineStart-e.start}),e.prototype.getPlayableRanges=freeOnUnref(function(){for(var e={},t=0,n=0,r=this.playlistEngine.getItems();n<r.length;n++){var i=r[n];!0===i.hasUnresolvedAdBreakBefore&&(e[t]={unit:i.timelineUnit,start:0,end:0},t+=1),e[t]=this.createPlayableRange(i),t+=1}return e}),e.prototype.getPlayableRangeOffsetTimeWindow=freeOnUnref(function(e,t){var n=0;return t<e.startMs?n=t-e.startMs:t>e.endMs&&(n=t-e.endMs),{startMs:e.startMs+n,endMs:e.endMs+n,isUpdating:freeOnUnref(function(){return e.isUpdating()})}}),e})();t.TimeDataManager=n}));e(a_);a_.TimeDataManager;var s_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var g=de.get("TimelineManager"),v={Ad:"Advertisement",Main:"Feature",Recap:"Recap",Aux:"Auxiliary",AdTransition:"AdTransition"};function O(e){var t=e.titleId;return null!=e.liveScheduleTitleId&&(t=e.liveScheduleTitleId),null!=e.liveSchedule&&0!==e.liveSchedule.scheduled.length&&(t+="_"+e.timelineStart),"Recap"===e.type&&(t+="_recap"),t}function S(e){var t;if("Main"===e.type)t=[e.titleId,"main"].join("_");else if("Ad"===e.type||"Aux"===e.type||"AdTransition"===e.type)t=[e.titleId,e.adInstanceId].join("_");else{if("Recap"!==e.type)throw new Error("Unrecognized PlaylistItem.type '"+e.type+"'");t=[e.titleId,e.recapInstanceId].join("_")}return null!=e.liveScheduleTitleId&&(t=e.liveScheduleTitleId),t}function U(e){if(!0!==e.hasUnresolvedAdBreakBefore)throw new Error("Item does not have an unresolved ad break");return[e.titleId,"unresolvedAdBreak",Vy.UUID.v4()].join("_")}t.createTimelineGroupId=O,t.createTimelineContentId=S;var n=freeOnUnref(function(){function e(e,t){var n=this;this.eventEmitter=new A.EventEmitter,this.appendedPseudoEntries=[],this.onPlaylistUpdate=freeOnUnref(function(){n.timeline=n.createTimeline(),n.eventEmitter.emit("TimelineChange",n.timeline)}),this.onPlaylistEnd=freeOnUnref(function(){0===n.appendedPseudoEntries.length?(g.info("<< TimelineEnded"),n.eventEmitter.emit("TimelineEnded")):(g.warn("<< TimelineBlocked"),n.eventEmitter.emit("TimelineBlocked"))}),this.playlistEngine=e,this.timeDataManager=t,this.timeline=this.createTimeline()}return e.prototype.initialize=freeOnUnref(function(){this.playlistEngine.on("PlaylistUpdate",this.onPlaylistUpdate),this.playlistEngine.on("PlaylistEnd",this.onPlaylistEnd)}),e.prototype.terminate=freeOnUnref(function(){this.playlistEngine.off("PlaylistUpdate",this.onPlaylistUpdate),this.playlistEngine.off("PlaylistEnd",this.onPlaylistEnd),this.reset()}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.getTimeline=freeOnUnref(function(){return this.timeline}),e.prototype.createTimeline=freeOnUnref(function(){for(var e=[],t={},n=0,r=this.playlistEngine.getItems();n<r.length;n++){var i=r[n];if(!0===i.hasUnresolvedAdBreakBefore){var o=U(i),a=O(i),s={timeUnit:i.timelineUnit,startTime:0,endTime:0,error:null,contentId:o,groupId:a};e.push(s),t[o]={titleId:i.titleId,contentType:"UnresolvedAdBreak",videoPreviewAssets:[]}}var l=S(i),f=O(i),u={timeUnit:i.timelineUnit,startTime:i.timelineStart,endTime:i.timelineEnd,error:null,contentId:l,groupId:f};if(e.push(u),null==t[l]){var c=v[i.type],d=null!=i.liveScheduleTitleId?i.liveScheduleTitleId:i.titleId;t[l]={titleId:d,contentType:c,metadata:i.catalogMetadata,videoPreviewAssets:i.videoPreviewAssets,transitionTimecodes:i.transitionTimecodes,pinRestrictions:i.pinRestrictions,xrayMetadata:i.xrayMetadata,liveAds:i.liveAds,channelName:null!=i.liveSchedule?i.liveSchedule.channelName:void 0,pauseBehavior:i.pauseBehavior,multiviewMetadata:i.multiviewMetadata,timeShiftPolicy:i.playbackData.timeShiftPolicy}}}for(var p=0,h=this.appendedPseudoEntries;p<h.length;p++){var m=h[p];e.push(m.timelineItem),t[m.timelineItem.contentId]=m.contentInfo}var y={items:e,contentInfos:t,timeData:this.timeDataManager.getTimeData()};return x.isEmpty(e)?g.info("Timeline updated: no items"):g.info("Timeline updated:\n"+JS.formatTimeline(y)),y}),e.prototype.appendPseudoEntry=freeOnUnref(function(e,t){null!=e.error&&(e.error=_v.InternalToExternalCodeConverter.convertCode(e.error)),this.appendedPseudoEntries.push({timelineItem:e,contentInfo:t}),this.timeline=this.createTimeline(),this.eventEmitter.emit("TimelineChange",this.timeline)}),e.prototype.reset=freeOnUnref(function(){this.appendedPseudoEntries=[]}),e})();t.TimelineManager=n}));e(s_);s_.createTimelineGroupId,s_.createTimelineContentId,s_.TimelineManager;var l_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f={prsStartTime:"prsNextUpStartTime",prsEndTime:"prsNextUpEndTime",manifestDownloadStartTime:"manifestDownloadNextUpStartTime",manifestDownloadEndTime:"manifestDownloadNextUpEndTime",manifestParseStartTime:"manifestParseNextUpStartTime",manifestParseEndTime:"manifestParseNextUpEndTime",mediaRepresentationStartTime:"mediaRepresentationNextUpStartTime",mediaRepresentationEndTime:"mediaRepresentationNextUpEndTime"},n=freeOnUnref(function(){function e(e){this.firstManifestParsed=!1,this.licenseTracker={},this.timeToFirstFrameData={},this.mediaEventController=e}return e.prototype.onEvent=freeOnUnref(function(e,t,n){if("ttff"===t){for(var r=!1,i=null,o=0,a=Object.keys(n);o<a.length;o++){var s=a[o],l=s;"drmSessionId"!==s?(null!=i&&(l=this.replaceDrmSessionId(s,i)),this.firstManifestParsed&&f.hasOwnProperty(s)?l=f[s]:"mediaRepresentationEndTime"===s&&(this.firstManifestParsed=!0),this.timeToFirstFrameData[l]=n[s].toString(),"playerCalculatedTtffMs"===s&&(r=!0)):i=n[s]}r&&(this.mediaEventController.reportCustomMetadata(this.timeToFirstFrameData),this.reset())}}),e.prototype.reset=freeOnUnref(function(){this.firstManifestParsed=!1,this.licenseTracker={},this.timeToFirstFrameData={}}),e.prototype.replaceDrmSessionId=freeOnUnref(function(e,t){return null==this.licenseTracker[t]&&(this.licenseTracker[t]=Object.keys(this.licenseTracker).length+1),e.replace("{SESSION_ID}",this.licenseTracker[t].toString())}),e})();t.TimeToFirstFrameDataSink=n}));e(l_);l_.TimeToFirstFrameDataSink;var f_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var d=de.get("XpPlayerAdReportingFeature");function p(e,t){return e.filter(freeOnUnref(function(e){return e.id===t})).map(freeOnUnref(function(e){return{url:e.uri,method:"GET"}}))}function h(e,t){return e.filter(freeOnUnref(function(e){return e.name===t})).map(freeOnUnref(function(e){var t=null!=e.httpMethod?e.httpMethod:"GET";return{url:e.uri,method:t,data:e.data}}))}var m=["expand","collapse","acceptInvitation"],n=freeOnUnref(function(){function e(e,t,n){var i=this;this.version="0.0.1",this.objectId="XpPlayer-Ad-Reporting-Feature-"+Math.random(),this.onEnterItem=freeOnUnref(function(e){var t=e.item.adInstanceId;null!=t&&i.encounteredAdInstanceIds.push(t)}),this.onPlaylistUpdate=freeOnUnref(function(){for(var e=[],t=0,n=i.playlistEngine.getItems();t<n.length;t++){var r=n[t];null!=r.adInstanceId&&e.push(r.adInstanceId)}i.encounteredAdInstanceIds=x.intersection(i.encounteredAdInstanceIds,e)}),this.adEventReporter=e,this.playlistEngine=t,this.encounteredAdInstanceIds=[],this.mpPlayerProxy=n,t.on("EnterItem",this.onEnterItem),t.on("PlaylistUpdate",this.onPlaylistUpdate)}return e.prototype.notifyAdErrorEvent=freeOnUnref(function(e,t,n){for(var r=0,i=this.playlistEngine.getItems();r<i.length;r++){var o=i[r];if(o.adInstanceId===e)if(null!=o.sourceUrlStore){if(null!=o.trackingEvents){var a=o.trackingEvents.filter(freeOnUnref(function(e){return"error"===e.name}));if(0!==a.length){var s=a.map(freeOnUnref(function(e){return{url:e.uri,method:"POST",data:t}})),l={ERRORCODE:t};null!=this.mpPlayerProxy.currentTimeMs&&(l.ATTIME=this.mpPlayerProxy.currentTimeMs.toString()),null!=n&&(l.EVENTTYPE=n),this.adEventReporter.send(s,l)}}}else d.warn("Ignoring beacon URL reporting due to missing SourceUrlStore")}}),e.prototype.notifyAdInteractionEvent=freeOnUnref(function(e,t,n){if(null==e||"customClick"===e&&null==n)d.warn("Invalid ad event notification: "+e+" event with customClickId "+n+".");else if(-1!==this.encounteredAdInstanceIds.indexOf(t))for(var r=0,i=this.playlistEngine.getItems();r<i.length;r++){var o=i[r];if(o.adInstanceId===t){var a=this.getItemConsumptionId(o);if(null!=a){var s=[],l=o.adVideoClickTrackingUris;if("customClick"===e&&null!=l&&null!=l.customClicks)s.push.apply(s,p(l.customClicks,n));else if("clickThrough"===e&&null!=l&&null!=l.clickThroughTrackingUris)for(var f=0,u=l.clickThroughTrackingUris;f<u.length;f++){var c=u[f];s.push({url:c,method:"GET"})}else-1<m.indexOf(e)&&null!=o.trackingEvents&&s.push.apply(s,h(o.trackingEvents,e));0<s.length?this.adEventReporter.send(s,{CONSUMPTIONID:a}):d.warn("The uri for '"+e+"' event with customClickId '"+n+"' cannot be found")}else d.warn("Ignoring beacon URL reporting due to missing consumptionId")}}else d.warn("adInstanceId "+t+" has not yet been encountered. Ignoring.")}),e.prototype.invokeAdTrackingUrl=freeOnUnref(function(e){this.adEventReporter.send([{url:e,method:"GET"}])}),e.prototype.toggleReporting=freeOnUnref(function(e){this.adEventReporter.toggleReporting(e)}),e.prototype.toJSON=freeOnUnref(function(){return{version:this.version,objectId:this.objectId}}),e.prototype.terminate=freeOnUnref(function(){this.playlistEngine.off("EnterItem",this.onEnterItem),this.playlistEngine.off("PlaylistUpdate",this.onPlaylistUpdate)}),e.prototype.getItemConsumptionId=freeOnUnref(function(e){return null!=e.sourceUrlStore?e.sourceUrlStore.get().urlId:null!=e.consumptionIdUpdater&&null!=e.consumptionIdUpdater.consumptionId?e.consumptionIdUpdater.consumptionId:null}),e})();t.XpPlayerAdReportingFeature=n}));e(f_);f_.XpPlayerAdReportingFeature;var u_=t(freeOnUnref(function(e,t){var f=ce&&ce.__assign||freeOnUnref(function(){return(f=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var u=de.get("XpPlayerMetricsReportingFeature"),n=freeOnUnref(function(){function e(e,t,n){this.version="0.0.1",this.objectId="XpPlayer-Metrics-"+Math.random(),this.mediaEventReporter=e,this.sessionIdTracker=t,this.mediaEventController=n}return e.prototype.reportInteraction=freeOnUnref(function(e,t,n,r,i,o,a,s,l){void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),"Play"===t&&this.reportInteractionPlayTrace(s);var f=Tv.InteractionEventFactory.createInteractionEvent(e,t,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId(),n,a,r,l,i,o,s);this.mediaEventReporter.enqueueMediaEvents([f])}),e.prototype.reportInterface=freeOnUnref(function(e,t,n,r){var i=Tv.InterfaceEventFactory.createInterfaceEvent(e,t,null!=r?r:null,n,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId());this.mediaEventReporter.enqueueMediaEvents([i])}),e.prototype.reportRating=freeOnUnref(function(e,t,n){var r=Tv.RatingEventFactory.createRatingEvent(e,t,n);this.mediaEventReporter.enqueueMediaEvents([r])}),e.prototype.reportAcquisition=freeOnUnref(function(e,t,n,r,i,o){var a=this.mediaEventController.getConsumptionId();if(null!=i||null!=a){var s=f({bitrate:null,bitrateCap:null,resolutionCap:null,fragment:!1,fragmentDuration:null,fragmentIndex:null,fragmentResolution:null,scoreModel:null,qualityScore:null},t),l=Tv.AcquisitionEventFactory.createAcquisitionEvent(e,s,n,r,Qe.withDefault(i,a),Qe.withDefault(o,!1));this.mediaEventReporter.enqueueMediaEvents([l])}else u.warn("Not reporting "+e+" Acquisition event: no consumption ID available.")}),e.prototype.reportError=freeOnUnref(function(e,t,n,r){var i;i=t instanceof Error?t.toString():JSON.stringify(t),e?u.error("Client fatal error: "+i):u.warn("Client nonfatal error: "+i),this.mediaEventController.reportError(e,t,n,r)}),e.prototype.reportPlayback=freeOnUnref(function(e){this.mediaEventController.reportPlayback(e)}),e.prototype.reportRemote=freeOnUnref(function(e,t,n){var r=Tv.RemoteEventFactory.createRemoteEvent(e,t,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId(),n);this.mediaEventReporter.enqueueMediaEvents([r])}),e.prototype.setDisplayMode=freeOnUnref(function(e){this.mediaEventController.setDisplayMode(e)}),e.prototype.setViewportMode=freeOnUnref(function(e){this.mediaEventController.setViewportMode(e)}),e.prototype.reportWeblab=freeOnUnref(function(e,t){this.mediaEventController.reportWeblab(e,t)}),e.prototype.reportFeatureFlag=freeOnUnref(function(e,t){this.mediaEventController.reportFeatureFlag(e,t)}),e.prototype.reportCapabilities=freeOnUnref(function(e){this.mediaEventController.reportPlayerCapability(e)}),e.prototype.reportMultiplayer=freeOnUnref(function(e,t,n,r,i,o){var a=Tv.MultiplayerEventFactory.createMultiplayerEvent(e,t,n,r,i,o,this.sessionIdTracker.getPlayerInstanceId(),this.sessionIdTracker.getWatchSessionId());this.mediaEventReporter.enqueueMediaEvents([a])}),e.prototype.reportCustomMetadata=freeOnUnref(function(e){this.mediaEventController.reportCustomMetadata(e)}),e.prototype.reportCustomMetrics=freeOnUnref(function(e){this.mediaEventController.reportCustomMetrics(e)}),e.prototype.reportInteractionPlayTrace=freeOnUnref(function(e){if(!0!==this.mediaEventController.traceEventController.hasReportedPrePlayback){var t={interactionType:"Play",timeOffset:(e=Qe.withDefault(e,0)).toString()},n=Date.now(),r=n+e;this.mediaEventController.traceEventController.reportTraceStart("PlaybackStartup","PrePlayback",null,t,r),this.mediaEventController.traceEventController.reportTraceStop("PlaybackStartup","PrePlayback","Success",null,t,n),this.mediaEventController.traceEventController.hasReportedPrePlayback=!0}}),e.prototype.toJSON=freeOnUnref(function(){return{version:this.version,objectId:this.objectId}}),e})();t.XpPlayerMetricsReportingFeature=n}));e(u_);u_.XpPlayerMetricsReportingFeature;var c_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.version="0.0.1",this.objectId="XpPlayer-Volume-"+Math.random(),this.volumeFeature=e}return Object.defineProperty(e.prototype,"volume",{get:freeOnUnref(function(){return this.volumeFeature.volume}),set:freeOnUnref(function(e){this.volumeFeature.volume=e}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:freeOnUnref(function(){return this.volumeFeature.muted}),set:freeOnUnref(function(e){this.volumeFeature.muted=e}),enumerable:!0,configurable:!0}),e.prototype.setMuted=freeOnUnref(function(e){this.muted=e}),e.prototype.setVolume=freeOnUnref(function(e){this.volume=e}),e.prototype.offChange=freeOnUnref(function(e){this.volumeFeature.offChange(e)}),e.prototype.onChange=freeOnUnref(function(e){this.volumeFeature.onChange(e)}),e.prototype.toJSON=freeOnUnref(function(){return{version:this.version,objectId:this.objectId,muted:this.muted,volume:this.volume}}),e})();t.XpPlayerVolumeFeature=n}));e(c_);c_.XpPlayerVolumeFeature;var d_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.version="0.0.1",this.objectId="XpPlayer-PictureInPicture-"+Math.random(),this.pictureInPictureFeature=e}return e.prototype.requestPictureInPicture=freeOnUnref(function(){return this.pictureInPictureFeature.requestPictureInPicture()}),e.prototype.exitPictureInPicture=freeOnUnref(function(){return this.pictureInPictureFeature.exitPictureInPicture()}),e.prototype.isPictureInPicture=freeOnUnref(function(){return this.pictureInPictureFeature.isPictureInPicture()}),e.prototype.isSupported=freeOnUnref(function(){return(null==L.configurationStore.configuration||null==L.configurationStore.configuration.pictureInPicture||"disabled"!==L.configurationStore.configuration.pictureInPicture.activation)&&this.pictureInPictureFeature.isSupported()}),e.prototype.offChange=freeOnUnref(function(e){this.pictureInPictureFeature.offChange(e)}),e.prototype.onChange=freeOnUnref(function(e){this.pictureInPictureFeature.onChange(e)}),e.prototype.toJSON=freeOnUnref(function(){return{version:this.version,objectId:this.objectId}}),e})();t.XpPlayerPictureInPictureFeature=n}));e(d_);d_.XpPlayerPictureInPictureFeature;var p_=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("XpPlayerVideoPreviewFeature"),r=((n={}).Waiting="Waiting",n.Ready="Ready",n),i=freeOnUnref(function(){function e(e){var n=this;this.version="0.0.1",this.objectId="XpPlayer-Video-Preview-"+Math.random(),this.videoPreviewState="Waiting",this.anticipatedMaxPlayableRangeLengthMs=216e5,this.previousPlaylistItem=null,this.currentPlaylistItem=null,this.eventEmitter=new A.EventEmitter,this.onPlaylistUpdate=freeOnUnref(function(){var e=n.playlistEngine.getCurrentItem();null==e&&null!=n.currentPlaylistItem&&(n.switchCurrentItem(e),n.onCurrentItemChange())}),this.onEnterItem=freeOnUnref(function(e){n.switchCurrentItem(e.item),null!=e.item&&null!=e.item.initializeContentCallback?e.item.initializeContentCallback().then(freeOnUnref(function(){n.cancelToken.throwIfRequested(),n.onCurrentItemChange()})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||o.error("Error happened when processing a deferred content",e)})):n.onCurrentItemChange()}),this.onRevokeSeekPreview=freeOnUnref(function(){o.info("<< RevokeVideoPreview"),n.eventEmitter.emit("RevokeVideoPreview")}),this.onSeekPreviewExists=freeOnUnref(function(){(!n.prevTitleVideoPreviewExists||null==n.previousPlaylistItem||null!=n.currentPlaylistItem&&n.previousPlaylistItem.titleId!==n.currentPlaylistItem.titleId)&&(o.info("<< VideoPreviewExists"),n.eventEmitter.emit("VideoPreviewExists")),n.curTitleVideoPreviewExists=!0}),this.onSeekPreviewStateChange=freeOnUnref(function(e){var t=n.convertSeekPreviewState(e);t!==n.videoPreviewState&&(n.videoPreviewState=t,o.info("<< VideoPreviewStateChange: "+n.videoPreviewState),n.eventEmitter.emit("VideoPreviewStateChange",n.videoPreviewState))});var t=lt.CancelToken.source(),r=t.token,i=t.cancel;this.cancelFunction=i,this.cancelToken=r,this.playlistEngine=e,this.prevTitleVideoPreviewExists=!1,this.curTitleVideoPreviewExists=!1}return e.prototype.initialize=freeOnUnref(function(e){this.videoPreviewFeatureConfig=e,this.playlistEngine.on("EnterItem",this.onEnterItem),this.playlistEngine.on("PlaylistUpdate",this.onPlaylistUpdate)}),e.prototype.terminate=freeOnUnref(function(){this.cancelFunction(),this.prevTitleVideoPreviewExists=!1,this.curTitleVideoPreviewExists=!1,this.playlistEngine.off("EnterItem",this.onEnterItem),this.playlistEngine.off("PlaylistUpdate",this.onPlaylistUpdate),this.detachContentSourceListeners()}),e.prototype.getSeekPreviewRestriction=freeOnUnref(function(){return e.transformSeekPreviewRestriction(this.videoPreviewFeatureConfig)}),e.prototype.getTileAt=freeOnUnref(function(e,t){var n=null==t?this.playlistEngine.getCurrentItemIndex():t;if("Waiting"===this.videoPreviewState||null==n)return null;var r=this.playlistEngine.getItems()[n];if(null==r||null==r.contentSource)return null;var i=this.getManifestToTimelineOffsetMs(r),o=r.contentSource.seekPreview.getTileAt(e+i);return null==o?null:this.convertSeekPreviewTile(o,i,n)}),e.prototype.getTilesInRange=freeOnUnref(function(l,f,e,t){var u=this;if("Waiting"===this.videoPreviewState)return[];var c=null==e?this.playlistEngine.getCurrentItemIndex():e,d=null==t?this.playlistEngine.getCurrentItemIndex():t;if(null==c||null==d)return[];for(var p=[],h=this.playlistEngine.getItems(),n=Math.min(d,h.length-1),r=freeOnUnref(function(t){var e=h[t];if(null==e.contentSource)return"continue";var n=l;c<t&&(n=e.timelineStart);var r=f;t<d&&(r=null!=e.timelineEnd?e.timelineEnd:1/0);var i=m.getManifestToTimelineOffsetMs(e),o=n+i,a=r+i,s=e.contentSource.seekPreview.getTilesInRange(o,a);p=p.concat(s.map(freeOnUnref(function(e){return u.convertSeekPreviewTile(e,i,t)})))}),m=this,i=c;i<=n;i++)r(i);return p.sort(freeOnUnref(function(e,t){return e.startTime-t.startTime}))}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.toJSON=freeOnUnref(function(){return{version:this.version,objectId:this.objectId}}),e.prototype.convertSeekPreviewTile=freeOnUnref(function(e,t,n){var r=e.tileConfig,i={mimeType:r.mimeType,thumbnailDurationMs:r.thumbnailDurationMs,thumbnailResolutionPx:{height:r.thumbnailHeight,width:r.thumbnailWidth},tileResolutionCells:{height:r.tileHeight,width:r.tileWidth}};return{startTime:e.startTimeMs-t,endTime:e.endTimeMs-t,timelineItemIndex:n,presentationTimeOffsetMs:e.presentationTimeOffsetMs,data:e.data,tileConfiguration:i}}),e.prototype.getManifestToTimelineOffsetMs=freeOnUnref(function(e){return e.start-e.timelineStart}),e.prototype.switchCurrentItem=freeOnUnref(function(e){this.detachContentSourceListeners(),this.previousPlaylistItem=this.currentPlaylistItem,this.currentPlaylistItem=e,this.prevTitleVideoPreviewExists=this.curTitleVideoPreviewExists,this.curTitleVideoPreviewExists=!1}),e.prototype.onCurrentItemChange=freeOnUnref(function(){var e=null;null!=this.currentPlaylistItem&&null!=this.currentPlaylistItem.contentSource&&null!=this.currentPlaylistItem.contentSource.seekPreview.on&&(this.currentPlaylistItem.contentSource.seekPreview.on("revokeSeekPreview",this.onRevokeSeekPreview),this.currentPlaylistItem.contentSource.seekPreview.on("seekPreviewExists",this.onSeekPreviewExists),this.currentPlaylistItem.contentSource.seekPreview.on("seekPreviewStateChange",this.onSeekPreviewStateChange),e=this.currentPlaylistItem.contentSource.seekPreview.seekPreviewState),this.onSeekPreviewStateChange(e)}),e.prototype.convertSeekPreviewState=freeOnUnref(function(e){return null==e?"Waiting":r[e]}),e.prototype.detachContentSourceListeners=freeOnUnref(function(){null!=this.currentPlaylistItem&&null!=this.currentPlaylistItem.contentSource&&null!=this.currentPlaylistItem.contentSource.seekPreview.off&&(this.currentPlaylistItem.contentSource.seekPreview.off("revokeSeekPreview",this.onRevokeSeekPreview),this.currentPlaylistItem.contentSource.seekPreview.off("seekPreviewExists",this.onSeekPreviewExists),this.currentPlaylistItem.contentSource.seekPreview.off("seekPreviewStateChange",this.onSeekPreviewStateChange))}),e.transformSeekPreviewRestriction=freeOnUnref(function(e){if(null!=e){var t=void 0;return e.imageCroppingSupported||(t={height:1,width:1}),{maxTileResolutionCells:t,maxTileResolutionPx:e.maxTileResolutionPx}}}),e})();t.XpPlayerVideoPreviewFeature=i}));e(p_);p_.XpPlayerVideoPreviewFeature;var h_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("PlayerPrioritizationSystem"),n=freeOnUnref(function(){function e(e){var t=this;this.absolutePlaylistItems=[],this.onPlaylistUpdated=freeOnUnref(function(){t.absolutePlaylistItems=t.getAbsolutePlaylistItems()}),this.playlist=e,this.playlist.on("PlaylistUpdate",this.onPlaylistUpdated)}return e.prototype.getDistanceFromPlayhead=freeOnUnref(function(e,t){var n=this.getAbsoluteCurrentPosition();return null==n?1/0:this.getAbsolutePosition(e,t)-n}),e.prototype.getPriority=freeOnUnref(function(e,t){var n=this.getAbsoluteCurrentPosition();if(null==n)return 1/0;var r=this.getAbsolutePosition(e,t);return r-n+t.durationMs<-6e3?1/0:r}),e.prototype.getAbsoluteCurrentPosition=freeOnUnref(function(){var e=this.playlist.getCurrentItemIndex(),t=this.playlist.getCurrentPosition();if(null==e||e>=this.absolutePlaylistItems.length||null==t)return i.error("Unable to retrieve current position."),null;var n=this.absolutePlaylistItems[e];return n.absoluteStartMs+(t-n.item.start)}),e.prototype.getPriorityComparable=freeOnUnref(function(e,t){}),e.prototype.getAbsolutePosition=freeOnUnref(function(n,r){var e=x.find(this.absolutePlaylistItems,freeOnUnref(function(e){var t=r.startTimeMs;return e.item.contentSource===n&&e.item.start<=t&&(null==e.item.end||e.item.end>=t)}));if(null!=e){var t=e.item.start;return e.absoluteStartMs+(r.startTimeMs-t)}if(null!=(e=x.find(this.absolutePlaylistItems,freeOnUnref(function(e){var t=r.endTimeMs;return e.item.contentSource===n&&e.item.start<=t&&(null==e.item.end||e.item.end>=t)})))){t=e.item.start;return Math.max(0,e.absoluteStartMs+(r.startTimeMs-t))}return i.error("Couldn't find Playlist Item for position "+JSON.stringify(r)),1/0}),e.prototype.getAbsolutePlaylistItems=freeOnUnref(function(){for(var e=[],t=0,n=0,r=this.playlist.getItems();n<r.length;n++){var i=r[n],o=(null!=i.end?i.end:1/0)-i.start;e.push({item:i,absoluteStartMs:t,absoluteEndMs:t+o}),t+=o}return e}),e})();t.PlayerPrioritizationSystem=n}));e(h_);h_.PlayerPrioritizationSystem;var m_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerPrioritizationSystem=h_.PlayerPrioritizationSystem}));e(m_);m_.PlayerPrioritizationSystem;var y_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("XpPlayerDiagnosticsFeature"),r=freeOnUnref(function(){function e(e){var r=this;this.version="0.0.1",this.objectId="XpPlayer-Diagnostics-"+Math.random(),this.eventEmitter=new A.EventEmitter,this.streamingTechnology=null,this.onPlaylistUpdate=freeOnUnref(function(){null===r.playlistEngine.getCurrentItem()&&r.updateStreamingTechnology(null)}),this.onEnterItem=freeOnUnref(function(e){var t=null!=e.item?e.item.contentSource:null,n=r.getContentSourceStreamingTechnology(t);r.updateStreamingTechnology(n)}),this.playlistEngine=e}return e.prototype.initialize=freeOnUnref(function(){this.playlistEngine.on("EnterItem",this.onEnterItem),this.playlistEngine.on("PlaylistUpdate",this.onPlaylistUpdate)}),e.prototype.terminate=freeOnUnref(function(){this.playlistEngine.off("EnterItem",this.onEnterItem),this.playlistEngine.off("PlaylistUpdate",this.onPlaylistUpdate),this.reset()}),e.prototype.reset=freeOnUnref(function(){this.updateStreamingTechnology(null)}),e.prototype.getStreamingTechnology=freeOnUnref(function(){return this.streamingTechnology}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.toJSON=freeOnUnref(function(){return{version:this.version,objectId:this.objectId}}),e.prototype.updateStreamingTechnology=freeOnUnref(function(e){e!==this.streamingTechnology&&(this.streamingTechnology=e,n.info("<< StreamingTechnologyChange: "+this.streamingTechnology),this.eventEmitter.emit("StreamingTechnologyChange",e))}),e.prototype.getContentSourceStreamingTechnology=freeOnUnref(function(e){return e instanceof Nc.SafariHlsContentSource?"HLS":e instanceof nf.LiveLowLatencyContentSource?"Sye":e instanceof Ty.FragmentContentSource?"DASH":(n.warn("Couldn't determine streaming technology for content source "+e+"."),null)}),e})();t.XpPlayerDiagnosticsFeature=r}));e(y_);y_.XpPlayerDiagnosticsFeature;var g_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var i=this;this.version="0.0.1",this.objectId="XpPlayer-Troubleshooting-"+Math.random(),this.eventEmitter=new A.EventEmitter,this.errorTextsByErrorCode={},this.feedbackOptions=[],this.troubleshootingTips=null,this.observationsCatalog=null,this.handleBootstrapCompleted=freeOnUnref(function(e){i.errorTextsByErrorCode=e.errorTextsByErrorCode,i.feedbackOptions=e.feedbackOptions,i.troubleshootingTips=e.troubleshootingTips,i.observationsCatalog=e.observationsByLocale;var t=e.sonarPreferences;i.featureEnabled=t.isSonarUxEnabled,i.featureNotificationEnabled=t.isSonarUxNotificationEnabled,i.featurePassiveMessagingEnabled=t.isSonarUxObservationEnabled,i.featureWebClientCallToActionText=t.sonarUxCallToActionTextWeb,i.featureLrClientCallToActionText=t.sonarUxCallToActionTextLr,i.featureCriticalMessagingEnabled=t.sonarUxErrorDialogEnabled,i.featureTroubleshootingEnabled=t.sonarUxTroubleshootingEnabled,i.featureFeedbackEnabled=t.sonarUxFeedbackEnabled,i.eventEmitter.emit("BootstrapCompleted",void 0)}),this.handleTroubleshootingNotification=freeOnUnref(function(e){var t="passive"===e.criticality&&!i.passiveMessagingEnabled,n="critical"===e.criticality&&!i.criticalMessagingEnabled;if(!(t||n)){var r={errorCode:e.errorCode,criticality:e.criticality};i.eventEmitter.emit("TroubleshootingNotification",r)}}),this.sonarClientSDK=e,this.featureEnabled=!1,this.featureNotificationEnabled=!1,this.featurePassiveMessagingEnabled=!1,this.featureWebClientCallToActionText="",this.featureLrClientCallToActionText="",this.featureCriticalMessagingEnabled=!1,this.featureTroubleshootingEnabled=!1,this.featureFeedbackEnabled=!1}return e.prototype.initialize=freeOnUnref(function(){this.sonarClientSDK.on("bootstrapCompletedEvent",this.handleBootstrapCompleted),this.sonarClientSDK.on("uxNotificationEvent",this.handleTroubleshootingNotification)}),e.prototype.terminate=freeOnUnref(function(){this.sonarClientSDK.off("bootstrapCompletedEvent",this.handleBootstrapCompleted),this.sonarClientSDK.off("uxNotificationEvent",this.handleTroubleshootingNotification)}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.getTroubleshootingCriticalMessage=freeOnUnref(function(t,e){var n=this.errorTextsByErrorCode[t];if(this.criticalMessagingEnabled&&null!=n){var r=n.title,i=n.message,o=Qe.withDefault(this.troubleshootingTips,{}),a=x.find(o,freeOnUnref(function(e){return e.errorCode===t})),s=[],l=[];return this.troubleshootingStepsEnabled&&null!=a&&(s=a.options),this.feedbackOptionsEnabled&&(l=this.feedbackOptions),{title:r,message:i,feedbackOptions:l,troubleshootingSteps:s}}}),e.prototype.getTroubleshootingPassiveMessage=freeOnUnref(function(e,t){if(this.passiveMessagingEnabled&&null!=this.observationsCatalog){var n=this.observationsCatalog.uxObservationsByLanguage;if(null!=n[t]){var r=n[t];if(null!=r[e]){var i=r[e].message;if(null!=i)return{message:i}}}}}),e.prototype.getStaticMessages=freeOnUnref(function(e,t){var n="";switch(e){case"LR":n=this.featureLrClientCallToActionText;break;case"Web":n=this.featureWebClientCallToActionText;break;default:return}return{callToActionText:n}}),e.prototype.submitFeedback=freeOnUnref(function(e){this.sonarClientSDK.submitFeedback(e)}),e.prototype.toJSON=freeOnUnref(function(){return{version:this.version,objectId:this.objectId}}),Object.defineProperty(e.prototype,"isEnabled",{get:freeOnUnref(function(){return this.featureEnabled}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"notificationsEnabled",{get:freeOnUnref(function(){return this.featureNotificationEnabled}),set:freeOnUnref(function(e){}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"passiveMessagingEnabled",{get:freeOnUnref(function(){return this.featurePassiveMessagingEnabled}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"criticalMessagingEnabled",{get:freeOnUnref(function(){return this.featureCriticalMessagingEnabled}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"troubleshootingStepsEnabled",{get:freeOnUnref(function(){return this.featureTroubleshootingEnabled}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"feedbackOptionsEnabled",{get:freeOnUnref(function(){return this.featureFeedbackEnabled}),enumerable:!0,configurable:!0}),e})();t.XpPlayerTroubleshootingFeature=n}));e(g_);g_.XpPlayerTroubleshootingFeature;var v_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.eventType=e,this.timestampInMilliseconds=t}return e.getDeviceMetrics=freeOnUnref(function(){return this.DEVICE_METRIC_LIST}),e.prototype.deconstruct=freeOnUnref(function(){return{}}),e.DEVICE_METRIC_LIST=[],e})();t.AbstractSonarEvent=n}));e(v_);v_.AbstractSonarEvent;var O_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="Network Connectivity",r={3900:{title:n,message:"Your device is having trouble connecting to the internet."},3901:{title:n,message:"Your device has a weak Wi-Fi signal."},3902:{title:n,message:"Your device has changed connection types resulting in a reduced viewing experience."},3903:{title:n,message:"Your device's Wi-Fi connection requires authentication."},3907:{title:n,message:"Your device might be experiencing high latency (slower connections) to reach sites on the Internet."},3908:{title:n,message:"Your device is experiencing a problem with a firewall or ad blocker."},3909:{title:n,message:"Your device is having trouble connecting to your local (home) router."},3910:{title:n,message:"Your device doesn't have enough bandwidth available for Prime Video."}};t.DefaultErrorMessages=r}));e(O_);O_.DefaultErrorMessages;var S_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=[{label:"Troubleshooting tips did not work.",value:"Did not work"},{label:"I didn't understand the troubleshooting tips.",value:"Did not understand"},{label:"The troubleshooting was not for my problem.",value:"Not applicable"},{label:"I needed more help.",value:"Needed more help"},{label:"I was able to solve my problem.",value:"Solved"}];t.DefaultFeedbackOptions=n}));e(S_);S_.DefaultFeedbackOptions;var U_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(e,t,n){var r=i.call(this,"BootstrapCompletedEvent",Date.now())||this;return r.sonarPreferences=e,r.errorTextsByErrorCode=O_.DefaultErrorMessages,r.feedbackOptions=S_.DefaultFeedbackOptions,r.troubleshootingTips=t,r.observationsByLocale=n,r}return n(e,i),e.prototype.getType=freeOnUnref(function(){return"sonarBootstrapCompletedEvent"}),e})(v_.AbstractSonarEvent);t.BootstrapCompletedEvent=r}));e(U_);U_.BootstrapCompletedEvent;var b_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){void 0===t&&(t=Date.now());var n=r.call(this,"Buffer",t)||this;return n.audioBufferDurationInMilliseconds=e.audioBufferDurationInMilliseconds,n.videoBufferDurationInMilliseconds=e.videoBufferDurationInMilliseconds,n.audioFragmentBufferDurationInMilliseconds=e.audioFragmentBufferDurationInMilliseconds,n.videoFragmentBufferDurationInMilliseconds=e.videoFragmentBufferDurationInMilliseconds,n.audioSourceBufferDurationInMilliseconds=e.audioSourceBufferDurationInMilliseconds,n.videoSourceBufferDurationInMilliseconds=e.videoSourceBufferDurationInMilliseconds,n}return n(e,r),e.prototype.deconstruct=freeOnUnref(function(){var t=this,n={};return e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"audioBufferDurationsMillis":null!=t.audioBufferDurationInMilliseconds&&(n[e]=Math.round(t.audioBufferDurationInMilliseconds).toString());break;case"videoBufferDurationsMillis":null!=t.videoBufferDurationInMilliseconds&&(n[e]=Math.round(t.videoBufferDurationInMilliseconds).toString());break;case"audioContentBufferDurationMillis":null!=t.audioFragmentBufferDurationInMilliseconds&&(n[e]=Math.round(t.audioFragmentBufferDurationInMilliseconds).toString());break;case"videoContentBufferDurationsMillis":null!=t.videoFragmentBufferDurationInMilliseconds&&(n[e]=Math.round(t.videoFragmentBufferDurationInMilliseconds).toString());break;case"audioPlayerBufferDurationMillis":null!=t.audioSourceBufferDurationInMilliseconds&&(n[e]=Math.round(t.audioSourceBufferDurationInMilliseconds).toString());break;case"videoPlayerBufferDurationsMillis":null!=t.videoSourceBufferDurationInMilliseconds&&(n[e]=Math.round(t.videoSourceBufferDurationInMilliseconds).toString())}})),n}),e.prototype.getType=freeOnUnref(function(){return"bufferFullnessEvent"}),e.DEVICE_METRIC_LIST=["audioBufferDurationsMillis","videoBufferDurationsMillis","audioContentBufferDurationMillis","videoContentBufferDurationsMillis","audioPlayerBufferDurationMillis","videoPlayerBufferDurationsMillis"],e})(v_.AbstractSonarEvent);t.BufferFullnessEvent=r}));e(b_);b_.BufferFullnessEvent;var P_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,"ConsumptionIdUpdateEvent",Date.now())||this;return n.fromConsumptionId=e,n.toConsumptionId=t,n}return n(e,r),e.prototype.getCurrentConsumptionId=freeOnUnref(function(){return this.toConsumptionId}),e.prototype.getPreviousConsumptionId=freeOnUnref(function(){return this.fromConsumptionId}),e.prototype.getType=freeOnUnref(function(){return"consumptionIdUpdateEvent"}),e})(v_.AbstractSonarEvent);t.ConsumptionIdUpdateEvent=r}));e(P_);P_.ConsumptionIdUpdateEvent;var M_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){void 0===t&&(t=Date.now());var n=r.call(this,"DroppedVideoFramesEvent",t)||this;return n.droppedVideoFrames=e,n}return n(e,r),e.prototype.deconstruct=freeOnUnref(function(){var t=this,n={};return e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"droppedVideoFrames":n[e]=t.droppedVideoFrames.toString()}})),n}),e.prototype.getType=freeOnUnref(function(){return"droppedVideoFramesEvent"}),e.DEVICE_METRIC_LIST=["droppedVideoFrames"],e})(v_.AbstractSonarEvent);t.DroppedVideoFramesEvent=r}));e(M_);M_.DroppedVideoFramesEvent;var C_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.calculateThroughputBitsPerSecond=freeOnUnref(function(e,t){return 0===t?-1:8*e*1e3/t}),e.calculateThroughputKilobitsPerSecond=freeOnUnref(function(e){return e/1e3}),e})();t.HttpResponseUtil=n}));e(C_);C_.HttpResponseUtil;var E_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(d){function e(e,t,n,r,i,o,a,s,l,f,u){void 0===s&&(s=Date.now());var c=d.call(this,"Acquisition",s)||this;return c.latencyInMilliseconds=e,c.throughputInBitsPerSecond=C_.HttpResponseUtil.calculateThroughputBitsPerSecond(t,n),c.downloadTimeInMilliseconds=n,c.bitrateInBitsPerSecond=r,c.widthPixel=i,c.heightPixel=o,c.assetType=a,c.cdnName=l,c.maxBitrateBitsPerSec=f,c.fragmentUrl=u,c}return n(e,d),e.prototype.deconstruct=freeOnUnref(function(){var e={};return"Video"===this.assetType?this.populateMetricForVideoFragment(e):"Audio"===this.assetType&&this.populateMetricForAudioFragment(e),e}),e.prototype.populateMetricForVideoFragment=freeOnUnref(function(t){var n=this;e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"networkLatency":t[e]=Math.round(n.latencyInMilliseconds).toString();break;case"networkThroughput":t[e]=Math.round(n.throughputInBitsPerSecond).toString();break;case"downloadTime":t[e]=Math.round(n.downloadTimeInMilliseconds).toString();break;case"videoBitrateBps":t[e]=Math.round(n.bitrateInBitsPerSecond).toString();break;case"widthPixels":if(null==n.widthPixel)break;t[e]=Math.round(n.widthPixel).toString();break;case"heightPixels":if(null==n.heightPixel)break;t[e]=Math.round(n.heightPixel).toString();break;case"cdnName":if(null==n.cdnName)break;t[e]=n.cdnName;break;case"bitrateCappedValInBps":if(null==n.maxBitrateBitsPerSec)break;t[e]=n.maxBitrateBitsPerSec.toString()}}))}),e.prototype.populateMetricForAudioFragment=freeOnUnref(function(t){var n=this;e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"audioBitrateBps":t[e]=Math.round(n.bitrateInBitsPerSecond).toString();break;case"cdnName":if(null==n.cdnName)break;t[e]=n.cdnName}}))}),e.prototype.getType=freeOnUnref(function(){return"fragmentAcquisitionEvent"}),e.DEVICE_METRIC_LIST=["networkLatency","networkThroughput","downloadTime","videoBitrateBps","audioBitrateBps","widthPixels","heightPixels","cdnName","bitrateCappedValInBps"],e})(v_.AbstractSonarEvent);t.FragmentAcquisitionEvent=r}));e(E_);E_.FragmentAcquisitionEvent;var T_=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(a){function n(e,t,n,r,i){void 0===i&&(i=Date.now());var o=a.call(this,"AcquisitionFailure",i)||this;return o.assetUrl=e,o.assetType=t,o.bitrateInBitsPerSecond=n,o.bytesExpected=r,o}return r(n,a),n.prototype.deconstruct=freeOnUnref(function(){var t={};return n.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"networkThroughput":t[e]=n.throughputZero.toString()}})),t}),n.prototype.getType=freeOnUnref(function(){return"fragmentAcquisitionFailureEvent"}),n.throughputZero=0,n.DEVICE_METRIC_LIST=["networkThroughput"],n})(v_.AbstractSonarEvent);t.FragmentAcquisitionFailureEvent=n}));e(T_);T_.FragmentAcquisitionFailureEvent;var w_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(e,t,n){var r=i.call(this,"FragmentLoadEvent",Date.now())||this;return r.streamType=e,r.durationMs=t,r.appendTimeMs=n,r}return n(e,i),e.prototype.deconstruct=freeOnUnref(function(){var e={};return"Video"===this.streamType?this.populateMetricForVideoFragment(e):"Audio"===this.streamType&&this.populateMetricForAudioFragment(e),e}),e.prototype.populateMetricForVideoFragment=freeOnUnref(function(t){var n=this;e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"videoFragmentLoadTimeMillis":t[e]=n.appendTimeMs.toString();break;case"videoFragmentdurationMillis":t[e]=n.durationMs.toString()}}))}),e.prototype.populateMetricForAudioFragment=freeOnUnref(function(t){var n=this;e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"audioFragmentLoadTimeMillis":t[e]=n.appendTimeMs.toString();break;case"audioFragmentdurationMillis":t[e]=n.durationMs.toString()}}))}),e.prototype.getStreamType=freeOnUnref(function(){return this.streamType}),e.prototype.getDurationMs=freeOnUnref(function(){return this.durationMs}),e.prototype.getAppendTimeMs=freeOnUnref(function(){return this.appendTimeMs}),e.prototype.getType=freeOnUnref(function(){return"fragmentLoadEvent"}),e.DEVICE_METRIC_LIST=["audioFragmentLoadTimeMillis","audioFragmentdurationMillis","videoFragmentLoadTimeMillis","videoFragmentdurationMillis"],e})(v_.AbstractSonarEvent);t.FragmentLoadEvent=r}));e(w_);w_.FragmentLoadEvent;var I_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(e){return void 0===e&&(e=Date.now()),t.call(this,"Acquisition",e)||this}return n(e,t),e.prototype.deconstruct=freeOnUnref(function(){var e={};return this.populateManifestAcquisitionMetric(e),e}),e.prototype.populateManifestAcquisitionMetric=freeOnUnref(function(t){var n=this;e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"manifestAcquisitionTime":t[e]=n.timestampInMilliseconds.toString()}}))}),e.prototype.getType=freeOnUnref(function(){return"manifestAcquisitionEvent"}),e.DEVICE_METRIC_LIST=["manifestAcquisitionTime"],e})(v_.AbstractSonarEvent);t.ManifestAcquisitionEvent=r}));e(I_);I_.ManifestAcquisitionEvent;var k_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){void 0===e&&(e=Date.now());var n=r.call(this,"LiveManifestError",e)||this;return n.failureReason=t,n}return n(e,r),e.prototype.deconstruct=freeOnUnref(function(){var e={};return this.populateManifestAcquisitionFailureMetric(e),e}),e.prototype.populateManifestAcquisitionFailureMetric=freeOnUnref(function(t){var n=this;e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"liveManifestStatus":t[e]=n.failureReason}}))}),e.prototype.getType=freeOnUnref(function(){return"manifestAcquisitionFailureEvent"}),e.DEVICE_METRIC_LIST=["liveManifestStatus"],e})(v_.AbstractSonarEvent);t.ManifestAcquisitionFailureEvent=r}));e(k_);k_.ManifestAcquisitionFailureEvent;var __=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(e,t,n){void 0===t&&(t=void 0),void 0===n&&(n=Date.now());var r=i.call(this,"PlaybackRestart",n)||this;return r.reason=e,r.subReason=t,r}return n(e,i),e.prototype.getDeviceMetrics=freeOnUnref(function(){return e.DEVICE_METRIC_LIST}),e.prototype.deconstruct=freeOnUnref(function(){return{}}),e.prototype.getType=freeOnUnref(function(){return"playbackRestartEvent"}),e.DEVICE_METRIC_LIST=[],e})(v_.AbstractSonarEvent);t.PlaybackRestartEvent=r}));e(__);__.PlaybackRestartEvent;var R_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,"Network",Date.now())||this}return n(t,e),t.prototype.getType=freeOnUnref(function(){return"networkOutageEvent"}),t})(v_.AbstractSonarEvent);t.NetworkOutageEvent=r}));e(R_);R_.NetworkOutageEvent;var A_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(s){function e(e,t,n,r,i,o){var a=s.call(this,"PlaybackStarted",e)||this;return a.consumptionId=t,a.titleId=n,a.videoMaterialType=r,a.streamingType=i,a.sessionStartTime=e,a.playbackUrls=o,a}return n(e,s),e.prototype.getType=freeOnUnref(function(){return"playbackStartedEvent"}),e})(v_.AbstractSonarEvent);t.PlaybackStartedEvent=r}));e(A_);A_.PlaybackStartedEvent;var D_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(e){return t.call(this,"PlaybackEnded",e)||this}return n(e,t),e.prototype.getType=freeOnUnref(function(){return"playbackEndedEvent"}),e})(v_.AbstractSonarEvent);t.PlaybackEndedEvent=r}));e(D_);D_.PlaybackEndedEvent;var x_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){void 0===t&&(t=Date.now());var n=r.call(this,"SonarNotificationReportEvent",t)||this;return n.sonarNotification=e,n}return n(e,r),e.prototype.getType=freeOnUnref(function(){return"sonarNotificationReportEvent"}),e})(v_.AbstractSonarEvent);t.SonarNotificationReportEvent=r}));e(x_);x_.SonarNotificationReportEvent;var F_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(I){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p,h,m,y,g,v,O,S,U,b,P,M,C,E,T){void 0===s&&(s=Date.now());var w=I.call(this,"SyeMetricsEvent",s)||this;return w.latencyInMilliseconds=e,w.bitrateInBitsPerSecond=t,w.videoDivergenceInMillis=n,w.consumptionId=r,w.videoBitrateInBitsPerSecond=i,w.widthPixel=o,w.heightPixel=a,w.numReceivedBytes=l,w.numReceivedFrames=f,w.numDecryptedFrames=u,w.numDecodeFailures=c,w.numDamagedAudioFrames=d,w.audioDropoutMillis=p,w.numDroppedVideoFrames=h,w.numDamagedVideoFrames=m,w.pitcherGroup=y,w.egressEndpoint=g,w.packetsReceived=v,w.packetsLost=O,w.packetsInvalid=S,w.packetsRetransmitReceived=U,w.packetsRetransmitReceivedUnused=b,w.thumbnailsReceived=P,w.notificationsReceived=M,w.prevPacketsLost=C,w.prevPacketsReceived=E,w.cdnName=T,w}return n(e,I),e.prototype.deconstruct=freeOnUnref(function(){var e={};return this.populateMetricWithFragmentResolution(e),e}),e.prototype.populateMetricWithFragmentResolution=freeOnUnref(function(t){var n=this;e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"networkLatency":t[e]=Math.round(n.latencyInMilliseconds).toString();break;case"networkThroughput":t[e]=Math.round(n.bitrateInBitsPerSecond).toString();break;case"videoDivergence":t[e]=Math.round(n.videoDivergenceInMillis).toString();break;case"consumptionId":t[e]=n.consumptionId.toString();break;case"videoBitrateBps":t[e]=Math.round(n.videoBitrateInBitsPerSecond).toString();break;case"widthPixels":t[e]=Math.round(n.widthPixel).toString();break;case"heightPixels":t[e]=Math.round(n.heightPixel).toString();break;case"packetsLost":null!=n.packetsLost&&(t[e]=Math.round(n.packetsLost).toString());break;case"packetsLostPercentage":null!=n.packetsLost&&(t[e]=Math.round(n.getPacketsLostPcent()).toString());break;case"egressPoint":null!=n.egressEndpoint&&(t[e]=n.egressEndpoint);break;case"pitcherGroup":null!=n.pitcherGroup&&(t[e]=n.pitcherGroup);break;case"numDecodeFailures":null!=n.numDecodeFailures&&(t[e]=Math.round(n.numDecodeFailures).toString());break;case"packetsRetransmitReceived":null!=n.packetsRetransmitReceived&&(t[e]=Math.round(n.packetsRetransmitReceived).toString());break;case"numDamagedAudioFrames":null!=n.numDamagedAudioFrames&&(t[e]=Math.round(n.numDamagedAudioFrames).toString());break;case"numDamagedVideoFrames":null!=n.numDamagedVideoFrames&&(t[e]=Math.round(n.numDamagedVideoFrames).toString());break;case"numDroppedVideoFrames":null!=n.numDroppedVideoFrames&&(t[e]=Math.round(n.numDroppedVideoFrames).toString());break;case"cdnName":null!=n.cdnName&&(t[e]=n.cdnName)}}))}),e.prototype.getType=freeOnUnref(function(){return"syeMetricsEvent"}),e.prototype.getPacketsLostPcent=freeOnUnref(function(){if(null!=this.packetsReceived&&null!=this.prevPacketsReceived&&null!=this.packetsLost&&null!=this.prevPacketsLost){var e=this.packetsReceived-this.prevPacketsReceived,t=this.packetsLost-this.prevPacketsLost;return 0===e?0:t/e*100}return 0}),e.DEVICE_METRIC_LIST=["networkLatency","networkThroughput","videoDivergence","consumptionId","videoBitrateBps","widthPixels","heightPixels","packetsLost","egressPoint","packetsLostPercentage","pitcherGroup","numDecodeFailures","packetsRetransmitReceived","numDamagedAudioFrames","numDamagedVideoFrames","numDroppedVideoFrames","cdnName"],e})(v_.AbstractSonarEvent);t.SyeMetricsEvent=r}));e(F_);F_.SyeMetricsEvent;var B_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,"RebufferEnd",Date.now())||this}return n(t,e),t.prototype.getType=freeOnUnref(function(){return"unexpectedRebufferEndEvent"}),t})(v_.AbstractSonarEvent);t.UnexpectedRebufferEndEvent=r}));e(B_);B_.UnexpectedRebufferEndEvent;var L_=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this,"Rebuffer",Date.now())||this;return t.unexpectedRebufferReason=e,t}return r(e,n),e.prototype.getUnexpectedRebufferReason=freeOnUnref(function(){return this.unexpectedRebufferReason}),e.prototype.getType=freeOnUnref(function(){return"unexpectedRebufferEvent"}),e})(v_.AbstractSonarEvent);t.UnexpectedRebufferEvent=n}));e(L_);L_.UnexpectedRebufferEvent;var N_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,"UxNotificationEvent",Date.now())||this;return n.criticality=e,n.errorCode=t,n}return n(e,r),e.prototype.getType=freeOnUnref(function(){return"sonarUxNotificationEvent"}),e})(v_.AbstractSonarEvent);t.UxNotificationEvent=r}));e(N_);N_.UxNotificationEvent;var V_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.type=e,this.destinationUrlSetId=t}return e.prototype.getType=freeOnUnref(function(){return this.type}),e.prototype.getDestinationUrlSetId=freeOnUnref(function(){return null!=this.destinationUrlSetId?this.destinationUrlSetId:null}),e})();t.SonarSwitchCdnEvent=n}));e(V_);V_.SonarSwitchCdnEvent;var j_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){void 0===t&&(t=Date.now());var n=r.call(this,"SonarCdnRankEvent",t)||this;return n.cdnRankList=e,n}return n(e,r),e.prototype.deconstruct=freeOnUnref(function(){var t=this,n={};return e.getDeviceMetrics().forEach(freeOnUnref(function(e){"cdnRankings"===e&&(n[e]=JSON.stringify(t.cdnRankList))})),n}),e.prototype.getType=freeOnUnref(function(){return"sonarCdnRankEvent"}),e.DEVICE_METRIC_LIST=["cdnRankings"],e})(v_.AbstractSonarEvent);t.SonarCdnRankEvent=r}));e(j_);j_.SonarCdnRankEvent;var q_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(q_);var H_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=["originFailover","other"],r=freeOnUnref(function(e){if(-1!==n.indexOf(e))return e});t.getTriggerReason=r}));e(H_);H_.getTriggerReason;var z_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));e(z_);var W_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.build=freeOnUnref(function(){return{instructionSetId:"default-bootstrap-response-123",ttlSeconds:0,actionGroups:this.buildActionGroup(),desiredDeviceMetrics:this.buildDesiredDeviceMetrics(),triggers:this.buildTriggers(),triggerConditionsV2:this.buildTriggerConditionsV2(),troubleshooting:this.buildTroubleshootingTips(),uxObservations:this.buildObservations()}}),e.prototype.buildSdkConfigurationOverrides=freeOnUnref(function(){return{isSonarProactiveReportTriggerEnabled:!0,isSonarMonitoringEnabledOnVOD:!0}}),e.prototype.buildSonarObservationControllerConfig=freeOnUnref(function(){return{isSonarObservationControllerEnabled:!0,minLongRebufferDurationSecondsForObservation:15,minRebuffersCountForObservation:3,observationControlTimeWindowSeconds:600,playbackQualityTriggerIds:["xpRebufferHttpActions"]}}),e.prototype.buildDesiredDeviceMetrics=freeOnUnref(function(){return[{id:"audioBufferDurationsMillis",historySize:60,cadenceMs:1e3},{id:"audioFragmentdurationMillis",historySize:60,cadenceMs:1e3},{id:"audioFragmentLoadTimeMillis",historySize:60,cadenceMs:1e3},{id:"cdnName",historySize:60,cadenceMs:1e3},{id:"cpuUsage",historySize:60,cadenceMs:1e3},{id:"downloadTime",historySize:60,cadenceMs:1e3},{id:"droppedVideoFrames",historySize:60,cadenceMs:1e3},{id:"egressPoint",historySize:60,cadenceMs:1e3},{id:"eventLoopLagMillis",historySize:60,cadenceMs:1e3},{id:"heightPixels",historySize:60,cadenceMs:1e3},{id:"jsMemoryUsageKB",historySize:60,cadenceMs:1e3},{id:"manifestAcquisitionTime",historySize:60,cadenceMs:1e3},{id:"networkLatency",historySize:60,cadenceMs:1e3},{id:"networkThroughput",historySize:60,cadenceMs:1e3},{id:"numDamagedAudioFrames",historySize:60,cadenceMs:1e3},{id:"numDamagedVideoFrames",historySize:60,cadenceMs:1e3},{id:"numDecodeFailures",historySize:60,cadenceMs:1e3},{id:"numDroppedVideoFrames",historySize:60,cadenceMs:1e3},{id:"packetsLost",historySize:60,cadenceMs:1e3},{id:"packetsLostPercentage",historySize:60,cadenceMs:1e3},{id:"packetsRetransmitReceived",historySize:60,cadenceMs:1e3},{id:"pitcherGroup",historySize:60,cadenceMs:1e3},{id:"processMemoryUsageKB",historySize:60,cadenceMs:1e3},{id:"videoBufferDurationsMillis",historySize:60,cadenceMs:1e3},{id:"videoDivergence",historySize:60,cadenceMs:1e3},{id:"videoFragmentdurationMillis",historySize:60,cadenceMs:1e3},{id:"videoFragmentLoadTimeMillis",historySize:60,cadenceMs:1e3},{id:"widthPixels",historySize:60,cadenceMs:1e3}]}),e.prototype.buildActionGroup=freeOnUnref(function(){return[{id:"httpInternetConnectivityTest",executionType:"SEQUENTIAL",actions:[{http:{actionType:"HTTP",cdnName:"Cloudfront",id:"checkCloudFrontConnectivityCached",includeResponseBody:!0,method:"GET",payload:"",responseBodyLimitKB:2098,timeoutMs:3e4,url:"https://assets.prod.us-east-1.sonar.prime-video.amazon.dev/cacheable/file_asset.dat"}},{http:{actionType:"HTTP",cdnName:"Fastly",id:"checkFastlyConnectivityCached",includeResponseBody:!0,method:"GET",payload:"",responseBodyLimitKB:2098,timeoutMs:3e4,url:"https://fastlyassets.prod.us-east-1.sonar.prime-video.amazon.dev/cacheable/file_asset.dat"}},{cdnRankV2:{actionType:"CDN_RANK",id:"checkCdnRank",timeoutMs:3e4,fragmentCountPerCdn:3}}]}]}),e.prototype.buildTriggers=freeOnUnref(function(){return[{id:"lowQualityPlaybackWithTimeWindowReport",on:["lowQualityPlaybackWithTimeWindow"],actionGroupIds:[]},{id:"xpRebufferHttpActions",on:["unexpectedBufferExhaustion"],actionGroupIds:["httpInternetConnectivityTest"]},{id:"playbackRestart",on:["playbackRestart"],actionGroupIds:[]}]}),e.prototype.buildTriggerConditionsV2=freeOnUnref(function(){return{lowQualityPlaybackWithTimeWindow:{id:"lowQualityPlaybackWithTimeWindow",triggerCriteria:"metricBasedTrigger",isActive:!0,thresholdBitsPerSecond:1e6,lowQualityTimeWindowSeconds:60,cooldownPeriodSeconds:3600},unexpectedBufferExhaustion:{id:"unexpectedBufferExhaustion",triggerCriteria:"eventBasedTrigger",isActive:!0,eventName:"UnexpectedRebufferEvent",triggerTimeoutMs:9e4},networkOutage:{id:"networkOutage",triggerCriteria:"eventBasedTrigger",isActive:!0,eventName:"NetworkOutageEvent",triggerTimeoutMs:9e4},playbackRestart:{id:"playbackRestart",triggerCriteria:"eventBasedTrigger",isActive:!0,triggerTimeoutMs:1e3,eventName:"playbackRestartEvent"},proactiveReport:{id:"proactiveReport",triggerCriteria:"scheduleBasedTrigger",isActive:!0,cadenceMs:9e5,probabilityFactor:1,cooldownPeriodSeconds:600},syeAISRebuffer:{id:"syeAISRebuffer",isActive:!0,triggerCriteria:"eventBasedTrigger"},syeStallRebuffer:{id:"syeStallRebuffer",isActive:!0,triggerCriteria:"eventBasedTrigger"},syeErrorRebuffer:{id:"syeErrorRebuffer",isActive:!0,triggerCriteria:"eventBasedTrigger"}}}),e.prototype.buildTroubleshootingTips=freeOnUnref(function(){return[{errorCode:"3900",options:["If using a wired device, make sure each end of the cable is securely connected. For wireless devices, verify a connection to a Wi-Fi or mobile data signal.","Go to the device's settings and check network connectivity. Ensure the device shows that it's connected.","Verify other apps on the device can access the internet. If so, try restarting the Prime Video app.","Restart your device."]},{errorCode:"3901",options:["Move your device closer to your Wi-Fi router, access point, or hot spot.","Remove obstructions between your streaming device and networking device, especially metal objects and enclosures.","Try repositioning your streaming and/or networking device so that they are pointed in a different direction.","Restart your device."]},{errorCode:"3902",options:["Verify your device is using the desired connection method. These can include wired, Wi-Fi, or mobile data, depending on your device.","Your device might switch connection types when the primary type is unavailable. For example, a wired connection might switch to Wi-Fi."]},{errorCode:"3903",options:["The specified Wi-Fi network requires a password.","Choose a different Wi-Fi network or SSID.","Switch to a different connection type, like wired or mobile data, if supported by your device."]},{errorCode:"3904",options:["Try closing other apps running on the device.","Turn off the device's power saving settings.","Restart your device."]},{errorCode:"3905",options:["Try closing other apps running on the device.","Clear your device's cache. If this option is available, it will be in the device's settings.","Restart your device."]},{errorCode:"3906",options:["Connect to a power source to charge the device.","Check your battery. If your device's battery is old or damaged, it might not be able to hold a charge properly.","Try using a different power source. If you're using a power adapter, try a different one to see if that helps.","Restart your device."]},{errorCode:"3907",options:["Restart your Internet router.","Contact your Internet provider for troubleshooting.","Repair or replace your Internet router."]},{errorCode:"3908",options:["Check your device's firewall settings. Make sure a connection or an exception for Prime Video is allowed.","Disable ad blockers."]},{errorCode:"3909",options:["If using a wired device, make sure each end of the cable is securely connected. For wireless devices, verify a connection to a Wi-Fi signal.","Go to the device's settings and check network connectivity. Ensure the device shows that it's connected.","Restart your device."]},{errorCode:"3910",options:["Try closing other apps running on the device.","Restart your device."]},{errorCode:"3911",options:["Verify mobile data is enabled.","Turn mobile data off and on again. The fastest way is to turn airplane mode on and then off.","Check your mobile signal strength.","Restart your device."]},{errorCode:"3912",options:["Try closing other apps running on the device.","Restart your device."]},{errorCode:"3913",options:["Check if power saver mode is enabled. If enabled, disable it.","Check your battery. If your device's battery is old or damaged, it might not be able to hold a charge.","Restart your device."]},{errorCode:"3914",options:["If you're running many apps, try closing some.","If using the device in a hot environment, try moving to a cooler location.","Check your battery. If your device's battery is old or damaged, it might cause overheating.","Restart your device."]}]}),e.prototype.buildObservations=freeOnUnref(function(){return{uxObservationsByLanguage:{en_US:{3900:{message:"Your device is having trouble connecting to the Internet."},3901:{message:"Your device has a weak Wi-Fi signal."},3902:{message:"Your device has changed connection types resulting in a reduced viewing experience."},3903:{message:"Your device's Wi-Fi connection requires authentication."},3904:{message:"Your device's available processor resources might be low."},3905:{message:"Your device's available memory might be low."},3906:{message:"Your device's battery is running low."},3907:{message:"Your device might be experiencing high latency (slower connections) to reach sites on the Internet."},3908:{message:"Your device is experiencing a problem with a firewall or ad blocker."},3909:{message:"Your device is having trouble connecting to your local (home) router."},3910:{message:"Your device doesn't have enough bandwidth available for Prime Video."},3911:{message:"Your device is having trouble connecting to mobile data."},3912:{message:"Your device's available processor resources might be low."},3913:{message:"Your device is operating in power saver mode."},3914:{message:"Your device is operating in critical thermal state"}}}}}),e})();t.DefaultBootstrapResponseBuilder=n}));e(W_);W_.DefaultBootstrapResponseBuilder;var K_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(){this.isSonarSdkEnabled=!0,this.isSonarUxEnabled=!0,this.isSonarUxEnabledOnLive=!0,this.isSonarUxEnabledOnVOD=!0,this.isSonarUxNotificationEnabled=!0,this.isSonarUxObservationEnabled=!0,this.sonarUxCallToActionTextWeb="Select to view additional details.",this.sonarUxCallToActionTextLr="Press DOWN for help.",this.sonarUxErrorDialogEnabled=!0,this.sonarUxTroubleshootingEnabled=!0,this.sonarUxFeedbackEnabled=!0,this.sonarUxNetworkOutageCriticalMessageEnabled=!1,this.sonarNetworkOutageErrorCode="3900"}})();t.DefaultSonarPreferences=n}));e(K_);K_.DefaultSonarPreferences;var G_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isSonarMonitoringEnabledOnLive=!0,e.isSonarMonitoringEnabledOnVOD=!0,e.isSonarProactiveReportTriggerEnabled=!1,e.isSonarPlaybackRestartTriggerEnabled=!0,e.isSonarCdnRankingEnabled=!0,e.shouldSonarCdnRankingUseGet=!1,e.shouldSonarCdnRankingUseCadence=!0,e.sonarCdnRankingCadenceMillis=3e5,e.sonarCdnRankingRequestSizeBytes=10,e.sonarCdnRankingSessionStartDelayMillis=3e5,e.sonarCdnRankingManifestRequestTimeoutMillis=1e3,e.sonarCdnRankingManifestRequestMaxRetries=2,e.sonarCdnRankingManifestRequestRetryDelayMillis=100,e.sonarCdnRankingFragmentHistoryMaxSize=5,e}return n(e,t),e})(K_.DefaultSonarPreferences);t.DefaultSonarConfiguration=r}));e(G_);G_.DefaultSonarConfiguration;var Q_=t(freeOnUnref(function(e,t){var s=ce&&ce.__assign||freeOnUnref(function(){return(s=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.sonarDefaults=new G_.DefaultSonarConfiguration,this.sonarOverrides={},this.tenantOverrides={},this.customerOverrides={},this.configuration=this.sonarDefaults}return e.prototype.getConfiguration=freeOnUnref(function(){return this.configuration}),e.prototype.setSonarOverrides=freeOnUnref(function(e){this.sonarOverrides=this.sanitizeObject(e),this.updateConfiguration()}),e.prototype.setTenantOverrides=freeOnUnref(function(e){this.tenantOverrides=this.sanitizeObject(e),this.updateConfiguration()}),e.prototype.setCustomerOverrides=freeOnUnref(function(e){this.customerOverrides=this.sanitizeObject(e),this.updateConfiguration()}),e.prototype.sanitizeObject=freeOnUnref(function(t){var n=s({},t);return Object.keys(t).forEach(freeOnUnref(function(e){void 0===t[e]&&delete n[e]})),n}),e.prototype.updateConfiguration=freeOnUnref(function(){this.configuration=s({},this.sonarDefaults,this.getAggregatedOverrides())}),e.prototype.getAggregatedOverrides=freeOnUnref(function(){var o=this,a=s({},this.sonarOverrides,this.tenantOverrides,this.customerOverrides);return Object.keys(a).forEach(freeOnUnref(function(e){var t,n=e,r=o.sonarDefaults[n],i=r;i="boolean"==typeof r?o.getAggregatedBooleanValue(n):o.getAggregatedNonBooleanValue(n),a=s({},a,((t={})[n]=i,t))})),a}),e.prototype.getAggregatedBooleanValue=freeOnUnref(function(e){var t=e;if(void 0===this.tenantOverrides[t]&&void 0===this.customerOverrides[t])return Boolean(this.sonarOverrides[t])||!1;var n=!1===this.sonarOverrides[e],r=!1===this.tenantOverrides[t],i=!1===this.customerOverrides[t];return!(n||r||i)}),e.prototype.getAggregatedNonBooleanValue=freeOnUnref(function(e){var t=e,n=this.sonarDefaults[e];return void 0!==this.customerOverrides[t]?n=this.customerOverrides[t]:void 0!==this.tenantOverrides[t]?n=this.tenantOverrides[t]:void 0!==this.sonarOverrides[t]&&(n=this.sonarOverrides[t]),n}),e})();t.SonarConfigurationManager=n}));e(Q_);Q_.SonarConfigurationManager;var X_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.samples=new Array(e),this.numSamples=0,this.rollingCounter=0}return e.prototype.addSample=freeOnUnref(function(e){this.samples[this.rollingCounter]=e,this.rollingCounter++,this.rollingCounter>=this.samples.length&&(this.rollingCounter=0),this.numSamples<this.samples.length&&this.numSamples++}),e.prototype.getSampleCount=freeOnUnref(function(){return this.numSamples}),e.prototype.getSamples=freeOnUnref(function(){return this.numSamples<this.samples.length?this.samples.slice(0,this.rollingCounter):this.samples.slice(this.rollingCounter,this.samples.length).concat(this.samples.slice(0,this.rollingCounter))}),e})();t.CircularBuffer=n}));e(X_);X_.CircularBuffer;var Y_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){this.id=e,this.history=new X_.CircularBuffer(t),this.cadenceInMilliseconds=n}return e.prototype.add=freeOnUnref(function(e){this.history.addSample(e)}),e.prototype.getInternalMetricHistoryEntries=freeOnUnref(function(){return this.history.getSamples()}),e.prototype.toExternalMetricHistory=freeOnUnref(function(){return{id:this.id,cadenceMs:this.cadenceInMilliseconds,history:this.getMetricHistoryHistoryList()}}),e.prototype.getMetricHistoryHistoryList=freeOnUnref(function(){for(var e=[],t=0,n=this.getInternalMetricHistoryEntries();t<n.length;t++){var r=n[t];e.push(this.toMetricHistoryEntry(r))}return e}),e.prototype.toMetricHistoryEntry=freeOnUnref(function(e){return{timeRecordedUTC:e.timeRecordedUTCMilliseconds,value:e.value}}),e})();t.InternalMetricHistory=n}));e(Y_);Y_.InternalMetricHistory;var J_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function a(){this.deviceMetricMapping={},this.deviceMetricMap={}}return a.prototype.process=freeOnUnref(function(e){for(var t=0,n=e.bootstrapResponse.desiredDeviceMetrics;t<n.length;t++){var r=n[t];this.deviceMetricMap[r.id]=r}}),a.prototype.updatePreferences=freeOnUnref(function(e){}),a.prototype.getLastMetricValue=freeOnUnref(function(e){var t=this.getInternalMetricHistory(e);if(null==t)return null;var n=t.getInternalMetricHistoryEntries();return 0===n.length?null:n[n.length-1].value}),a.prototype.removeInstance=freeOnUnref(function(){this.flush(),this.deviceMetricMap={}}),a.prototype.getMetricHistory=freeOnUnref(function(){for(var e=[],t=0,n=Object.keys(this.deviceMetricMapping);t<n.length;t++){var r=n[t];e.push(this.deviceMetricMapping[r].toExternalMetricHistory())}return e}),a.prototype.getInternalMetricHistory=freeOnUnref(function(e){return this.deviceMetricMapping[e]}),a.prototype.flush=freeOnUnref(function(){this.deviceMetricMapping={}}),a.prototype.add=freeOnUnref(function(e){for(var t=e.deconstruct(),n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];this.addToMetricTypeMappingEntry(i,e.timestampInMilliseconds,t[i])}}),a.prototype.addToMetricTypeMappingEntry=freeOnUnref(function(e,t,n){if(null===this.deviceMetricMapping[e]||void 0===this.deviceMetricMapping[e]){var r=0,i=a.DEFAULT_HISTORY_SIZE;null!=this.deviceMetricMap[e]&&(r=this.deviceMetricMap[e].cadenceMs,i=this.deviceMetricMap[e].historySize),this.deviceMetricMapping[e]=new Y_.InternalMetricHistory(e,i,r)}var o={timeRecordedUTCMilliseconds:t,value:n};this.deviceMetricMapping[e].add(o)}),a.DEFAULT_HISTORY_SIZE=100,a})();t.EventAggregator=n}));e(J_);J_.EventAggregator;var Z_=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.isEnabled=!1,this.sonarContext=e,this.sonarEventBus=t}return e.getDeviceMetrics=freeOnUnref(function(){return this.SONAR_EVENT_LIST}),e.prototype.enable=freeOnUnref(function(){this.isEnabled||(this.registerSonarEventBusHandler(),this.isEnabled=!0)}),e.prototype.disable=freeOnUnref(function(){this.isEnabled&&(this.unregisterSonarEventBusHandler(),this.isEnabled=!1)}),e.prototype.process=freeOnUnref(function(e){this.enable()}),e.prototype.updatePreferences=freeOnUnref(function(e){}),e.prototype.removeInstance=freeOnUnref(function(){this.disable()}),e.SONAR_EVENT_LIST=[],e})();t.SonarEventMonitorBase=n}));e(Z_);Z_.SonarEventMonitorBase;var $_=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleBufferFullnessEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("bufferFullnessEvent",this.handleBufferFullnessEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("bufferFullnessEvent",this.handleBufferFullnessEvent)}),e.SONAR_EVENT_LIST=b_.BufferFullnessEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.BufferFullnessEventMonitor=r}));e($_);$_.BufferFullnessEventMonitor;var eR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){void 0===t&&(t=Date.now());var n=r.call(this,"DeviceCPU",t)||this;return n.cpuUsage=e,n}return n(e,r),e.prototype.deconstruct=freeOnUnref(function(){var t=this,n={};return e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"cpuUsage":n[e]=t.cpuUsage.toString()}})),n}),e.prototype.getType=freeOnUnref(function(){return"cpuUsageEvent"}),e.DEVICE_METRIC_LIST=["cpuUsage"],e})(v_.AbstractSonarEvent);t.CpuUsageEvent=r}));e(eR);eR.CpuUsageEvent;var tR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleCpuUsageEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("cpuUsageEvent",this.handleCpuUsageEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("cpuUsageEvent",this.handleCpuUsageEvent)}),e.SONAR_EVENT_LIST=eR.CpuUsageEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.CpuUsageEventMonitor=r}));e(tR);tR.CpuUsageEventMonitor;var nR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleDroppedVideoFramesEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("droppedVideoFramesEvent",this.handleDroppedVideoFramesEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("droppedVideoFramesEvent",this.handleDroppedVideoFramesEvent)}),e.SONAR_EVENT_LIST=M_.DroppedVideoFramesEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.DroppedVideoFramesEventMonitor=r}));e(nR);nR.DroppedVideoFramesEventMonitor;var rR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){void 0===t&&(t=Date.now());var n=r.call(this,"EventLoopLagMillisEvent",t)||this;return n.eventLoopLagMillis=e,n}return n(e,r),e.prototype.deconstruct=freeOnUnref(function(){var t=this,n={};return e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"eventLoopLagMillis":n[e]=t.eventLoopLagMillis.toString()}})),n}),e.prototype.getType=freeOnUnref(function(){return"eventLoopLagMillisEvent"}),e.DEVICE_METRIC_LIST=["eventLoopLagMillis"],e})(v_.AbstractSonarEvent);t.EventLoopLagMillisEvent=r}));e(rR);rR.EventLoopLagMillisEvent;var iR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleEventLoopLagMillisEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("eventLoopLagMillisEvent",this.handleEventLoopLagMillisEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("eventLoopLagMillisEvent",this.handleEventLoopLagMillisEvent)}),e.SONAR_EVENT_LIST=rR.EventLoopLagMillisEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.EventLoopLagMillisEventMonitor=r}));e(iR);iR.EventLoopLagMillisEventMonitor;var oR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleFragmentAcquisitionEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("fragmentAcquisitionEvent",this.handleFragmentAcquisitionEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("fragmentAcquisitionEvent",this.handleFragmentAcquisitionEvent)}),e.SONAR_EVENT_LIST=E_.FragmentAcquisitionEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.FragmentAcquisitionEventMonitor=r}));e(oR);oR.FragmentAcquisitionEventMonitor;var aR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleFragmentAcquisitionFailureEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("fragmentAcquisitionFailureEvent",this.handleFragmentAcquisitionFailureEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("fragmentAcquisitionFailureEvent",this.handleFragmentAcquisitionFailureEvent)}),e.SONAR_EVENT_LIST=T_.FragmentAcquisitionFailureEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.FragmentAcquisitionFailureEventMonitor=r}));e(aR);aR.FragmentAcquisitionFailureEventMonitor;var sR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){void 0===t&&(t=Date.now());var n=r.call(this,"Memory",t)||this;return n.jsMemoryUsageKB=e,n}return n(e,r),e.prototype.deconstruct=freeOnUnref(function(){var t=this,n={};return e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"jsMemoryUsageKB":n[e]=t.jsMemoryUsageKB.toString()}})),n}),e.prototype.getType=freeOnUnref(function(){return"jsMemoryUsageEvent"}),e.DEVICE_METRIC_LIST=["jsMemoryUsageKB"],e})(v_.AbstractSonarEvent);t.JsMemoryUsageEvent=r}));e(sR);sR.JsMemoryUsageEvent;var lR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleJsMemoryUsageEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("jsMemoryUsageEvent",this.handleJsMemoryUsageEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("jsMemoryUsageEvent",this.handleJsMemoryUsageEvent)}),e.SONAR_EVENT_LIST=sR.JsMemoryUsageEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.JsMemoryUsageEventMonitor=r}));e(lR);lR.JsMemoryUsageEventMonitor;var fR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleManifestAcquisitionEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("manifestAcquisitionEvent",this.handleManifestAcquisitionEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("manifestAcquisitionEvent",this.handleManifestAcquisitionEvent)}),e.SONAR_EVENT_LIST=I_.ManifestAcquisitionEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.ManifestAcquisitionEventMonitor=r}));e(fR);fR.ManifestAcquisitionEventMonitor;var uR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});de.get("ManifestAcquisitionFailureEventMonitor");var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleManifestAcquisitionFailureEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("manifestAcquisitionFailureEvent",this.handleManifestAcquisitionFailureEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("manifestAcquisitionFailureEvent",this.handleManifestAcquisitionFailureEvent)}),e.SONAR_EVENT_LIST=k_.ManifestAcquisitionFailureEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.ManifestAcquisitionFailureEventMonitor=r}));e(uR);uR.ManifestAcquisitionFailureEventMonitor;var cR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){void 0===t&&(t=Date.now());var n=r.call(this,"Memory",t)||this;return n.processMemoryUsageKB=e,n}return n(e,r),e.prototype.deconstruct=freeOnUnref(function(){var t=this,n={};return e.getDeviceMetrics().forEach(freeOnUnref(function(e){switch(e){case"processMemoryUsageKB":n[e]=t.processMemoryUsageKB.toString()}})),n}),e.prototype.getType=freeOnUnref(function(){return"processMemoryUsageEvent"}),e.DEVICE_METRIC_LIST=["processMemoryUsageKB"],e})(v_.AbstractSonarEvent);t.ProcessMemoryUsageEvent=r}));e(cR);cR.ProcessMemoryUsageEvent;var dR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleProcessMemoryUsageEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("processMemoryUsageEvent",this.handleProcessMemoryUsageEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("processMemoryUsageEvent",this.handleProcessMemoryUsageEvent)}),e.SONAR_EVENT_LIST=cR.ProcessMemoryUsageEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.ProcessMemoryUsageEventMonitor=r}));e(dR);dR.ProcessMemoryUsageEventMonitor;var pR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleSyeMetricsEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("syeMetricsEvent",this.handleSyeMetricsEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("syeMetricsEvent",this.handleSyeMetricsEvent)}),e.SONAR_EVENT_LIST=F_.SyeMetricsEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.SyeMetricsEventMonitor=r}));e(pR);pR.SyeMetricsEventMonitor;var hR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleFragmentLoadEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("fragmentLoadEvent",this.handleFragmentLoadEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("fragmentLoadEvent",this.handleFragmentLoadEvent)}),e.SONAR_EVENT_LIST=w_.FragmentLoadEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.FragmentLoadEventMonitor=r}));e(hR);hR.FragmentLoadEventMonitor;var mR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.handleCdnRankEvent=freeOnUnref(function(e){n.sonarContext.eventAggregator.add(e)}),n}return n(e,r),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("sonarCdnRankEvent",this.handleCdnRankEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("sonarCdnRankEvent",this.handleCdnRankEvent)}),e.SONAR_EVENT_LIST=j_.SonarCdnRankEvent.getDeviceMetrics(),e})(Z_.SonarEventMonitorBase);t.SonarCdnRankEventMonitor=r}));e(mR);mR.SonarCdnRankEventMonitor;var yR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("MonitorController");var n=freeOnUnref(function(){function e(e,t,n){this.sonarContext=t,this.sonarEventBus=n,this.sonarController=e,this.availablePassiveEventMonitorList=[$_.BufferFullnessEventMonitor,tR.CpuUsageEventMonitor,fR.ManifestAcquisitionEventMonitor,uR.ManifestAcquisitionFailureEventMonitor,hR.FragmentLoadEventMonitor,pR.SyeMetricsEventMonitor,oR.FragmentAcquisitionEventMonitor,aR.FragmentAcquisitionFailureEventMonitor,lR.JsMemoryUsageEventMonitor,dR.ProcessMemoryUsageEventMonitor,nR.DroppedVideoFramesEventMonitor,iR.EventLoopLagMillisEventMonitor,mR.SonarCdnRankEventMonitor],this.instantiatedPassiveEventMonitorList=[]}return e.prototype.setupPassiveMonitors=freeOnUnref(function(e){for(var t=0,n=this.getPassiveEventMonitors(e);t<n.length;t++){var r=n[t];this.instantiatedPassiveEventMonitorList.push(new r(this.sonarContext,this.sonarEventBus))}}),e.prototype.getPassiveEventMonitors=freeOnUnref(function(e){var t=this.getMetricToPassiveEventMonitorsMap();return this.getPassiveEventMonitorsBasedOnMetrics(e,t)}),e.prototype.getMetricToPassiveEventMonitorsMap=freeOnUnref(function(){for(var e={},t=0,n=this.availablePassiveEventMonitorList;t<n.length;t++)for(var r=n[t],i=0,o=r.getDeviceMetrics();i<o.length;i++){var a=o[i];null==e[a]&&(e[a]=[]),e[a].push(r)}return e}),e.prototype.getPassiveEventMonitorsBasedOnMetrics=freeOnUnref(function(e,t){for(var n=[],r=0,i=e;r<i.length;r++){var o=t[i[r].id];if(null!=o)for(var a=0,s=o;a<s.length;a++){var l=s[a];-1===n.indexOf(l)&&n.push(l)}}return n}),e.prototype.getInstantiatedPassiveEventMonitorList=freeOnUnref(function(){return this.instantiatedPassiveEventMonitorList}),e.prototype.clearInstantiatedPassiveMonitors=freeOnUnref(function(){this.instantiatedPassiveEventMonitorList=[]}),e.prototype.enable=freeOnUnref(function(){for(var e=0,t=this.instantiatedPassiveEventMonitorList;e<t.length;e++){t[e].enable()}}),e.prototype.disable=freeOnUnref(function(){for(var e=0,t=this.instantiatedPassiveEventMonitorList;e<t.length;e++){t[e].disable()}}),e.prototype.process=freeOnUnref(function(e){this.clearInstantiatedPassiveMonitors(),this.setupPassiveMonitors(e.bootstrapResponse.desiredDeviceMetrics);for(var t=0,n=this.instantiatedPassiveEventMonitorList;t<n.length;t++){n[t].process(e)}}),e.prototype.updatePreferences=freeOnUnref(function(e){}),e.prototype.removeInstance=freeOnUnref(function(){for(var e=0,t=this.instantiatedPassiveEventMonitorList;e<t.length;e++){t[e].removeInstance()}this.clearInstantiatedPassiveMonitors()}),e})();t.MonitorController=n}));e(yR);yR.MonitorController;var gR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("SonarEventBus");var n=freeOnUnref(function(){function e(){this.eventEmitter=new A.EventEmitter}return e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.reportEvent=freeOnUnref(function(e){this.eventEmitter.emit(e.getType(),e)}),e})();t.SonarEventBus=n}));e(gR);gR.SonarEventBus;var vR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n,r,i,o,a,s,l,f,u,c,d,p){this.configurationManager=e,this.sessionId=t,this.consumptionId=n,this.bootstrapResponse=r,this.eventAggregator=i,this.player=o,this.deviceTypeId=a,this.deviceId=s,this.titleId=l,this.sonarDeviceInformation=f,this.currentStreamingType=u,this.currentContentType=c,this.sessionStartTime=d,this.playbackUrls=p}return Object.defineProperty(e.prototype,"configuration",{get:freeOnUnref(function(){return this.configurationManager.getConfiguration()}),enumerable:!0,configurable:!0}),e.prototype.unloadContent=freeOnUnref(function(){this.sessionId=null,this.consumptionId=null,this.player="",this.titleId=void 0,this.currentStreamingType=void 0,this.currentContentType=void 0,this.sessionStartTime=void 0,this.playbackUrls=void 0}),e})();t.SonarInternalContext=n}));e(vR);vR.SonarInternalContext;var OR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.getServiceTargetHeaderKey=freeOnUnref(function(){return e.httpRequestInfo.SERVICE_TARGET_HEADER_KEY}),e.getServiceTargetValueAnalyze=freeOnUnref(function(){return e.httpRequestInfo.SERVICE_TARGET_VALUE_ANALYZE}),e.getServiceTargetValueBootstrap=freeOnUnref(function(){return e.httpRequestInfo.SERVICE_TARGET_VALUE_BOOTSTRAP}),e.getServiceTargetValueFeedback=freeOnUnref(function(){return e.httpRequestInfo.SERVICE_TARGET_VALUE_FEEDBACK}),e.getContentEncodingHeaderKey=freeOnUnref(function(){return e.httpRequestInfo.CONTENT_ENCODING_HEADER_KEY}),e.getContentEncodingValue=freeOnUnref(function(){return e.httpRequestInfo.CONTENT_ENCODING_VALUE}),e.getContentTypeHeaderKey=freeOnUnref(function(){return e.httpRequestInfo.CONTENT_TYPE_HEADER_KEY}),e.getContentTypeValue=freeOnUnref(function(){return e.httpRequestInfo.CONTENT_TYPE_VALUE}),e.getSonarActionServiceEndpointUrl=freeOnUnref(function(){return e.httpRequestInfo.SONAR_ACTION_SERVICE_ENDPOINT_URL}),e.getSdkVersion=freeOnUnref(function(){return e.httpRequestInfo.SDK_VERSION}),e.httpRequestInfo={SERVICE_TARGET_HEADER_KEY:"X-Amz-Target",SERVICE_TARGET_VALUE_ANALYZE:"PVSonarActionService.Analyze",SERVICE_TARGET_VALUE_BOOTSTRAP:"PVSonarActionService.Bootstrap",SERVICE_TARGET_VALUE_FEEDBACK:"PVSonarActionService.Feedback",CONTENT_ENCODING_HEADER_KEY:"Content-Encoding",CONTENT_ENCODING_VALUE:"amz-1.0",CONTENT_TYPE_HEADER_KEY:"Content-Type",CONTENT_TYPE_VALUE:"application/json; charset=UTF-8",SONAR_ACTION_SERVICE_ENDPOINT_URL:"https://prod.us-east-1.sonar.prime-video.amazon.dev",SDK_VERSION:"1.5"},e})();t.HttpRequestUtil=n}));e(OR);OR.HttpRequestUtil;var SR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("BootstrapController"),r=freeOnUnref(function(){function e(e){this.sonarContext=e}return e.prototype.process=freeOnUnref(function(){var r=this,e=new lt.Promise(freeOnUnref(function(t,n){pn.HttpRequestBuilder.post(OR.HttpRequestUtil.getSonarActionServiceEndpointUrl()).json(r.createRequestBody()).header(OR.HttpRequestUtil.getServiceTargetHeaderKey(),OR.HttpRequestUtil.getServiceTargetValueBootstrap()).header(OR.HttpRequestUtil.getContentEncodingHeaderKey(),OR.HttpRequestUtil.getContentEncodingValue()).header(OR.HttpRequestUtil.getContentTypeHeaderKey(),OR.HttpRequestUtil.getContentTypeValue()).responseType("text").build().onLoad(freeOnUnref(function(e){r.sonarContext.bootstrapResponse=JSON.parse(e.getText()),t(e)})).onError(freeOnUnref(function(e){n(e)})).send()}));return e.catch(freeOnUnref(function(e){n.error("Sonar: Error send bootstrap request "+e)})),e}),e.prototype.createRequestBody=freeOnUnref(function(){var e={sdkVersion:OR.HttpRequestUtil.getSdkVersion(),deviceTypeId:this.sonarContext.deviceTypeId,playerType:this.sonarContext.player,titleId:this.sonarContext.titleId,streamingType:this.sonarContext.currentStreamingType,contentType:this.sonarContext.currentContentType,deviceId:this.sonarContext.deviceId};return null!=this.sonarContext.sonarDeviceInformation.browserName&&(e.browserName=this.sonarContext.sonarDeviceInformation.browserName),null!=this.sonarContext.sonarDeviceInformation.browserVersion&&(e.browserVersion=this.sonarContext.sonarDeviceInformation.browserVersion),null!=this.sonarContext.sonarDeviceInformation.modelName&&(e.modelName=this.sonarContext.sonarDeviceInformation.modelName),null!=this.sonarContext.sonarDeviceInformation.modelVersion&&(e.modelVersion=this.sonarContext.sonarDeviceInformation.modelVersion),e}),e})();t.BootstrapController=r}));e(SR);SR.BootstrapController;var UR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(e,t,n,r,i,o,a){this.sdkVersion=e,this.experimentCohort=t,this.triggerType=n,this.triggerTimestamp=r,this.consumptionId=i,this.instructionSetId=o,this.notification=a}})();t.SonarNotificationActiveMonitor=n}));e(UR);UR.SonarNotificationActiveMonitor;var bR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(e,t,n,r,i,o,a){this.sdkVersion=e,this.experimentCohort=t,this.triggerType=n,this.triggerTimestamp=r,this.consumptionId=i,this.instructionSetId=o,this.notification=a}})();t.SonarNotificationMitigation=n}));e(bR);bR.SonarNotificationMitigation;var PR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var h="EXPERIMENT_COHORT_NOT_FOUND",m="CONSUMPTION_ID_NOT_FOUND",n=freeOnUnref(function(){function e(e,t){this.sonarContext=e,this.sonarEventBus=t}return e.prototype.processActiveMonitorEvents=freeOnUnref(function(e){for(var t=e.triggerReports,n=e.sdkVersion,r=0,i=t;r<i.length;r++)for(var o=i[r],a=this.toUpperCaseTriggerType(o.id),s=o.startTimeUTC,l=0,f=o.actionGroupReports;l<f.length;l++)for(var u=0,c=f[l].actionReports;u<c.length;u++){var d=c[u];null!=d.http&&this.handleHttpActiveMonitorEvent(d.http,a,s,n)}}),e.prototype.handleHttpActiveMonitorEvent=freeOnUnref(function(e,t,n,r){var i=e.id,o=null,a=null,s=null;if(null!=e.httpResult.response){var l=e.httpResult.response;o=200<=l.responseCode&&l.responseCode<=299,void 0!==l.metrics.startTimestampMs&&(a=l.metrics.startTimestampMs),void 0!==l.metrics.endTimestampMs&&(s=l.metrics.endTimestampMs)}var f={_type:"ActiveMonitor",monitorType:"HTTP",monitorName:i,success:o,startTimestamp:a,endTimestamp:s};this.postSonarNotificationActiveMonitorEvent(t,n,r,f)}),e.prototype.postSonarNotificationActiveMonitorEvent=freeOnUnref(function(e,t,n,r){var i=this.sonarContext.bootstrapResponse.instructionSetId,o=h;null!=this.sonarContext.bootstrapResponse.experimentCohort&&(o=this.sonarContext.bootstrapResponse.experimentCohort);var a=m;null!=this.sonarContext.consumptionId&&(a=this.sonarContext.consumptionId);var s=new UR.SonarNotificationActiveMonitor(n,o,e,t,a,i,r),l=new x_.SonarNotificationReportEvent(s);this.sonarEventBus.reportEvent(l)}),e.prototype.processMitigationEvent=freeOnUnref(function(e,t){for(var n=this.createMitigationBase(e,t),r=0,i=e.triggerReports;r<i.length;r++){var o=i[r],a=e.sdkVersion,s=this.toUpperCaseTriggerType(o.id),l=o.startTimeUTC,f=e.instructionSetId,u=h;null!=t.experimentCohort&&(u=t.experimentCohort);var c=m;null!=this.sonarContext.consumptionId&&(c=this.sonarContext.consumptionId);var d=new bR.SonarNotificationMitigation(a,u,s,l,c,f,n),p=new x_.SonarNotificationReportEvent(d);this.sonarEventBus.reportEvent(p);break}}),e.prototype.createMitigationBase=freeOnUnref(function(e,t){var n=null,r=null,i=null,o=null,a=null,s=null,l=this.createUxDetails(t);if(null!=t.resultType&&(i=t.resultType),null!=t.resultCategory&&(o=t.resultCategory),null!=e.reportId&&(a=e.reportId),null!=t.rootCauseDAG&&(s=t.rootCauseDAG),null!=t.mitigationActions)for(var f=0,u=t.mitigationActions;f<u.length;f++){var c=u[f];null!=c.mitigationType&&(n=c.mitigationType),null!=c.mitigationActionType&&(r=c.mitigationActionType);break}return{_type:"Mitigation",mitigationType:n,mitigationCategory:r,resultType:i,resultCategory:o,success:!0,reportId:a,rootCauseDAG:s,uxDetails:l}}),e.prototype.createUxDetails=freeOnUnref(function(e){var t=null,n=null,r=null;return null!=e.observation&&null!=e.observation.errorCode&&(t=!0,n=parseInt(e.observation.errorCode)),null!=t&&(r={isObservation:t,isFeedbackSubmitted:!1,errorCode:n}),r}),e.prototype.toUpperCaseTriggerType=freeOnUnref(function(e){return 0<e.length?e.charAt(0).toUpperCase()+e.slice(1):"DefaultTriggerId"}),e})();t.SonarNotificationMediaEventGenerator=n}));e(PR);PR.SonarNotificationMediaEventGenerator;var MR=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(){function t(){}return t.getObservationEnabled=freeOnUnref(function(){return t.isAnalyzeResponseWithObservationEnabled}),t.getCdnSwitchEnabled=freeOnUnref(function(){return t.isAnalyzeResponseWithSwitchCdnEnabled}),t.getMockedAnalyzeResponse=freeOnUnref(function(){var e={currentTimeUTC:1698089138579,mitigationActions:[{mitigationActionType:"NoOp",mitigationDetails:"No mitigation available.",mitigationTimeUTC:1698018981445,mitigationType:"NoMitigation"}],resultCategory:"Inconclusive",resultType:"NotEnoughMetricDataResult",rootCauseDAG:"xpUnexpectedRebufferDAG"};return t.getObservationEnabled()&&(e=n({},e,{observation:{errorCode:"3901"}})),t.getCdnSwitchEnabled()&&(e.mitigationActions[0]={mitigationActionType:"UpdatedCDNInfo",mitigationDetails:"Filler text",mitigationTimeUTC:1698018981445,mitigationType:"Filler text"}),e}),t.shouldUseMockAnalyzeResponse=!1,t.isAnalyzeResponseWithObservationEnabled=!1,t.isAnalyzeResponseWithSwitchCdnEnabled=!1,t})();t.TestingOverrideUtil=r}));e(MR);MR.TestingOverrideUtil;var CR=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.SwitchCDN="SwitchCDN"})(n||(n={})),t.SonarMitigationType=n}));e(CR);CR.SonarMitigationType;var ER=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("SonarReporter"),n=freeOnUnref(function(){function e(e,t,n,r){this.sonarContext=e,this.sonarEventBus=t,this.sonarPlayerBus=n,this.sonarNotificationMediaEventGenerator=new PR.SonarNotificationMediaEventGenerator(e,t),this.sonarController=r}return e.prototype.process=freeOnUnref(function(r){var i=this;o.enabledFor(de.DEBUG)&&o.info("Submitting sonar report as "+JSON.stringify(r,null,2));var e=new lt.Promise(freeOnUnref(function(n,t){pn.HttpRequestBuilder.post(OR.HttpRequestUtil.getSonarActionServiceEndpointUrl()).json(r).header(OR.HttpRequestUtil.getServiceTargetHeaderKey(),OR.HttpRequestUtil.getServiceTargetValueAnalyze()).header(OR.HttpRequestUtil.getContentEncodingHeaderKey(),OR.HttpRequestUtil.getContentEncodingValue()).header(OR.HttpRequestUtil.getContentTypeHeaderKey(),OR.HttpRequestUtil.getContentTypeValue()).responseType("text").build().onLoad(freeOnUnref(function(e){var t=JSON.parse(e.getText());MR.TestingOverrideUtil.shouldUseMockAnalyzeResponse&&(t=MR.TestingOverrideUtil.getMockedAnalyzeResponse()),o.enabledFor(de.DEBUG)&&o.info("Received analyze response for sonar report "+JSON.stringify(t,null,2)),i.handleUxObservation(t,i.shouldControlShowingObservations(r.triggerReports,i.sonarContext.bootstrapResponse.sonarObservationControllerConfig)),i.handleMitigation(t),i.generateSonarNotificationMediaEvent(r,t),n(t)})).onError(freeOnUnref(function(e){t(e)})).send()}));return e.catch(freeOnUnref(function(e){o.info("Sonar: Error, "+e+", sending analyze request, "+r)})),e}),e.prototype.handleMitigation=freeOnUnref(function(e){if(null!=e.mitigationActions)for(var t=0,n=e.mitigationActions;t<n.length;t++){var r=n[t];switch(r.mitigationActionType){case"UxNotification":break;case"UpdatedCDNInfo":this.handleSwitchCDNMitigation(r)}}}),e.prototype.handleSwitchCDNMitigation=freeOnUnref(function(e){null!=e.mitigationDetails&&""!==e.mitigationDetails?this.sonarController.sendMitigation(new V_.SonarSwitchCdnEvent(CR.SonarMitigationType.SwitchCDN,e.mitigationDetails)):this.sonarController.sendMitigation(new V_.SonarSwitchCdnEvent(CR.SonarMitigationType.SwitchCDN))}),e.prototype.handleUxObservation=freeOnUnref(function(e,t){var n=null;null!=e.observation&&null!=e.observation.errorCode&&(n=e.observation.errorCode),null!=n&&(t?this.sonarEventBus.reportEvent(new N_.UxNotificationEvent("passive",n)):this.sonarPlayerBus.emit("uxNotificationEvent",new N_.UxNotificationEvent("passive",n)))}),e.prototype.generateSonarNotificationMediaEvent=freeOnUnref(function(e,t){this.sonarNotificationMediaEventGenerator.processActiveMonitorEvents(e),this.sonarNotificationMediaEventGenerator.processMitigationEvent(e,t)}),e.prototype.shouldControlShowingObservations=freeOnUnref(function(e,t){if(null==t||null==t.playbackQualityTriggerIds)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n].id;if(-1!==t.playbackQualityTriggerIds.indexOf(i))return!0}return!1}),e})();t.SonarReporter=n}));e(ER);ER.SonarReporter;var TR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(e,t,n){var r=i.call(this,t,n)||this;return r.handlePlaybackStartedEvent=freeOnUnref(function(e){r.sonarContext.eventAggregator.add(e),r.sonarController.handlePlaybackStarted(e)}),r.sonarController=e,r}return n(e,i),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("playbackStartedEvent",this.handlePlaybackStartedEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("playbackStartedEvent",this.handlePlaybackStartedEvent)}),e})(Z_.SonarEventMonitorBase);t.PlaybackStartedEventMonitor=r}));e(TR);TR.PlaybackStartedEventMonitor;var wR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("TriggerReportGenerator"),n=freeOnUnref(function(){function o(){}return o.createTriggerReportList=freeOnUnref(function(e,t,n){for(var r=[],i=XR.EvaluatorController.triggerConditionProcessorMap,o=0,a=t.bootstrapResponse.triggers;o<a.length;o++){var s=a[o];if(this.evaluateTriggerConditions(e,s,t,i)){var l=this.createTriggerReport(s,t,n).then(freeOnUnref(function(e){return e})).catch(freeOnUnref(function(e){return f.error("Unable to create trigger report:\n"+e),null}));r.push(l)}}return lt.Promise.all(r).then(freeOnUnref(function(e){var t=[];return e.forEach(freeOnUnref(function(e){null!=e&&t.push(e)})),t}))}),o.evaluateTriggerConditions=freeOnUnref(function(e,t,n,r){var i=n.bootstrapResponse.triggerConditionsV2;if(null==i)return!1;for(var o=0,a=t.on;o<a.length;o++){var s=a[o];if(null!=r[s])if(r[s].process(e,i))return!0}return!1}),o.createTriggerReport=freeOnUnref(function(t,e,n){var r=Date.now(),i=e.eventAggregator.getMetricHistory();return lt.Promise.resolve(o.executeActions(t,n).then(freeOnUnref(function(e){return{id:t.id,startTimeUTC:r,endTimeUTC:Date.now(),actionGroupReports:e,metricHistories:i}})))}),o.executeActions=freeOnUnref(function(e,r){var i=[];if(null==e.actionGroupIds)return lt.Promise.all(i);for(var t=freeOnUnref(function(t){var e=XR.EvaluatorController.actionGroupIdToActionsMap[t];if(null!=e){var n=r.processAction(e).then(freeOnUnref(function(e){return{id:t,actionReports:e}}));i.push(n)}}),n=0,o=e.actionGroupIds;n<o.length;n++){t(o[n])}return lt.Promise.all(i)}),o})();t.TriggerReportGenerator=n}));e(wR);wR.TriggerReportGenerator;var IR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.createAnalyzeRequest=freeOnUnref(function(e,t){var n={sdkVersion:OR.HttpRequestUtil.getSdkVersion(),deviceTypeId:t.deviceTypeId,sessionId:"",deviceId:t.deviceId,playerType:t.player,instructionSetId:t.bootstrapResponse.instructionSetId,currentTimeUTC:Date.now(),triggerReports:e,streamingType:t.currentStreamingType,contentType:t.currentContentType};return n.reportId=Vy.UUID.v4(),n.appVersionName="",n.playerType="XP",null!=t.sessionId&&(n.sessionId=t.sessionId),n.consumptionId="",null!=t.consumptionId&&(n.consumptionId=t.consumptionId),n.titleId="",null!=t.titleId&&(n.titleId=t.titleId),null!=t.sonarDeviceInformation.browserName&&(n.browserName=t.sonarDeviceInformation.browserName),null!=t.sonarDeviceInformation.browserVersion&&(n.browserVersion=t.sonarDeviceInformation.browserVersion),null!=t.sonarDeviceInformation.modelName&&(n.modelName=t.sonarDeviceInformation.modelName),null!=t.sonarDeviceInformation.modelVersion&&(n.modelVersion=t.sonarDeviceInformation.modelVersion),null!=t.sessionStartTime&&(n.sessionStartTime=t.sessionStartTime),n}),e})();t.AnalyzeRequestBuilder=n}));e(IR);IR.AnalyzeRequestBuilder;var kR=t(freeOnUnref(function(e,t){var a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("AbstractSonarEventEvaluator"),n=freeOnUnref(function(){function e(){}return e.prototype.handleEvent=freeOnUnref(function(n,r){var i,o=this;if(this.isEnabled)return lt.Promise.resolve(wR.TriggerReportGenerator.createTriggerReportList(n,r,this.actionsProcessor).then(freeOnUnref(function(e){if(null!=(i=e)&&0!==i.length){i=i.map(freeOnUnref(function(e){return a({},e,{triggerEventContext:o.getTriggerEventContext(n)})}));var t=IR.AnalyzeRequestBuilder.createAnalyzeRequest(i,r);o.sonarReporter.process(t)}})).catch(freeOnUnref(function(e){return s.error("Unable to create trigger report list:\n"+e),null})))}),e.prototype.getTriggerEventContext=freeOnUnref(function(e){}),e.prototype.process=freeOnUnref(function(e){}),e.prototype.enable=freeOnUnref(function(){this.isEnabled=!0}),e.prototype.disable=freeOnUnref(function(){this.isEnabled=!1}),e.prototype.updatePreferences=freeOnUnref(function(e){}),e.prototype.removeInstance=freeOnUnref(function(){}),e})();t.AbstractSonarEventEvaluator=n}));e(kR);kR.AbstractSonarEventEvaluator;var _R=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(o){function e(e,t,n,r){var i=o.call(this)||this;return i.isEnabled=!1,i.receiveEvent=freeOnUnref(function(e){null!=i.sonarContext&&i.isEnabled&&o.prototype.handleEvent.call(i,e,i.sonarContext)}),i.sonarContext=e,i.sonarEventBus=t,i.sonarReporter=n,i.actionsProcessor=r,i}return n(e,o),e.prototype.enable=freeOnUnref(function(){this.sonarEventBus.on("fragmentAcquisitionEvent",this.receiveEvent),this.sonarEventBus.on("syeMetricsEvent",this.receiveEvent),this.isEnabled=!0}),e.prototype.disable=freeOnUnref(function(){this.sonarEventBus.off("fragmentAcquisitionEvent",this.receiveEvent),this.sonarEventBus.off("syeMetricsEvent",this.receiveEvent),this.isEnabled=!1}),e})(kR.AbstractSonarEventEvaluator);t.FragmentAcquisitionEventEvaluator=r}));e(_R);_R.FragmentAcquisitionEventEvaluator;var RR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});de.get("NetworkOutageEventEvaluator");var r=freeOnUnref(function(o){function e(e,t,n,r){var i=o.call(this)||this;return i.isEnabled=!1,i.receiveEvent=freeOnUnref(function(e){null!=i.sonarContext&&i.isEnabled&&o.prototype.handleEvent.call(i,e,i.sonarContext)}),i.sonarContext=e,i.sonarEventBus=t,i.sonarReporter=n,i.actionsProcessor=r,i}return n(e,o),e.prototype.enable=freeOnUnref(function(){this.sonarEventBus.on("networkOutageEvent",this.receiveEvent),this.isEnabled=!0}),e.prototype.disable=freeOnUnref(function(){this.sonarEventBus.off("networkOutageEvent",this.receiveEvent),this.isEnabled=!1}),e})(kR.AbstractSonarEventEvaluator);t.NetworkOutageEventEvaluator=r}));e(RR);RR.NetworkOutageEventEvaluator;var AR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});de.get("ProxyEventEvaluator");var r=freeOnUnref(function(o){function e(e,t,n,r){var i=o.call(this)||this;return i.isEnabled=!1,i.receiveEvent=freeOnUnref(function(e){null!=i.sonarContext&&i.isEnabled&&o.prototype.handleEvent.call(i,e,i.sonarContext)}),i.sonarContext=e,i.sonarEventBus=t,i.sonarReporter=n,i.actionsProcessor=r,i}return n(e,o),e.prototype.enable=freeOnUnref(function(){this.sonarEventBus.on("proxyEvent",this.receiveEvent),this.isEnabled=!0}),e.prototype.disable=freeOnUnref(function(){this.sonarEventBus.off("proxyEvent",this.receiveEvent),this.isEnabled=!1}),e})(kR.AbstractSonarEventEvaluator);t.ProxyEventEvaluator=r}));e(AR);AR.ProxyEventEvaluator;var DR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});de.get("UnexpectedRebufferEventEvaluator");var r=freeOnUnref(function(o){function e(e,t,n,r){var i=o.call(this)||this;return i.isEnabled=!1,i.receiveEvent=freeOnUnref(function(e){null!=i.sonarContext&&i.isEnabled&&o.prototype.handleEvent.call(i,e,i.sonarContext)}),i.sonarContext=e,i.sonarEventBus=t,i.sonarReporter=n,i.actionsProcessor=r,i}return n(e,o),e.prototype.enable=freeOnUnref(function(){this.sonarEventBus.on("unexpectedRebufferEvent",this.receiveEvent),this.sonarEventBus.on("syeAISUnexpectedRebufferEvent",this.receiveEvent),this.sonarEventBus.on("syeStallUnexpectedRebufferEvent",this.receiveEvent),this.sonarEventBus.on("syeErrorUnexpectedRebufferEvent",this.receiveEvent),this.isEnabled=!0}),e.prototype.disable=freeOnUnref(function(){this.sonarEventBus.off("unexpectedRebufferEvent",this.receiveEvent),this.sonarEventBus.off("syeAISUnexpectedRebufferEvent",this.receiveEvent),this.sonarEventBus.off("syeStallUnexpectedRebufferEvent",this.receiveEvent),this.sonarEventBus.off("syeErrorUnexpectedRebufferEvent",this.receiveEvent),this.isEnabled=!1}),e})(kR.AbstractSonarEventEvaluator);t.UnexpectedRebufferEventEvaluator=r}));e(DR);DR.UnexpectedRebufferEventEvaluator;var xR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function r(){this.lastTriggerTimeMillis=0}return r.prototype.isOutsideCoolOffPeriod=freeOnUnref(function(e,t){var n=t*r.SECONDS_TO_MILLIS;return e-this.lastTriggerTimeMillis>n}),r.prototype.isPastStartTimeDelay=freeOnUnref(function(e,t,n){return n*r.SECONDS_TO_MILLIS+t<e}),r.SECONDS_TO_MILLIS=1e3,r})();t.AbstractTriggerConditionProcessor=n}));e(xR);xR.AbstractTriggerConditionProcessor;var FR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.timeWindowMillis=e,this.samples=[],this.rollingSum=0,this.hasRemovedValueFromComputedStatistic=!1}return e.prototype.addSample=freeOnUnref(function(e,t){if(0<this.samples.length){if(t<=this.samples[this.samples.length-1][0])return!1;for(var n=this.samples[0][0],r=this.samples[0][1];0<this.samples.length&&this.isOutsideTimeWindow(n,t);)this.hasRemovedValueFromComputedStatistic=!0,this.samples.shift(),this.rollingSum=this.removeValueFromRollingSum(r,this.rollingSum),0<this.samples.length&&(n=this.samples[0][0],r=this.samples[0][1])}return this.samples.push([t,e]),this.rollingSum=this.addValueToRollingSum(e,this.rollingSum),!0}),e.prototype.isOutsideTimeWindow=freeOnUnref(function(e,t){return e<t-this.timeWindowMillis}),e.prototype.getRollingSum=freeOnUnref(function(){return this.rollingSum}),e.prototype.getRollingAverage=freeOnUnref(function(){return this.samples.length<1?0:this.rollingSum/this.samples.length}),e.prototype.clear=freeOnUnref(function(){this.samples=[],this.rollingSum=0,this.hasRemovedValueFromComputedStatistic=!1}),e.prototype.hasSufficientSamplesToFillTimeWindow=freeOnUnref(function(){return this.hasRemovedValueFromComputedStatistic}),e})();t.EventStatisticsAggregator=n}));e(FR);FR.EventStatisticsAggregator;var BR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.removeValueFromRollingSum=freeOnUnref(function(e,t){return t-e}),t.prototype.addValueToRollingSum=freeOnUnref(function(e,t){return t+e}),t})(FR.EventStatisticsAggregator);t.TimeWindowSumAggregator=r}));e(BR);BR.TimeWindowSumAggregator;var LR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id="lowQualityPlaybackWithTimeWindow",e}return n(e,t),e.prototype.process=freeOnUnref(function(e,t){if(null==t.lowQualityPlaybackWithTimeWindow)return!1;var n=-1;if(e instanceof E_.FragmentAcquisitionEvent&&"Video"===e.assetType)n=e.bitrateInBitsPerSecond;else{if(!(e instanceof F_.SyeMetricsEvent))return!1;n=e.videoBitrateInBitsPerSecond}if(null==this.timeWindowSumAggregator){var r=this.calculateTimeWindowMillis(t.lowQualityPlaybackWithTimeWindow);this.timeWindowSumAggregator=new BR.TimeWindowSumAggregator(r)}this.timeWindowSumAggregator.addSample(n,e.timestampInMilliseconds);var i=Date.now(),o=this.timeWindowSumAggregator.getRollingAverage();return!(!this.isOutsideCoolOffPeriod(i,t.lowQualityPlaybackWithTimeWindow.cooldownPeriodSeconds)||!this.isLowQualityPlaybackWithTimeWindowConditionMet(o,t.lowQualityPlaybackWithTimeWindow.thresholdBitsPerSecond,this.timeWindowSumAggregator.hasSufficientSamplesToFillTimeWindow()))&&(this.lastTriggerTimeMillis=i,!0)}),e.prototype.calculateTimeWindowMillis=freeOnUnref(function(e){return 1e3*e.lowQualityTimeWindowSeconds}),e.prototype.isLowQualityPlaybackWithTimeWindowConditionMet=freeOnUnref(function(e,t,n){return e<=t&&n}),e})(xR.AbstractTriggerConditionProcessor);t.LowQualityPlaybackWithTimeWindowProcessor=r}));e(LR);LR.LowQualityPlaybackWithTimeWindowProcessor;var NR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.size=e,this.sampleCount=0,this.rollingCounter=0,this.total=0,this.average=0,this.samples=new Float32Array(e)}return e.prototype.getSampleCount=freeOnUnref(function(){return this.sampleCount}),e.prototype.getAverage=freeOnUnref(function(){return this.average}),e.prototype.addSample=freeOnUnref(function(e){var t=this.samples[this.rollingCounter];this.samples[this.rollingCounter]=e,this.rollingCounter++,this.rollingCounter>=this.size&&(this.rollingCounter=0),this.sampleCount<this.size&&this.sampleCount++,this.average=this.calculateAverage(t,e)}),e.prototype.getStandardDeviation=freeOnUnref(function(){if(this.sampleCount<=0)return 0;for(var e=this.total/this.sampleCount,t=0,n=0;n<this.sampleCount;n++){var r=this.samples[n];t+=Math.pow(r-e,2)}return Math.sqrt(t/this.sampleCount)}),e.prototype.calculateAverage=freeOnUnref(function(e,t){return this.total+=t-e,this.total/this.sampleCount}),e})();t.FloatRollingStatisticsAggregator=n}));e(NR);NR.FloatRollingStatisticsAggregator;var VR=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});de.get("SonarLowQualityPlaybackConditionProcessor");var n=freeOnUnref(function(n){function e(e){var t=n.call(this)||this;return t.id="lowQualityPlayback",t.sonarContext=e,t}return r(e,n),e.prototype.process=freeOnUnref(function(e,t){if(null==t.lowQualityPlayback)return!1;var n=-1;if(e instanceof E_.FragmentAcquisitionEvent&&"Video"===e.assetType)n=e.bitrateInBitsPerSecond;else{if(!(e instanceof F_.SyeMetricsEvent))return!1;n=e.videoBitrateInBitsPerSecond}if(null!=t&&null!=t.lowQualityPlayback&&(null==this.rollingStatisticsAggregator&&null!=t.lowQualityPlayback&&(this.rollingStatisticsAggregator=new NR.FloatRollingStatisticsAggregator(t.lowQualityPlayback.minMetricHistoryCount)),null!=this.rollingStatisticsAggregator)){this.rollingStatisticsAggregator.addSample(n);var r=Date.now();if(null!=this.sonarContext.sessionStartTime&&null!=t.lowQualityPlayback.sessionStartToTriggerDelaySeconds&&this.isPastStartTimeDelay(r,this.sonarContext.sessionStartTime,t.lowQualityPlayback.sessionStartToTriggerDelaySeconds)&&this.isOutsideCoolOffPeriod(r,t.lowQualityPlayback.cooldownPeriodSeconds)&&this.rollingStatisticsAggregator.getSampleCount()>=t.lowQualityPlayback.minMetricHistoryCount&&this.rollingStatisticsAggregator.getAverage()<=t.lowQualityPlayback.thresholdValue)return this.lastTriggerTimeMillis=r,!0}return!1}),e})(xR.AbstractTriggerConditionProcessor);t.LowQualityPlaybackConditionProcessor=n}));e(VR);VR.LowQualityPlaybackConditionProcessor;var jR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id="networkOutage",e.networkOutageSonarEventType="Network",e}return n(e,t),e.prototype.process=freeOnUnref(function(e,t){if(null==t.networkOutage)return!1;var n=t.networkOutage.id;return this.networkOutageSonarEventType===e.eventType&&this.id===n}),e})(xR.AbstractTriggerConditionProcessor);t.NetworkOutageConditionProcessor=r}));e(jR);jR.NetworkOutageConditionProcessor;var qR=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});de.get("ProactiveReportConditionProcessor");var n=freeOnUnref(function(n){function e(e){var t=n.call(this)||this;return t.id="proactiveReport",t.proactiveReportEventType="ProxyEvent",t.sonarContext=e,t}return r(e,n),e.prototype.process=freeOnUnref(function(e,t){if(!this.sonarContext.configuration.isSonarProactiveReportTriggerEnabled)return!1;if(this.proactiveReportEventType!==e.eventType)return!1;var n=t.proactiveReport;if(null!=n){var r=n.probabilityFactor,i=Date.now(),o=n.cooldownPeriodSeconds;if(this.isProbabilityConditionMet(r)&&this.isOutsideCoolOffPeriod(i,o))return this.lastTriggerTimeMillis=Date.now(),!0}return!1}),e.prototype.isProbabilityConditionMet=freeOnUnref(function(e){return this.getRandom()<=e}),e.prototype.getRandom=freeOnUnref(function(){return Math.floor(100*Math.random())+1}),e})(xR.AbstractTriggerConditionProcessor);t.ProactiveReportConditionProcessor=n}));e(qR);qR.ProactiveReportConditionProcessor;var HR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id="syeAISRebuffer",e.unexpectedRebufferSonarEventType="SyeAISRebuffer",e}return n(e,t),e.prototype.process=freeOnUnref(function(e,t){if(null===t.syeAISRebuffer||void 0===t.syeAISRebuffer)return!1;var n=t.syeAISRebuffer.id;return this.unexpectedRebufferSonarEventType===e.eventType&&this.id===n}),e})(xR.AbstractTriggerConditionProcessor);t.SyeAISUnexpectedRebufferConditionProcessor=r}));e(HR);HR.SyeAISUnexpectedRebufferConditionProcessor;var zR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id="syeErrorRebuffer",e.unexpectedRebufferSonarEventType="SyeErrorRebuffer",e}return n(e,t),e.prototype.process=freeOnUnref(function(e,t){if(null===t.syeErrorRebuffer||void 0===t.syeErrorRebuffer)return!1;var n=t.syeErrorRebuffer.id;return this.unexpectedRebufferSonarEventType===e.eventType&&this.id===n}),e})(xR.AbstractTriggerConditionProcessor);t.SyeErrorUnexpectedRebufferConditionProcessor=r}));e(zR);zR.SyeErrorUnexpectedRebufferConditionProcessor;var WR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id="syeStallRebuffer",e.unexpectedRebufferSonarEventType="SyeStallRebuffer",e}return n(e,t),e.prototype.process=freeOnUnref(function(e,t){if(null===t.syeStallRebuffer||void 0===t.syeStallRebuffer)return!1;var n=t.syeStallRebuffer.id;return this.unexpectedRebufferSonarEventType===e.eventType&&this.id===n}),e})(xR.AbstractTriggerConditionProcessor);t.SyeStallUnexpectedRebufferConditionProcessor=r}));e(WR);WR.SyeStallUnexpectedRebufferConditionProcessor;var KR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id="unexpectedBufferExhaustion",e.unexpectedRebufferSonarEventType="Rebuffer",e}return n(e,t),e.prototype.process=freeOnUnref(function(e,t){if(null===t.unexpectedBufferExhaustion||void 0===t.unexpectedBufferExhaustion)return!1;var n=t.unexpectedBufferExhaustion.id;return this.unexpectedRebufferSonarEventType===e.eventType&&this.id===n}),e})(xR.AbstractTriggerConditionProcessor);t.UnexpectedRebufferConditionProcessor=r}));e(KR);KR.UnexpectedRebufferConditionProcessor;var GR=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this)||this;return t.context=e,t.id="playbackRestart",t.PlaybackRestartSonarEventType="PlaybackRestart",t}return r(e,n),e.prototype.process=freeOnUnref(function(e,t){if(!this.context.configuration.isSonarPlaybackRestartTriggerEnabled||null==t.playbackRestart)return!1;var n=t.playbackRestart.id;return this.PlaybackRestartSonarEventType===e.eventType&&this.id===n}),e})(xR.AbstractTriggerConditionProcessor);t.PlaybackRestartConditionProcessor=n}));e(GR);GR.PlaybackRestartConditionProcessor;var QR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(o){function e(e,t,n,r){var i=o.call(this)||this;return i.sonarContext=e,i.sonarEventBus=t,i.sonarReporter=n,i.actionsProcessor=r,i.isEnabled=!1,i.receiveEvent=freeOnUnref(function(e){null!=i.sonarContext&&i.sonarContext.configuration.isSonarPlaybackRestartTriggerEnabled&&i.isEnabled&&i.handleEvent(e,i.sonarContext)}),i}return n(e,o),e.prototype.getTriggerEventContext=freeOnUnref(function(e){if(e instanceof __.PlaybackRestartEvent)return{triggerEventStartTimeUTC:e.timestampInMilliseconds,triggerEventEndTimeUTC:e.timestampInMilliseconds,triggerEventReason:H_.getTriggerReason(e.reason),triggerEventSubReason:e.subReason}}),e.prototype.enable=freeOnUnref(function(){this.isEnabled=!0,this.sonarEventBus.on("playbackRestartEvent",this.receiveEvent)}),e.prototype.disable=freeOnUnref(function(){this.isEnabled=!1,this.sonarEventBus.off("playbackRestartEvent",this.receiveEvent)}),e})(kR.AbstractSonarEventEvaluator);t.PlaybackRestartEventEvaluator=r}));e(QR);QR.PlaybackRestartEventEvaluator;var XR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function u(e,t,n,r){this.evaluatorList=[],this.sonarContext=e,this.evaluatorList.push(new DR.UnexpectedRebufferEventEvaluator(e,t,n,r),new RR.NetworkOutageEventEvaluator(e,t,n,r),new AR.ProxyEventEvaluator(e,t,n,r),new _R.FragmentAcquisitionEventEvaluator(e,t,n,r),new QR.PlaybackRestartEventEvaluator(e,t,n,r))}return u.prototype.enable=freeOnUnref(function(){for(var e=0,t=this.evaluatorList;e<t.length;e++){t[e].enable()}}),u.prototype.disable=freeOnUnref(function(){for(var e=0,t=this.evaluatorList;e<t.length;e++){t[e].disable()}}),u.prototype.process=freeOnUnref(function(e){for(var t=0,n=this.evaluatorList;t<n.length;t++){n[t].process(e)}this.populateActionGroups(this.sonarContext),this.populateTriggerConditionProcessorMap(this.sonarContext)}),u.prototype.populateActionGroups=freeOnUnref(function(e){if(null!=e.bootstrapResponse&&null!=e.bootstrapResponse.actionGroups)for(var t=0,n=e.bootstrapResponse.actionGroups;t<n.length;t++){var r=n[t];null!=r.id&&(u.actionGroupIdToActionsMap[r.id]=r)}}),u.prototype.populateTriggerConditionProcessorMap=freeOnUnref(function(e){var t=new KR.UnexpectedRebufferConditionProcessor,n=new HR.SyeAISUnexpectedRebufferConditionProcessor,r=new WR.SyeStallUnexpectedRebufferConditionProcessor,i=new zR.SyeErrorUnexpectedRebufferConditionProcessor,o=new jR.NetworkOutageConditionProcessor,a=new qR.ProactiveReportConditionProcessor(e),s=new LR.LowQualityPlaybackWithTimeWindowProcessor,l=new VR.LowQualityPlaybackConditionProcessor(e),f=new GR.PlaybackRestartConditionProcessor(e);u.triggerConditionProcessorMap[t.id]=t,u.triggerConditionProcessorMap[o.id]=o,u.triggerConditionProcessorMap[a.id]=a,u.triggerConditionProcessorMap[n.id]=n,u.triggerConditionProcessorMap[r.id]=r,u.triggerConditionProcessorMap[i.id]=i,u.triggerConditionProcessorMap[s.id]=s,u.triggerConditionProcessorMap[l.id]=l,u.triggerConditionProcessorMap[f.id]=f}),u.prototype.updatePreferences=freeOnUnref(function(e){}),u.prototype.removeInstance=freeOnUnref(function(){for(var e=0,t=this.evaluatorList;e<t.length;e++){t[e].removeInstance()}}),u.actionGroupIdToActionsMap={},u.triggerConditionProcessorMap={},u})();t.EvaluatorController=n}));e(XR);XR.EvaluatorController;var YR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(e,t,n){var r=i.call(this,t,n)||this;return r.handlePlaybackEndedEvent=freeOnUnref(function(e){r.sonarContext.eventAggregator.add(e),r.sonarController.handlePlaybackEnded(e)}),r.sonarController=e,r}return n(e,i),e.prototype.registerSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.on("playbackEndedEvent",this.handlePlaybackEndedEvent)}),e.prototype.unregisterSonarEventBusHandler=freeOnUnref(function(){this.sonarEventBus.off("playbackEndedEvent",this.handlePlaybackEndedEvent)}),e})(Z_.SonarEventMonitorBase);t.PlaybackEndedEventMonitor=r}));e(YR);YR.PlaybackEndedEventMonitor;var JR=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("AbstractSonarEventGenerator");var n=freeOnUnref(function(){function e(){this.enabled=!1,this.DEFAULT_POLLING_TIMEOUT_MS=6e4,this.generatorTimer=null}return e.prototype.getTimeoutInMilliseconds=freeOnUnref(function(){if(this.isEnabled()){var e=this.sonarEventGeneratorController.generatorToDeviceMetricsMap[this.id];if(null!=e&&0<e.length){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];t.push(i.cadenceMs)}return Math.min.apply(Math,t)}}return this.DEFAULT_POLLING_TIMEOUT_MS}),e.prototype.start=freeOnUnref(function(){var e=this,t=this.getTimeoutInMilliseconds();this.isEnabled()&&(this.generatorTimer=oe.timer.setInterval(freeOnUnref(function(){e.generateEvent()}),t))}),e.prototype.stop=freeOnUnref(function(){null!=this.generatorTimer&&(oe.timer.clearInterval(this.generatorTimer),this.generatorTimer=null)}),e.prototype.isEnabled=freeOnUnref(function(){return this.enabled}),e.prototype.enable=freeOnUnref(function(){this.enabled=!0}),e.prototype.disable=freeOnUnref(function(){this.enabled=!1}),e.prototype.process=freeOnUnref(function(e){}),e.prototype.updatePreferences=freeOnUnref(function(e){}),e.prototype.removeInstance=freeOnUnref(function(){this.disable()}),e})();t.AbstractSonarEventGenerator=n}));e(JR);JR.AbstractSonarEventGenerator;var ZR=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,"BufferFullnessMetricsRequestEvent",Date.now())||this}return n(t,e),t.prototype.getType=freeOnUnref(function(){return"sonarBufferFullnessMetricsRequestEvent"}),t})(v_.AbstractSonarEvent);t.SonarBufferFullnessMetricsRequestEvent=r}));e(ZR);ZR.SonarBufferFullnessMetricsRequestEvent;var $R=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this)||this;return n.id="BufferFullnessEventGenerator",n.DEFAULT_POLLING_TIMEOUT_MS=1e3,n.sonarEventGeneratorController=e,n.sonarEventBus=t,n}return n(e,r),e.prototype.generateEvent=freeOnUnref(function(){this.getTimeoutInMilliseconds()<=0||this.sonarEventBus.reportEvent(new ZR.SonarBufferFullnessMetricsRequestEvent)}),e.prototype.getProcessedMetrics=freeOnUnref(function(){return b_.BufferFullnessEvent.getDeviceMetrics()}),e})(JR.AbstractSonarEventGenerator);t.BufferFullnessEventGenerator=r}));e($R);$R.BufferFullnessEventGenerator;var eA=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(e,t,n){var r=i.call(this)||this;return r.id="CpuUsageEventGenerator",r.sonarEventGeneratorController=e,r.sonarContext=t,r.sonarEventBus=n,r}return n(e,i),e.prototype.generateEvent=freeOnUnref(function(){if(!(this.getTimeoutInMilliseconds()<=0||null==xt.platformRuntime||null==xt.platformRuntime.getPlayerCpuUsage)){var e=xt.platformRuntime.getPlayerCpuUsage();null!=e&&this.sonarEventBus.reportEvent(new eR.CpuUsageEvent(e))}}),e.prototype.getProcessedMetrics=freeOnUnref(function(){var e=[];return e=e.concat(eR.CpuUsageEvent.getDeviceMetrics())}),e})(JR.AbstractSonarEventGenerator);t.CpuUsageEventGenerator=r}));e(eA);eA.CpuUsageEventGenerator;var tA=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,"DroppedVideoFramesRequestEvent",Date.now())||this}return n(t,e),t.prototype.getType=freeOnUnref(function(){return"sonarDroppedVideoFramesRequestEvent"}),t})(v_.AbstractSonarEvent);t.SonarDroppedVideoFramesRequestEvent=r}));e(tA);tA.SonarDroppedVideoFramesRequestEvent;var nA=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this)||this;return n.id="DroppedVideoFramesRequestEventGenerator",n.DEFAULT_POLLING_TIMEOUT_MS=1e3,n.sonarEventGeneratorController=e,n.sonarEventBus=t,n}return n(e,r),e.prototype.generateEvent=freeOnUnref(function(){this.getTimeoutInMilliseconds()<=0||this.sonarEventBus.reportEvent(new tA.SonarDroppedVideoFramesRequestEvent)}),e.prototype.getProcessedMetrics=freeOnUnref(function(){var e=[];return e=e.concat(M_.DroppedVideoFramesEvent.getDeviceMetrics())}),e})(JR.AbstractSonarEventGenerator);t.DroppedVideoFramesRequestEventGenerator=r}));e(nA);nA.DroppedVideoFramesRequestEventGenerator;var rA=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this)||this;return n.id="EventLoopLagMillisEventGenerator",n.DEFAULT_POLLING_TIMEOUT_MS=1e3,n.sonarEventGeneratorController=e,n.sonarEventBus=t,n.prevEventLoopCallbackTimestampMillis=void 0,n}return n(e,r),e.prototype.generateEvent=freeOnUnref(function(){if(!(this.getTimeoutInMilliseconds()<=0)){var e=Date.now(),t=null!=this.prevEventLoopCallbackTimestampMillis?e-this.prevEventLoopCallbackTimestampMillis:0;this.prevEventLoopCallbackTimestampMillis=e,this.sonarEventBus.reportEvent(new rR.EventLoopLagMillisEvent(t))}}),e.prototype.getProcessedMetrics=freeOnUnref(function(){var e=[];return e=e.concat(rR.EventLoopLagMillisEvent.getDeviceMetrics())}),e})(JR.AbstractSonarEventGenerator);t.EventLoopLagMillisEventGenerator=r}));e(rA);rA.EventLoopLagMillisEventGenerator;var iA=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(e,t,n){var r=i.call(this)||this;return r.id="JsMemoryUsageEventGenerator",r.sonarEventGeneratorController=e,r.sonarContext=t,r.sonarEventBus=n,r}return n(e,i),e.prototype.generateEvent=freeOnUnref(function(){if(!(this.getTimeoutInMilliseconds()<=0||null==xt.platformRuntime||null==xt.platformRuntime.getPlayerJsMemoryUsage)){var e=xt.platformRuntime.getPlayerJsMemoryUsage();null!=e&&this.sonarEventBus.reportEvent(new sR.JsMemoryUsageEvent(e))}}),e.prototype.getProcessedMetrics=freeOnUnref(function(){var e=[];return e=e.concat(sR.JsMemoryUsageEvent.getDeviceMetrics())}),e})(JR.AbstractSonarEventGenerator);t.JsMemoryUsageEventGenerator=r}));e(iA);iA.JsMemoryUsageEventGenerator;var oA=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(i){function e(e,t,n){var r=i.call(this)||this;return r.id="ProcessMemoryUsageEventGenerator",r.sonarEventGeneratorController=e,r.sonarContext=t,r.sonarEventBus=n,r}return n(e,i),e.prototype.generateEvent=freeOnUnref(function(){if(!(this.getTimeoutInMilliseconds()<=0||null==xt.platformRuntime||null==xt.platformRuntime.getProcessMemoryUsage)){var e=xt.platformRuntime.getProcessMemoryUsage();null!=e&&this.sonarEventBus.reportEvent(new cR.ProcessMemoryUsageEvent(e))}}),e.prototype.getProcessedMetrics=freeOnUnref(function(){var e=[];return e=e.concat(cR.ProcessMemoryUsageEvent.getDeviceMetrics())}),e})(JR.AbstractSonarEventGenerator);t.ProcessMemoryUsageEventGenerator=r}));e(oA);oA.ProcessMemoryUsageEventGenerator;var aA=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(e){function t(){return e.call(this,"SyeMetricsRequestEvent",Date.now())||this}return n(t,e),t.prototype.getType=freeOnUnref(function(){return"sonarSyeMetricsRequestEvent"}),t})(v_.AbstractSonarEvent);t.SonarSyeMetricsRequestEvent=r}));e(aA);aA.SonarSyeMetricsRequestEvent;var sA=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(r){function e(e,t){var n=r.call(this)||this;return n.id="SyeMetricsRequestEventGenerator",n.DEFAULT_POLLING_TIMEOUT_MS=1e3,n.sonarEventGeneratorController=e,n.sonarEventBus=t,n}return n(e,r),e.prototype.generateEvent=freeOnUnref(function(){this.getTimeoutInMilliseconds()<=0||this.sonarEventBus.reportEvent(new aA.SonarSyeMetricsRequestEvent)}),e.prototype.getProcessedMetrics=freeOnUnref(function(){var e=[];return e=e.concat(F_.SyeMetricsEvent.getDeviceMetrics())}),e})(JR.AbstractSonarEventGenerator);t.SyeMetricsRequestEventGenerator=r}));e(sA);sA.SyeMetricsRequestEventGenerator;var lA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.availableGenerators=[],this.eventGenerators=[],this.generatorToDeviceMetricsMap={},this.availableGenerators.push(new $R.BufferFullnessEventGenerator(this,t),new eA.CpuUsageEventGenerator(this,e,t),new sA.SyeMetricsRequestEventGenerator(this,t),new iA.JsMemoryUsageEventGenerator(this,e,t),new oA.ProcessMemoryUsageEventGenerator(this,e,t),new nA.DroppedVideoFramesRequestEventGenerator(this,t),new rA.EventLoopLagMillisEventGenerator(this,t))}return e.prototype.enable=freeOnUnref(function(){for(var e=0,t=this.availableGenerators;e<t.length;e++){var n=t[e];-1!==this.eventGenerators.indexOf(n)&&(n.enable(),n.start())}}),e.prototype.disable=freeOnUnref(function(){for(var e=0,t=this.eventGenerators;e<t.length;e++){var n=t[e];n.disable(),n.stop()}}),e.prototype.process=freeOnUnref(function(e){this.eventGenerators=[],this.generatorToDeviceMetricsMap={};for(var t=0,n=this.availableGenerators;t<n.length;t++){for(var r=n[t],i=r.getProcessedMetrics(),o=0,a=e.bootstrapResponse.desiredDeviceMetrics;o<a.length;o++){var s=a[o];0<=i.indexOf(s.id)&&(null==this.generatorToDeviceMetricsMap[r.id]&&(this.generatorToDeviceMetricsMap[r.id]=[]),-1===this.generatorToDeviceMetricsMap[r.id].indexOf(s)&&this.generatorToDeviceMetricsMap[r.id].push(s))}null!=this.generatorToDeviceMetricsMap[r.id]&&-1===this.eventGenerators.indexOf(r)&&this.eventGenerators.push(r)}}),e.prototype.updatePreferences=freeOnUnref(function(e){}),e.prototype.removeInstance=freeOnUnref(function(){for(var e=0,t=this.availableGenerators;e<t.length;e++){t[e].removeInstance()}this.eventGenerators=[],this.generatorToDeviceMetricsMap={}}),e.prototype.getRunningEventGenerators=freeOnUnref(function(){return this.eventGenerators}),e})();t.SonarEventGeneratorController=n}));e(lA);lA.SonarEventGeneratorController;var fA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("SpeedTestRequest"),n=freeOnUnref(function(){function e(e,t,n,r){this.fileUrl=e,this.downloadTimeoutInMilliseconds=t,this.expectedBytesToDownload=r,this.httpMethod=n,this.httpRequestBuilder=new pn.HttpRequestBuilder(n,e)}return e.prototype.call=freeOnUnref(function(){var o=this,e=new lt.Promise(freeOnUnref(function(r,i){"GET"===o.httpMethod&&null!=o.expectedBytesToDownload&&o.httpRequestBuilder.header("Range","bytes=0-"+(o.expectedBytesToDownload-1)),o.httpRequestBuilder.responseType("text").timeout(o.downloadTimeoutInMilliseconds).build().onLoad(freeOnUnref(function(e){var t=o.createSpeedTestDownloadEvent(e);r(t)})).onError(freeOnUnref(function(e,t){if(a.info("Sonar Speed Test error: "+e.message+" error name "+e.name),null!=t){var n=o.createSpeedTestDownloadEvent(t);r(n)}i(e)})).send()}));return e.catch(freeOnUnref(function(e){a.error("Sonar: Error sending speed test request "+e)})),e}),e.prototype.createSpeedTestDownloadEvent=freeOnUnref(function(e){return{timeToFirstByteInMilliseconds:e.getLatencyMs(),timeToLastByteInMilliseconds:e.getTotalMs(),fragmentSizeBytes:e.getMetrics().totalBytes,bandwidthBitsPerSecond:C_.HttpResponseUtil.calculateThroughputBitsPerSecond(e.getMetrics().totalBytes,e.getTotalMs()),url:this.fileUrl,responseCode:e.getStatus(),responseHeaders:e.getHeaders()}}),e})();t.SpeedTestRequest=n}));e(fA);fA.SpeedTestRequest;var uA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("HttpGet"),n=freeOnUnref(function(){function e(){}return e.prototype.act=freeOnUnref(function(r,e){var i=this,t=1024*r.responseBodyLimitKB,n=this.getBytesToDownload(e.eventAggregator,5e5,t),o=new fA.SpeedTestRequest(r.url,r.timeoutMs,"GET",n),a=Date.now();return o.call().then(freeOnUnref(function(n){var e=new lt.Promise(freeOnUnref(function(e,t){e(i.createHttpActionReport(r,n,a))}));return e.catch(freeOnUnref(function(e){s.error("Sonar: Error sending Http Action "+e)})),e}))}),e.prototype.getBytesToDownload=freeOnUnref(function(e,t,n){var r=e.getLastMetricValue("networkThroughput");if(null==r)return t;var i=parseFloat(r)/8;return In.clamp(i,t,n)}),e.prototype.createHttpActionReport=freeOnUnref(function(e,t,n){return{http:{id:e.id,method:e.method,timeoutMs:e.timeoutMs,url:e.url,httpResult:this.buildHttpResult(t,n)}}}),e.prototype.buildHttpResult=freeOnUnref(function(e,t){return{response:this.buildHttpResponse(e,t),timeout:this.buildHttpTimeout(e)}}),e.prototype.buildHttpResponse=freeOnUnref(function(e,t){return{serverAddress:e.url,metrics:this.buildHttpMetrics(e,t),responseBody:"Download "+e.fragmentSizeBytes+" from "+e.url,responseCode:e.responseCode,responseHeaders:e.responseHeaders}}),e.prototype.buildHttpTimeout=freeOnUnref(function(e){return{elapsedMs:Math.round(e.timeToLastByteInMilliseconds)}}),e.prototype.buildHttpMetrics=freeOnUnref(function(e,t){return{timeToFirstByteMs:Math.round(e.timeToFirstByteInMilliseconds),timeToLastByteMs:Math.round(e.timeToLastByteInMilliseconds),bytesAcquired:e.fragmentSizeBytes,throughputHistory:[this.buildThroughputMetricsEntry(e)],startTimestampMs:t,endTimestampMs:Date.now()}}),e.prototype.buildThroughputMetricsEntry=freeOnUnref(function(e){return{bytesReceived:e.fragmentSizeBytes,elapsedTimeMs:Math.round(e.timeToLastByteInMilliseconds)}}),e})();t.HttpGet=n}));e(uA);uA.HttpGet;var cA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("GatewayPing"),n=freeOnUnref(function(){function e(){}return e.prototype.act=freeOnUnref(function(r){var i=this;if(null==r.endpointUrl||""===r.endpointUrl)return new lt.Promise(freeOnUnref(function(e,t){return t("PingAction.endpointUrl is invalid")}));var o=r.endpointUrl,e=new fA.SpeedTestRequest(r.endpointUrl,r.timeoutMs,"GET",0),a=Date.now();return new lt.Promise(freeOnUnref(function(t,n){return e.call().then(freeOnUnref(function(e){0===e.responseCode&&t(i.createPingActionReport(r,o,a)),s.error("Sonar: Unexpected HTTP request success with URL "+o),n(e)})).catch(freeOnUnref(function(){t(i.createPingActionReport(r,o,a))}))}))}),e.prototype.createPingActionReport=freeOnUnref(function(e,t,n){var r=Date.now(),i=r-n;return{ping:{id:e.id,host:e.host||"GATEWAY",timeoutMs:e.timeoutMs,pingResult:{response:{isReachable:!0,elapsedMs:i,hostIp:t,startTimestampMs:n,endTimestampMs:r}}}}}),e})();t.GatewayPing=n}));e(cA);cA.GatewayPing;var dA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.cdnRankController=e}return e.prototype.act=freeOnUnref(function(n){for(var r=this,e=[],t=0,i=this.cdnRankController.getFragmentsFromHistory(n.fragmentCountPerCdn);t<i.length;t++){var o=i[t];if(null!=o.fragmentUrl){var a=this.cdnRankController.processCdnUrls(o.fragmentUrl,n.timeoutMs);e.push(a)}}return lt.Promise.all(e).then(freeOnUnref(function(e){var t=e.reduce(freeOnUnref(function(e,t){return e.concat(t)}),[]);return r.createActionReport(n,t)}))}),e.prototype.createActionReport=freeOnUnref(function(e,t){return{cdnRank:{id:e.id,cdnInfoHistory:t}}}),e})();t.CdnRank=n}));e(dA);dA.CdnRank;var pA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("ActionsProcessor"),l="Cloudfront",n=freeOnUnref(function(){function e(e,t){this.httpGet=new uA.HttpGet,this.gatewayPing=new cA.GatewayPing,this.cdnRank=new dA.CdnRank(t),this.sonarContext=e}return e.prototype.processAction=freeOnUnref(function(e){var t=[];if(null!=e.actions){for(var n=e.actions,r=this.sonarContext.eventAggregator.getLastMetricValue("cdnName"),i=0,o=null==r||r.toLowerCase()!==l.toLowerCase()?this.removeActionsNotMatchingDefaultCDN(n,l):this.keepActionWithNonDefaultCDN(n,l);i<o.length;i++){var a=o[i];null!=a.http&&t.push(this.httpGet.act(a.http,this.sonarContext)),null!=a.ping&&this.isValidPingAction(a.ping)&&t.push(this.gatewayPing.act(a.ping)),null!=a.cdnRankV2&&t.push(this.cdnRank.act(a.cdnRankV2))}if(0===t.length)return lt.Promise.resolve([])}return lt.Promise.all(t).then(freeOnUnref(function(e){return e})).catch(freeOnUnref(function(e){return s.info("Sonar: Error Creating Action Group Report "+JSON.stringify(e)),[]}))}),e.prototype.isValidPingAction=freeOnUnref(function(e){return null!=e.endpointUrl&&0<e.endpointUrl.length}),e.prototype.keepActionWithNonDefaultCDN=freeOnUnref(function(e,i){var o=!1;return e.filter(freeOnUnref(function(e){var t=!0,n=e.http;if(null==n)return!0;var r=n.cdnName;return null!=r&&(o||r.toLowerCase()===i.toLowerCase()?t=!1:o=!0,t)}))}),e.prototype.removeActionsNotMatchingDefaultCDN=freeOnUnref(function(e,r){return e.filter(freeOnUnref(function(e){var t=e.http;if(null==t)return!0;var n=t.cdnName;return null!=n&&n.toLowerCase()===r.toLowerCase()}))}),e})();t.ActionsProcessor=n}));e(pA);pA.ActionsProcessor;var hA=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e.SUCCESSFUL="SUCCESSFUL",e.UNSUCCESSFUL="UNSUCCESSFUL",e.CACHED="CACHED"})(n||(n={})),t.FeedbackRequestStatus=n}));e(hA);hA.FeedbackRequestStatus;var mA=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("FeedbackController"),r=["Did not work","Did not understand","Not applicable","Needed more help","Solved"],o=freeOnUnref(function(){function e(e){this.sonarContext=e}return e.prototype.process=freeOnUnref(function(e){var r,t=new lt.Promise(freeOnUnref(function(n,t){pn.HttpRequestBuilder.post(OR.HttpRequestUtil.getSonarActionServiceEndpointUrl()).json(e).header(OR.HttpRequestUtil.getServiceTargetHeaderKey(),OR.HttpRequestUtil.getServiceTargetValueFeedback()).header(OR.HttpRequestUtil.getContentEncodingHeaderKey(),OR.HttpRequestUtil.getContentEncodingValue()).header(OR.HttpRequestUtil.getContentTypeHeaderKey(),OR.HttpRequestUtil.getContentTypeValue()).responseType("text").build().onLoad(freeOnUnref(function(e){var t=JSON.parse(e.getText());r=t.feedbackSubmitSucess?{requestStatus:hA.FeedbackRequestStatus.SUCCESSFUL}:{requestStatus:hA.FeedbackRequestStatus.UNSUCCESSFUL},n(r)})).onError(freeOnUnref(function(e){t(e)})).send()}));return t.catch(freeOnUnref(function(e){i.error("Sonar: Error sending feedback request "+e)})),t}),e.prototype.createRequestBody=freeOnUnref(function(e){var t={sdkVersion:OR.HttpRequestUtil.getSdkVersion(),deviceTypeId:this.sonarContext.deviceTypeId,playerType:this.sonarContext.player,currentTimeUTC:Date.now(),feedbackOptionValue:e,feedbackType:"User Provided",uxState:"Feedback after troubleshooting",troubleshootProvided:void 0,errorCode:void 0,exception:void 0};return null!=this.sonarContext.sessionId?n({},t,{sessionId:this.sonarContext.sessionId}):t}),e.prototype.isCustomerFeedbackOption=freeOnUnref(function(e){for(var t=0,n=r;t<n.length;t++){if(e===n[t].toString())return!0}return!1}),e})();t.FeedbackController=o}));e(mA);mA.FeedbackController;var yA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.parseSonarConfiguration=freeOnUnref(function(t){var n={},e=t,r=new G_.DefaultSonarConfiguration;return Object.keys(e).forEach(freeOnUnref(function(e){void 0!==r[e]&&(n[e]=t[e])})),n}),e})();t.ConfigurationUtil=n}));e(yA);yA.ConfigurationUtil;var gA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.getVideoMaterialType=freeOnUnref(function(e){switch(e){case"Feature":return"Feature";case"Trailer":return"Trailer";case"LiveStreaming":return"LiveStreaming";case"External":return"External";default:return}}),e.isSonarEnabledForVideoMaterialType=freeOnUnref(function(e,t){return"Feature"===t||"Trailer"===t?e.configuration.isSonarMonitoringEnabledOnVOD:("LiveStreaming"===t||"External"===t)&&e.configuration.isSonarMonitoringEnabledOnLive}),e.isSonarUxEnabledForVideoMaterialType=freeOnUnref(function(e,t){return"Feature"===t||"Trailer"===t?e.configuration.isSonarUxEnabledOnVOD:("LiveStreaming"===t||"External"===t)&&e.configuration.isSonarUxEnabledOnLive}),e})();t.VideoMaterialTypeUtil=n}));e(gA);gA.VideoMaterialTypeUtil;var vA=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(t){function e(e){return void 0===e&&(e=Date.now()),t.call(this,"ProxyEvent",e)||this}return n(e,t),e.prototype.getType=freeOnUnref(function(){return"proxyEvent"}),e})(v_.AbstractSonarEvent);t.ProxyEvent=r}));e(vA);vA.ProxyEvent;var OA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("ProactiveReportController");var n=freeOnUnref(function(){function e(e,t){this.isEnabled=!1,this.isProactiveEventGeneratorActive=!1,this.cadenceMillis=1e6,this.handleId=null,this.sonarContext=e,this.sonarEventBus=t}return e.prototype.process=freeOnUnref(function(){if(this.sonarContext.configuration.isSonarProactiveReportTriggerEnabled){var e=this.sonarContext.bootstrapResponse.triggerConditionsV2;null!=e&&null!=e.proactiveReport&&e.proactiveReport.isActive&&(this.isProactiveEventGeneratorActive=!0,this.cadenceMillis=e.proactiveReport.cadenceMs)}}),e.prototype.enable=freeOnUnref(function(){var e=this;this.isProactiveEventGeneratorActive&&!this.isEnabled&&(this.handleId=oe.timer.setInterval(freeOnUnref(function(){e.sonarEventBus.reportEvent(new vA.ProxyEvent)}),this.cadenceMillis),this.isEnabled=!0)}),e.prototype.disable=freeOnUnref(function(){this.isEnabled&&(null!=this.handleId&&(oe.timer.clearInterval(this.handleId),this.handleId=null),this.isEnabled=!1)}),e.prototype.updatePreferences=freeOnUnref(function(e){}),e.prototype.removeInstance=freeOnUnref(function(){}),e})();t.ProactiveReportController=n}));e(OA);OA.ProactiveReportController;var SA=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this,"SyeAISRebuffer",Date.now())||this;return t.unexpectedRebufferReason=e,t}return r(e,n),e.prototype.getUnexpectedRebufferReason=freeOnUnref(function(){return this.unexpectedRebufferReason}),e.prototype.getType=freeOnUnref(function(){return"syeAISUnexpectedRebufferEvent"}),e})(v_.AbstractSonarEvent);t.SyeAISUnexpectedRebufferEvent=n}));e(SA);SA.SyeAISUnexpectedRebufferEvent;var UA=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this,"SyeStallRebuffer",Date.now())||this;return t.unexpectedRebufferReason=e,t}return r(e,n),e.prototype.getUnexpectedRebufferReason=freeOnUnref(function(){return this.unexpectedRebufferReason}),e.prototype.getType=freeOnUnref(function(){return"syeStallUnexpectedRebufferEvent"}),e})(v_.AbstractSonarEvent);t.SyeStallUnexpectedRebufferEvent=n}));e(UA);UA.SyeStallUnexpectedRebufferEvent;var bA=t(freeOnUnref(function(e,t){var r=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(n){function e(e){var t=n.call(this,"SyeErrorRebuffer",Date.now())||this;return t.unexpectedRebufferReason=e,t}return r(e,n),e.prototype.getUnexpectedRebufferReason=freeOnUnref(function(){return this.unexpectedRebufferReason}),e.prototype.getType=freeOnUnref(function(){return"syeErrorUnexpectedRebufferEvent"}),e})(v_.AbstractSonarEvent);t.SyeErrorUnexpectedRebufferEvent=n}));e(bA);bA.SyeErrorUnexpectedRebufferEvent;var PA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),freeOnUnref(function(e){e[e.kStopped=0]="kStopped",e[e.kLoading=1]="kLoading",e[e.kPlaying=2]="kPlaying",e[e.kStalled=3]="kStalled",e[e.kAIS=4]="kAIS",e[e.kError=5]="kError"})(t.SonarSyePlayerState||(t.SonarSyePlayerState={}))}));e(PA);PA.SonarSyePlayerState;var MA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.initialize=freeOnUnref(function(){null!=zt.deviceInformation&&(null!=zt.deviceInformation.software&&null!=zt.deviceInformation.software.browser&&(this.browserName=zt.deviceInformation.software.browser.name,this.browserVersion=zt.deviceInformation.software.browser.version),null!=zt.deviceInformation.hardware&&null!=zt.deviceInformation.hardware.model&&(this.modelName=zt.deviceInformation.hardware.model.name,this.modelVersion=zt.deviceInformation.hardware.model.version))}),e.prototype.uninitialize=freeOnUnref(function(){this.browserName=void 0,this.browserVersion=void 0,this.modelName=void 0,this.modelVersion=void 0}),e})();t.SonarDeviceInformation=n}));e(MA);MA.SonarDeviceInformation;var CA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.receivedTimeout=!1,this.timeWindowSumAggregator=e,this.rebufferLimit=t}return e.prototype.rebufferConditionsMet=freeOnUnref(function(){return this.timeWindowSumAggregator.getRollingSum()>=this.rebufferLimit||this.receivedTimeout}),e.prototype.insertRebuffer=freeOnUnref(function(e){this.timeWindowSumAggregator.addSample(1,e)}),e.prototype.clear=freeOnUnref(function(){this.timeWindowSumAggregator.clear(),this.receivedTimeout=!1}),e})();t.RebufferTracker=n}));e(CA);CA.RebufferTracker;var EA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("SonarObservationController"),n="Sonar.SonarObservationController.",r=freeOnUnref(function(){function e(e,t){var n=this;this.generatorTimer=null,this.rebufferTimeoutDurationSeconds=null,this.rebufferTracker=null,this.uxNotificationEvent=null,this.isRebuffering=!1,this.handleUnexpectedRebufferEvent=freeOnUnref(function(){if(null!=n.rebufferTimeoutDurationSeconds){i.enabledFor(de.DEBUG)&&i.info("SonarObservationController: Received UnexpectedRebufferEvent"),n.isRebuffering=!0;var e=1e3*n.rebufferTimeoutDurationSeconds;n.generatorTimer=oe.timer.setTimeout(n.handleObservationTimeoutEvent,e)}}),this.handleUnexpectedRebufferEndEvent=freeOnUnref(function(e){null!=n.rebufferTracker&&null!=n.generatorTimer&&n.isRebuffering&&(n.isRebuffering=!1,n.rebufferTracker.insertRebuffer(e.timestampInMilliseconds),oe.timer.clearTimeout(n.generatorTimer),i.enabledFor(de.DEBUG)&&i.info("SonarObservationController: Received UnexpectedRebufferEndEvent"),null!=n.uxNotificationEvent&&n.sendNotification())}),this.handleObservationTimeoutEvent=freeOnUnref(function(){null!=n.rebufferTracker&&(i.enabledFor(de.DEBUG)&&i.info("SonarObservationController: Received handleObservationTimeoutEvent"),n.isRebuffering=!1,n.rebufferTracker.receivedTimeout=!0,null!=n.uxNotificationEvent&&n.sendNotification())}),this.handleUxNotificationEvent=freeOnUnref(function(e){i.enabledFor(de.DEBUG)&&i.info("SonarObservationController: Ack receiving observation, overriding any prev observation"),n.uxNotificationEvent=e,n.isRebuffering||n.sendNotification()}),this.sonarEventBus=e,this.sonarPlayerBus=t}return e.prototype.initialize=freeOnUnref(function(e){if(null!=e.bootstrapResponse.sonarObservationControllerConfig&&e.bootstrapResponse.sonarObservationControllerConfig.isSonarObservationControllerEnabled){var t=e.bootstrapResponse.sonarObservationControllerConfig.observationControlTimeWindowSeconds,n=1e3*t,r=e.bootstrapResponse.sonarObservationControllerConfig.minRebuffersCountForObservation;this.rebufferTracker=new CA.RebufferTracker(new BR.TimeWindowSumAggregator(n),r),this.rebufferTimeoutDurationSeconds=e.bootstrapResponse.sonarObservationControllerConfig.minLongRebufferDurationSecondsForObservation,i.enabledFor(de.DEBUG)&&i.info("SonarObservationController: Initialized with rebufferTimeWindowSeconds "+t+" rebufferLimit "+r+" rebufferTimeoutDurationSeconds "+this.rebufferTimeoutDurationSeconds),this.sonarEventBus.on("sonarUxNotificationEvent",this.handleUxNotificationEvent),this.sonarEventBus.on("unexpectedRebufferEvent",this.handleUnexpectedRebufferEvent),this.sonarEventBus.on("syeAISUnexpectedRebufferEvent",this.handleUnexpectedRebufferEvent),this.sonarEventBus.on("syeStallUnexpectedRebufferEvent",this.handleUnexpectedRebufferEvent),this.sonarEventBus.on("syeErrorUnexpectedRebufferEvent",this.handleUnexpectedRebufferEvent),this.sonarEventBus.on("unexpectedRebufferEndEvent",this.handleUnexpectedRebufferEndEvent)}}),e.prototype.uninitialize=freeOnUnref(function(){this.sonarEventBus.off("sonarUxNotificationEvent",this.handleUxNotificationEvent),this.sonarEventBus.off("unexpectedRebufferEvent",this.handleUnexpectedRebufferEvent),this.sonarEventBus.off("syeAISUnexpectedRebufferEvent",this.handleUnexpectedRebufferEvent),this.sonarEventBus.off("syeStallUnexpectedRebufferEvent",this.handleUnexpectedRebufferEvent),this.sonarEventBus.off("syeErrorUnexpectedRebufferEvent",this.handleUnexpectedRebufferEvent),this.sonarEventBus.off("unexpectedRebufferEndEvent",this.handleUnexpectedRebufferEndEvent)}),e.prototype.sendNotification=freeOnUnref(function(){null!=this.rebufferTracker&&this.rebufferTracker.rebufferConditionsMet()&&null!=this.uxNotificationEvent?(i.enabledFor(de.DEBUG)&&i.info("SonarObservationController: Sending observation with error code: "+this.uxNotificationEvent.errorCode),this.sonarPlayerBus.emit("uxNotificationEvent",this.uxNotificationEvent),q.metrics.putMetric(n+"showObservation"),this.rebufferTracker.clear()):q.metrics.putMetric(n+"blockObservation"),this.uxNotificationEvent=null}),e})();t.SonarObservationController=r}));e(EA);EA.SonarObservationController;var TA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("SonarCdnRankController"),n=freeOnUnref(function(){function e(e,t){this.playbackUrls=[],this.isEnabled=!1,this.rollingFragmentHistory=[],this.shouldRankCdnPeriodically=!1,this.fetchManifestCancel=null,this.sonarEventBus=e,this.sonarContext=t,this.manifestParser=new Jp.DashParser}return e.prototype.initialize=freeOnUnref(function(){var e=this;if(this.shouldRankCdnPeriodically=0!==this.sonarContext.bootstrapResponse.desiredDeviceMetrics.filter(freeOnUnref(function(e){return"cdnRankings"===e.id})).length,this.sonarContext.configuration.isSonarCdnRankingEnabled&&null!=this.sonarContext.playbackUrls&&null!=this.sonarContext.playbackUrls.urlSets[this.sonarContext.playbackUrls.defaultUrlSetId]&&"liveStreaming"===this.sonarContext.currentContentType&&"DASH"===this.sonarContext.currentStreamingType){var t=this.sonarContext.playbackUrls,n=this.sonarContext.playbackUrls.urlSets[this.sonarContext.playbackUrls.defaultUrlSetId],r=n.origin;this.playbackUrls=Object.keys(t.urlSets).filter(freeOnUnref(function(e){return t.urlSets[e].origin===r})).map(freeOnUnref(function(e){return t.urlSets[e]})),this.manifestFetchTimeoutId=oe.timer.setTimeout(freeOnUnref(function(){e.fetchManifestAndExtractBaseUrl(n.manifestUrl)}),this.sonarContext.configuration.sonarCdnRankingSessionStartDelayMillis)}}),e.prototype.process=freeOnUnref(function(){var n=this;this.sonarContext.configuration.isSonarCdnRankingEnabled&&this.isEnabled&&this.shouldRankCdnPeriodically&&0!==this.playbackUrls.length&&1!==this.playbackUrls.length&&null!=this.currentFragment&&null!=this.currentFragment.fragmentUrl&&this.processCdnUrls(this.currentFragment.fragmentUrl,1e3).then(freeOnUnref(function(e){var t=new j_.SonarCdnRankEvent(e);n.sonarEventBus.reportEvent(t),f.info("Successfully ran all CDN requests. Reporting CDN rank event:",JSON.stringify(t))}))}),e.prototype.processCdnUrls=freeOnUnref(function(r,i){var e=this;if(!this.sonarContext.configuration.isSonarCdnRankingEnabled||!this.isEnabled)return lt.Promise.resolve([]);if(0===this.playbackUrls.length||1===this.playbackUrls.length)return lt.Promise.resolve([]);if(null==this.currentFragment||null==this.currentFragment.fragmentUrl)return lt.Promise.resolve([]);if(""===r)return lt.Promise.resolve([]);for(var o=[],a={},t=freeOnUnref(function(t){var n=s.constructFragmentUrl(r,t.manifestUrl),e=void 0;e=s.sonarContext.configuration.shouldSonarCdnRankingUseGet?new fA.SpeedTestRequest(n,i,"GET",s.sonarContext.configuration.sonarCdnRankingRequestSizeBytes):new fA.SpeedTestRequest(n,i,"HEAD"),o.push(e.call().then(freeOnUnref(function(e){a[t.urlSetId]={latencyInMillis:e.timeToFirstByteInMilliseconds,httpResponseCode:e.responseCode,fragmentUrl:n}})).catch(freeOnUnref(function(e){f.error("Unable to reach fragment URL "+n+" from CDN "+t.cdnName+" due to "+e.message),a[t.urlSetId]={latencyInMillis:-1,httpResponseCode:-1,fragmentUrl:n}})))}),s=this,n=0,l=this.playbackUrls;n<l.length;n++){t(l[n])}return lt.Promise.all(o).then(freeOnUnref(function(){return e.createCdnInfoList(a)}))}),e.prototype.setFragment=freeOnUnref(function(e){if(this.sonarContext.configuration.isSonarCdnRankingEnabled&&this.isEnabled){var t=e.fragmentUrl,n=e.assetType,r=null!=t&&-1!==t.indexOf("cenc_video")&&-1===t.indexOf("init.mp4");"Video"===n&&r&&(this.currentFragment=e,this.addToFragmentHistory(this.currentFragment))}}),e.prototype.addToFragmentHistory=freeOnUnref(function(e){this.rollingFragmentHistory.push(e),this.rollingFragmentHistory.length>this.sonarContext.configuration.sonarCdnRankingFragmentHistoryMaxSize&&this.rollingFragmentHistory.shift()}),e.prototype.getFragmentsFromHistory=freeOnUnref(function(e){var t=-1*e;return this.rollingFragmentHistory.slice(t)}),e.prototype.enable=freeOnUnref(function(){var e=this;this.sonarContext.configuration.isSonarCdnRankingEnabled&&!this.isEnabled&&(this.sonarContext.configuration.shouldSonarCdnRankingUseCadence&&(this.fragmentFetchIntervalId=oe.timer.setInterval(freeOnUnref(function(){e.process()}),this.sonarContext.configuration.sonarCdnRankingCadenceMillis)),this.isEnabled=!0)}),e.prototype.disable=freeOnUnref(function(){this.sonarContext.configuration.isSonarCdnRankingEnabled&&(this.sonarContext.configuration.shouldSonarCdnRankingUseCadence&&null!=this.fragmentFetchIntervalId&&(oe.timer.clearInterval(this.fragmentFetchIntervalId),this.fragmentFetchIntervalId=void 0),null!=this.fetchManifestCancel&&(this.fetchManifestCancel(),this.fetchManifestCancel=null),null!=this.manifestFetchTimeoutId&&(oe.timer.clearTimeout(this.manifestFetchTimeoutId),this.manifestFetchTimeoutId=void 0),this.isEnabled=!1)}),e.prototype.createCdnInfoList=freeOnUnref(function(e){for(var t=[],n=Date.now(),r=0,i=this.playbackUrls;r<i.length;r++){var o=i[r],a={urlSetId:o.urlSetId,cdnName:o.cdnName,origin:o.origin,fragmentUrl:e[o.urlSetId].fragmentUrl,latencyInMillis:e[o.urlSetId].latencyInMillis,httpResponseCode:e[o.urlSetId].httpResponseCode,timestampInMillis:n};t.push(a)}return t}),e.prototype.fetchManifestAndExtractBaseUrl=freeOnUnref(function(e){var t=this;null!=this.fetchManifestCancel&&(this.fetchManifestCancel(),this.fetchManifestCancel=null);var n=lt.CancelToken.source(),r=n.token,i=n.cancel;this.fetchManifestCancel=i,this.fetchManifest(e,r).then(freeOnUnref(function(e){r.throwIfRequested(),t.extractBaseUrlTag(e)})).catch(freeOnUnref(function(e){lt.CancelError}))}),e.prototype.fetchManifest=freeOnUnref(function(i,o){var e,a=this,s=new mt.URL(i);return this.addQueryParamsIfMissing(s,((e={}).amznDtid=this.sonarContext.deviceTypeId,e.encoding="segmentBase",e)),new lt.Promise(freeOnUnref(function(n,r){(new _n.ExponentialBackoffRetry).withMaxAttempts(a.sonarContext.configuration.sonarCdnRankingManifestRequestMaxRetries).withMaxDelayMs(a.sonarContext.configuration.sonarCdnRankingManifestRequestRetryDelayMillis).onSuccess(freeOnUnref(function(e){f.info("Successfully fetched manifest file "+i+" in "+e.getTotalMs()+" ms");var t=e.getText();if(6291456<t.length)return f.warn("Manifest exceeds max size. URL: "+i+", Size: "+t.length+" Bytes"),void r();n(t)})).onError(freeOnUnref(function(e,t){f.error("Unable to reach manifest URL "+i+" due to "+e.message+". Disabling component."),r(e)})).onAttempt(freeOnUnref(function(e,n,t,r){o.throwIfRequested(),pn.HttpRequestBuilder.get(s.toString()).responseType("text").timeout(a.sonarContext.configuration.sonarCdnRankingManifestRequestTimeoutMillis).build().onLoad(freeOnUnref(function(e){t(e)})).onError(freeOnUnref(function(e,t){n(e)})).send()})).execute()}))}),e.prototype.extractBaseUrlTag=freeOnUnref(function(e){var r=this,i=Date.now();this.manifestParser.parse(e).then(freeOnUnref(function(e){f.info("Manifest parsing succeeded in "+(Date.now()-i)+" ms");var t=e.baseUrl;if(r.enable(),null!=t&&0!==t.length){var n=t[0].baseUrl;null!=n&&(r.baseUrlFromManifest=n)}})).catch(freeOnUnref(function(e){f.error("Unable to parse manifest body string.")}))}),e.prototype.getFragmentFileName=freeOnUnref(function(e){if(null!=e.pathname)return e.pathname.split("/").pop();var t=e.href.split("/").pop();return null==t?(f.warn("getFragmentFileName href yielded no file name: ",e.href),""):t.split("?")[0]}),e.prototype.constructFragmentUrl=freeOnUnref(function(e,t){var n,r,i=new mt.URL(e);this.addQueryParamsIfMissing(i,((n={}).amznDtid=this.sonarContext.deviceTypeId,n));var o=this.getFragmentFileName(i);null!=this.baseUrlFromManifest?r=new mt.URL(this.baseUrlFromManifest,t).toString()+o+i.search:r=t.substring(0,t.lastIndexOf("/"))+"/"+o+i.search;return r}),e.prototype.addQueryParamsIfMissing=freeOnUnref(function(e,t){mt.URLUtils.removeQueryParams(e,t),mt.URLUtils.appendQueryParams(e,t)}),e})();t.SonarCdnRankController=n}));e(TA);TA.SonarCdnRankController;var wA=t(freeOnUnref(function(e,t){var a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("SonarController"),n=freeOnUnref(function(){function e(e){var t=this;this.isInitialized=!1,this.handleBufferFullnessMetricsRequestEvent=freeOnUnref(function(){t.sonarPlayerBus.emit("bufferFullnessMetricsRequestEvent")}),this.handleSyeMetricsRequestEvent=freeOnUnref(function(){t.sonarPlayerBus.emit("syeMetricsRequestEvent")}),this.handleDroppedVideoFramesRequestEvent=freeOnUnref(function(){t.sonarPlayerBus.emit("droppedVideoFramesRequestEvent")}),this.handleSonarNotificationReportEvent=freeOnUnref(function(e){t.sonarPlayerBus.emit("sonarNotificationReportEvent",e)}),r.info("Creating Sonar SDK"),this.configurationManager=new Q_.SonarConfigurationManager,null!=e&&this.configurationManager.setTenantOverrides(e),this.sonarContext=new vR.SonarInternalContext(this.configurationManager,null,null,(new W_.DefaultBootstrapResponseBuilder).build(),new J_.EventAggregator,"XP","default-xp-device-type-id","default-xp-device-id",void 0,new MA.SonarDeviceInformation),this.sonarEventBus=new gR.SonarEventBus,this.sonarPlayerBus=new A.EventEmitter,this.sonarCdnRankController=new TA.SonarCdnRankController(this.sonarEventBus,this.sonarContext),this.actionsProcessor=new pA.ActionsProcessor(this.sonarContext,this.sonarCdnRankController),this.bootstrapController=new SR.BootstrapController(this.sonarContext),this.feedbackController=new mA.FeedbackController(this.sonarContext),this.sonarReporter=new ER.SonarReporter(this.sonarContext,this.sonarEventBus,this.sonarPlayerBus,this),this.playbackStartedEventMonitor=new TR.PlaybackStartedEventMonitor(this,this.sonarContext,this.sonarEventBus),this.playbackEndedEventMonitor=new YR.PlaybackEndedEventMonitor(this,this.sonarContext,this.sonarEventBus),this.monitorController=new yR.MonitorController(this,this.sonarContext,this.sonarEventBus),this.evaluatorController=new XR.EvaluatorController(this.sonarContext,this.sonarEventBus,this.sonarReporter,this.actionsProcessor),this.eventGeneratorController=new lA.SonarEventGeneratorController(this.sonarContext,this.sonarEventBus),this.proactiveReportController=new OA.ProactiveReportController(this.sonarContext,this.sonarEventBus),this.sonarObservationController=new EA.SonarObservationController(this.sonarEventBus,this.sonarPlayerBus)}return e.prototype.initialize=freeOnUnref(function(e){this.isSonarEnabled()&&!this.isInitialized&&(r.info("Initializing Sonar"),this.sonarContext.sonarDeviceInformation.initialize(),this.sonarContext.deviceTypeId=e.deviceTypeId,this.sonarContext.deviceId=e.deviceId,this.playbackStartedEventMonitor.enable(),this.playbackEndedEventMonitor.enable(),this.sonarEventBus.on("sonarBufferFullnessMetricsRequestEvent",this.handleBufferFullnessMetricsRequestEvent),this.sonarEventBus.on("sonarSyeMetricsRequestEvent",this.handleSyeMetricsRequestEvent),this.sonarEventBus.on("sonarDroppedVideoFramesRequestEvent",this.handleDroppedVideoFramesRequestEvent),this.sonarEventBus.on("sonarNotificationReportEvent",this.handleSonarNotificationReportEvent),this.isInitialized=!0)}),e.prototype.uninitialize=freeOnUnref(function(){r.info("Uninitializing Sonar"),this.sonarContext.sonarDeviceInformation.uninitialize(),this.playbackStartedEventMonitor.disable(),this.playbackEndedEventMonitor.disable(),this.sonarEventBus.off("sonarBufferFullnessMetricsRequestEvent",this.handleBufferFullnessMetricsRequestEvent),this.sonarEventBus.off("sonarSyeMetricsRequestEvent",this.handleSyeMetricsRequestEvent),this.sonarEventBus.off("sonarDroppedVideoFramesRequestEvent",this.handleDroppedVideoFramesRequestEvent),this.sonarEventBus.off("sonarNotificationReportEvent",this.handleSonarNotificationReportEvent),null!=this.sonarObservationController&&this.sonarObservationController.uninitialize(),this.isInitialized=!1}),e.prototype.reportEvent=freeOnUnref(function(e){if(this.isSonarEnabled())switch(e.eventType){case"ConsumptionIdUpdateEvent":this.updateConsumptionId(e),this.sonarEventBus.reportEvent(e);break;case"Rebuffer":var t=this.getDashOrSyeRebufferEvent(e);return void this.sonarEventBus.reportEvent(t);case"Acquisition":e instanceof E_.FragmentAcquisitionEvent&&this.sonarCdnRankController.setFragment(e),this.sonarEventBus.reportEvent(e);break;default:this.sonarEventBus.reportEvent(e)}}),e.prototype.getDashOrSyeRebufferEvent=freeOnUnref(function(e){var t=e.getUnexpectedRebufferReason();switch(t){case PA.SonarSyePlayerState[PA.SonarSyePlayerState.kAIS]:return new SA.SyeAISUnexpectedRebufferEvent(t);case PA.SonarSyePlayerState[PA.SonarSyePlayerState.kStalled]:return new UA.SyeStallUnexpectedRebufferEvent(t);case PA.SonarSyePlayerState[PA.SonarSyePlayerState.kError]:return new bA.SyeErrorUnexpectedRebufferEvent(t);default:return e}}),e.prototype.updateConsumptionId=freeOnUnref(function(e){this.sonarContext.consumptionId=e.getCurrentConsumptionId()}),e.prototype.isSonarEnabled=freeOnUnref(function(){return this.configurationManager.getConfiguration().isSonarSdkEnabled}),e.prototype.updateSonarOverrides=freeOnUnref(function(e){var t=e.sdkConfigurationOverrides;if(null!=t){var n=yA.ConfigurationUtil.parseSonarConfiguration(t);this.configurationManager.setSonarOverrides(n)}}),e.prototype.handlePlaybackStarted=freeOnUnref(function(e){var n=this;this.sonarContext.sessionId=e.consumptionId,this.sonarContext.consumptionId=e.consumptionId,this.sonarContext.titleId=e.titleId,null!=e.streamingType&&(this.sonarContext.currentStreamingType=e.streamingType),this.sonarContext.sessionStartTime=e.sessionStartTime,this.videoMaterialType=gA.VideoMaterialTypeUtil.getVideoMaterialType(e.videoMaterialType),this.setContentType(this.videoMaterialType),null!=e.playbackUrls&&(this.sonarContext.playbackUrls=e.playbackUrls),this.bootstrapController.process().then(freeOnUnref(function(e){var t=n.sonarContext.bootstrapResponse;n.updateSonarOverrides(t),n.handleBootstrapResponseCompleted(t),n.sonarContext.eventAggregator.process(n.sonarContext),gA.VideoMaterialTypeUtil.isSonarEnabledForVideoMaterialType(n.sonarContext,n.videoMaterialType)&&(r.info("Enabling Sonar Controllers and generators: "),n.sonarObservationController.initialize(n.sonarContext),n.sonarCdnRankController.initialize(),n.monitorController.enable(),n.monitorController.process(n.sonarContext),n.evaluatorController.enable(),n.evaluatorController.process(n.sonarContext),n.eventGeneratorController.process(n.sonarContext),n.eventGeneratorController.enable(),n.proactiveReportController.process(),n.proactiveReportController.enable())})).catch(freeOnUnref(function(e){r.error("Got "+e+" on Sonar Bootstrap request")}))}),e.prototype.handlePlaybackEnded=freeOnUnref(function(e){r.info("Disabling Sonar Controllers and generators: "),this.evaluatorController.disable(),this.monitorController.disable(),this.eventGeneratorController.disable(),this.sonarCdnRankController.disable(),this.sonarContext.unloadContent()}),e.prototype.handleBootstrapResponseCompleted=freeOnUnref(function(e){var t=null,n=null,r=this.configurationManager.getConfiguration(),i=a({},r,{isSonarUxEnabled:r.isSonarUxEnabled&&r.isSonarSdkEnabled&&gA.VideoMaterialTypeUtil.isSonarEnabledForVideoMaterialType(this.sonarContext,this.videoMaterialType)&&gA.VideoMaterialTypeUtil.isSonarUxEnabledForVideoMaterialType(this.sonarContext,this.videoMaterialType)});null!=e.troubleshooting&&(t=e.troubleshooting),null!=e.uxObservations&&(n=e.uxObservations);var o=new U_.BootstrapCompletedEvent(i,t,n);this.sonarPlayerBus.emit("bootstrapCompletedEvent",o)}),e.prototype.setContentType=freeOnUnref(function(e){switch(e){case"Feature":this.sonarContext.currentContentType="feature";break;case"Trailer":this.sonarContext.currentContentType="trailer";break;case"LiveStreaming":this.sonarContext.currentContentType="liveStreaming";break;case"External":this.sonarContext.currentContentType="external";break;default:this.sonarContext.currentContentType="none"}}),e.prototype.submitFeedback=freeOnUnref(function(e){if(this.feedbackController.isCustomerFeedbackOption(e)){var t=this.feedbackController.createRequestBody(e);return this.feedbackController.process(t)}return lt.Promise.reject("Lack of customer feedback value")}),e.prototype.sendMitigation=freeOnUnref(function(e){switch(e.getType()){case CR.SonarMitigationType.SwitchCDN:this.sonarPlayerBus.emit("sonarSwitchCdnEvent",e)}}),e.prototype.on=freeOnUnref(function(e,t){this.sonarPlayerBus.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.sonarPlayerBus.off(e,t)}),e})();t.SonarController=n}));e(wA);wA.SonarController;var IA=t(freeOnUnref(function(e,n){function t(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),t(U_),t(b_),t(P_),t(M_),t(E_),t(T_),t(w_),t(I_),t(k_),t(__),t(R_),t(A_),t(D_),t(x_),t(F_),t(B_),t(L_),t(N_),t(V_),t(j_),t(q_),t(H_),t(z_),t(wA),t(O_)}));e(IA);var kA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("SonarEventAdapter");function s(e){if(null!=e)return e.front.endTimeMs-e.front.startTimeMs}var n=freeOnUnref(function(){function e(e,t,n,r){var a=this;this.playbackQualityProvider=null,this.contentState=null,this.playbackState=null,this.isInitialized=!1,this.isPlaybackStarted=!1,this.isRebuffering=!1,this.prevSyeEventPacketsLost=0,this.prevSyeEventPacketsReceived=0,this.handleSyeMetricsRequestEvent=freeOnUnref(function(){if(null!=a.liveLowLatencyContentSource){var e=a.liveLowLatencyContentSource.getBitstreamInfo(),t=a.liveLowLatencyContentSource.getStatistics();if(null!=t&&null!=e){var n=a.liveLowLatencyContentSource.sourceUrlStore.get().cdn,r=new IA.SyeMetricsEvent(t.currentRoundtripMillis,t.totalBitsPerSecond,t.videoDivergenceMillis,a.consumptionId,e.bitrate,e.width,e.height,Date.now(),t.numReceivedBytes,t.numReceivedFrames,t.numDecryptedFrames,t.numDecodeFailures,t.numDamagedAudioFrames,t.audioDropoutMillis,t.numDroppedVideoFrames,t.numDamagedVideoFrames,t.pitcherGroup,t.egressEndpoint,t.packetsReceived,t.packetsLost,t.packetsInvalid,t.packetsRetransmitReceived,t.packetsRetransmitReceivedUnused,t.thumbnailsReceived,t.notificationsReceived,a.prevSyeEventPacketsLost,a.prevSyeEventPacketsReceived,n);a.sonarClientSDK.reportEvent(r),a.prevSyeEventPacketsReceived=t.packetsReceived,a.prevSyeEventPacketsLost=t.packetsLost}}else i.info("Attempted to report a LiveLowLatencyContentSource event without a source")}),this.handleDroppedFrameRequestEvent=freeOnUnref(function(){if(null!=a.playbackQualityProvider){var e=a.playbackQualityProvider.getVideoDecodePerformance();if(null!=e){var t=e.droppedVideoFrames;a.sonarClientSDK.reportEvent(new IA.DroppedVideoFramesEvent(t))}}}),this.handleSonarNotificationReportEvent=freeOnUnref(function(e){var t=e.sonarNotification;if("ActiveMonitor"===t.notification._type){var n=t.notification,r=Tv.SonarNotificationEventFactory.createSonarNotificationEvent(t.sdkVersion,t.experimentCohort,t.triggerType,t.triggerTimestamp,t.consumptionId,t.instructionSetId,Tv.SonarNotificationEventFactory.createSonarNotificationActiveMonitor(n.monitorType,n.monitorName,n.success,n.startTimestamp,n.endTimestamp));a.mediaEventReporter.enqueueMediaEvents([r])}else if("Mitigation"===t.notification._type){var i=t.notification,o=null;null!=i.uxDetails&&(o=Tv.SonarNotificationEventFactory.createSonarUxDetails(i.uxDetails.isObservation,i.uxDetails.isFeedbackSubmitted,i.uxDetails.errorCode));r=Tv.SonarNotificationEventFactory.createSonarNotificationEvent(t.sdkVersion,t.experimentCohort,t.triggerType,t.triggerTimestamp,t.consumptionId,t.instructionSetId,Tv.SonarNotificationEventFactory.createSonarNotificationMitigation(i.mitigationType,i.mitigationCategory,i.resultType,i.resultCategory,i.success,i.reportId,i.rootCauseDAG,o));a.mediaEventReporter.enqueueMediaEvents([r])}}),this.reportBufferFullness=freeOnUnref(function(){var e=a.mpPlayer.getBufferInformationProvider();if(null!=e){var t=e.getBufferInformation(),n=e.getInMemoryBufferInformation(),r=e.getSourceBufferInformation(),i={audioBufferDurationInMilliseconds:s(t.Audio),videoBufferDurationInMilliseconds:s(t.Video),audioFragmentBufferDurationInMilliseconds:s(n.Audio),videoFragmentBufferDurationInMilliseconds:s(n.Video),audioSourceBufferDurationInMilliseconds:s(r.Audio),videoSourceBufferDurationInMilliseconds:s(r.Video)};if(null!=i.audioBufferDurationInMilliseconds||null!=i.videoBufferDurationInMilliseconds){var o=new IA.BufferFullnessEvent(i);a.sonarClientSDK.reportEvent(o)}}}),this.onContentStateChange=freeOnUnref(function(e){if(a.contentState!==e.contentState){switch(e.contentState){case"ready":a.isPlaybackStarted||"playing"!==a.playbackState||a.playbackStarted(),a.isRebuffering&&(a.isRebuffering=!1,a.sonarClientSDK.reportEvent(new IA.UnexpectedRebufferEndEvent));break;case"waiting":case"error":break;case"unloaded":a.contentUnloaded(),a.playbackEnded()}a.contentState=e.contentState}}),this.onPlaybackStateChange=freeOnUnref(function(e){var t=e.playbackState;if(a.playbackState!==t&&(a.playbackState=t,"ready"===a.contentState))switch(t){case"playing":a.isPlaybackStarted||"ready"!==a.contentState||a.playbackStarted();break;case"paused":break;default:return}}),this.onStallChange=freeOnUnref(function(e){e.expected||(a.isRebuffering=!0,a.sonarClientSDK.reportEvent(new IA.UnexpectedRebufferEvent(e.reason)))}),this.onFragmentLoad=freeOnUnref(function(e){if(null!==e){var t=e.appendTimeMs,n=e.durationMs,r=e.streamType;a.sonarClientSDK.reportEvent(new IA.FragmentLoadEvent(r,n,t))}}),this.sonarClientSDK=e,this.mpPlayer=t,this.mediaEventReporter=n,this.playlistEngine=r,this.consumptionId="",this.videoMaterialType="",this.titleId="",this.streamingType="DASH"}return e.prototype.initialize=freeOnUnref(function(){this.isInitialized||(this.mpPlayer.on("contentStateChange",this.onContentStateChange),this.mpPlayer.on("playbackStateChange",this.onPlaybackStateChange),this.mpPlayer.on("stall",this.onStallChange),this.mpPlayer.on("fragmentLoad",this.onFragmentLoad),this.sonarClientSDK.on("bufferFullnessMetricsRequestEvent",this.reportBufferFullness),this.sonarClientSDK.on("droppedVideoFramesRequestEvent",this.handleDroppedFrameRequestEvent),this.sonarClientSDK.on("sonarNotificationReportEvent",this.handleSonarNotificationReportEvent),this.playbackQualityProvider=this.mpPlayer.getPlaybackQualityProvider(),this.isInitialized=!0)}),e.prototype.uninitialize=freeOnUnref(function(){this.mpPlayer.off("contentStateChange",this.onContentStateChange),this.mpPlayer.off("playbackStateChange",this.onPlaybackStateChange),this.mpPlayer.off("stall",this.onStallChange),this.mpPlayer.off("fragmentLoad",this.onFragmentLoad),this.sonarClientSDK.off("bufferFullnessMetricsRequestEvent",this.reportBufferFullness),this.sonarClientSDK.off("droppedVideoFramesRequestEvent",this.handleDroppedFrameRequestEvent),this.sonarClientSDK.off("sonarNotificationReportEvent",this.handleSonarNotificationReportEvent),this.contentUnloaded(),this.playbackQualityProvider=null,this.isInitialized=!1}),e.prototype.contentUnloaded=freeOnUnref(function(){this.removeContentSource(),this.isPlaybackStarted=!1,this.titleId=""}),e.prototype.setContentSource=freeOnUnref(function(e){this.removeContentSource(),this.setStreamingType(e),this.isInitialized&&e instanceof nf.LiveLowLatencyContentSource&&(this.liveLowLatencyContentSource=e,this.sonarClientSDK.on("syeMetricsRequestEvent",this.handleSyeMetricsRequestEvent))}),e.prototype.removeContentSource=freeOnUnref(function(){this.streamingType="DASH",null!=this.liveLowLatencyContentSource&&(this.liveLowLatencyContentSource=void 0,this.sonarClientSDK.off("syeMetricsRequestEvent",this.handleSyeMetricsRequestEvent))}),e.prototype.handleFragmentAcquisitionSuccessEvent=freeOnUnref(function(e,t){var n=this.getAssetTypeFromStreamType(e.type);if(void 0!==n){var r=new IA.FragmentAcquisitionEvent(e.latencyMs,e.totalBytes,e.totalMs,e.bitrateBps,null!=e.fragmentResolution?e.fragmentResolution.width:void 0,null!=e.fragmentResolution?e.fragmentResolution.height:void 0,n,Date.now(),t,e.maxBitrateBitsPerSec,e.url);this.sonarClientSDK.reportEvent(r)}}),e.prototype.handleFragmentAcquisitionFailure=freeOnUnref(function(e){var t=this.getAssetTypeFromStreamType(e.type);if(void 0!==t){var n=new IA.FragmentAcquisitionFailureEvent(e.url,t,e.bitrateBps,e.expectedBytes||0,Date.now());this.sonarClientSDK.reportEvent(n)}}),e.prototype.handleManifestFetchedEvent=freeOnUnref(function(){var e=new IA.ManifestAcquisitionEvent(Date.now());this.sonarClientSDK.reportEvent(e)}),e.prototype.handleManifestAcquisitionFailure=freeOnUnref(function(e){var t=e.error,n="Unknown";if(null!=t&&"ParseError"===t.reason.type&&t.reason.cause instanceof ct.XpError){var r=t.reason.cause.code;"manifest.stale"===r?n="StaleManifest":"manifest.negative"===r&&(n="NegativeManifest")}var i=new IA.ManifestAcquisitionFailureEvent(Date.now(),n);this.sonarClientSDK.reportEvent(i)}),e.prototype.reportPlaybackRestart=freeOnUnref(function(e){var t=new IA.PlaybackRestartEvent(e);this.sonarClientSDK.reportEvent(t)}),e.prototype.reportOriginFailover=freeOnUnref(function(){this.reportPlaybackRestart("originFailover")}),e.prototype.updateConsumptionId=freeOnUnref(function(e){var t=this.consumptionId,n=e;this.consumptionId=e,this.sonarClientSDK.reportEvent(new IA.ConsumptionIdUpdateEvent(t,n))}),e.prototype.updateVideoMaterialType=freeOnUnref(function(e){this.videoMaterialType=e}),e.prototype.updateTitleId=freeOnUnref(function(e){this.titleId=e}),e.prototype.playbackStarted=freeOnUnref(function(){this.isPlaybackStarted=!0,i.info("Reporting Playback Start event");var e=this.playlistEngine.getCurrentItem(),t=void 0;if(null!=e&&e.sourceUrlStore instanceof GS.PlaybackUrlsSourceUrlStore){var n=e.sourceUrlStore;t=this.adaptPlaybackUrls(n.getPlaybackUrls())}this.sonarClientSDK.reportEvent(new IA.PlaybackStartedEvent(Date.now(),this.consumptionId,this.titleId,this.videoMaterialType,this.streamingType,t))}),e.prototype.playbackEnded=freeOnUnref(function(){this.isPlaybackStarted=!1,i.info("Reporting Playback End event"),this.sonarClientSDK.reportEvent(new IA.PlaybackEndedEvent(Date.now()))}),e.prototype.setStreamingType=freeOnUnref(function(e){this.isInitialized&&(e instanceof nf.LiveLowLatencyContentSource?this.streamingType="SYE":e instanceof Nc.SafariHlsContentSource?this.streamingType="HLS":this.streamingType="DASH")}),e.prototype.getAssetTypeFromStreamType=freeOnUnref(function(e){switch(e){case"Video":return"Video";case"Audio":return"Audio";default:return}}),e.prototype.adaptPlaybackUrls=freeOnUnref(function(r){var i={defaultUrlSetId:r.defaultUrlSetId,urlSets:{}};return Object.keys(r.urlSets).forEach(freeOnUnref(function(e){var t=r.urlSets[e],n={urlSetId:e,origin:t.urls.manifest.origin,manifestUrl:t.urls.manifest.url,cdnName:t.urls.manifest.cdn,cdnFailoverUrlSetId:null!=t.failover.cdn?t.failover.cdn.urlSetId:""};i.urlSets[e]=n})),i}),e})();t.SonarEventAdapter=n}));e(kA);kA.SonarEventAdapter;var _A=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("SonarMitigationAdapter"),n=freeOnUnref(function(){function e(e,t){var n=this;this.handleSwitchCdnEvent=freeOnUnref(function(e){s.info("Received Sonar Switch CDN Event"),n.processCdnSwitch(e)}),this.sonarClientSDK=e,this.playlistEngine=t}return e.prototype.initialize=freeOnUnref(function(){this.sonarClientSDK.on("sonarSwitchCdnEvent",this.handleSwitchCdnEvent)}),e.prototype.uninitialize=freeOnUnref(function(){this.sonarClientSDK.off("sonarSwitchCdnEvent",this.handleSwitchCdnEvent)}),e.prototype.processCdnSwitch=freeOnUnref(function(e){var t=this.playlistEngine.getCurrentItem();if(null!=t&&t.sourceUrlStore instanceof GS.PlaybackUrlsSourceUrlStore){var n=t.sourceUrlStore,r=e.getDestinationUrlSetId(),i=n.get().urlId,o=Object.keys(n.getPlaybackUrls().urlSets);if(null==r)n.failover("cdn",HS.FailoverCase.SonarInducedCdnSwitch,null);else if(-1===o.indexOf(r))s.info("Skipping CDN switching as the destination URL: "+r+" does not exist in playbackurls");else if(r!==i){var a={mode:"seamless",urlSetId:r};n.failover("cdn",HS.FailoverCase.SonarInducedCdnSwitch,a)}else s.info("Skipping CDN switching. Current URL is same as the destination URL: "+r)}}),e})();t.SonarMitigationAdapter=n}));e(_A);_A.SonarMitigationAdapter;var RA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.playerInstanceId=Vy.UUID.v4(),this.watchSessionId=Vy.UUID.v4(),this.stashedWatchSessionId=null}return e.prototype.updatePlayerInstanceId=freeOnUnref(function(){this.playerInstanceId=Vy.UUID.v4()}),e.prototype.updateWatchSessionId=freeOnUnref(function(){this.watchSessionId=Vy.UUID.v4()}),e.prototype.updateStashedWatchSessionId=freeOnUnref(function(){this.stashedWatchSessionId=this.watchSessionId}),e.prototype.getWatchSessionId=freeOnUnref(function(){return this.watchSessionId}),e.prototype.getStashedWatchSessionId=freeOnUnref(function(){return null==this.stashedWatchSessionId?this.watchSessionId:this.stashedWatchSessionId}),e.prototype.resetStashedWatchSessionId=freeOnUnref(function(){this.stashedWatchSessionId=null}),e.prototype.getPlayerInstanceId=freeOnUnref(function(){return this.playerInstanceId}),e})();t.SessionIdTracker=n}));e(RA);RA.SessionIdTracker;var AA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.videoQuality=e}return e.prototype.getValue=freeOnUnref(function(){return lt.Promise.resolve(this.videoQuality)}),e})();t.TemporaryVideoQualityOverride=n}));e(AA);AA.TemporaryVideoQualityOverride;var DA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this._isAutoplaySession=!1,this.updateCallback=new A.MulticastCallback}return e.prototype.setAutoplaySession=freeOnUnref(function(e){e!==this._isAutoplaySession&&(this._isAutoplaySession=e,this.updateCallback.invoke())}),e.prototype.isAutoplaySession=freeOnUnref(function(){return this._isAutoplaySession}),e.prototype.reset=freeOnUnref(function(){this._isAutoplaySession=!1}),e.prototype.onUpdate=freeOnUnref(function(e){this.updateCallback.add(e)}),e.prototype.offUpdate=freeOnUnref(function(e){this.updateCallback.remove(e)}),e})();t.SessionEngagementTracker=n}));e(DA);DA.SessionEngagementTracker;var xA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=de.get("StartOfAiringSeekInterceptor"),n=freeOnUnref(function(){return function(e){var i=this;this.getNewSeekTarget=freeOnUnref(function(e,t){var n=i.playlistEngine.getItems()[t],r=null!=n.liveScheduleTitleId||null!=n.liveScheduleChannelID;return null!=n.start&&r&&e>=n.start&&e<n.start+2e3&&(e=n.start+2e3,o.info("Detected a seek too close to the start of the playlist item, setting seek position to "+e+"ms")),{newPosition:e,newItemIndex:t}}),this.playlistEngine=e}})();t.StartOfAiringSeekInterceptor=n}));e(xA);xA.StartOfAiringSeekInterceptor;var FA=t(freeOnUnref(function(e,t){var a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});function r(e,t){for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];"Mandatory"===o.type&&null==o.language?null!=t&&n.push(a({},o,{language:t})):n.push(o)}return null!=t&&n.push({language:t,type:"Mandatory"}),n}Object.defineProperty(t,"__esModule",{value:!0}),t.extendMandatoryTimedTextMatchers=r,t.selectStaticTimedTextStream=function(e,t,n){return Jl.selectStream(e,r(t,n))}}));e(FA);FA.extendMandatoryTimedTextMatchers,FA.selectStaticTimedTextStream;var BA=t(freeOnUnref(function(e,t){var n,r,i,o=ce&&ce.__assign||freeOnUnref(function(){return(o=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var a=((n={}).Hdcp="Hdcp",n.RendererCapability="RendererCapability",n),s=((r={}).Audio="Audio",r.TimedText="TimedText",r.Video="Video",r),l=freeOnUnref(function(){function r(){}return r.transformToPublicStreamRestriction=freeOnUnref(function(e){return r.streamRestrictionExtenderMap[e.restrictionType](e)}),r.transformToPublicStreamRestrictionType=freeOnUnref(function(e){return a[e]}),r.transformToPublicHdcpStreamRestriction=freeOnUnref(function(e){var t=r.transformToPublicBaseStreamRestriction(e),n={hdcpEnforcementResolutionPixels:e.hdcpEnforcementResolutionPixels};return o({},t,n)}),r.transformToPublicRendererStreamRestriction=freeOnUnref(function(e){return r.transformToPublicBaseStreamRestriction(e)}),r.transformToPublicBaseStreamRestriction=freeOnUnref(function(e){return{streamType:s[e.streamType],restrictionType:a[e.restrictionType]}}),r.streamRestrictionExtenderMap=((i={}).Hdcp=r.transformToPublicHdcpStreamRestriction,i.RendererCapability=r.transformToPublicRendererStreamRestriction,i),r})();t.StreamRestrictionTransformer=l}));e(BA);BA.StreamRestrictionTransformer;var LA=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(){function i(){}return i.isQualityRestricted=freeOnUnref(function(e,t){var n=t.restrictionType,r=i.restrictionCheckerMap[n];return null!=r&&r(e,t)}),i.isQualityHdcpRestricted=freeOnUnref(function(e,t){return null==e.height||null==e.width||e.height*e.width>t.hdcpEnforcementResolutionPixels}),i.isQualityRendererRestricted=freeOnUnref(function(e,t){if(null==e.height||null==e.frameRate)return!0;var n,r=In.stringToNumber(e.frameRate);if(isNaN(r))return!0;switch(n=1080<e.height?"UHD":480<e.height?"HD":"SD",t.videoQualityToMaxSupportedFrameRate[n]){case"HFR":return!1;case"SFR":return 30<r;case null:return!0}}),i.restrictionCheckerMap=((n={}).Hdcp=i.isQualityHdcpRestricted,n.RendererCapability=i.isQualityRendererRestricted,n),i})();t.RestrictionChecker=r}));e(LA);LA.RestrictionChecker;var NA=t(freeOnUnref(function(e,t){var n,r,s=ce&&ce.__assign||freeOnUnref(function(){return(s=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("VariantTransformer"),f=((n={}).stpp="TTMLv1",n.dfxp="TTMLv1",n.wvtt="WebVTT",n),o=null,u=0,c=0,i=freeOnUnref(function(){function a(){}return a.transformToPublicVariant=freeOnUnref(function(e,t,n){if(void 0===n&&(n=[]),"Image"===t.type)throw new Error("Unsupported quality level of stream type: Image");return a.variantExtenderMap[t.type](e,t,n)}),a.transformToPublicAudioVariant=freeOnUnref(function(e,t,n){var r=a.transformToPublicBaseVariant(e,t,n);return s({},r,{channelConfiguration:""})}),a.transformToPublicTimedTextVariants=freeOnUnref(function(e,t,n){var r=a.transformToPublicBaseVariant(e,t,n),i=e.codecs.substring(0,4);if(null==f[i])return l.error("Unknown TimedText codecs string ("+e.codecs+")."),r;var o={format:f[i]};return s({},r,o)}),a.transformToPublicVideoVariants=freeOnUnref(function(e,t,n){var r=a.transformToPublicBaseVariant(e,t,n),i={frameRate:Qe.withDefault(e.frameRate,o),height:Qe.withDefault(e.height,u),width:Qe.withDefault(e.width,c)};return s({},r,i)}),a.transformToPublicBaseVariant=freeOnUnref(function(t,e,n){return{id:e.id+"_"+t.id,bitrate:t.bandwidth,codecs:t.codecs,restrictions:n.filter(freeOnUnref(function(e){return LA.RestrictionChecker.isQualityRestricted(t,e)})).map(freeOnUnref(function(e){return BA.StreamRestrictionTransformer.transformToPublicStreamRestrictionType(e.restrictionType)}))}}),a.variantExtenderMap=((r={}).Audio=a.transformToPublicAudioVariant,r.TimedText=a.transformToPublicTimedTextVariants,r.Video=a.transformToPublicVideoVariants,r),a})();t.VariantTransformer=i}));e(NA);NA.VariantTransformer;var VA=t(freeOnUnref(function(e,t){var n,r,i,o,a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var s=((n={}).Commentary="Commentary",n.Descriptive="Descriptive",n.Dialog="Dialog",n.BoostedDialogLow="BoostedDialogLow",n.BoostedDialogMedium="BoostedDialogMedium",n.BoostedDialogHigh="BoostedDialogHigh",n.FilteredContent="FilteredContent",n.DialogMachineGenerated="DialogMachineGenerated",n),l=((r={}).Subtitle="Subtitle",r.Mandatory="Mandatory",r.Caption="Caption",r.MachineGenerated="MachineGenerated",r.SDH="SDH",r.Audio="Audio",r),f=((i={}).Commentary="Commentary",i.Descriptive="Descriptive",i.Dialog="Dialog",i.FilteredContent="FilteredContent",i),u=freeOnUnref(function(){function i(){}return i.transformToPublicStream=freeOnUnref(function(e,t){if(void 0===t&&(t=[]),"Image"===e.type)throw new Error("Unsupported stream type: Image");return i.STREAM_EXTENDER_MAP[e.type](e,t)}),i.transformToPublicAudioStream=freeOnUnref(function(e,t){var n=i.transformToPublicBaseStream(e,t),r={language:Qe.withDefault(e.language,""),type:Qe.withDefault(s[e.subtype],null),label:Qe.withDefault(e.label,null)};return a({},n,r)}),i.transformToPublicTimedTextStream=freeOnUnref(function(e,t){var n=i.transformToPublicBaseStream(e,t),r={language:Qe.withDefault(e.language,""),type:Qe.withDefault(l[e.textType],null),subtype:Qe.withDefault(f[e.subtype],null),label:Qe.withDefault(e.label,null)};return a({},n,r)}),i.transformToPublicVideoStreams=freeOnUnref(function(e,t){var n=i.transformToPublicBaseStream(e,t);return a({},n,{})}),i.transformToPublicBaseStream=freeOnUnref(function(t,n){return{id:i.getPublicStreamId(t),variants:t.qualityLevels.map(freeOnUnref(function(e){return NA.VariantTransformer.transformToPublicVariant(e,t,n)})),activeVariantId:null}}),i.getPublicStreamId=freeOnUnref(function(e){return null!=e.baseId?e.baseId:e.id}),i.STREAM_EXTENDER_MAP=((o={}).Audio=i.transformToPublicAudioStream,o.TimedText=i.transformToPublicTimedTextStream,o.Video=i.transformToPublicVideoStreams,o),i})();t.StreamTransformer=u}));e(VA);VA.StreamTransformer;var jA=t(freeOnUnref(function(e,t){var n,r,i,o,a,d=ce&&ce.__assign||freeOnUnref(function(){return(d=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var p=de.get("XpPlayerStreamFeatureV1"),O=((n={}).Audio={type:"Audio",streams:[],activeId:null},n.TimedText={type:"TimedText",streams:[],activeId:null},n.Video={type:"Video",streams:[],activeId:null},n),h=((r={}).Audio=[],r.TimedText=[],r.Video=[],r),S=((i={}).Audio="Audio",i.TimedText="TimedText",i.Video="Video",i),m=((o={}).Audio=null,o.TimedText=null,o.Video=null,o),y=((a={}).Audio="Audio",a.TimedText="TimedText",a.Video="Video",a),s=freeOnUnref(function(){function e(e,t,n){var u=this;this.version="0.0.1",this.objectId="XpPlayer-Stream-"+Math.random(),this.capabilities={},this.streamGroups=$t(!0,{},O),this.streamRestrictions={},this.activePublicStreamIds=x.clone(m),this.activePublicVariantIds=x.clone(m),this.cancelStaticTimedTextResolution=null,this.currentPeriodId={},this.currentPlaylistItem=null,this.maxBitrateThresholds={},this.qualityLevelHandlers={},this.shouldUseStaticTimedText=!1,this.streamEventEventEmitter=new A.EventEmitter,this.streamMatchers={},this.streamRestrictionsByStreamType=$t(!0,{},h),this.typeMatchers={},this.unsupportedCodecs={},this.onStreamQualityChange=freeOnUnref(function(e,t){null!==t?(u.currentPeriodId[t.type]!==t.periodId&&(u.currentPeriodId[t.type]=t.periodId,u.debugLoggingForTimedText("onStreamQualityChange -> createStreamGroups"),u.createStreamGroups(t)),u.processStreamQualityChange(t),"Audio"===e&&u.tryEmitStaticTimedText()):u.processDisabledStreamQualityChange(e)}),this.stripActiveVariantIdAndRestrictions=freeOnUnref(function(e){var t=x.clone(e);return delete t.activeVariantId,t.variants=t.variants.map(u.stripRestrictions),t}),this.stripRestrictions=freeOnUnref(function(e){var t=x.clone(e);return t.restrictions=[],t}),this.onStreamGroupChange=freeOnUnref(function(e){var t;u.debugLoggingForTimedText("onStreamGroupChange called with streamGroup "+JSON.stringify(e)+".");var n=d({},u.streamGroups,((t={})[y[e.type]]=e,t));u.debugLoggingForTimedText("onStreamGroupChange -> updateStreamGroups"),u.updateStreamGroups(n),u.setActivePublicStreamId(y[e.type],e.activeId)}),this.onPlaylistUpdate=freeOnUnref(function(){u.currentPlaylistItem=u.playlistEngine.getCurrentItem(),null===u.currentPlaylistItem&&(u.debugLoggingForTimedText("onPlaylistUpdate -> updateStreamGroups"),u.updateStreamGroups($t(!0,{},O)))}),this.onEnterItem=freeOnUnref(function(e){null!==u.currentPlaylistItem&&null!=u.currentPlaylistItem.contentSource&&u.currentPlaylistItem.contentSource.off("streamRestrictionChange",u.onStreamRestrictionChange),null!=e.item&&null!=e.item.initializeContentCallback?e.item.initializeContentCallback().then(freeOnUnref(function(){u.cancelToken.throwIfRequested(),u.onCurrentItemChange()})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||p.error("Error happened when processing a deferred content",e)})):u.onCurrentItemChange()}),this.onStreamRestrictionChange=freeOnUnref(function(e){if(u.updateStreamRestriction(e.streamType,e.restrictions),null!==u.playbackQualityProvider){var t=u.playbackQualityProvider.getCurrentQualityInfo(e.streamType);null!=t&&(u.debugLoggingForTimedText("onStreamRestrictionChange -> createStreamGroups"),u.createStreamGroups(t),u.processStreamQualityChange(t))}}),this.onTextTrackCue=freeOnUnref(function(e){var t=u.getCueTimelineItemIndex(e),n=u.getActiveStream("TimedText"),r=u.findPublicStreamFromCue(e),i=r;if(null!=t&&null!=n){if(null==i)i=n.id;else if(n.id!==r)return;var o=u.playlistEngine.getItems()[t],a=u.streamEventEventEmitter.listeners("TimedTextStreamData");if(null!=o&&!x.isEmpty(a)){var s=o.start-o.timelineStart,l=YU.translateXpPlaylistIndexToClientTimelineIndex(t,u.playlistEngine),f={data:e.data,timestampOffsetMs:-e.timeOffsetMs+o.start,startPosition:e.startMs-s,endPosition:e.endMs-s,timelineItemIndex:l,retainableRanges:u.getTimedTextContentRanges(),contentId:s_.createTimelineContentId(o)};u.streamEventEventEmitter.emit("TimedTextStreamData",i,f)}}}),this.mpPlayer=e,this.playlistEngine=t,this.playbackQualityProvider=this.mpPlayer.getPlaybackQualityProvider(),this.staticTimedTextDataStore=n;var r=L.configurationStore.configuration;this.shouldUseStaticTimedText=null!=r&&null!=r.prs&&!1===r.prs.enableEmbeddedTimedTextForVod,this.debugLoggingForTimedText("Setting shouldUseStaticTimedText to "+this.shouldUseStaticTimedText+" in constructor.");var i=lt.CancelToken.source(),o=i.token,a=i.cancel;this.cancelFunction=a,this.cancelToken=o;for(var s=freeOnUnref(function(t){l.qualityLevelHandlers[t]=freeOnUnref(function(e){u.onStreamQualityChange(t,e)})}),l=this,f=0,c=Object.keys(vu.MediaRepresentationStreamTypeMap);f<c.length;f++){s(c[f])}}return e.prototype.initialize=freeOnUnref(function(){if(this.playlistEngine.on("EnterItem",this.onEnterItem),this.playlistEngine.on("PlaylistUpdate",this.onPlaylistUpdate),this.mpPlayer.textTrack.on("newcue",this.onTextTrackCue),null!==this.playbackQualityProvider){this.playbackQualityProvider.onStreamGroupChange(this.onStreamGroupChange);for(var e=0,t=Object.keys(vu.MediaRepresentationStreamTypeMap);e<t.length;e++){var n=t[e],r=this.qualityLevelHandlers[n];null!=r&&this.playbackQualityProvider.on(vu.MediaRepresentationStreamTypeMap[n],"qualityLevel",r)}}}),e.prototype.terminate=freeOnUnref(function(){if(this.cancelFunction(),this.unload(),this.playlistEngine.off("EnterItem",this.onEnterItem),this.playlistEngine.off("PlaylistUpdate",this.onPlaylistUpdate),this.mpPlayer.textTrack.off("newcue",this.onTextTrackCue),null!==this.playbackQualityProvider){this.playbackQualityProvider.offStreamGroupChange(this.onStreamGroupChange);for(var e=0,t=Object.keys(vu.MediaRepresentationStreamTypeMap);e<t.length;e++){var n=t[e],r=this.qualityLevelHandlers[n];null!=r&&this.playbackQualityProvider.off(vu.MediaRepresentationStreamTypeMap[n],"qualityLevel",r)}}this.currentPeriodId={}}),e.prototype.configure=freeOnUnref(function(e){if(null!=e.preferredStreamMatchers)for(var t=0,n=Object.keys(e.preferredStreamMatchers);t<n.length;t++){var r=n[t];this.setStreamMatchers(r,e.preferredStreamMatchers[r])}}),e.prototype.unload=freeOnUnref(function(){this.activePublicStreamIds=x.clone(m),this.activePublicVariantIds=x.clone(m),null!==this.currentPlaylistItem&&null!=this.currentPlaylistItem.contentSource&&this.currentPlaylistItem.contentSource.off("streamRestrictionChange",this.onStreamRestrictionChange)}),e.prototype.setMaxBitrateThreshold=freeOnUnref(function(e,t){if("Video"!==e)throw new Error("Unsupported streamType '"+e+"' for setMaxBitrateThreshold");null===t&&(t=1/0),p.info(">> setMaxBitrateThreshold set for "+e+" to "+t+" bits/sec"),t===1/0?delete this.maxBitrateThresholds[e]:this.maxBitrateThresholds[e]=t;for(var n=this.getMediaRepresentationStreamType(e),r=0,i=this.getAllUniqueContentSources();r<i.length;r++){i[r].setMaxBitrateThreshold(n,"External",t)}}),e.prototype.setMaxResolution=freeOnUnref(function(e,t){for(var n=0,r=this.getAllUniqueContentSources();n<r.length;n++){r[n].setMaxResolution(e,t)}}),e.prototype.setStreamMatchers=freeOnUnref(function(e,t,n){x.isArray(t)||(t=[]);for(var r=0,i=t;r<i.length;r++){var o=i[r];null!=o.language&&"string"!=typeof o.language&&(p.warn("Removing invalid StreamMatcher.language '"+o.language+"'"),delete o.language)}p.info(">> setStreamMatchers("+e+", "+JSON.stringify(t)+"), "+JSON.stringify(n));var a=this.getMediaRepresentationStreamType(e),s=Jl.expandCustomMatcherLanguages(t);if("TimedText"===e){var l=this.getActiveStream("Audio");s=FA.extendMandatoryTimedTextMatchers(s,null!=l?l.language:void 0)}this.typeMatchers[a]=s.map(freeOnUnref(function(e){return vu.StreamMatcherTransformer.convertStreamMatcherToTypeMatcher(a,e)})),this.streamMatchers[e]=s;for(var f=0,u=this.getAllUniqueContentSources();f<u.length;f++){u[f].setStreamMatchers(a,this.typeMatchers[a],null!=n&&!0===n.seamless)}"TimedText"===e&&this.tryEmitStaticTimedText()}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(e,t){if("Audio"!==e)throw new Error("Unsupported streamType '"+e+"' for setUnsupportedCodecs");p.info(">> setUnsupportedCodecs set for "+e+" with "+JSON.stringify(t)+" codecs"),0===t.length?delete this.unsupportedCodecs[e]:this.unsupportedCodecs[e]=t;for(var n=this.getMediaRepresentationStreamType(e),r=0,i=this.getAllUniqueContentSources();r<i.length;r++){i[r].setUnsupportedCodecs(n,t)}}),e.prototype.on=freeOnUnref(function(e,t){this.streamEventEventEmitter.on(e,t),"TimedTextStreamData"===e&&this.tryEmitStaticTimedText()}),e.prototype.once=freeOnUnref(function(e,t){this.streamEventEventEmitter.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.streamEventEventEmitter.off(e,t)}),e.prototype.getCurrentResolution=freeOnUnref(function(){return null===this.playbackQualityProvider?null:this.playbackQualityProvider.getCurrentResolution()}),e.prototype.getCurrentMatchers=freeOnUnref(function(){return d({},this.typeMatchers)}),e.prototype.getCurrentMaxBitrateThresholds=freeOnUnref(function(){return this.maxBitrateThresholds}),e.prototype.getCurrentUnsupportedCodecs=freeOnUnref(function(){return this.unsupportedCodecs}),e.prototype.emitTimedTextAcquisitionSuccess=freeOnUnref(function(e){this.streamEventEventEmitter.emit("TimedTextAcquisitionSucceed",e)}),e.prototype.toJSON=freeOnUnref(function(){return{version:this.version,objectId:this.objectId,capabilities:this.capabilities,streamGroups:this.streamGroups,streamRestrictions:this.streamRestrictions}}),e.prototype.tryEmitStaticTimedText=freeOnUnref(function(){var n=this;if(null!==this.currentPlaylistItem&&!1!==this.shouldUseStaticTimedText){var e=this.streamEventEventEmitter.listeners("TimedTextStreamData");if(x.isEmpty(e))p.info("No TimedTextStreamData listeners");else{null!=this.cancelStaticTimedTextResolution&&(this.cancelStaticTimedTextResolution(),this.cancelStaticTimedTextResolution=null);var r=this.getCurrentStaticTimedTextStream();if(null!==r){var t=this.playlistEngine.getCurrentItemIndex(),i=this.playlistEngine.getCurrentItem();if(null==t||null==i)throw new Error("timelineItemIndex is null");var o=lt.CancelToken.source(),a=o.token,s=o.cancel;this.cancelStaticTimedTextResolution=s;var l=i.timelineStart,f=i.timelineEnd,u=YU.translateXpPlaylistIndexToClientTimelineIndex(t,this.playlistEngine);this.staticTimedTextDataStore.getContents(r,i.downloadOperationId).then(freeOnUnref(function(e){a.requested&&(p.info('<< StaticTimedTextDataStore.getContents finished, but ignoring after cancellation. lang:"'+r.language+'", label:"'+r.label+'"'),a.throwIfRequested());var t={data:e,timestampOffsetMs:l,startPosition:l,endPosition:f,timelineItemIndex:u,retainableRanges:[{startTimeMs:l,endTimeMs:null!=f?f:1/0,timelineItemIndex:u}],contentId:s_.createTimelineContentId(i)};n.setActivePublicStreamId("TimedText",r.id),n.streamEventEventEmitter.emit("TimedTextStreamData",r.id,t),p.info('<< TimedTextStreamData (static). lang:"'+r.language+'", label:"'+r.label+'"')})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||p.error("<< StaticTimedTextDataStore.getContents error:",e)}))}else x.isEmpty(this.currentPlaylistItem.staticTimedTextStreams)||this.setActivePublicStreamId("TimedText",null)}}}),e.prototype.getActiveStream=freeOnUnref(function(e){var t=this.streamGroups[e];if(null===t.activeId)return null;var n=x.find(t.streams,freeOnUnref(function(e){return e.id===t.activeId}));return Qe.withDefault(n,null)}),e.prototype.getCurrentStaticTimedTextStream=freeOnUnref(function(){if(null===this.currentPlaylistItem)return null;var e=this.getActiveStream("Audio"),t=this.streamMatchers.TimedText;return FA.selectStaticTimedTextStream(this.currentPlaylistItem.staticTimedTextStreams,null!=t?t:[],null!=e?e.language:void 0)}),e.prototype.getMediaRepresentationStreamType=freeOnUnref(function(e){var t=vu.MediaRepresentationStreamTypeMap[e];if(null==t)throw new Error("Invalid stream type: "+e);return t}),e.prototype.createStreamGroups=freeOnUnref(function(e){if(this.debugLoggingForTimedText("createStreamGroups called with info: "+JSON.stringify(e)+"."),null!==this.currentPlaylistItem){var t=x.findWhere(this.currentPlaylistItem.mediaRepresentation.periods.contents,{id:e.periodId});if(null!=t){for(var n=$t(!0,{},O),r={Audio:[],TimedText:[],Video:[]},i=0,o=t.streams;i<o.length;i++){var a=o[i];"Image"!==a.type&&r[a.type].push(a)}for(var s=0,l=Object.keys(r);s<l.length;s++){var f=l[s],u=this.internalStreamsToPublicStreams(r[f],this.streamRestrictionsByStreamType[f]),c=S[f],d=n[c];d.streams=d.streams.concat(u),d.activeId=this.activePublicStreamIds[c]}var p=this.getStaticTimedTextStreams(this.currentPlaylistItem),h=L.configurationStore.configuration,m=null!=h&&null!=h.prs&&!1===h.prs.enableEmbeddedTimedTextForVod;this.shouldUseStaticTimedText=m||x.isEmpty(n.TimedText.streams),this.debugLoggingForTimedText("Setting shouldUseStaticTimedText to "+this.shouldUseStaticTimedText+" in createStreamGroups."),!x.isEmpty(p)&&this.shouldUseStaticTimedText&&(this.debugLoggingForTimedText("Using static timed text streams found in PRS response."),n.TimedText.streams=p),this.debugLoggingForTimedText("createStreamGroups -> updateStreamGroups"),this.updateStreamGroups(n);for(var y=0,g=Object.keys(this.streamGroups);y<g.length;y++){f=g[y];var v=this.getActiveStream(f);null!==v&&(v.activeVariantId=this.activePublicVariantIds[f])}}}}),e.prototype.processDisabledStreamQualityChange=freeOnUnref(function(e){delete this.currentPeriodId[e],this.setActivePublicStreamId(e,null),this.activePublicVariantIds[e]=null}),e.prototype.processStreamQualityChange=freeOnUnref(function(t){if(null!==this.currentPlaylistItem){var e=x.findWhere(this.currentPlaylistItem.mediaRepresentation.periods.contents,{id:t.periodId});if(null!=e){var n=x.find(e.streams,freeOnUnref(function(e){return e.id===t.streamId}));if(null!=n){var r=VA.StreamTransformer.getPublicStreamId(n);this.setActivePublicStreamId(S[t.type],r);var i=this.qualityLevelToVariantId(t);this.setActivePublicVariantId(S[t.type],i)}else p.warn("Could not find "+t.type+' stream "'+t.streamId+'"')}}}),e.prototype.setActivePublicStreamId=freeOnUnref(function(e,t){var n=this.activePublicStreamIds[e];this.activePublicStreamIds[e]=t,n!==(this.streamGroups[e].activeId=t)&&(this.streamEventEventEmitter.emit("ActiveStreamChange",e,t),"TimedText"===e&&this.emitStoredCuesForNewStream(t),p.info("["+e+'] ActiveStreamChange: "'+n+'" to "'+t+'"'))}),e.prototype.emitStoredCuesForNewStream=freeOnUnref(function(e){for(var t=this.mpPlayer.textTrack.cues,n=0;n<t.length;n++){var r=t[n],i=this.findPublicStreamFromCue(r);null!=i&&i===e&&this.onTextTrackCue(r)}}),e.prototype.findPublicStreamFromCue=freeOnUnref(function(t){var e=this.getCueTimelineItemIndex(t);if(null!=e){var n=this.playlistEngine.getItems()[e];if(null!==n&&null!=n.mediaRepresentation&&null!=n.mediaRepresentation.periods){var r=x.findWhere(n.mediaRepresentation.periods.contents,{id:t.periodId});if(null!=r){var i=x.find(r.streams,freeOnUnref(function(e){return e.id===t.streamId}));if(null!=i)return VA.StreamTransformer.getPublicStreamId(i)}}}}),e.prototype.setActivePublicVariantId=freeOnUnref(function(e,t){var n=this.getActiveStream(e);if(null!==n){var r=this.activePublicVariantIds[e];this.activePublicVariantIds[e]=t,r!==(n.activeVariantId=t)&&(this.streamEventEventEmitter.emit("ActiveVariantChange",e,this.activePublicStreamIds[e],t),p.enabledFor(de.DEBUG)&&p.info("["+e+'] ActiveVariantChange: "'+r+'" to "'+t+'".'))}else p.warn("Attempted to set active variant for "+e+" without an active stream")}),e.prototype.qualityLevelToVariantId=freeOnUnref(function(e){return e.streamId+"_"+e.qualityLevelId}),e.prototype.updateStreamGroups=freeOnUnref(function(e){this.debugLoggingForTimedText("updateStreamGroups called with newStreamGroups: "+JSON.stringify(e)+".");for(var t=0,n=Object.keys(S);t<n.length;t++){var r=n[t],i=this.streamGroups[r],o=e[r],a=i.streams.map(this.stripActiveVariantIdAndRestrictions),s=o.streams.map(this.stripActiveVariantIdAndRestrictions);if(!x.isEqual(a,s))if(this.streamEventEventEmitter.emit("StreamGroupChange",S[r],o.streams),p.enabledFor(de.DEBUG))p.info("["+r+"] StreamGroupChange. New streams: "+JSON.stringify(o.streams));else if(p.enabledFor(de.INFO)){var l=o.streams.map(freeOnUnref(function(e){return e.id}));p.info("["+r+"] StreamGroupChange. New streams: "+JSON.stringify(l))}}this.streamGroups=e}),e.prototype.onCurrentItemChange=freeOnUnref(function(){if(this.currentPlaylistItem=this.playlistEngine.getCurrentItem(),null!=this.playbackQualityProvider){null!==this.currentPlaylistItem&&null!=this.currentPlaylistItem.contentSource&&this.currentPlaylistItem.contentSource.on("streamRestrictionChange",this.onStreamRestrictionChange),this.currentPeriodId={};for(var e=0,t=Object.keys(S);e<t.length;e++){var n=t[e],r=this.playbackQualityProvider.getCurrentQualityInfo(n);null!=r&&(this.debugLoggingForTimedText("onCurrentItemChange -> createStreamGroups"),this.createStreamGroups(r),this.processStreamQualityChange(r))}this.tryEmitStaticTimedText()}}),e.prototype.getStaticTimedTextStreams=freeOnUnref(function(e){return null===e?[]:e.staticTimedTextStreams.map(freeOnUnref(function(e){var t=e.variants.map(freeOnUnref(function(e){return{id:e.id,format:e.format,restrictions:[]}}));return d({},e,{variants:t})}))}),e.prototype.internalStreamsToPublicStreams=freeOnUnref(function(e,t){void 0===t&&(t=[]);for(var n={},r=0,i=e.map(freeOnUnref(function(e){return VA.StreamTransformer.transformToPublicStream(e,t)}));r<i.length;r++){var o=i[r];null!=n[o.id]?n[o.id].push(o):n[o.id]=[o]}for(var a=[],s=0,l=Object.keys(n);s<l.length;s++){for(var f=[],u=n[l[s]],c=0,d=u;c<d.length;c++){var p=d[c];f=f.concat(p.variants)}a.push(x.extend(u[0],{variants:f}))}return a}),e.prototype.updateStreamRestriction=freeOnUnref(function(e,t){var n=this.streamRestrictionsByStreamType[e];if(!x.isEqual(n,t)){this.streamRestrictionsByStreamType[e]=t;for(var r=S[e],i=t.map(freeOnUnref(function(e){return BA.StreamRestrictionTransformer.transformToPublicStreamRestriction(e)})),o=0,a=i;o<a.length;o++){var s=a[o];this.streamRestrictions[s.restrictionType]=s}this.streamEventEventEmitter.emit("StreamGroupRestrictionChange",r,i),p.enabledFor(de.DEBUG)&&p.info("["+r+"] StreamGroupRestrictionChange. New restrictions: "+JSON.stringify(i))}}),e.prototype.getCueTimelineItemIndex=freeOnUnref(function(e){var t=this.playlistEngine.getItems(),n=this.playlistEngine.getCurrentItem();if(null==n)return null;for(var r=0;r<t.length;r++){var i=t[r];if(i.start-100<=e.startMs&&n.titleId===i.titleId&&(null==i.end||e.startMs<i.end-100))return r}return null}),e.prototype.getAllUniqueContentSources=freeOnUnref(function(){for(var e=[],t=0,n=this.playlistEngine.getItems();t<n.length;t++){var r=n[t];null!=r.contentSource&&-1===e.indexOf(r.contentSource)&&e.push(r.contentSource)}return e}),e.prototype.getTimedTextContentRanges=freeOnUnref(function(){var e=this.mpPlayer.textTrack.cues;if(0===e.length)return[];var t=[],n=this.getCueTimelineItemIndex(e[0]),r=this.getCueTimelineItemIndex(e[e.length-1]),i=this.playlistEngine.getItems();if(null==n||null==r||0===i.length)return[];for(var o=i[n],a=o.start-o.timelineStart,s=i[r],l=s.start-s.timelineStart,f=e[0].startMs-a,u=e[e.length-1].endMs-l,c=n;c<=r;++c){var d=i[c],p=d.timelineStart,h=null!=d.timelineEnd?d.timelineEnd:1/0;if(u<p)break;var m={startTimeMs:Math.max(f,p),endTimeMs:Math.min(u,h),timelineItemIndex:c};t.push(m)}return t}),e.prototype.debugLoggingForTimedText=freeOnUnref(function(e){p.enabledFor(de.DEBUG)&&p.info(e)}),e})();t.XpPlayerStreamFeatureV1=s}));e(jA);jA.XpPlayerStreamFeatureV1;var qA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){this.intervals=[]}return e.prototype.addOrReplace=freeOnUnref(function(e,t,n){var r=this.getWithExact(e);0<=r?this.intervals[r]={start:e,end:t,item:n}:this.add(e,t,n)}),e.prototype.get=freeOnUnref(function(e){for(var t=0,n=this.intervals.length-1,r=null;t<=n;){var i=Math.floor((t+n)/2),o=this.intervals[i];o.start<=e?(e<=o.end&&(r=o.item),t=i+1):n=i-1}return r}),e.prototype.add=freeOnUnref(function(e,t,n){this.intervals.push({start:e,end:t,item:n}),this.intervals.sort(freeOnUnref(function(e,t){return e.start-t.start}))}),e.prototype.getWithExact=freeOnUnref(function(t){return Pn.binarySearchIndexOf(this.intervals,freeOnUnref(function(e){return t-e.start}))}),e})();t.TimeWindowStore=n}));e(qA);qA.TimeWindowStore;var HA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("TimedTextFeature"),i={type:"TimedText",streams:[],activeId:null},r=freeOnUnref(function(){function e(e,t,n){var r=this;this.streamRestrictions={},this.timeWindowCues=new qA.TimeWindowStore,this.streamGroups=i,this.isStarted=!1,this.currentActiveCueRange=null,this.onTextTrackCue=freeOnUnref(function(e){r.processCue(e)}),this.onTimeUpdate=freeOnUnref(function(e){if(!(null!=r.currentActiveCueRange&&r.currentActiveCueRange.start<=e.positionMs&&e.positionMs<=r.currentActiveCueRange.end)){var t=r.timeWindowCues.get(e.positionMs);null!=t?r.emitTimedTextData(t):r.currentActiveCueRange=null}}),this.mpPlayer=e,this.playlistEngine=t,this.streamEventEventEmitter=n}return e.prototype.start=freeOnUnref(function(){this.isStarted||(this.isStarted=!0,this.mpPlayer.textTrack.on("newcue",this.onTextTrackCue),this.mpPlayer.on("timeupdate",this.onTimeUpdate))}),e.prototype.stop=freeOnUnref(function(){!1!==this.isStarted&&(this.isStarted=!1,this.flush(),this.mpPlayer.textTrack.off("newcue",this.onTextTrackCue),this.mpPlayer.off("timeupdate",this.onTimeUpdate))}),e.prototype.flush=freeOnUnref(function(){this.timeWindowCues=new qA.TimeWindowStore,this.currentActiveCueRange=null}),e.prototype.updateStreamGroups=freeOnUnref(function(e){this.streamGroups=e.TimedText}),Object.defineProperty(e.prototype,"textCues",{get:freeOnUnref(function(){return this.timeWindowCues}),enumerable:!0,configurable:!0}),e.prototype.addStaticCue=freeOnUnref(function(e){this.processCue(e)}),e.prototype.processCue=freeOnUnref(function(e){this.timeWindowCues.addOrReplace(e.startMs,e.endMs,e)}),e.prototype.emitTimedTextData=freeOnUnref(function(e){var t=this.getCueTimelineItemIndex(e),n=this.getActiveStream(),r=this.findPublicStreamFromCue(e),i=r;if(null!=t&&null!=n){if(null==i)i=n.id;else if(n.id!==r)return;var o=this.playlistEngine.getItems()[t],a=this.streamEventEventEmitter.listeners("TimedTextStreamData");if(null!=o&&!x.isEmpty(a)){var s=o.start-o.timelineStart,l=YU.translateXpPlaylistIndexToClientTimelineIndex(t,this.playlistEngine),f={data:e.data,timestampOffsetMs:-e.timeOffsetMs+o.start,startPosition:e.startMs-s,endPosition:e.endMs-s,timelineItemIndex:l,retainableRanges:this.getTimedTextContentRanges(e),contentId:s_.createTimelineContentId(o)};this.streamEventEventEmitter.emitSync("TimedTextStreamData",i,f),this.currentActiveCueRange={start:e.startMs,end:e.endMs}}}}),e.prototype.findPublicStreamFromCue=freeOnUnref(function(t){var e=this.getCueTimelineItemIndex(t);if(null!=e){var n=this.playlistEngine.getItems()[e];if(null!==n&&null!=n.mediaRepresentation&&null!=n.mediaRepresentation.periods){var r=x.findWhere(n.mediaRepresentation.periods.contents,{id:t.periodId});if(null!=r){var i=x.find(r.streams,freeOnUnref(function(e){return e.id===t.streamId}));if(null!=i)return VA.StreamTransformer.getPublicStreamId(i)}}}}),e.prototype.getCueTimelineItemIndex=freeOnUnref(function(e){var t=this.playlistEngine.getItems(),n=this.playlistEngine.getCurrentItem();if(null==n)return null;for(var r=0;r<t.length;r++){var i=t[r];if(i.start-100<=e.startMs&&n.titleId===i.titleId&&(null==i.end||e.startMs<i.end-100))return r}return null}),e.prototype.getTimedTextContentRanges=freeOnUnref(function(e){var t=this.getCueTimelineItemIndex(e);return null==t?(n.warn("No playlist item found for cue. This will cause the retainable ranges to be empty."),[]):[{startTimeMs:e.startMs,endTimeMs:e.endMs,timelineItemIndex:t}]}),e.prototype.getActiveStream=freeOnUnref(function(){var t=this.streamGroups;if(null===t.activeId)return null;var e=x.find(t.streams,freeOnUnref(function(e){return e.id===t.activeId}));return Qe.withDefault(e,null)}),e.prototype.hash=freeOnUnref(function(e){return Ot.hex_sha256(e)}),e})();t.TimedTextStore=r}));e(HA);HA.TimedTextStore;var zA=t(freeOnUnref(function(e,t){var n,r,i,o,a,c=ce&&ce.__assign||freeOnUnref(function(){return(c=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var d=de.get("XpPlayerStreamFeatureV2"),g=((n={}).Audio={type:"Audio",streams:[],activeId:null},n.TimedText={type:"TimedText",streams:[],activeId:null},n.Video={type:"Video",streams:[],activeId:null},n),p=((r={}).Audio=[],r.TimedText=[],r.Video=[],r),v=((i={}).Audio="Audio",i.TimedText="TimedText",i.Video="Video",i),h=((o={}).Audio=null,o.TimedText=null,o.Video=null,o),m=((a={}).Audio="Audio",a.TimedText="TimedText",a.Video="Video",a),s=freeOnUnref(function(){function e(e,t,n){var r=this;this.version="0.0.1",this.objectId="XpPlayer-Stream-"+Math.random(),this.capabilities={},this.streamGroups=$t(!0,{},g),this.streamRestrictions={},this.activePublicStreamIds=x.clone(h),this.activePublicVariantIds=x.clone(h),this.cancelStaticTimedTextResolution=null,this.currentPeriodId={},this.currentPlaylistItem=null,this.maxBitrateThresholds={},this.qualityLevelHandlers={},this.shouldUseStaticTimedText=null,this.streamEventEventEmitter=new A.EventEmitter,this.streamMatchers={},this.streamRestrictionsByStreamType=$t(!0,{},p),this.typeMatchers={},this.unsupportedCodecs={},this.onStreamQualityChange=freeOnUnref(function(e,t){null!==t?(r.currentPeriodId[t.type]!==t.periodId&&(r.currentPeriodId[t.type]=t.periodId,r.debugLoggingForTimedText("onStreamQualityChange -> createStreamGroups"),r.createStreamGroups(t)),r.processStreamQualityChange(t),"Audio"===e&&r.tryEmitStaticTimedText()):r.processDisabledStreamQualityChange(e)}),this.stripActiveVariantIdAndRestrictions=freeOnUnref(function(e){var t=x.clone(e);return delete t.activeVariantId,t.variants=t.variants.map(r.stripRestrictions),t}),this.stripRestrictions=freeOnUnref(function(e){var t=x.clone(e);return t.restrictions=[],t}),this.onStreamGroupChange=freeOnUnref(function(e){var t;r.debugLoggingForTimedText("onStreamGroupChange called with streamGroup "+JSON.stringify(e)+".");var n=c({},r.streamGroups,((t={})[m[e.type]]=e,t));r.debugLoggingForTimedText("onStreamGroupChange -> updateStreamGroups"),r.updateStreamGroups(n),r.setActivePublicStreamId(m[e.type],e.activeId)}),this.onPlaylistUpdate=freeOnUnref(function(){r.currentPlaylistItem=r.playlistEngine.getCurrentItem(),null===r.currentPlaylistItem&&(r.debugLoggingForTimedText("onPlaylistUpdate -> updateStreamGroups"),r.updateStreamGroups($t(!0,{},g)))}),this.onEnterItem=freeOnUnref(function(e){null!==r.currentPlaylistItem&&null!=r.currentPlaylistItem.contentSource&&r.currentPlaylistItem.contentSource.off("streamRestrictionChange",r.onStreamRestrictionChange),null!=e.item&&null!=e.item.initializeContentCallback?e.item.initializeContentCallback().then(freeOnUnref(function(){r.cancelToken.throwIfRequested(),r.onCurrentItemChange()})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||d.error("Error happened when processing a deferred content",e)})):r.onCurrentItemChange()}),this.onStreamRestrictionChange=freeOnUnref(function(e){if(r.updateStreamRestriction(e.streamType,e.restrictions),null!==r.playbackQualityProvider){var t=r.playbackQualityProvider.getCurrentQualityInfo(e.streamType);null!=t&&(r.debugLoggingForTimedText("onStreamRestrictionChange -> createStreamGroups"),r.createStreamGroups(t),r.processStreamQualityChange(t))}}),this.mpPlayer=e,this.playlistEngine=t,this.playbackQualityProvider=this.mpPlayer.getPlaybackQualityProvider(),this.staticTimedTextDataStore=n,this.timedTextStore=new HA.TimedTextStore(e,t,this.streamEventEventEmitter);var i=lt.CancelToken.source(),o=i.token,a=i.cancel;this.cancelFunction=a,this.cancelToken=o;for(var s=freeOnUnref(function(t){l.qualityLevelHandlers[t]=freeOnUnref(function(e){r.onStreamQualityChange(t,e)})}),l=this,f=0,u=Object.keys(vu.MediaRepresentationStreamTypeMap);f<u.length;f++){s(u[f])}}return e.prototype.initialize=freeOnUnref(function(){if(this.playlistEngine.on("EnterItem",this.onEnterItem),this.playlistEngine.on("PlaylistUpdate",this.onPlaylistUpdate),null!==this.playbackQualityProvider){this.playbackQualityProvider.onStreamGroupChange(this.onStreamGroupChange);for(var e=0,t=Object.keys(vu.MediaRepresentationStreamTypeMap);e<t.length;e++){var n=t[e],r=this.qualityLevelHandlers[n];null!=r&&this.playbackQualityProvider.on(vu.MediaRepresentationStreamTypeMap[n],"qualityLevel",r)}}}),e.prototype.terminate=freeOnUnref(function(){if(this.cancelFunction(),this.unload(),this.timedTextStore.stop(),this.playlistEngine.off("EnterItem",this.onEnterItem),this.playlistEngine.off("PlaylistUpdate",this.onPlaylistUpdate),null!==this.playbackQualityProvider){this.playbackQualityProvider.offStreamGroupChange(this.onStreamGroupChange);for(var e=0,t=Object.keys(vu.MediaRepresentationStreamTypeMap);e<t.length;e++){var n=t[e],r=this.qualityLevelHandlers[n];null!=r&&this.playbackQualityProvider.off(vu.MediaRepresentationStreamTypeMap[n],"qualityLevel",r)}}this.currentPeriodId={}}),e.prototype.configure=freeOnUnref(function(e){if(null!=e.preferredStreamMatchers)for(var t=0,n=Object.keys(e.preferredStreamMatchers);t<n.length;t++){var r=n[t];this.setStreamMatchers(r,e.preferredStreamMatchers[r])}}),e.prototype.unload=freeOnUnref(function(){this.activePublicStreamIds=x.clone(h),this.activePublicVariantIds=x.clone(h),null!==this.currentPlaylistItem&&null!=this.currentPlaylistItem.contentSource&&this.currentPlaylistItem.contentSource.off("streamRestrictionChange",this.onStreamRestrictionChange)}),e.prototype.setMaxBitrateThreshold=freeOnUnref(function(e,t){if("Video"!==e)throw new Error("Unsupported streamType '"+e+"' for setMaxBitrateThreshold");null===t&&(t=1/0),d.info(">> setMaxBitrateThreshold set for "+e+" to "+t+" bits/sec"),t===1/0?delete this.maxBitrateThresholds[e]:this.maxBitrateThresholds[e]=t;for(var n=this.getMediaRepresentationStreamType(e),r=0,i=this.getAllUniqueContentSources();r<i.length;r++){i[r].setMaxBitrateThreshold(n,"External",t)}}),e.prototype.setMaxResolution=freeOnUnref(function(e,t){for(var n=0,r=this.getAllUniqueContentSources();n<r.length;n++){r[n].setMaxResolution(e,t)}}),e.prototype.setStreamMatchers=freeOnUnref(function(e,t,n){x.isArray(t)||(t=[]);for(var r=0,i=t;r<i.length;r++){var o=i[r];null!=o.language&&"string"!=typeof o.language&&(d.warn("Removing invalid StreamMatcher.language '"+o.language+"'"),delete o.language)}d.info(">> setStreamMatchers("+e+", "+JSON.stringify(t)+"), "+JSON.stringify(n));var a=this.getMediaRepresentationStreamType(e),s=Jl.expandCustomMatcherLanguages(t);if("TimedText"===e){var l=this.getActiveStream("Audio");s=FA.extendMandatoryTimedTextMatchers(s,null!=l?l.language:void 0)}this.typeMatchers[a]=s.map(freeOnUnref(function(e){return vu.StreamMatcherTransformer.convertStreamMatcherToTypeMatcher(a,e)})),this.streamMatchers[e]=s;for(var f=0,u=this.getAllUniqueContentSources();f<u.length;f++){u[f].setStreamMatchers(a,this.typeMatchers[a],null!=n&&!0===n.seamless)}"TimedText"===e&&this.tryEmitStaticTimedText()}),e.prototype.setUnsupportedCodecs=freeOnUnref(function(e,t){if("Audio"!==e)throw new Error("Unsupported streamType '"+e+"' for setUnsupportedCodecs");d.info(">> setUnsupportedCodecs set for "+e+" with "+JSON.stringify(t)+" codecs"),0===t.length?delete this.unsupportedCodecs[e]:this.unsupportedCodecs[e]=t;for(var n=this.getMediaRepresentationStreamType(e),r=0,i=this.getAllUniqueContentSources();r<i.length;r++){i[r].setUnsupportedCodecs(n,t)}}),e.prototype.on=freeOnUnref(function(e,t){this.streamEventEventEmitter.on(e,t),"TimedTextStreamData"===e&&this.tryEmitStaticTimedText()}),e.prototype.once=freeOnUnref(function(e,t){this.streamEventEventEmitter.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.streamEventEventEmitter.off(e,t)}),e.prototype.getCurrentResolution=freeOnUnref(function(){return null===this.playbackQualityProvider?null:this.playbackQualityProvider.getCurrentResolution()}),e.prototype.getCurrentMatchers=freeOnUnref(function(){return c({},this.typeMatchers)}),e.prototype.getCurrentMaxBitrateThresholds=freeOnUnref(function(){return this.maxBitrateThresholds}),e.prototype.getCurrentUnsupportedCodecs=freeOnUnref(function(){return this.unsupportedCodecs}),e.prototype.emitTimedTextAcquisitionSuccess=freeOnUnref(function(e){this.streamEventEventEmitter.emit("TimedTextAcquisitionSucceed",e)}),e.prototype.toJSON=freeOnUnref(function(){return{version:this.version,objectId:this.objectId,capabilities:this.capabilities,streamGroups:this.streamGroups,streamRestrictions:this.streamRestrictions}}),e.prototype.tryEmitStaticTimedText=freeOnUnref(function(){var r=this;if(null!==this.currentPlaylistItem&&!0===this.shouldUseStaticTimedText){var e=this.streamEventEventEmitter.listeners("TimedTextStreamData");if(x.isEmpty(e))d.info("No TimedTextStreamData listeners");else{null!=this.cancelStaticTimedTextResolution&&(this.cancelStaticTimedTextResolution(),this.cancelStaticTimedTextResolution=null);var i=this.getCurrentStaticTimedTextStream();if(null!==i){var t=this.playlistEngine.getCurrentItemIndex(),o=this.playlistEngine.getCurrentItem();if(null==t||null==o)throw new Error("timelineItemIndex is null");var n=lt.CancelToken.source(),a=n.token,s=n.cancel;this.cancelStaticTimedTextResolution=s;var l=o.timelineStart,f=o.timelineEnd;this.staticTimedTextDataStore.getContents(i,o.downloadOperationId).then(freeOnUnref(function(e){var t=o.start-l,n={data:e,startMs:l+t,endMs:null!=f?f+t:1/0,timeOffsetMs:t};a.requested&&a.throwIfRequested(),r.timedTextStore.addStaticCue(n),r.setActivePublicStreamId("TimedText",i.id)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||d.error("<< StaticTimedTextDataStore.getContents error:",e)}))}else x.isEmpty(this.currentPlaylistItem.staticTimedTextStreams)||this.setActivePublicStreamId("TimedText",null)}}}),e.prototype.getActiveStream=freeOnUnref(function(e){var t=this.streamGroups[e];if(null===t.activeId)return null;var n=x.find(t.streams,freeOnUnref(function(e){return e.id===t.activeId}));return Qe.withDefault(n,null)}),e.prototype.getCurrentStaticTimedTextStream=freeOnUnref(function(){if(null===this.currentPlaylistItem)return null;var e=this.getActiveStream("Audio"),t=this.streamMatchers.TimedText;return FA.selectStaticTimedTextStream(this.currentPlaylistItem.staticTimedTextStreams,null!=t?t:[],null!=e?e.language:void 0)}),e.prototype.getMediaRepresentationStreamType=freeOnUnref(function(e){var t=vu.MediaRepresentationStreamTypeMap[e];if(null==t)throw new Error("Invalid stream type: "+e);return t}),e.prototype.createStreamGroups=freeOnUnref(function(e){if(this.debugLoggingForTimedText("createStreamGroups called with info: "+JSON.stringify(e)+"."),null!==this.currentPlaylistItem){var t=x.findWhere(this.currentPlaylistItem.mediaRepresentation.periods.contents,{id:e.periodId});if(null!=t){for(var n=$t(!0,{},g),r={Audio:[],TimedText:[],Video:[]},i=0,o=t.streams;i<o.length;i++){var a=o[i];"Image"!==a.type&&r[a.type].push(a)}for(var s=0,l=Object.keys(r);s<l.length;s++){var f=l[s],u=this.internalStreamsToPublicStreams(r[f],this.streamRestrictionsByStreamType[f]),c=v[f],d=n[c];d.streams=d.streams.concat(u),d.activeId=this.activePublicStreamIds[c]}var p=this.getStaticTimedTextStreams(this.currentPlaylistItem);x.isEmpty(n.TimedText.streams)?x.isEmpty(p)?(this.shouldUseStaticTimedText=null,this.timedTextStore.stop()):(this.shouldUseStaticTimedText=!0,this.timedTextStore.start(),n.TimedText.streams=p,this.debugLoggingForTimedText("Using static timed text streams found in PRS response.")):(this.shouldUseStaticTimedText=!1,this.timedTextStore.start()),this.debugLoggingForTimedText("Setting shouldUseStaticTimedText to "+this.shouldUseStaticTimedText+" in createStreamGroups."),this.debugLoggingForTimedText("createStreamGroups -> updateStreamGroups"),this.updateStreamGroups(n);for(var h=0,m=Object.keys(this.streamGroups);h<m.length;h++){f=m[h];var y=this.getActiveStream(f);null!==y&&(y.activeVariantId=this.activePublicVariantIds[f])}}}}),e.prototype.processDisabledStreamQualityChange=freeOnUnref(function(e){delete this.currentPeriodId[e],this.setActivePublicStreamId(e,null),this.activePublicVariantIds[e]=null}),e.prototype.processStreamQualityChange=freeOnUnref(function(t){if(null!==this.currentPlaylistItem){var e=x.findWhere(this.currentPlaylistItem.mediaRepresentation.periods.contents,{id:t.periodId});if(null!=e){var n=x.find(e.streams,freeOnUnref(function(e){return e.id===t.streamId}));if(null!=n){var r=VA.StreamTransformer.getPublicStreamId(n);this.setActivePublicStreamId(v[t.type],r);var i=this.qualityLevelToVariantId(t);this.setActivePublicVariantId(v[t.type],i)}else d.warn("Could not find "+t.type+' stream "'+t.streamId+'"')}}}),e.prototype.setActivePublicStreamId=freeOnUnref(function(e,t){var n=this.activePublicStreamIds[e];this.activePublicStreamIds[e]=t,n!==(this.streamGroups[e].activeId=t)&&("TimedText"===e&&this.timedTextStore.flush(),this.streamEventEventEmitter.emit("ActiveStreamChange",e,t),d.info("["+e+'] ActiveStreamChange: "'+n+'" to "'+t+'"'))}),e.prototype.setActivePublicVariantId=freeOnUnref(function(e,t){var n=this.getActiveStream(e);if(null!==n){var r=this.activePublicVariantIds[e];this.activePublicVariantIds[e]=t,r!==(n.activeVariantId=t)&&(this.streamEventEventEmitter.emit("ActiveVariantChange",e,this.activePublicStreamIds[e],t),d.enabledFor(de.DEBUG)&&d.info("["+e+'] ActiveVariantChange: "'+r+'" to "'+t+'".'))}else d.warn("Attempted to set active variant for "+e+" without an active stream")}),e.prototype.qualityLevelToVariantId=freeOnUnref(function(e){return e.streamId+"_"+e.qualityLevelId}),e.prototype.updateStreamGroups=freeOnUnref(function(e){this.debugLoggingForTimedText("updateStreamGroups called with newStreamGroups: "+JSON.stringify(e)+".");for(var t=0,n=Object.keys(v);t<n.length;t++){var r=n[t],i=this.streamGroups[r],o=e[r],a=i.streams.map(this.stripActiveVariantIdAndRestrictions),s=o.streams.map(this.stripActiveVariantIdAndRestrictions);if(!x.isEqual(a,s))if(this.streamEventEventEmitter.emit("StreamGroupChange",v[r],o.streams),d.enabledFor(de.DEBUG))d.info("["+r+"] StreamGroupChange. New streams: "+JSON.stringify(o.streams));else if(d.enabledFor(de.INFO)){var l=o.streams.map(freeOnUnref(function(e){return e.id}));d.info("["+r+"] StreamGroupChange. New streams: "+JSON.stringify(l))}}this.streamGroups=e,this.timedTextStore.updateStreamGroups(e)}),e.prototype.onCurrentItemChange=freeOnUnref(function(){if(this.currentPlaylistItem=this.playlistEngine.getCurrentItem(),null!=this.playbackQualityProvider){null!==this.currentPlaylistItem&&null!=this.currentPlaylistItem.contentSource&&this.currentPlaylistItem.contentSource.on("streamRestrictionChange",this.onStreamRestrictionChange),this.currentPeriodId={};for(var e=0,t=Object.keys(v);e<t.length;e++){var n=t[e],r=this.playbackQualityProvider.getCurrentQualityInfo(n);null!=r&&(this.debugLoggingForTimedText("onCurrentItemChange -> createStreamGroups"),this.createStreamGroups(r),this.processStreamQualityChange(r))}this.tryEmitStaticTimedText()}}),e.prototype.getStaticTimedTextStreams=freeOnUnref(function(e){return null===e?[]:e.staticTimedTextStreams.map(freeOnUnref(function(e){var t=e.variants.map(freeOnUnref(function(e){return{id:e.id,format:e.format,restrictions:[]}}));return c({},e,{variants:t})}))}),e.prototype.internalStreamsToPublicStreams=freeOnUnref(function(e,t){void 0===t&&(t=[]);for(var n={},r=0,i=e.map(freeOnUnref(function(e){return VA.StreamTransformer.transformToPublicStream(e,t)}));r<i.length;r++){var o=i[r];null!=n[o.id]?n[o.id].push(o):n[o.id]=[o]}for(var a=[],s=0,l=Object.keys(n);s<l.length;s++){for(var f=[],u=n[l[s]],c=0,d=u;c<d.length;c++){var p=d[c];f=f.concat(p.variants)}a.push(x.extend(u[0],{variants:f}))}return a}),e.prototype.updateStreamRestriction=freeOnUnref(function(e,t){var n=this.streamRestrictionsByStreamType[e];if(!x.isEqual(n,t)){this.streamRestrictionsByStreamType[e]=t;for(var r=v[e],i=t.map(freeOnUnref(function(e){return BA.StreamRestrictionTransformer.transformToPublicStreamRestriction(e)})),o=0,a=i;o<a.length;o++){var s=a[o];this.streamRestrictions[s.restrictionType]=s}this.streamEventEventEmitter.emit("StreamGroupRestrictionChange",r,i),d.enabledFor(de.DEBUG)&&d.info("["+r+"] StreamGroupRestrictionChange. New restrictions: "+JSON.stringify(i))}}),e.prototype.getAllUniqueContentSources=freeOnUnref(function(){for(var e=[],t=0,n=this.playlistEngine.getItems();t<n.length;t++){var r=n[t];null!=r.contentSource&&-1===e.indexOf(r.contentSource)&&e.push(r.contentSource)}return e}),e.prototype.debugLoggingForTimedText=freeOnUnref(function(e){d.enabledFor(de.DEBUG)&&d.info(e)}),e})();t.XpPlayerStreamFeatureV2=s}));e(zA);zA.XpPlayerStreamFeatureV2;var WA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n,r=de.get("MultiviewToken");freeOnUnref(function(e){e[e.NoLayout=0]="NoLayout",e[e.FixedLayout=1]="FixedLayout",e[e.FlexibleLayout=2]="FlexibleLayout"})(n||(n={})),t.LayoutType=n;var i=freeOnUnref(function(e){var t=JSON.stringify(e);return Lr.encodeString(t)});t.generateToken=i;var o=freeOnUnref(function(t){try{var e=Lr.decodeString(t);return JSON.parse(e)}catch(e){return r.error("Failed to parse MultiviewToken: ",t),null}});t.getTokenCapabilities=o}));e(WA);WA.LayoutType,WA.generateToken,WA.getTokenCapabilities;var KA=t(freeOnUnref(function(e,t){var n,r,i,o,a=ce&&ce.__assign||freeOnUnref(function(){return(a=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var m=de.get("XpPlayer"),l=((n={}).unloaded=ka.ContentState.Unloaded,n.error=ka.ContentState.Error,n.ready=ka.ContentState.Ready,n.waiting=ka.ContentState.Waiting,n),s=((r={}).None="None",r.Filmmaker="Filmmaker",r.CalibratedBroadcast="CalibratedBroadcast",r.CalibratedCinematic="CalibratedCinematic",r);function y(e,t){return"deviceId"!==e&&"envelope"!==e&&"playbackToken"!==e&&"refreshEnvelope"!==e||null==t?t:"<REDACTED>"}var f=((i={}).UHD="UHD",i.HD="HD",i.SD="SD",i),u=((o={})["drm_service.hd_content_not_allowed"]="SD",o["drm_service.uhd_content_not_allowed"]="HD",o["prs.hd_content_not_allowed"]="SD",o);function g(e){return{positionMs:null!=e.position?e.position:1/0,relativity:null!=e.positionRelativity?e.positionRelativity:"Nominal"}}function v(e,t){var n=g(t);return e.positionMs===n.positionMs&&e.positionRelativity===n.relativity}var c=freeOnUnref(function(){function e(e,t,n){var r,d=this;this.adReportingFeature=null,this.pictureInPictureFeature=null,this.volumeFeature=null,this.contentConfig=null,this.currentPictureMode="None",this.playPromise=null,this.playlistPlaybackController=null,this.prsManager=null,this.userWatchSessionId="",this.canUpdateContentState=!0,this.isPublicUnload=!1,this.shouldForceUnloadedEvent=!1,this.preInitReported=!1,this.version="0.0.1",this.Features=ka.PlayerFeatures,this.Events=ka.PlayerEvent,this.error=null,this.contentError=null,this.contentState=ka.ContentState.Unloaded,this.playbackState=ka.PlaybackState.Paused,this.playerState="Created",this.doDestroy=freeOnUnref(function(){m.info(">> doDestroy"),d.excessiveWaitingTracker.destroy(),null!==d.streamFeature&&d.streamFeature.terminate(),null!==d.videoPreviewFeature&&d.videoPreviewFeature.terminate(),null!==d.adReportingFeature&&d.adReportingFeature.terminate(),nn.Diagnostics.removeSink(d.timeToFirstFrameDataSink),nn.Diagnostics.removeSink(d.seamlessSwitchLatencyDataSink),d.diagnosticsFeature.terminate(),d.downloadPlaybackMetricsCalculator.destroy(),d.troubleshootingFeature.terminate(),null!=d.staticTimedTextDataStore&&(d.staticTimedTextDataStore.off("timedTextDownloaded",d.onTimedTextDownloaded),d.staticTimedTextDataStore.off("timedTextDownloadFailed",d.onTimedTextDownloadFailed)),d.playbackStartedTracker.terminate(),null!=d.playlistPlaybackController&&d.playlistPlaybackController.terminate(),d.timelineManager.terminate(),d.playlistAutoplayBarrier.terminate(),d.playlistEngine.deregisterSeekInterceptor(d.endOfContentSeekInterceptor),d.playlistTrimmer.terminate(),d.playlistTrackingEventReporter.terminate(),null!=d.mediaEventController&&d.mediaEventController.uninitialize(),d.mpPlayerProxy.off("contentStateChange",d.onContentStateChange),d.mpPlayerProxy.off("playbackStateChange",d.onPlaybackStateChange),d.mpPlayerProxy.off("timeupdate",d.onTimeupdate),d.mpPlayerProxy.off("error",d.onError),d.mpPlayerProxy.off("pictureModeChange",d.onPictureModeChange),(d.prsManager=null)!=d.contentConfig&&(null!=d.contentConfig.dispose&&d.contentConfig.dispose(),d.contentConfig=null),d.mpPlayerProxy.destroy(),d.mediaKeysManager.reset(),d.sonarClientSDK.uninitialize(),d.sonarEventAdapter.uninitialize(),d.sonarMitigationAdapter.uninitialize(),d.surfaceRefRegister.deregisterSurfaceRef(d.surfaceRefId),d.sessionIdTracker.updatePlayerInstanceId()}),this.requestResources=freeOnUnref(function(n,t,e){var r=n.titleId,i=n.videoMaterialType,o=n.isAutoplaySession;d.timeToFirstFrameDataSink.reset(),d.loadMetricsCalculator.load(i);var a=d.prsManager.titleRequestTracker;0<a.size()&&(a.cancelAll(!0),d.unload()),d.excessiveWaitingTracker.onContentLoading(i),d.excessiveWaitingTracker.waitingStarted(),d.userWatchSessionId=Vy.UUID.v4();var s=lt.CancelToken.source(),l=s.token,f=s.cancel,u=g(n);a.addTitle(r,{videoMaterialType:i,positionMs:u.positionMs,positionRelativity:u.relativity,cancel:f}),d.sonarEventAdapter.updateVideoMaterialType(i);var c=d.videoQualityOverrideStorage;null!=e&&null!=e.videoQuality&&(c=new AA.TemporaryVideoQualityOverride(e.videoQuality)),d.sessionEngagementTracker.setAutoplaySession(!0===o),d.mediaEventController.traceEventController.reportTraceStart("PlaybackStartup","PRS","ResourceLookup",{titleId:r,videoMaterialType:i,isImmediateConsumption:String(t),isEXPL:String(!0===n.enablePlaylisting)}),d.prsManager.resolve(n,t,d.userWatchSessionId,l,void 0,c,null!=d.streamStartOverrides?d.streamStartOverrides:void 0,e).then(freeOnUnref(function(){l.throwIfRequested(),!0===n.preserveStreamingAffinity&&q.metrics.putMetric("DTH.NextUp.Transition.Success",1);var e=a.get(r),t={positionMs:e.positionMs,relativity:e.positionRelativity};d.startingSeekToMainContentPosition(t,r)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||(d.mediaEventController.traceEventController.reportTraceStop("PlaybackStartup","PRS","Failure","ResourceLookup",{titleId:r,videoMaterialType:i,isImmediateConsumption:String(t),isEXPL:String(!0===n.enablePlaylisting),error:e.message}),!0===n.preserveStreamingAffinity&&q.metrics.putMetric("DTH.NextUp.Transition.Success",0),d.setContentError(e),null!=d.mediaEventController&&(d.mediaEventController.updateConsumptionId(Vy.UUID.v4()),d.mediaEventController.reportDeviceFulfillment(n.titleId,n.videoMaterialType),d.isSuperDraperRequest(n)?(m.warn("PRS request failed on SuperDraper content, reporting as non-fatal error."),d.mediaEventController.reportError(!1,e,"Service","Error")):d.mediaEventController.reportError(!0,e,"Service","Error")))}))}),this.onContentStateChange=freeOnUnref(function(e){if(d.canUpdateContentState){if("waiting"===e.contentState?(d.shouldForceUnloadedEvent=!1,d.excessiveWaitingTracker.waitingStarted()):d.excessiveWaitingTracker.waitingCompleted(),"error"===e.contentState&&null!=d.mpPlayerProxy.contentError){var n=d.mpPlayerProxy.contentError,t=freeOnUnref(function(e){if(-1!==n.code.indexOf(e)){var t=u[e];return m.warn("Triggering internal restart "+t+" downgrade:",n),q.metrics.putMetric("DRMDowngrade.InternalRestart."+t),oe.timer.setImmediate(freeOnUnref(function(){d.internalRestart(),null!=d.videoQualityOverrideStorage&&d.videoQualityOverrideStorage.storeDowngradeQuality(t)})),{value:void 0}}});for(var r in u){var i=t(r);if("object"==typeof i)return i.value}if(wv.SYE_FALLBACK_ERROR_CODES.some(freeOnUnref(function(e){return-1!==n.code.indexOf(e)}))){var o=d.playlistEngine.getCurrentItem();if(null==o)return;var a=o.internalCancelToken;return null==a?void m.warn("Attempted to fallback without an internalCancelToken. Not triggering fallback"):(m.info("Triggering Sye fallback:",n),oe.timer.setImmediate(freeOnUnref(function(){o.playbackErrorHandler.handleError(n,a,{hasPlaybackStarted:d.playbackStartedTracker.hasPlaybackStarted()}).then(freeOnUnref(function(){d.destroyed.throwIfRequested(),a.throwIfRequested();var e=d.playlistEngine.getCurrentPosition();null!=e&&d.playlistEngine.seek(e),d.contentState!==ka.ContentState.Unloaded&&d.playlistPlaybackController.reload()})).catch(freeOnUnref(function(e){e instanceof lt.CancelError&&m.warn("The Sye DASH fallback is canceled"),m.error("Sye DASH fallback failed with reason: "+e),d.setContentError(e),d.internalUnload()}))})),void q.metrics.putMetric("LiveLowLatency.Fallback"))}return d.setContentError(d.mpPlayerProxy.contentError),void oe.timer.setImmediate(freeOnUnref(function(){d.internalUnload()}))}if("unloaded"===e.contentState&&_c.getInstance().storeState().catch(freeOnUnref(function(e){m.info("NetworkRequestManager.storeState failed with reason:",e)})),d.contentState===ka.ContentState.Error&&d.playbackState===ka.PlaybackState.Playing&&"error"!==e.contentState&&null!=d.playlistPlaybackController?d.playlistPlaybackController.play().then(freeOnUnref(function(){null!=d.playPromise&&(d.playPromise.resolve(),d.playPromise=null)})).catch(freeOnUnref(function(e){null!=d.playPromise&&(d.playPromise.reject(e),d.playPromise=null)})):null!=d.playPromise&&d.contentState===ka.ContentState.Error&&d.playbackState===ka.PlaybackState.Playing&&"error"===e.contentState&&(d.playPromise.reject(d.contentError),d.playPromise=null),"unloaded"!==e.contentState||!d.isPublicUnload&&d.contentState!==ka.ContentState.Error||d.mediaKeysManager.reset(),d.contentState!==ka.ContentState.Error||d.isPublicUnload||"unloaded"!==e.contentState){var s=d.contentState;d.contentState=l[e.contentState],d.setContentError(null),s!==d.contentState&&(d.eventEmitter.emit("ContentStateChange",d.contentState),d.diagnostics.report("contentStateChanged",{positionMs:d.mpPlayerProxy.currentTimeMs,state:d.contentState}))}}}),this.onPlaybackStateChange=freeOnUnref(function(e){var t="playing"===e.playbackState?ka.PlaybackState.Playing:ka.PlaybackState.Paused;d.setPlaybackState(t)}),this.onTimeupdate=freeOnUnref(function(e){d.playerBufferManager.onPosition(e.positionMs)}),this.onError=freeOnUnref(function(e){var t=_v.InternalToExternalCodeConverter.convertCode(e);d.error=t,m.warn("PlayerError:",e,", public playerError:",t),d.eventEmitter.emit("Error",t)}),this.onPictureModeChange=freeOnUnref(function(e){d.currentPictureMode=s[e],d.eventEmitter.emit("PictureModeChange",d.currentPictureMode)}),this.onTimelineBlocked=freeOnUnref(function(){var e=d.timelineManager.getTimeline(),t=d.currentTime.currentTimelineItemIndex+1;if(t<e.items.length){var n=e.items[t].error;m.warn("Timeline blocked due to error. Setting content error",n),d.setContentError(n)}else m.warn("Timeline blocked without a next item! Ignoring.")}),this.onTimedTextDownloaded=freeOnUnref(function(e){d.mediaEventController.reportTimedTextAcquisitionSuccess(e),d.streamFeature.emitTimedTextAcquisitionSuccess(!0),q.metrics.putMetric("TimedText.OutOfBand.Acquisition",1)}),this.onTimedTextDownloadFailed=freeOnUnref(function(e){d.mediaEventController.reportTimedTextAcquisitionFailure(e),d.streamFeature.emitTimedTextAcquisitionSuccess(!1),q.metrics.putMetric("TimedText.OutOfBand.Acquisition",0)}),this.unloadTitle=freeOnUnref(function(e){null!=d.prsManager&&d.prsManager.titleRequestTracker.cancel(e)}),m.info(">> constructor, with config:",JSON.stringify(e,freeOnUnref(function(e,t){return"authContext"===e||"surfaceRef"===e||"deviceId"===e?"<REDACTED>":t}))),this.playerConfig=e,this.sessionIdTracker=new RA.SessionIdTracker,this.mpPlayerProxy=new e_.MpPlayerProxy,this.playlistEngine=new Jy.PlaylistEngine,this.surfaceRefRegister=_t.surfaceRefRegister,this.surfaceRefId=this.surfaceRefRegister.registerSurfaceRef(this.playerConfig.surfaceRef),this.staticTimedTextDataStore=new Ef.StaticTimedTextDataStore;var i=null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.subtitles&&!0===L.configurationStore.configuration.subtitles.enableSubtitleMigration;this.streamFeature=i?new zA.XpPlayerStreamFeatureV2(this.mpPlayerProxy,this.playlistEngine,this.staticTimedTextDataStore):new jA.XpPlayerStreamFeatureV1(this.mpPlayerProxy,this.playlistEngine,this.staticTimedTextDataStore),this.mediaEventController=new qO.MediaEventController(t,this.sessionIdTracker,this.mpPlayerProxy,e.deviceTypeId,this.streamFeature,e.deviceId,this.playlistEngine,e.applicationIdentity,e.clientIdentity,e.uiIdentity),this.metricsReportingFeature=new u_.XpPlayerMetricsReportingFeature(t,this.sessionIdTracker,this.mediaEventController),this.timeToFirstFrameDataSink=new l_.TimeToFirstFrameDataSink(this.mediaEventController),this.seamlessSwitchLatencyDataSink=new gb.SeamlessSwitchLatencyDataSink(this.mediaEventController),nn.Diagnostics.addSink(this.timeToFirstFrameDataSink),nn.Diagnostics.addSink(this.seamlessSwitchLatencyDataSink),this.videoPreviewFeature=new p_.XpPlayerVideoPreviewFeature(this.playlistEngine),this.diagnosticsFeature=new y_.XpPlayerDiagnosticsFeature(this.playlistEngine),null!=e.clientId&&this.mediaEventController.updateClientId(e.clientId),r=lt.CancelToken.source(),this.destroyed=r.token,this.destroyRequested=r.cancel,this.eventEmitter=new A.EventEmitter,this.excessiveWaitingTracker=new LO.ExcessiveWaitingTracker(this.mediaEventController,freeOnUnref(function(e){d.setContentError(e),oe.timer.setImmediate(freeOnUnref(function(){d.internalUnload()}))})),this.endOfContentSeekInterceptor=new HO.EndOfContentSeekInterceptor(this.playlistEngine),this.startOfAiringSeekInterceptor=new xA.StartOfAiringSeekInterceptor(this.playlistEngine),this.playlistAutoplayBarrier=new WO.XpAutoplayBarrier(this.playlistEngine),this.playlistTrimmer=new zO.PlaylistTrimmer(this.playlistEngine,this.unloadTitle),this.playlistTrackingEventReporter=new GO.PlaylistTrackingEventReporter(this.playlistEngine),this.publicTimeTranslator=new i_.PublicTimeTranslator(this.playlistEngine),this.timeDataManager=new a_.TimeDataManager(this.playlistEngine,this.mpPlayerProxy),this.timelineManager=new s_.TimelineManager(this.playlistEngine,this.timeDataManager),this.loadMetricsCalculator=new Ob.LoadMetricsCalculator(this.mpPlayerProxy,this.mediaEventController.traceEventController),this.downloadPlaybackMetricsCalculator=new kv.DownloadPlaybackMetricsCalculator(this.playlistEngine),this.prioritizationSystem=new m_.PlayerPrioritizationSystem(this.playlistEngine);var o,a={memorySize:new fh.MemorySize(zt.deviceInformation.storage.fragmentCache.sizeBytes,fh.MemoryUnits.B)};this.playerBufferManager=new fh.PlayerBufferManager(a),this.hdcpStore=new ea.HdcpStore(!1),this.mediaKeysManager=new ea.MediaKeysManager(this.hdcpStore,this.mediaEventController.traceEventController),this.videoQualityOverrideStorage=new KO.VideoQualityOverrideStorage(n),this.diagnostics=nn.Diagnostics.create("XpPlayer"),this.shouldXpReportPlaybackOpenExit=null!=(o=L.configurationStore.configuration)&&null!=o.mediaEventReporting&&!0===o.mediaEventReporting.reportPlaybackOpenExitOnPlayUnload;this.sonarClientSDK=new IA.SonarController({isSonarSdkEnabled:!0}),this.sonarEventAdapter=new kA.SonarEventAdapter(this.sonarClientSDK,this.mpPlayerProxy,t,this.playlistEngine),this.sonarMitigationAdapter=new _A.SonarMitigationAdapter(this.sonarClientSDK,this.playlistEngine),this.troubleshootingFeature=new g_.XpPlayerTroubleshootingFeature(this.sonarClientSDK),this.globalStreamControl={onStreamEnd:freeOnUnref(function(){null!=d.playlistPlaybackController&&d.playlistPlaybackController.onStreamEnd(),d.internalUnload()}),onReset:freeOnUnref(function(){null!=d.playlistPlaybackController&&d.playlistPlaybackController.onReset()}),onStreamError:freeOnUnref(function(e){return d.setContentError(e)}),onStreamFatalError:freeOnUnref(function(e){d.setContentError(e),oe.timer.setImmediate(freeOnUnref(function(){d.internalUnload()}))}),onStreamRestart:freeOnUnref(function(e,t){void 0===t&&(t={}),d.internalRestart(e,t);var n={maxVideoQuality:null!=t.videoQuality?f[t.videoQuality]:t.videoQuality};d.eventEmitter.emit("StreamRestarted",n)})},this.playbackStartedTracker=new t_.PlaybackStartedTracker(this.mpPlayerProxy),this.sessionEngagementTracker=new DA.SessionEngagementTracker,this.liveMetadataPlaylistUpdate=new vb.LiveMetadataPlaylistUpdaterV2(this.playlistEngine,null!=this.contentConfig?this.contentConfig.titleId:null),this.seekInterceptorManager=new o_.SeekInterceptorManager,this.id="Player-"+Vy.UUID.v4(),this.multiviewToken=null!=this.playerConfig.token?this.playerConfig.token:WA.generateToken({id:Vy.UUID.v4(),type:WA.LayoutType.NoLayout}),this.tier=this.playerConfig.tier,this.streamStartOverrides=null}return Object.defineProperty(e.prototype,"currentTime",{get:freeOnUnref(function(){return this.timeDataManager.getTimeData()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeline",{get:freeOnUnref(function(){return this.timelineManager.getTimeline()}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:freeOnUnref(function(){return this.mpPlayerProxy.playbackRate}),enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activePictureMode",{get:freeOnUnref(function(){return this.currentPictureMode}),enumerable:!0,configurable:!0}),e.prototype.initialize=freeOnUnref(function(){m.info(">> initialize");var e=this.playerConfig;this.serviceClientFactory=this.createServiceClientFactory(e),this.mpPlayerProxy.initialize(this.surfaceRefId,this.hdcpStore,this.mediaKeysManager,this.mediaEventController.traceEventController),this.mpPlayerProxy.on("contentStateChange",this.onContentStateChange),this.mpPlayerProxy.on("playbackStateChange",this.onPlaybackStateChange),this.mpPlayerProxy.on("timeupdate",this.onTimeupdate),this.mpPlayerProxy.on("error",this.onError),this.mpPlayerProxy.on("pictureModeChange",this.onPictureModeChange);var t=this.mpPlayerProxy.getVolumeFeature();null!=t&&(this.volumeFeature=new c_.XpPlayerVolumeFeature(t)),this.mediaEventController.initialize(t);var n=this.mpPlayerProxy.getPictureInPictureFeature();null!=n&&(this.pictureInPictureFeature=new d_.XpPlayerPictureInPictureFeature(n)),this.playlistAutoplayBarrier.initialize(!!e.debug&&e.debug.enableInfiniteAutoplay),this.playlistEngine.registerAutoplayBarrier(this.playlistAutoplayBarrier),this.playlistEngine.registerSeekInterceptor(this.endOfContentSeekInterceptor),this.playlistEngine.registerSeekInterceptor(this.startOfAiringSeekInterceptor),this.playlistTrimmer.initialize(),this.playlistTrackingEventReporter.initialize(this.volumeFeature);var r=new eg.AdEventReporter;this.adReportingFeature=new f_.XpPlayerAdReportingFeature(r,this.playlistEngine,this.mpPlayerProxy);var i=Qe.nestedValue(e,"features.stream",{});this.streamFeature.initialize(),this.streamFeature.configure(i),this.videoPreviewFeature.initialize(null!=e.features?e.features.videoPreview:void 0),this.diagnosticsFeature.initialize(),this.staticTimedTextDataStore.on("timedTextDownloaded",this.onTimedTextDownloaded),this.staticTimedTextDataStore.on("timedTextDownloadFailed",this.onTimedTextDownloadFailed),this.playbackStartedTracker.initialize(),this.playlistPlaybackController=new r_.PlaylistMediaPlaybackController(this.playlistEngine,this.mpPlayerProxy,this.timeDataManager,this.timelineManager,this.mediaEventController,this.playbackStartedTracker),this.playlistPlaybackController.initialize(),this.prsManager=new yb.PRSManager(this.serviceClientFactory,this.playlistEngine,this.playlistAutoplayBarrier,this.playlistTrackingEventReporter,this.mpPlayerProxy,{applicationIdentity:e.applicationIdentity,liveScheduleConfigToken:e.liveScheduleConfigToken,titleDecorationScheme:e.titleDecorationScheme,uxLocale:e.uxLocale,xrayConfig:e.xray},this.mediaEventController,this.prioritizationSystem,this.playerBufferManager,this.streamFeature,this.videoPreviewFeature,this.hdcpStore,this.timelineManager,this.timeDataManager,this.seekInterceptorManager,this.globalStreamControl,this.sessionIdTracker.getPlayerInstanceId(),this.videoQualityOverrideStorage,r,this.playbackStartedTracker,this.sonarEventAdapter,this.mediaKeysManager,this.sessionEngagementTracker),this.timelineManager.initialize(),this.attachProxyListeners();var o={deviceId:e.deviceId,deviceTypeId:e.deviceTypeId};this.sonarClientSDK.initialize(o),this.sonarEventAdapter.initialize(),this.sonarMitigationAdapter.initialize(),this.troubleshootingFeature.initialize(),q.metrics.putMetric("InitializeCalled")}),e.prototype.destroy=freeOnUnref(function(){var t=this;if(m.info(">> destroy"),this.destroyed.requested)m.warn("Attempted to destroy already-destroyed instance");else{if(this.destroyRequested(),this.setPlayerState("Destroying"),null===this.playlistEngine.getCurrentItem())return this.reportStopForUnload(),this.tryReportExit(),this.internalUnload(),this.doDestroy(),void this.setPlayerState("Destroyed");null!=this.playPromise&&(this.playPromise.reject(new Error("Destroying player")),this.playPromise=null);var n=freeOnUnref(function(e){"unloaded"===e.contentState&&(t.mpPlayerProxy.off("contentStateChange",n),t.doDestroy(),t.setPlayerState("Destroyed"))});this.mpPlayerProxy.on("contentStateChange",n),this.unload()}}),e.prototype.getFeature=freeOnUnref(function(t,e){var n=this;return lt.Promise.resolve().then(freeOnUnref(function(){if(n.destroyed.throwIfRequested(),t===ka.PlayerFeatures.MetricsReporting&&null!==n.metricsReportingFeature)return n.metricsReportingFeature;if(t===ka.PlayerFeatures.AdReporting&&null!==n.adReportingFeature)return n.adReportingFeature;if(t===ka.PlayerFeatures.Stream&&null!==n.streamFeature)return null!=e&&n.streamFeature.configure(e),n.streamFeature;if(t===ka.PlayerFeatures.Volume&&null!==n.volumeFeature)return n.volumeFeature;if(t===ka.PlayerFeatures.PictureInPicture&&null!==n.pictureInPictureFeature)return n.pictureInPictureFeature;if(t===ka.PlayerFeatures.VideoPreview)return n.videoPreviewFeature;if(t===ka.PlayerFeatures.Diagnostics&&null!==n.diagnosticsFeature)return n.diagnosticsFeature;if(t===ka.PlayerFeatures.Troubleshooting)return n.troubleshootingFeature;throw new ct.XpError("xp.player.unsupported_feature",void 0,"Feature "+t+" is currently unsupported.")})).catch(freeOnUnref(function(e){if(n.destroyed.requested)throw new ct.XpError("xp.player.destroyed",void 0,"Attempting to use a destroyed Player");throw m.warn("<< getFeature("+t+") failed:",e),e}))}),e.prototype.load=freeOnUnref(function(t,n,e){var r=this;void 0===n&&(n=!1);var i=JSON.stringify(t,y);if(m.info(">> load, (contentConfig: "+i+", immediateConsumption: "+n+")"),this.destroyed.requested)throw new ct.XpError("xp.player.destroyed",void 0,"Attempting to use a destroyed Player");this.hdcpStore.start(),null==t.resolutionCappingStrategy&&(t.resolutionCappingStrategy="ApplicationViewportSize"),t.clientId=this.playerConfig.clientId;var o=this.playlistEngine.getCurrentItem();if(this.canUpdateContentState=!0,this.shouldForceUnloadedEvent=!0,null===t.position&&(t.position=1/0),t.position!==1/0&&null!=t.position&&150<t.position){var a=null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.prs&&!0===L.configurationStore.configuration.prs.enablePlaylistingSupport,s=null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.extensiblePlaylisting&&L.configurationStore.configuration.extensiblePlaylisting.disableShiftingResumePosition;!0!==t.enablePlaylisting&&!a||!0===s||(t.position-=151)}var l=this.prsManager.titleRequestTracker.get(t.titleId);if(this.liveMetadataPlaylistUpdate.updateTitleForLiveMetadata(t.titleId),null!==o){if((d=this.isItemSameForContentConfig(o,t))&&this.contentState!==ka.ContentState.Error){if(p=v(l,t))return m.info("Load called with titleId: "+t.titleId+", but already loaded. Ignoring."),void(null!=t.dispose&&t.dispose());if(!0!==t.enablePlaylisting||0!==t.position)return m.info("Load called with different position: "+t.position+". Seeking to new position."),this.startingSeekToMainContentPosition(g(t),t.titleId),void(null!=t.dispose&&t.dispose());m.info("Load called at position 0 for EXPL request. Reloading content to ensure pre-rolls are not skipped.")}else{if(m.info("Load called with "+(d?"same":"different")+" content while already loaded. Unloading, ContentState: "+this.contentState),"unloaded"!==this.mpPlayerProxy.contentState){var f=freeOnUnref(function(e){"unloaded"===e.contentState&&(r.mpPlayerProxy.off("contentStateChange",f),r.contentConfig=t,r.requestResources(t,n))});return this.mpPlayerProxy.on("contentStateChange",f),this.unload(),void(this.isPublicUnload=!1)}this.unload()}}else{var u=t.titleId,c=t.videoMaterialType;if(null!=l){var d=l.videoMaterialType===t.videoMaterialType,p=v(l,t);if(d&&this.contentState!==ka.ContentState.Error){if(p)return m.info("Attempted to re-load already loading content "+u+" without unloading. Ignoring."),void(null!=t.dispose&&t.dispose());m.info("Attempted to load already loading content "+u+" with different position. Updating start position.");var h=g(t);return l.positionMs=h.positionMs,l.positionRelativity=h.relativity,void(null!=t.dispose&&t.dispose())}m.info("Attempted to load already loading content "+u+" with videoMaterialType ("+c+") and ContentState: "+ka.ContentState.Error)}}this.playbackState===ka.PlaybackState.Playing&&this.mpPlayerProxy.play(),null!=this.contentConfig&&null!=this.contentConfig.dispose&&this.contentConfig.dispose!==t.dispose&&this.contentConfig.dispose(),this.isPublicUnload=!1,this.contentConfig=t,this.requestResources(t,n,e)}),e.prototype.unload=freeOnUnref(function(){m.info(">> unload: this.contentState="+this.contentState+", MpPlayer.contentState="+this.mpPlayerProxy.contentState),this.isPublicUnload=!0,this.excessiveWaitingTracker.contentUnloaded(),this.internalUnload(),this.canUpdateContentState=!0,this.preInitReported=!1,null!=this.contentConfig&&null!=this.contentConfig.dispose&&this.contentConfig.dispose(),(this.contentConfig=null)!==this.contentError&&this.setContentError(null),null!==this.prsManager&&this.prsManager.clearHistory(),"unloaded"===this.mpPlayerProxy.contentState&&this.contentState!==ka.ContentState.Unloaded?(this.contentState=ka.ContentState.Unloaded,this.eventEmitter.emit("ContentStateChange",ka.ContentState.Unloaded)):this.shouldForceUnloadedEvent&&this.eventEmitter.emit("ContentStateChange",ka.ContentState.Unloaded),this.shouldForceUnloadedEvent=!1,this.reportStopForUnload(),this.tryReportExit()}),e.prototype.internalUnload=freeOnUnref(function(){m.info(">> internalUnload"),null!=this.playPromise&&(this.playPromise.reject(new Error("Unloading player")),this.playPromise=null),null!=this.streamFeature&&this.streamFeature.unload(),this.diagnosticsFeature.reset(),null!=this.playlistPlaybackController&&this.playlistPlaybackController.unloaded(),this.timelineManager.reset(),this.playlistAutoplayBarrier.unloaded(),this.playlistAutoplayBarrier.resetInteractions(),this.loadMetricsCalculator.unload(),this.downloadPlaybackMetricsCalculator.unload(this.contentError),null!=this.mediaEventController&&this.mediaEventController.unload();for(var e=0,t=this.playlistEngine.getItems();e<t.length;e++){var n=t[e];null!=n.destroy&&n.destroy()}for(var r=this.playlistEngine.removeAllItems(),i=0,o=x.unique(r.map(freeOnUnref(function(e){return e.contentSource})));i<o.length;i++){var a=o[i];null!=a&&a.stop()}null!=this.prsManager&&this.prsManager.titleRequestTracker.cancelAll(),null!=this.staticTimedTextDataStore&&this.staticTimedTextDataStore.flushCache(),this.hdcpStore.stop()}),e.prototype.internalRestart=freeOnUnref(function(e,t){var n=this.publicTimeTranslator.getCurrentPublicPositionMs();this.internalUnload(),null!==this.prsManager&&this.prsManager.clearHistory();var r=null!=e?e:this.contentConfig;if(null!=r){var i=void 0;i=null!=n?a({},r,{position:n,positionRelativity:"Nominal"}):r;var o=this.mpPlayerProxy.isAutoplayEnabled();m.info(">> restart, content: "+JSON.stringify(i,y)+", shouldAutoplay: "+o+", overrides: "+JSON.stringify(t)),this.load(i,o,t),o&&this.play()}}),e.prototype.start=freeOnUnref(function(e){m.info(">> start, content: "+JSON.stringify(e,y)),this.load(e,!0),this.play()}),e.prototype.pause=freeOnUnref(function(){m.info(">> pause"),this.metricsReportingFeature.reportInteraction("PlayerSDK","Pause","Client",null,null,null,"Client"),this.diagnostics.report("interaction",{type:"Pause"}),this.playlistAutoplayBarrier.resetInteractions(),this.setPlaybackState(ka.PlaybackState.Paused),this.contentState!==ka.ContentState.Error?this.mpPlayerProxy.pause():m.warn("Player in the Error state. Deferring pause on MpPlayer.")}),e.prototype.play=freeOnUnref(function(e){var n=this;return m.info(">> play"),this.metricsReportingFeature.reportInteraction("PlayerSDK","Play","Client",null,null,null,"Client"),this.preInitReported||(this.mediaEventController.reportPreInitState(this.contentState===ka.ContentState.Ready),m.info("report preInit hit state as "+(this.contentState===ka.ContentState.Ready)+" contentState "+this.contentState),this.preInitReported=!0),this.diagnostics.report("interaction",{type:"Play"}),this.tryReportOpen(),this.playlistAutoplayBarrier.resetInteractions(),this.loadMetricsCalculator.play(),this.downloadPlaybackMetricsCalculator.play(),this.contentState===ka.ContentState.Error?(m.warn("Player in the Error state. Deferring play on MpPlayer."),this.setPlaybackState(ka.PlaybackState.Playing),null==this.playPromise&&(this.playPromise=new lt.Deferred),this.playPromise.promise):(null!=e&&!0===e.engageAutoplaySession&&this.sessionEngagementTracker.setAutoplaySession(!1),new lt.Promise(freeOnUnref(function(e,t){oe.timer.setImmediate(freeOnUnref(function(){n.playlistPlaybackController.play().then(e).catch(t)}))})))}),e.prototype.seek=freeOnUnref(function(o,a){var s=this,e=this.seekInterceptorManager.getAdAwareSeekInterceptor(),l=this.playlistEngine.getCurrentItemIndex();(null!=e&&null!=a?e.interceptSeek(o,a,this.timeline):lt.Promise.resolve(a)).then(freeOnUnref(function(e){var t;a!==e&&(m.info("Encountered a change in seekToItemIndex during seek. From "+a+" -> "+e),a=e),null===o&&(o=1/0),m.info(">> seek, to "+o+"ms on timeline item index "+a),t=null==a||null===l||a===l?o>=s.currentTime.currentPosition?"SeekForward":"SeekBackward":l<a?"SeekForward":"SeekBackward",s.metricsReportingFeature.reportInteraction("PlayerSDK",t,"Client",null,null,null,"Client"),s.diagnostics.report("interaction",{type:t,positionMs:o,itemIndex:a});var n=Qe.withDefault(a,l);if(null!=n){s.playlistAutoplayBarrier.resetInteractions();var r=s.playlistEngine.getItems()[n];if(null!=r.initializeContentCallback)r.initializeContentCallback().then(freeOnUnref(function(){s.destroyed.throwIfRequested(),s.playlistEngine.seek(1/0,n)})).catch(freeOnUnref(function(e){e instanceof lt.CancelError||m.error("Error happened when processing a deferred content",e)}));else{var i=o-r.timelineStart+r.start;s.excessiveWaitingTracker.restartWaiting(),s.playlistEngine.seek(i,n)}}else m.error("Cannot seek without at least a current item index")}))}),e.prototype.seekToWallClockTime=freeOnUnref(function(e){m.info(">> seek, to wall clock time "+e+"ms on current timeline item");var t=this.playlistEngine.getCurrentItemIndex();if(null!=t){var n=this.playlistEngine.getItems()[t].contentSource;if(null!=n){var r=n.wallClockUtcTimeToContentTime(e);if(null==r)throw new Error("Unable to compute content time for wall clock time "+e);this.playlistEngine.seek(r,t)}else m.error("Cannot seek to wall clock time, as current playlist item does not have a ContentSource")}else m.error("Cannot seek to wall clock time without a current item index")}),e.prototype.setPlaybackRate=freeOnUnref(function(e){if(m.info("set playback rate to "+e),e<=0)throw new Error("Do not support zero or negative playback rate");this.mpPlayerProxy.playbackRate=e}),e.prototype.performOnEnter=freeOnUnref(function(e,t){1===t?m.info("Required pause on enter content with groupId: "+e):m.info("Required auto play on enter content with groupId "+e),this.playlistPlaybackController.performOnEnter(e,t)}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.eventEmitter.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.updateLinearScheduleTimeline=freeOnUnref(function(e){this.liveMetadataPlaylistUpdate.updateLinearScheduleTimeline(e)}),e.prototype.getTier=freeOnUnref(function(){var e=null==this.tier?"Max":this.tier;return{currentTier:e,maxTier:e,token:this.multiviewToken}}),e.prototype.applyFlexibleLayoutRestrictions=freeOnUnref(function(e){this.streamFeature.setMaxResolution(e.resolution.width,e.resolution.height),this.streamFeature.setUnsupportedCodecs("Audio",e.blockedAudioCodecs),this.streamStartOverrides={hdrBlocklist:e.blockedHdrFormat,allowedCodecs:e.allowedVideoCodecs,disableDashForLive:!0}}),e.prototype.removeMultiviewRestrictions=freeOnUnref(function(){this.streamFeature.setMaxResolution(0,0),this.streamFeature.setUnsupportedCodecs("Audio",[]),this.streamStartOverrides=null}),e.prototype.restart=freeOnUnref(function(){this.internalRestart()}),e.prototype.setTier=freeOnUnref(function(e,t){throw new Error("Not implemented, do not use. Use `updateTokens()` on the MultiviewFeature instead")}),e.prototype.attachProxyListeners=freeOnUnref(function(){var t=this;this.timelineManager.on("TimelineChange",freeOnUnref(function(e){t.eventEmitter.emit("TimelineChange",e)})),this.timelineManager.on("TimelineEnded",freeOnUnref(function(){t.eventEmitter.emit("TimelineEnded")})),this.timelineManager.on("TimelineBlocked",this.onTimelineBlocked),this.timeDataManager.on("TimeDataChange",freeOnUnref(function(e){t.eventEmitter.emit("TimeDataChange",e)}))}),e.prototype.setContentError=freeOnUnref(function(e){if(null===e)return null!==this.contentError&&m.warn("Clearing contentError"),void(this.contentError=null);e.code!==Ni.codes.xp.content.playback_waiting_timeout&&this.excessiveWaitingTracker.waitingCompleted(),this.canUpdateContentState=!1;var t=_v.InternalToExternalCodeConverter.convertCode(e);this.contentState=ka.ContentState.Error,this.contentError=t,m.warn("ContentError:",e,", public contentError:",t),this.mpPlayerProxy.pause(),this.eventEmitter.emit("ContentStateChange",this.contentState),this.eventEmitter.emit("ContentError",t)}),e.prototype.setPlaybackState=freeOnUnref(function(e){this.playbackState!==e&&(this.playbackState=e,this.eventEmitter.emit("PlaybackStateChange",this.playbackState),this.diagnostics.report("playbackStateChanged",{positionMs:this.mpPlayerProxy.currentTimeMs,state:e===ka.PlaybackState.Playing?"playing":"paused"}))}),e.prototype.setPlayerState=freeOnUnref(function(e){this.playerState!==e&&(this.playerState=e,this.eventEmitter.emitSync("PlayerStateChange",this.playerState))}),e.prototype.startingSeekToMainContentPosition=freeOnUnref(function(e,t){var n=this.publicTimeTranslator.nominalizeRequestPosition(e,t),r=this.publicTimeTranslator.getPlaylistPosition(n,t);m.info("Requested (nominal) start position: "+n+". Attempting to start at "+r.position+"ms within item index "+r.playlistItemIndex),this.playlistEngine.seek(r.position,r.playlistItemIndex,!0)}),e.prototype.createServiceClientFactory=freeOnUnref(function(e){var t={deviceID:e.deviceId,deviceTypeID:e.deviceTypeId,gascEnabled:!Wy.MarketplaceID.isClassic(e.marketplaceId),marketplaceID:e.marketplaceId};null!=e.uxLocale&&(t.uxLocale=e.uxLocale);var n=zt.deviceInformation.hardware.zipcode;return null!=n&&(t["comcast-zipcode"]=n),new yr.ServiceClientFactory(e.deviceProxyUrl,t,e.authContext)}),e.prototype.tryReportOpen=freeOnUnref(function(){this.mediaEventController.isOpen()||(m.warn("Playback.Open not reported by Client, when expected to have an Open session"),q.metrics.putMetric("MissingClientPlaybackOpen")),this.mediaEventController.reportPlayback("Open")}),e.prototype.tryReportExit=freeOnUnref(function(){this.shouldXpReportPlaybackOpenExit&&this.mediaEventController.reportPlayback("Exit")}),e.prototype.reportStopForUnload=freeOnUnref(function(){this.mediaEventController.reportPlayback("Stop")}),e.prototype.isItemSameForContentConfig=freeOnUnref(function(e,t){null==this.contentConfig&&m.warn("Unexpected: this.contentConfig is null while this.playlistEngine.getCurrentItem exists");var n=Qe.nestedValue(this.contentConfig,"playbackEnvelope.correlationId",null),r=Qe.nestedValue(t,"playbackEnvelope.correlationId",null);return null!==n&&null!==r?n===r:(m.error("Reached deprecated code. All playback envelopes must contain correlation id."),e.titleId===t.titleId&&e.playbackData.videoMaterialType===t.videoMaterialType&&x.isEqual(e.encodePreferences,t.encodePreferences)&&(null==this.contentConfig||x.isEqual(this.contentConfig.playbackEnvelope,t.playbackEnvelope)))}),e.prototype.isSuperDraperRequest=freeOnUnref(function(e){var t="Promo"===e.videoMaterialType,n=Qe.nestedValue(e,"isSuperDraperV2",!1);return t||n}),e})();t.XpPlayer=c}));e(KA);KA.XpPlayer;var GA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a={HDR10:"HDR10",HDR10Plus:"HDR10Plus",DolbyVision:"DolbyVision"},s={Unknown:"Unknown",None:"None",NoDigitalOutput:"NoDigitalOutput",V1:"V1",V2:"V2",V2_1:"V2_1",V2_2:"V2_2"},l={Filmmaker:"Filmmaker",CalibratedCinematic:"CalibratedCinematic",CalibratedBroadcast:"CalibratedBroadcast"},f={NotSupported:"NotSupported",InitialSizeOnly:"InitialSizeOnly",NextPlaybackOnly:"NextPlaybackOnly",Immediately:"Immediately"},r={H264:"H264",H265:"H265",AV1:"AV1"};var n=freeOnUnref(function(){function e(){var o=this;this.objectId="XpPlayerSDK-PlayerCapabilities-"+Math.random(),this.version="0.0.1",this.eventEmitter=new A.EventEmitter,this.verifiedSecurePipeline=!0,this.supportedPictureModes=[],this.supportedPlayerResizingMode=void 0,this.deviceCapabilities=null,this.isFmmEnabledInDIS=!1,this.isCalibratedModeDisabledInDIS=!1,this.supportsAudioMuting=!1,this.supportsAudioVolume=!1,this.storeDisplayCapabilities=freeOnUnref(function(e){if(o.maxVideoResolution={width:e.width,height:e.height},o.hdrFormats=e.dynamicRangeFormatSupport.map(freeOnUnref(function(e){return a[e]})),o.hdcpStatus=s[e.hdcpStatus],o.supportedPictureModes=[],null!=e.supportedPictureModes)for(var t=0,n=e.supportedPictureModes;t<n.length;t++){var r=n[t],i=l[r];"Filmmaker"===i&&o.isFmmEnabledInDIS&&o.supportedPictureModes.push(i),"CalibratedBroadcast"!==i&&"CalibratedCinematic"!==i||o.isCalibratedModeDisabledInDIS||o.supportedPictureModes.push(i)}void 0!==e.supportedPlayerResizingMode&&(o.supportedPlayerResizingMode=f[e.supportedPlayerResizingMode])})}return e.prototype.initialize=freeOnUnref(function(e){var t=this;if(this.isInitialized())return lt.Promise.reject(new ct.XpError("xp.player_capabilities.already_initialized"));this.deviceCapabilities=e,this.isFmmEnabledInDIS=!0===Qe.nestedValue(L.configurationStore.configuration,"device.isFmmEnabled"),this.isCalibratedModeDisabledInDIS=!0===Qe.nestedValue(L.configurationStore.configuration,"device.isCalibratedModeDisabled");var n=!0===Qe.nestedValue(L.configurationStore.configuration,"multiview.enabled");return this.supportsAudioMuting=n,this.supportsAudioVolume=n,this.storeDisplayCapabilities(e.output.video.display),e.on("output.video.display",this.storeDisplayCapabilities),Bi.CodecsQuerier.querySupportedVideoCodecs().then(freeOnUnref(function(e){return e.filter(freeOnUnref(function(e){return null!=r[e]})).map(freeOnUnref(function(e){return r[e]}))})).then(freeOnUnref(function(e){t.videoCodecs=e}))}),e.prototype.uninitialize=freeOnUnref(function(){null!=this.deviceCapabilities&&(this.deviceCapabilities.off("output.video.display",this.storeDisplayCapabilities),this.deviceCapabilities=null)}),e.prototype.getDeviceCapabilities=freeOnUnref(function(){return this.isInitialized()?lt.Promise.resolve([{maxVideoOutputResolution:this.maxVideoResolution,hdrFormats:this.hdrFormats,hdcpStatus:this.hdcpStatus,videoCodecs:this.videoCodecs,verifiedSecurePipeline:this.verifiedSecurePipeline,supportedPictureModes:this.supportedPictureModes,supportedPlayerResizingMode:this.supportedPlayerResizingMode,supportsAudioVolume:this.supportsAudioVolume,supportsAudioMuting:this.supportsAudioMuting}]):lt.Promise.reject(new ct.XpError("xp.player_capabilities.not_initialized"))}),e.prototype.setVerifiedSecurePipeline=freeOnUnref(function(e){e!==this.verifiedSecurePipeline&&this.eventEmitter.emit("VerifiedSecurePipelineChange",e),this.verifiedSecurePipeline=e}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.toJSON=freeOnUnref(function(){return{objectId:this.objectId,version:this.version}}),e.prototype.isInitialized=freeOnUnref(function(){return null!=this.maxVideoResolution||null!=this.hdrFormats||null!=this.hdcpStatus||null!=this.videoCodecs}),e})();t.XpPlayerCapabilitiesFeature=n}));e(GA);GA.XpPlayerCapabilitiesFeature;var QA=t(freeOnUnref(function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0});var r=((n={})[0]="debug",n[1]="info",n[2]="info",n[3]="warn",n[4]="error",n);t.LogLevelToFirewoodLevelMap=r}));e(QA);QA.LogLevelToFirewoodLevelMap;var XA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){this.setSushiConfiguration(e,t)}return e.prototype.setSushiConfiguration=freeOnUnref(function(e,t){this.eelEndpoint="https://"+e+"/1/events/"+t}),e.prototype.send=freeOnUnref(function(n,e,t){var o=this,a=this.eelEndpoint;(new _n.ExponentialBackoffRetry).withMaxAttempts(2).withInitialIntervalMs(5e3).withExponentialFactor(5).onError(freeOnUnref(function(e){null!=t&&t(e,n)})).onSuccess(freeOnUnref(function(){null!=e&&e()})).onAttempt(freeOnUnref(function(e,r,t,i){new pn.HttpRequest("POST",a).json(o.buildPayloadObject(n)).onLoad(freeOnUnref(function(e){return t(e)})).timeout(6e3).onError(freeOnUnref(function(e,t){if(null==t)r(e);else{var n=t.getStatus();500<=n&&n<=599?r(e):429===n?r(e):i(e)}})).send()})).execute()}),e.prototype.buildPayloadObject=freeOnUnref(function(e){return{events:e.map(freeOnUnref(function(e){return{data:e}}))}}),e})();t.EelClient=n}));e(XA);XA.EelClient;var YA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("FirewoodLogSink"),n=freeOnUnref(function(){function e(e,t,n,r,i,o){void 0===i&&(i=0),void 0===o&&(o=new XA.EelClient(e,t));var a=this;this.pendingLogs=[],this.pendingLogsSize=0,this.fields=null,this.offlineReportingBatchManager=null,this.flush=freeOnUnref(function(){oe.timer.clearTimeout(a.postIntervalId),0<a.pendingLogs.length&&(a.logSender.send(a.pendingLogs,void 0,a.storeOfflineLoggingBatch),a.pendingLogs=[],a.pendingLogsSize=0),a.postIntervalId=oe.timer.setTimeout(a.flush,6e4)}),this.storeOfflineLoggingBatch=freeOnUnref(function(e,t){null!=a.offlineReportingBatchManager&&(a.offlineReportingBatchManager.cleanupReportingBatches(),a.offlineReportingBatchManager.storeReportingBatch(t).catch(freeOnUnref(function(e){s.error("Failed to write media event batch to local storage "+e)})))}),this.tryDispatchOfflineLoggingBatches=freeOnUnref(function(){"none"!==zt.deviceCapabilities.network.type&&a.offlineReportingBatchManager.dispatchReportingBatches(a.dispatchOfflineLoggingBatches)}),this.dispatchOfflineLoggingBatches=freeOnUnref(function(n){return new lt.Promise(freeOnUnref(function(e,t){a.logSender.send(n,freeOnUnref(function(){return e()}),freeOnUnref(function(e){return t(e)}))}))}),this.deviceId=n,this.deviceTypeId=r,this.logSender=o,this.logLevel=i,this.postIntervalId=oe.timer.setTimeout(this.flush,6e4),this.baseLineSize=this.estimateBaseLineSize()}return e.prototype.initialize=freeOnUnref(function(){this.offlineReportingBatchManager=pg.OfflineReportingBatchManagerFactory.createOfflineReportingBatchManager("logging_batches/",1e3,14,!0),this.offlineReportingBatchManager.dispatchReportingBatches(this.dispatchOfflineLoggingBatches),zt.deviceCapabilities.on("network",this.tryDispatchOfflineLoggingBatches)}),e.prototype.stop=freeOnUnref(function(){zt.deviceCapabilities.off("network",this.tryDispatchOfflineLoggingBatches),this.flush(),oe.timer.clearTimeout(this.postIntervalId)}),e.prototype.setSushiConfiguration=freeOnUnref(function(e,t){this.flush(),this.logSender.setSushiConfiguration(e,t)}),e.prototype.setPlayerVersion=freeOnUnref(function(e){this.playerVersion=e,this.baseLineSize=this.estimateBaseLineSize()}),e.prototype.setAppInstanceId=freeOnUnref(function(e){this.appInstanceId=e,this.baseLineSize=this.estimateBaseLineSize()}),e.prototype.setFields=freeOnUnref(function(e){this.fields=e,this.baseLineSize=this.estimateBaseLineSize()}),e.prototype.getLevel=freeOnUnref(function(){return this.logLevel}),e.prototype.setLevel=freeOnUnref(function(e){this.logLevel=e}),e.prototype.write=freeOnUnref(function(e,t){if(!(e<this.logLevel)){var n=this.toLogLine(QA.LogLevelToFirewoodLevelMap[e],t),r=this.estimateLogSize(n.message);838860.8<this.pendingLogsSize+r&&this.flush(),this.pendingLogs.push(n),this.pendingLogsSize+=r,500<=this.pendingLogs.length&&this.flush()}}),e.prototype.toLogLine=freeOnUnref(function(e,t){var n={deviceId:this.deviceId,deviceTypeId:this.deviceTypeId,level:e,message:t,timestamp:Date.now(),app:"XpPlayer",appInstanceId:this.appInstanceId,playerVersion:this.playerVersion};if(null==this.fields)return n;for(var r=0,i=Object.keys(this.fields);r<i.length;r++){var o=i[r];n[o]=this.fields[o]}return n}),e.prototype.estimateBaseLineSize=freeOnUnref(function(){var e=this.toLogLine("debug","");return JSON.stringify(e).length}),e.prototype.estimateLogSize=freeOnUnref(function(e){return this.baseLineSize+e.length}),e})();t.FirewoodLogSink=n}));e(YA);YA.FirewoodLogSink;var JA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.FirewoodLogSink=YA.FirewoodLogSink,t.EelClient=XA.EelClient}));e(JA);JA.FirewoodLogSink,JA.EelClient;var ZA=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=["fragmentDownloaded","fragmentDownloadFailed","qualityChanged","playbackStateChanged","contentStateChanged","sourceBufferChanged","fragmentBufferChanged","cdnSwitched","interaction"],n=freeOnUnref(function(){function e(e,t){this.events=[],this.appInstanceId=null,this.sushiClient=new JA.EelClient(e,t)}return e.prototype.setAppInstanceId=freeOnUnref(function(e){this.appInstanceId=e}),e.prototype.setSushiConfiguration=freeOnUnref(function(e,t){this.sushiClient.setSushiConfiguration(e,t)}),e.prototype.onEvent=freeOnUnref(function(e,t,n){null!=this.appInstanceId&&-1!==r.indexOf(t)&&(this.events.push({timestamp:Date.now(),appInstanceId:this.appInstanceId,componentId:e,event:t,data:n}),100<=this.events.length&&this.flush())}),e.prototype.flush=freeOnUnref(function(){this.sushiClient.send(this.events),this.events=[]}),e})();t.PlaybackDiagnosticsSink=n}));e(ZA);ZA.PlaybackDiagnosticsSink;var $A=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.XpPlayer=KA.XpPlayer,t.XpPlayerCapabilitiesFeature=GA.XpPlayerCapabilitiesFeature,t.XpPlayerMetricsReportingFeature=u_.XpPlayerMetricsReportingFeature,t.SessionIdTracker=RA.SessionIdTracker,t.PlaybackDiagnosticsSink=ZA.PlaybackDiagnosticsSink,t.CuepointPlaylistProcessor=qU.CuepointPlaylistProcessor,t.PlaylistedPlaybackUrlsSourceCdnStore=nb.PlaylistedPlaybackUrlsSourceCdnStore,t.LayoutType=WA.LayoutType,t.generateToken=WA.generateToken,t.getTokenCapabilities=WA.getTokenCapabilities}));e($A);$A.XpPlayer,$A.XpPlayerCapabilitiesFeature,$A.XpPlayerMetricsReportingFeature,$A.SessionIdTracker,$A.PlaybackDiagnosticsSink,$A.CuepointPlaylistProcessor,$A.PlaylistedPlaybackUrlsSourceCdnStore,$A.LayoutType,$A.generateToken,$A.getTokenCapabilities;var eD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.eventEmitter=new A.EventEmitter,this.playbackUrls=e,this.currentUrlSet=this.playbackUrls.urlSets[this.playbackUrls.defaultUrlSetId]}return e.prototype.get=freeOnUnref(function(){return this.toSourceUrl(this.currentUrlSet)}),e.prototype.getCurrentManifestData=freeOnUnref(function(){return this.currentUrlSet.urls.manifest}),e.prototype.resourceAcquired=freeOnUnref(function(e){}),e.prototype.resourceAcquisitionFailed=freeOnUnref(function(e,t,n){return!0}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.toSourceUrl=freeOnUnref(function(e){return{url:e.urls.manifest.url,urlId:e.urlSetId,headers:{},getAccessToken:freeOnUnref(function(){return{type:"NoToken"}})}}),e})();t.CachePlaybackUrlsSourceUrlStore=n}));e(eD);eD.CachePlaybackUrlsSourceUrlStore;var tD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.CACHED_CONTENT_METADATA_VERSION=1}));e(tD);tD.CACHED_CONTENT_METADATA_VERSION;var nD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("CacheRemoteItemResolver"),n=freeOnUnref(function(){function e(e,t){this.serviceClientFactory=e,this.traceEventReporter=null!=t?t:new Tv.NoopTraceEventReporter}return e.prototype.resolveRemoteItem=freeOnUnref(function(e,t,n){return r.info("Resolving remote item, breakType: "+n+", URLs: "+e.urlsInPriorityOrder.length),new GU.RegolithClient(n,e.urlsInPriorityOrder,e.resolutionConstraints.maxRetryCountPerUrl,e.resolutionConstraints.timeoutInMs,this.serviceClientFactory,this.traceEventReporter).send(t).then(freeOnUnref(function(e){var t=null!=e.playlist?e.playlist.length:0;return r.info("Remote item resolved successfully, breakType: "+n+", ads: "+t),e})).catch(freeOnUnref(function(e){return r.error("Failed to resolve remote item for "+n+": "+e.message),null}))}),e})();t.CacheRemoteItemResolver=n}));e(nD);nD.CacheRemoteItemResolver;var rD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var v=de.get("CachePlaylistedPeriodFactory"),n=freeOnUnref(function(){function e(){}return e.createPeriodFromPlaylistItem=freeOnUnref(function(e,t,n,r,i,o,a,s,l){for(var f=e.endMs-e.startMs,u=!a,c=[],d=0,p=e.urls;d<p.length;d++){var h=p[d];c.push({cdn:h.cdn,url:h.url,origin:h.origin,consumptionId:h.consumptionId,assetConsumptionId:h.consumptionId,edgeDeliveryAuthorization:h.edgeDeliveryAuthorization})}var m=null!=l?3:0,y=new ih.PlaylistedPeriod(e.type+"_"+t,f,n,r,c,i,o,Hf.mapAudioTracks(e.audioTracks),e.type,new Tv.NoopTraceEventReporter,freeOnUnref(function(){}),u,s,m,l);return v.info("Created period from "+e.type+" item: "+y.id+", duration: "+f+"ms"),y}),e.createPeriodFromRegolithAd=freeOnUnref(function(e,t,n,r,i,o,a,s,l){for(var f=jr.extendedLimitedIso8601TimeFormatToMilliseconds(e.description.duration),u=[],c=0,d=e.media.urls;c<d.length;c++){var p=d[c],h=null!=i[p.cdn]?i[p.cdn]:o,m=p.consumptionId;u.push({url:p.url,cdn:p.cdn,origin:p.origin,consumptionId:h,assetConsumptionId:m,edgeDeliveryAuthorization:p.edgeDeliveryAuthorization})}var y=null!=l?3:0,g=new ih.PlaylistedPeriod("Adbreak"+t+"_Ad"+n,f,r,!1,u,a,s,null,"Remote",new Tv.NoopTraceEventReporter,freeOnUnref(function(){}),!0,!1,y,l);return v.info("Created period from ad: "+g.id+", duration: "+f+"ms"),g}),e})();t.CachePlaylistedPeriodFactory=n}));e(rD);rD.CachePlaylistedPeriodFactory;var iD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(e){return"Init"+e});t.convertStateIntoInitAction=n}));e(iD);iD.convertStateIntoInitAction;var oD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=ih,n=freeOnUnref(function(){function f(e,t,n,r,i,o,a,s,l){var f,u=this;this.log=new Ka.EphemeralJSLogger("CachedContent"),this.fragmentSizeBytes=0,this.onLicenseAcquisitionSuccess=freeOnUnref(function(e){}),this.onLicenseAcquisitionFailure=freeOnUnref(function(e){}),this.onError=freeOnUnref(function(e){throw u.stateMachine.actNow("Error",e),u.log.error("onError, error: "+e.message),q.metrics.putMetric("XpPlayer.Cache.PutFatalError"),e}),this.onEnterErrorState=freeOnUnref(function(){u.emitEvent("DownloadError"),u.updateCachedContentMetadata("Error")}),this.id=e,this.internalCreateTimestampMs=Date.now(),this.cacheContentConfig=t,this.cacheLevel=null!=t.cachingLevel?t.cachingLevel:ka.CacheLevel.DATA_SAVER,this.bufferManager=n,this.prioritizationSystem=r,this.prsResolver=i,this.videoQualityOverrideStorage=o,this.mediaKeysManagerProvider=a,this.metadataKey=vu.createCachedContentMetadataKey(e),this.serviceClientFactory=s,this.startDownloadPromise=null,this.eventEmitter=new A.EventEmitter,this.hasAds=!1,this.isPlaylistedContent=!1;var c=Jl.expandCustomMatcherLanguages(t.audioStreamMatchers);this.streamMatchers=((f={})[vu.MediaRepresentationStreamTypeMap.Audio]=c.map(freeOnUnref(function(e){return vu.StreamMatcherTransformer.convertStreamMatcherToTypeMatcher(vu.MediaRepresentationStreamTypeMap.Audio,e)})),f),this.cacheRemoteItemResolver=new nD.CacheRemoteItemResolver(this.serviceClientFactory),this.stateMachine=new ml.FiniteStateMachine("Pending"),this.setupStateMachine(),this.log.setId(this.id),null!=l&&(this.fragmentSizeBytes=null!=l.fragmentSizeBytes?l.fragmentSizeBytes:0,this.internalCreateTimestampMs=l.createTimeMs,this.hasAds=l.hasAds,this.stateMachine.actNow(iD.convertStateIntoInitAction(l.state)))}return f.createCachedContentFromMetadata=freeOnUnref(function(n,r,i,o,a,s,l){return Jo.metadataStorage.get(vu.createCachedContentMetadataKey(n)).then(freeOnUnref(function(e){if(null==e)throw new Error("Could not find persistent metadata for cached content "+n);var t=e;return new f(n,t.cacheContentConfig,r,i,o,a,s,l,t)}))}),Object.defineProperty(f.prototype,"startPositionMs",{get:freeOnUnref(function(){return null!=this.cacheContentConfig.contentConfig.position?this.cacheContentConfig.contentConfig.position:0}),enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"createTimestampMs",{get:freeOnUnref(function(){return this.internalCreateTimestampMs}),enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"state",{get:freeOnUnref(function(){return this.stateMachine.state}),enumerable:!0,configurable:!0}),f.prototype.resetCreateTime=freeOnUnref(function(){this.internalCreateTimestampMs=Date.now()}),f.prototype.initialize=freeOnUnref(function(){var e=this,t={downloadOperationId:this.id},n=this.bufferManager.reserveForContent({contentId:this.id,sizeBytes:this.fragmentSizeBytes,priorityComparable:this.prioritizationSystem.getPriorityComparable(t,{type:"Title"}),flush:freeOnUnref(function(){return e.delete(),!0})});return n.fulfilled?(this.reservationResponse=n,!0):(this.log.warn("Initialization failed due to insufficient storage space."),!1)}),f.prototype.start=freeOnUnref(function(){this.log.info(">> start, titleId: "+this.cacheContentConfig.contentConfig.titleId+", id: "+this.id),this.stateMachine.actNow("StartDownloading")}),f.prototype.delete=freeOnUnref(function(){this.log.info(">> delete, titleId: "+this.cacheContentConfig.contentConfig.titleId+", id: "+this.id),this.stateMachine.actNow("StartDeleting")}),f.prototype.isSameCorrelationId=freeOnUnref(function(e){var t=this.cacheContentConfig.contentConfig.playbackEnvelope;return null!=e&&null!=e.correlationId&&null!=t&&null!=t.correlationId&&t.correlationId===e.correlationId}),Object.defineProperty(f.prototype,"correlationId",{get:freeOnUnref(function(){var e=this.cacheContentConfig.contentConfig.playbackEnvelope;return null==e||null==e.correlationId?null:e.correlationId}),enumerable:!0,configurable:!0}),f.prototype.isSameContent=freeOnUnref(function(e){return this.cacheContentConfig.contentConfig.titleId===e.titleId&&this.cacheContentConfig.contentConfig.videoMaterialType===e.videoMaterialType}),f.prototype.updateTTL=freeOnUnref(function(){return this.updateCachedContentMetadata(this.stateMachine.state)}),f.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),f.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),f.prototype.startDownload=freeOnUnref(function(){var t=this;return null==this.startDownloadPromise&&(this.startDownloadPromise=this.updateCachedContentMetadata("Downloading").then(freeOnUnref(function(){return t.cachePlaybackResources()})).then(freeOnUnref(function(){return t.cacheContentBasedOnType()})).then(freeOnUnref(function(){return t.checkCompleted()})).catch(freeOnUnref(function(e){return t.onError(e)}))),this.startDownloadPromise}),f.prototype.checkCompleted=freeOnUnref(function(){this.cacheLevel===ka.CacheLevel.MAX&&this.contentSource instanceof Ty.FragmentContentSource?this.startBufferCheck():this.stateMachine.actNow("Complete")}),f.prototype.deleteDownload=freeOnUnref(function(){var t=this;return null!=this.reservationResponse&&(this.reservationResponse.onFreed(),this.reservationResponse=void 0),this.startDownloadPromise=null,this.updateCachedContentMetadata("Deleting").then(freeOnUnref(function(){return Jo.metadataStorage.remove(vu.createCachedSelectionContextKey(t.id))})).then(freeOnUnref(function(){return t.deleteManifestPromise()})).then(freeOnUnref(function(){return t.deleteRegolithResponsePromise()})).then(freeOnUnref(function(){return Pt.localStorage.remove(vu.createCachedPlaybackResourcesKey(t.id))})).then(freeOnUnref(function(){return t.removeCachedDrm()})).then(freeOnUnref(function(){return Jo.metadataStorage.remove(vu.createCachedContentMetadataKey(t.id))})).then(freeOnUnref(function(){return Pt.localStorage.removePrefix(t.id+"/")})).then(freeOnUnref(function(){return t.prioritizationSystem.removeCachedContent(t)})).then(freeOnUnref(function(){return t.stateMachine.actNow("FinishDeleting")})).then(freeOnUnref(function(){return t.eventEmitter.emit("CachedContentDeleted",{downloadOperationId:t.id})})).catch(freeOnUnref(function(e){return t.onError(e)}))}),f.prototype.deleteRegolithResponsePromise=freeOnUnref(function(){var t=this;return this.isPlaylistedContent&&!this.canCachePlaylistedContent()?lt.Promise.resolve():Pt.localStorage.remove(vu.createCachedRegolithResponseKey(this.id,0)).catch(freeOnUnref(function(e){t.log.warn("LocalStorage: Could not remove regolith response key "+vu.createCachedRegolithResponseKey(t.id,0),e)}))}),f.prototype.deleteManifestPromise=freeOnUnref(function(){var t=this;return Pt.localStorage.removePrefix(ih.createManifestKey(this.id)).catch(freeOnUnref(function(e){t.log.warn("LocalStorage: Could not remove manifest key "+ih.createManifestKey(t.id),e)}))}),f.prototype.cachePlaybackResources=freeOnUnref(function(){var i=this;if(this.log.info("Playback resources cache, titleId: "+this.cacheContentConfig.contentConfig.titleId),null==this.cacheContentConfig.contentConfig.playbackEnvelope)return lt.Promise.reject(new Error("Cannot resolve when the playback envelope is missing"));var e=lt.CancelToken.source(),o=e.token;e.cancel;return this.deleteManifestPromise().then(freeOnUnref(function(){return i.deleteRegolithResponsePromise()})).then(freeOnUnref(function(){return i.prsResolve(o)})).then(freeOnUnref(function(e){o.throwIfRequested(),i.prsResolverContentBaseResources=e.main;var t=e.main.playbackResources,n=null!=t.playlistedPlaybackUrls&&t.playlistedPlaybackUrls.ok;if(n&&!i.canCachePlaylistedContent())return lt.Promise.reject(new Error("Unable to cache ExPL content due to configuration check"));if(i.isPlaylistedContent=n){var r=Hf.PlaybackResourceUtils.valueOrNull(t.playlistedPlaybackUrls);null!=r&&(i.hasAds=i.detectAdContentFromEXPL(r))}else i.hasAds=i.detectAdContentFromPrs(i.prsResolverContentBaseResources);return Pt.localStorage.put(vu.createCachedPlaybackResourcesKey(i.id),JSON.stringify(t)).then(freeOnUnref(function(){return i.log.info("Playback resources cache success, titleId: "+i.cacheContentConfig.contentConfig.titleId+", id: "+i.id+", hasAds: "+i.hasAds),i.updateTTL()})).catch(freeOnUnref(function(e){throw i.log.error("Playback resources cache failed, titleId: "+i.cacheContentConfig.contentConfig.titleId+", error: "+e.message+", id: "+i.id+", hasAds: "+i.hasAds),e}))}))}),f.prototype.prsResolve=freeOnUnref(function(e){return this.isContentLiveStreaming()?this.prsResolver.resolveCacheLiveV2(this.cacheContentConfig.contentConfig,e,this.videoQualityOverrideStorage):this.prsResolver.resolveCacheVodV2(this.cacheContentConfig.contentConfig,e,this.videoQualityOverrideStorage)}),f.prototype.cacheContentBasedOnType=freeOnUnref(function(){return this.isPlaylistedContent?this.cacheEXPLContent():this.cacheSSAIContent()}),f.prototype.cacheSSAIContent=freeOnUnref(function(){var e=this;return this.cacheManifest().then(freeOnUnref(function(){return e.cacheDrm()})).then(freeOnUnref(function(){return e.cacheFragments()}))}),f.prototype.cacheManifest=freeOnUnref(function(){var r=this;if(!this.hasMinimumCacheLevel(ka.CacheLevel.DATA_SAVER)||this.isContentLiveStreaming())return lt.Promise.resolve();if(this.log.info("Manifest cache, titleId: "+this.cacheContentConfig.contentConfig.titleId+", id: "+this.id),null==this.prsResolverContentBaseResources)return lt.Promise.reject(new Error("Attempted to cache the manifest when no PRSResolverContext exists"));var e=Hf.PlaybackResourceUtils.valueOrNull(this.prsResolverContentBaseResources.playbackResources.playbackUrls);if(null==e)return lt.Promise.reject(new Error("PlaybackUrls cannot be null"));var t=Hf.PlaybackResourceUtils.valueOrUndefined(this.prsResolverContentBaseResources.playbackResources.fairPlayApplicationCertificate),n=Hf.PlaybackResourceUtils.valueOrNull(e.playbackSettings),i=null;null!==n&&(i=n.playbackSettings);var o=Ly.PlaybackSettingsProviderFactory.createFromEncodedPlaybackSettingsResponse(i),a=Ef.SubtitleUrlTransformer.transformV2TimedTextUrls(Hf.PlaybackResourceUtils.valueOrUndefined(this.prsResolverContentBaseResources.playbackResources.subtitleUrls)),s=Ef.SubtitleUrlTransformer.transformV2TimedTextUrls(Hf.PlaybackResourceUtils.valueOrUndefined(this.prsResolverContentBaseResources.playbackResources.forcedNarratives)),l=Ef.SubtitleUrlTransformer.toTimedTextStreams(this.cacheContentConfig.contentConfig.titleId,a,s),f=e.urlSets[e.defaultUrlSetId].urls.manifest.streamingTechnology,u=e.urlSets[e.defaultUrlSetId].urls.manifest.dynamicRange,c=this.hasMinimumCacheLevel(ka.CacheLevel.MAX)?"Disk":void 0,d=Ty.ContentSourceFactory.create(freeOnUnref(function(e,t,n){return r.prsResolverContentBaseResources.licenseAcquirer.acquireLicense(e,t,n)}),Hf.fromPlaybackUrls(e),o,this.prioritizationSystem,this.bufferManager,new eD.CachePlaybackUrlsSourceUrlStore(e),f,this.prsResolverContentBaseResources.playbackResources.playbackData.videoMaterialType,Hf.mapAudioTracks(e.audioTracks),l,void 0,void 0,this.id,"ApplicationViewportSize",void 0,3,this.streamMatchers,void 0,new Hf.SuggestedPictureModeStrategy(this.cacheContentConfig.contentConfig,u).getSuggestedPictureModes(),t,c);d.cancel;return d.contentSourceContextPromise.then(freeOnUnref(function(e){r.representationSource=e.representationSource,r.contentSource=e.contentSource,r.representationSource.mediaRepresentation.valid||(r.log.warn("Media representation is not valid, attempting to refresh it"),r.representationSource.mediaRepresentation.refresh().then(freeOnUnref(function(){r.log.info("Manifest cache success (with media representation refresh), titleId: "+r.cacheContentConfig.contentConfig.titleId+", id: "+r.id)}))),r.log.info("Manifest cache success, titleId: "+r.cacheContentConfig.contentConfig.titleId+", id: "+r.id)})).catch(freeOnUnref(function(e){throw r.log.error("Manifest cache failed, titleId: "+r.cacheContentConfig.contentConfig.titleId+", id: "+r.id+", error: "+e.message),e}))}),f.prototype.cacheDrm=freeOnUnref(function(){var t=this;if(!this.hasMinimumCacheLevel(ka.CacheLevel.BALANCED))return lt.Promise.resolve();var e=L.configurationStore.configuration;if(null==e||null==e.drm||null==e.drm.usePersistentSession||!e.drm.usePersistentSession)return this.log.info("Configuration usePersistentSession false, skipping persistent license caching"),lt.Promise.resolve();if(null==this.prsResolverContentBaseResources)return lt.Promise.reject(new Error("Attempted to cache DRM when PRS resolver content is invalid"));if(null==this.representationSource||!this.representationSource.mediaRepresentation.valid)return lt.Promise.reject(new Error("Attempted to cache DRM when media representation is invalid"));var n=this.prsResolverContentBaseResources.licenseAcquirer;n.on("licenseAcquired",this.onLicenseAcquisitionSuccess),n.on("licenseAcquisitionFailed",this.onLicenseAcquisitionFailure);var r=freeOnUnref(function(){n.off("licenseAcquired",t.onLicenseAcquisitionSuccess),n.off("licenseAcquisitionFailed",t.onLicenseAcquisitionFailure)});return this.persistentLicenseManager=new vu.PersistentLicenseManager(n.acquireLicense,freeOnUnref(function(e){return t.onLicenseAcquisitionError(e)}),this.mediaKeysManagerProvider.getOrCreateMediaKeysManager(),this.representationSource.mediaRepresentation.contents,this.id),this.persistentLicenseManager.load().then(freeOnUnref(function(){r()})).catch(freeOnUnref(function(e){if(r(),!(e instanceof lt.CancelError))return t.log.error("Unable to cache license for "+t.id+', "'+e+'"'),lt.Promise.reject(e)}))}),f.prototype.cacheFragments=freeOnUnref(function(){return!this.hasMinimumCacheLevel(ka.CacheLevel.MAX)||this.isContentLiveStreaming()?lt.Promise.resolve():null==this.contentSource?lt.Promise.reject(new Error("Attempted to cache fragments with no content source")):(this.contentSource.start(this.startPositionMs),lt.Promise.resolve())}),f.prototype.cacheEXPLContent=freeOnUnref(function(){var e=this;return this.cacheEXPLManifest().then(freeOnUnref(function(){return e.cacheEXPLDrm()})).then(freeOnUnref(function(){return e.cacheEXPLFragments()}))}),f.prototype.cacheEXPLManifest=freeOnUnref(function(){var t=this;if(!this.hasMinimumCacheLevel(ka.CacheLevel.DATA_SAVER)||this.isContentLiveStreaming())return lt.Promise.resolve();if(this.log.info("EXPL manifest cache, titleId: "+this.cacheContentConfig.contentConfig.titleId+", id: "+this.id),null==this.prsResolverContentBaseResources)return lt.Promise.reject(new Error("Attempted to cache EXPL manifest when no PRSResolverContext exists"));var n=Hf.PlaybackResourceUtils.valueOrNull(this.prsResolverContentBaseResources.playbackResources.playlistedPlaybackUrls);if(null==n)return lt.Promise.reject(new Error("PlaylistedPlaybackUrls cannot be null for EXPL content"));var r=new a.PlaylistedMediaRepresentation,e=n.failoverPolicy.cdnOrder,i=new $A.PlaylistedPlaybackUrlsSourceCdnStore(e),o=new Ac.ResourceAcquirer;return this.resolveAndCacheRegolithResponse(n).then(freeOnUnref(function(e){return t.createPlaylistedPeriods(r,n,i,o,e),t.resolvePlaylistedPeriods(r)})).then(freeOnUnref(function(){t.log.info("EXPL manifest cache success, titleId: "+t.cacheContentConfig.contentConfig.titleId+", id: "+t.id)})).catch(freeOnUnref(function(e){throw t.log.error("EXPL manifest cache failed, titleId: "+t.cacheContentConfig.contentConfig.titleId+", id: "+t.id+", error: "+e.message),e}))}),f.prototype.resolveAndCacheRegolithResponse=freeOnUnref(function(e){var n=this,t=e.intraTitlePlaylist;if(0!==this.startPositionMs&&void 0!==this.startPositionMs)return this.log.info("Content position is "+this.startPositionMs+"ms. Skipping preroll resolution for EXPL content"),lt.Promise.resolve(null);var r=this.getPrerollRemoteItem(t);if(null==r)return this.log.info("No preroll remote item found in EXPL playlist"),lt.Promise.resolve(null);this.log.info("EXPL playlist contains preroll. Starting preroll resolution and caching");var i=lt.CancelToken.source(),o=i.token,a=(i.cancel,new nD.CacheRemoteItemResolver(this.serviceClientFactory));return a.resolveRemoteItem(r,o,"Preroll").then(freeOnUnref(function(e){if(o.throwIfRequested(),null==e)return n.log.error("Failed to resolve preroll remote item for EXPL content"),lt.Promise.resolve(null);n.log.info("Successfully resolved preroll regolith response, caching to localStorage");var t=vu.createCachedRegolithResponseKey(n.id,0);return Pt.localStorage.put(t,JSON.stringify(e)).then(freeOnUnref(function(){return n.log.info("Regolith response cached successfully with key: "+t),e})).catch(freeOnUnref(function(e){throw n.log.error("Failed to cache regolith response: "+e.message),e}))})).catch(freeOnUnref(function(e){return n.log.error("Preroll resolution failed: "+e.message+". Continuing without preroll."),null}))}),f.prototype.createPlaylistedPeriods=freeOnUnref(function(e,t,n,r,i){var o=t.intraTitlePlaylist;null!=i&&(this.log.info("Creating preroll periods from resolved regolith response"),this.createPrerollPeriods(e,t,i,n,r)),this.log.info("Creating main and card periods");var a=o.some(freeOnUnref(function(e){return"Remote"===e.type}));a&&this.log.info("Forcing out-of-band subtitles by removing in-band subtitles since there are ads in the content.");for(var s=0,l=0;l<o.length;l++)if("Remote"!==o[l].type){var f=o[l],u=l===o.length-1,c=this.hasRemoteItemBefore(l,o),d=rD.CachePlaylistedPeriodFactory.createPeriodFromPlaylistItem(f,l,this.prsResolverContentBaseResources.playbackResources.timestamp,u,n,r,c,a,this.id);s+=1,e.append(d)}this.log.info("Created "+s+" main/card periods")}),f.prototype.resolvePlaylistedPeriods=freeOnUnref(function(e){var n=this,t=e.periods.contents;if(0===t.length)return this.log.info("No periods found to resolve manifests"),lt.Promise.resolve();this.log.info("Resolving manifests for "+t.length+" playlisted periods");var r=t.map(freeOnUnref(function(t){return t.resolve().then(freeOnUnref(function(){n.log.info("Successfully resolved manifest for period: "+t.id)})).catch(freeOnUnref(function(e){n.log.error("Failed to resolve manifest for period "+t.id+": "+e.message)}))}));return lt.Promise.all(r).then(freeOnUnref(function(){n.log.info("Completed manifest resolution for all playlisted periods")}))}),f.prototype.cacheEXPLDrm=freeOnUnref(function(){return this.log.info("EXPL DRM caching - not yet implemented, titleId: "+this.cacheContentConfig.contentConfig.titleId+", id: "+this.id),lt.Promise.resolve()}),f.prototype.cacheEXPLFragments=freeOnUnref(function(){return this.log.info("EXPL fragment caching - not yet implemented, titleId: "+this.cacheContentConfig.contentConfig.titleId+", id: "+this.id),lt.Promise.resolve()}),f.prototype.canCachePlaylistedContent=freeOnUnref(function(){return null==L.configurationStore.configuration||null==L.configurationStore.configuration.cacheFeature||!1!==L.configurationStore.configuration.cacheFeature.enableCachingForPlaylistedContent}),f.prototype.detectAdContentFromEXPL=freeOnUnref(function(e){if(!e||!e.intraTitlePlaylist)return!1;for(var t=e.intraTitlePlaylist,n=0;n<t.length;n++)if("Remote"===t[n].type)return!0;return!1}),f.prototype.getPrerollRemoteItem=freeOnUnref(function(e){return 0===e.length||"Remote"!==e[0].type?null:e[0]}),f.prototype.createPrerollPeriods=freeOnUnref(function(e,t,n,r,i){var o=n.playlist;if(null!=o){this.log.info("Creating preroll periods with "+o.length+" ad(s)");for(var a=t.intraTitlePlaylist,s=null,l=0;l<a.length;l++)if("Main"===a[l].type){s=a[l];break}if(s){for(var f=s,u=f.urls[0].consumptionId,c={},d=0,p=f.urls;d<p.length;d++){var h=p[d];c[h.cdn]=h.consumptionId}for(var m=0;m<o.length;m++){var y=o[m],g=rD.CachePlaylistedPeriodFactory.createPeriodFromRegolithAd(y,0,m,this.prsResolverContentBaseResources.playbackResources.timestamp,c,u,r,i,this.id);e.append(g)}this.log.info("Created "+o.length+" preroll periods")}else this.log.error("No main item found in EXPL playlist for consumption ID mapping")}}),f.prototype.hasRemoteItemBefore=freeOnUnref(function(e,t){return 0<e&&"Remote"===t[e-1].type}),f.prototype.onLicenseAcquisitionError=freeOnUnref(function(e){this.log.error("Failed to acquire license "+e)}),f.prototype.removeCachedDrm=freeOnUnref(function(){var t=this;this.persistentLicenseManager&&this.persistentLicenseManager.remove().then(freeOnUnref(function(){null!=t.persistentLicenseManager&&(t.persistentLicenseManager.unload(),t.persistentLicenseManager=void 0)})).catch(freeOnUnref(function(e){t.log.error("Unable to remove license for "+t.id+', "'+e+'"')}))}),f.prototype.hasMinimumCacheLevel=freeOnUnref(function(e){return this.cacheLevel>=e}),f.prototype.completeDownload=freeOnUnref(function(){var e=this;this.log.info("Cache complete id: "+this.id),this.updateCachedContentMetadata("Completed").then(freeOnUnref(function(){return e.emitEvent("DownloadComplete")}))}),f.prototype.updateCachedContentMetadata=freeOnUnref(function(t){var n=this;void 0===t&&(t=this.stateMachine.state);var e={cacheContentConfig:this.cacheContentConfig,fragmentSizeBytes:this.fragmentSizeBytes,expirationTimeMs:this.createTimestampMs+(this.hasAds?72e5:432e6),createTimeMs:this.createTimestampMs,state:t,version:tD.CACHED_CONTENT_METADATA_VERSION,hasAds:this.hasAds};return Jo.metadataStorage.put(this.metadataKey,e).catch(freeOnUnref(function(e){n.log.error("Unable to store download operation metadata, metadataKey: "+n.metadataKey+", state: "+t,e)}))}),f.prototype.detectAdContentFromPrs=freeOnUnref(function(e){var t=Hf.PlaybackResourceUtils.valueOrNull(e.playbackResources.playbackUrls);if(null==t)throw new Error("For titleId = "+this.cacheContentConfig.contentConfig.titleId+" we attempted to update cache that had no playback url");if(null==t.cuepoints)return!1;var n=t.urlSets[t.defaultUrlSetId].urls.manifest.duration;if(null==n)return this.log.error("Main content duration not present in PlaybackUrls.This should not happen. Assuming there are ads and setting lower TTL."),!0;for(var r=0,i=(new $A.CuepointPlaylistProcessor).process(t.cuepoints,n);r<i.length;r++)for(var o=0,a=i[r].ads;o<a.length;o++){if("Ad"===a[o].contentType)return!0}return!1}),f.prototype.startBufferCheck=freeOnUnref(function(){var l=this;if(this.contentSource instanceof Ty.FragmentContentSource){var t=this.contentSource,f=t.getBufferInformationCalculator(),u=null!=f.bufferSettings?1e3*f.bufferSettings.bufferFullnessForPlaybackStartSeconds:6e3,c=vu.CRITICAL_STREAM_TYPES.map(freeOnUnref(function(e){return t.getFragmentSource(e)})),d=freeOnUnref(function(){for(var e=f.getBufferInformation(l.startPositionMs),t=!0,n=0,r=vu.CRITICAL_STREAM_TYPES;n<r.length;n++){var i=r[n],o=e[i];if(!f.isBufferedToEnd(l.startPositionMs,i)&&(null==o||o.front.endTimeMs-l.startPositionMs<u)){t=!1;break}}var a=l.bufferManager.getContentReservation(l.id);if(null!=a){var s=a.sizeBytes;s!==l.fragmentSizeBytes&&(l.fragmentSizeBytes=s,l.updateCachedContentMetadata())}else l.log.info("Unable to update fragment size in bytes.");t&&(c.forEach(freeOnUnref(function(e){return e.offUpdate(d)})),l.stateMachine.actNow("Complete"))});c.forEach(freeOnUnref(function(e){return e.onUpdate(d)}))}else this.stateMachine.actNow("Complete")}),f.prototype.isContentLiveStreaming=freeOnUnref(function(){return"LiveStreaming"===this.cacheContentConfig.contentConfig.videoMaterialType}),f.prototype.emitEvent=freeOnUnref(function(e){this.eventEmitter.emit(e,{downloadOperationId:this.id})}),f.prototype.setupStateMachine=freeOnUnref(function(){var n=this;this.stateMachine.addTransition("Pending","InitCompleted","Completed"),this.stateMachine.addTransition("Pending","InitPending","Pending"),this.stateMachine.addTransition("Pending","InitDownloading","Downloading"),this.stateMachine.addTransition("Pending","InitDeleting","Deleting"),this.stateMachine.addTransition("Pending","InitDeleted","Deleted"),this.stateMachine.addTransition("Pending","InitError","Error"),this.stateMachine.addTransition("Pending","StartDownloading","Downloading"),this.stateMachine.onEnterState("Downloading",freeOnUnref(function(){return n.startDownload()})),this.stateMachine.addTransition("Downloading","Complete","Completed"),this.stateMachine.onEnterState("Completed",freeOnUnref(function(){return n.completeDownload()})),this.stateMachine.addTransition("Completed","StartDeleting","Deleting"),this.stateMachine.addTransition("Error","StartDeleting","Deleting"),this.stateMachine.addTransition("Pending","StartDeleting","Deleting"),this.stateMachine.addTransition("Downloading","StartDeleting","Deleting"),this.stateMachine.onEnterState("Deleting",freeOnUnref(function(){return n.deleteDownload()})),this.stateMachine.addTransition("Deleting","FinishDeleting","Deleted"),this.stateMachine.onEnterState("Deleted",freeOnUnref(function(){return n.emitEvent("CachedContentDeleted")})),this.stateMachine.addTransition("Pending","Error","Error"),this.stateMachine.addTransition("Downloading","Error","Error"),this.stateMachine.addTransition("Deleting","Error","Error"),this.stateMachine.onEnterState("Error",this.onEnterErrorState),this.stateMachine.onIllegalTransition(freeOnUnref(function(e,t){n.log.error('IllegalTransitionError from action "'+t+'" while in state "'+e+'".')}))}),f})();t.CachedContent=n}));e(oD);oD.CachedContent;var aD=t(freeOnUnref(function(e,t){var i=ce&&ce.__assign||freeOnUnref(function(){return(i=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("CachePrioritizationSystem"),r=freeOnUnref(function(){function e(){this.cachedContents=[]}return e.prototype.addCachedContent=freeOnUnref(function(e){null==this.findCachedContent(e.id)?this.cachedContents.push(e):n.warn("Attempted to add cached content, but "+e.id+" already exists. Ignoring.")}),e.prototype.removeCachedContent=freeOnUnref(function(t){this.cachedContents=this.cachedContents.filter(freeOnUnref(function(e){return e.id!==t.id}))}),e.prototype.getPriority=freeOnUnref(function(e,t){return this.getDistanceFromPlayhead(e,t)+36e5}),e.prototype.getDistanceFromPlayhead=freeOnUnref(function(e,t){var n=this.findCachedContent(e.downloadOperationId);return null==n?1/0:this.getDistanceFromCacheStart(n,t)}),e.prototype.getAbsoluteCurrentPosition=freeOnUnref(function(){return null}),e.prototype.getPriorityComparable=freeOnUnref(function(e,t){var n=this;if(null!=e.downloadOperationId){var r=i({},t,{downloadOperationId:e.downloadOperationId,compareTo:freeOnUnref(function(e){return n.comparePriorities(r,e)})});return r}}),e.prototype.comparePriorities=freeOnUnref(function(e,t){var n=this.findCachedContent(e.downloadOperationId),r=this.findCachedContent(t.downloadOperationId);return null==n&&null==r?0:null==n?1:null==r?-1:n.createTimestampMs<r.createTimestampMs?1:n.createTimestampMs>r.createTimestampMs?-1:"Title"===e.type&&"Title"===t.type?0:"Title"===e.type&&"Title"!==t.type?-1:"Title"!==e.type&&"Title"===t.type?1:"Fragment"===e.type&&"Fragment"===t.type?this.compareFragmentPriorities(n,e,r,t):0}),e.prototype.compareFragmentPriorities=freeOnUnref(function(e,t,n,r){var i=this.getDistanceFromCacheStart(e,t.position),o=this.getDistanceFromCacheStart(n,r.position);return i<o?-1:o<i?1:0}),e.prototype.getDistanceFromCacheStart=freeOnUnref(function(e,t){return t.startTimeMs-e.startPositionMs}),e.prototype.findCachedContent=freeOnUnref(function(t){return x.find(this.cachedContents,freeOnUnref(function(e){return e.id===t}))}),e})();t.CachePrioritizationSystem=r}));e(aD);aD.CachePrioritizationSystem;var sD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.prototype.getOrCreateMediaKeysManager=freeOnUnref(function(){return null==this.mediaKeysManager&&(this.mediaKeysManager=new ea.MediaKeysManager(new ea.HdcpStore(!1))),this.mediaKeysManager}),e})();t.MediaKeysManagerProvider=n}));e(sD);sD.MediaKeysManagerProvider;var lD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("VideoQualityOverrideStorage"),n=freeOnUnref(function(){function e(){var r=this;this.videoQualityOverride=null,this.storageAccessPromise=new lt.Promise(freeOnUnref(function(n){Tt.keyValueStore.get("xp.verified_secure_pipeline",freeOnUnref(function(e,t){null===e?"false"===t&&(i.info("Local stored verified secure pipeline is false"),r.videoQualityOverride="SD"):i.warn("Error occurs during local storage access, error: "+e+", code: "+e.code),n(r.videoQualityOverride)}))}))}return e.prototype.getValue=freeOnUnref(function(){return this.storageAccessPromise}),e})();t.VideoQualityOverrideStorage=n}));e(lD);lD.VideoQualityOverrideStorage;var fD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var c=de.get("CacheManager"),n="cache_manager_metadata",r=freeOnUnref(function(){function e(e,t){var n,r=this;if(this.version="0.0.1",this.objectId="XpPlayerSDK-CacheFeature-"+Math.random(),this.cachedContents=[],this.updateMetadataPromise=lt.Promise.resolve(),this.cachingEnabled=!0,this.handleCachedContentDeleted=freeOnUnref(function(e){var t=e.downloadOperationId;c.info("Cached content "+t+" deleted, updating CacheManager state"),r.cachedContents=r.cachedContents.filter(freeOnUnref(function(e){return e.id!==t})),r.updateMetadata()}),n=lt.CancelToken.source(),this.destroyed=n.token,this.destroyRequested=n.cancel,this.maximumStorageSizeBytes=10485760,this.serviceClientFactory=t,null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.cacheFeature){var i=L.configurationStore.configuration.cacheFeature;if(this.cachingEnabled=!0!==i.disableCaching,null!=i.maxSizeBytes&&(this.maximumStorageSizeBytes=i.maxSizeBytes),null!=i.maxCachingLevel){var o=ka.CacheLevel[i.maxCachingLevel];null==o?c.error("Invalid maximumCachingLevel value in configuration: "+i.maxCachingLevel+", ignoring"):this.maximumCachingLevel=o}}c.info("Initializing cache, maximumStorageSizeBytes: "+this.maximumStorageSizeBytes+", maxCachingLevel: "+this.maximumCachingLevel),this.mediaKeysManagerProvider=new sD.MediaKeysManagerProvider,this.bufferManager=new zf.CacheBufferManager(this.maximumStorageSizeBytes),this.prioritizationSystem=new aD.CachePrioritizationSystem;var a={applicationIdentity:e.applicationIdentity,titleDecorationScheme:e.titleDecorationScheme,uxLocale:e.uxLocale,xrayConfig:e.xray,acceptedCreativeApis:e.acceptedCreativeAPIs},s=new Pr.PlaybackResourceClient(t,Hf.createPrsGeneralApiParameters(a)),l=new _r.LivePlaybackResourceClient(t),f=new _r.VodPlaybackResourceClient(t),u=new _r.LiveLinearPlaybackResourceClient(t);this.prsResolver=new Hf.PRSResolver(s,l,u,f,t,a),this.videoQualityOverrideStorage=new lD.VideoQualityOverrideStorage,this.cacheExpiredTTLCleaner=new Ou.CacheExpiredTTLCleaner}return e.prototype.initialize=freeOnUnref(function(){var e,o=this;return this.destroyed.requested?(c.warn("Attempted to initialize destroyed CacheManager"),lt.Promise.resolve()):this.cachingEnabled?(e=Pt.localStorage.getText(n).then(freeOnUnref(function(e){if(null==e)return lt.Promise.resolve(null);var t=JSON.parse(e);return null==t.cachedContentIds||0===t.cachedContentIds.length?(c.info("No cache content in metadata"),lt.Promise.resolve(null)):Su.CacheUntrackedFileCleaner.deleteUnknownContent(t.cachedContentIds).then(freeOnUnref(function(){return t})).catch(freeOnUnref(function(e){return c.error("Untracked file clean failed",e),t}))})).then(freeOnUnref(function(e){if(null!=e){var n=[];c.info("Reloading cached contents from metadata, count: "+e.cachedContentIds.length);for(var t=freeOnUnref(function(t){var e=oD.CachedContent.createCachedContentFromMetadata(t,o.bufferManager,o.prioritizationSystem,o.prsResolver,o.videoQualityOverrideStorage,o.mediaKeysManagerProvider,o.serviceClientFactory).then(freeOnUnref(function(e){if(!e.initialize())return c.warn("Initialization for cached content "+t+" failed, content will be deleted."),void e.delete();o.cachedContents.push(e),e.on("CachedContentDeleted",o.handleCachedContentDeleted),o.prioritizationSystem.addCachedContent(e)})).catch(freeOnUnref(function(e){c.error("Could not recover cached content id: "+t+", error: "+e)}));n.push(e)}),r=0,i=e.cachedContentIds;r<i.length;r++){t(i[r])}return lt.Promise.all(n).then(freeOnUnref(function(){return o.updateMetadata()}))}})).catch(freeOnUnref(function(e){c.error("Could not recover cached metadata, error: "+e)}))).then.apply(e,lt.FINALLY(freeOnUnref(function(){o.destroyed.requested||o.startTTLCleanup()}))):(c.info("Caching disabled, skipping initialization"),lt.Promise.resolve())}),e.prototype.clearCache=freeOnUnref(function(e){var t=this;if(this.destroyed.requested)c.warn("Attempted to clearCache on destroyed CacheManager");else if(this.cachingEnabled){var n=this.cachedContents;void 0!==e&&0<e.length&&(c.info("Clearing cache, initialContentCount: "+e.length),n=e.filter(freeOnUnref(function(e){return t.isContentCacheable(e)})).map(freeOnUnref(function(e){return t.createDownloadOperationId(e)})).map(freeOnUnref(function(e){return t.findCachedContentByDownloadOperationId(e)})).filter(freeOnUnref(function(e){return null!=e}))),c.info("Removing cached contents, filteredContentCount: "+n.length),this.removeCachedContents(n)}else c.info("Caching disabled, skipping clear cache request")}),e.prototype.removeCachedContents=freeOnUnref(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];r.off("CachedContentDeleted",this.handleCachedContentDeleted),r.delete()}this.cachedContents=x.without.apply(x,[this.cachedContents].concat(e)),this.updateMetadata()}),e.prototype.cache=freeOnUnref(function(e){if(this.destroyed.requested)c.warn("Attempted to cache on destroyed CacheManager");else if(this.cachingEnabled){for(var t=freeOnUnref(function(t){if(c.info("Cache request, titleId: "+t.contentConfig.titleId+", cachingLevel: "+t.cachingLevel+", cachePriority: "+t.cachePriority+" position: "+t.contentConfig.position),!s.isContentCacheable(t.contentConfig))return c.warn("Content titleId:"+t.contentConfig.titleId+" with video material type "+t.contentConfig.videoMaterialType+" is not cacheable."),"continue";var e=x.find(s.cachedContents,freeOnUnref(function(e){return e.isSameContent(t.contentConfig)}));if(null!=e){var n=t.contentConfig.playbackEnvelope;if(e.isSameCorrelationId(n)){var r=null!=t.contentConfig.position?t.contentConfig.position:0,i=e.startPositionMs;return i!==r?(c.info("Content ("+e.id+") starting from a new position. Old: "+i+"ms New: "+r+"ms. Re-caching."),s.refreshExistingContent(e,t)):(c.info("Content matches envelope ("+e.id+"). Skipping cache."),e.resetCreateTime(),e.updateTTL()),"continue"}c.info("Content correlationId collision, deleting old and replacing, id: "+e.id),s.removeCachedContents([e])}if(null!=s.maximumCachingLevel&&(null==t.cachingLevel||t.cachingLevel>s.maximumCachingLevel)){var o=null==t.cachingLevel?"<default>":String(t.cachingLevel);c.warn("Cache request level "+o+" is above maximum level, clamping to "+s.maximumCachingLevel),t.cachingLevel=s.maximumCachingLevel}var a=new oD.CachedContent(s.createDownloadOperationId(t.contentConfig),t,s.bufferManager,s.prioritizationSystem,s.prsResolver,s.videoQualityOverrideStorage,s.mediaKeysManagerProvider,s.serviceClientFactory);s.prioritizationSystem.addCachedContent(a),a.initialize(),a.on("CachedContentDeleted",s.handleCachedContentDeleted),a.start(),s.cachedContents.push(a)}),s=this,n=0,r=e;n<r.length;n++){t(r[n])}this.updateMetadata()}else c.info("Caching disabled, skipping cache request")}),e.prototype.getAllCachedContents=freeOnUnref(function(){return this.destroyed.requested?(c.warn("Attempted to getAllCachedContents on destroyed CacheManager"),[]):this.cachedContents}),e.prototype.destroy=freeOnUnref(function(){if(this.destroyed.requested)c.warn("CacheManager already destroyed");else{c.info(">> destroy");for(var e=0,t=this.cachedContents;e<t.length;e++){t[e].off("CachedContentDeleted",this.handleCachedContentDeleted)}this.destroyRequested(),this.cacheExpiredTTLCleaner.stop()}}),e.prototype.toJSON=freeOnUnref(function(){return{version:this.version,objectId:this.objectId}}),e.prototype.updateMetadata=freeOnUnref(function(){var t=this;return this.updateMetadataPromise=this.updateMetadataPromise.then(freeOnUnref(function(){var e={cachedContentIds:t.cachedContents.map(freeOnUnref(function(e){return e.id}))};return Pt.localStorage.put(n,JSON.stringify(e))})).catch(freeOnUnref(function(e){c.error("Update metadata failed, error: "+e.message)})),this.updateMetadataPromise}),e.prototype.createDownloadOperationId=freeOnUnref(function(e){if(null==e.playbackEnvelope||null==e.playbackEnvelope.correlationId)throw new Error("ContentConfig does not have playbackEnvelope with a correlationId");return Ot.hex_sha256(e.playbackEnvelope.correlationId)}),e.prototype.isContentCacheable=freeOnUnref(function(e){var t=null!=e.playbackEnvelope&&null!=e.playbackEnvelope.correlationId;t?c.info("Content is cacheable with correlationId: "+e.playbackEnvelope.correlationId):null==e.playbackEnvelope?c.warn("Content not cacheable - missing playback envelope."):null==e.playbackEnvelope.correlationId&&c.warn("Content not cacheable - playback envelope missing correlationId.");var n=null!=e.playbackExperiences&&e.playbackExperiences.some(freeOnUnref(function(e){return e===ka.PlaybackExperience.RapidRecap}));return n&&c.warn("Content not cacheable - rapid recap content detected."),t&&!n}),e.prototype.refreshExistingContent=freeOnUnref(function(t,n){var r=this;if("Deleting"!==t.state){var i=freeOnUnref(function(e){c.info("Cached content "+t.id+" deleted. Triggering refresh of cache."),t.off("CachedContentDeleted",i),r.cache([n])});t.on("CachedContentDeleted",i),this.removeCachedContents([t])}}),e.prototype.findCachedContentByDownloadOperationId=freeOnUnref(function(t){return x.find(this.cachedContents,freeOnUnref(function(e){return e.id===t}))}),e.prototype.startTTLCleanup=freeOnUnref(function(){var e=this;c.info("Performing immediate TTL cleanup on startup"),this.cacheExpiredTTLCleaner.cleanupExpiredCachedContent(this.cachedContents).catch(freeOnUnref(function(e){c.error("Startup TTL cleanup failed: "+e.message,e)})),this.cacheExpiredTTLCleaner.start(freeOnUnref(function(){return e.cachedContents}))}),e})();t.CacheManager=r}));e(fD);fD.CacheManager;var uD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CacheManager=fD.CacheManager}));e(uD);uD.CacheManager;var cD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.weblabResponseProcessor=freeOnUnref(function(e,t,n,r){var i={},o=e.getText();if(null!=o){var a=void 0;try{a=JSON.parse(o)}catch(e){return void r(e)}if(null!=a&&null!=a.TreatmentList)for(var s=0,l=a.TreatmentList;s<l.length;s++){var f=l[s];i[f.weblabName]=f.treatmentName}}t(i)});this.serviceClient=e.createServiceClient("/cdp/usage/GetWeblabTreatment",{firmware:"1"},this.weblabResponseProcessor)}return e.prototype.send=freeOnUnref(function(e,t){var n={accept:"application/json","content-type":"application/json"};null!=e.sessionId&&(n["x-atv-session-id"]=e.sessionId);var r={method:"POST",timeoutMs:4e3,headers:n,body:JSON.stringify({WeblabList:e.weblabs}),queryParams:{}};return this.serviceClient.send(r,t,"CRITICAL",!1)}),e})();t.WeblabClient=n}));e(cD);cD.WeblabClient;var dD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.WeblabClient=cD.WeblabClient}));e(dD);dD.WeblabClient;var pD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.context=e}return e.prototype.setAuthContext=freeOnUnref(function(e){this.context=e}),e.prototype.getHeaders=freeOnUnref(function(){return this.context.headers}),e})();t.AuthContextWrapper=n}));e(pD);pD.AuthContextWrapper;var hD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=new ct.XpError("serviceCallStorage.unsupported",void 0,"ServiceCallStorageInterface has not been implemented for this platform"),r={capabilities:{isSupported:!1},get:freeOnUnref(function(){return lt.Promise.reject(n)}),put:freeOnUnref(function(){return lt.Promise.reject(n)}),remove:freeOnUnref(function(){return lt.Promise.reject(n)})};t.serviceCallStorage=r}));e(hD);hD.serviceCallStorage;var mD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.serviceCallStorage=hD.serviceCallStorage}));e(mD);mD.serviceCallStorage;var yD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("CachingServiceCall");function s(r,e){return e().then(freeOnUnref(function(e){var t=zt.deviceInformation.software.playerBundle;if(!mD.serviceCallStorage.capabilities.isSupported||null==t)return e;var n={expiryTimeMs:Date.now()+r.timeToLiveMs,value:e,version:t.version};return mD.serviceCallStorage.put(r.key,n).catch(freeOnUnref(function(){})).then(freeOnUnref(function(){return e}))}))}t.makeCachedServiceCall=function(i,o){return mD.serviceCallStorage.capabilities.isSupported?mD.serviceCallStorage.get(i.key).catch(freeOnUnref(function(e){return a.error("ServiceCallStorage retrieval failed due to error: "+e),null})).then(freeOnUnref(function(e){var t=zt.deviceInformation.software.playerBundle,n=e;if(null==n||null==t||n.version!==t.version)return s(i,o);var r=n.expiryTimeMs-Date.now();return 0<r?n.value:-r>=i.staleWhileRevalidateMs?s(i,o):(s(i,o).catch(freeOnUnref(function(e){a.error("Service request failure while background revalidating:",e)})),n.value)})):s(i,o)}}));e(yD);yD.makeCachedServiceCall;var gD=t(freeOnUnref(function(e,t){var l=ce&&ce.__assign||freeOnUnref(function(){return(l=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var f=de.get("LogFieldsParser"),n=freeOnUnref(function(){function e(e){this.marketplaceId=e}return e.prototype.getFields=freeOnUnref(function(e){var t={};return this.extractGeneralFields(t,e.general),this.extractDeviceInformationFields(t,e.deviceInformation),t}),e.prototype.extractGeneralFields=freeOnUnref(function(e,t){if(null!=t)for(var n=0,r=t;n<r.length;n++){var i=r[n];"marketplaceId"===i&&(e[i]=this.marketplaceId)}}),e.prototype.extractDeviceInformationFields=freeOnUnref(function(e,t){if(null!=t){for(var n={},r=0,i=t;r<i.length;r++){var o=i[r],a=Qe.nestedValue(zt.deviceInformation,o,null);null!=a&&this.deepSet(n,o,a)}0<Object.keys(n).length&&(e.device=n)}}),e.prototype.deepSet=freeOnUnref(function(e,t,n){for(var r=t.split("."),i=e,o=0;o<r.length-1;o++){var a=r[o];if(null!=i[a]){if("object"!=typeof i[a])return void f.error("path "+t+" already contains a value at key "+a+" !!!. existing value: "+JSON.stringify(i[a])+" new value: "+JSON.stringify(n));i=i[a]}else i=i[a]={}}var s=r[r.length-1];null!=i[s]?"object"!=typeof i[s]||"object"!=typeof n?i[s]!==n&&f.warn("Path "+t+" already contains a value at last node !!!. existing value: "+JSON.stringify(i[s])+" new value: "+JSON.stringify(n)):i[s]=l({},i[s],n):i[s]=n}),e})();t.LogFieldsProvider=n}));e(gD);gD.LogFieldsProvider;var vD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=de.get("NativeDiagnosticsMonitor"),r=freeOnUnref(function(){function e(e){this.pollingFrequencyInSec=300,(this.nativeDiagnosticsTimer=null)!=e&&null!=e.nativeDiagnostics&&"number"==typeof e.nativeDiagnostics.pollingFrequencyInSec&&(this.pollingFrequencyInSec=e.nativeDiagnostics.pollingFrequencyInSec)}return e.prototype.start=freeOnUnref(function(){var e=this;this.pollingFrequencyInSec<=0||null==xt.platformRuntime||null==xt.platformRuntime.getPlayerCpuUsage&&null==xt.platformRuntime.getPlayerJsMemoryUsage&&null==xt.platformRuntime.getProcessMemoryUsage||(n.info("Starting publishing CPU/Memory Metrics with "+this.pollingFrequencyInSec+"s polling frequency"),this.nativeDiagnosticsTimer=oe.timer.setInterval(freeOnUnref(function(){e.reportPlayerCpuUsage(),e.reportPlayerJsMemoryUsage(),e.reportProcessMemoryUsage()}),1e3*this.pollingFrequencyInSec))}),e.prototype.stop=freeOnUnref(function(){null!=this.nativeDiagnosticsTimer&&(oe.timer.clearInterval(this.nativeDiagnosticsTimer),this.nativeDiagnosticsTimer=null)}),e.prototype.reportPlayerCpuUsage=freeOnUnref(function(){if(null!=xt.platformRuntime.getPlayerCpuUsage){var e=xt.platformRuntime.getPlayerCpuUsage();null!=e&&q.metrics.putMetric("CpuUtilisation",e,"pct")}}),e.prototype.reportPlayerJsMemoryUsage=freeOnUnref(function(){if(null!=xt.platformRuntime.getPlayerJsMemoryUsage){var e=xt.platformRuntime.getPlayerJsMemoryUsage();null!=e&&q.metrics.putMetric("JsMemoryUsage",e,"kb")}}),e.prototype.reportProcessMemoryUsage=freeOnUnref(function(){if(null!=xt.platformRuntime.getProcessMemoryUsage){var e=xt.platformRuntime.getProcessMemoryUsage();null!=e&&q.metrics.putMetric("ProcessMemoryUsage",e,"kb")}}),e})();t.NativeDiagnosticsMonitor=r}));e(vD);vD.NativeDiagnosticsMonitor;var OD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i={"fls-eu.amazon.com":[Wy.MarketplaceID.DE,Wy.MarketplaceID.ROE_EU,Wy.MarketplaceID.ROW_EU,Wy.MarketplaceID.UK],"fls-fe.amazon.com":[Wy.MarketplaceID.JP,Wy.MarketplaceID.ROW_FE],"fls-na.amazon.com":[Wy.MarketplaceID.ROW_NA,Wy.MarketplaceID.US]},n=freeOnUnref(function(){function t(){}return t.hasEndpoint=freeOnUnref(function(e){return null!=t.getEndpointForMarketplace(e)}),t.getEmptyResponseBaseUrl=freeOnUnref(function(e){return"https://"+t.getEndpointForMarketplace(e)+"/1/action-impressions/1/OE"}),t.getEndpointForMarketplace=freeOnUnref(function(e){for(var t=0,n=Object.keys(i);t<n.length;t++){var r=n[t];if(0<=i[r].indexOf(e))return r}return null}),t})();t.Endpoints=n}));e(OD);OD.Endpoints;var SD=t(freeOnUnref(function(e,t){var n,r=ce&&ce.__assign||freeOnUnref(function(){return(r=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var s=((n={})[Wy.MarketplaceID.DE]="de",n[Wy.MarketplaceID.JP]="jp",n[Wy.MarketplaceID.ROE_EU]="roe_eu",n[Wy.MarketplaceID.ROW_EU]="row_eu",n[Wy.MarketplaceID.ROW_FE]="row_fe",n[Wy.MarketplaceID.ROW_NA]="row_na",n[Wy.MarketplaceID.UK]="uk",n[Wy.MarketplaceID.US]="us",n),i=freeOnUnref(function(){function e(e,t,n,r,i,o,a){if(void 0===o&&(o=0),void 0===a&&(a=3e4),this.batchedMetrics=[],this.flushTimeoutId=null,!OD.Endpoints.hasEndpoint(n))throw new Error("No endpoint for marketplaceId="+n);this.programGroup=t,this.marketplaceId=n,this.baseMwsQueryParameters={marketplace:s[this.marketplaceId],marketplaceId:n,requestId:"1",service:e,session:r},this.reportingDimensions=i,this.batchSize=o,this.batchFlushTimeoutMs=a,this.baseUrl=OD.Endpoints.getEmptyResponseBaseUrl(n)+"/"+t+"/action/"}return e.prototype.updateSessionId=freeOnUnref(function(e){this.baseMwsQueryParameters.session=e}),e.prototype.putMetric=freeOnUnref(function(e,t,n,r,i){var o=this;void 0===n&&(n=1),null!=i&&i!==this.marketplaceId&&this.updateMarketplaceId(i);var a=e+":"+t+"@v="+n;null!=r&&(a=a+":u="+r),this.batchedMetrics.push(a),this.batchedMetrics.length>=this.batchSize?this.flush():(null!==this.flushTimeoutId&&oe.timer.clearTimeout(this.flushTimeoutId),this.flushTimeoutId=oe.timer.setTimeout(freeOnUnref(function(){o.flush()}),this.batchFlushTimeoutMs))}),e.prototype.flush=freeOnUnref(function(){if(!(this.batchedMetrics.length<1)){null!==this.flushTimeoutId&&oe.timer.clearTimeout(this.flushTimeoutId);var e=this.batchedMetrics.filter(freeOnUnref(function(e){return 0===e.indexOf("XpPlayer:")})).length,t=this.batchedMetrics.slice();if(0<e){var n="XpPlayer:.customMetricCount@v="+e;t.push(n)}for(var r=this.baseUrl+t.join("/"),i=0,o=this.reportingDimensions;i<o.length;i++){var a=o[i];this.putMetricXhr(r,this.createMetricParameters(a))}this.batchedMetrics=[]}}),e.prototype.putMetricXhr=freeOnUnref(function(e,t){pn.HttpRequest.get(e).query(t).timeout(3e3).send()}),e.prototype.createMetricParameters=freeOnUnref(function(e){return r({},this.baseMwsQueryParameters,e)}),e.prototype.updateMarketplaceId=freeOnUnref(function(e){this.flush(),this.baseUrl=OD.Endpoints.getEmptyResponseBaseUrl(e)+"/"+this.programGroup+"/action/"}),e})();t.MetricsPublisher=i}));e(SD);SD.MetricsPublisher;var UD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsPublisher=SD.MetricsPublisher}));e(UD);UD.MetricsPublisher;var bD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("PmetMetricsConfigurer"),n=freeOnUnref(function(){function e(e,t){this.disableCustomMetricReporting=!1,this.disableForesterReporting=!1,this.deviceTypeId=e,this.mediaEventReporter=t,this.marketplaceId=Wy.MarketplaceID.US,this.pmetClientFieldValue="Unknown",this.configureMetricsReporter()}return e.prototype.update=freeOnUnref(function(e,t){if(null==e||null==e.pmet||!0!==e.pmet.disableReporting){var n=!1,r=null!=e&&null!=e.pmet&&!0===e.pmet.disableCustomMetricReporting;this.disableCustomMetricReporting!==r&&(this.disableCustomMetricReporting=r,n=!0);var i=null!=e&&null!=e.pmet&&!0===e.pmet.disableForesterReporting;this.disableForesterReporting!==i&&(this.disableForesterReporting=i,n=!0);var o=this.getPmetClientFieldDeviceInfoProperty(e),a=Qe.nestedValue(zt.deviceInformation,o,"Unknown");this.pmetClientFieldValue!==a&&(this.pmetClientFieldValue=a,n=!0),null!=t&&this.marketplaceId!==t&&(this.marketplaceId=t,n=!0),n&&this.configureMetricsReporter()}else this.disableMetricsReporter()}),e.prototype.getPmetClientFieldDeviceInfoProperty=freeOnUnref(function(e){return null!=e&&null!=e.pmet&&"string"==typeof e.pmet.clientFieldDeviceInfoProperty?e.pmet.clientFieldDeviceInfoProperty:"software.middleware.name"}),e.prototype.configureMetricsReporter=freeOnUnref(function(){var i,o=this,e=this.deviceTypeId,t=Vy.UUID.v4();this.disableForesterReporting||(i=new UD.MetricsPublisher("ATVXpPlayer","dv-xp-player",this.marketplaceId,t,[{host:"XP"},{host:e},{host:e,client:this.pmetClientFieldValue}],20,6e4)),q.metrics.setHandler(freeOnUnref(function(t,e,n){if(!o.disableForesterReporting&&i&&i.putMetric("XpPlayer","."+t,e,n),!o.disableCustomMetricReporting)try{var r=Tv.CustomMetricsEventFactory.createCustomMetricsEvent(o.prepareCustomMetric(t,e),null,null);o.mediaEventReporter.enqueueMediaEvents([r])}catch(e){a.error("Failed to report metrics, "+t+", to Aloysius:",e)}})),q.metrics.setFlusher(freeOnUnref(function(){!o.disableForesterReporting&&i&&i.flush()}))}),e.prototype.sanitizeMetricName=freeOnUnref(function(e){return"CMR_"+e.replace(/[^a-zA-Z0-9_]/g,"_")}),e.prototype.prepareCustomMetric=freeOnUnref(function(e,t){var n;return(n={})[this.sanitizeMetricName(e)]=void 0===t?1:t,n}),e.prototype.disableMetricsReporter=freeOnUnref(function(){q.metrics.setHandler(freeOnUnref(function(e,t,n){})),q.metrics.setFlusher(freeOnUnref(function(){}))}),e})();t.PmetMetricsConfigurer=n}));e(bD);bD.PmetMetricsConfigurer;var PD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.objectId="XpPlayerSDK-PlayerCapabilities-"+Math.random(),this.version="0.0.1",this.mediaEventReporter=e}return e.prototype.getAppInstanceId=freeOnUnref(function(){return this.mediaEventReporter.getAppInstanceId()}),e.prototype.toJSON=freeOnUnref(function(){return{objectId:this.objectId,version:this.version}}),e})();t.XpPlayerSDKMetricsReportingFeature=n}));e(PD);PD.XpPlayerSDKMetricsReportingFeature;var MD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("TelemetryDataSinkClient");var a=[408,429,500,502,503,504],n=freeOnUnref(function(){function e(){this.request=null,this.retry=null}return e.prototype.stop=freeOnUnref(function(){this.cancelPendingRequest()}),e.prototype.post=freeOnUnref(function(e){return this.sendRequest(e)}),e.prototype.sendRequest=freeOnUnref(function(i){var o=this;return new lt.Promise(freeOnUnref(function(t,e){o.retry=(new _n.ExponentialBackoffRetry).withMaxAttempts(3).withInitialIntervalMs(1e3).withExponentialFactor(2).withRandomizationFactor(60).withMaxDelayMs(8e3).onSuccess(freeOnUnref(function(e){return t(e.data)})).onError(e).onAttempt(freeOnUnref(function(e,t,n,r){o.executeRequest(i,t,n,r)})).execute()}))}),e.prototype.executeRequest=freeOnUnref(function(e,n,r,i){var o=this;this.request=pn.HttpRequest.post("https://pnd63gpwha.execute-api.us-west-2.amazonaws.com/prod").timeout(3e4).accept("application/json"),null!=e&&this.request.contentType("application/json").body(JSON.stringify(e)),this.request.onError(freeOnUnref(function(e,t){(o.request=null)==t||x.contains(a,t.getStatus())?n(e):i(e)})).onLoad(freeOnUnref(function(e){o.request=null;try{var t=e.getText(),n=t?JSON.parse(t):void 0;r({data:n,status:e.getStatus()})}catch(e){i(new Error("Failed to parse response: "+e.toString()))}})).send()}),e.prototype.cancelPendingRequest=freeOnUnref(function(){null!=this.retry&&(this.retry.abort(),this.retry=null),null!=this.request&&(this.request.abort(),this.request=null)}),e})();t.TelemetryDataSinkClient=n}));e(MD);MD.TelemetryDataSinkClient;var CD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});de.get("TelemetryDataSink");var n=freeOnUnref(function(){function e(e){var t=this;this.batchedMessages=[],this.sendBatchedMessages=freeOnUnref(function(){oe.timer.clearTimeout(t.postIntervalId),0<t.batchedMessages.length?t.dataSinkClient.post(t.batchedMessages).then(freeOnUnref(function(){t.batchedMessages=[],t.postIntervalId=oe.timer.setTimeout(t.sendBatchedMessages,5e3)})).catch(freeOnUnref(function(){t.postIntervalId=oe.timer.setTimeout(t.sendBatchedMessages,5e3)})):t.postIntervalId=oe.timer.setTimeout(t.sendBatchedMessages,5e3)}),this.deviceId=e,this.dataSinkClient=new MD.TelemetryDataSinkClient,this.logLevel=0,this.postIntervalId=oe.timer.setTimeout(this.sendBatchedMessages,5e3)}return e.prototype.shutdown=freeOnUnref(function(){0<this.batchedMessages.length&&this.sendBatchedMessages(),oe.timer.clearTimeout(this.postIntervalId)}),e.prototype.setLevel=freeOnUnref(function(e){this.logLevel=e}),e.prototype.getLevel=freeOnUnref(function(){return this.logLevel}),e.prototype.write=freeOnUnref(function(e,t){this.onEvent("PlayerLogger","telemetry",t)}),e.prototype.onEvent=freeOnUnref(function(e,t,n){"telemetry"===t&&this.batchMessage(e,n)}),e.prototype.batchMessage=freeOnUnref(function(e,t){1e3<=this.batchedMessages.length&&this.batchedMessages.shift(),this.batchedMessages.push({deviceId:this.deviceId,componentId:e,isoTime:(new Date).toISOString(),payload:t}),20<=this.batchedMessages.length&&this.sendBatchedMessages()}),e})();t.TelemetryDataSink=n}));e(CD);CD.TelemetryDataSink;var ED=t(freeOnUnref(function(e,t){var n,r,i=ce&&ce.__assign||freeOnUnref(function(){return(i=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=de.get("XpMultiviewFeature"),s=((n={}).Max={type:$A.LayoutType.NoLayout},n.MediumHigh={type:$A.LayoutType.FlexibleLayout,resolution:{height:720,width:1280},blockedAudioCodecs:["ec-3"],allowedVideoCodecs:["AV1"],blockedHdrFormat:["HDR10","DolbyVision","HDR10Plus"],currentTier:"MediumHigh",maxTier:"MediumHigh"},n.Medium={type:$A.LayoutType.FlexibleLayout,resolution:{height:540,width:960},blockedAudioCodecs:["ec-3"],allowedVideoCodecs:["AV1"],blockedHdrFormat:["HDR10","DolbyVision","HDR10Plus"],currentTier:"Medium",maxTier:"Medium"},n),l=((r={}).Max=0,r.High=1,r.MediumHigh=2,r.Medium=3,r.Low=4,r.Minimal=5,r);freeOnUnref(function(e){e[e.Downgrade=0]="Downgrade",e[e.Upgrade=1]="Upgrade",e[e.SameLevel=2]="SameLevel"})(o||(o={}));var f=freeOnUnref(function(){function e(e,t){this.version="0.0.1",this.objectId="XpPlayerSDK-Multiview-"+Math.random(),this.eventEmitter=new A.EventEmitter,this.expectedTiers={1:["Max"],4:["MediumHigh","Medium","Medium","Medium"]},this.xpPlayerInstanceRegistry=e,this.bsmvMockManager=t}return Object.defineProperty(e.prototype,"fixedLayoutTilePositions",{get:freeOnUnref(function(){return this.bsmvMockManager.fixedLayoutTilePositions}),enumerable:!0,configurable:!0}),e.prototype.getFlexibleMultiviewSupport=freeOnUnref(function(e){var t=this;if(!this.enabledMultiview()){a.info("Multiview is not supported!");var n=e.map(freeOnUnref(function(e){return[]}));return lt.Promise.resolve(n)}a.info(">> getMultiviewSupport: ",JSON.stringify(e));var r=e.map(freeOnUnref(function(e){return t.multiviewSupportRequest(e)}));return lt.Promise.all(r).then(freeOnUnref(function(e){return a.info("<< getMultiviewSupport: ",JSON.stringify(e)),e}))}),e.prototype.getMultiviewSupport=freeOnUnref(function(e){return this.getFlexibleMultiviewSupport(e)}),e.prototype.getFixedMultiviewSupport=freeOnUnref(function(){return lt.Promise.resolve(this.bsmvMockManager.getFixedMultiviewSupport())}),e.prototype.setTiers=freeOnUnref(function(e){return a.warn("Deprecated method. Use `MultiviewFeature.updateTokens()`"),this.updateTokens(e)}),e.prototype.updateTokens=freeOnUnref(function(e){if(a.info(">> updateTokens: ",JSON.stringify(e)),0===e.length)return lt.Promise.resolve();if(this.bsmvMockManager.processUpdateTokens(e))return lt.Promise.resolve();var t=x.values(this.xpPlayerInstanceRegistry.getPlayers());this.validateForDuplicateToken(e),this.validatePlayerExistence(e,t);var n=this.parseTokenCapabilities(e);switch(this.getLayoutType(n)){case $A.LayoutType.NoLayout:return this.updateNoLayoutTokens(e);case $A.LayoutType.FixedLayout:return lt.Promise.resolve();case $A.LayoutType.FlexibleLayout:return this.updateFlexibleLayoutTokens(e)}}),e.prototype.on=freeOnUnref(function(e,n){this.eventEmitter.on(e,freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(e[0])}))}),e.prototype.once=freeOnUnref(function(e,n){this.eventEmitter.once(e,freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(e[0])}))}),e.prototype.off=freeOnUnref(function(e,n){this.eventEmitter.off(e,freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(e[0])}))}),e.prototype.toJSON=freeOnUnref(function(){return{objectId:this.objectId,version:this.version}}),e.prototype.updateFlexibleLayoutTokens=freeOnUnref(function(e){var r=this,i=x.values(this.xpPlayerInstanceRegistry.getPlayers()),n=e.map(freeOnUnref(function(t){var e=x.find(i,freeOnUnref(function(e){return e.getTier().token===t.currentToken})),n=e.getTier().currentTier;if(null==t.tier)throw new Error("All FlexibleLayoutTier requests must have tier.");return{player:e,currentTier:n,currentToken:t.currentToken,newToken:t.newToken,newTier:t.tier,operationType:r.getOperationType(n,t.tier)}}));return this.validateIfTiersSupported(n,i),this.executeTierChanges(n).catch(freeOnUnref(function(t){a.error("Tier change failed, attempting rollback. Original error:",t);var e=n.map(freeOnUnref(function(e){var t=e.player.getTier();return{player:e.player,currentTier:t.currentTier,currentToken:t.token,newTier:e.currentTier,newToken:e.currentToken,operationType:r.getOperationType(t.currentTier,e.currentTier)}}));return r.executeTierChanges(e).catch(freeOnUnref(function(e){throw a.error("Rollback failed. System may be in inconsistent state. Recommending to delete all players.",JSON.stringify({originalError:t,rollbackError:e})),e})).then(freeOnUnref(function(){throw t}))}))}),e.prototype.updateNoLayoutTokens=freeOnUnref(function(e){var n=x.values(this.xpPlayerInstanceRegistry.getPlayers());return e.forEach(freeOnUnref(function(t){var e=x.find(n,freeOnUnref(function(e){return e.getTier().token===t.currentToken}));e.removeMultiviewRestrictions(),e.multiviewToken=t.newToken,e.tier=void 0,e.restart()})),lt.Promise.resolve()}),e.prototype.validatePlayerExistence=freeOnUnref(function(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(null==this.findPlayerByToken(t,i.currentToken))throw new Error("Invalid update token request: No player found with token "+i.currentToken)}}),e.prototype.validateForDuplicateToken=freeOnUnref(function(e){var t=x.countBy(e,freeOnUnref(function(e){return e.currentToken})),n=x.find(x.keys(t),freeOnUnref(function(e){return 1<t[e]}));if(n)throw new Error("Invalid update token request: Duplicate currentToken found: "+n)}),e.prototype.getLayoutType=freeOnUnref(function(e){var t=e[0].type;if(!e.every(freeOnUnref(function(e){return e.type===t})))throw new Error("Different layout types are not supported for updateTokens() method.");return t}),e.prototype.parseTokenCapabilities=freeOnUnref(function(e){return e.map(freeOnUnref(function(e){var t=$A.getTokenCapabilities(e.newToken);if(null==t)throw new Error("Cannot parse token: "+e.newToken);return t}))}),e.prototype.validateIfTiersSupported=freeOnUnref(function(n,e){for(var r=[],t=freeOnUnref(function(t){var e=x.find(n,freeOnUnref(function(e){return e.player===t}));null!=e?r.push(e.newTier):r.push(t.getTier().currentTier)}),i=0,o=e;i<o.length;i++){t(o[i])}if(!this.areSupportedTiers(r)){var a=x.pairs(this.expectedTiers).map(freeOnUnref(function(e){return e[0]+" players: ["+e[1].join(", ")+"]"})).join("; ");throw new Error("Device does not support the requested tier configuration: ["+r.join(", ")+"]. Supported configurations: "+a+". Please check tiers with 'getMultiviewSupport()' method before attempting tier changes.")}}),e.prototype.executeTierChanges=freeOnUnref(function(e){var t=this,n=e.filter(freeOnUnref(function(e){return e.operationType===o.Downgrade})),r=e.filter(freeOnUnref(function(e){return e.operationType===o.Upgrade||e.operationType===o.SameLevel}));return lt.Promise.resolve().then(freeOnUnref(function(){n.forEach(freeOnUnref(function(e){return t.setFlexibleTier(e)})),r.forEach(freeOnUnref(function(e){return t.setFlexibleTier(e)}))})).then(freeOnUnref(function(){}))}),e.prototype.setFlexibleTier=freeOnUnref(function(e){if(e.newTier!==e.currentTier||e.currentToken!==e.newToken){var t=this.getFlexibleLayoutCapabilities(e.newToken);if(t.currentTier!==e.newTier&&t.maxTier!==e.newTier)throw new Error("Cannot apply "+e.newTier+" for token: "+e.newToken+". Supported tiers: ["+t.currentTier+", "+t.maxTier+"]");var n=e.player;n.applyFlexibleLayoutRestrictions(t),n.multiviewToken=e.newToken,n.tier=e.newTier,n.restart()}else a.info("Tier unchanged: "+e.currentTier+" with token "+e.newToken)}),e.prototype.getOperationType=freeOnUnref(function(e,t){var n=l[e],r=l[t];return n<r?o.Downgrade:r<n?o.Upgrade:o.SameLevel}),e.prototype.multiviewSupportRequest=freeOnUnref(function(e){var t=e.map(freeOnUnref(function(e){return e.tier}));if(!this.areSupportedTiers(t))return lt.Promise.resolve([]);var n=e.map(freeOnUnref(function(e){var t=s[e.tier];if(null==t)throw new Error("Could not find tier constraints. Tier is not supported. Supported tiers: "+x.keys(s).join(", "));var n=i({id:Vy.UUID.v4()},t),r=$A.generateToken(n);return null!=e.currentToken?{tier:e.tier,requireReset:!0,newToken:r,currentToken:e.currentToken}:{tier:e.tier,newToken:r}}));return lt.Promise.resolve(n)}),e.prototype.areSupportedTiers=freeOnUnref(function(r){return x.values(this.expectedTiers).some(freeOnUnref(function(e){if(r.length>e.length)return!1;var t=x.sortBy(r,freeOnUnref(function(e){return l[e]})),n=x.sortBy(e,freeOnUnref(function(e){return l[e]}));return t.every(freeOnUnref(function(e,t){return l[e]>=l[n[t]]}))}))}),e.prototype.findPlayerByToken=freeOnUnref(function(e,t){var n=x.find(e,freeOnUnref(function(e){return e.getTier().token===t}));return null==n?null:n}),e.prototype.enabledMultiview=freeOnUnref(function(){return null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.multiview&&!0===L.configurationStore.configuration.multiview.enabled}),e.prototype.getFlexibleLayoutCapabilities=freeOnUnref(function(e){var t=$A.getTokenCapabilities(e);if(null==t)throw new Error("Token could not be parsed : "+e);if(t.type!==$A.LayoutType.FlexibleLayout)throw new Error("Token type is not supported. Expected FlexibleLayout type. Current type: "+t.type);return t}),e})();t.XpMultiviewFeature=f}));e(ED);ED.XpMultiviewFeature;var TD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("XpPlayerInstanceRegistry"),n=freeOnUnref(function(){function e(){var n=this;this.eventEmitter=new A.EventEmitter,this.playerById={},this.destroyRequested=!1,this.onPlayerStateChange=freeOnUnref(function(t){return freeOnUnref(function(e){"Destroyed"===e&&(r.info("Deregistering player "+t+"."),delete n.playerById[t]),n.destroyRequested&&x.isEmpty(n.playerById)&&(r.info("Destroyed all the players."),n.eventEmitter.emit("Destroyed"))})})}return e.prototype.getPlayers=freeOnUnref(function(){return x.pick(this.playerById,freeOnUnref(function(e,t){return"Created"===e.playerState}))}),e.prototype.addPlayer=freeOnUnref(function(e){var t;r.info(">> addPlayer("+e.id+") - adding player"),this.enabledMultiview()?(this.playerById[e.id]=e).on("PlayerStateChange",this.onPlayerStateChange(e.id)):this.playerById=((t={})[e.id]=e,t)}),e.prototype.destroy=freeOnUnref(function(){r.info(">> destroy() - destroying xp players"),this.destroyRequested=!0;var e=x.values(this.playerById);if(x.isEmpty(e))return r.info("No players to destroy, emitting 'Destroyed' event"),void this.eventEmitter.emit("Destroyed");for(var t=0,n=e;t<n.length;t++){n[t].destroy()}}),e.prototype.on=freeOnUnref(function(e,t){this.eventEmitter.on(e,t)}),e.prototype.once=freeOnUnref(function(e,t){this.eventEmitter.once(e,t)}),e.prototype.off=freeOnUnref(function(e,t){this.eventEmitter.off(e,t)}),e.prototype.enabledMultiview=freeOnUnref(function(){return null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.multiview&&!0===L.configurationStore.configuration.multiview.enabled}),e})();t.XpPlayerInstanceRegistry=n}));e(TD);TD.XpPlayerInstanceRegistry;var wD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var U=de.get("BsmvMockManager");function M(e,t,n,r){var i,o,a=n/r;return e/t<=a?(i=e,o=Math.floor(i/a)):(o=t,i=Math.floor(o*a)),{width:i,height:o}}function n(e,t,n,r,i,o,a){var s=[],l=i-2*a,f=o-2*a,u=Math.round(.75*(l-a)),c=f,d=l-(u+a),p=f,h=M(u,c,n,r),m=h.width,y=h.height;s.push({index:0,token:Vy.UUID.v4(),viewport:{x:a+Math.round(u-m)/2,y:a+Math.round((c-y)/2),width:m,height:y}});for(var g=M(d,p,n,r),v=g.width,O=g.height,S=t*(O+a)-a,U=Math.round((p-S)/2),b=a+u+a,P=0;P<t;P++)s.push({index:P+1,token:Vy.UUID.v4(),viewport:{x:b,y:U+P*(O+a),width:v,height:O}});return{type:e,tiles:s}}var r=freeOnUnref(function(){function e(){}return e.prototype.createInstance=freeOnUnref(function(){throw new Error("Method not implemented.")}),e.prototype.setOutputPosition=freeOnUnref(function(e,t,n,r,i){throw new Error("Method not implemented.")}),e})(),i=freeOnUnref(function(){function e(){this.isInitialized=!1,this._fixedLayouts=null,this.currentLayoutInfo=null,this.activePlayers=[],this.mpbAdapter=new r}return e.prototype.initialize=freeOnUnref(function(){if(this.isInitialized)throw new Error("Already initialized");var e=zt.deviceCapabilities.output.video.display.width,t=zt.deviceCapabilities.output.video.display.height;this._fixedLayouts=[n("OnePlusOne",1,16,9,e,t,16),n("OnePlusTwo",2,16,9,e,t,16),n("OnePlusThree",3,16,9,e,t,16)],this.isInitialized=!0}),e.prototype.getFixedMultiviewSupport=freeOnUnref(function(){return this.checkIfInitialized(),this.fixedLayouts.map(freeOnUnref(function(e){return{type:e.type,tileTokens:e.tiles.map(freeOnUnref(function(e){return e.token}))}}))}),Object.defineProperty(e.prototype,"fixedLayoutTilePositions",{get:freeOnUnref(function(){if(null==this.currentLayoutInfo)throw new Error("No layout selected");return this.currentLayoutInfo.tiles.map(freeOnUnref(function(e){return{tileIndex:e.index,tileToken:e.token,viewport:{x:e.viewport.x,y:e.viewport.y,width:e.viewport.width,height:e.viewport.height}}}))}),enumerable:!0,configurable:!0}),e.prototype.createPlayerIfBsmv=freeOnUnref(function(e,t){if(this.checkIfInitialized(),null==t||null==t.token)return U.info("No multi-view token provided. Won't create BSMV player."),null;var n=this.findLayoutAndTileByToken(t.token);if(null==n)return U.info("Multi-view token provided ("+t.token+") but it's not a BSMV token."),null;if(null!=this.currentLayoutInfo&&this.currentLayoutInfo.type!==n.layout.type)throw new Error("Token not from the active layout.");if(null!=this.currentLayoutInfo)for(var r=0,i=this.activePlayers;r<i.length;r++){var o=i[r];if(this.currentLayoutInfo.tiles[o.tileIndex].token===t.token)throw new Error("Token "+t.token+" (tile "+o.tileIndex+") is already used by another player (id = "+o.playerId+").")}var a=this.mpbAdapter.createInstance();t.surfaceRef={instanceId:a,viewport:{x:n.tile.viewport.x,y:n.tile.viewport.y,width:n.tile.viewport.width,height:n.tile.viewport.height}};var s=e();return this.activePlayers.push({playerId:s.id,mpbInstanceId:a,tileIndex:n.tile.index}),null==this.currentLayoutInfo&&(this.currentLayoutInfo=n.layout),s}),e.prototype.processUpdateTokens=freeOnUnref(function(e){this.checkIfInitialized(),U.info("processUpdateTokens called with "+JSON.stringify(e));var t=null,n=null,r={},i={};if(null==this.currentLayoutInfo)return!1;for(var o=0,a=e;o<a.length;o++){var s=a[o],l=this.findLayoutAndTileByToken(s.currentToken),f=this.findLayoutAndTileByToken(s.newToken);if(null==l)return!1;if(null==f)return!1;if(null==t)t=l.layout;else if(t.type!==l.layout.type)throw new Error("Input tokens are from more than one layout.");if(null==n)n=f.layout;else if(n.type!==f.layout.type)throw new Error("Target tokens are from more than one layout.");if(t.type!==this.currentLayoutInfo.type)throw new Error("Source tokens are not from the current layout.");var u=this.getPlayerInfoByTileIndex(l.tile.index);if(null==u)throw new Error("No player active for "+s.currentToken+" (tile "+l.tile.index+")");if(null!=i[f.tile.index])throw new Error("Tile "+f.tile.index+" is already used by another player.");r[u.playerId]=f.tile.index,i[f.tile.index]=u.playerId}if(null==t||null==n)return!1;if(n.type===this.currentLayoutInfo.type)for(var c=0,d=this.activePlayers;c<d.length;c++){if(null==r[(g=d[c]).playerId]&&null!=i[g.tileIndex])throw new Error("Tile "+g.tileIndex+" is already used by another player.")}if(n.type!==this.currentLayoutInfo.type)for(var p=0,h=this.activePlayers;p<h.length;p++){if(null==r[(g=h[p]).playerId])throw new Error("Player "+g.playerId+" not mapped to a new tile.")}n.type!==this.currentLayoutInfo.type&&(this.currentLayoutInfo=n);for(var m=0,y=Object.keys(r);m<y.length;m++){var g,v=y[m],O=r[v];if(null==(g=this.getPlayerInfoByPlayerId(v)))throw new Error("Player "+v+" not found");g.tileIndex=O;var S=this.currentLayoutInfo.tiles[O].viewport;this.mpbAdapter.setOutputPosition(g.mpbInstanceId,S.x,S.y,S.width,S.height)}return!0}),e.prototype.checkIfInitialized=freeOnUnref(function(){if(!this.isInitialized)throw new Error("BsmvMockManager not initialized")}),Object.defineProperty(e.prototype,"fixedLayouts",{get:freeOnUnref(function(){if(this.checkIfInitialized(),null==this._fixedLayouts)throw new Error("Layouts not set. Should not happen when initialized.");return this._fixedLayouts}),enumerable:!0,configurable:!0}),e.prototype.getPlayerInfoByTileIndex=freeOnUnref(function(e){for(var t=0,n=this.activePlayers;t<n.length;t++){var r=n[t];if(r.tileIndex===e)return r}return null}),e.prototype.getPlayerInfoByPlayerId=freeOnUnref(function(e){for(var t=0,n=this.activePlayers;t<n.length;t++){var r=n[t];if(r.playerId===e)return r}return null}),e.prototype.findLayoutAndTileByToken=freeOnUnref(function(e){for(var t=0,n=this.fixedLayouts;t<n.length;t++)for(var r=n[t],i=0,o=r.tiles;i<o.length;i++){var a=o[i];if(a.token===e)return{layout:r,tile:a}}return null}),e})();t.BsmvMockManager=i}));e(wD);wD.BsmvMockManager;var ID=t(freeOnUnref(function(e,a){var t,i=ce&&ce.__assign||freeOnUnref(function(){return(i=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)}),c=ce&&ce.__rest||freeOnUnref(function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n});Object.defineProperty(a,"__esModule",{value:!0});var n=zt,r=((t={}).Debug=0,t.Info=1,t.Log=2,t.Warn=3,t.Error=4,t.Off=5,t),s={DEBUG:de.DEBUG,INFO:de.INFO,WARN:de.WARN,ERROR:de.ERROR,OFF:de.OFF};a.DEFAULT_LOGGING_LEVELS={SeekController:"WARN",FragmentLoader:"WARN",DriftTracker:"WARN",UpdateStreamListener:"WARN",VideoStreamSelector:"WARN",ContentLevelAdapterMSE:"WARN"};var l={key:"gasc_metadata",timeToLiveMs:36e5,staleWhileRevalidateMs:1/0},f={key:"getweblabs_metadata",timeToLiveMs:3e5,staleWhileRevalidateMs:0},d={key:"acm_metadata",timeToLiveMs:36e5,staleWhileRevalidateMs:1/0},u=["scriptablePlayerConfig.Ignition-X-XP","scriptablePlayerConfig"],p="ipv6.unagi-na.amazon.com",h="com.amazon.eel.pv.xpplayer.prod",m="com.amazon.eel.pv.xp.diagnostics.prod",y=de.get("XpPlayerSDK"),o=freeOnUnref(function(){function o(e,t){var n,r=this;this.version="to-be-injected",this.Features=ka.PlayerSDKFeatures,this.serverConfig={loggers:a.DEFAULT_LOGGING_LEVELS},this.serviceClientFactory=null,this.xpPlayerCapabilitiesFeaturePromise=null,this.xpPlayerSDKMetricsReportingFeature=null,this.xpCacheFeature=null,this.xpCacheFeaturePromise=null,this.nativeDiagnosticsMonitor=null,this.telemetryDataSink=null,this.onBootstrappingFetched=freeOnUnref(function(e){r.firewoodLogSink.setAppInstanceId(e.appInstanceId),null!=r.mediaEventReporter&&r.mediaEventReporter.off("bootstrappingConfigurationFetched",r.onBootstrappingFetched)}),this.config=e,n=lt.CancelToken.source(),this.destroyed=n.token,this.destroyRequested=n.cancel;var i={objectBridge:t};xt.platformRuntime.configure(i),null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.playbackDiagnostics&&L.configurationStore.configuration.playbackDiagnostics.enableTelemetryDataSink&&(this.telemetryDataSink=new CD.TelemetryDataSink(e.deviceId)),this.initializeLogging(e),this.authContextWrapper=new pD.AuthContextWrapper(this.config.authContext),this.mediaEventReporter=new Tv.MediaEventReporter,this.pmetMetricsConfigurer=new bD.PmetMetricsConfigurer(e.deviceTypeId,this.mediaEventReporter),this.xpPlayerCapabilitiesFeature=new $A.XpPlayerCapabilitiesFeature,this.xpPlayerInstanceRegistry=new TD.XpPlayerInstanceRegistry,this.bsmvMockManager=new wD.BsmvMockManager,this.xpMultiviewFeature=new ED.XpMultiviewFeature(this.xpPlayerInstanceRegistry,this.bsmvMockManager),null!=this.firewoodLogSink&&this.mediaEventReporter.on("bootstrappingConfigurationFetched",this.onBootstrappingFetched),null!=this.playbackDiagnosticSink&&this.mediaEventReporter.on("bootstrappingConfigurationFetched",freeOnUnref(function(e){r.playbackDiagnosticSink.setAppInstanceId(e.appInstanceId)})),this.serviceClientConfigDeferred=new lt.SafeDeferred,this.initializationPromise=this.initializeComponents(this.config)}return o.prototype.destroy=freeOnUnref(function(){var e=this;y.info(">> destroy"),this.destroyRequested(),null!=this.nativeDiagnosticsMonitor&&this.nativeDiagnosticsMonitor.stop(),q.metrics.flush();var t=freeOnUnref(function(){null!=e.mediaEventReporter&&(e.mediaEventReporter.off("bootstrappingConfigurationFetched",e.onBootstrappingFetched),e.mediaEventReporter.stop(),e.mediaEventReporter=null),null!=o.xpLocalContentManagerFeature&&o.xpLocalContentManagerFeature.hold(),null!=e.xpCacheFeature&&(e.xpCacheFeature.destroy(),e.xpCacheFeature=null,e.xpCacheFeaturePromise=null),e.serviceClientConfigDeferred.reject(new ct.XpError("xp.sdk.destroyed",void 0,"Attempting to use a destroyed SDK")),e.xpPlayerCapabilitiesFeaturePromise=null,(e.xpPlayerSDKMetricsReportingFeature=null)!=e.playbackDiagnosticSink&&nn.Diagnostics.removeSink(e.playbackDiagnosticSink),null!=e.firewoodLogSink&&(e.firewoodLogSink.stop(),e.firewoodLogSink=void 0),null!=e.telemetryDataSink&&(nn.Diagnostics.removeSink(e.telemetryDataSink),e.telemetryDataSink.shutdown(),e.telemetryDataSink=null)});this.xpPlayerInstanceRegistry.once("Destroyed",t),this.xpPlayerInstanceRegistry.destroy()}),o.prototype.getFeature=freeOnUnref(function(n,r){var i=this;return this.initializationPromise.then(freeOnUnref(function(){if(i.destroyed.throwIfRequested(),n===ka.PlayerSDKFeatures.Player){null!=i.firewoodLogSink&&i.firewoodLogSink.flush();var e=freeOnUnref(function(){return new $A.XpPlayer(i.mergePlayerConfigDefaults(r),i.mediaEventReporter,i.xpPlayerCapabilitiesFeature)}),t=null;return null==(t=i.bsmvMockManager.createPlayerIfBsmv(e,r))&&(t=e()),t.initialize(),i.registerUnhandledEventListenerCallback(i.mediaEventReporter),i.xpPlayerInstanceRegistry.addPlayer(t),t}if(n===ka.PlayerSDKFeatures.LocalContentManager){if(null==o.xpLocalContentManagerFeaturePromise){if(null==r)throw new Error("Attempting to create LocalContentManager without a config object");o.xpLocalContentManagerFeature=new gS.XpLocalContentManagerFeature(i.serviceClientFactory,i.mergeLocalContentManagerConfigDefaults(r),i.mediaEventReporter),o.xpLocalContentManagerFeaturePromise=o.xpLocalContentManagerFeature.initialize().then(freeOnUnref(function(){return o.xpLocalContentManagerFeature}))}return o.xpLocalContentManagerFeaturePromise}if(n===ka.PlayerSDKFeatures.MetricsReporting){if(null==i.xpPlayerSDKMetricsReportingFeature)throw new ct.XpError("xp.sdk.destroyed",void 0,"Attempting to use a destroyed SDK (no MetricsReportingFeature exists)");return i.xpPlayerSDKMetricsReportingFeature}if(n===ka.PlayerSDKFeatures.PlayerCapabilities)return null==i.xpPlayerCapabilitiesFeaturePromise&&(i.xpPlayerCapabilitiesFeaturePromise=i.xpPlayerCapabilitiesFeature.initialize(zt.deviceCapabilities).then(freeOnUnref(function(){if(i.destroyed.requested)throw new ct.XpError("xp.sdk.destroyed",void 0,"Attempting to use a destroyed SDK");return i.xpPlayerCapabilitiesFeature}))),i.xpPlayerCapabilitiesFeaturePromise;if(n===ka.PlayerSDKFeatures.CacheFeature){if(null==i.xpCacheFeaturePromise){if(null==r)throw new Error("Attempting to create Cache Feature without a config object");i.xpCacheFeature=new uD.CacheManager(i.mergeCacheFeatureConfigDefaults(r),i.serviceClientFactory),i.xpCacheFeaturePromise=i.xpCacheFeature.initialize().then(freeOnUnref(function(){return i.xpCacheFeature}))}return i.xpCacheFeaturePromise}if(n===ka.PlayerSDKFeatures.MultiviewFeature)return i.xpMultiviewFeature;throw new ct.XpError("xp.sdk.unsupported_feature",void 0,"Feature '"+n+"' is currently unsupported.")})).catch(freeOnUnref(function(e){if(i.destroyed.requested)throw new ct.XpError("xp.sdk.destroyed",void 0,"Attempting to use a destroyed SDK");throw y.warn("<< getFeature("+n+") failed:",e),e}))}),o.prototype.registerUnhandledEventListenerCallback=freeOnUnref(function(i){var n=freeOnUnref(function(e,t){q.metrics.putMetric("UnhandledEventListenerError");var n=Tv.ErrorEventFactory.createErrorDetails(e);n.message.generic="UnhandledEventListenerError",n.message.specific="Unhandled event listener error "+(null!=t?"for "+t:"")+": "+n.message.specific;var r=Tv.ErrorEventFactory.createErrorEvent("Player","Error",!1,n);i.enqueueMediaEvents([r])});A.EventEmitter.onUnhandledEventListener(freeOnUnref(function(e,t){n(e,t)})),A.MulticastCallback.onUnhandledEventListener(freeOnUnref(function(e){n(e)}))}),o.prototype.getServiceClientConfig=freeOnUnref(function(){return this.serviceClientConfigDeferred.promise}),o.prototype.setAuthContext=freeOnUnref(function(e){this.authContextWrapper.setAuthContext(e)}),o.prototype.mergePlayerConfigDefaults=freeOnUnref(function(e){return e.authContext=this.authContextWrapper,e.deviceId=this.config.deviceId,e.deviceProxyUrl=this.deviceProxyUrl,e.deviceTypeId=this.config.deviceTypeId,e.marketplaceId=this.marketplaceId,e.clientIdentity=this.config.clientIdentity,e.applicationIdentity=this.config.applicationIdentity,e.uiIdentity=this.config.uiIdentity,e}),o.prototype.mergeLocalContentManagerConfigDefaults=freeOnUnref(function(e){return null==e.titleDecorationScheme&&(e.titleDecorationScheme="primary-content"),e.clientIdentity=this.config.clientIdentity,e.applicationIdentity=this.config.applicationIdentity,e}),o.prototype.mergeCacheFeatureConfigDefaults=freeOnUnref(function(e){return e.applicationIdentity=this.config.applicationIdentity,e}),o.prototype.initializeLogging=freeOnUnref(function(e){var t=e.debug,n=this.getLogConfig(t),r=new Ka.JSLoggerLogSource;r.setLevel(n.generalLogLevel);var i=new Ka.PlatformLogSource;if(i.setLevel(n.platformLogLevel),5!==n.consoleLogLevel){var o=new Ka.PlatformLogSink(n.consoleLogLevel),a=new Ka.LogRouter;a.addSinks(o),ja.platformLogsManager&&ja.platformLogsManager.isDirectlyLogging?a.addSources(r):a.addSources(r,i)}if(e.deviceId&&e.deviceTypeId&&5!==n.remoteLogLevel){var s=new Ka.LogRouter;this.firewoodLogSink=new JA.FirewoodLogSink(p,h,e.deviceId,e.deviceTypeId),this.firewoodLogSink.setLevel(n.remoteLogLevel),s.addSources(r,i),s.addSinks(this.firewoodLogSink),null!=this.telemetryDataSink&&s.addSinks(this.telemetryDataSink)}(x.isBoolean(t)?t:null!=t)&&(this.playbackDiagnosticSink=new $A.PlaybackDiagnosticsSink(p,m),nn.Diagnostics.addSink(this.playbackDiagnosticSink))}),o.prototype.getLogConfig=freeOnUnref(function(e){var t={consoleLogLevel:5,generalLogLevel:1,platformLogLevel:1,remoteLogLevel:1};return(x.isBoolean(e)?e:null!=e)&&(t.consoleLogLevel=r[Qe.withDefault(e.consoleLogLevel,"Info")],t.generalLogLevel=r[Qe.withDefault(e.generalLogLevel,"Info")],t.platformLogLevel=r[Qe.withDefault(e.platformLogLevel,"Info")],t.remoteLogLevel=r[Qe.withDefault(e.remoteLogLevel,"Info")]),t}),o.prototype.initializeComponents=freeOnUnref(function(t){var u=this,e=lt.Promise.race([lt.Promise.all([this.promisifyInitMethod(n.initDeviceInformation,{deviceTypeId:t.deviceTypeId}),this.promisifyInitMethod(n.initDeviceCapabilities,{})]),this.destroyed.promise.then(freeOnUnref(function(e){throw e}))]).then(freeOnUnref(function(){u.destroyed.throwIfRequested();var e=zt.deviceInformation.software.playerBundle;return null!=u.firewoodLogSink&&(u.firewoodLogSink.initialize(),null!=e&&u.firewoodLogSink.setPlayerVersion(e.version)),u.bsmvMockManager.initialize(),yD.makeCachedServiceCall(l,freeOnUnref(function(){return u.sendDeviceInitializationRequest(t)}))})).then(freeOnUnref(function(e){u.destroyed.throwIfRequested(),u.deviceProxyUrl=e.baseUrl,u.marketplaceId=e.marketplaceId;var t=u.createBaseServiceClientParameters(),n=i({},t,{deviceProxyUrl:u.deviceProxyUrl});u.serviceClientConfigDeferred.resolve(n),u.serviceClientFactory=new yr.ServiceClientFactory(u.deviceProxyUrl,t,u.authContextWrapper),u.mergeServerConfig(e);var r=u.serverConfig;return u.extractLivingRoomReleasePlatform(r,e),u.pmetMetricsConfigurer.update(r,u.marketplaceId),u.makeNonRejectingCachingWeblabCall()})).then(freeOnUnref(function(e){u.destroyed.throwIfRequested();var t=u.serverConfig,n=t.weblabs,r=c(t,["weblabs"]);if(null!=n)for(var i=0,o=Object.keys(e);i<o.length;i++){var a=o[i],s=e[a];try{var l=n[a][s];null!=l&&ze.applyPatch(r,l)}catch(e){y.error("Failed to apply patch for weblab "+a+" with treatment "+s,e)}}r.weblabs=e,L.configurationStore.configuration=r;var f=Tv.MediaEventConstants.getReportingServiceUrlFromMarketplaceId(u.marketplaceId);(u.mediaEventReporter.initialize(f,u.authContextWrapper),u.xpPlayerSDKMetricsReportingFeature=new PD.XpPlayerSDKMetricsReportingFeature(u.mediaEventReporter),u.pmetMetricsConfigurer.update(L.configurationStore.configuration),u.nativeDiagnosticsMonitor=new vD.NativeDiagnosticsMonitor(L.configurationStore.configuration),u.nativeDiagnosticsMonitor.start(),u.configureLoggers(),null!=u.telemetryDataSink)&&(nn.Diagnostics.addSink(u.telemetryDataSink),nn.Diagnostics.create("ServerConfig").report("telemetry",u.serverConfig),nn.Diagnostics.create("Weblabs").report("telemetry",e));x.isEmpty(e)||y.info("Weblabs:",JSON.stringify(e))})).then(freeOnUnref(function(){return null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.acm&&!0===L.configurationStore.configuration.acm.enableAcmConfigSupport?yD.makeCachedServiceCall(d,freeOnUnref(function(){return u.sendAcmRequest(t)})):lt.Promise.resolve(null)})).then(freeOnUnref(function(e){null==e||x.isEmpty(e)||u.mergeACMConfigsIntoDISConfig(e),null!=L.configurationStore.configuration&&null!=L.configurationStore.configuration.cacheFeature&&!0===L.configurationStore.configuration.cacheFeature.enableDiskStorage&&(y.info("Setting local storage to use disk based on configuration"),Pt.localStorage.setStorageType("Disk"))}));return e.catch(freeOnUnref(function(e){y.error("Failed to initialize PlayerSDK:",e),e instanceof lt.CancelError?u.serviceClientConfigDeferred.reject(new ct.XpError("xp.sdk.destroyed",void 0,"Attempting to use a destroyed SDK")):(u.serviceClientConfigDeferred.reject(e),q.metrics.putMetric("PlayerSDK.InitializationFailed"),q.metrics.flush())})),e}),o.prototype.sendDeviceInitializationRequest=freeOnUnref(function(e){var t=this;return new Wy.DeviceInitializationServiceClient(e.deviceId,e.deviceTypeId,this.authContextWrapper,e.route).send(this.destroyed).then(freeOnUnref(function(e){return t.destroyed.throwIfRequested(),e.on("latency",freeOnUnref(function(e){q.metrics.putMetric("ServiceRequest.DIS.RequestLatencyTime",e,"ms")})),e.on("success",freeOnUnref(function(e){q.metrics.putMetric("ServiceRequest.DIS.SuccessfulRequestAtAttempt",e.attempt)})),e.response()})).catch(freeOnUnref(function(e){throw e instanceof lt.CancelError||q.metrics.putMetric("ServiceRequest.DIS.Error"),e}))}),o.prototype.sendAcmRequest=freeOnUnref(function(e){var t=this;return new Wy.AcmServiceClient(e.deviceId,e.deviceTypeId,this.authContextWrapper,e.route).send(this.destroyed).then(freeOnUnref(function(e){return t.destroyed.throwIfRequested(),e.on("latency",freeOnUnref(function(e){q.metrics.putMetric("ServiceRequest.ACM.RequestLatencyTime",e,"ms")})),e.on("success",freeOnUnref(function(e){q.metrics.putMetric("ServiceRequest.ACM.SuccessfulRequestAtAttempt",e.attempt)})),e.response()})).catch(freeOnUnref(function(e){throw e instanceof lt.CancelError||q.metrics.putMetric("ServiceRequest.ACM.Error"),e}))}),o.prototype.mergeACMConfigsIntoDISConfig=freeOnUnref(function(e){if(null!=L.configurationStore.configuration){L.configurationStore.configuration=Qe.deepExtend(L.configurationStore.configuration,e);var t=null==L.configurationStore.configuration.weblabs?{}:L.configurationStore.configuration.weblabs,n=i({},t,this.fetchWeblabsFromACMResponse(e));L.configurationStore.configuration=i({},L.configurationStore.configuration,{weblabs:n})}else y.info("DIS Configuration has no valid response")}),o.prototype.fetchWeblabsFromACMResponse=freeOnUnref(function(e){var n={},r=freeOnUnref(function(e){x.isObject(e)&&(x.isObject(e.weblabs)&&x.each(e.weblabs,freeOnUnref(function(e,t){x.isString(e)||y.warn("ACM weblab "+t+" has object value "+JSON.stringify(e)+", instead of string, skipping"),n[t]=e})),x.each(e,freeOnUnref(function(e,t){"weblabs"!==t&&r(e)})))});return r(e),0<Object.keys(n).length&&y.info("Weblab assignments collected from ACM:",JSON.stringify(n)),n}),o.prototype.createBaseServiceClientParameters=freeOnUnref(function(){var e={deviceID:this.config.deviceId,deviceTypeID:this.config.deviceTypeId,gascEnabled:!Wy.MarketplaceID.isClassic(this.marketplaceId),marketplaceID:this.marketplaceId},t=zt.deviceInformation.hardware.zipcode;return null!=t&&(e["comcast-zipcode"]=t),e}),o.prototype.configureLoggers=freeOnUnref(function(){var e=L.configurationStore.configuration;if(null!=e){if(null!=this.firewoodLogSink){null!=e.firewood&&this.firewoodLogSink.setSushiConfiguration(Qe.withDefault(e.firewood.sushiEndpoint,p),Qe.withDefault(e.firewood.sushiSourceGroup,h));var t=null!=e.firewood&&null!=e.firewood.logFields?e.firewood.logFields:{general:["marketplaceId"]},n=new gD.LogFieldsProvider(this.marketplaceId).getFields(t);this.firewoodLogSink.setFields(n)}if(null!=e.loggers){if(null!=e.loggers["*"]&&"string"==typeof e.loggers["*"]){var r=e.loggers["*"].toUpperCase();null==s[r]?y.warn('Ignoring configuration for global logger: Level "'+r+'" is not valid'):de.setLevel(s[r])}for(var i=0,o=Object.keys(e.loggers);i<o.length;i++){var a=o[i];if("*"!==a&&(null!=e.loggers[a]&&"string"==typeof e.loggers[a])){r=e.loggers[a].toUpperCase();if(null==s[r]){y.warn('Ignoring configuration for logger "'+a+'": Level "'+r+'" is not valid');continue}de.get(a).setLevel(s[r])}}null!=e.playbackDiagnostics&&null!=this.playbackDiagnosticSink&&this.playbackDiagnosticSink.setSushiConfiguration(Qe.withDefault(e.playbackDiagnostics.sushiEndpoint,p),Qe.withDefault(e.playbackDiagnostics.sushiSourceGroup,m))}}}),o.prototype.makeNonRejectingCachingWeblabCall=freeOnUnref(function(){var e=this;return yD.makeCachedServiceCall(f,freeOnUnref(function(){return e.getWeblabConfig()})).catch(freeOnUnref(function(){return{}}))}),o.prototype.getWeblabConfig=freeOnUnref(function(){var t=this,e=new dD.WeblabClient(this.serviceClientFactory),n=this.serverConfig.weblabs;if(null==n||0===Object.keys(n).length)return lt.Promise.resolve({});var r=Object.keys(n),i={weblabs:r};return e.send(i,this.destroyed).then(freeOnUnref(function(e){return t.destroyed.throwIfRequested(),e.on("latency",freeOnUnref(function(e){q.metrics.putMetric("ServiceRequest.Weblabs.RequestLatencyTime",e,"ms")})),e.response()})).catch(freeOnUnref(function(e){throw e instanceof lt.CancelError||(y.error("Failed to acquire weblabs: "+r,e),q.metrics.putMetric("ServiceRequest.Weblabs.Error")),e}))}),o.prototype.promisifyInitMethod=freeOnUnref(function(e,r){return new lt.Promise(freeOnUnref(function(t,n){e(r,freeOnUnref(function(e){null!=e?n(e):t()}))}))}),o.prototype.findAdditionalConfigInDIS=freeOnUnref(function(e,t){if(null==e.deviceConfig||null==e.deviceConfig.values)return null;var n=x.find(e.deviceConfig.values,freeOnUnref(function(e){return e.key===t}));return null==n?null:n.value}),o.prototype.mergeServerConfig=freeOnUnref(function(e){var t=this.findAdditionalConfigInDIS(e,"xp.config");if(null!=t)try{this.serverConfig=Qe.deepExtend(this.serverConfig,JSON.parse(t))}catch(e){y.error("Failed to parse DIS configuration. Using built-in defaults",e),q.metrics.putMetric("ServiceRequest.DIS.ServerConfig.Error.Parse")}}),o.prototype.extractLivingRoomReleasePlatform=freeOnUnref(function(e,t){for(var n=0,r=u;n<r.length;n++){var i=r[n];if(this.extractLivingRoomReleasePlatformFromConfigKey(e,t,i))return}}),o.prototype.extractLivingRoomReleasePlatformFromConfigKey=freeOnUnref(function(e,t,n){var r,i=this.findAdditionalConfigInDIS(t,n);if(null==i)return!1;try{r=JSON.parse(i)}catch(e){return y.error("Failed to parse "+n+".",e),!1}if(null==r||!x.isObject(r))return y.warn("Invalid or unrecognized "+n+"."),!1;for(var o,a=null,s=0,l=[r.unfBundleUrls,r.bundleUrls];s<l.length;s++){var f=l[s];if(x.isObject(f)){var u=f.prod;if(x.isArray(u)){var c=u[0];if(x.isString(c)&&!x.isEmpty(c)){a=c;break}}}}if(null==a)return y.warn("Could not find Living Room player bundle URL."),!1;try{o=new mt.URL(a)}catch(e){return y.warn("Invalid Living Room player bundle URL: "+a+"."),!1}var d=o.pathname.split("/");return d.length<3||""!==d[0]||"family"!==d[1]?(y.warn("Unexpected format of Living Room player bundle URL: "+a+"."),!1):(e.livingRoomPlayerBundleInfo={bundlePath:o.pathname,family:d[2]},!0)}),o.xpLocalContentManagerFeaturePromise=null,o.xpLocalContentManagerFeature=null,o})();a.XpPlayerSDK=o}));e(ID);ID.DEFAULT_LOGGING_LEVELS,ID.XpPlayerSDK;var kD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var n=this;this.promiseType=e,this.backingPromise=new e(freeOnUnref(function(e,t){n.resolvePromise=e,n.rejectPromise=t}))}return e.prototype.resolve=freeOnUnref(function(e){this.resolvePromise(e)}),e.prototype.reject=freeOnUnref(function(e){this.rejectPromise(e)}),Object.defineProperty(e.prototype,"promise",{get:freeOnUnref(function(){return this.backingPromise}),enumerable:!0,configurable:!0}),e})();t.Deferred=n}));e(kD);kD.Deferred;var _D=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t){void 0===t&&(t=JSON),this.JSONReplacer=freeOnUnref(function(e,t){if(null!=t&&t instanceof Error){for(var n={name:t.name,message:t.message},r=0,i=Object.getOwnPropertyNames(t);r<i.length;r++){var o=i[r];n[o]=t[o]}return n}return t}),this.jsonInstance=t,this.promiseType=e}return e.prototype.setFunctionReviver=freeOnUnref(function(e){}),e.prototype.setObjectRegistry=freeOnUnref(function(e){}),e.prototype.encode=freeOnUnref(function(t){var n=this;return new this.promiseType(freeOnUnref(function(e){e(n.jsonInstance.stringify(t,n.JSONReplacer))}))}),e.prototype.decode=freeOnUnref(function(t){var n=this;return new this.promiseType(freeOnUnref(function(e){e(n.jsonInstance.parse(t))}))}),e})();t.JSONTranscoder=n}));e(_D);_D.JSONTranscoder;var RD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("MulticastCallback"),n=freeOnUnref(function(){function o(e){this.callbacks=[],this.timerAdapter=e}return o.onUnhandledEventListener=freeOnUnref(function(e){o.unhandledEventListenerCallback=e}),o.prototype.add=freeOnUnref(function(e){this.callbacks.push(e)}),o.prototype.remove=freeOnUnref(function(e){this.callbacks=x.without(this.callbacks,e)}),o.prototype.removeAll=freeOnUnref(function(){this.callbacks=[]}),o.prototype.invoke=freeOnUnref(function(r){var i=this;this.callbacks.slice();this.execute(freeOnUnref(function(){for(var e=0,t=i.callbacks;e<t.length;e++){var n=t[e];try{n(r)}catch(e){a.error("UnhandledEventListenerError: "+e+". Stack: "+e.stack),null!=o.unhandledEventListenerCallback&&o.unhandledEventListenerCallback(e)}}}))}),o.prototype.execute=freeOnUnref(function(e){null!=this.timerAdapter&&null!=this.timerAdapter.setImmediate?this.timerAdapter.setImmediate(e):e()}),o})();t.MulticastCallback=n}));e(RD);RD.MulticastCallback;var AD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){return function(e,t,n){this.name="AvpRpcError",this.code=e,this.message=t,this.stack=n}})();t.ProtocolError=n}));e(AD);AD.ProtocolError;var DD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=de.get("CallMessageHandler"),n=freeOnUnref(function(){function e(e,t){var n=this;this.onRequest=freeOnUnref(function(t){n.callObjectMethod(t.object_id,t.method_name,t.args).then(freeOnUnref(function(e){null!=n.transceiver&&n.transceiver.sendMessage("call_response",{id:t.id,result:e})})).catch(freeOnUnref(function(e){null!=n.transceiver&&n.transceiver.sendMessage("call_response",{id:t.id,result:null,error:e})}))}),this.onResponse=freeOnUnref(function(e){var t=n.callIdMap[e.id];null==t?r.warn('Received an unexpected "call_response" with id: '+e.id):(null!=e.error?t.reject(e.error):t.resolve(e.result),delete n.callIdMap[e.id])}),this.idVendor=e.idVendor,this.transceiver=e.transceiver,this.objectMap=e.objectMap,this.callIdMap={},this.transceiver.onMessage("call",this.onRequest),this.transceiver.onMessage("call_response",this.onResponse),this.promiseType=t}return e.prototype.destroy=freeOnUnref(function(){for(var e=0,t=x.values(this.callIdMap);e<t.length;e++){t[e].reject(new Error("Bridge is shutting down"))}null!=this.transceiver&&(this.transceiver.offMessage("call",this.onRequest),this.transceiver.offMessage("call_response",this.onResponse)),this.objectMap={},this.callIdMap={},this.idVendor=null,this.transceiver=null}),e.prototype.call=freeOnUnref(function(e,t,n){var r=this,i=this.idVendor.get(),o=new kD.Deferred(this.promiseType);return this.callIdMap[i]=o,this.transceiver.sendMessage("call",{id:i,object_id:e,method_name:t,args:n}).catch(freeOnUnref(function(e){throw delete r.callIdMap[i],e})).then(freeOnUnref(function(){return o.promise}))}),e.prototype.callObjectMethod=freeOnUnref(function(e,t,n){var r=this.objectMap[e];if(null==r){var i=new AD.ProtocolError("avp_rpc_invalid_object_id",'Call failed: no object with id "'+e+'"');return this.promiseType.reject(i)}try{var o=r[t];if(x.isFunction(o))return this.promiseType.resolve(o.apply(r,n));var a=r["(forwardInvocation)"];if(!x.isFunction(a)){i=new AD.ProtocolError("avp_rpc_invalid_method_name",'Call failed: object "'+e+'" has no method "'+t+'"');return this.promiseType.reject(i)}return this.promiseType.resolve(a.apply(r,[t].concat(n)))}catch(e){return this.promiseType.reject(e)}}),e})();t.CallMessageHandler=n}));e(DD);DD.CallMessageHandler;var xD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){var o=this;this.onSubscribe=freeOnUnref(function(n){var t={id:n.id,object_id:n.object_id,event_name:n.event_name},e=o.objectMap[n.object_id];if(null==e)t.error=new AD.ProtocolError("avp_rpc_invalid_object_id",'Subscribe failed: no object with id "'+n.object_id+'"');else{var r=o.getObjectEventPairName(n.object_id,n.event_name);if(o.eventAttachedMap[r])t.error=new AD.ProtocolError("avp_rpc_already_subscribed","Received subscribe request to "+n.object_id+"."+n.event_name+", but already subscribed.");else try{var i=freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o.sendEventMessage(n.object_id,n.event_name,e)});o.eventAttachedMap[r]={objectId:n.object_id,eventName:n.event_name,callback:i},e.on(n.event_name,i)}catch(e){t.error=e}}o.transceiver.sendMessage("subscribe_response",t)}),this.onUnsubscribe=freeOnUnref(function(e){var t={id:e.id,object_id:e.object_id,event_name:e.event_name},n=o.objectMap[e.object_id];if(null==n)t.error=new AD.ProtocolError("avp_rpc_invalid_object_id",'Unsubscribe failed: no object with id "'+e.object_id+'"');else{var r=o.getObjectEventPairName(e.object_id,e.event_name);if(null==o.eventAttachedMap[r])t.error=new AD.ProtocolError("avp_rpc_not_subscribed","Received unsubscribe request to "+e.object_id+"."+e.event_name+", but not subscribed.");else try{n.off(e.event_name,o.eventAttachedMap[r].callback),delete o.eventAttachedMap[r]}catch(e){t.error=e}}o.transceiver.sendMessage("unsubscribe_response",t)}),this.sendEventMessage=freeOnUnref(function(e,t,n){o.transceiver.sendMessage("event",{id:o.idVendor.get(),object_id:e,event_name:t,payloads:n})}),this.idVendor=e.idVendor,this.transceiver=e.transceiver,this.objectMap=e.objectMap,this.eventAttachedMap={},this.transceiver.onMessage("subscribe",this.onSubscribe),this.transceiver.onMessage("unsubscribe",this.onUnsubscribe)}return e.prototype.destroy=freeOnUnref(function(){null!=this.transceiver&&(this.transceiver.offMessage("subscribe",this.onSubscribe),this.transceiver.offMessage("unsubscribe",this.onUnsubscribe));for(var e=0,t=Object.keys(this.eventAttachedMap);e<t.length;e++){var n=t[e],r=this.eventAttachedMap[n];this.objectMap[r.objectId].off(r.eventName,r.callback)}this.objectMap={},this.eventAttachedMap={},this.idVendor=null,this.transceiver=null}),e.prototype.deregister=freeOnUnref(function(e){for(var t=0,n=Object.keys(this.eventAttachedMap);t<n.length;t++){var r=n[t],i=this.eventAttachedMap[r];i.objectId===e&&this.objectMap[i.objectId].off(i.eventName,i.callback)}}),e.prototype.getObjectEventPairName=freeOnUnref(function(e,t){return e+"-"+t}),e})();t.EventPublisherHandler=n}));e(xD);xD.EventPublisherHandler;var FD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=de.get("EventEmitter"),n=freeOnUnref(function(){function a(e){this.onCallbacks={},this.onceCallbacks={},this.maxListeners=10,this.timerAdapter=e}return a.onUnhandledEventListener=freeOnUnref(function(e){a.unhandledEventListenerCallback=e}),a.prototype.emit=freeOnUnref(function(r){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];var t=this.onCallbacks[r],n=this.onceCallbacks[r],o=[];t&&(o=o.concat(t)),n&&(o=o.concat(n),delete this.onceCallbacks[r]),this.execute(freeOnUnref(function(){for(var e=0,t=o;e<t.length;e++){var n=t[e];try{n.apply(void 0,i)}catch(e){s.error("UnhandledEventListenerError for '"+r+"' event:",e,"Stack:",e.stack),null!=a.unhandledEventListenerCallback&&a.unhandledEventListenerCallback(e,r.toString())}}}))}),a.prototype.off=freeOnUnref(function(e,t){var n=this.onCallbacks[e],r=this.onceCallbacks[e],i=!1;if(n){var o=n.length;this.inPlaceFilter(n,t),o!==n.length&&(i=!0),0===n.length&&delete this.onCallbacks[e]}r&&!i&&(this.inPlaceFilter(r,t),0===r.length&&delete this.onceCallbacks[e])}),a.prototype.on=freeOnUnref(function(e,t){var n=this.onCallbacks[e];n?(n.push(t),0<this.maxListeners&&n.length===this.maxListeners+1&&s.warn('MaxListenersExceededWarning for event "'+e+'"',(new Error).stack)):this.onCallbacks[e]=[t]}),a.prototype.once=freeOnUnref(function(e,t){var n=this.onceCallbacks[e];n?n.push(t):this.onceCallbacks[e]=[t]}),a.prototype.removeAllListeners=freeOnUnref(function(e){void 0===e&&(e=null),null===e?(this.onCallbacks={},this.onceCallbacks={}):(delete this.onCallbacks[e],delete this.onceCallbacks[e])}),a.prototype.setMaxListeners=freeOnUnref(function(e){this.maxListeners=e}),a.prototype.listeners=freeOnUnref(function(e){var t=this.onCallbacks[e],n=this.onceCallbacks[e],r=[];return t&&(r=r.concat(t)),n&&(r=r.concat(n)),r}),a.prototype.inPlaceFilter=freeOnUnref(function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t){e.splice(n,1);break}}),a.prototype.execute=freeOnUnref(function(e){null!=this.timerAdapter&&null!=this.timerAdapter.setImmediate?this.timerAdapter.setImmediate(e):e()}),a})();t.EventEmitter=n}));e(FD);FD.EventEmitter;var BD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("EventSubscriberHandler"),n=freeOnUnref(function(){function e(e,t,n){var r=this;this.onUnsubscribeResponse=freeOnUnref(function(e){var t=r.getObjectEventPairName(e.object_id,e.event_name),n=r.unsubscribeMap[t];null!=n?(null!=e.error?n.reject(e.error):n.resolve(void 0),delete r.unsubscribeMap[t]):i.warn("Received duplicate UnsubscribeResponse.")}),this.onSubscribeResponse=freeOnUnref(function(e){var t=r.getObjectEventPairName(e.object_id,e.event_name),n=r.subscribeMap[t];null!=n&&null!=n.pending?(null!=e.error?(r.eventEmitter.removeAllListeners(t),n.pending.reject(e.error)):n.pending.resolve(void 0),delete r.subscribeMap[t].pending):i.warn("Received duplicate SubscribeResponse.")}),this.onEventReceived=freeOnUnref(function(e){var t=r.getObjectEventPairName(e.object_id,e.event_name);r.eventEmitter.emit.apply(r.eventEmitter,[t].concat(e.payloads))}),this.idVendor=e.idVendor,this.transceiver=e.transceiver,this.subscribeMap={},this.unsubscribeMap={},this.transceiver.onMessage("subscribe_response",this.onSubscribeResponse),this.transceiver.onMessage("unsubscribe_response",this.onUnsubscribeResponse),this.transceiver.onMessage("event",this.onEventReceived),this.promiseType=t,this.eventEmitter=new FD.EventEmitter(n)}return e.prototype.destroy=freeOnUnref(function(){null!=this.transceiver&&(this.transceiver.offMessage("subscribe_response",this.onSubscribeResponse),this.transceiver.offMessage("unsubscribe_response",this.onUnsubscribeResponse),this.transceiver.offMessage("event",this.onEventReceived));for(var e=0,t=Object.keys(this.subscribeMap);e<t.length;e++){var n=t[e],r=this.subscribeMap[n];null!=r.pending&&r.pending.reject(new Error("Bridge was shutdown while waiting to subscribe."))}for(var i=0,o=Object.keys(this.unsubscribeMap);i<o.length;i++){n=o[i];this.unsubscribeMap[n].reject(new Error("Bridge was shutdown while waiting to unsubscribe."))}this.subscribeMap={},this.unsubscribeMap={},this.idVendor=null,this.transceiver=null}),e.prototype.on=freeOnUnref(function(e,t,n){var r=this.getObjectEventPairName(e,t);if(this.eventEmitter.on(r,n),null==this.subscribeMap[r]){var i=new kD.Deferred(this.promiseType);return this.subscribeMap[r]={pending:i},this.transceiver.sendMessage("subscribe",{id:this.idVendor.get(),object_id:e,event_name:t}).then(freeOnUnref(function(){return i.promise}))}return null!=this.subscribeMap[r].pending?this.subscribeMap[r].pending.promise:Promise.resolve()}),e.prototype.off=freeOnUnref(function(e,t,n){var r=this.getObjectEventPairName(e,t);if(this.eventEmitter.off(r,n),0===this.eventEmitter.listeners(r).length&&null!=this.subscribeMap[r]){var i=this.subscribeMap[r].pending;null!=i&&i.reject(new Error("Listener for "+e+"."+t+" removed while waiting to attach.")),delete this.subscribeMap[r];var o=new kD.Deferred(this.promiseType);return this.unsubscribeMap[r]=o,this.transceiver.sendMessage("unsubscribe",{id:this.idVendor.get(),object_id:e,event_name:t}).then(freeOnUnref(function(){return o.promise}))}return Promise.resolve()}),e.prototype.getObjectEventPairName=freeOnUnref(function(e,t){return e+"-"+t}),e})();t.EventSubscriberHandler=n}));e(BD);BD.EventSubscriberHandler;var LD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.counter=0,this.prefix=e+"-"+Math.random()+"-"}return e.prototype.get=freeOnUnref(function(){return this.prefix+this.counter++}),e})();t.MessageIdVendor=n}));e(LD);LD.MessageIdVendor;var ND=t(freeOnUnref(function(e,t){var n=ce&&ce.__assign||freeOnUnref(function(){return(n=Object.assign||freeOnUnref(function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e})).apply(this,arguments)});Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("V1ObjectBridge"),r=freeOnUnref(function(){function e(e,t,n,r){var i=this;this.onDisconnectRequest=freeOnUnref(function(e){i.doDisconnectCleanup(),i.disconnectCallback.invoke(void 0),i.disconnectCallback.removeAll(),i.disconnectCallback=null}),this.doDisconnectCleanup=freeOnUnref(function(){i.transceiver.offMessage("disconnect",i.onDisconnectRequest),i.transceiver.offError(i.onTransceiverError),i.transceiver.destroy(),i.callHandler.destroy(),i.eventSubscriberHandler.destroy(),i.eventPublisherHandler.destroy(),i.transceiver=null,i.idVendor=null,i.objectMap=null,i.callHandler=null,i.eventSubscriberHandler=null,i.eventPublisherHandler=null}),this.onTransceiverError=freeOnUnref(function(e){a.error("Unexpected transceiver error!",e)}),this.transceiver=t,this.objectMap={},this.idVendor=new LD.MessageIdVendor(e.appId),this.promiseType=n,this.timerAdapter=r;var o={idVendor:this.idVendor,transceiver:this.transceiver,objectMap:this.objectMap};this.callHandler=new DD.CallMessageHandler(o,this.promiseType),this.eventPublisherHandler=new xD.EventPublisherHandler(o),this.eventSubscriberHandler=new BD.EventSubscriberHandler(o,this.promiseType),this.disconnectCallback=new RD.MulticastCallback(this.timerAdapter),this.transceiver.onMessage("disconnect",this.onDisconnectRequest),this.transceiver.onError(this.onTransceiverError)}return e.prototype.disconnect=freeOnUnref(function(){this.transceiver.sendMessage("disconnect",{}),this.doDisconnectCleanup(),this.disconnectCallback.removeAll(),this.disconnectCallback=null}),e.prototype.onDisconnect=freeOnUnref(function(e){this.disconnectCallback.add(e)}),e.prototype.offDisconnect=freeOnUnref(function(e){this.disconnectCallback.remove(e)}),e.prototype.register=freeOnUnref(function(e,t){this.objectMap[e]=t}),e.prototype.deregister=freeOnUnref(function(e){this.eventPublisherHandler.deregister(e),delete this.objectMap[e]}),e.prototype.call=freeOnUnref(function(e,t,n){return this.callHandler.call(e,t,n)}),e.prototype.on=freeOnUnref(function(e,t,n){return this.eventSubscriberHandler.on(e,t,n)}),e.prototype.off=freeOnUnref(function(e,t,n){return this.eventSubscriberHandler.off(e,t,n)}),e.prototype.asRemoteObject=freeOnUnref(function(i){if(Object.keys(i).some(freeOnUnref(function(e){return x.isFunction(i[e])}))){var e=this.idVendor.get(),t=this;return{objectId:e,"(forwardInvocation)":freeOnUnref(function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=i[e];if(!x.isFunction(r))throw new Error("Object has no method "+e);return r.apply(i,t)}),dispose:freeOnUnref(function(){t.deregister(e)}),toJSON:freeOnUnref(function(){var e=this;return n({"(remote)":freeOnUnref(function(){return e})},this,i)})}}return i}),e})();t.V1ObjectBridge=r}));e(ND);ND.V1ObjectBridge;var VD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=[{version:"1.0.0",impl:ND.V1ObjectBridge}];t.ObjectBridgeVersionMap=n}));e(VD);VD.ObjectBridgeVersionMap;var jD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=["toString","toJSON","(remote)","(forwardInvocation)"],n=freeOnUnref(function(){function e(e,t){void 0===t&&(t=JSON);var s=this;this.JSONReplacer=freeOnUnref(function(e,t,n){if(n&&n instanceof Error){for(var r={name:n.name,message:n.message},i=0,o=Object.getOwnPropertyNames(n);i<o.length;i++){var a=o[i];r[a]=n[a]}return r}return null!=e&&"(remote)"===t&&null!==e.objectId&&null!=s.objectRegistry?void s.objectRegistry.register(e.objectId,n()):-1!==l.indexOf(t)?void 0:null!=e&&null!=e["(remote)"]&&null!=e.objectId&&x.isFunction(n)?{"(type)":"function",name:t,objectId:e.objectId}:n}),this.JSONReviver=freeOnUnref(function(e,t){if(null!=t&&"function"===t["(type)"]){if(null==s.functionReviver)throw new Error("Cannot deserialize function: No function reviver was registered with this JSONExTranscoder!");return s.functionReviver.revive(t.objectId,t.name)}return t}),this.jsonInstance=t,this.promiseType=e,this.functionReviver=null,this.objectRegistry=null}return e.prototype.setFunctionReviver=freeOnUnref(function(e){this.functionReviver=e}),e.prototype.setObjectRegistry=freeOnUnref(function(e){this.objectRegistry=e}),e.prototype.encode=freeOnUnref(function(t){var r=this;return new this.promiseType(freeOnUnref(function(e){var n=r.JSONReplacer;e(r.jsonInstance.stringify(t,freeOnUnref(function(e,t){return n(this,e,t)})))}))}),e.prototype.decode=freeOnUnref(function(t){var n=this;return new this.promiseType(freeOnUnref(function(e){e(n.jsonInstance.parse(t,n.JSONReviver))}))}),e})();t.JSONExTranscoder=n}));e(jD);jD.JSONExTranscoder;var qD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=[{name:"jsonex",impl:jD.JSONExTranscoder},{name:"json",impl:_D.JSONTranscoder}];t.OrderedEncodingTypeMap=n}));e(qD);qD.OrderedEncodingTypeMap;var HD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e){this.objectBridge=e}return e.prototype.revive=freeOnUnref(function(n,r){var i=this;return freeOnUnref(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.objectBridge.call(n,r,e)})}),e})();t.RemoteFunctionReviver=n}));e(HD);HD.RemoteFunctionReviver;var zD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(e,t,n){var r=this;this.relevantMessages={},this.onBusError=freeOnUnref(function(e){r.errorCallback.invoke(new Error(e))}),this.onBusMessage=freeOnUnref(function(t,e){!0===r.relevantMessages[t]&&r.transcoder.decode(e).then(freeOnUnref(function(e){r.eventEmitter.emit(t,e)})).catch(freeOnUnref(function(e){r.errorCallback.invoke(e)}))}),this.messageBus=e,this.transcoder=t,this.eventEmitter=new FD.EventEmitter(n),this.errorCallback=new RD.MulticastCallback(n),this.messageBus.onMessage(this.onBusMessage),this.messageBus.onError(this.onBusError)}return e.prototype.destroy=freeOnUnref(function(){this.messageBus.offMessage(this.onBusMessage),this.messageBus.offError(this.onBusError)}),e.prototype.sendMessage=freeOnUnref(function(t,e){var n=this;return this.transcoder.encode(e).then(freeOnUnref(function(e){n.messageBus.sendMessage(t,e)}))}),e.prototype.onMessage=freeOnUnref(function(e,t){this.relevantMessages[e]=!0,this.eventEmitter.on(e,t)}),e.prototype.offMessage=freeOnUnref(function(e,t){this.eventEmitter.off(e,t);var n=this.eventEmitter.listeners(e);null!=n&&0!==n.length||delete this.relevantMessages[e]}),e.prototype.onError=freeOnUnref(function(e){this.errorCallback.add(e)}),e.prototype.offError=freeOnUnref(function(e){this.errorCallback.remove(e)}),e})();t.MessageTransceiver=n}));e(zD);zD.MessageTransceiver;var WD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=freeOnUnref(function(){function e(){}return e.isValidSemVer=freeOnUnref(function(e){return/^\d+\.\d+\.\d+$/.test(e)}),e.findHighestSharedVersion=freeOnUnref(function(e,t){for(var n=this.getSemverIntegers(e),r=this.getSemverIntegers(t),i=0,o=n;i<o.length;i++)for(var a=o[i],s=0,l=r;s<l.length;s++){var f=l[s];if(f[0]===a[0])return f[1]<=a[1]?f.join("."):a.join(".")}return null}),e.getSemverIntegers=freeOnUnref(function(e){return e.map(freeOnUnref(function(e){return e.split(".").map(freeOnUnref(function(e){return parseInt(e)}))})).sort(freeOnUnref(function(e,t){for(var n=0;n<e.length;n++){if(t[n]>e[n])return 1;if(t[n]<e[n])return-1}return 0}))}),e})();t.SemVerHelper=n}));e(WD);WD.SemVerHelper;var KD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var l=de.get("BridgeOpener"),n=freeOnUnref(function(){function e(e,t,n,r){var s=this;this.onTransceiverError=freeOnUnref(function(e){l.error("Unexpected transceiver error!",e)}),this.onConnectRequest=freeOnUnref(function(e){l.info("Received connection request from "+e.app_id+".");var t=qD.OrderedEncodingTypeMap.map(freeOnUnref(function(e){return e.name})),n=x.intersection(t,e.payload_encodings);if(x.isEmpty(n))s.sendConnectResponseError("avp_rpc_no_supported_encodings","No available encodings: "+e.app_id+":"+e.payload_encodings+" vs. "+s.config.appId+":"+t);else{var r=n[0],i=VD.ObjectBridgeVersionMap.map(freeOnUnref(function(e){return e.version})),o=WD.SemVerHelper.findHighestSharedVersion(i,e.protocol_versions);if(null!==o){var a=s.createBridge(o,r);null!=a?(s.jsonTransceiver.sendMessage("connect_response",{app_id:s.config.appId,protocol_version:o,payload_encoding:r}),null!=s.pendingConnection&&(s.pendingConnection.resolve(a),s.pendingConnection=null)):s.sendConnectResponseError("avp_rpc_no_supported_versions","Failed to create a bridge for protocol version "+o+" encoding "+r)}else s.sendConnectResponseError("avp_rpc_no_supported_versions","No available protocol versions: "+s.config.appId+":"+i+" vs. "+e.app_id+":"+e.protocol_versions)}}),this.onConnectResponse=freeOnUnref(function(e){if(null!=s.pendingConnection){if(l.info("Received connection response from "+e.app_id+". Using encoding: "+e.payload_encoding+" and version "+e.protocol_version),null==e.error){var t=s.createBridge(e.protocol_version,e.payload_encoding);null===t?s.pendingConnection.reject(new AD.ProtocolError("avp_rpc_no_supported_versions","Received a connect response without any workable versions.")):s.pendingConnection.resolve(t)}else s.pendingConnection.reject(e.error);s.pendingConnection=null}else l.warn("Unexpected connect_response, ignoring.")}),this.config=e,this.messageBus=t,this.promiseType=n,this.timer=r,this.jsonTransceiver=new zD.MessageTransceiver(t,new _D.JSONTranscoder(n),this.timer),this.jsonTransceiver.onMessage("connect",this.onConnectRequest),this.jsonTransceiver.onMessage("connect_response",this.onConnectResponse),this.jsonTransceiver.onError(this.onTransceiverError)}return e.prototype.destroy=freeOnUnref(function(){null!=this.pendingConnection&&(this.pendingConnection.reject(new Error("BridgeOpener was destroyed while waiting for the connection to open")),this.pendingConnection=null),null!=this.jsonTransceiver&&(this.jsonTransceiver.offMessage("connect",this.onConnectRequest),this.jsonTransceiver.offMessage("connect_response",this.onConnectResponse),this.jsonTransceiver.offError(this.onTransceiverError),this.jsonTransceiver.destroy()),this.config=null,this.messageBus=null,this.jsonTransceiver=null}),e.prototype.waitForConnect=freeOnUnref(function(){return null==this.jsonTransceiver?this.promiseType.reject(new Error("BridgeOpener must be initialized for usage")):(null==this.pendingConnection&&(this.pendingConnection=new kD.Deferred(this.promiseType)),this.pendingConnection.promise)}),e.prototype.connect=freeOnUnref(function(){return null==this.jsonTransceiver?this.promiseType.reject(new Error("BridgeOpener must be initialized for usage")):(null==this.pendingConnection?(e=new kD.Deferred(this.promiseType),this.pendingConnection=e):e=this.pendingConnection,this.jsonTransceiver.sendMessage("connect",{app_id:this.config.appId,protocol_versions:VD.ObjectBridgeVersionMap.map(freeOnUnref(function(e){return e.version})),payload_encodings:qD.OrderedEncodingTypeMap.map(freeOnUnref(function(e){return e.name}))}).then(freeOnUnref(function(){return e.promise})));var e}),e.prototype.sendConnectResponseError=freeOnUnref(function(e,t){this.jsonTransceiver.sendMessage("connect_response",{app_id:this.config.appId,protocol_version:null,payload_encoding:null,error:new AD.ProtocolError(e,t)})}),e.prototype.createBridge=freeOnUnref(function(e,t){var n=e.split("."),i=parseInt(n[0]),o=parseInt(n[1]),r=x.find(qD.OrderedEncodingTypeMap,freeOnUnref(function(e){return e.name===t}));if(null==r)return null;var a=x.find(VD.ObjectBridgeVersionMap,freeOnUnref(function(e){var t=e.version.split("."),n=parseInt(t[0]),r=parseInt(t[1]);return n===i&&o<=r}));if(null==a)return null;var s=new r.impl(this.promiseType),l=new zD.MessageTransceiver(this.messageBus,s,this.timer),f=new a.impl(this.config,l,this.promiseType,this.timer),u=new HD.RemoteFunctionReviver(f);return s.setFunctionReviver(u),s.setObjectRegistry(f),f}),e})();t.BridgeOpener=n}));e(KD);KD.BridgeOpener;var GD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BridgeOpener=KD.BridgeOpener}));e(GD);GD.BridgeOpener;var QD=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var r=freeOnUnref(function(o){function e(e,t,n,r){var i=o.call(this,t,n,r)||this;return i.objectId="XpPlayer-"+Math.random(),i.featureObjectIds=[],i.bridge=e,i.bridge.register(i.objectId,i),i}return n(e,o),e.prototype.getFeature=freeOnUnref(function(e,t){var n=this;return o.prototype.getFeature.call(this,e,t).then(freeOnUnref(function(e){if(null==n.bridge)throw new Error("XpPlayer has been destroyed and can't be used anymore.");return-1===n.featureObjectIds.indexOf(e.objectId)&&(n.bridge.register(e.objectId,e),n.featureObjectIds.push(e.objectId)),e}))}),e.prototype.destroy=freeOnUnref(function(){if(null!=this.bridge){for(var e=0,t=this.featureObjectIds;e<t.length;e++){var n=t[e];this.bridge.deregister(n)}this.featureObjectIds=[],this.bridge.deregister(this.objectId),this.bridge=null}o.prototype.destroy.call(this)}),e.prototype.toJSON=freeOnUnref(function(){return{objectId:this.objectId,version:this.version,Features:this.Features,Events:this.Events,error:this.error,contentError:this.contentError,contentState:this.contentState,playbackState:this.playbackState,currentTime:this.currentTime,timeline:this.timeline,playbackRate:this.playbackRate}}),e})($A.XpPlayer);t.RemoteXpPlayer=r}));e(QD);QD.RemoteXpPlayer;var XD=t(freeOnUnref(function(e,t){var n=ce&&ce.__extends||freeOnUnref(function(){var r=freeOnUnref(function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&freeOnUnref(function(e,t){e.__proto__=t})||freeOnUnref(function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)});return freeOnUnref(function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})})();Object.defineProperty(t,"__esModule",{value:!0});var a=de.get("RemoteXpPlayerSDK"),r=freeOnUnref(function(o){function e(e,t,n,r){var i=o.call(this,t,e)||this;return i.objectId="XpPlayerSDK-"+Math.random(),i.featureObjectIds=[],i.bridge=e,i.onDestroy=n,i.surfaceRef=r,i.bridge.register(i.objectId,i),i}return n(e,o),e.prototype.getFeature=freeOnUnref(function(n,r){var i=this;return this.destroyed.requested?lt.Promise.reject(new ct.XpError("sdk.destroyed",void 0,"Attempting to use a destroyed SDK!")):n===ka.PlayerSDKFeatures.Player?this.initializationPromise.then(freeOnUnref(function(){if(i.destroyed.throwIfRequested(),null!=i.firewoodLogSink&&i.firewoodLogSink.flush(),null==i.bridge)throw new ct.XpError("sdk.destroyed",void 0,"XpPlayerSDK has been destroyed and can't be used.");null==r.surfaceRef&&(r.surfaceRef=i.surfaceRef);var e=i.bridge,t=freeOnUnref(function(){return new QD.RemoteXpPlayer(e,i.mergePlayerConfigDefaults(r),i.mediaEventReporter,i.xpPlayerCapabilitiesFeature)}),n=null;return null==(n=i.bsmvMockManager.createPlayerIfBsmv(t,r))&&(n=t()),n.initialize(),i.xpPlayerInstanceRegistry.addPlayer(n),n})).catch(freeOnUnref(function(e){if(e instanceof lt.CancelError)throw new ct.XpError("sdk.destroyed",void 0,"Attempting to use a destroyed SDK!");throw e})):o.prototype.getFeature.call(this,n,r).then(freeOnUnref(function(e){if(null==i.bridge)throw new ct.XpError("sdk.destroyed",void 0,"XpPlayerSDK has been destroyed and can't be used.");var t=e.objectId;return null==t?a.warn('SDK feature "'+n+'" does not contain an objectId. Method calls will FAIL against this feature. Ensure object is serializable and callable.'):-1===i.featureObjectIds.indexOf(t)&&(i.bridge.register(t,e),i.featureObjectIds.push(t)),e}))}),e.prototype.destroy=freeOnUnref(function(){if(o.prototype.destroy.call(this),(this.surfaceRef=null)!=this.bridge){for(var e=0,t=this.featureObjectIds;e<t.length;e++){var n=t[e];this.bridge.deregister(n)}this.featureObjectIds=[],this.bridge.deregister(this.objectId),this.bridge=null}null!=this.onDestroy&&(this.onDestroy(),this.onDestroy=null)}),e.prototype.toJSON=freeOnUnref(function(){return{objectId:this.objectId,version:this.version,Features:this.Features}}),e})(ID.XpPlayerSDK);t.RemoteXpPlayerSDK=r}));e(XD);XD.RemoteXpPlayerSDK;var YD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=de.get("XpPlayerSDKServer"),n=freeOnUnref(function(){function e(e,t,n){var r=this;this.bridgeOpener=null,this.objectBridge=null,this.playerSDKCreated=!1,this.onBridgeOpen=freeOnUnref(function(e){i.log("Server bridge opened."),r.objectBridge=e,r.objectBridge.register("ATVXpPlayerSDK",{constructor:r.playerSDKConstructor})}),this.onPlayerSDKDestroy=freeOnUnref(function(){r.playerSDKCreated=!1}),this.playerSDKConstructor=freeOnUnref(function(e){if(r.playerSDKCreated)throw new Error("PlayerSDK already created. Only a single SDK is currently supported.");var t=new XD.RemoteXpPlayerSDK(r.objectBridge,e,r.onPlayerSDKDestroy,r.surfaceRef);return r.playerSDKCreated=!0,t}),this.bridgeOpener=new GD.BridgeOpener({appId:"ATVXpPlayerSDK"},e,lt.Promise,oe.timer),this.surfaceRef=n,i.log("Waiting for remote connection."),this.bridgeOpener.waitForConnect().then(this.onBridgeOpen).catch(freeOnUnref(function(e){i.error("Bridge open failure: ",e),t(e)}))}return e.prototype.destroy=freeOnUnref(function(){null!=this.bridgeOpener&&(this.bridgeOpener.destroy(),this.bridgeOpener=null),null!=this.objectBridge&&(this.objectBridge.disconnect(),this.objectBridge=null)}),e})();t.XpPlayerSDKServer=n}));e(YD);YD.XpPlayerSDKServer;var JD=t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.XpPlayerSDK=ID.XpPlayerSDK,t.XpPlayerSDKServer=YD.XpPlayerSDKServer}));e(JD);JD.XpPlayerSDK,JD.XpPlayerSDKServer;return e(t(freeOnUnref(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),pe();var n=me.MessageBus,r=JD.XpPlayerSDKServer;de.useDefaults(),de.setHandler(freeOnUnref(function(e,t){var n="["+t.name+"] "+Array.prototype.slice.call(e).join(" ");switch(t.level){case de.DEBUG:Native.Print(n);break;case de.INFO:case de.TIME:Native.Print("[96m"+n+"[0m");break;case de.WARN:Native.Print("[93m"+n+"[0m");break;case de.ERROR:Native.Print(!0,62784,"[31m"+n+"[0m")}}));var i=de.get("JasperBootstrap"),o=new n;o.init(),i.info("Initializing the bridge...");new r(o,freeOnUnref(function(e){return i.error(e)}));i.info("Start running connector"),re.connector.run(),i.info("Stop running connector")})))})();